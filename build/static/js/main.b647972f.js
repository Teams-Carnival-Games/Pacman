/*! For license information please see main.b647972f.js.LICENSE.txt */
!function(){var e={94104:function(e,t,n){"use strict";n.d(t,{I:function(){return v}});var r=n(93433),i=n(74165),o=n(15861),a=n(15671),s=n(43144),u=n(60136),c=n(29388),l=n(87922),d=n(48238),h=n(73061),f=n(30405),p=n(37306),v=function(e){(0,u.Z)(n,e);var t=(0,c.Z)(n);function n(e,r){var i,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],s=arguments.length>3?arguments[3]:void 0;return(0,a.Z)(this,n),(i=t.call(this)).registryEntries=e,i.dependencyContainer=r,i.requestHandlers=o,i.runtimeOptions=s,i.registry=new l.P(e),i}return(0,s.Z)(n,[{key:"IFluidDataStoreRegistry",get:function(){return this.registry}},{key:"instantiateFirstTime",value:function(){var e=(0,o.Z)((0,i.Z)().mark((function e(t){return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.containerInitializingFirstTime(t);case 2:return e.next=4,this.containerHasInitialized(t);case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"instantiateFromExisting",value:function(){var e=(0,o.Z)((0,i.Z)().mark((function e(t){return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.containerHasInitialized(t);case 2:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"preInitialize",value:function(){var e=(0,o.Z)((0,i.Z)().mark((function e(t,n){var o,a,s;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=t.scope,a=new p.Q(this.dependencyContainer,o.IFluidDependencySynthesizer),o.IFluidDependencySynthesizer=a,e.next=5,d.kE.load(t,this.registryEntries,f.F.apply(void 0,(0,r.Z)(this.requestHandlers)),this.runtimeOptions,o,n);case 5:return s=e.sent,a.register(h.IContainerRuntime,s),e.abrupt("return",s);case 8:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"containerInitializingFirstTime",value:function(){var e=(0,o.Z)((0,i.Z)().mark((function e(t){return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"containerHasInitialized",value:function(){var e=(0,o.Z)((0,i.Z)().mark((function e(t){return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()}]),n}(n(18279)._)},98900:function(e,t,n){"use strict";n.d(t,{Bw:function(){return u},G1:function(){return c},Pp:function(){return d}});var r=n(74165),i=n(15861),o=n(15671),a=n(43144),s=n(63760),u="_services",c=function(){function e(t){(0,o.Z)(this,e),this.runtime=t}return(0,a.Z)(e,[{key:"IFluidRouter",get:function(){return this}},{key:"request",value:function(){var e=(0,i.Z)((0,r.Z)().mark((function e(t){return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",{status:200,mimeType:"fluid/object",value:this});case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),e}(),l=function(){function e(t){(0,o.Z)(this,e),this.serviceFn=t}return(0,a.Z)(e,[{key:"getService",value:function(){var e=(0,i.Z)((0,r.Z)().mark((function e(t){return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.service||(this.service=this.serviceFn(t)),e.abrupt("return",this.service);case 2:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),e}(),d=function(e){var t=new Map;return new Map(e).forEach((function(e,n){t.set(n,new l(e))})),function(){var e=(0,i.Z)((0,r.Z)().mark((function e(n,i){var o,a,c,l;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n.pathParts[0]===u){e.next=2;break}return e.abrupt("return",void 0);case 2:if(!(n.pathParts.length<2)){e.next=4;break}return e.abrupt("return",(0,s.Ys)(400,"request did not specify a service to route to",n));case 4:if(o=t.get(n.pathParts[1])){e.next=7;break}return e.abrupt("return",(0,s.I4)(n));case 7:return e.next=9,o.getService(i);case 9:if(a=e.sent,c=a.IFluidRouter,l=n.createSubRequest(2),!c){e.next=14;break}return e.abrupt("return",c.request(l));case 14:if(n.isLeaf(2)){e.next=16;break}return e.abrupt("return",(0,s.Ys)(400,"request sub-url for service that doesn't support routing",n));case 16:return e.abrupt("return",{status:200,mimeType:"fluid/object",value:a});case 17:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()}},91693:function(e,t,n){"use strict";n.d(t,{M:function(){return d}});var r=n(93433),i=n(43144),o=n(15671),a=n(60136),s=n(29388),u=n(24615),c=n(2517),l=n(42595),d=function(e){(0,a.Z)(n,e);var t=(0,s.Z)(n);function n(e,i){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],s=arguments.length>3?arguments[3]:void 0,d=arguments.length>4?arguments[4]:void 0,h=arguments.length>5&&void 0!==arguments[5]?arguments[5]:l.Zb;(0,o.Z)(this,n);var f=(0,r.Z)(a);return a.find((function(e){return e.type===u.y.Type}))||f.push(u.u.getFactory()),a.find((function(e){return e.type===c.c.Type}))||f.push(c.G.getFactory()),t.call(this,e,i,f,s,d,h)}return(0,i.Z)(n)}(n(98495).M)},98495:function(e,t,n){"use strict";n.d(t,{M:function(){return p}});var r=n(93433),i=n(74165),o=n(15671),a=n(43144),s=n(15861),u=n(42595),c=n(87922),l=n(37306),d=n(66533);function h(e,t,n,r,i,o,a){return f.apply(this,arguments)}function f(){return f=(0,s.Z)((0,i.Z)().mark((function e(t,n,r,o,a,c,h){var f,p,v,g,m,y;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(f=a,f=(0,u.eH)(function(){var e=(0,s.Z)((0,i.Z)().mark((function e(t,n){return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,d.y.getDataObject(n);case 2:return e.abrupt("return",e.sent.request(t));case 3:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),f),p=new f(n,r,c),v=n.scope,g=new l.Q(v.IFluidDependencySynthesizer),m=g.synthesize(o,{}),y=new t({runtime:p,context:n,providers:m,initProps:h}),c){e.next=10;break}return e.next=10,y.finishInitialization(c);case 10:return e.abrupt("return",{instance:y,runtime:p});case 11:case"end":return e.stop()}}),e)}))),f.apply(this,arguments)}var p=function(){function e(t,n,r,i,a){var s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:u.Zb;if((0,o.Z)(this,e),this.type=t,this.ctor=n,this.optionalProviders=i,this.runtimeClass=s,""===this.type)throw new Error("undefined type member");void 0!==a&&(this.registry=new c.P(a)),this.sharedObjectRegistry=new Map(r.map((function(e){return[e.type,e]})))}return(0,a.Z)(e,[{key:"IFluidDataStoreFactory",get:function(){return this}},{key:"IFluidDataStoreRegistry",get:function(){return this.registry}},{key:"registryEntry",get:function(){return[this.type,Promise.resolve(this)]}},{key:"instantiateDataStore",value:function(){var e=(0,s.Z)((0,i.Z)().mark((function e(t,n){var r,o;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,h(this.ctor,t,this.sharedObjectRegistry,this.optionalProviders,this.runtimeClass,n);case 2:return r=e.sent,o=r.runtime,e.abrupt("return",o);case 5:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"createChildInstance",value:function(){var e=(0,s.Z)((0,i.Z)().mark((function e(t,n){return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.createNonRootInstanceCore(t.containerRuntime,[].concat((0,r.Z)(t.packagePath),[this.type]),n));case 1:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"createPeerInstance",value:function(){var e=(0,s.Z)((0,i.Z)().mark((function e(t,n){return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.createNonRootInstanceCore(t.containerRuntime,t.packagePath,n));case 1:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"createInstance",value:function(){var e=(0,s.Z)((0,i.Z)().mark((function e(t,n){return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.createNonRootInstanceCore(t,[this.type],n));case 1:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"createRootInstance",value:function(){var e=(0,s.Z)((0,i.Z)().mark((function e(t,n,r){var o;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=n.createDetachedRootDataStore([this.type],t),e.abrupt("return",this.createInstanceCore(o,r));case 2:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"createNonRootInstanceCore",value:function(){var e=(0,s.Z)((0,i.Z)().mark((function e(t,n,r){var o;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=t.createDetachedDataStore(n),e.abrupt("return",this.createInstanceCore(o,r));case 2:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"createInstanceCore",value:function(){var e=(0,s.Z)((0,i.Z)().mark((function e(t,n){var r,o,a;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,h(this.ctor,t,this.sharedObjectRegistry,this.optionalProviders,this.runtimeClass,!1,n);case 2:return r=e.sent,o=r.instance,a=r.runtime,e.next=7,t.attachRuntime(this,a);case 7:return e.abrupt("return",o);case 8:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()}]),e}()},35537:function(e,t,n){"use strict";n.d(t,{L:function(){return v}});var r=n(74165),i=n(15861),o=n(15671),a=n(43144),s=n(11752),u=n(61120),c=n(60136),l=n(29388),d=n(24615),h=n(2517),f=n(10003),p=n(63760),v=function(e){(0,c.Z)(n,e);var t=(0,l.Z)(n);function n(){var e;return(0,o.Z)(this,n),(e=t.apply(this,arguments)).rootDirectoryId="root",e}return(0,a.Z)(n,[{key:"request",value:function(){var e=(0,i.Z)((0,r.Z)().mark((function e(t){var i,o;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=f.R.create(t),"bigBlobs"!==i.pathParts[0]){e.next=9;break}if(void 0!==(o=this.root.get(i.pathParts.join("/")))){e.next=6;break}return e.abrupt("return",(0,p.I4)(i));case 6:return e.abrupt("return",{mimeType:"fluid/object",status:200,value:o});case 9:return e.abrupt("return",(0,s.Z)((0,u.Z)(n.prototype),"request",this).call(this,i));case 10:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"root",get:function(){if(!this.internalRoot)throw new Error(this.getUninitializedErrorString("root"));return this.internalRoot}},{key:"initializeInternal",value:function(){var e=(0,i.Z)((0,r.Z)().mark((function e(t){return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=5;break}this.internalRoot=d.u.create(this.runtime,this.rootDirectoryId),this.internalRoot.bindToContext(),e.next=9;break;case 5:return e.next=7,this.runtime.getChannel(this.rootDirectoryId);case 7:this.internalRoot=e.sent,this.internalRoot.attributes.type===h.c.Type&&this.runtime.logger.send({category:"generic",eventName:"MapDataObject",message:"Legacy document, SharedMap is masquerading as SharedDirectory in DataObject"});case 9:return e.next=11,(0,s.Z)((0,u.Z)(n.prototype),"initializeInternal",this).call(this,t);case 11:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getUninitializedErrorString",value:function(e){return"".concat(e," must be initialized before being accessed.")}}]),n}(n(66533).y)},66533:function(e,t,n){"use strict";n.d(t,{y:function(){return b}});var r=n(74165),i=n(15861),o=n(15671),a=n(43144),s=n(97326),u=n(11752),c=n(61120),l=n(60136),d=n(29388);function h(e,t){if(!e)throw new Error("number"===typeof t?"0x".concat(t.toString(16).padStart(3,"0")):t)}var f=n(37762),p=function(e){(0,l.Z)(n,e);var t=(0,d.Z)(n);function n(e){var r;if((0,o.Z)(this,n),(r=t.call(this)).isDisposed=!1,r.forwardingEvents=new Map,void 0!==e){r.on(n.removeListenerEvent,(function(t){return r.unforwardEvent(e,t)})),r.on(n.newListenerEvent,(function(t){return r.forwardEvent(e,t)}))}return r}return(0,a.Z)(n,[{key:"disposed",get:function(){return this.isDisposed}},{key:"dispose",value:function(){this.isDisposed=!0;var e,t=(0,f.Z)(this.forwardingEvents.values());try{for(t.s();!(e=t.n()).done;){var n,r=e.value,i=(0,f.Z)(r.values());try{for(i.s();!(n=i.n()).done;){var o=n.value;try{o()}catch(a){}}}catch(s){i.e(s)}finally{i.f()}}}catch(s){t.e(s)}finally{t.f()}this.removeAllListeners(),this.forwardingEvents.clear()}},{key:"forwardEvent",value:function(e){for(var t=this,r=arguments.length,i=new Array(r>1?r-1:0),o=1;o<r;o++)i[o-1]=arguments[o];for(var a=function(){var r=u[s];if(void 0!==e&&void 0!==r&&!n.isEmitterEvent(r)){var i=t.forwardingEvents.get(r);if(void 0===i&&(i=new Map,t.forwardingEvents.set(r,i)),!i.has(e)){var o=function(){for(var e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];return t.emit.apply(t,[r].concat(n))};i.set(e,(function(){return e.off(r,o)})),e.on(r,o)}}},s=0,u=i;s<u.length;s++)a()}},{key:"unforwardEvent",value:function(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),i=1;i<t;i++)r[i-1]=arguments[i];for(var o=0,a=r;o<a.length;o++){var s=a[o];if(void 0!==s&&!n.isEmitterEvent(s)){var u=this.forwardingEvents.get(s);if((null===u||void 0===u?void 0:u.has(e))&&0===this.listenerCount(s)){var c=u.get(e);void 0!==c&&c(),u.delete(e),0===u.size&&this.forwardingEvents.delete(s)}}}}}],[{key:"isEmitterEvent",value:function(e){return e===n.newListenerEvent||e===n.removeListenerEvent}}]),n}(function(e){(0,l.Z)(n,e);var t=(0,d.Z)(n);function n(){var e,r,i,a,l,d,h,f;return(0,o.Z)(this,n),(f=t.call(this)).addListener=(0,u.Z)((e=(0,s.Z)(f),(0,c.Z)(n.prototype)),"addListener",e).bind((0,s.Z)(f)),f.on=(0,u.Z)((r=(0,s.Z)(f),(0,c.Z)(n.prototype)),"on",r).bind((0,s.Z)(f)),f.once=(0,u.Z)((i=(0,s.Z)(f),(0,c.Z)(n.prototype)),"once",i).bind((0,s.Z)(f)),f.prependListener=(0,u.Z)((a=(0,s.Z)(f),(0,c.Z)(n.prototype)),"prependListener",a).bind((0,s.Z)(f)),f.prependOnceListener=(0,u.Z)((l=(0,s.Z)(f),(0,c.Z)(n.prototype)),"prependOnceListener",l).bind((0,s.Z)(f)),f.removeListener=(0,u.Z)((d=(0,s.Z)(f),(0,c.Z)(n.prototype)),"removeListener",d).bind((0,s.Z)(f)),f.off=(0,u.Z)((h=(0,s.Z)(f),(0,c.Z)(n.prototype)),"off",h).bind((0,s.Z)(f)),f}return(0,a.Z)(n)}(n(47465).EventEmitter));p.newListenerEvent="newListener",p.removeListenerEvent="removeListener";var v=n(70163);var g=function(){function e(t,n){(0,o.Z)(this,e),this.absolutePath=t,this.runtime=n,this.isAttached=!0}return(0,a.Z)(e,[{key:"IFluidHandle",get:function(){return this}},{key:"attachGraph",value:function(){!function(e,t){if(!e)throw new Error("number"===typeof t?"0x".concat(t.toString(16).padStart(3,"0")):t)}(!1,202)}},{key:"get",value:function(){var e=(0,i.Z)((0,r.Z)().mark((function e(){var t;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.runtime.IFluidHandleContext.resolveHandle({url:this.absolutePath});case 2:if(200!==(t=e.sent).status||"fluid/object"!==t.mimeType){e.next=5;break}return e.abrupt("return",t.value);case 5:throw new Error("Failed to resolve container path ".concat(this.absolutePath));case 6:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"bind",value:function(e){throw new Error("Cannot bind to LegacyUriHandle")}}]),e}();var m=n(98900),y=n(84488),b=function(e){(0,l.Z)(n,e);var t=(0,d.Z)(n);function n(e){var r;return(0,o.Z)(this,n),(r=t.call(this))._disposed=!1,r.runtime=e.runtime,r.context=e.context,r.providers=e.providers,r.initProps=e.initProps,h(void 0===r.runtime._dataObject,189),r.runtime._dataObject=(0,s.Z)(r),r.innerHandle=new v.B((0,s.Z)(r),"",r.runtime.objectsRoutingContext),r.runtime.once("dispose",(function(){r._disposed=!0,r.dispose()})),r}return(0,a.Z)(n,[{key:"disposed",get:function(){return this._disposed}},{key:"id",get:function(){return this.runtime.id}},{key:"IFluidRouter",get:function(){return this}},{key:"IFluidLoadable",get:function(){return this}},{key:"IFluidHandle",get:function(){return this.innerHandle}},{key:"handle",get:function(){return this.innerHandle}},{key:"request",value:function(){var e=(0,i.Z)((0,r.Z)().mark((function e(t){return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,y.PA)(this,t));case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"finishInitialization",value:function(){var e=(0,i.Z)((0,r.Z)().mark((function e(t){return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0===this.initializeP){e.next=2;break}return e.abrupt("return",this.initializeP);case 2:return this.initializeP=this.initializeInternal(t),e.abrupt("return",this.initializeP);case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"initializeInternal",value:function(){var e=(0,i.Z)((0,r.Z)().mark((function e(t){var n;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.preInitialize();case 2:if(!t){e.next=8;break}return h(void 0===this.initProps,190),e.next=6,this.initializingFromExisting();case 6:e.next=10;break;case 8:return e.next=10,this.initializingFirstTime(null!==(n=this.context.createProps)&&void 0!==n?n:this.initProps);case 10:return e.next=12,this.hasInitialized();case 12:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getFluidObjectFromDirectory",value:function(){var e=(0,i.Z)((0,r.Z)().mark((function e(t,n,i){var o,a;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(o=i?i(t,n):n.get(t),!(a=null===o||void 0===o?void 0:o.IFluidHandle)){e.next=4;break}return e.abrupt("return",a.get());case 4:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"getService",value:function(){var e=(0,i.Z)((0,r.Z)().mark((function e(t){return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(n="/".concat(m.Bw,"/").concat(t),r=this.context.containerRuntime,new g(n,r)).get());case 1:case"end":return e.stop()}var n,r}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"preInitialize",value:function(){var e=(0,i.Z)((0,r.Z)().mark((function e(){return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"initializingFirstTime",value:function(){var e=(0,i.Z)((0,r.Z)().mark((function e(t){return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"initializingFromExisting",value:function(){var e=(0,i.Z)((0,r.Z)().mark((function e(){return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"hasInitialized",value:function(){var e=(0,i.Z)((0,r.Z)().mark((function e(){return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"dispose",value:function(){(0,u.Z)((0,c.Z)(n.prototype),"dispose",this).call(this)}}],[{key:"getDataObject",value:function(){var e=(0,i.Z)((0,r.Z)().mark((function e(t){var n;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return h(void 0!==(n=t._dataObject),188),e.next=4,n.finishInitialization(!0);case 4:return e.abrupt("return",n);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()}]),n}(p)},72117:function(e,t,n){"use strict";n.r(t),n.d(t,{BaseContainerRuntimeFactory:function(){return s.I},BaseContainerService:function(){return y.G1},ContainerRuntimeFactoryWithDefaultDataStore:function(){return m},DataObject:function(){return o.L},DataObjectFactory:function(){return r.M},PureDataObject:function(){return a.y},PureDataObjectFactory:function(){return i.M},defaultFluidObjectRequestHandler:function(){return v.PA},defaultRouteRequestHandler:function(){return v.cd},generateContainerServicesRequestHandler:function(){return y.Pp},getDefaultObjectFromContainer:function(){return k},getObjectFromContainer:function(){return T},getObjectWithIdFromContainer:function(){return x},mountableViewRequestHandler:function(){return v.TA},serviceRoutePathRoot:function(){return y.Bw},waitForAttach:function(){return w}});var r=n(91693),i=n(98495),o=n(35537),a=n(66533),s=n(94104),u=n(74165),c=n(15861),l=n(93433),d=n(15671),h=n(43144),f=n(60136),p=n(29388),v=n(84488),g="default",m=function(e){(0,f.Z)(n,e);var t=(0,p.Z)(n);function n(e,r,i){var o,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],s=arguments.length>4?arguments[4]:void 0;return(0,d.Z)(this,n),(o=t.call(this,r,i,[(0,v.cd)(g)].concat((0,l.Z)(a)),s)).defaultFactory=e,o}return(0,h.Z)(n,[{key:"containerInitializingFirstTime",value:function(){var e=(0,c.Z)((0,u.Z)().mark((function e(t){var n;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.createDataStore(this.defaultFactory.type);case 2:return n=e.sent,e.next=5,n.trySetAlias(g);case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),n}(s.I);m.defaultDataStoreId=g;var y=n(98900),b=n(57115);function w(e){return S.apply(this,arguments)}function S(){return(S=(0,c.Z)((0,u.Z)().mark((function e(t){return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.attachState!==b.mB.Attached){e.next=2;break}return e.abrupt("return");case 2:return e.abrupt("return",new Promise((function(e){t.once("attached",(function(){Promise.resolve().then((function(){return e()})).catch((function(){}))}))})));case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function k(e){return C.apply(this,arguments)}function C(){return(C=(0,c.Z)((0,u.Z)().mark((function e(t){var n,r;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n="/",e.next=3,t.request({url:n});case 3:if(200===(r=e.sent).status&&"fluid/object"===r.mimeType){e.next=8;break}throw new Error('Unable to retrieve Fluid object at URL: "'.concat(n,'"'));case 8:if(void 0!==r.value){e.next=10;break}throw new Error('Empty response from URL: "'.concat(n,'"'));case 10:return e.abrupt("return",r.value);case 11:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function x(e,t){return E.apply(this,arguments)}function E(){return(E=(0,c.Z)((0,u.Z)().mark((function e(t,n){var r,i;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r="/".concat(t),e.next=3,n.request({url:r});case 3:if(200===(i=e.sent).status&&"fluid/object"===i.mimeType){e.next=8;break}throw new Error('Unable to retrieve Fluid object with ID: "'.concat(t,'" from URL: "').concat(r,'"'));case 8:if(void 0!==i.value){e.next=10;break}throw new Error('Empty response for ID: "'.concat(t,'" from URL: "').concat(r,'"'));case 10:return e.abrupt("return",i.value);case 11:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function T(e,t){return I.apply(this,arguments)}function I(){return(I=(0,c.Z)((0,u.Z)().mark((function e(t,n){var r;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.request({url:t});case 2:if(200===(r=e.sent).status&&"fluid/object"===r.mimeType){e.next=7;break}throw new Error('Unable to retrieve Fluid object with from URL: "'.concat(t,'"'));case 7:if(void 0!==r.value){e.next=9;break}throw new Error('Empty response for from URL: "'.concat(t,'"'));case 9:return e.abrupt("return",r.value);case 10:case"end":return e.stop()}}),e)})))).apply(this,arguments)}},84488:function(e,t,n){"use strict";n.d(t,{PA:function(){return d},TA:function(){return c},cd:function(){return l}});var r=n(74165),i=n(15861),o=n(93433),a=n(30405),s=n(10003),u=n(63760),c=function(e,t){var n=a.F.apply(void 0,(0,o.Z)(t));return function(){var t=(0,i.Z)((0,r.Z)().mark((function t(i,o){var a,s,u,c,l;return(0,r.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return s=!0===(null===(a=i.headers)||void 0===a?void 0:a.mountableView),u=i,s&&(delete(c=Object.assign({},i.headers)).mountableView,u={url:i.url,headers:c}),t.next=5,n(u,o);case 5:if(l=t.sent,!s||200!==l.status||!e.canMount(l.value)){t.next=8;break}return t.abrupt("return",{status:200,mimeType:"fluid/object",value:new e(l.value)});case 8:return t.abrupt("return",l);case 9:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}()},l=function(e){return function(){var t=(0,i.Z)((0,r.Z)().mark((function t(n,i){var o;return(0,r.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(0!==(o=s.R.create(n)).pathParts.length){t.next=3;break}return t.abrupt("return",i.IFluidHandleContext.resolveHandle({url:"/".concat(e).concat(o.query),headers:n.headers}));case 3:return t.abrupt("return",void 0);case 4:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}()};function d(e,t){return""===t.url||"/"===t.url||t.url.startsWith("/?")?{mimeType:"fluid/object",status:200,value:e}:(0,u.I4)(t)}},30:function(e,t,n){"use strict";n.r(t),n.d(t,{AzureAudience:function(){return c},AzureClient:function(){return Vi},AzureFunctionTokenProvider:function(){return Wi},ScopeType:function(){return Hi}});var r={};n.r(r),n.d(r,{Decoder:function(){return lr},Encoder:function(){return ur},PacketType:function(){return or},protocol:function(){return sr}});var i=n(15671),o=n(43144),a=n(60136),s=n(29388),u=n(27186),c=function(e){(0,a.Z)(n,e);var t=(0,s.Z)(n);function n(){return(0,i.Z)(this,n),t.apply(this,arguments)}return(0,o.Z)(n,[{key:"createServiceMember",value:function(e){var t=e.user;return(0,u.h)(void 0!==(null===t||void 0===t?void 0:t.name),'Provided user was not an "AzureUser".'),{userId:e.user.id,userName:t.name,connections:[],additionalDetails:t.additionalDetails}}}]),n}(n(11071).c),l=n(74165),d=n(15861),h=n(57115),f=n(39575),p=n(36569),v=n(91075),g=n(61484),m=n(98895),y=function(e){return"fluid"===(null===e||void 0===e?void 0:e.type)};function b(e){if(!y(e))throw new Error("resolved is not a Fluid url. Type: ".concat(null===e||void 0===e?void 0:e.type))}var w=n(37762);function S(e,t){return k.apply(this,arguments)}function k(){return(k=(0,d.Z)((0,l.Z)().mark((function e(t,n){var r,i,o,a;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:i=(0,w.Z)(t),e.prev=1,i.s();case 3:if((o=i.n()).done){e.next=12;break}return a=o.value,e.next=7,a.resolve(Object.assign({},n));case 7:if(void 0===(r=e.sent)){e.next=10;break}return e.abrupt("return",r);case 10:e.next=3;break;case 12:e.next=17;break;case 14:e.prev=14,e.t0=e.catch(1),i.e(e.t0);case 17:return e.prev=17,i.f(),e.finish(17);case 20:return e.abrupt("return",void 0);case 21:case"end":return e.stop()}}),e,null,[[1,14,17,20]])})))).apply(this,arguments)}var C=function(){function e(t){(0,i.Z)(this,e),this.urlResolvers=t}return(0,o.Z)(e,[{key:"resolve",value:function(){var e=(0,d.Z)((0,l.Z)().mark((function e(t){return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",S(this.urlResolvers,t));case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getAbsoluteUrl",value:function(){var e=(0,d.Z)((0,l.Z)().mark((function e(t,n){return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new Error("Not implmented");case 1:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()}],[{key:"create",value:function(t){return Array.isArray(t)?1===t.length?t[0]:new e(t):t}}]),e}(),x=n(93433),E=n(12114),T=function(){function e(t){var n=this;(0,i.Z)(this,e),this.protocolName="none:",this.protocolToDocumentFactoryMap=new Map,t.forEach((function(e){n.protocolToDocumentFactoryMap.set(e.protocolName,e)}))}return(0,o.Z)(e,[{key:"createDocumentService",value:function(){var e=(0,d.Z)((0,l.Z)().mark((function e(t,n,r){var i,o;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(b(t),void 0!==(i=(0,E.Qc)(t.url)).protocol&&null!==i.protocol){e.next=4;break}throw new Error("No protocol provided");case 4:if(void 0!==(o=this.protocolToDocumentFactoryMap.get(i.protocol))){e.next=7;break}throw new Error("Unknown Fluid protocol");case 7:return e.abrupt("return",o.createDocumentService(t,n,r));case 8:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"createContainer",value:function(){var e=(0,d.Z)((0,l.Z)().mark((function e(t,n,r,i){var o,a;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(b(n),void 0!==(o=(0,E.Qc)(n.url)).protocol&&null!==o.protocol){e.next=4;break}throw new Error("No protocol provided");case 4:if(void 0!==(a=this.protocolToDocumentFactoryMap.get(o.protocol))){e.next=7;break}throw new Error("Unknown Fluid protocol");case 7:return e.abrupt("return",a.createContainer(t,n,r,i));case 8:case"end":return e.stop()}}),e,this)})));return function(t,n,r,i){return e.apply(this,arguments)}}()}],[{key:"create",value:function(t){if(Array.isArray(t)){var n=[];return t.forEach((function(e){var t=e;void 0!==t.protocolToDocumentFactoryMap?n.push.apply(n,(0,x.Z)(t.protocolToDocumentFactoryMap.values())):n.push(e)})),1===n.length?n[0]:new e(n)}return t}}]),e}(),I=n(29439),A=n(79286),R=n.n(A),_=window.performance;function P(e,t){if(!e)throw new Error("number"===typeof t?"0x".concat(t.toString(16).padStart(3,"0")):t)}function N(e){throw new Error(arguments.length>1&&void 0!==arguments[1]?arguments[1]:"Unreachable Case")}var O,M=n(73592),F=n(10357);function Z(e,t){return{type:O.Tree,tree:{".protocol":t,".app":e}}}function D(e){var t,n=e.tree.attributes,r=JSON.parse(n.content);return r.term=null!==(t=r.term)&&void 0!==t?t:1,r}function L(e){var t=e.tree.quorumValues;return JSON.parse(t.content)}!function(e){e.Tree=1,e.Blob=2,e.Handle=3,e.Attachment=4}(O||(O={}));var B=window.performance,q=function(){var e=(0,d.Z)((0,l.Z)().mark((function e(t){return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e){return setTimeout((function(){return e()}),t)})));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),j=n(84871),U=n(1244),H="1.3.6";function z(e,t,n,r){return V.apply(this,arguments)}function V(){return(V=(0,d.Z)((0,l.Z)().mark((function e(t,n,r,i){var o,a,s,u,c,d,h,f;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:u=!1,c=1e3,d=0,h=B.now();case 4:return e.prev=4,e.next=7,t(i.cancel);case 7:s=e.sent,u=!0,e.next=25;break;case 11:if(e.prev=11,e.t0=e.catch(4),(0,U.ms)(e.t0)){e.next=16;break}throw r.sendTelemetryEvent({eventName:"".concat(n,"_cancel"),retry:d,duration:B.now()-h,fetchCallName:n},e.t0),e.t0;case 16:if(!0!==(null===(o=i.cancel)||void 0===o?void 0:o.aborted)){e.next=19;break}throw r.sendTelemetryEvent({eventName:"".concat(n,"_runWithRetryAborted"),retry:d,duration:B.now()-h,fetchCallName:n},e.t0),new U.V2("runWithRetry was Aborted",j.C.genericError,{driverVersion:H,fetchCallName:n});case 19:return d++,f=e.t0,c=null!==(a=(0,U.ZZ)(e.t0))&&void 0!==a?a:Math.min(2*c,8e3),i.onRetry&&i.onRetry(c,e.t0),e.next=25,q(c);case 25:if(!u){e.next=4;break}case 26:return d>0&&r.sendTelemetryEvent({eventName:"".concat(n,"_lastError"),retry:d,duration:B.now()-h,fetchCallName:n},f),e.abrupt("return",s);case 28:case"end":return e.stop()}}),e,null,[[4,11]])})))).apply(this,arguments)}var G,K,W=n(91688),J=n(65922),Q=n(11752),Y=n(61120);!function(e){e.NoOp="noop",e.ClientJoin="join",e.ClientLeave="leave",e.Propose="propose",e.Reject="reject",e.Summarize="summarize",e.SummaryAck="summaryAck",e.SummaryNack="summaryNack",e.Operation="op",e.RemoteHelp="remoteHelp",e.NoClient="noClient",e.RoundTrip="tripComplete",e.Control="control"}(G||(G={})),function(e){e.ThrottlingError="ThrottlingError",e.InvalidScopeError="InvalidScopeError",e.BadRequestError="BadRequestError",e.LimitExceededError="LimitExceededError"}(K||(K={}));var X=n(47465),$=n(58121),ee=n.n($);function te(e,t){if(!e)throw new Error("number"===typeof t?"0x".concat(t.toString(16).padStart(3,"0")):t)}var ne=n(97326),re=function(e){(0,a.Z)(n,e);var t=(0,s.Z)(n);function n(){var e,r,o,a,s,u,c,l;return(0,i.Z)(this,n),(l=t.call(this)).addListener=(0,Q.Z)((e=(0,ne.Z)(l),(0,Y.Z)(n.prototype)),"addListener",e).bind((0,ne.Z)(l)),l.on=(0,Q.Z)((r=(0,ne.Z)(l),(0,Y.Z)(n.prototype)),"on",r).bind((0,ne.Z)(l)),l.once=(0,Q.Z)((o=(0,ne.Z)(l),(0,Y.Z)(n.prototype)),"once",o).bind((0,ne.Z)(l)),l.prependListener=(0,Q.Z)((a=(0,ne.Z)(l),(0,Y.Z)(n.prototype)),"prependListener",a).bind((0,ne.Z)(l)),l.prependOnceListener=(0,Q.Z)((s=(0,ne.Z)(l),(0,Y.Z)(n.prototype)),"prependOnceListener",s).bind((0,ne.Z)(l)),l.removeListener=(0,Q.Z)((u=(0,ne.Z)(l),(0,Y.Z)(n.prototype)),"removeListener",u).bind((0,ne.Z)(l)),l.off=(0,Q.Z)((c=(0,ne.Z)(l),(0,Y.Z)(n.prototype)),"off",c).bind((0,ne.Z)(l)),l}return(0,o.Z)(n)}(X.EventEmitter),ie=(0,o.Z)((function e(t,n,r,o){(0,i.Z)(this,e),this.sequenceNumber=t,this.key=n,this.value=r,this.local=o})),oe=function(e){(0,a.Z)(n,e);var t=(0,s.Z)(n);function n(e){var r;return(0,i.Z)(this,n),(r=t.call(this)).isDisposed=!1,r.members=new Map(e),r.snapshotCache=e,r}return(0,o.Z)(n,[{key:"disposed",get:function(){return this.isDisposed}},{key:"snapshot",value:function(){var e;return null!==(e=this.snapshotCache)&&void 0!==e||(this.snapshotCache=ee()(Array.from(this.members))),this.snapshotCache}},{key:"addMember",value:function(e,t){te(!this.members.has(e),462),this.members.set(e,t),this.emit("addMember",e,t),this.snapshotCache=void 0}},{key:"removeMember",value:function(e){te(this.members.has(e),463),this.members.delete(e),this.emit("removeMember",e),this.snapshotCache=void 0}},{key:"getMembers",value:function(){return new Map(this.members)}},{key:"getMember",value:function(e){return this.members.get(e)}},{key:"dispose",value:function(){this.isDisposed=!0}}]),n}(re),ae=function(e){(0,a.Z)(n,e);var t=(0,s.Z)(n);function n(e,r){var o;return(0,i.Z)(this,n),(o=t.call(this)).sendProposal=r,o.isDisposed=!1,o.stateEvents=new X.EventEmitter,o.proposals=new Map(e.proposals.map((function(e){var t=(0,I.Z)(e,2)[1];return[t.sequenceNumber,new ie(t.sequenceNumber,t.key,t.value,!1)]}))),o.values=new Map(e.values),o.proposalsSnapshotCache=e.proposals,o.valuesSnapshotCache=e.values,o}return(0,o.Z)(n,[{key:"disposed",get:function(){return this.isDisposed}},{key:"snapshot",value:function(){var e,t;return null!==(e=this.proposalsSnapshotCache)&&void 0!==e||(this.proposalsSnapshotCache=Array.from(this.proposals).map((function(e){var t=(0,I.Z)(e,2),n=t[0],r=t[1];return[n,{sequenceNumber:n,key:r.key,value:r.value},[]]}))),null!==(t=this.valuesSnapshotCache)&&void 0!==t||(this.valuesSnapshotCache=ee()(Array.from(this.values))),{proposals:this.proposalsSnapshotCache,values:this.valuesSnapshotCache}}},{key:"has",value:function(e){return this.values.has(e)}},{key:"get",value:function(e){var t;return null===(t=this.values.get(e))||void 0===t?void 0:t.value}},{key:"getApprovalData",value:function(e){var t=this.values.get(e);return t?ee()(t):void 0}},{key:"propose",value:function(){var e=(0,d.Z)((0,l.Z)().mark((function e(t,n){var r,i=this;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!((r=this.sendProposal(t,n))<0)){e.next=4;break}throw this.emit("error",{eventName:"ProposalInDisconnectedState",key:t}),new Error("Can't propose in disconnected state");case 4:return e.abrupt("return",new Promise((function(e,t){var n,o=function e(t,o){t===r&&(n=o,i.stateEvents.off("localProposalSequenced",e),i.stateEvents.off("disconnected",s),i.stateEvents.on("localProposalApproved",a))},a=function(t){t===n&&(e(),c())},s=function(){void 0===n&&i.stateEvents.once("connected",(function(){void 0===n&&(t(new Error("Client disconnected without successfully sending proposal")),c())}))},u=function(){t(new Error("QuorumProposals was disposed")),c()},c=function(){i.stateEvents.off("localProposalSequenced",o),i.stateEvents.off("localProposalApproved",a),i.stateEvents.off("disconnected",s),i.stateEvents.off("disposed",u)};i.stateEvents.on("localProposalSequenced",o),i.stateEvents.on("disconnected",s),i.stateEvents.on("disposed",u)})));case 5:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"addProposal",value:function(e,t,n,r,i){te(!this.proposals.has(n),464);var o=new ie(n,e,t,r);this.proposals.set(n,o),this.emit("addProposal",o),r&&this.stateEvents.emit("localProposalSequenced",i,n),this.proposalsSnapshotCache=void 0}},{key:"updateMinimumSequenceNumber",value:function(e){var t,n=e.minimumSequenceNumber,r=[],i=(0,w.Z)(this.proposals);try{for(i.s();!(t=i.n()).done;){var o=(0,I.Z)(t.value,2),a=o[0],s=o[1];a<=n&&r.push(s)}}catch(h){i.e(h)}finally{i.f()}r.sort((function(e,t){return e.sequenceNumber-t.sequenceNumber}));for(var u=0,c=r;u<c.length;u++){var l=c[u],d={approvalSequenceNumber:e.sequenceNumber,commitSequenceNumber:-1,key:l.key,sequenceNumber:l.sequenceNumber,value:l.value};this.values.set(d.key,d),this.valuesSnapshotCache=void 0,this.emit("approveProposal",d.sequenceNumber,d.key,d.value,d.approvalSequenceNumber),this.proposals.delete(l.sequenceNumber),this.proposalsSnapshotCache=void 0,l.local&&this.stateEvents.emit("localProposalApproved",l.sequenceNumber)}}},{key:"setConnectionState",value:function(e){e?this.stateEvents.emit("connected"):this.stateEvents.emit("disconnected")}},{key:"dispose",value:function(){this.isDisposed=!0,this.stateEvents.emit("disposed")}}]),n}(re),se=function(e){(0,a.Z)(n,e);var t=(0,s.Z)(n);function n(e,r,o,a){var s;return(0,i.Z)(this,n),(s=t.call(this)).isDisposed=!1,s.quorumClients=new oe(e),s.quorumClients.on("addMember",(function(e,t){s.emit("addMember",e,t)})),s.quorumClients.on("removeMember",(function(e){s.emit("removeMember",e)})),s.quorumProposals=new ae({proposals:r,values:o},a),s.quorumProposals.on("addProposal",(function(e){s.emit("addProposal",e)})),s.quorumProposals.on("approveProposal",(function(e,t,n,r){s.emit("approveProposal",e,t,n,r)})),s}return(0,o.Z)(n,[{key:"disposed",get:function(){return this.isDisposed}},{key:"close",value:function(){this.removeAllListeners()}},{key:"snapshot",value:function(){var e=this.quorumClients.snapshot(),t=this.quorumProposals.snapshot();return{members:e,proposals:t.proposals,values:t.values}}},{key:"has",value:function(e){return this.quorumProposals.has(e)}},{key:"get",value:function(e){return this.quorumProposals.get(e)}},{key:"getApprovalData",value:function(e){return this.quorumProposals.getApprovalData(e)}},{key:"addMember",value:function(e,t){this.quorumClients.addMember(e,t)}},{key:"removeMember",value:function(e){this.quorumClients.removeMember(e)}},{key:"getMembers",value:function(){return this.quorumClients.getMembers()}},{key:"getMember",value:function(e){return this.quorumClients.getMember(e)}},{key:"propose",value:function(){var e=(0,d.Z)((0,l.Z)().mark((function e(t,n){return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.quorumProposals.propose(t,n));case 1:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"addProposal",value:function(e,t,n,r,i){return this.quorumProposals.addProposal(e,t,n,r,i)}},{key:"updateMinimumSequenceNumber",value:function(e){this.quorumProposals.updateMinimumSequenceNumber(e)}},{key:"setConnectionState",value:function(e,t){this.quorumProposals.setConnectionState(e)}},{key:"dispose",value:function(){throw new Error("Not implemented.")}}]),n}(re);var ue,ce,le,de=function(e){(0,a.Z)(n,e);var t=(0,s.Z)(n);function n(){return(0,i.Z)(this,n),t.apply(this,arguments)}return(0,o.Z)(n,[{key:"processMessage",value:function(e,t){var r=this._quorum.getMember(e.clientId);if(null!=e.clientId){if(void 0===r&&e.type!==G.ClientJoin)throw new Error("Remote message's clientId is missing from the quorum");if(!0===(null===r||void 0===r?void 0:r.shouldHaveLeft)&&e.type!==G.NoOp)throw new Error("Remote message's clientId already should have left")}return(0,Q.Z)((0,Y.Z)(n.prototype),"processMessage",this).call(this,e,t)}}]),n}(function(){function e(t,n,r,o,a,s,u){(0,i.Z)(this,e),this.minimumSequenceNumber=t,this.sequenceNumber=n,this.term=null!==r&&void 0!==r?r:1,this._quorum=new se(o,a,s,u)}return(0,o.Z)(e,[{key:"quorum",get:function(){return this._quorum}},{key:"attributes",get:function(){return{minimumSequenceNumber:this.minimumSequenceNumber,sequenceNumber:this.sequenceNumber,term:this.term}}},{key:"setConnectionState",value:function(e,t){this._quorum.setConnectionState(e,t)}},{key:"snapshot",value:function(){return this._quorum.snapshot()}},{key:"close",value:function(){this._quorum.close()}},{key:"processMessage",value:function(e,t){if(e.sequenceNumber!==this.sequenceNumber+1)throw new Error("Protocol state is not moving sequentially. "+"Current is ".concat(this.sequenceNumber,". Next is ").concat(e.sequenceNumber));this.sequenceNumber=e.sequenceNumber,this.minimumSequenceNumber=e.minimumSequenceNumber;var n=!1;switch(e.type){case G.ClientJoin:var r=e,i=JSON.parse(r.data),o={client:i.detail,sequenceNumber:r.sequenceNumber};this._quorum.addMember(i.clientId,o);break;case G.ClientLeave:var a=e,s=JSON.parse(a.data);this._quorum.removeMember(s);break;case G.Propose:var u=e.contents;this._quorum.addProposal(u.key,u.value,e.sequenceNumber,t,e.clientSequenceNumber),n=!0;break;case G.Reject:throw new Error("Quorum rejection is removed.")}return this._quorum.updateMinimumSequenceNumber(e),{immediateNoOp:n}}},{key:"getProtocolState",value:function(){return Object.assign({sequenceNumber:this.sequenceNumber,minimumSequenceNumber:this.minimumSequenceNumber},this._quorum.snapshot())}}]),e}());!function(e){e.Tree=1,e.Blob=2,e.Handle=3,e.Attachment=4}(ue||(ue={})),function(e){e.NoOp="noop",e.ClientJoin="join",e.ClientLeave="leave",e.Propose="propose",e.Reject="reject",e.Summarize="summarize",e.SummaryAck="summaryAck",e.SummaryNack="summaryNack",e.Operation="op",e.RemoteHelp="remoteHelp",e.NoClient="noClient",e.RoundTrip="tripComplete",e.Control="control"}(ce||(ce={})),function(e){e.ThrottlingError="ThrottlingError",e.InvalidScopeError="InvalidScopeError",e.BadRequestError="BadRequestError",e.LimitExceededError="LimitExceededError"}(le||(le={}));var he,fe=n(99025),pe=n(65059),ve=n(27866),ge=function(e){(0,a.Z)(n,e);var t=(0,s.Z)(n);function n(){var e;return(0,i.Z)(this,n),(e=t.apply(this,arguments)).members=new Map,e}return(0,o.Z)(n,[{key:"on",value:function(e,t){return(0,Q.Z)((0,Y.Z)(n.prototype),"on",this).call(this,e,t)}},{key:"addMember",value:function(e,t){this.members.set(e,t),this.emit("addMember",e,t)}},{key:"removeMember",value:function(e){var t=this.members.get(e);return void 0!==t&&(this.members.delete(e),this.emit("removeMember",e,t),!0)}},{key:"getMembers",value:function(){return new Map(this.members)}},{key:"getMember",value:function(e){return this.members.get(e)}},{key:"clear",value:function(){var e,t=this.members.keys(),n=(0,w.Z)(t);try{for(n.s();!(e=n.n()).done;){var r=e.value;this.removeMember(r)}}catch(i){n.e(i)}finally{n.f()}}}]),n}(X.EventEmitter),me=function(e){function t(e){(0,i.Z)(this,t),this.execute=e}return(0,o.Z)(t,[{key:e,get:function(){return this.getPromise()[Symbol.toStringTag]}},{key:"then",value:function(){var e=(0,d.Z)((0,l.Z)().mark((function e(t,n){var r,i=arguments;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(r=this.getPromise()).then.apply(r,i));case 1:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"catch",value:function(){var e=(0,d.Z)((0,l.Z)().mark((function e(t){var n,r=arguments;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(n=this.getPromise()).catch.apply(n,r));case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"finally",value:function(){var e=(0,d.Z)((0,l.Z)().mark((function e(t){var n,r=arguments;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(n=this.getPromise()).finally.apply(n,r));case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getPromise",value:function(){var e=(0,d.Z)((0,l.Z)().mark((function e(){return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return void 0===this.result&&(this.result=this.execute()),e.abrupt("return",this.result);case 2:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),t}(Symbol.toStringTag),ye=function(){function e(t,n,r,o,a,s,u,c,h,f,p,v,g,m,y){var b=this;(0,i.Z)(this,e),this.container=t,this.scope=n,this.codeLoader=r,this._codeDetails=o,this._baseSnapshot=a,this.deltaManager=s,this.loader=c,this.submitFn=h,this.submitSignalFn=f,this.closeFn=p,this.version=v,this.updateDirtyContainerState=g,this.existing=m,this.pendingLocalState=y,this._disposed=!1,this._quorum=u,this.taggedLogger=t.subLogger,this._fluidModuleP=new me((0,d.Z)((0,l.Z)().mark((function e(){return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",b.loadCodeModule(o));case 1:case"end":return e.stop()}}),e)})))),this.attachListener()}return(0,o.Z)(e,[{key:"clientId",get:function(){return this.container.clientId}},{key:"id",get:function(){var e=this.container.resolvedUrl;return y(e)?e.id:""}},{key:"clientDetails",get:function(){return this.container.clientDetails}},{key:"connected",get:function(){return this.container.connected}},{key:"canSummarize",get:function(){return"summarize"in this.runtime}},{key:"serviceConfiguration",get:function(){return this.container.serviceConfiguration}},{key:"audience",get:function(){return this.container.audience}},{key:"options",get:function(){return this.container.options}},{key:"baseSnapshot",get:function(){return this._baseSnapshot}},{key:"storage",get:function(){return this.container.storage}},{key:"runtime",get:function(){if(void 0===this._runtime)throw new Error("Attempted to access runtime before it was defined");return this._runtime}},{key:"disposed",get:function(){return this._disposed}},{key:"codeDetails",get:function(){return this._codeDetails}},{key:"quorum",get:function(){return this._quorum}},{key:"getSpecifiedCodeDetails",value:function(){var e;return null!==(e=this._quorum.get("code"))&&void 0!==e?e:this._quorum.get("code2")}},{key:"dispose",value:function(e){this._disposed||(this._disposed=!0,this.runtime.dispose(e),this._quorum.dispose(),this.deltaManager.dispose())}},{key:"getLoadedFromVersion",value:function(){return this.container.loadedFromVersion}},{key:"attachState",get:function(){return this.container.attachState}},{key:"createSummary",value:function(e){return this.runtime.createSummary(e)}},{key:"setConnectionState",value:function(e,t){var n=this.runtime;P(e===this.connected,222),n.setConnectionState(e,t)}},{key:"process",value:function(e,t,n){this.runtime.process(e,t,n)}},{key:"processSignal",value:function(e,t){this.runtime.processSignal(e,t)}},{key:"request",value:function(){var e=(0,d.Z)((0,l.Z)().mark((function e(t){return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.runtime.request(t));case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getAbsoluteUrl",value:function(){var e=(0,d.Z)((0,l.Z)().mark((function e(t){return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.container.getAbsoluteUrl(t));case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getPendingLocalState",value:function(){return this.runtime.getPendingLocalState()}},{key:"satisfies",value:function(){var e=(0,d.Z)((0,l.Z)().mark((function e(t){var n,r,i,o,a,s,u,c;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=[],void 0!==(i=this.codeLoader).IFluidCodeDetailsComparer&&r.push(i.IFluidCodeDetailsComparer),e.next=5,this._fluidModuleP;case 5:if(o=e.sent,void 0!==(null===(a=null===(n=o.module)||void 0===n?void 0:n.fluidExport)||void 0===a?void 0:a.IFluidCodeDetailsComparer)&&r.push(a.IFluidCodeDetailsComparer),0!==r.length){e.next=10;break}return e.abrupt("return",!1);case 10:s=0,u=r;case 11:if(!(s<u.length)){e.next=21;break}return c=u[s],e.next=15,c.satisfies(o.details,t);case 15:if(!1!==e.sent){e.next=18;break}return e.abrupt("return",!1);case 18:s++,e.next=11;break;case 21:return e.abrupt("return",!0);case 22:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"notifyAttaching",value:function(e){var t,n;this._baseSnapshot=e,null===(n=(t=this.runtime).notifyAttaching)||void 0===n||n.call(t,e),this.runtime.setAttachState(h.mB.Attaching)}},{key:"getRuntimeFactory",value:function(){var e=(0,d.Z)((0,l.Z)().mark((function e(){var t,n,r;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._fluidModuleP;case 2:if(e.t1=t=e.sent.module,e.t0=null===e.t1,e.t0){e.next=6;break}e.t0=void 0===t;case 6:if(!e.t0){e.next=10;break}e.t2=void 0,e.next=11;break;case 10:e.t2=t.fluidExport;case 11:if(n=e.t2,void 0!==(r=null===n||void 0===n?void 0:n.IRuntimeFactory)){e.next=15;break}throw new Error("Code package does not implement IRuntimeFactory");case 15:return e.abrupt("return",r);case 16:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"instantiateRuntime",value:function(){var e=(0,d.Z)((0,l.Z)().mark((function e(t){var n;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getRuntimeFactory();case 2:return n=e.sent,e.next=5,n.instantiateRuntime(this,t);case 5:this._runtime=e.sent;case 6:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"attachListener",value:function(){var e=this;this.container.once("attached",(function(){e.runtime.setAttachState(h.mB.Attached)}))}},{key:"loadCodeModule",value:function(){var e=(0,d.Z)((0,l.Z)().mark((function e(t){var n,r,i,o=this;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,m.Xr.timedExecAsync(this.taggedLogger,{eventName:"CodeLoad"},(0,d.Z)((0,l.Z)().mark((function e(){return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",o.codeLoader.load(t));case 1:case"end":return e.stop()}}),e)}))));case 2:if(!("module"in(n=e.sent))){e.next=8;break}return r=n.module,i=n.details,e.abrupt("return",{module:r,details:null!==i&&void 0!==i?i:t});case 8:return this.taggedLogger.sendTelemetryEvent({eventName:"LegacyCodeLoader"}),e.abrupt("return",n);case 10:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}],[{key:"createOrLoad",value:function(){var t=(0,d.Z)((0,l.Z)().mark((function t(n,r,i,o,a,s,u,c,d,h,f,p,v,g,m){var y;return(0,l.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return y=new e(n,r,i,o,a,s,u,c,d,h,f,p,v,g,m),t.next=3,y.instantiateRuntime(g);case 3:return t.abrupt("return",y);case 4:case"end":return t.stop()}}),t)})));return function(e,n,r,i,o,a,s,u,c,l,d,h,f,p,v){return t.apply(this,arguments)}}()}]),e}();!function(e){e.Never="Never",e.Disabled="Disabled",e.Enabled="Enabled"}(he||(he={}));var be=n(35935),we=n.n(be),Se=function(e){(0,a.Z)(n,e);var t=(0,s.Z)(n);function n(){var e,r,o,a,s,u,c,l;return(0,i.Z)(this,n),(l=t.call(this)).addListener=(0,Q.Z)((e=(0,ne.Z)(l),(0,Y.Z)(n.prototype)),"addListener",e).bind((0,ne.Z)(l)),l.on=(0,Q.Z)((r=(0,ne.Z)(l),(0,Y.Z)(n.prototype)),"on",r).bind((0,ne.Z)(l)),l.once=(0,Q.Z)((o=(0,ne.Z)(l),(0,Y.Z)(n.prototype)),"once",o).bind((0,ne.Z)(l)),l.prependListener=(0,Q.Z)((a=(0,ne.Z)(l),(0,Y.Z)(n.prototype)),"prependListener",a).bind((0,ne.Z)(l)),l.prependOnceListener=(0,Q.Z)((s=(0,ne.Z)(l),(0,Y.Z)(n.prototype)),"prependOnceListener",s).bind((0,ne.Z)(l)),l.removeListener=(0,Q.Z)((u=(0,ne.Z)(l),(0,Y.Z)(n.prototype)),"removeListener",u).bind((0,ne.Z)(l)),l.off=(0,Q.Z)((c=(0,ne.Z)(l),(0,Y.Z)(n.prototype)),"off",c).bind((0,ne.Z)(l)),l}return(0,o.Z)(n)}(X.EventEmitter),ke=n(58375),Ce=n(63133),xe=n.n(Ce),Ee=function(e){(0,a.Z)(n,e);var t=(0,s.Z)(n);function n(e){var r;return(0,i.Z)(this,n),(r=t.call(this)).worker=e,r.isDisposed=!1,r.q=new(xe()),r.pauseCount=1,r}return(0,o.Z)(n,[{key:"disposed",get:function(){return this.isDisposed}},{key:"paused",get:function(){return 0!==this.pauseCount}},{key:"length",get:function(){return this.q.length}},{key:"idle",get:function(){return void 0===this.processingPromise&&0===this.q.length}},{key:"waitTillProcessingDone",value:function(){var e=(0,d.Z)((0,l.Z)().mark((function e(){var t;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",null!==(t=this.processingPromise)&&void 0!==t?t:{count:0,duration:0});case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"dispose",value:function(){throw new Error("Not implemented.")}},{key:"clear",value:function(){this.q.clear()}},{key:"peek",value:function(){return this.q.peekFront()}},{key:"toArray",value:function(){return this.q.toArray()}},{key:"push",value:function(e){try{this.q.push(e),this.emit("push",e),this.ensureProcessing()}catch(t){this.emit("error",t)}}},{key:"pause",value:function(){var e=(0,d.Z)((0,l.Z)().mark((function e(){return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.pauseCount++,e.next=3,this.waitTillProcessingDone();case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"resume",value:function(){P(this.pauseCount>0,244),this.pauseCount--,this.ensureProcessing()}},{key:"ensureProcessing",value:function(){var e=this;this.anythingToProcess()&&void 0===this.processingPromise&&(this.processingPromise=Promise.resolve().then((function(){P(void 0!==e.processingPromise,"reentrancy?");var t=e.processDeltas();return P(void 0!==e.processingPromise,"reentrancy?"),e.processingPromise=void 0,t})).catch((function(t){return e.error=t,e.processingPromise=void 0,e.emit("error",t),{count:0,duration:0}})),P(void 0!==this.processingPromise,"processDeltas() should run async"))}},{key:"anythingToProcess",value:function(){return 0!==this.q.length&&!this.paused&&void 0===this.error}},{key:"processDeltas",value:function(){for(var e=_.now(),t=0;this.anythingToProcess();){var n=this.q.shift();t++,this.worker(n),this.emit("op",n)}var r=_.now()-e;return 0===this.q.length&&this.emit("idle",t,r),{count:t,duration:r}}}]),n}(Se),Te=function(e){(0,a.Z)(n,e);var t=(0,s.Z)(n);function n(e,r,o,a){var s;(0,i.Z)(this,n),(s=t.call(this)).serviceProvider=e,s.logger=r,s._active=o,s.pending=[],s.minSequenceNumber=0,s.lastQueuedSequenceNumber=0,s.lastObservedSeqNumber=0,s.lastProcessedSequenceNumber=0,s.baseTerm=0,s.opsSize=0,s.initSequenceNumber=0,s.closed=!1,s.throttlingIdSet=new Set,s.timeTillThrottling=0,s.closeAbortController=new(we()),s.deltaStorageDelayId=(0,f.Z)(),s.deltaStreamDelayId=(0,f.Z)(),s.messageBuffer=[];var u={incomingOpHandler:function(e,t){try{s.enqueueMessages(e,t)}catch(n){s.logger.sendErrorEvent({eventName:"EnqueueMessages_Exception"},n),s.close((0,pe.SC)(n))}},signalHandler:function(e){return s._inboundSignal.push(e)},reconnectionDelayHandler:function(e,t){return s.emitDelayInfo(s.deltaStreamDelayId,e,t)},closeHandler:function(e){return s.close(e)},disconnectHandler:function(e){return s.disconnectHandler(e)},connectHandler:function(e){return s.connectHandler(e)},pongHandler:function(e){return s.emit("pong",e)},readonlyChangeHandler:function(e){return(0,fe.Eb)((0,ne.Z)(s),s.logger,"readonly",e)}};return s.connectionManager=a(u),s._inbound=new Ee((function(e){s.processInboundMessage(e)})),s._inbound.on("error",(function(e){s.close(F.Hi.wrapIfUnrecognized(e,"deltaManagerInboundErrorHandler",s.lastMessage))})),s._inboundSignal=new Ee((function(e){if(void 0===s.handler)throw new Error("Attempted to process an inbound signal without a handler attached");s.handler.processSignal({clientId:e.clientId,content:JSON.parse(e.content)})})),s._inboundSignal.on("error",(function(e){s.close((0,pe.SC)(e))})),s}return(0,o.Z)(n,[{key:"active",get:function(){return this._active()}},{key:"disposed",get:function(){return this.closed}},{key:"IDeltaSender",get:function(){return this}},{key:"inbound",get:function(){return this._inbound}},{key:"inboundSignal",get:function(){return this._inboundSignal}},{key:"initialSequenceNumber",get:function(){return this.initSequenceNumber}},{key:"lastSequenceNumber",get:function(){return this.lastProcessedSequenceNumber}},{key:"lastMessage",get:function(){return this.lastProcessedMessage}},{key:"lastKnownSeqNumber",get:function(){return this.lastObservedSeqNumber}},{key:"referenceTerm",get:function(){return this.baseTerm}},{key:"minimumSequenceNumber",get:function(){return this.minSequenceNumber}},{key:"hasCheckpointSequenceNumber",get:function(){return P(this.connectionManager.connected,223),void 0!==this._checkpointSequenceNumber}},{key:"maxMessageSize",get:function(){return this.connectionManager.maxMessageSize}},{key:"version",get:function(){return this.connectionManager.version}},{key:"serviceConfiguration",get:function(){return this.connectionManager.serviceConfiguration}},{key:"outbound",get:function(){return this.connectionManager.outbound}},{key:"readOnlyInfo",get:function(){return this.connectionManager.readOnlyInfo}},{key:"clientDetails",get:function(){return this.connectionManager.clientDetails}},{key:"submit",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3?arguments[3]:void 0,i={contents:JSON.stringify(t),metadata:r,referenceSequenceNumber:this.lastProcessedSequenceNumber,type:e};n||this.flush();var o=this.connectionManager.prepareMessageToSend(i);return void 0===o?-1:(this.opsSize+=o.contents.length,this.messageBuffer.push(o),this.emit("submitOp",o),n||this.flush(),o.clientSequenceNumber)}},{key:"submitSignal",value:function(e){return this.connectionManager.submitSignal(e)}},{key:"flush",value:function(){0!==this.messageBuffer.length&&(this.emit("prepareSend",this.messageBuffer),this.connectionManager.sendMessages(this.messageBuffer),this.messageBuffer=[])}},{key:"connectionProps",get:function(){return Object.assign({sequenceNumber:this.lastSequenceNumber,opsSize:this.opsSize>0?this.opsSize:void 0},this.connectionManager.connectionProps)}},{key:"logConnectionIssue",value:function(e){var t;P(this.connectionManager.connected,568);var n=this.pending.sort((function(e,t){return e.sequenceNumber-t.sequenceNumber}));this.logger.sendErrorEvent(Object.assign(Object.assign(Object.assign(Object.assign({},e),{fetchReason:this.fetchReason,lastQueuedSequenceNumber:this.lastQueuedSequenceNumber,lastProcessedSequenceNumber:this.lastProcessedSequenceNumber,lastObserved:this.lastObservedSeqNumber}),this.connectionManager.connectionVerboseProps),{pendingOps:this.pending.length,pendingFirst:null===(t=n[0])||void 0===t?void 0:t.sequenceNumber,haveHandler:void 0!==this.handler,inboundLength:this.inbound.length,inboundPaused:this.inbound.paused}))}},{key:"connectHandler",value:function(e){this.refreshDelayInfo(this.deltaStreamDelayId);var t=this.connectionManager.connectionVerboseProps;t.connectionLastQueuedSequenceNumber=this.lastQueuedSequenceNumber,t.connectionLastObservedSeqNumber=this.lastObservedSeqNumber;var n=e.checkpointSequenceNumber;this._checkpointSequenceNumber=n,void 0!==n&&this.updateLatestKnownOpSeqNumber(n),P(0===this.messageBuffer.length,233),this.opsSize=0,this.emit("connect",e,void 0!==n?this.lastObservedSeqNumber-this.lastSequenceNumber:void 0),void 0!==n?n>this.lastQueuedSequenceNumber&&this.fetchMissingDeltas("AfterConnection"):"read"===e.mode&&this.fetchMissingDeltas("AfterReadConnection")}},{key:"dispose",value:function(){throw new Error("Not implemented.")}},{key:"attachOpHandler",value:function(){var e=(0,d.Z)((0,l.Z)().mark((function e(t,n,r,i){var o,a,s=arguments;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(o=s.length>4&&void 0!==s[4]?s[4]:"none",this.initSequenceNumber=n,this.lastProcessedSequenceNumber=n,this.baseTerm=r,this.minSequenceNumber=t,this.lastQueuedSequenceNumber=n,this.lastObservedSeqNumber=n,P(void 0===this.handler,226),this.handler=i,P(!!this.handler,227),P(void 0===this.fetchReason,616),!this.closed){e.next=13;break}return e.abrupt("return");case 13:if(this._inbound.resume(),this._inboundSignal.resume(),"none"===o){e.next=20;break}return a="cached"===o,e.next=19,this.fetchMissingDeltasCore("DocumentOpen_".concat(o),a);case 19:a&&this.fetchMissingDeltas("PostDocumentOpen");case 20:P(void 0!==this.fetchReason||0===this.pending.length,617);case 21:case"end":return e.stop()}}),e,this)})));return function(t,n,r,i){return e.apply(this,arguments)}}()},{key:"connect",value:function(e){var t,n=null===(t=e.fetchOpsFromStorage)||void 0===t||t;(0,ke.M)(void 0!==this.handler||!n,this.logger,"CantFetchWithoutBaseline"),n&&this.fetchMissingDeltas(e.reason),this.connectionManager.connect(e.mode)}},{key:"getDeltas",value:function(){var e=(0,d.Z)((0,l.Z)().mark((function e(t,n,r,i,o){var a,s,u,c,d,h,f,p,v=this;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0!==(a=this.serviceProvider())){e.next=3;break}throw new Error("Delta manager is not attached");case 3:if(void 0!==this.deltaStorage){e.next=7;break}return e.next=6,a.connectToDeltaStorage();case 6:this.deltaStorage=e.sent;case 7:if(void 0===n){e.next=15;break}if(u=n-1,!(this.lastQueuedSequenceNumber>=u)){e.next=12;break}return this.logger.sendPerformanceEvent(Object.assign({reason:r,eventName:"ExtraStorageCall",early:!0,from:t,to:n},this.connectionManager.connectionVerboseProps)),e.abrupt("return");case 12:s=function(e){return e.sequenceNumber>=u},e.next=16;break;case 15:s=function(e){return e.sequenceNumber>=v.lastObservedSeqNumber};case 16:c=new(we()),d=!1,h=function e(t){P(t.sequenceNumber===v.lastQueuedSequenceNumber,570),!d&&s(t)&&(c.abort(),v._inbound.off("push",e))},e.prev=19,this._inbound.on("push",h),P(null===this.closeAbortController.signal.onabort,488),this.closeAbortController.signal.onabort=function(){return c.abort()},f=this.deltaStorage.fetchMessages(t,n,c.signal,o,r);case 24:return e.next=27,f.read();case 27:if(!(p=e.sent).done){e.next=30;break}return e.abrupt("break",33);case 30:try{d=!0,i(p.value)}finally{d=!1}e.next=24;break;case 33:return e.prev=33,this.closeAbortController.signal.onabort=null,this._inbound.off("push",h),P(!d,649),e.finish(33);case 38:case"end":return e.stop()}}),e,this,[[19,,33,38]])})));return function(t,n,r,i,o){return e.apply(this,arguments)}}()},{key:"close",value:function(e){this.closed||(this.closed=!0,this.connectionManager.dispose(e),this.closeAbortController.abort(),this._inbound.clear(),this._inboundSignal.clear(),this._inbound.pause(),this._inboundSignal.pause(),this.pending=[],this.emit("closed",e),this.removeAllListeners())}},{key:"refreshDelayInfo",value:function(e){this.throttlingIdSet.delete(e),0===this.throttlingIdSet.size&&(this.timeTillThrottling=0)}},{key:"disconnectHandler",value:function(e){this.messageBuffer.length=0,this.emit("disconnect",e)}},{key:"emitDelayInfo",value:function(e,t,n){var r=Date.now();if(this.throttlingIdSet.add(e),t>0&&r+t>this.timeTillThrottling){this.timeTillThrottling=r+t;var i=F.FQ.wrap(n,t/1e3,this.logger);this.emit("throttled",i)}}},{key:"comparableMessagePayload",value:function(e){return"".concat(e.clientId,"-").concat(e.type,"-").concat(e.minimumSequenceNumber,"-").concat(e.referenceSequenceNumber,"-").concat(e.timestamp)}},{key:"enqueueMessages",value:function(e,t){var n,r,i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(void 0!==this.handler){if(P(0===this.pending.length||void 0!==this.fetchReason,489),0!==e.length){var o=e[0].sequenceNumber,a=e[e.length-1].sequenceNumber;if(a>this.lastQueuedSequenceNumber){var s,u,c,l=o-1,d=l-this.lastQueuedSequenceNumber,h=0,f=0,p=(0,w.Z)(e);try{for(p.s();!(u=p.n()).done;){var v=u.value;v.sequenceNumber===l?h++:v.sequenceNumber!==l+1&&(f++,void 0===s&&(s=l+1)),l=v.sequenceNumber}}catch(x){p.e(x)}finally{p.f()}0!==h||0!==f&&!i||d>0&&void 0===this.fetchReason?c="enqueueMessages":void 0!==this.fetchReason&&this.fetchReason!==t&&o<=this.lastQueuedSequenceNumber+1&&a>this.lastQueuedSequenceNumber&&(c="enqueueMessagesExtraFetch"),void 0!==c&&this.logger.sendPerformanceEvent(Object.assign({eventName:c,reason:t,previousReason:this.prevEnqueueMessagesReason,from:o,to:a+1,length:e.length,fetchReason:this.fetchReason,duplicate:h>0?h:void 0,initialGap:0!==d?d:void 0,gap:f>0?f:void 0,firstMissing:s,dmInitialSeqNumber:this.initialSequenceNumber},this.connectionManager.connectionVerboseProps))}this.updateLatestKnownOpSeqNumber(e[e.length-1].sequenceNumber);var g=null===(n=this.previouslyProcessedMessage)||void 0===n?void 0:n.sequenceNumber;P(void 0===g||g===this.lastQueuedSequenceNumber,236);var m,y=(0,w.Z)(e);try{for(y.s();!(m=y.n()).done;){var b=m.value;if(b.sequenceNumber<=this.lastQueuedSequenceNumber){if((null===(r=this.previouslyProcessedMessage)||void 0===r?void 0:r.sequenceNumber)===b.sequenceNumber){var S=this.comparableMessagePayload(this.previouslyProcessedMessage),k=this.comparableMessagePayload(b);if(S!==k){var C=new U.V2("Found two messages with the same sequenceNumber but different payloads. Likely to be a service issue",j.C.fileOverwrittenInStorage,{clientId:this.connectionManager.clientId,sequenceNumber:b.sequenceNumber,message1:S,message2:k,driverVersion:void 0});this.close(C)}}}else b.sequenceNumber!==this.lastQueuedSequenceNumber+1?(this.pending.push(b),this.fetchMissingDeltas(t,b.sequenceNumber)):(this.lastQueuedSequenceNumber=b.sequenceNumber,this.previouslyProcessedMessage=b,this._inbound.push(b))}}catch(x){y.e(x)}finally{y.f()}this.prevEnqueueMessagesReason=this.pending.length>0?"unknown":t}}else this.pending=this.pending.concat(e)}},{key:"processInboundMessage",value:function(e){var t=Date.now();if(this.lastProcessedMessage=e,P(void 0!==e.clientId||!(0,J.ag)(e),237),"string"===typeof e.contents&&""!==e.contents&&e.type!==ce.ClientLeave&&(e.contents=JSON.parse(e.contents)),this.connectionManager.beforeProcessingIncomingOp(e),this.minSequenceNumber>e.minimumSequenceNumber)throw new F.Jd("Found a lower minimumSequenceNumber (msn) than previously recorded",Object.assign(Object.assign({},(0,F.HN)(e)),{clientId:this.connectionManager.clientId}));if(this.minSequenceNumber=e.minimumSequenceNumber,e.sequenceNumber!==this.lastProcessedSequenceNumber+1)throw new F.Jd("Found a non-Sequential sequenceNumber",Object.assign(Object.assign({},(0,F.HN)(e)),{clientId:this.connectionManager.clientId}));if(this.lastProcessedSequenceNumber=e.sequenceNumber,P(this.lastProcessedSequenceNumber<=this.lastObservedSeqNumber,615),void 0===e.term&&(e.term=1),this.baseTerm=e.term,void 0===this.handler)throw new Error("Attempted to process an inbound message without a handler attached");this.handler.process(e);var n=Date.now();this.emit("op",e,n-t)}},{key:"fetchMissingDeltas",value:function(e,t){var n=this;this.fetchMissingDeltasCore(e,!1,t).catch((function(e){n.logger.sendErrorEvent({eventName:"fetchMissingDeltasException"},e)}))}},{key:"fetchMissingDeltasCore",value:function(){var e=(0,d.Z)((0,l.Z)().mark((function e(t,n,r){var i,o,a,s,u=this;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0===this.fetchReason){e.next=2;break}return e.abrupt("return");case 2:if(!this.closed){e.next=5;break}return this.logger.sendTelemetryEvent({eventName:"fetchMissingDeltasClosedConnection",reason:t}),e.abrupt("return");case 5:if(void 0!==this.handler){e.next=8;break}return P(0===this.lastQueuedSequenceNumber,619),e.abrupt("return");case 8:return e.prev=8,o=this.lastQueuedSequenceNumber+1,void 0!==(a=null===(i=this.previouslyProcessedMessage)||void 0===i?void 0:i.sequenceNumber)&&(P(a===this.lastQueuedSequenceNumber,242),P(o>1,243),o--),s="".concat(t,"_fetch"),this.fetchReason=s,e.next=16,this.getDeltas(o,r,s,(function(e){u.refreshDelayInfo(u.deltaStorageDelayId),u.enqueueMessages(e,s)}),n);case 16:e.next=22;break;case 18:e.prev=18,e.t0=e.catch(8),this.logger.sendErrorEvent({eventName:"GetDeltas_Exception"},e.t0),this.close((0,pe.SC)(e.t0));case 22:return e.prev=22,this.refreshDelayInfo(this.deltaStorageDelayId),this.fetchReason=void 0,this.processPendingOps(t),e.finish(22);case 27:case"end":return e.stop()}}),e,this,[[8,18,22,27]])})));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"processPendingOps",value:function(e){if(!this.closed){P(void 0!==this.handler,620);var t=this.pending.sort((function(e,t){return e.sequenceNumber-t.sequenceNumber}));this.pending=[],this.enqueueMessages(t,"".concat(e,"_pending"),!0),void 0===this.fetchReason&&this.lastQueuedSequenceNumber<this.lastObservedSeqNumber&&this.fetchMissingDeltas("OpsBehind")}}},{key:"updateLatestKnownOpSeqNumber",value:function(e){this.lastObservedSeqNumber<e&&(this.lastObservedSeqNumber=e)}}]),n}(Se),Ie=function(e){(0,a.Z)(n,e);var t=(0,s.Z)(n);function n(e){var r;if((0,i.Z)(this,n),(r=t.call(this)).isDisposed=!1,r.forwardingEvents=new Map,void 0!==e){r.on(n.removeListenerEvent,(function(t){return r.unforwardEvent(e,t)})),r.on(n.newListenerEvent,(function(t){return r.forwardEvent(e,t)}))}return r}return(0,o.Z)(n,[{key:"disposed",get:function(){return this.isDisposed}},{key:"dispose",value:function(){this.isDisposed=!0;var e,t=(0,w.Z)(this.forwardingEvents.values());try{for(t.s();!(e=t.n()).done;){var n,r=e.value,i=(0,w.Z)(r.values());try{for(i.s();!(n=i.n()).done;){var o=n.value;try{o()}catch(a){}}}catch(s){i.e(s)}finally{i.f()}}}catch(s){t.e(s)}finally{t.f()}this.removeAllListeners(),this.forwardingEvents.clear()}},{key:"forwardEvent",value:function(e){for(var t=this,r=arguments.length,i=new Array(r>1?r-1:0),o=1;o<r;o++)i[o-1]=arguments[o];for(var a=function(){var r=u[s];if(void 0!==e&&void 0!==r&&!n.isEmitterEvent(r)){var i=t.forwardingEvents.get(r);if(void 0===i&&(i=new Map,t.forwardingEvents.set(r,i)),!i.has(e)){var o=function(){for(var e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];return t.emit.apply(t,[r].concat(n))};i.set(e,(function(){return e.off(r,o)})),e.on(r,o)}}},s=0,u=i;s<u.length;s++)a()}},{key:"unforwardEvent",value:function(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),i=1;i<t;i++)r[i-1]=arguments[i];for(var o=0,a=r;o<a.length;o++){var s=a[o];if(void 0!==s&&!n.isEmitterEvent(s)){var u=this.forwardingEvents.get(s);if((null===u||void 0===u?void 0:u.has(e))&&0===this.listenerCount(s)){var c=u.get(e);void 0!==c&&c(),u.delete(e),0===u.size&&this.forwardingEvents.delete(s)}}}}}],[{key:"isEmitterEvent",value:function(e){return e===n.newListenerEvent||e===n.removeListenerEvent}}]),n}(Se);Ie.newListenerEvent="newListener",Ie.removeListenerEvent="removeListener";var Ae=function(e){(0,a.Z)(n,e);var t=(0,s.Z)(n);function n(e){var r;return(0,i.Z)(this,n),(r=t.call(this,e)).queue=e,r}return(0,o.Z)(n,[{key:"paused",get:function(){return this.queue.paused}},{key:"length",get:function(){return this.queue.length}},{key:"idle",get:function(){return this.queue.idle}},{key:"peek",value:function(){return this.queue.peek()}},{key:"toArray",value:function(){return this.queue.toArray()}},{key:"systemPause",value:function(){var e=(0,d.Z)((0,l.Z)().mark((function e(){return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.pause());case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"pause",value:function(){var e=(0,d.Z)((0,l.Z)().mark((function e(){return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.queue.pause());case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"systemResume",value:function(){var e=(0,d.Z)((0,l.Z)().mark((function e(){return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.resume());case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"resume",value:function(){var e=(0,d.Z)((0,l.Z)().mark((function e(){return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.queue.resume();case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"waitTillProcessingDone",value:function(){var e=(0,d.Z)((0,l.Z)().mark((function e(){return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.queue.waitTillProcessingDone());case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),n}(Ie),Re=function(e){(0,a.Z)(n,e);var t=(0,s.Z)(n);function n(e){var r;return(0,i.Z)(this,n),(r=t.call(this,e)).deltaManager=e,r.inbound=new Ae(e.inbound),r.outbound=new Ae(e.outbound),r.inboundSignal=new Ae(e.inboundSignal),r}return(0,o.Z)(n,[{key:"IDeltaSender",get:function(){return this}},{key:"minimumSequenceNumber",get:function(){return this.deltaManager.minimumSequenceNumber}},{key:"lastSequenceNumber",get:function(){return this.deltaManager.lastSequenceNumber}},{key:"lastMessage",get:function(){return this.deltaManager.lastMessage}},{key:"lastKnownSeqNumber",get:function(){return this.deltaManager.lastKnownSeqNumber}},{key:"initialSequenceNumber",get:function(){return this.deltaManager.initialSequenceNumber}},{key:"hasCheckpointSequenceNumber",get:function(){return this.deltaManager.hasCheckpointSequenceNumber}},{key:"clientDetails",get:function(){return this.deltaManager.clientDetails}},{key:"version",get:function(){return this.deltaManager.version}},{key:"maxMessageSize",get:function(){return this.deltaManager.maxMessageSize}},{key:"serviceConfiguration",get:function(){return this.deltaManager.serviceConfiguration}},{key:"active",get:function(){return this.deltaManager.active}},{key:"readOnlyInfo",get:function(){return this.deltaManager.readOnlyInfo}},{key:"dispose",value:function(){this.inbound.dispose(),this.outbound.dispose(),this.inboundSignal.dispose(),(0,Q.Z)((0,Y.Z)(n.prototype),"dispose",this).call(this)}},{key:"submitSignal",value:function(e){return this.deltaManager.submitSignal(e)}},{key:"flush",value:function(){return this.deltaManager.flush()}}]),n}(Ie),_e="1.3.6",Pe=function(){function e(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(){return Date.now()};(0,i.Z)(this,e),this.defaultTimeout=t,this.defaultHandler=n,this.getCurrentTick=r}return(0,o.Z)(e,[{key:"hasTimer",get:function(){return!!this.runningState}},{key:"start",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.defaultTimeout,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.defaultHandler;this.startCore(e,t,e)}},{key:"clear",value:function(){this.runningState&&(clearTimeout(this.runningState.timeout),this.runningState=void 0)}},{key:"restart",value:function(e,t){var n,r;if(this.runningState){var i=null!==e&&void 0!==e?e:this.runningState.intendedDuration,o=null!==(r=null!==t&&void 0!==t?t:null===(n=this.runningState.restart)||void 0===n?void 0:n.handler)&&void 0!==r?r:this.runningState.handler,a=this.calculateRemainingTime(this.runningState);i<a?this.start(i,o):i===a?(this.runningState.handler=o,this.runningState.restart=void 0,this.runningState.intendedDuration=i):this.runningState.restart={startTick:this.getCurrentTick(),duration:i,handler:o}}else this.start(e,t)}},{key:"startCore",value:function(e,t,n){var r=this;this.clear(),this.runningState={startTick:this.getCurrentTick(),duration:e,intendedDuration:n,handler:t,timeout:setTimeout((function(){return r.handler()}),e)}}},{key:"handler",value:function(){P(!!this.runningState,10);var e=this.runningState.restart;if(void 0!==e){var t=this.calculateRemainingTime(e);this.startCore(t,(function(){return e.handler()}),e.duration)}else{var n=this.runningState.handler;this.clear(),n()}}},{key:"calculateRemainingTime",value:function(e){var t=this.getCurrentTick()-e.startTick;return e.duration-t}}]),e}(),Ne=n(13093),Oe=function(){function e(t,n,r){var o,a=this;(0,i.Z)(this,e),this.handler=t,this.logger=n,this._clientId=r,this._connectionState=Ne.e.Disconnected,this.prevClientLeftTimer=new Pe(null!==(o=this.handler.maxClientLeaveWaitTime)&&void 0!==o?o:3e5,(function(){P(!a.connected,684),a.applyForConnectedState("timeout")})),this.joinOpTimer=new Pe(45e3,(function(){var e;if(a.connectionState===Ne.e.CatchingUp){var t=a.handler.quorumClients(),n={quorumInitialized:void 0!==t,hasPendingClientId:void 0!==a.pendingClientId,inQuorum:void 0!==(null===t||void 0===t?void 0:t.getMember(null!==(e=a.pendingClientId)&&void 0!==e?e:"")),waitingForLeaveOp:a.waitingForLeaveOp};a.handler.logConnectionIssue("NoJoinOp",n)}}))}return(0,o.Z)(e,[{key:"connectionState",get:function(){return this._connectionState}},{key:"connected",get:function(){return this.connectionState===Ne.e.Connected}},{key:"clientId",get:function(){return this._clientId}},{key:"pendingClientId",get:function(){return this._pendingClientId}},{key:"startJoinOpTimer",value:function(){P(!this.joinOpTimer.hasTimer,564),this.joinOpTimer.start()}},{key:"stopJoinOpTimer",value:function(){P(this.joinOpTimer.hasTimer,565),this.joinOpTimer.clear()}},{key:"waitingForLeaveOp",get:function(){return this.prevClientLeftTimer.hasTimer}},{key:"dispose",value:function(){P(!this.joinOpTimer.hasTimer,677),this.prevClientLeftTimer.clear()}},{key:"containerSaved",value:function(){this.waitingForLeaveOp&&(this.prevClientLeftTimer.clear(),this.applyForConnectedState("containerSaved"))}},{key:"receivedAddMemberEvent",value:function(e){e===this.pendingClientId&&(this.joinOpTimer.hasTimer?this.stopJoinOpTimer():this.handler.logConnectionIssue("ReceivedJoinOp"),this.waitingForLeaveOp&&(this.waitEvent=m.Xr.start(this.logger,{eventName:"WaitBeforeClientLeave",details:JSON.stringify({waitOnClientId:this._clientId,hadOutstandingOps:this.handler.shouldClientJoinWrite()})})),this.applyForConnectedState("addMemberEvent"))}},{key:"applyForConnectedState",value:function(e){var t,n,r=this.handler.quorumClients();P(void 0!==r,566),P(!1===this.waitingForLeaveOp||void 0!==this.clientId&&void 0!==r.getMember(this.clientId),738),this.pendingClientId===this.clientId||void 0===this.pendingClientId||void 0===r.getMember(this.pendingClientId)||this.waitingForLeaveOp?this.logger.sendTelemetryEvent({eventName:"connectedStateRejected",category:"timeout"===e?"error":"generic",details:JSON.stringify({source:e,pendingClientId:this.pendingClientId,clientId:this.clientId,waitingForLeaveOp:this.waitingForLeaveOp,inQuorum:void 0!==(null===r||void 0===r?void 0:r.getMember(null!==(n=this.pendingClientId)&&void 0!==n?n:""))})}):(null===(t=this.waitEvent)||void 0===t||t.end({source:e}),this.setConnectionState(Ne.e.Connected))}},{key:"receivedRemoveMemberEvent",value:function(e){this.clientId===e&&(this.prevClientLeftTimer.clear(),this.applyForConnectedState("removeMemberEvent"))}},{key:"receivedDisconnectEvent",value:function(e){this.joinOpTimer.hasTimer&&this.stopJoinOpTimer(),this.setConnectionState(Ne.e.Disconnected,e)}},{key:"receivedConnectEvent",value:function(e,t){var n=this._connectionState;this._connectionState=Ne.e.CatchingUp;var r="write"===e;P(r||!this.handler.shouldClientJoinWrite(),778),P(r||!this.waitingForLeaveOp,678);var i=this.handler.quorumClients();this._pendingClientId=t.clientId,this.handler.logConnectionStateChangeTelemetry(Ne.e.CatchingUp,n),r&&void 0===(null===i||void 0===i?void 0:i.getMember(this._pendingClientId))?this.startJoinOpTimer():this.waitingForLeaveOp||this.setConnectionState(Ne.e.Connected)}},{key:"setConnectionState",value:function(e,t){if(this.connectionState!==e){var n=this._connectionState;this._connectionState=e;var r,i=this.handler.quorumClients();void 0!==this._clientId&&(r=null===i||void 0===i?void 0:i.getMember(this._clientId)),e===Ne.e.Connected?(P(n===Ne.e.CatchingUp,472),void 0!==r&&(r.shouldHaveLeft=!0),this._clientId=this.pendingClientId):e===Ne.e.Disconnected&&(this._pendingClientId=void 0,void 0!==r&&this.handler.shouldClientJoinWrite()&&!1===this.prevClientLeftTimer.hasTimer?this.prevClientLeftTimer.restart():this.logger.sendTelemetryEvent({eventName:"noWaitOnDisconnected",details:JSON.stringify({inQuorum:void 0!==r,waitingForLeaveOp:this.waitingForLeaveOp,hadOutstandingOps:this.handler.shouldClientJoinWrite()})})),this.handler.logConnectionStateChangeTelemetry(this._connectionState,n,t),this.handler.connectionStateChanged()}else this.logger.sendErrorEvent({eventName:"setConnectionStateSame",value:e})}},{key:"initProtocol",value:function(e){var t=this;e.quorum.on("addMember",(function(e,n){t.receivedAddMemberEvent(e)})),e.quorum.on("removeMember",(function(e){t.receivedRemoveMemberEvent(e)})),void 0!==this.clientId&&void 0!==e.quorum.getMember(this.clientId)&&this.prevClientLeftTimer.restart()}}]),e}(),Me=function(){function e(t,n){(0,i.Z)(this,e),this.internalStorageService=t,this.logger=n,this._disposed=!1}return(0,o.Z)(e,[{key:"policies",get:function(){return this.internalStorageService.policies}},{key:"disposed",get:function(){return this._disposed}},{key:"dispose",value:function(){this._disposed=!0}},{key:"repositoryUrl",get:function(){return this.internalStorageService.repositoryUrl}},{key:"getSnapshotTree",value:function(){var e=(0,d.Z)((0,l.Z)().mark((function e(t,n){var r=this;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.runWithRetry((0,d.Z)((0,l.Z)().mark((function e(){return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",r.internalStorageService.getSnapshotTree(t,n));case 1:case"end":return e.stop()}}),e)}))),"storage_getSnapshotTree"));case 1:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"readBlob",value:function(){var e=(0,d.Z)((0,l.Z)().mark((function e(t){var n=this;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.runWithRetry((0,d.Z)((0,l.Z)().mark((function e(){return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",n.internalStorageService.readBlob(t));case 1:case"end":return e.stop()}}),e)}))),"storage_readBlob"));case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getVersions",value:function(){var e=(0,d.Z)((0,l.Z)().mark((function e(t,n,r){var i=this;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.runWithRetry((0,d.Z)((0,l.Z)().mark((function e(){return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",i.internalStorageService.getVersions(t,n,r));case 1:case"end":return e.stop()}}),e)}))),"storage_getVersions"));case 1:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"uploadSummaryWithContext",value:function(){var e=(0,d.Z)((0,l.Z)().mark((function e(t,n){var r=this;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(P(0===n.referenceSequenceNumber===(void 0===n.ackHandle),593),0===n.referenceSequenceNumber){e.next=3;break}return e.abrupt("return",this.internalStorageService.uploadSummaryWithContext(t,n));case 3:return e.abrupt("return",this.runWithRetry((0,d.Z)((0,l.Z)().mark((function e(){return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",r.internalStorageService.uploadSummaryWithContext(t,n));case 1:case"end":return e.stop()}}),e)}))),"storage_uploadSummaryWithContext"));case 4:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"downloadSummary",value:function(){var e=(0,d.Z)((0,l.Z)().mark((function e(t){var n=this;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.runWithRetry((0,d.Z)((0,l.Z)().mark((function e(){return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",n.internalStorageService.downloadSummary(t));case 1:case"end":return e.stop()}}),e)}))),"storage_downloadSummary"));case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"createBlob",value:function(){var e=(0,d.Z)((0,l.Z)().mark((function e(t){var n=this;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.runWithRetry((0,d.Z)((0,l.Z)().mark((function e(){return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",n.internalStorageService.createBlob(t));case 1:case"end":return e.stop()}}),e)}))),"storage_createBlob"));case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"checkStorageDisposed",value:function(){if(this._disposed)throw new F.pY("Storage Service is disposed. Cannot retry",{canRetry:!1})}},{key:"runWithRetry",value:function(){var e=(0,d.Z)((0,l.Z)().mark((function e(t,n){var r=this;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",z(t,n,this.logger,{onRetry:function(){return r.checkStorageDisposed()}}));case 1:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()}]),e}(),Fe=function(){function e(t,n){(0,i.Z)(this,e),this.internalStorageService=t,this.generateProtocolTree=n,this.getSnapshotTree=this.internalStorageService.getSnapshotTree.bind(this.internalStorageService),this.getVersions=this.internalStorageService.getVersions.bind(this.internalStorageService),this.createBlob=this.internalStorageService.createBlob.bind(this.internalStorageService),this.readBlob=this.internalStorageService.readBlob.bind(this.internalStorageService),this.downloadSummary=this.internalStorageService.downloadSummary.bind(this.internalStorageService),this.dispose=this.internalStorageService.dispose.bind(this.internalStorageService)}return(0,o.Z)(e,[{key:"policies",get:function(){return this.internalStorageService.policies}},{key:"repositoryUrl",get:function(){return this.internalStorageService.repositoryUrl}},{key:"disposed",get:function(){return this.internalStorageService.disposed}},{key:"uploadSummaryWithContext",value:function(){var e=(0,d.Z)((0,l.Z)().mark((function e(t,n){return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.internalStorageService.uploadSummaryWithContext(Z(t,this.generateProtocolTree()),n));case 1:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()}]),e}(),Ze=function(){function e(t){(0,i.Z)(this,e),this.storageGetter=t,this.blobContents={}}return(0,o.Z)(e,[{key:"loadSnapshotForRehydratingContainer",value:function(e){this.getBlobContents(e)}},{key:"getBlobContents",value:function(e){for(var t=0,n=Object.entries(e.blobsContents);t<n.length;t++){var r=(0,I.Z)(n[t],2),i=r[0],o=r[1];this.blobContents[i]=o}for(var a=0,s=Object.entries(e.trees);a<s.length;a++){var u=(0,I.Z)(s[a],2),c=(u[0],u[1]);this.getBlobContents(c)}}},{key:"policies",get:function(){try{return this.storageGetter().policies}catch(e){}}},{key:"repositoryUrl",get:function(){return this.storageGetter().repositoryUrl}},{key:"getSnapshotTree",value:function(){var e=(0,d.Z)((0,l.Z)().mark((function e(t,n){return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.storageGetter().getSnapshotTree(t,n));case 1:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"readBlob",value:function(){var e=(0,d.Z)((0,l.Z)().mark((function e(t){var n;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0===(n=this.blobContents[t])){e.next=3;break}return e.abrupt("return",n);case 3:return e.abrupt("return",this.storageGetter().readBlob(t));case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getVersions",value:function(){var e=(0,d.Z)((0,l.Z)().mark((function e(t,n,r){return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.storageGetter().getVersions(t,n,r));case 1:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"uploadSummaryWithContext",value:function(){var e=(0,d.Z)((0,l.Z)().mark((function e(t,n){return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.storageGetter().uploadSummaryWithContext(t,n));case 1:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"downloadSummary",value:function(){var e=(0,d.Z)((0,l.Z)().mark((function e(t){return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.storageGetter().downloadSummary(t));case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"createBlob",value:function(){var e=(0,d.Z)((0,l.Z)().mark((function e(t){return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.storageGetter().createBlob(t));case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),e}(),De=function(){function e(t,n){(0,i.Z)(this,e),this.blobStorage=t,this.logger=n,this.getSnapshotTree=this.notCalled,this.getVersions=this.notCalled,this.write=this.notCalled,this.uploadSummaryWithContext=this.notCalled,this.downloadSummary=this.notCalled}return(0,o.Z)(e,[{key:"createBlob",value:function(){var e=(0,d.Z)((0,l.Z)().mark((function e(t){return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.blobStorage.createBlob(t));case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"readBlob",value:function(){var e=(0,d.Z)((0,l.Z)().mark((function e(t){return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.blobStorage.readBlob(t));case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"policies",get:function(){return this.notCalled()}},{key:"repositoryUrl",get:function(){return this.notCalled()}},{key:"notCalled",value:function(){try{throw new Error("BlobOnlyStorage not implemented method used")}catch(e){throw this.logger.sendErrorEvent({eventName:"BlobOnlyStorageWrongCall"},e),e}}}]),e}(),Le=n(28664),Be=n(2009);var qe=function(e,t){return Ue.from(e,t).buffer};function je(e){var t=e;return e instanceof ArrayBuffer||"object"===typeof t&&null!==t&&"number"===typeof t.byteLength&&"function"===typeof t.slice&&void 0===t.byteOffset&&void 0===t.buffer}var Ue=function(e){(0,a.Z)(n,e);var t=(0,s.Z)(n);function n(){return(0,i.Z)(this,n),t.apply(this,arguments)}return(0,o.Z)(n,[{key:"toString",value:function(e){return function(e,t){switch(t){case"base64":return Be.fromByteArray(e);case"utf8":case"utf-8":case void 0:return(new TextDecoder).decode(e);default:throw new Error("invalid/unsupported encoding")}}(this,e)}}],[{key:"from",value:function(e,t,r){if("string"===typeof e)return n.fromString(e,t);if(null!==e&&"object"===typeof e&&je(e.buffer))return P(0===e.byteOffset,0),P(e.byteLength===e.buffer.byteLength,1),n.fromArrayBuffer(e.buffer,t,r);if(je(e))return n.fromArrayBuffer(e,t,r);throw new TypeError}},{key:"fromArrayBuffer",value:function(e,t,r){var i=null!==t&&void 0!==t?t:0,o=null!==r&&void 0!==r?r:e.byteLength-i;if(i<0||i>e.byteLength||o<0||o+i>e.byteLength)throw new RangeError;return new n(e,i,o)}},{key:"fromString",value:function(e,t){switch(t){case"base64":var r=this.sanitizeBase64(e);return new n(Be.toByteArray(r).buffer);case"utf8":case"utf-8":case void 0:return new n((new TextEncoder).encode(e).buffer);default:throw new Error("invalid/unsupported encoding")}}},{key:"isBuffer",value:function(e){throw new Error("unimplemented")}},{key:"sanitizeBase64",value:function(e){var t=e;if((t=(t=t.split("=")[0]).replace(/[^\w+-/]/g,"")).length%4!==0){t+=["","===","==","="][t.length%4]}return t}}]),n}((0,Le.Z)(Uint8Array));function He(e){var t,n=(0,E.Qc)(e,!0);if("string"!==typeof n.pathname)throw new pe.j4("Failed to parse pathname");var r=null!==(t=n.search)&&void 0!==t?t:"",i=/^\/([^/]*\/[^/]*)(\/?.*)$/.exec(n.pathname);return 3===(null===i||void 0===i?void 0:i.length)?{id:i[1],path:i[2],query:r,version:n.query.version}:void 0}function ze(e){for(var t,n={blobs:{},blobsContents:{},trees:{},id:(0,f.Z)(),unreferenced:e.unreferenced},r=0,i=Object.keys(e.tree);r<i.length;r++){var o=i[r],a=e.tree[o];switch(a.type){case ue.Tree:n.trees[o]=ze(a);break;case ue.Attachment:n.blobs[o]=a.id;break;case ue.Blob:var s=(0,f.Z)();n.blobs[o]=s;var u="string"===typeof a.content?qe(a.content,"utf8"):0===(t=a.content).byteOffset&&t.byteLength===t.buffer.byteLength?t.buffer:t.buffer.slice(t.byteOffset,t.byteOffset+t.byteLength);n.blobsContents[s]=u;break;case ue.Handle:throw new pe.j4("No handles should be there in summary in detached container!!");default:N(a,"Unknown tree type ".concat(a.type))}}return n}function Ve(e,t){var n={type:ue.Tree,tree:Object.assign({},t.tree)};return n.tree[".protocol"]=e,ze(n)}var Ge=function(e){var t=e.tree[".protocol"],n=e.tree[".app"];return P(void 0!==t&&void 0!==n,480),Ve(t,n)};function Ke(e){return".protocol"in e.trees?e.trees[".protocol"]:e}function We(e,t){return function(){if(e.disposed)throw new Error("Already disposed");return t.apply(void 0,arguments)}}var Je=function(e){(0,a.Z)(n,e);var t=(0,s.Z)(n);function n(e){var r,o;return(0,i.Z)(this,n),o=t.call(this,e),(0,Q.Z)((r=(0,ne.Z)(o),(0,Y.Z)(n.prototype)),"setMaxListeners",r).call(r,50),o.propose=We((0,ne.Z)(o),e.propose.bind(e)),o.has=We((0,ne.Z)(o),e.has.bind(e)),o.get=We((0,ne.Z)(o),e.get.bind(e)),o.getMembers=We((0,ne.Z)(o),e.getMembers.bind(e)),o.getMember=We((0,ne.Z)(o),e.getMember.bind(e)),o}return(0,o.Z)(n)}(Ie);function Qe(e){var t=new Map(e).get("code");return P(void 0!==t,732),null===t||void 0===t?void 0:t.value}function Ye(e){return[["code",{key:"code",value:e,approvalSequenceNumber:0,commitSequenceNumber:0,sequenceNumber:0}]]}var Xe,$e=function(){function e(t){var n=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2e3,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:50;(0,i.Z)(this,e),this.submit=t,this.NoopCountFrequency=o,this.opsCountSinceNoop=0,r!==1/0&&(this.timer=new Pe(r,(function(){0!==n.opsCountSinceNoop&&n.submitNoop(!1)})))}return(0,o.Z)(e,[{key:"scheduleSequenceNumberUpdate",value:function(e,t){t?this.submitNoop(!0):(0,J.LW)(e)&&(this.opsCountSinceNoop++,this.opsCountSinceNoop>=this.NoopCountFrequency?this.submitNoop(!1):void 0!==this.timer&&(1===this.opsCountSinceNoop&&this.timer.restart(),P(this.timer.hasTimer,578)))}},{key:"submitNoop",value:function(e){this.submit(ce.NoOp,e?"":null),P(0===this.opsCountSinceNoop,579)}},{key:"stopSequenceNumberUpdate",value:function(){this.opsCountSinceNoop=0}}]),e}();function et(e,t,n){var r,i,o=Object.assign({},t),a=n.online;if(o.online="string"===typeof a?a:U.Yz[(0,U.Gg)()],"object"===typeof navigator&&null!==navigator){var s=navigator,u=null!==(i=null!==(r=s.connection)&&void 0!==r?r:s.mozConnection)&&void 0!==i?i:s.webkitConnection;null!==u&&"object"===typeof u&&(o.connectionType=u.type)}o.category=(0,U.ms)(n)?"generic":"error",e.sendTelemetryEvent(o,n)}function tt(e){return new Promise((function(t){var n=t,r=e;(0,U.Gg)()===U.Yz.Offline&&void 0!==(null===window||void 0===window?void 0:window.addEventListener)&&(n=function(){t(),window.removeEventListener("online",n)},window.addEventListener("online",n,!1),r=Math.max(e,3e4)),setTimeout(n,r)}))}!function(e){e.DocRead="doc:read",e.DocWrite="doc:write",e.SummaryWrite="summary:write"}(Xe||(Xe={}));var nt={fatalConnectError:!0};var rt=function(e){(0,a.Z)(n,e);var t=(0,s.Z)(n);function n(){var e;return(0,i.Z)(this,n),(e=t.apply(this,arguments)).clientId="storage-only client",e.claims={scopes:[Xe.DocRead]},e.mode="read",e.existing=!0,e.maxMessageSize=0,e.version="",e.initialMessages=[],e.initialSignals=[],e.initialClients=[],e.serviceConfiguration={maxMessageSize:0,blockSize:0,summary:void 0},e.checkpointSequenceNumber=void 0,e._disposed=!1,e}return(0,o.Z)(n,[{key:"submit",value:function(e){this.emit("nack",this.clientId,e.map((function(e){return{operation:e,content:{message:"Cannot submit with storage-only connection",code:403}}})))}},{key:"submitSignal",value:function(e){this.emit("nack",this.clientId,{operation:e,content:{message:"Cannot submit signal with storage-only connection",code:403}})}},{key:"disposed",get:function(){return this._disposed}},{key:"dispose",value:function(){this._disposed=!0}}]),n}(Se),it=function(){function e(t,n,r,o,a){var s=this;(0,i.Z)(this,e),this.serviceProvider=t,this.client=n,this.logger=o,this.props=a,this._forceReadonly=!1,this.pendingReconnect=!1,this.clientSequenceNumber=0,this.clientSequenceNumberObserved=0,this.trailingNoopCount=0,this.connectFirstConnection=!0,this._connectionVerboseProps={},this._connectionProps={},this.closed=!1,this.opHandler=function(e,t){var n=Array.isArray(t)?t:[t];s.props.incomingOpHandler(n,"opHandler")},this.nackHandler=function(e,t){var n=t[0];if(!0!==s._readonlyPermissions){var r=function(e){var t="Nack (".concat(e.type,"): ").concat(e.message),n=403!==e.code,r=void 0!==e.retryAfter?1e3*e.retryAfter:void 0;return(0,U.jx)(t,{canRetry:n,retryAfterMs:r},{statusCode:e.code,driverVersion:void 0})}(n.content);r.canRetry?s.reconnectOnError("write",r):s.props.closeHandler(r)}else s.props.closeHandler((0,U.j)("writeOnReadOnlyDocument",{driverVersion:void 0}))},this.disconnectHandlerInternal=function(e){s.reconnectOnError(s.defaultReconnectionMode,e)},this.errorHandler=function(e){s.reconnectOnError(s.defaultReconnectionMode,e)},this.clientDetails=this.client.details,this.defaultReconnectionMode=this.client.mode,this._reconnectMode=r?he.Enabled:he.Never,this._outbound=new Ee((function(e){if(void 0===s.connection)throw new Error("Attempted to submit an outbound message without connection");s.connection.submit(e)})),this._outbound.on("error",(function(e){s.props.closeHandler((0,pe.SC)(e))}))}return(0,o.Z)(e,[{key:"connectionVerboseProps",get:function(){return this._connectionVerboseProps}},{key:"connectionMode",get:function(){var e,t;return null!==(t=null===(e=this.connection)||void 0===e?void 0:e.mode)&&void 0!==t?t:"read"}},{key:"connected",get:function(){return void 0!==this.connection}},{key:"clientId",get:function(){var e;return null===(e=this.connection)||void 0===e?void 0:e.clientId}},{key:"reconnectMode",get:function(){return this._reconnectMode}},{key:"maxMessageSize",get:function(){var e,t,n;return null!==(n=null===(t=null===(e=this.connection)||void 0===e?void 0:e.serviceConfiguration)||void 0===t?void 0:t.maxMessageSize)&&void 0!==n?n:16384}},{key:"version",get:function(){if(void 0===this.connection)throw new Error("Cannot check version without a connection");return this.connection.version}},{key:"serviceConfiguration",get:function(){var e;return null===(e=this.connection)||void 0===e?void 0:e.serviceConfiguration}},{key:"scopes",get:function(){var e;return null===(e=this.connection)||void 0===e?void 0:e.claims.scopes}},{key:"outbound",get:function(){return this._outbound}},{key:"connectionProps",get:function(){return void 0!==this.connection?this._connectionProps:Object.assign(Object.assign({},this._connectionProps),{sentOps:this.clientSequenceNumber})}},{key:"shouldJoinWrite",value:function(){return this.clientSequenceNumberObserved<this.clientSequenceNumber-this.trailingNoopCount}},{key:"readonly",get:function(){return!!this._forceReadonly||this._readonlyPermissions}},{key:"readOnlyInfo",get:function(){var e=void 0!==this.connection&&this.connection instanceof rt;return e||this._forceReadonly||!0===this._readonlyPermissions?{readonly:!0,forced:this._forceReadonly,permissions:this._readonlyPermissions,storageOnly:e}:{readonly:this._readonlyPermissions}}},{key:"dispose",value:function(e){if(!this.closed){this.closed=!0,this.pendingConnection=void 0,this._reconnectMode=he.Never,this._outbound.clear();var t=void 0!==e?"Closing DeltaManager (".concat(e.message,")"):"Closing DeltaManager";this.disconnectFromDeltaStream(t),this.set_readonlyPermissions(!0)}}},{key:"setAutoReconnect",value:function(e){P(e!==he.Never&&this._reconnectMode!==he.Never,632),this._reconnectMode=e,e!==he.Enabled&&this.disconnectFromDeltaStream("setAutoReconnect")}},{key:"forceReadonly",value:function(e){e!==this._forceReadonly&&this.logger.sendTelemetryEvent({eventName:"ForceReadOnly",value:e});var t=this.readonly;if(this._forceReadonly=e,t!==this.readonly){if(this._reconnectMode===he.Never)throw new F.Oi("API is not supported for non-connecting or closed container");var n=!1;!0===this.readonly&&(this.shouldJoinWrite()&&this.logger.sendErrorEvent({eventName:"ForceReadonlyPendingChanged"}),n=this.disconnectFromDeltaStream("Force readonly")),this.props.readonlyChangeHandler(this.readonly),n&&this.triggerConnect("read")}}},{key:"set_readonlyPermissions",value:function(e){var t=this.readonly;this._readonlyPermissions=e,t!==this.readonly&&this.props.readonlyChangeHandler(this.readonly)}},{key:"connect",value:function(e){var t=this;this.connectCore(e).catch((function(e){var n=(0,pe.SC)(e,{props:nt});t.props.closeHandler(n)}))}},{key:"connectCore",value:function(){var e=(0,d.Z)((0,l.Z)().mark((function e(t){var n,r,i,o,a,s,u,c,d,h,f,p,v,g;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(P(!this.closed,618),void 0===this.connection){e.next=3;break}return e.abrupt("return");case 3:if(void 0!==this.pendingConnection&&(i=this.pendingConnection.connectionMode,this.cancelConnection(),P(void 0===this.pendingConnection,836)),o=null!==(n=null!==t&&void 0!==t?t:i)&&void 0!==n?n:this.defaultReconnectionMode,this.shouldJoinWrite()&&(o="write"),P(void 0!==(a=this.serviceProvider()),679),!0!==(null===(r=a.policies)||void 0===r?void 0:r.storageOnly)){e.next=13;break}return s=new rt,this.setupNewSuccessfulConnection(s,"read"),P(void 0===this.pendingConnection,691),e.abrupt("return");case 13:u=1e3,c=0,d=_.now(),f=new(we()),p=f.signal,this.pendingConnection={abort:function(){f.abort()},connectionMode:o};case 19:if(void 0!==s){e.next=53;break}if(!this.closed){e.next=22;break}throw new Error("Attempting to connect a closed DeltaManager");case 22:if(!0!==p.aborted){e.next=25;break}return this.logger.sendTelemetryEvent({eventName:"ConnectionAttemptCancelled",attempts:c,duration:m.hy.formatTick(_.now()-d),connectionEstablished:!1}),e.abrupt("return");case 25:return c++,e.prev=26,this.client.mode=o,e.next=30,a.connectToDeltaStream(Object.assign(Object.assign({},this.client),{mode:o}));case 30:(s=e.sent).disposed&&(this.logger.sendTelemetryEvent({eventName:"ReceivedClosedConnection"}),s=void 0),e.next=51;break;case 34:if(e.prev=34,e.t0=e.catch(26),"object"!==typeof e.t0||null===e.t0||(null===e.t0||void 0===e.t0?void 0:e.t0.errorType)!==U.y7.errorType){e.next=40;break}return s=new rt,o="read",e.abrupt("break",53);case 40:if((0,U.ms)(e.t0)){e.next=44;break}throw v=(0,pe.SC)(e.t0,{props:nt}),this.props.closeHandler(v),v;case 44:return et(this.logger,{attempts:c,delay:u,eventName:"DeltaConnectionFailureToConnect",duration:m.hy.formatTick(_.now()-d)},e.t0),h=e.t0,g=(0,U.ZZ)(e.t0),u=null!==g&&void 0!==g?g:Math.min(2*u,8e3),void 0!==g&&this.props.reconnectionDelayHandler(g,e.t0),e.next=51,tt(u);case 51:e.next=19;break;case 53:if(c>1&&et(this.logger,{eventName:"MultipleDeltaConnectionFailures",attempts:c,duration:m.hy.formatTick(_.now()-d)},h),!0!==p.aborted){e.next=58;break}return s.dispose(),this.logger.sendTelemetryEvent({eventName:"ConnectionAttemptCancelled",attempts:c,duration:m.hy.formatTick(_.now()-d),connectionEstablished:!0}),e.abrupt("return");case 58:this.setupNewSuccessfulConnection(s,o);case 59:case"end":return e.stop()}}),e,this,[[26,34]])})));return function(t){return e.apply(this,arguments)}}()},{key:"triggerConnect",value:function(e){P(void 0===this.connection,569),this.reconnectMode===he.Enabled&&this.connect(e)}},{key:"disconnectFromDeltaStream",value:function(e){if(this.pendingReconnect=!1,void 0===this.connection)return void 0!==this.pendingConnection&&(this.cancelConnection(),!0);P(void 0===this.pendingConnection,635);var t=this.connection;return this.connection=void 0,t.off("op",this.opHandler),t.off("signal",this.props.signalHandler),t.off("nack",this.nackHandler),t.off("disconnect",this.disconnectHandlerInternal),t.off("error",this.errorHandler),t.off("pong",this.props.pongHandler),this._outbound.pause(),this._outbound.clear(),this.props.disconnectHandler(e),t.dispose(),this._connectionVerboseProps={},!0}},{key:"cancelConnection",value:function(){P(void 0!==this.pendingConnection,837),this.pendingConnection.abort(),this.pendingConnection=void 0,this.logger.sendTelemetryEvent({eventName:"ConnectionCancelReceived"})}},{key:"setupNewSuccessfulConnection",value:function(t,n){P(void 0===this.connection,230),P(!t.disposed,650),this.pendingConnection=void 0,this.connection=t;var r=!t.claims.scopes.includes(Xe.DocWrite);if(P("read"===n||r===("read"===this.connectionMode),231),P(!r||"read"===this.connectionMode,232),this.set_readonlyPermissions(r),this.closed)this.disconnectFromDeltaStream("ConnectionManager already closed");else{this._outbound.resume(),t.on("op",this.opHandler),t.on("signal",this.props.signalHandler),t.on("nack",this.nackHandler),t.on("disconnect",this.disconnectHandlerInternal),t.on("error",this.errorHandler),t.on("pong",this.props.pongHandler);var i=t.initialMessages.sort((function(e,t){return e.sequenceNumber-t.sequenceNumber})),o=t.checkpointSequenceNumber;this._connectionVerboseProps={clientId:t.clientId,mode:t.mode},this._connectionProps={},void 0!==t.relayServiceAgent&&(this._connectionVerboseProps.relayServiceAgent=t.relayServiceAgent,this._connectionProps.relayServiceAgent=t.relayServiceAgent),this._connectionProps.socketDocumentId=t.claims.documentId,this._connectionProps.connectionMode=t.mode;var a=-1;if(0!==i.length&&(this._connectionVerboseProps.connectionInitialOpsFrom=i[0].sequenceNumber,a=i[i.length-1].sequenceNumber,this._connectionVerboseProps.connectionInitialOpsTo=a+1,(void 0===o||o<a)&&(o=a)),this.props.incomingOpHandler(i,this.connectFirstConnection?"InitialOps":"ReconnectOps"),void 0!==t.initialSignals){var s,u=(0,w.Z)(t.initialSignals);try{for(u.s();!(s=u.n()).done;){var c=s.value;this.props.signalHandler(c)}}catch(d){u.e(d)}finally{u.f()}}var l=e.detailsFromConnection(t);l.checkpointSequenceNumber=o,this.props.connectHandler(l),this.connectFirstConnection=!1}}},{key:"reconnectOnError",value:function(e,t){this.reconnect(e,t.message,t).catch(this.props.closeHandler)}},{key:"reconnect",value:function(){var e=(0,d.Z)((0,l.Z)().mark((function e(t,n,r){var i;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(P(void 0!==this.connection,235),this.disconnectFromDeltaStream(n),void 0===r||r.canRetry||this.logger.sendTelemetryEvent({eventName:"reconnectingDespiteFatalError",reconnectMode:this.reconnectMode},r),this.reconnectMode===he.Never&&this.props.closeHandler(),!this.closed&&this.reconnectMode===he.Enabled){e.next=6;break}return e.abrupt("return");case 6:if(i=(0,U.ZZ)(r),void 0===r||void 0===i){e.next=11;break}return this.props.reconnectionDelayHandler(i,r),e.next=11,tt(i);case 11:this.triggerConnect(t);case 12:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"prepareMessageToSend",value:function(e){var t,n;if(!0!==this.readonly)return P(!!this.connection,228),this.lastSubmittedClientId!==(null===(t=this.connection)||void 0===t?void 0:t.clientId)&&(this.lastSubmittedClientId=null===(n=this.connection)||void 0===n?void 0:n.clientId,this.clientSequenceNumber=0,this.clientSequenceNumberObserved=0),e.type===ce.NoOp?this.trailingNoopCount++:this.trailingNoopCount=0,Object.assign(Object.assign({},e),{clientSequenceNumber:++this.clientSequenceNumber});P(!0===this.readOnlyInfo.readonly,496);var r=new F.pY("deltaManagerReadonlySubmit",void 0,{readonly:this.readOnlyInfo.readonly,forcedReadonly:this.readOnlyInfo.forced,readonlyPermissions:this.readOnlyInfo.permissions,storageOnly:this.readOnlyInfo.storageOnly});this.props.closeHandler(r)}},{key:"submitSignal",value:function(e){void 0!==this.connection?this.connection.submitSignal(e):this.logger.sendErrorEvent({eventName:"submitSignalDisconnected"})}},{key:"sendMessages",value:function(e){var t=this;P(this.connected,692),"read"!==this.connectionMode?(P(!this.pendingReconnect,693),this._outbound.push(e)):this.pendingReconnect||(this.pendingReconnect=!0,Promise.resolve().then((0,d.Z)((0,l.Z)().mark((function e(){return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.pendingReconnect){e.next=3;break}return e.next=3,t.reconnect("write","Switch to write");case 3:case"end":return e.stop()}}),e)})))).catch((function(){})))}},{key:"beforeProcessingIncomingOp",value:function(e){var t=this;if(P(this.clientId!==e.clientId||this.lastSubmittedClientId===e.clientId,238),void 0!==this.lastSubmittedClientId&&this.lastSubmittedClientId===e.clientId){var n=e.clientSequenceNumber;P(this.clientSequenceNumberObserved<n,239),P(n<=this.clientSequenceNumber,240),this.clientSequenceNumberObserved=n}if(e.type===ce.ClientLeave){var r=e;JSON.parse(r.data)===this.clientId&&(this.logger.sendPerformanceEvent({eventName:"ReadConnectionTransition"}),this.reconnect("read","Switch to read").catch((function(e){t.logger.sendErrorEvent({eventName:"SwitchToReadConnection"},e)})))}}}],[{key:"detailsFromConnection",value:function(e){return{claims:e.claims,clientId:e.clientId,existing:e.existing,checkpointSequenceNumber:e.checkpointSequenceNumber,get initialClients(){return e.initialClients},mode:e.mode,serviceConfiguration:e.serviceConfiguration,version:e.version}}}]),e}(),ot="dirty",at="saved";function st(e,t,n){return ut.apply(this,arguments)}function ut(){return(ut=(0,d.Z)((0,l.Z)().mark((function e(t,n,r){var i,o;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=m.Xr.start(t,{eventName:n}),e.next=3,r();case 3:o=e.sent,i.duration>1e3&&i.end(o);case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var ct="summarizer",lt=function(e){(0,a.Z)(n,e);var t=(0,s.Z)(n);function n(e,r){var o,a,s;(0,i.Z)(this,n),(o=t.call(this,(function(e,t){o.mc.logger.sendErrorEvent({eventName:"ContainerEventHandlerException",name:"string"===typeof e?e:void 0},t)}))).loader=e,o._canReconnect=!0,o._lifecycleState="loading",o._attachState=h.mB.Detached,o.inboundQueuePausedFromInit=!0,o.firstConnection=!0,o.connectionTransitionTimes=[],o.messageCountAfterDisconnection=0,o.attachStarted=!1,o._dirtyContainer=!1,o.setAutoReconnectTime=_.now(),o._audience=new ge,o.clientDetailsOverride=r.clientDetailsOverride,o._resolvedUrl=r.resolvedUrl,void 0!==r.canReconnect&&(o._canReconnect=r.canReconnect);var u=o.client.details.type,c=o.client.details.capabilities.interactive,l="".concat(c?"interactive":"noninteractive").concat(void 0!==u&&""!==u?"/".concat(u):"");o.subLogger=m.G2.create(e.services.subLogger,void 0,{all:{clientType:l,containerId:(0,f.Z)(),docId:function(){var e,t;return null!==(t=null===(e=o._resolvedUrl)||void 0===e?void 0:e.id)&&void 0!==t?t:void 0},containerAttachState:function(){return o._attachState},containerLifecycleState:function(){return o._lifecycleState},containerConnectionState:function(){return Ne.e[o.connectionState]},serializedContainer:void 0!==r.serializedContainerState},error:{dmInitialSeqNumber:function(){var e;return null===(e=o._deltaManager)||void 0===e?void 0:e.initialSequenceNumber},dmLastProcessedSeqNumber:function(){var e;return null===(e=o._deltaManager)||void 0===e?void 0:e.lastSequenceNumber},dmLastKnownSeqNumber:function(){var e;return null===(e=o._deltaManager)||void 0===e?void 0:e.lastKnownSeqNumber},containerLoadedFromVersionId:function(){var e;return null===(e=o.loadedFromVersion)||void 0===e?void 0:e.id},containerLoadedFromVersionDate:function(){var e;return null===(e=o.loadedFromVersion)||void 0===e?void 0:e.date},dmLastMsqSeqNumber:function(){var e,t;return null===(t=null===(e=o.deltaManager)||void 0===e?void 0:e.lastMessage)||void 0===t?void 0:t.sequenceNumber},dmLastMsqSeqTimestamp:function(){var e,t;return null===(t=null===(e=o.deltaManager)||void 0===e?void 0:e.lastMessage)||void 0===t?void 0:t.timestamp},dmLastMsqSeqClientId:function(){var e,t;return null===(t=null===(e=o.deltaManager)||void 0===e?void 0:e.lastMessage)||void 0===t?void 0:t.clientId},connectionStateDuration:function(){return _.now()-o.connectionTransitionTimes[o.connectionState]}}}),o.mc=(0,v.rZ)(m.G2.create(o.subLogger,"Container"));var d=null!==(a=o.mc.config.getBoolean("Fluid.Container.summarizeProtocolTree"))&&void 0!==a?a:o.loader.services.options.summarizeProtocolTree;return o.options=Object.assign(Object.assign({},o.loader.services.options),{summarizeProtocolTree:d}),o.connectionStateHandler=new Oe({quorumClients:function(){var e;return null===(e=o._protocolHandler)||void 0===e?void 0:e.quorum},logConnectionStateChangeTelemetry:function(e,t,n){return o.logConnectionStateChangeTelemetry(e,t,n)},shouldClientJoinWrite:function(){return o._deltaManager.connectionManager.shouldJoinWrite()},maxClientLeaveWaitTime:o.loader.services.options.maxClientLeaveWaitTime,logConnectionIssue:function(e,t){o._deltaManager.logConnectionIssue(Object.assign({eventName:e,duration:_.now()-o.connectionTransitionTimes[Ne.e.CatchingUp]},void 0===t?{}:{details:JSON.stringify(t)}))},connectionStateChanged:function(){"loaded"===o._lifecycleState&&o.propagateConnectionState()}},o.mc.logger,null===(s=r.serializedContainerState)||void 0===s?void 0:s.clientId),o.on(at,(function(){o.connectionStateHandler.containerSaved()})),o._deltaManager=o.createDeltaManager(),o._storage=new Ze((function(){if(o.attachState!==h.mB.Attached){if(void 0!==o.loader.services.detachedBlobStorage)return new De(o.loader.services.detachedBlobStorage,o.mc.logger);throw o.mc.logger.sendErrorEvent({eventName:"NoRealStorageInDetachedContainer"}),new Error("Real storage calls not allowed in Unattached container")}return o.storageService})),"object"===typeof document&&null!==document&&"function"===typeof document.addEventListener&&null!==document.addEventListener&&(o.lastVisible=document.hidden?_.now():void 0,o.visibilityEventHandler=function(){document.hidden?o.lastVisible=_.now():setTimeout((function(){o.lastVisible=void 0}),0)},document.addEventListener("visibilitychange",o.visibilityEventHandler)),o.on("newListener",(function(e,t){Promise.resolve().then((function(){switch(e){case ot:o._dirtyContainer&&t();break;case at:o._dirtyContainer||t();break;case fe.tZ:o.connected&&t(o.clientId);break;case fe.h$:o.connected||t()}})).catch((function(e){o.mc.logger.sendErrorEvent({eventName:"RaiseConnectedEventError"},e)}))})),o}return(0,o.Z)(n,[{key:"setLoaded",value:function(){"loading"===this._lifecycleState&&(this.propagateConnectionState(),this._lifecycleState="loaded")}},{key:"closed",get:function(){return"closing"===this._lifecycleState||"closed"===this._lifecycleState}},{key:"storage",get:function(){return this._storage}},{key:"storageService",get:function(){if(void 0===this._storageService)throw new Error("Attempted to access storageService before it was defined");return this._storageService}},{key:"context",get:function(){if(void 0===this._context)throw new F.pY("Attempted to access context before it was defined");return this._context}},{key:"protocolHandler",get:function(){if(void 0===this._protocolHandler)throw new Error("Attempted to access protocolHandler before it was defined");return this._protocolHandler}},{key:"connectionMode",get:function(){return this._deltaManager.connectionManager.connectionMode}},{key:"IFluidRouter",get:function(){return this}},{key:"resolvedUrl",get:function(){return this._resolvedUrl}},{key:"loadedFromVersion",get:function(){return this._loadedFromVersion}},{key:"readOnlyInfo",get:function(){return this._deltaManager.readOnlyInfo}},{key:"closeSignal",get:function(){return this._deltaManager.closeAbortController.signal}},{key:"forceReadonly",value:function(e){this._deltaManager.connectionManager.forceReadonly(e)}},{key:"deltaManager",get:function(){return this._deltaManager}},{key:"connectionState",get:function(){return this.connectionStateHandler.connectionState}},{key:"connected",get:function(){return this.connectionStateHandler.connected}},{key:"serviceConfiguration",get:function(){return this._deltaManager.serviceConfiguration}},{key:"clientId",get:function(){return this.connectionStateHandler.clientId}},{key:"scopes",get:function(){return this._deltaManager.connectionManager.scopes}},{key:"clientDetails",get:function(){return this._deltaManager.clientDetails}},{key:"getSpecifiedCodeDetails",value:function(){return this.getCodeDetailsFromQuorum()}},{key:"getLoadedCodeDetails",value:function(){var e;return null===(e=this._context)||void 0===e?void 0:e.codeDetails}},{key:"audience",get:function(){return this._audience}},{key:"isDirty",get:function(){return this._dirtyContainer}},{key:"serviceFactory",get:function(){return this.loader.services.documentServiceFactory}},{key:"urlResolver",get:function(){return this.loader.services.urlResolver}},{key:"scope",get:function(){return this.loader.services.scope}},{key:"codeLoader",get:function(){return this.loader.services.codeLoader}},{key:"getQuorum",value:function(){return this.protocolHandler.quorum}},{key:"close",value:function(e){this._deltaManager.close(e),P(this.connectionState===Ne.e.Disconnected,207),P("closed"===this._lifecycleState,788)}},{key:"closeCore",value:function(e){var t,n,r,i;P(!this.closed,789);try{try{this.mc.logger.sendTelemetryEvent({eventName:"ContainerClose",category:void 0===e?"generic":"error"},e),this._lifecycleState="closing",null===(t=this._protocolHandler)||void 0===t||t.close(),this.connectionStateHandler.dispose(),null===(n=this._context)||void 0===n||n.dispose(void 0!==e?new Error(e.message):void 0),null===(r=this._storageService)||void 0===r||r.dispose(),null===(i=this.service)||void 0===i||i.dispose(e)}catch(o){this.mc.logger.sendErrorEvent({eventName:"ContainerCloseException"},o)}this.emit("closed",e),this.removeAllListeners(),void 0!==this.visibilityEventHandler&&document.removeEventListener("visibilitychange",this.visibilityEventHandler)}finally{this._lifecycleState="closed"}}},{key:"closeAndGetPendingLocalState",value:function(){P(this.attachState===h.mB.Attached,209),P(void 0!==this.resolvedUrl&&"fluid"===this.resolvedUrl.type,210),P(!!this._protocolHandler,739),P(void 0!==this._protocolHandler.attributes.term,779);var e={pendingRuntimeState:this.context.getPendingLocalState(),url:this.resolvedUrl.url,protocol:this.protocolHandler.getProtocolState(),term:this._protocolHandler.attributes.term,clientId:this.clientId};return this.close(),JSON.stringify(e)}},{key:"attachState",get:function(){return this._attachState}},{key:"serialize",value:function(){P(this.attachState===h.mB.Detached,211);var e=Z(this.context.createSummary(),this.captureProtocolSummary());return this.loader.services.detachedBlobStorage&&this.loader.services.detachedBlobStorage.size>0&&(e.tree[".hasAttachmentBlobs"]={type:ue.Blob,content:"true"}),JSON.stringify(e)}},{key:"attach",value:function(){var e=(0,d.Z)((0,l.Z)().mark((function e(t){var n=this;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,m.Xr.timedExecAsync(this.mc.logger,{eventName:"Attach"},(0,d.Z)((0,l.Z)().mark((function e(){var r,i,o,a,s,u,c,f,p,v,g,m,S,k,C,x,E;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("loaded"===n._lifecycleState){e.next=2;break}throw new F.Oi("The Container is not in a valid state for attach [".concat(n._lifecycleState,"]"));case 2:return P(n._attachState===h.mB.Detached&&!n.attachStarted,517),n.attachStarted=!0,r=void 0!==n.loader.services.detachedBlobStorage&&n.loader.services.detachedBlobStorage.size>0,e.prev=5,P(0===n.deltaManager.inbound.length,214),r||(o=n.context.createSummary(),a=n.captureProtocolSummary(),i=Z(o,a),n._attachState=h.mB.Attaching,n.context.notifyAttaching(Ge(i))),e.next=10,n.urlResolver.resolve(t);case 10:if(b(s=e.sent),void 0!==n.service){e.next=17;break}return P(n.client.details.type!==ct,708),e.next=16,z((0,d.Z)((0,l.Z)().mark((function e(){return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",n.serviceFactory.createContainer(i,s,n.subLogger,!1));case 1:case"end":return e.stop()}}),e)}))),"containerAttach",n.mc.logger,{cancel:n.closeSignal});case 16:n.service=e.sent;case 17:return b(u=n.service.resolvedUrl),n._resolvedUrl=u,e.next=22,n.connectStorageService();case 22:if(!r){e.next=58;break}P(!!n.loader.services.detachedBlobStorage,590),c=new Map;case 25:if(!(c.size<n.loader.services.detachedBlobStorage.size)){e.next=51;break}f=n.loader.services.detachedBlobStorage.getBlobIds().filter((function(e){return!c.has(e)})),p=(0,w.Z)(f),e.prev=28,p.s();case 30:if((v=p.n()).done){e.next=41;break}return g=v.value,e.next=34,n.loader.services.detachedBlobStorage.readBlob(g);case 34:return m=e.sent,e.next=37,n.storageService.createBlob(m);case 37:S=e.sent,c.set(g,S.id);case 39:e.next=30;break;case 41:e.next=46;break;case 43:e.prev=43,e.t0=e.catch(28),p.e(e.t0);case 46:return e.prev=46,p.f(),e.finish(46);case 49:e.next=25;break;case 51:return k=n.context.createSummary(c),C=n.captureProtocolSummary(),i=Z(k,C),n._attachState=h.mB.Attaching,n.context.notifyAttaching(Ge(i)),e.next=58,n.storageService.uploadSummaryWithContext(i,{referenceSequenceNumber:0,ackHandle:void 0,proposalHandle:void 0});case 58:n._attachState=h.mB.Attached,n.emit("attached"),n.propagateConnectionState(),n.closed||n.resumeInternal({fetchOpsFromStorage:!1,reason:"createDetached"}),e.next=71;break;case 64:throw e.prev=64,e.t1=e.catch(5),x=(0,pe.SC)(e.t1),E=n.resolvedUrl,y(E)&&x.addTelemetryProperties({resolvedUrl:E.url}),n.close(x),x;case 71:case"end":return e.stop()}}),e,null,[[5,64],[28,43,46,49]])}))),{start:!0,end:!0,cancel:"generic"});case 2:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"request",value:function(){var e=(0,d.Z)((0,l.Z)().mark((function e(t){var n=this;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",m.Xr.timedExecAsync(this.mc.logger,{eventName:"Request"},(0,d.Z)((0,l.Z)().mark((function e(){return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",n.context.request(t));case 1:case"end":return e.stop()}}),e)}))),{end:!0,cancel:"error"}));case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"setAutoReconnectInternal",value:function(e){if(this._deltaManager.connectionManager.reconnectMode!==e){var t=_.now(),n=t-this.setAutoReconnectTime;this.setAutoReconnectTime=t,this.mc.logger.sendTelemetryEvent({eventName:e===he.Enabled?"AutoReconnectEnabled":"AutoReconnectDisabled",connectionMode:this.connectionMode,connectionState:Ne.e[this.connectionState],duration:n}),this._deltaManager.connectionManager.setAutoReconnect(e)}}},{key:"connect",value:function(){if(this.closed)throw new F.Oi("The Container is closed and cannot be connected");if(this._attachState!==h.mB.Attached)throw new F.Oi("The Container is not attached and cannot be connected");this.connected||this.connectInternal({reason:"DocumentConnect",fetchOpsFromStorage:!1})}},{key:"connectInternal",value:function(e){P(!this.closed,709),P(this._attachState===h.mB.Attached,710),this.resumeInternal(e);var t=he.Enabled;this.setAutoReconnectInternal(t)}},{key:"disconnect",value:function(){if(this.closed)throw new F.Oi("The Container is closed and cannot be disconnected");this.disconnectInternal()}},{key:"disconnectInternal",value:function(){P(!this.closed,711);var e=he.Disabled;this.setAutoReconnectInternal(e)}},{key:"resumeInternal",value:function(e){P(!this.closed,217),this.inboundQueuePausedFromInit&&(this.inboundQueuePausedFromInit=!1,this._deltaManager.inbound.resume(),this._deltaManager.inboundSignal.resume()),this.connectToDeltaStream(e)}},{key:"getAbsoluteUrl",value:function(){var e=(0,d.Z)((0,l.Z)().mark((function e(t){var n;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0!==this.resolvedUrl){e.next=2;break}return e.abrupt("return",void 0);case 2:return e.abrupt("return",this.urlResolver.getAbsoluteUrl(this.resolvedUrl,t,{name:(r=null===(n=this._context)||void 0===n?void 0:n.codeDetails)&&"name"in r?r:(0,M.s2)(null===r||void 0===r?void 0:r.package)?null===r||void 0===r?void 0:r.package.name:null===r||void 0===r?void 0:r.package}));case 3:case"end":return e.stop()}var r}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"proposeCodeDetails",value:function(){var e=(0,d.Z)((0,l.Z)().mark((function e(t){var n;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((0,M.Tr)(t)){e.next=2;break}throw new Error("Provided codeDetails are not IFluidCodeDetails");case 2:if(!this.codeLoader.IFluidCodeDetailsComparer){e.next=8;break}return e.next=5,this.codeLoader.IFluidCodeDetailsComparer.compare(t,this.getCodeDetailsFromQuorum());case 5:if(!(void 0!==(n=e.sent)&&n<=0)){e.next=8;break}throw new Error("Proposed code details should be greater than the current");case 8:return e.abrupt("return",this.protocolHandler.quorum.propose("code",t).then((function(){return!0})).catch((function(){return!1})));case 9:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"processCodeProposal",value:function(){var e=(0,d.Z)((0,l.Z)().mark((function e(){var t;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.getCodeDetailsFromQuorum(),e.next=3,Promise.all([this.deltaManager.inbound.pause(),this.deltaManager.inboundSignal.pause()]);case 3:return e.next=5,this.context.satisfies(t);case 5:if(e.t0=e.sent,!0!==e.t0){e.next=10;break}return this.deltaManager.inbound.resume(),this.deltaManager.inboundSignal.resume(),e.abrupt("return");case 10:this.close(new F.pY("Existing context does not satisfy incoming proposal"));case 11:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getVersion",value:function(){var e=(0,d.Z)((0,l.Z)().mark((function e(t){var n;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.storageService.getVersions(t,1);case 2:return n=e.sent,e.abrupt("return",n[0]);case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"recordConnectStartTime",value:function(){void 0===this.connectionTransitionTimes[Ne.e.Disconnected]&&(this.connectionTransitionTimes[Ne.e.Disconnected]=_.now())}},{key:"connectToDeltaStream",value:function(e){this.recordConnectStartTime(),this._canReconnect&&this.client.details.capabilities.interactive||(e.mode="write"),this._deltaManager.connect(e)}},{key:"load",value:function(){var e=(0,d.Z)((0,l.Z)().mark((function e(t,n,r){var i,o,a,s,u,c,f,p=this;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0!==this._resolvedUrl){e.next=2;break}throw new Error("Attempting to load without a resolved url");case 2:return e.next=4,this.serviceFactory.createDocumentService(this._resolvedUrl,this.subLogger,this.client.details.type===ct);case 4:if(this.service=e.sent,i={reason:"DocumentOpen",mode:"write",fetchOpsFromStorage:!1},void 0===n.deltaConnection&&this.connectToDeltaStream(i),r){e.next=12;break}return e.next=10,this.connectStorageService();case 10:e.next=13;break;case 12:this.connectStorageService().catch((function(e){return p.close(e)}));case 13:if(this._attachState=h.mB.Attached,void 0!==r){e.next=20;break}return e.next=17,this.fetchSnapshotTree(t);case 17:e.t0=e.sent,e.next=21;break;case 20:e.t0={snapshot:void 0,versionId:void 0};case 21:if(o=e.t0,a=o.snapshot,s=o.versionId,P(void 0!==a||void 0!==r,567),void 0!==r){e.next=31;break}return e.next=28,this.getDocumentAttributes(this.storageService,a);case 28:e.t1=e.sent,e.next=32;break;case 31:e.t1={sequenceNumber:r.protocol.sequenceNumber,minimumSequenceNumber:r.protocol.minimumSequenceNumber,term:r.term};case 32:u=e.t1,e.t2=n.opsBeforeReturn,e.next=void 0===e.t2?36:"cached"===e.t2?38:"all"===e.t2?40:42;break;case 36:return this.attachDeltaManagerOpHandler(u,"none"!==n.deltaConnection?"all":"none"),e.abrupt("break",43);case 38:return c=this.attachDeltaManagerOpHandler(u,"cached"),e.abrupt("break",43);case 40:return c=this.attachDeltaManagerOpHandler(u,"all"),e.abrupt("break",43);case 42:N(n.opsBeforeReturn);case 43:if(void 0!==r){e.next=49;break}return e.next=46,this.initializeProtocolStateFromSnapshot(u,this.storageService,a);case 46:e.t3=e.sent,e.next=52;break;case 49:return e.next=51,this.initializeProtocolState(u,r.protocol.members,r.protocol.proposals,r.protocol.values);case 51:e.t3=e.sent;case 52:return this._protocolHandler=e.t3,f=this.getCodeDetailsFromQuorum(),e.next=56,this.instantiateContext(!0,f,a,null===r||void 0===r?void 0:r.pendingRuntimeState);case 56:if(this.closed){e.next=74;break}if(void 0===c){e.next=64;break}return this._deltaManager.inbound.resume(),e.next=61,st(this.mc.logger,"WaitOps",(0,d.Z)((0,l.Z)().mark((function e(){return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,c;case 2:return e.abrupt("return",{});case 3:case"end":return e.stop()}}),e)}))));case 61:return e.next=63,st(this.mc.logger,"WaitOpProcessing",(0,d.Z)((0,l.Z)().mark((function e(){return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",p._deltaManager.inbound.waitTillProcessingDone());case 1:case"end":return e.stop()}}),e)}))));case 63:this._deltaManager.inbound.pause();case 64:e.t4=n.deltaConnection,e.next=void 0===e.t4||"delayed"===e.t4?67:"none"===e.t4?72:73;break;case 67:return P(this.inboundQueuePausedFromInit,838),this.inboundQueuePausedFromInit=!1,this._deltaManager.inbound.resume(),this._deltaManager.inboundSignal.resume(),e.abrupt("break",74);case 72:return e.abrupt("break",74);case 73:N(n.deltaConnection);case 74:if(!this.closed){e.next=76;break}throw new Error("Container was closed while load()");case 76:return this.setLoaded(),e.abrupt("return",{sequenceNumber:u.sequenceNumber,version:s,dmLastProcessedSeqNumber:this._deltaManager.lastSequenceNumber,dmLastKnownSeqNumber:this._deltaManager.lastKnownSeqNumber});case 78:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"createDetached",value:function(){var e=(0,d.Z)((0,l.Z)().mark((function e(t){var n,r;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n={sequenceNumber:0,term:1,minimumSequenceNumber:0},e.next=3,this.attachDeltaManagerOpHandler(n);case 3:return r=Ye(t),e.next=6,this.initializeProtocolState(n,[],[],r);case 6:return this._protocolHandler=e.sent,e.next=9,this.instantiateContextDetached(!1);case 9:this.setLoaded();case 10:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"rehydrateDetachedFromSnapshot",value:function(){var e=(0,d.Z)((0,l.Z)().mark((function e(t){var n,r,i,o,a;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return void 0!==t.tree[".hasAttachmentBlobs"]&&(P(!!this.loader.services.detachedBlobStorage&&this.loader.services.detachedBlobStorage.size>0,592),delete t.tree[".hasAttachmentBlobs"]),n=Ge(t),this._storage.loadSnapshotForRehydratingContainer(n),e.next=5,this.getDocumentAttributes(this._storage,n);case 5:return r=e.sent,e.next=8,this.attachDeltaManagerOpHandler(r);case 8:return i=Ke(n),e.next=11,(0,W.g)(this._storage,i.blobs.quorumValues);case 11:return o=e.sent,a=Qe(o),e.next=15,this.initializeProtocolState(r,[],[],void 0!==a?Ye(a):[]);case 15:return this._protocolHandler=e.sent,e.next=18,this.instantiateContextDetached(!0,n);case 18:this.setLoaded();case 19:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"connectStorageService",value:function(){var e=(0,d.Z)((0,l.Z)().mark((function e(){var t,n,r,i=this;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0===this._storageService){e.next=2;break}return e.abrupt("return");case 2:return P(void 0!==this.service,495),e.next=5,this.service.connectToStorage();case 5:r=e.sent,this._storageService=new Me(r,this.mc.logger),!0===this.options.summarizeProtocolTree&&(this.mc.logger.sendTelemetryEvent({eventName:"summarizeProtocolTreeEnabled"}),this._storageService=new Fe(this._storageService,(function(){return i.captureProtocolSummary()}))),P((null===(t=r.policies)||void 0===t?void 0:t.minBlobSize)===(null===(n=this.storageService.policies)||void 0===n?void 0:n.minBlobSize),224);case 9:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getDocumentAttributes",value:function(){var e=(0,d.Z)((0,l.Z)().mark((function e(t,n){var r,i;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0!==n){e.next=2;break}return e.abrupt("return",{minimumSequenceNumber:0,sequenceNumber:0,term:1});case 2:return r=".protocol"in n.trees?n.trees[".protocol"].blobs.attributes:n.blobs[".attributes"],e.next=5,(0,W.g)(t,r);case 5:return void 0===(i=e.sent).term&&(i.term=1),e.abrupt("return",i);case 8:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"initializeProtocolStateFromSnapshot",value:function(){var e=(0,d.Z)((0,l.Z)().mark((function e(t,n,r){var i,o,a,s,u,c,d;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=[],o=[],a=[],void 0===r){e.next=12;break}return s=Ke(r),e.next=7,Promise.all([(0,W.g)(n,s.blobs.quorumMembers),(0,W.g)(n,s.blobs.quorumProposals),(0,W.g)(n,s.blobs.quorumValues)]);case 7:u=e.sent,c=(0,I.Z)(u,3),i=c[0],o=c[1],a=c[2];case 12:return e.next=14,this.initializeProtocolState(t,i,o,a);case 14:return d=e.sent,e.abrupt("return",d);case 16:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"initializeProtocolState",value:function(){var e=(0,d.Z)((0,l.Z)().mark((function e(t,n,r,i){var o,a,s=this;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=new de(t.minimumSequenceNumber,t.sequenceNumber,t.term,n,r,i,(function(e,t){return s.submitMessage(ce.Propose,{key:e,value:t})})),a=m.G2.create(this.subLogger,"ProtocolHandler"),o.quorum.on("error",(function(e){a.sendErrorEvent(e)})),this.connectionStateHandler.initProtocol(o),o.quorum.on("addProposal",(function(e){"code"!==e.key&&"code2"!==e.key||s.emit("codeDetailsProposed",e.value,e)})),o.quorum.on("approveProposal",(function(e,t,n){"code"!==t&&"code2"!==t||((0,M.Tr)(n)||s.mc.logger.sendErrorEvent({eventName:"CodeProposalNotIFluidCodeDetails"}),s.processCodeProposal().catch((function(e){throw s.close((0,pe.SC)(e)),e})))})),e.abrupt("return",o);case 7:case"end":return e.stop()}}),e,this)})));return function(t,n,r,i){return e.apply(this,arguments)}}()},{key:"captureProtocolSummary",value:function(){var e=this.protocolHandler.snapshot();return{tree:{attributes:{content:JSON.stringify(this.protocolHandler.attributes),type:ue.Blob},quorumMembers:{content:JSON.stringify(e.members),type:ue.Blob},quorumProposals:{content:JSON.stringify(e.proposals),type:ue.Blob},quorumValues:{content:JSON.stringify(e.values),type:ue.Blob}},type:ue.Tree}}},{key:"getCodeDetailsFromQuorum",value:function(){var e=function(e){var t;return null!==(t=e.get("code"))&&void 0!==t?t:e.get("code2")}(this.protocolHandler.quorum);return e}},{key:"client",get:function(){var e,t=void 0!==(null===(e=this.options)||void 0===e?void 0:e.client)?this.options.client:{details:{capabilities:{interactive:!0}},mode:"read",permission:[],scopes:[],user:{id:""}};return void 0!==this.clientDetailsOverride&&R()(t.details,this.clientDetailsOverride),t.details.environment=[t.details.environment," loaderVersion:".concat(_e)].join(";"),t}},{key:"activeConnection",value:function(){return this.connectionState===Ne.e.Connected&&"write"===this.connectionMode}},{key:"createDeltaManager",value:function(){var e=this,t=function(){return e.service},n=new Te(t,m.G2.create(this.subLogger,"DeltaManager"),(function(){return e.activeConnection()}),(function(n){return new it(t,e.client,e._canReconnect,m.G2.create(e.subLogger,"ConnectionManager"),n)}));return n.inbound.pause(),n.inboundSignal.pause(),n.on("connect",(function(t,n){var r;e._audience.clear();var i,o=(0,w.Z)(null!==(r=t.initialClients)&&void 0!==r?r:[]);try{for(o.s();!(i=o.n()).done;){var a=i.value;e._audience.addMember(a.clientId,a.client)}}catch(s){o.e(s)}finally{o.f()}e.connectionStateHandler.receivedConnectEvent(e.connectionMode,t)})),n.on("disconnect",(function(t){var n;null===(n=e.collabWindowTracker)||void 0===n||n.stopSequenceNumberUpdate(),e.connectionStateHandler.receivedDisconnectEvent(t)})),n.on("throttled",(function(t){var n=t;!0!==n.logged&&e.logContainerError(n),e.emit("warning",n)})),n.on("readonly",(function(t){e.emit("readonly",t)})),n.on("closed",(function(t){e.closeCore(t)})),n}},{key:"attachDeltaManagerOpHandler",value:function(){var e=(0,d.Z)((0,l.Z)().mark((function e(t,n){var r,i=this;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this._deltaManager.attachOpHandler(t.minimumSequenceNumber,t.sequenceNumber,null!==(r=t.term)&&void 0!==r?r:1,{process:function(e){return i.processRemoteMessage(e)},processSignal:function(e){i.processSignal(e)}},n));case 1:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"logConnectionStateChangeTelemetry",value:function(e,t,n){var r,i=_.now();this.connectionTransitionTimes[e]=i;var o,a,s,u,c,l=i-this.connectionTransitionTimes[t];e===Ne.e.Disconnected?s=this._deltaManager.connectionManager.reconnectMode:(e===Ne.e.Connected?(o=i-this.connectionTransitionTimes[Ne.e.Disconnected],o=m.hy.formatTick(o)):(u=this.deltaManager.lastKnownSeqNumber,this.deltaManager.hasCheckpointSequenceNumber&&(c=u-this.deltaManager.lastSequenceNumber)),a=this.firstConnection?"InitialConnect":"AutoReconnect"),this.mc.logger.sendPerformanceEvent(Object.assign({eventName:"ConnectionStateChange_".concat(Ne.e[e]),from:Ne.e[t],duration:l,durationFromDisconnected:o,reason:n,connectionInitiationReason:a,pendingClientId:this.connectionStateHandler.pendingClientId,clientId:this.clientId,autoReconnect:s,opsBehind:c,online:U.Yz[(0,U.Gg)()],lastVisible:void 0!==this.lastVisible?_.now()-this.lastVisible:void 0,checkpointSequenceNumber:u,quorumSize:null===(r=this._protocolHandler)||void 0===r?void 0:r.quorum.getMembers().size},this._deltaManager.connectionProps)),e===Ne.e.Connected&&(this.firstConnection=!1)}},{key:"propagateConnectionState",value:function(){var e,t=this.connectionState===Ne.e.Connected&&!this.firstConnection&&"write"===this.connectionMode;t&&(this.messageCountAfterDisconnection=0);var n=this.connectionState===Ne.e.Connected;!1===(null===(e=this._context)||void 0===e?void 0:e.disposed)&&this.context.setConnectionState(n,this.clientId),this.protocolHandler.setConnectionState(n,this.clientId),(0,fe.Qq)(this.mc.logger,this,n,this.clientId),t&&this.mc.logger.sendTelemetryEvent({eventName:"OpsSentOnReconnect",count:this.messageCountAfterDisconnection})}},{key:"submitContainerMessage",value:function(e,t,n,r){switch(e){case ce.Operation:case ce.RemoteHelp:break;case ce.Summarize:var i=t;void 0===i.details&&(i.details={}),i.details.includesProtocolTree=!0===this.options.summarizeProtocolTree;break;default:return this.close(new F.pY("invalidContainerSubmitOpType",void 0,{messageType:e})),-1}return this.submitMessage(e,t,n,r)}},{key:"submitMessage",value:function(e,t,n,r){var i;return this.connectionState!==Ne.e.Connected?(this.mc.logger.sendErrorEvent({eventName:"SubmitMessageWithNoConnection",type:e}),-1):(this.messageCountAfterDisconnection+=1,null===(i=this.collabWindowTracker)||void 0===i||i.stopSequenceNumberUpdate(),this._deltaManager.submit(e,t,n,r))}},{key:"processRemoteMessage",value:function(e){var t=this,n=this.clientId===e.clientId,r={immediateNoOp:!1};try{r=this.protocolHandler.processMessage(e,n)}catch(i){this.close((0,pe.Jn)(i,(function(t){return new F.Jd(t,(0,F.HN)(e))})))}return(0,J._V)(e)&&!(0,J.LW)(e)&&this.mc.logger.sendTelemetryEvent({eventName:"UnpackedRuntimeMessage",type:e.type}),((0,J.LW)(e)||(0,J._V)(e))&&this.context.process(e,n,void 0),this.activeConnection()&&(void 0===this.collabWindowTracker&&(P(void 0!==this.serviceConfiguration,740),this.collabWindowTracker=new $e((function(e,n){P(t.activeConnection(),577),t.submitMessage(e,n)}),this.serviceConfiguration.noopTimeFrequency,this.serviceConfiguration.noopCountFrequency)),this.collabWindowTracker.scheduleSequenceNumberUpdate(e,!0===r.immediateNoOp)),this.emit("op",e),r}},{key:"submitSignal",value:function(e){this._deltaManager.submitSignal(JSON.stringify(e))}},{key:"processSignal",value:function(e){if(null===e.clientId){var t=e.content;if(t.type===ce.ClientJoin){var n=t.content;this._audience.addMember(n.clientId,n.client)}else if(t.type===ce.ClientLeave){var r=t.content;this._audience.removeMember(r)}}else{var i=this.clientId===e.clientId;this.context.processSignal(e,i)}}},{key:"fetchSnapshotTree",value:function(){var e=(0,d.Z)((0,l.Z)().mark((function e(t){var n,r,i;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getVersion(null!==t&&void 0!==t?t:null);case 2:return void 0===(r=e.sent)&&void 0!==t&&this.mc.logger.sendErrorEvent({eventName:"NoVersionFoundWhenSpecified",id:t}),this._loadedFromVersion=r,e.next=7,this.storageService.getSnapshotTree(r);case 7:if(e.t1=n=e.sent,e.t0=null!==e.t1,!e.t0){e.next=11;break}e.t0=void 0!==n;case 11:if(!e.t0){e.next=15;break}e.t2=n,e.next=16;break;case 15:e.t2=void 0;case 16:return void 0===(i=e.t2)&&void 0!==r&&this.mc.logger.sendErrorEvent({eventName:"getSnapshotTreeFailed",id:r.id}),e.abrupt("return",{snapshot:i,versionId:null===r||void 0===r?void 0:r.id});case 19:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"instantiateContextDetached",value:function(){var e=(0,d.Z)((0,l.Z)().mark((function e(t,n){var r;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0!==(r=this.getCodeDetailsFromQuorum())){e.next=3;break}throw new Error("pkg should be provided in create flow!!");case 3:return e.next=5,this.instantiateContext(t,r,n);case 5:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"instantiateContext",value:function(){var e=(0,d.Z)((0,l.Z)().mark((function e(t,r,i,o){var a,s,u=this;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return P(!1!==(null===(a=this._context)||void 0===a?void 0:a.disposed),221),s=new ht(this,this.loader),e.next=4,ye.createOrLoad(this,this.scope,this.codeLoader,r,i,new Re(this._deltaManager),new Je(this.protocolHandler.quorum),s,(function(e,t,n,r){return u.submitContainerMessage(e,t,n,r)}),(function(e){return u.submitSignal(e)}),(function(e){return u.close(e)}),n.version,(function(e){return u.updateDirtyContainerState(e)}),t,o);case 4:this._context=e.sent,this.emit("contextChanged",r);case 6:case"end":return e.stop()}}),e,this)})));return function(t,n,r,i){return e.apply(this,arguments)}}()},{key:"updateDirtyContainerState",value:function(e){this._dirtyContainer!==e&&(this._dirtyContainer=e,this.emit(e?ot:at))}},{key:"logContainerError",value:function(e){this.mc.logger.sendErrorEvent({eventName:"ContainerWarning"},e)}}],[{key:"load",value:function(){var e=(0,d.Z)((0,l.Z)().mark((function e(t,r,i){var o;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=new n(t,{clientDetailsOverride:r.clientDetailsOverride,resolvedUrl:r.resolvedUrl,canReconnect:r.canReconnect,serializedContainerState:i}),e.abrupt("return",m.Xr.timedExecAsync(o.mc.logger,{eventName:"Load"},function(){var e=(0,d.Z)((0,l.Z)().mark((function e(t){return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,n){var a,s,u=r.version,c={opsBeforeReturn:"cached"},l=i?Object.assign(Object.assign({},null!==(a=r.loadMode)&&void 0!==a?a:c),{opsBeforeReturn:void 0}):null!==(s=r.loadMode)&&void 0!==s?s:c,d=function(e){n(null!==e&&void 0!==e?e:new F.pY("Container closed without error during load"))};o.on("closed",d),o.load(u,l,i).finally((function(){o.removeListener("closed",d)})).then((function(n){t.end(Object.assign(Object.assign({},n),r.loadMode)),e(o)}),(function(e){var t=(0,pe.SC)(e);o.close(t),d(t)}))})));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),{start:!0,end:!0,cancel:"generic"}));case 2:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"createDetached",value:function(){var e=(0,d.Z)((0,l.Z)().mark((function e(t,r){var i;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=new n(t,{}),e.abrupt("return",m.Xr.timedExecAsync(i.mc.logger,{eventName:"CreateDetached"},function(){var e=(0,d.Z)((0,l.Z)().mark((function e(t){return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,i.createDetached(r);case 2:return e.abrupt("return",i);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),{start:!0,end:!0,cancel:"generic"}));case 2:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"rehydrateDetachedFromSnapshot",value:function(){var e=(0,d.Z)((0,l.Z)().mark((function e(t,r){var i;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=new n(t,{}),e.abrupt("return",m.Xr.timedExecAsync(i.mc.logger,{eventName:"RehydrateDetachedFromSnapshot"},function(){var e=(0,d.Z)((0,l.Z)().mark((function e(t){var n;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=JSON.parse(r),e.next=3,i.rehydrateDetachedFromSnapshot(n);case 3:return e.abrupt("return",i);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),{start:!0,end:!0,cancel:"generic"}));case 2:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()}]),n}(ve.M);function dt(e){return void 0===e.headers||!1!==e.headers[p.A.cache]}lt.version="^0.1.0";var ht=function(){function e(t,n){(0,i.Z)(this,e),this.container=t,this.loader=n}return(0,o.Z)(e,[{key:"IFluidRouter",get:function(){return this}},{key:"resolve",value:function(){var e=(0,d.Z)((0,l.Z)().mark((function e(t){var n,r,i,o,a,s,u;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.url.startsWith("/")){e.next=11;break}if(!dt(t)){e.next=5;break}return e.abrupt("return",this.container);case 5:return b(s=this.container.resolvedUrl),e.next=9,lt.load(this.loader,{canReconnect:null===(n=t.headers)||void 0===n?void 0:n[p.A.reconnect],clientDetailsOverride:null===(r=t.headers)||void 0===r?void 0:r[p.A.clientDetails],resolvedUrl:Object.assign({},s),version:null!==(o=null===(i=t.headers)||void 0===i?void 0:i[p.A.version])&&void 0!==o?o:void 0,loadMode:null===(a=t.headers)||void 0===a?void 0:a[p.A.loadMode]});case 9:return u=e.sent,e.abrupt("return",u);case 11:if(void 0!==this.loader){e.next=13;break}throw new Error("Cannot resolve external containers");case 13:return e.abrupt("return",this.loader.resolve(t));case 14:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"request",value:function(){var e=(0,d.Z)((0,l.Z)().mark((function e(t){var n;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.url.startsWith("/")){e.next=5;break}return e.next=3,this.resolve(t);case 3:return n=e.sent,e.abrupt("return",n.request(t));case 5:if(void 0!==this.loader){e.next=7;break}return e.abrupt("return",{status:404,value:"Cannot request external containers",mimeType:"plain/text"});case 7:return e.abrupt("return",this.loader.request(t));case 8:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),e}();function ft(e){var t=Object.create(e),n=new Map;return t.resolve=function(){var t=(0,d.Z)((0,l.Z)().mark((function t(r){return(0,l.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(dt(r)){t.next=2;break}return t.abrupt("return",e.resolve(r));case 2:return n.has(r.url)||n.set(r.url,e.resolve(r)),t.abrupt("return",n.get(r.url));case 4:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),t}var pt,vt=function(){function e(t){var n,r;(0,i.Z)(this,e),this.containers=new Map;var o=Object.assign({},t.scope);!1!==(null===(n=t.options)||void 0===n?void 0:n.provideScopeLoader)&&(o.ILoader=this);var a={loaderId:(0,f.Z)(),loaderVersion:_e},s=(0,v.UK)(g.b.mixinDebugLogger("fluid:telemetry",t.logger,{all:a}),v.of.value,t.configProvider);this.services={urlResolver:ft(C.create(t.urlResolver)),documentServiceFactory:T.create(t.documentServiceFactory),codeLoader:t.codeLoader,options:null!==(r=t.options)&&void 0!==r?r:{},scope:o,subLogger:s.logger,detachedBlobStorage:t.detachedBlobStorage},this.mc=(0,v.rZ)(m.G2.create(this.services.subLogger,"Loader"))}return(0,o.Z)(e,[{key:"IFluidRouter",get:function(){return this}},{key:"createDetachedContainer",value:function(){var e=(0,d.Z)((0,l.Z)().mark((function e(t){var n,r=this;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,lt.createDetached(this,t);case 2:return n=e.sent,this.cachingEnabled&&n.once("attached",(function(){b(n.resolvedUrl);var e=He(n.resolvedUrl.url);void 0!==e&&r.addToContainerCache(e.id,Promise.resolve(n))})),e.abrupt("return",n);case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"rehydrateDetachedContainerFromSnapshot",value:function(){var e=(0,d.Z)((0,l.Z)().mark((function e(t){return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",lt.rehydrateDetachedFromSnapshot(this,t));case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"resolve",value:function(){var e=(0,d.Z)((0,l.Z)().mark((function e(t,n){var r,i=this;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=void 0===n?"Resolve":"ResolveWithPendingState",e.abrupt("return",m.Xr.timedExecAsync(this.mc.logger,{eventName:r},(0,d.Z)((0,l.Z)().mark((function e(){var r;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,i.resolveCore(t,void 0!==n?JSON.parse(n):void 0);case 2:return r=e.sent,e.abrupt("return",r.container);case 4:case"end":return e.stop()}}),e)})))));case 2:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"request",value:function(){var e=(0,d.Z)((0,l.Z)().mark((function e(t){var n=this;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",m.Xr.timedExecAsync(this.mc.logger,{eventName:"Request"},(0,d.Z)((0,l.Z)().mark((function e(){var r;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.resolveCore(t);case 2:return r=e.sent,e.abrupt("return",r.container.request(Object.assign(Object.assign({},t),{url:"".concat(r.parsed.path).concat(r.parsed.query)})));case 4:case"end":return e.stop()}}),e)})))));case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getKeyForContainerCache",value:function(e,t){var n;return void 0!==(null===(n=e.headers)||void 0===n?void 0:n[p.A.version])?"".concat(t.id,"@").concat(e.headers[p.A.version]):t.id}},{key:"addToContainerCache",value:function(e,t){var n=this;this.containers.set(e,t),t.then((function(t){t.closed?n.containers.delete(e):t.once("closed",(function(){n.containers.delete(e)}))})).catch((function(e){}))}},{key:"resolveCore",value:function(){var e=(0,d.Z)((0,l.Z)().mark((function e(t,n){var r,i,o,a,s,u,c,d,h,f,p;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.services.urlResolver.resolve(t);case 2:if(b(r=e.sent),void 0!==(i=He(r.url))){e.next=7;break}throw new Error("Invalid URL ".concat(r.url));case 7:if(void 0===n){e.next=12;break}if((null===(o=He(n.url))||void 0===o?void 0:o.id)===i.id&&(null===o||void 0===o?void 0:o.path.replace(/\/$/,""))===i.path.replace(/\/$/,"")){e.next=12;break}throw a="URL ".concat(r.url," does not match pending state URL ").concat(n.url),new Error(a);case 12:if(s=this.parseHeader(i,t),u=s.canCache,c=s.fromSequenceNumber,!(void 0===n&&u)){e.next=30;break}return h=this.getKeyForContainerCache(t,i),e.next=18,this.containers.get(h);case 18:if(void 0===(f=e.sent)){e.next=23;break}d=f,e.next=28;break;case 23:return p=this.loadContainer(t,r),this.addToContainerCache(h,p),e.next=27,p;case 27:d=e.sent;case 28:e.next=33;break;case 30:return e.next=32,this.loadContainer(t,r,n);case 32:d=e.sent;case 33:if(!(d.deltaManager.lastSequenceNumber<=c)){e.next=36;break}return e.next=36,new Promise((function(e,t){d.on("op",(function t(n){n.sequenceNumber>c&&(e(),d.removeListener("op",t))}))}));case 36:return e.abrupt("return",{container:d,parsed:i});case 37:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"cachingEnabled",get:function(){return!1!==this.services.options.cache}},{key:"canCacheForRequest",value:function(e){return this.cachingEnabled&&!1!==e[p.A.cache]}},{key:"parseHeader",value:function(e,t){var n,r,i=-1;t.headers=null!==(n=t.headers)&&void 0!==n?n:{};var o=t.headers[p.A.sequenceNumber];return void 0!==o&&(i=o),t.headers[p.A.version]=null!==(r=e.version)&&void 0!==r?r:t.headers[p.A.version],{canCache:this.canCacheForRequest(t.headers),fromSequenceNumber:i}}},{key:"loadContainer",value:function(){var e=(0,d.Z)((0,l.Z)().mark((function e(t,n,r){var i,o,a,s,u;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",lt.load(this,{canReconnect:null===(i=t.headers)||void 0===i?void 0:i[p.A.reconnect],clientDetailsOverride:null===(o=t.headers)||void 0===o?void 0:o[p.A.clientDetails],resolvedUrl:n,version:null!==(s=null===(a=t.headers)||void 0===a?void 0:a[p.A.version])&&void 0!==s?s:void 0,loadMode:null===(u=t.headers)||void 0===u?void 0:u[p.A.loadMode]},r));case 1:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}()}]),e}(),gt=n(99039),mt=n(80124);function yt(e,t){if(!e)throw new Error("number"===typeof t?"0x".concat(t.toString(16).padStart(3,"0")):t)}!function(e){e.Tree=1,e.Blob=2,e.Handle=3,e.Attachment=4}(pt||(pt={}));var bt,wt=n(9997),St=function(){function e(t){var n=this;(0,i.Z)(this,e),this.maxRequests=t,this.tasks=[],this.release=function(){var e=n.tasks.shift();if(void 0!==e)return e();n.maxRequests++},(0,wt.h)(t>0,174)}return(0,o.Z)(e,[{key:"waitQueueLength",get:function(){return this.tasks.length}},{key:"acquire",value:function(){var e=(0,d.Z)((0,l.Z)().mark((function e(){var t=this;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(this.maxRequests>0)){e.next=3;break}return this.maxRequests--,e.abrupt("return");case 3:return e.abrupt("return",new Promise((function(e){t.tasks.push(e)})));case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"schedule",value:function(){var e=(0,d.Z)((0,l.Z)().mark((function e(t){return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.acquire();case 2:return e.abrupt("return",t().finally(this.release));case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),e}();function kt(e,t){if(!e)throw new Error("number"===typeof t?"0x".concat(t.toString(16).padStart(3,"0")):t)}function Ct(e,t){switch(t){case"base64":return Be.fromByteArray(e);case"utf8":case"utf-8":case void 0:return(new TextDecoder).decode(e);default:throw new Error("invalid/unsupported encoding")}}!function(e){e[e.NoCaching=0]="NoCaching",e[e.Prefetch=1]="Prefetch"}(bt||(bt={}));function xt(e){var t=e;return e instanceof ArrayBuffer||"object"===typeof t&&null!==t&&"number"===typeof t.byteLength&&"function"===typeof t.slice&&void 0===t.byteOffset&&void 0===t.buffer}var Et=function(e){(0,a.Z)(n,e);var t=(0,s.Z)(n);function n(){return(0,i.Z)(this,n),t.apply(this,arguments)}return(0,o.Z)(n,[{key:"toString",value:function(e){return Ct(this,e)}}],[{key:"from",value:function(e,t,r){if("string"===typeof e)return n.fromString(e,t);if(null!==e&&"object"===typeof e&&xt(e.buffer))return kt(0===e.byteOffset,0),kt(e.byteLength===e.buffer.byteLength,1),n.fromArrayBuffer(e.buffer,t,r);if(xt(e))return n.fromArrayBuffer(e,t,r);throw new TypeError}},{key:"fromArrayBuffer",value:function(e,t,r){var i=null!==t&&void 0!==t?t:0,o=null!==r&&void 0!==r?r:e.byteLength-i;if(i<0||i>e.byteLength||o<0||o+i>e.byteLength)throw new RangeError;return new n(e,i,o)}},{key:"fromString",value:function(e,t){switch(t){case"base64":var r=this.sanitizeBase64(e);return new n(Be.toByteArray(r).buffer);case"utf8":case"utf-8":case void 0:return new n((new TextEncoder).encode(e).buffer);default:throw new Error("invalid/unsupported encoding")}}},{key:"isBuffer",value:function(e){throw new Error("unimplemented")}},{key:"sanitizeBase64",value:function(e){var t=e;if((t=(t=t.split("=")[0]).replace(/[^\w+-/]/g,"")).length%4!==0){t+=["","===","==","="][t.length%4]}return t}}]),n}((0,Le.Z)(Uint8Array)),Tt=n(4942),It=n(30863),At=n(72451),Rt=n.n(At),_t=n(44521),Pt=n.n(_t),Nt=(0,n(18392).debug)("fluid:services-client");Nt("Package: ".concat("@fluidframework/server-services-client"," - Version: ").concat("0.1036.5001"));var Ot=function(e){(0,a.Z)(n,e);var t=(0,s.Z)(n);function n(e,r,o,a,s){var u;return(0,i.Z)(this,n),(u=t.call(this,r)).code=e,u.canRetry=o,u.isFatal=a,u.retryAfterMs=s,u.name="NetworkError",u.retryAfter=void 0!==s?s/1e3:void 0,u}return(0,o.Z)(n,[{key:"details",get:function(){return void 0===this.canRetry&&void 0===this.isFatal&&void 0===this.retryAfterMs?this.message:{message:this.message,canRetry:this.canRetry,isFatal:this.isFatal,retryAfter:this.retryAfter,retryAfterMs:this.retryAfterMs}}},{key:"toJSON",value:function(){return{code:this.code,message:this.message,canRetry:this.canRetry,isFatal:this.isFatal,retryAfterMs:this.retryAfterMs,retryAfter:this.retryAfter}}}]),n}((0,Le.Z)(Error));function Mt(e,t){var n,r,i,o,a;switch(t&&"object"===typeof t?(r=null!==(n=t.message)&&void 0!==n?n:"Unknown Error",i=t.canRetry,o=t.isFatal,a=t.retryAfter):r=t&&"string"===typeof t?t:"Unknown Error",e){case 401:case 403:case 404:return new Ot(e,r,!1,!1);case 413:case 422:return new Ot(e,r,null!==i&&void 0!==i&&i,null!==o&&void 0!==o&&o,i?a:void 0);case 429:case 502:case 503:case 504:return new Ot(e,r,!0,!1,a);case 500:return new Ot(e,r,null===i||void 0===i||i,null!==o&&void 0!==o&&o,i?a:void 0);default:return new Ot(e,r,!1,!0)}}var Ft="x-correlation-id",Zt=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1048576e3,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1048576e3;(0,i.Z)(this,e),this.baseurl=t,this.defaultQueryString=n,this.maxBodyLength=r,this.maxContentLength=o}return(0,o.Z)(e,[{key:"get",value:function(){var e=(0,d.Z)((0,l.Z)().mark((function e(t,n,r){var i;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i={baseURL:this.baseurl,headers:r,maxBodyLength:this.maxBodyLength,maxContentLength:this.maxContentLength,method:"GET",url:"".concat(t).concat(this.generateQueryString(n))},e.abrupt("return",this.request(i,200));case 2:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"post",value:function(){var e=(0,d.Z)((0,l.Z)().mark((function e(t,n,r,i){var o;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o={baseURL:this.baseurl,data:n,headers:i,maxBodyLength:this.maxBodyLength,maxContentLength:this.maxContentLength,method:"POST",url:"".concat(t).concat(this.generateQueryString(r))},e.abrupt("return",this.request(o,201));case 2:case"end":return e.stop()}}),e,this)})));return function(t,n,r,i){return e.apply(this,arguments)}}()},{key:"delete",value:function(){var e=(0,d.Z)((0,l.Z)().mark((function e(t,n,r){var i;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i={baseURL:this.baseurl,headers:r,maxBodyLength:this.maxBodyLength,maxContentLength:this.maxContentLength,method:"DELETE",url:"".concat(t).concat(this.generateQueryString(n))},e.abrupt("return",this.request(i,204));case 2:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"patch",value:function(){var e=(0,d.Z)((0,l.Z)().mark((function e(t,n,r,i){var o;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o={baseURL:this.baseurl,data:n,headers:i,maxBodyLength:this.maxBodyLength,maxContentLength:this.maxContentLength,method:"PATCH",url:"".concat(t).concat(this.generateQueryString(r))},e.abrupt("return",this.request(o,200));case 2:case"end":return e.stop()}}),e,this)})));return function(t,n,r,i){return e.apply(this,arguments)}}()},{key:"generateQueryString",value:function(e){if(this.defaultQueryString||e){var t=Object.assign(Object.assign({},this.defaultQueryString),e),n=It.stringify(t);if(""!==n)return"?".concat(n)}return""}}]),e}(),Dt=function(e){(0,a.Z)(n,e);var t=(0,s.Z)(n);function n(e){var r,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1048576e3,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1048576e3,u=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{},c=arguments.length>5&&void 0!==arguments[5]?arguments[5]:Pt(),l=arguments.length>6?arguments[6]:void 0,d=arguments.length>7?arguments[7]:void 0,h=arguments.length>8?arguments[8]:void 0;return(0,i.Z)(this,n),(r=t.call(this,e,o,a,s)).defaultHeaders=u,r.axios=c,r.refreshDefaultQueryString=l,r.refreshDefaultHeaders=d,r.getCorrelationId=h,r}return(0,o.Z)(n,[{key:"request",value:function(){var e=(0,d.Z)((0,l.Z)().mark((function e(t,n){var r,i,o,a,s=this,u=arguments;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=!(u.length>2&&void 0!==u[2])||u[2],(a=Object.assign({},t)).headers=this.generateHeaders(a.headers,null!==(o=null===(i=this.getCorrelationId)||void 0===i?void 0:i.call(this))&&void 0!==o?o:(0,f.Z)()),e.abrupt("return",new Promise((function(e,i){s.axios.request(a).then((function(t){e(t.data)})).catch((function(o){var u,c,l,d,h,f,p,v,g,m,y,b,w,S;if((null===(u=null===o||void 0===o?void 0:o.response)||void 0===u?void 0:u.status)===n&&e(null===(c=null===o||void 0===o?void 0:o.response)||void 0===c?void 0:c.data),(null===o||void 0===o?void 0:o.config)?Nt("[".concat(o.config.method,"] request to [").concat(null!==(l=o.config.baseURL)&&void 0!==l?l:"").concat(null!==(d=o.config.url)&&void 0!==d?d:"","] failed with [").concat(null===(h=o.response)||void 0===h?void 0:h.status,"] [").concat(Rt()(null===(f=o.response)||void 0===f?void 0:f.data,void 0,2),"]")):Nt("request to ".concat(a.url," failed ").concat(o?o.message:"")),429===(null===(p=null===o||void 0===o?void 0:o.response)||void 0===p?void 0:p.status)&&(null===(g=null===(v=null===o||void 0===o?void 0:o.response)||void 0===v?void 0:v.data)||void 0===g?void 0:g.retryAfter)>0&&r)setTimeout((function(){s.request(a,n).then(e).catch(i)}),1e3*o.response.data.retryAfter);else if(401===(null===(m=null===o||void 0===o?void 0:o.response)||void 0===m?void 0:m.status)&&r&&s.refreshOnAuthError()){var k=Object.assign({},t);k.headers=s.generateHeaders(k.headers,a.headers[Ft]),s.request(k,n,!1).then(e).catch(i)}else if(null===o||void 0===o?void 0:o.response)i(Mt(null===(y=null===o||void 0===o?void 0:o.response)||void 0===y?void 0:y.status,null===(b=null===o||void 0===o?void 0:o.response)||void 0===b?void 0:b.data));else if(null===o||void 0===o?void 0:o.request)i(Mt(502,"Network Error: ".concat(null!==(w=null===o||void 0===o?void 0:o.message)&&void 0!==w?w:"undefined")));else{var C={canRetry:!1,isFatal:!1,message:null!==(S=null===o||void 0===o?void 0:o.message)&&void 0!==S?S:"Unknown Error"};i(Mt(500,C))}}))})));case 4:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"generateHeaders",value:function(e,t){var n=null!==e&&void 0!==e?e:{};return this.defaultHeaders&&(n=Object.assign(Object.assign({},this.defaultHeaders),e)),n[Ft]?n:Object.assign((0,Tt.Z)({},Ft,t),n)}},{key:"refreshOnAuthError",value:function(){return(void 0!==this.refreshDefaultQueryString||void 0!==this.refreshDefaultHeaders)&&(void 0!==this.refreshDefaultHeaders&&(this.defaultHeaders=this.refreshDefaultHeaders()),void 0!==this.refreshDefaultQueryString&&(this.defaultQueryString=this.refreshDefaultQueryString()),!0)}}]),n}(Zt);function Lt(e,t){var n,r=(0,w.Z)(t);try{for(r.s();!(n=r.n()).done;){var i=n.value;if(e.endsWith(i))return!0}}catch(o){r.e(o)}finally{r.f()}return!1}var Bt,qt,jt=function(e){return"Basic ".concat((t="".concat(e.user,":").concat(e.password),Et.from(t,"utf8").toString("base64")));var t},Ut=function(){function e(t,n,r,o){(0,i.Z)(this,e),this.endpoint=t,this.historianApi=n,this.restWrapper=o,this.defaultQueryString={},r&&this.historianApi?(this.defaultQueryString.disableCache=r,this.cacheBust=!1):this.cacheBust=r,void 0===this.restWrapper&&(this.restWrapper=new Dt(this.endpoint))}return(0,o.Z)(e,[{key:"getHeader",value:function(){var e=(0,d.Z)((0,l.Z)().mark((function e(t){return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.historianApi){e.next=4;break}return e.abrupt("return",this.restWrapper.get("/headers/".concat(encodeURIComponent(t)),this.getQueryString()));case 4:return e.abrupt("return",this.getHeaderDirect(t));case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getFullTree",value:function(){var e=(0,d.Z)((0,l.Z)().mark((function e(t){return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.restWrapper.get("/tree/".concat(encodeURIComponent(t)),this.getQueryString()));case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getBlob",value:function(){var e=(0,d.Z)((0,l.Z)().mark((function e(t){return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.restWrapper.get("/git/blobs/".concat(encodeURIComponent(t)),this.getQueryString()));case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"createBlob",value:function(){var e=(0,d.Z)((0,l.Z)().mark((function e(t){return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.restWrapper.post("/git/blobs",t,this.getQueryString()));case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getContent",value:function(){var e=(0,d.Z)((0,l.Z)().mark((function e(t,n){return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.restWrapper.get("/contents/".concat(t),this.getQueryString({ref:n})));case 1:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"getCommits",value:function(){var e=(0,d.Z)((0,l.Z)().mark((function e(t,n){return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.restWrapper.get("/commits",this.getQueryString({count:n,sha:t})).catch((function(e){return 400===e||404===e?[]:Promise.reject(e)})));case 1:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"getCommit",value:function(){var e=(0,d.Z)((0,l.Z)().mark((function e(t){return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.restWrapper.get("/git/commits/".concat(encodeURIComponent(t)),this.getQueryString()));case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"createCommit",value:function(){var e=(0,d.Z)((0,l.Z)().mark((function e(t){return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.restWrapper.post("/git/commits",t,this.getQueryString()));case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getRefs",value:function(){var e=(0,d.Z)((0,l.Z)().mark((function e(){return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.restWrapper.get("/git/refs",this.getQueryString()));case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getRef",value:function(){var e=(0,d.Z)((0,l.Z)().mark((function e(t){return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.restWrapper.get("/git/refs/".concat(t),this.getQueryString()));case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"createRef",value:function(){var e=(0,d.Z)((0,l.Z)().mark((function e(t){return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.restWrapper.post("/git/refs",t,this.getQueryString()));case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"updateRef",value:function(){var e=(0,d.Z)((0,l.Z)().mark((function e(t,n){return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.restWrapper.patch("/git/refs/".concat(t),n,this.getQueryString()));case 1:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"deleteRef",value:function(){var e=(0,d.Z)((0,l.Z)().mark((function e(t){return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.restWrapper.delete("/git/refs/".concat(t),this.getQueryString());case 2:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"createTag",value:function(){var e=(0,d.Z)((0,l.Z)().mark((function e(t){return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.restWrapper.post("/git/tags",t,this.getQueryString()));case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getTag",value:function(){var e=(0,d.Z)((0,l.Z)().mark((function e(t){return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.restWrapper.get("/git/tags/".concat(t),this.getQueryString()));case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"createTree",value:function(){var e=(0,d.Z)((0,l.Z)().mark((function e(t){return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.restWrapper.post("/git/trees",t,this.getQueryString()));case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getTree",value:function(){var e=(0,d.Z)((0,l.Z)().mark((function e(t,n){return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.restWrapper.get("/git/trees/".concat(encodeURIComponent(t)),this.getQueryString({recursive:n?1:0})));case 1:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"createSummary",value:function(){var e=(0,d.Z)((0,l.Z)().mark((function e(t){return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.restWrapper.post("/git/summaries",t,this.getQueryString()));case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"deleteSummary",value:function(){var e=(0,d.Z)((0,l.Z)().mark((function e(t){var n;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n={"Soft-Delete":t},e.abrupt("return",this.restWrapper.delete("/git/summaries",this.getQueryString(),n));case 2:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getSummary",value:function(){var e=(0,d.Z)((0,l.Z)().mark((function e(t){return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.restWrapper.get("/git/summaries/".concat(t),this.getQueryString()));case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getHeaderDirect",value:function(){var e=(0,d.Z)((0,l.Z)().mark((function e(t){var n,r,i,o,a,s,u,c;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getTree(t,!0);case 2:n=e.sent,r=[".attributes",".blobs",".messages","header"],i=[],o=(0,w.Z)(n.tree);try{for(o.s();!(a=o.n()).done;)"blob"===(s=a.value).type&&Lt(s.path,r)&&(u=this.getBlob(s.sha),i.push(u))}catch(l){o.e(l)}finally{o.f()}return e.next=9,Promise.all(i);case 9:return c=e.sent,e.abrupt("return",{blobs:c,tree:n});case 11:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getQueryString",value:function(e){return this.cacheBust?Object.assign(Object.assign({cacheBust:Date.now()},this.defaultQueryString),e):Object.assign(Object.assign({},this.defaultQueryString),e)}}]),e}(),Ht=n(29299);!function(e){e.File="100644",e.Executable="100755",e.Directory="040000",e.Symlink="120000"}(Bt||(Bt={})),function(e){e.Blob="Blob",e.Tree="Tree",e.Attachment="Attachment"}(qt||(qt={}));var zt=function(){function e(t){(0,i.Z)(this,e),this.historian=t,this.blobCache=new Map,this.commitCache=new Map,this.treeCache=new Map,this.refCache=new Map}return(0,o.Z)(e,[{key:"getHeader",value:function(){var e=(0,d.Z)((0,l.Z)().mark((function e(t,n){var r,i,o,a;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.historian.getHeader(n);case 2:r=e.sent,i=(0,w.Z)(r.blobs);try{for(i.s();!(o=i.n()).done;)a=o.value,this.blobCache.set(a.sha,a)}catch(t){i.e(t)}finally{i.f()}return e.abrupt("return",(0,Ht.eB)(r.tree));case 6:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"getFullTree",value:function(){var e=(0,d.Z)((0,l.Z)().mark((function e(t){return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.historian.getFullTree(t));case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getCommit",value:function(){var e=(0,d.Z)((0,l.Z)().mark((function e(t){return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.commitCache.has(t)){e.next=3;break}return Nt("Cache hit on ".concat(t)),e.abrupt("return",this.commitCache.get(t));case 3:return e.abrupt("return",this.historian.getCommit(t));case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getCommits",value:function(){var e=(0,d.Z)((0,l.Z)().mark((function e(t,n){var r,i;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t,!this.refCache.has(t)){e.next=7;break}if(Nt("Commit cache hit on ".concat(t)),r=this.refCache.get(t),this.refCache.delete(t),r){e.next=7;break}return e.abrupt("return",[]);case 7:if(!this.commitCache.has(r)){e.next=10;break}return i=this.commitCache.get(r),e.abrupt("return",[{commit:{author:i.author,committer:i.committer,message:i.message,tree:i.tree,url:i.url},parents:i.parents,sha:i.sha,url:i.url}]);case 10:return e.abrupt("return",this.historian.getCommits(r,n));case 11:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"getTree",value:function(){var e=(0,d.Z)((0,l.Z)().mark((function e(t){var n,r=arguments;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=!(r.length>1&&void 0!==r[1])||r[1],!this.treeCache.has(t)){e.next=4;break}return Nt("Tree cache hit on ".concat(t)),e.abrupt("return",this.treeCache.get(t));case 4:return e.abrupt("return",this.historian.getTree(t,n));case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getBlob",value:function(){var e=(0,d.Z)((0,l.Z)().mark((function e(t){return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.blobCache.has(t)){e.next=3;break}return Nt("Blob cache hit on ".concat(t)),e.abrupt("return",this.blobCache.get(t));case 3:return e.abrupt("return",this.historian.getBlob(t));case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getRawUrl",value:function(e){return"".concat(this.historian.endpoint,"/git/blobs/raw/").concat(e)}},{key:"getContent",value:function(){var e=(0,d.Z)((0,l.Z)().mark((function e(t,n){return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.historian.getContent(n,t));case 1:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"createBlob",value:function(){var e=(0,d.Z)((0,l.Z)().mark((function e(t,n){var r;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r={content:t,encoding:n},e.abrupt("return",this.historian.createBlob(r));case 2:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"createGitTree",value:function(){var e=(0,d.Z)((0,l.Z)().mark((function e(t){var n;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=this.historian.createTree(t),e.abrupt("return",n);case 2:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"createTree",value:function(){var e=(0,d.Z)((0,l.Z)().mark((function e(t){return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.createTreeCore(t,0));case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"createCommit",value:function(){var e=(0,d.Z)((0,l.Z)().mark((function e(t){return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.historian.createCommit(t));case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"createSummary",value:function(){var e=(0,d.Z)((0,l.Z)().mark((function e(t){return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.historian.createSummary(t));case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"deleteSummary",value:function(){var e=(0,d.Z)((0,l.Z)().mark((function e(t){return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.historian.deleteSummary(t));case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getSummary",value:function(){var e=(0,d.Z)((0,l.Z)().mark((function e(t){return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.historian.getSummary(t));case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getRef",value:function(){var e=(0,d.Z)((0,l.Z)().mark((function e(t){return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.historian.getRef("heads/".concat(t)).catch((function(e){if(400===e||404===e)return null;throw e})));case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"createRef",value:function(){var e=(0,d.Z)((0,l.Z)().mark((function e(t,n){var r;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r={ref:"refs/heads/".concat(t),sha:n,config:{enabled:!0}},e.abrupt("return",this.historian.createRef(r));case 2:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"upsertRef",value:function(){var e=(0,d.Z)((0,l.Z)().mark((function e(t,n){var r;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r={force:!0,sha:n,config:{enabled:!0}},e.abrupt("return",this.historian.updateRef("heads/".concat(t),r));case 2:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"addRef",value:function(e,t){this.refCache.set(e,t)}},{key:"addCommit",value:function(e){this.commitCache.set(e.sha,e)}},{key:"addTree",value:function(e){this.treeCache.set(e.sha,e)}},{key:"addBlob",value:function(e){this.blobCache.set(e.sha,e)}},{key:"write",value:function(){var e=(0,d.Z)((0,l.Z)().mark((function e(t,n,r,i){var o,a,s;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.createTree(n);case 2:return o=e.sent,a={author:{date:(new Date).toISOString(),email:"kurtb@microsoft.com",name:"Kurt Berglund"},message:i,parents:r,tree:o.sha},e.next=6,this.historian.createCommit(a);case 6:return s=e.sent,e.next=9,this.getRef(t);case 9:if(!e.sent){e.next=15;break}return e.next=13,this.upsertRef(t,s.sha);case 13:e.next=17;break;case 15:return e.next=17,this.createRef(t,s.sha);case 17:return e.abrupt("return",s);case 18:case"end":return e.stop()}}),e,this)})));return function(t,n,r,i){return e.apply(this,arguments)}}()},{key:"createTreeCore",value:function(){var e=(0,d.Z)((0,l.Z)().mark((function e(t,n){var r,i,o,a,s,u,c,d,h,f,p,v,g,m;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.id){e.next=2;break}return e.abrupt("return",this.getTree(t.id));case 2:r=[],i=(0,w.Z)(t.entries),e.prev=4,i.s();case 6:if((o=i.n()).done){e.next=23;break}a=o.value,e.t0=qt[a.type],e.next=e.t0===qt.Blob?11:e.t0===qt.Tree?16:20;break;case 11:return s=a.value,a.mode===Bt.Symlink&&(s.contents=this.translateSymlink(s.contents,n)),u=this.createBlob(s.contents,s.encoding),r.push(u),e.abrupt("break",21);case 16:return c=a.value,d=this.createTreeCore(c,n+1),r.push(d),e.abrupt("break",21);case 20:throw new Error("Unknown entry type");case 21:e.next=6;break;case 23:e.next=28;break;case 25:e.prev=25,e.t1=e.catch(4),i.e(e.t1);case 28:return e.prev=28,i.f(),e.finish(28);case 31:return e.next=33,Promise.all(r);case 33:for(h=e.sent,f=[],kt(h.length===t.entries.length,"File entries length is not correct"),p=0;p<t.entries.length;p++)v=t.entries[p].type===qt.Tree?"tree":t.entries[p].type===qt.Blob?"blob":"commit",f.push({mode:t.entries[p].mode,path:t.entries[p].path,sha:h[p].sha,type:v});return g={tree:f},m=this.historian.createTree(g),e.abrupt("return",m);case 40:case"end":return e.stop()}}),e,this,[[4,25,28,31]])})));return function(t,n){return e.apply(this,arguments)}}()},{key:"translateSymlink",value:function(e,t){for(var n="",r=0;r<=t;r++)n+="../";return"".concat(n).concat(e)}}]),e}(),Vt=Object.create(null);Vt.open="0",Vt.close="1",Vt.ping="2",Vt.pong="3",Vt.message="4",Vt.upgrade="5",Vt.noop="6";var Gt=Object.create(null);Object.keys(Vt).forEach((function(e){Gt[Vt[e]]=e}));var Kt,Wt={type:"error",data:"parser error"},Jt="function"===typeof Blob||"undefined"!==typeof Blob&&"[object BlobConstructor]"===Object.prototype.toString.call(Blob),Qt="function"===typeof ArrayBuffer,Yt=function(e){return"function"===typeof ArrayBuffer.isView?ArrayBuffer.isView(e):e&&e.buffer instanceof ArrayBuffer},Xt=function(e,t,n){var r=e.type,i=e.data;return Jt&&i instanceof Blob?t?n(i):$t(i,n):Qt&&(i instanceof ArrayBuffer||Yt(i))?t?n(i):$t(new Blob([i]),n):n(Vt[r]+(i||""))},$t=function(e,t){var n=new FileReader;return n.onload=function(){var e=n.result.split(",")[1];t("b"+(e||""))},n.readAsDataURL(e)};function en(e){return e instanceof Uint8Array?e:e instanceof ArrayBuffer?new Uint8Array(e):new Uint8Array(e.buffer,e.byteOffset,e.byteLength)}for(var tn="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",nn="undefined"===typeof Uint8Array?[]:new Uint8Array(256),rn=0;rn<64;rn++)nn[tn.charCodeAt(rn)]=rn;var on,an="function"===typeof ArrayBuffer,sn=function(e,t){if("string"!==typeof e)return{type:"message",data:cn(e,t)};var n=e.charAt(0);return"b"===n?{type:"message",data:un(e.substring(1),t)}:Gt[n]?e.length>1?{type:Gt[n],data:e.substring(1)}:{type:Gt[n]}:Wt},un=function(e,t){if(an){var n=function(e){var t,n,r,i,o,a=.75*e.length,s=e.length,u=0;"="===e[e.length-1]&&(a--,"="===e[e.length-2]&&a--);var c=new ArrayBuffer(a),l=new Uint8Array(c);for(t=0;t<s;t+=4)n=nn[e.charCodeAt(t)],r=nn[e.charCodeAt(t+1)],i=nn[e.charCodeAt(t+2)],o=nn[e.charCodeAt(t+3)],l[u++]=n<<2|r>>4,l[u++]=(15&r)<<4|i>>2,l[u++]=(3&i)<<6|63&o;return c}(e);return cn(n,t)}return{base64:!0,data:e}},cn=function(e,t){return"blob"===t?e instanceof Blob?e:new Blob([e]):e instanceof ArrayBuffer?e:e.buffer},ln=String.fromCharCode(30);function dn(){return new TransformStream({transform:function(e,t){!function(e,t){Jt&&e.data instanceof Blob?e.data.arrayBuffer().then(en).then(t):Qt&&(e.data instanceof ArrayBuffer||Yt(e.data))?t(en(e.data)):Xt(e,!1,(function(e){Kt||(Kt=new TextEncoder),t(Kt.encode(e))}))}(e,(function(n){var r,i=n.length;if(i<126)r=new Uint8Array(1),new DataView(r.buffer).setUint8(0,i);else if(i<65536){r=new Uint8Array(3);var o=new DataView(r.buffer);o.setUint8(0,126),o.setUint16(1,i)}else{r=new Uint8Array(9);var a=new DataView(r.buffer);a.setUint8(0,127),a.setBigUint64(1,BigInt(i))}e.data&&"string"!==typeof e.data&&(r[0]|=128),t.enqueue(r),t.enqueue(n)}))}})}function hn(e){return e.reduce((function(e,t){return e+t.length}),0)}function fn(e,t){if(e[0].length===t)return e.shift();for(var n=new Uint8Array(t),r=0,i=0;i<t;i++)n[i]=e[0][r++],r===e[0].length&&(e.shift(),r=0);return e.length&&r<e[0].length&&(e[0]=e[0].slice(r)),n}function pn(e){if(e)return function(e){for(var t in pn.prototype)e[t]=pn.prototype[t];return e}(e)}pn.prototype.on=pn.prototype.addEventListener=function(e,t){return this._callbacks=this._callbacks||{},(this._callbacks["$"+e]=this._callbacks["$"+e]||[]).push(t),this},pn.prototype.once=function(e,t){function n(){this.off(e,n),t.apply(this,arguments)}return n.fn=t,this.on(e,n),this},pn.prototype.off=pn.prototype.removeListener=pn.prototype.removeAllListeners=pn.prototype.removeEventListener=function(e,t){if(this._callbacks=this._callbacks||{},0==arguments.length)return this._callbacks={},this;var n,r=this._callbacks["$"+e];if(!r)return this;if(1==arguments.length)return delete this._callbacks["$"+e],this;for(var i=0;i<r.length;i++)if((n=r[i])===t||n.fn===t){r.splice(i,1);break}return 0===r.length&&delete this._callbacks["$"+e],this},pn.prototype.emit=function(e){this._callbacks=this._callbacks||{};for(var t=new Array(arguments.length-1),n=this._callbacks["$"+e],r=1;r<arguments.length;r++)t[r-1]=arguments[r];if(n){r=0;for(var i=(n=n.slice(0)).length;r<i;++r)n[r].apply(this,t)}return this},pn.prototype.emitReserved=pn.prototype.emit,pn.prototype.listeners=function(e){return this._callbacks=this._callbacks||{},this._callbacks["$"+e]||[]},pn.prototype.hasListeners=function(e){return!!this.listeners(e).length};var vn="undefined"!==typeof self?self:"undefined"!==typeof window?window:Function("return this")();function gn(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return n.reduce((function(t,n){return e.hasOwnProperty(n)&&(t[n]=e[n]),t}),{})}var mn=vn.setTimeout,yn=vn.clearTimeout;function bn(e,t){t.useNativeTimers?(e.setTimeoutFn=mn.bind(vn),e.clearTimeoutFn=yn.bind(vn)):(e.setTimeoutFn=vn.setTimeout.bind(vn),e.clearTimeoutFn=vn.clearTimeout.bind(vn))}var wn,Sn=function(e){(0,a.Z)(n,e);var t=(0,s.Z)(n);function n(e,r,o){var a;return(0,i.Z)(this,n),(a=t.call(this,e)).description=r,a.context=o,a.type="TransportError",a}return(0,o.Z)(n)}((0,Le.Z)(Error)),kn=function(e){(0,a.Z)(n,e);var t=(0,s.Z)(n);function n(e){var r;return(0,i.Z)(this,n),(r=t.call(this)).writable=!1,bn((0,ne.Z)(r),e),r.opts=e,r.query=e.query,r.socket=e.socket,r}return(0,o.Z)(n,[{key:"onError",value:function(e,t,r){return(0,Q.Z)((0,Y.Z)(n.prototype),"emitReserved",this).call(this,"error",new Sn(e,t,r)),this}},{key:"open",value:function(){return this.readyState="opening",this.doOpen(),this}},{key:"close",value:function(){return"opening"!==this.readyState&&"open"!==this.readyState||(this.doClose(),this.onClose()),this}},{key:"send",value:function(e){"open"===this.readyState&&this.write(e)}},{key:"onOpen",value:function(){this.readyState="open",this.writable=!0,(0,Q.Z)((0,Y.Z)(n.prototype),"emitReserved",this).call(this,"open")}},{key:"onData",value:function(e){var t=sn(e,this.socket.binaryType);this.onPacket(t)}},{key:"onPacket",value:function(e){(0,Q.Z)((0,Y.Z)(n.prototype),"emitReserved",this).call(this,"packet",e)}},{key:"onClose",value:function(e){this.readyState="closed",(0,Q.Z)((0,Y.Z)(n.prototype),"emitReserved",this).call(this,"close",e)}},{key:"pause",value:function(e){}},{key:"createUri",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return e+"://"+this._hostname()+this._port()+this.opts.path+this._query(t)}},{key:"_hostname",value:function(){var e=this.opts.hostname;return-1===e.indexOf(":")?e:"["+e+"]"}},{key:"_port",value:function(){return this.opts.port&&(this.opts.secure&&Number(443!==this.opts.port)||!this.opts.secure&&80!==Number(this.opts.port))?":"+this.opts.port:""}},{key:"_query",value:function(e){var t=function(e){var t="";for(var n in e)e.hasOwnProperty(n)&&(t.length&&(t+="&"),t+=encodeURIComponent(n)+"="+encodeURIComponent(e[n]));return t}(e);return t.length?"?"+t:""}}]),n}(pn),Cn="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_".split(""),xn=64,En={},Tn=0,In=0;function An(e){var t="";do{t=Cn[e%xn]+t,e=Math.floor(e/xn)}while(e>0);return t}function Rn(){var e=An(+new Date);return e!==wn?(Tn=0,wn=e):e+"."+An(Tn++)}for(;In<xn;In++)En[Cn[In]]=In;var _n=!1;try{_n="undefined"!==typeof XMLHttpRequest&&"withCredentials"in new XMLHttpRequest}catch(Ji){}var Pn=_n;function Nn(e){var t=e.xdomain;try{if("undefined"!==typeof XMLHttpRequest&&(!t||Pn))return new XMLHttpRequest}catch(n){}if(!t)try{return new(vn[["Active"].concat("Object").join("X")])("Microsoft.XMLHTTP")}catch(n){}}function On(){}var Mn=null!=new Nn({xdomain:!1}).responseType,Fn=function(e){(0,a.Z)(n,e);var t=(0,s.Z)(n);function n(e){var r;if((0,i.Z)(this,n),(r=t.call(this,e)).polling=!1,"undefined"!==typeof location){var o="https:"===location.protocol,a=location.port;a||(a=o?"443":"80"),r.xd="undefined"!==typeof location&&e.hostname!==location.hostname||a!==e.port}var s=e&&e.forceBase64;return r.supportsBinary=Mn&&!s,r.opts.withCredentials&&(r.cookieJar=void 0),r}return(0,o.Z)(n,[{key:"name",get:function(){return"polling"}},{key:"doOpen",value:function(){this.poll()}},{key:"pause",value:function(e){var t=this;this.readyState="pausing";var n=function(){t.readyState="paused",e()};if(this.polling||!this.writable){var r=0;this.polling&&(r++,this.once("pollComplete",(function(){--r||n()}))),this.writable||(r++,this.once("drain",(function(){--r||n()})))}else n()}},{key:"poll",value:function(){this.polling=!0,this.doPoll(),this.emitReserved("poll")}},{key:"onData",value:function(e){var t=this;(function(e,t){for(var n=e.split(ln),r=[],i=0;i<n.length;i++){var o=sn(n[i],t);if(r.push(o),"error"===o.type)break}return r})(e,this.socket.binaryType).forEach((function(e){if("opening"===t.readyState&&"open"===e.type&&t.onOpen(),"close"===e.type)return t.onClose({description:"transport closed by the server"}),!1;t.onPacket(e)})),"closed"!==this.readyState&&(this.polling=!1,this.emitReserved("pollComplete"),"open"===this.readyState&&this.poll())}},{key:"doClose",value:function(){var e=this,t=function(){e.write([{type:"close"}])};"open"===this.readyState?t():this.once("open",t)}},{key:"write",value:function(e){var t=this;this.writable=!1,function(e,t){var n=e.length,r=new Array(n),i=0;e.forEach((function(e,o){Xt(e,!1,(function(e){r[o]=e,++i===n&&t(r.join(ln))}))}))}(e,(function(e){t.doWrite(e,(function(){t.writable=!0,t.emitReserved("drain")}))}))}},{key:"uri",value:function(){var e=this.opts.secure?"https":"http",t=this.query||{};return!1!==this.opts.timestampRequests&&(t[this.opts.timestampParam]=Rn()),this.supportsBinary||t.sid||(t.b64=1),this.createUri(e,t)}},{key:"request",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object.assign(e,{xd:this.xd,cookieJar:this.cookieJar},this.opts),new Zn(this.uri(),e)}},{key:"doWrite",value:function(e,t){var n=this,r=this.request({method:"POST",data:e});r.on("success",t),r.on("error",(function(e,t){n.onError("xhr post error",e,t)}))}},{key:"doPoll",value:function(){var e=this,t=this.request();t.on("data",this.onData.bind(this)),t.on("error",(function(t,n){e.onError("xhr poll error",t,n)})),this.pollXhr=t}}]),n}(kn),Zn=function(e){(0,a.Z)(n,e);var t=(0,s.Z)(n);function n(e,r){var o;return(0,i.Z)(this,n),o=t.call(this),bn((0,ne.Z)(o),r),o.opts=r,o.method=r.method||"GET",o.uri=e,o.data=void 0!==r.data?r.data:null,o.create(),o}return(0,o.Z)(n,[{key:"create",value:function(){var e,t=this,r=gn(this.opts,"agent","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","autoUnref");r.xdomain=!!this.opts.xd;var i=this.xhr=new Nn(r);try{i.open(this.method,this.uri,!0);try{if(this.opts.extraHeaders)for(var o in i.setDisableHeaderCheck&&i.setDisableHeaderCheck(!0),this.opts.extraHeaders)this.opts.extraHeaders.hasOwnProperty(o)&&i.setRequestHeader(o,this.opts.extraHeaders[o])}catch(a){}if("POST"===this.method)try{i.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch(a){}try{i.setRequestHeader("Accept","*/*")}catch(a){}null===(e=this.opts.cookieJar)||void 0===e||e.addCookies(i),"withCredentials"in i&&(i.withCredentials=this.opts.withCredentials),this.opts.requestTimeout&&(i.timeout=this.opts.requestTimeout),i.onreadystatechange=function(){var e;3===i.readyState&&(null===(e=t.opts.cookieJar)||void 0===e||e.parseCookies(i)),4===i.readyState&&(200===i.status||1223===i.status?t.onLoad():t.setTimeoutFn((function(){t.onError("number"===typeof i.status?i.status:0)}),0))},i.send(this.data)}catch(a){return void this.setTimeoutFn((function(){t.onError(a)}),0)}"undefined"!==typeof document&&(this.index=n.requestsCount++,n.requests[this.index]=this)}},{key:"onError",value:function(e){this.emitReserved("error",e,this.xhr),this.cleanup(!0)}},{key:"cleanup",value:function(e){if("undefined"!==typeof this.xhr&&null!==this.xhr){if(this.xhr.onreadystatechange=On,e)try{this.xhr.abort()}catch(t){}"undefined"!==typeof document&&delete n.requests[this.index],this.xhr=null}}},{key:"onLoad",value:function(){var e=this.xhr.responseText;null!==e&&(this.emitReserved("data",e),this.emitReserved("success"),this.cleanup())}},{key:"abort",value:function(){this.cleanup()}}]),n}(pn);if(Zn.requestsCount=0,Zn.requests={},"undefined"!==typeof document)if("function"===typeof attachEvent)attachEvent("onunload",Dn);else if("function"===typeof addEventListener){addEventListener("onpagehide"in vn?"pagehide":"unload",Dn,!1)}function Dn(){for(var e in Zn.requests)Zn.requests.hasOwnProperty(e)&&Zn.requests[e].abort()}var Ln="function"===typeof Promise&&"function"===typeof Promise.resolve?function(e){return Promise.resolve().then(e)}:function(e,t){return t(e,0)},Bn=vn.WebSocket||vn.MozWebSocket,qn="undefined"!==typeof navigator&&"string"===typeof navigator.product&&"reactnative"===navigator.product.toLowerCase(),jn=function(e){(0,a.Z)(n,e);var t=(0,s.Z)(n);function n(e){var r;return(0,i.Z)(this,n),(r=t.call(this,e)).supportsBinary=!e.forceBase64,r}return(0,o.Z)(n,[{key:"name",get:function(){return"websocket"}},{key:"doOpen",value:function(){if(this.check()){var e=this.uri(),t=this.opts.protocols,n=qn?{}:gn(this.opts,"agent","perMessageDeflate","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","localAddress","protocolVersion","origin","maxPayload","family","checkServerIdentity");this.opts.extraHeaders&&(n.headers=this.opts.extraHeaders);try{this.ws=qn?new Bn(e,t,n):t?new Bn(e,t):new Bn(e)}catch(Ji){return this.emitReserved("error",Ji)}this.ws.binaryType=this.socket.binaryType,this.addEventListeners()}}},{key:"addEventListeners",value:function(){var e=this;this.ws.onopen=function(){e.opts.autoUnref&&e.ws._socket.unref(),e.onOpen()},this.ws.onclose=function(t){return e.onClose({description:"websocket connection closed",context:t})},this.ws.onmessage=function(t){return e.onData(t.data)},this.ws.onerror=function(t){return e.onError("websocket error",t)}}},{key:"write",value:function(e){var t=this;this.writable=!1;for(var n=function(){var n=e[r],i=r===e.length-1;Xt(n,t.supportsBinary,(function(e){try{t.ws.send(e)}catch(n){}i&&Ln((function(){t.writable=!0,t.emitReserved("drain")}),t.setTimeoutFn)}))},r=0;r<e.length;r++)n()}},{key:"doClose",value:function(){"undefined"!==typeof this.ws&&(this.ws.close(),this.ws=null)}},{key:"uri",value:function(){var e=this.opts.secure?"wss":"ws",t=this.query||{};return this.opts.timestampRequests&&(t[this.opts.timestampParam]=Rn()),this.supportsBinary||(t.b64=1),this.createUri(e,t)}},{key:"check",value:function(){return!!Bn}}]),n}(kn),Un=function(e){(0,a.Z)(n,e);var t=(0,s.Z)(n);function n(){return(0,i.Z)(this,n),t.apply(this,arguments)}return(0,o.Z)(n,[{key:"name",get:function(){return"webtransport"}},{key:"doOpen",value:function(){var e=this;"function"===typeof WebTransport&&(this.transport=new WebTransport(this.createUri("https"),this.opts.transportOptions[this.name]),this.transport.closed.then((function(){e.onClose()})).catch((function(t){e.onError("webtransport error",t)})),this.transport.ready.then((function(){e.transport.createBidirectionalStream().then((function(t){var n=function(e,t){on||(on=new TextDecoder);var n=[],r=0,i=-1,o=!1;return new TransformStream({transform:function(a,s){for(n.push(a);;){if(0===r){if(hn(n)<1)break;var u=fn(n,1);o=128===(128&u[0]),i=127&u[0],r=i<126?3:126===i?1:2}else if(1===r){if(hn(n)<2)break;var c=fn(n,2);i=new DataView(c.buffer,c.byteOffset,c.length).getUint16(0),r=3}else if(2===r){if(hn(n)<8)break;var l=fn(n,8),d=new DataView(l.buffer,l.byteOffset,l.length),h=d.getUint32(0);if(h>Math.pow(2,21)-1){s.enqueue(Wt);break}i=h*Math.pow(2,32)+d.getUint32(4),r=3}else{if(hn(n)<i)break;var f=fn(n,i);s.enqueue(sn(o?f:on.decode(f),t)),r=0}if(0===i||i>e){s.enqueue(Wt);break}}}})}(Number.MAX_SAFE_INTEGER,e.socket.binaryType),r=t.readable.pipeThrough(n).getReader(),i=dn();i.readable.pipeTo(t.writable),e.writer=i.writable.getWriter();!function t(){r.read().then((function(n){var r=n.done,i=n.value;r||(e.onPacket(i),t())})).catch((function(e){}))}();var o={type:"open"};e.query.sid&&(o.data='{"sid":"'.concat(e.query.sid,'"}')),e.writer.write(o).then((function(){return e.onOpen()}))}))})))}},{key:"write",value:function(e){var t=this;this.writable=!1;for(var n=function(){var n=e[r],i=r===e.length-1;t.writer.write(n).then((function(){i&&Ln((function(){t.writable=!0,t.emitReserved("drain")}),t.setTimeoutFn)}))},r=0;r<e.length;r++)n()}},{key:"doClose",value:function(){var e;null===(e=this.transport)||void 0===e||e.close()}}]),n}(kn),Hn={websocket:jn,webtransport:Un,polling:Fn},zn=/^(?:(?![^:@\/?#]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@\/?#]*)(?::([^:@\/?#]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,Vn=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];function Gn(e){var t=e,n=e.indexOf("["),r=e.indexOf("]");-1!=n&&-1!=r&&(e=e.substring(0,n)+e.substring(n,r).replace(/:/g,";")+e.substring(r,e.length));for(var i=zn.exec(e||""),o={},a=14;a--;)o[Vn[a]]=i[a]||"";return-1!=n&&-1!=r&&(o.source=t,o.host=o.host.substring(1,o.host.length-1).replace(/;/g,":"),o.authority=o.authority.replace("[","").replace("]","").replace(/;/g,":"),o.ipv6uri=!0),o.pathNames=function(e,t){var n=/\/{2,9}/g,r=t.replace(n,"/").split("/");"/"!=t.slice(0,1)&&0!==t.length||r.splice(0,1);"/"==t.slice(-1)&&r.splice(r.length-1,1);return r}(0,o.path),o.queryKey=function(e,t){var n={};return t.replace(/(?:^|&)([^&=]*)=?([^&]*)/g,(function(e,t,r){t&&(n[t]=r)})),n}(0,o.query),o}var Kn=function(e){(0,a.Z)(n,e);var t=(0,s.Z)(n);function n(e){var r,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,i.Z)(this,n),(r=t.call(this)).binaryType="arraybuffer",r.writeBuffer=[],e&&"object"===typeof e&&(o=e,e=null),e?(e=Gn(e),o.hostname=e.host,o.secure="https"===e.protocol||"wss"===e.protocol,o.port=e.port,e.query&&(o.query=e.query)):o.host&&(o.hostname=Gn(o.host).host),bn((0,ne.Z)(r),o),r.secure=null!=o.secure?o.secure:"undefined"!==typeof location&&"https:"===location.protocol,o.hostname&&!o.port&&(o.port=r.secure?"443":"80"),r.hostname=o.hostname||("undefined"!==typeof location?location.hostname:"localhost"),r.port=o.port||("undefined"!==typeof location&&location.port?location.port:r.secure?"443":"80"),r.transports=o.transports||["polling","websocket","webtransport"],r.writeBuffer=[],r.prevBufferLen=0,r.opts=Object.assign({path:"/engine.io",agent:!1,withCredentials:!1,upgrade:!0,timestampParam:"t",rememberUpgrade:!1,addTrailingSlash:!0,rejectUnauthorized:!0,perMessageDeflate:{threshold:1024},transportOptions:{},closeOnBeforeunload:!1},o),r.opts.path=r.opts.path.replace(/\/$/,"")+(r.opts.addTrailingSlash?"/":""),"string"===typeof r.opts.query&&(r.opts.query=function(e){for(var t={},n=e.split("&"),r=0,i=n.length;r<i;r++){var o=n[r].split("=");t[decodeURIComponent(o[0])]=decodeURIComponent(o[1])}return t}(r.opts.query)),r.id=null,r.upgrades=null,r.pingInterval=null,r.pingTimeout=null,r.pingTimeoutTimer=null,"function"===typeof addEventListener&&(r.opts.closeOnBeforeunload&&(r.beforeunloadEventListener=function(){r.transport&&(r.transport.removeAllListeners(),r.transport.close())},addEventListener("beforeunload",r.beforeunloadEventListener,!1)),"localhost"!==r.hostname&&(r.offlineEventListener=function(){r.onClose("transport close",{description:"network connection lost"})},addEventListener("offline",r.offlineEventListener,!1))),r.open(),r}return(0,o.Z)(n,[{key:"createTransport",value:function(e){var t=Object.assign({},this.opts.query);t.EIO=4,t.transport=e,this.id&&(t.sid=this.id);var n=Object.assign({},this.opts,{query:t,socket:this,hostname:this.hostname,secure:this.secure,port:this.port},this.opts.transportOptions[e]);return new Hn[e](n)}},{key:"open",value:function(){var e,t=this;if(this.opts.rememberUpgrade&&n.priorWebsocketSuccess&&-1!==this.transports.indexOf("websocket"))e="websocket";else{if(0===this.transports.length)return void this.setTimeoutFn((function(){t.emitReserved("error","No transports available")}),0);e=this.transports[0]}this.readyState="opening";try{e=this.createTransport(e)}catch(r){return this.transports.shift(),void this.open()}e.open(),this.setTransport(e)}},{key:"setTransport",value:function(e){var t=this;this.transport&&this.transport.removeAllListeners(),this.transport=e,e.on("drain",this.onDrain.bind(this)).on("packet",this.onPacket.bind(this)).on("error",this.onError.bind(this)).on("close",(function(e){return t.onClose("transport close",e)}))}},{key:"probe",value:function(e){var t=this,r=this.createTransport(e),i=!1;n.priorWebsocketSuccess=!1;var o=function(){i||(r.send([{type:"ping",data:"probe"}]),r.once("packet",(function(e){if(!i)if("pong"===e.type&&"probe"===e.data){if(t.upgrading=!0,t.emitReserved("upgrading",r),!r)return;n.priorWebsocketSuccess="websocket"===r.name,t.transport.pause((function(){i||"closed"!==t.readyState&&(d(),t.setTransport(r),r.send([{type:"upgrade"}]),t.emitReserved("upgrade",r),r=null,t.upgrading=!1,t.flush())}))}else{var o=new Error("probe error");o.transport=r.name,t.emitReserved("upgradeError",o)}})))};function a(){i||(i=!0,d(),r.close(),r=null)}var s=function(e){var n=new Error("probe error: "+e);n.transport=r.name,a(),t.emitReserved("upgradeError",n)};function u(){s("transport closed")}function c(){s("socket closed")}function l(e){r&&e.name!==r.name&&a()}var d=function(){r.removeListener("open",o),r.removeListener("error",s),r.removeListener("close",u),t.off("close",c),t.off("upgrading",l)};r.once("open",o),r.once("error",s),r.once("close",u),this.once("close",c),this.once("upgrading",l),-1!==this.upgrades.indexOf("webtransport")&&"webtransport"!==e?this.setTimeoutFn((function(){i||r.open()}),200):r.open()}},{key:"onOpen",value:function(){if(this.readyState="open",n.priorWebsocketSuccess="websocket"===this.transport.name,this.emitReserved("open"),this.flush(),"open"===this.readyState&&this.opts.upgrade)for(var e=0,t=this.upgrades.length;e<t;e++)this.probe(this.upgrades[e])}},{key:"onPacket",value:function(e){if("opening"===this.readyState||"open"===this.readyState||"closing"===this.readyState)switch(this.emitReserved("packet",e),this.emitReserved("heartbeat"),this.resetPingTimeout(),e.type){case"open":this.onHandshake(JSON.parse(e.data));break;case"ping":this.sendPacket("pong"),this.emitReserved("ping"),this.emitReserved("pong");break;case"error":var t=new Error("server error");t.code=e.data,this.onError(t);break;case"message":this.emitReserved("data",e.data),this.emitReserved("message",e.data)}}},{key:"onHandshake",value:function(e){this.emitReserved("handshake",e),this.id=e.sid,this.transport.query.sid=e.sid,this.upgrades=this.filterUpgrades(e.upgrades),this.pingInterval=e.pingInterval,this.pingTimeout=e.pingTimeout,this.maxPayload=e.maxPayload,this.onOpen(),"closed"!==this.readyState&&this.resetPingTimeout()}},{key:"resetPingTimeout",value:function(){var e=this;this.clearTimeoutFn(this.pingTimeoutTimer),this.pingTimeoutTimer=this.setTimeoutFn((function(){e.onClose("ping timeout")}),this.pingInterval+this.pingTimeout),this.opts.autoUnref&&this.pingTimeoutTimer.unref()}},{key:"onDrain",value:function(){this.writeBuffer.splice(0,this.prevBufferLen),this.prevBufferLen=0,0===this.writeBuffer.length?this.emitReserved("drain"):this.flush()}},{key:"flush",value:function(){if("closed"!==this.readyState&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length){var e=this.getWritablePackets();this.transport.send(e),this.prevBufferLen=e.length,this.emitReserved("flush")}}},{key:"getWritablePackets",value:function(){if(!(this.maxPayload&&"polling"===this.transport.name&&this.writeBuffer.length>1))return this.writeBuffer;for(var e,t=1,n=0;n<this.writeBuffer.length;n++){var r=this.writeBuffer[n].data;if(r&&(t+="string"===typeof(e=r)?function(e){for(var t=0,n=0,r=0,i=e.length;r<i;r++)(t=e.charCodeAt(r))<128?n+=1:t<2048?n+=2:t<55296||t>=57344?n+=3:(r++,n+=4);return n}(e):Math.ceil(1.33*(e.byteLength||e.size))),n>0&&t>this.maxPayload)return this.writeBuffer.slice(0,n);t+=2}return this.writeBuffer}},{key:"write",value:function(e,t,n){return this.sendPacket("message",e,t,n),this}},{key:"send",value:function(e,t,n){return this.sendPacket("message",e,t,n),this}},{key:"sendPacket",value:function(e,t,n,r){if("function"===typeof t&&(r=t,t=void 0),"function"===typeof n&&(r=n,n=null),"closing"!==this.readyState&&"closed"!==this.readyState){(n=n||{}).compress=!1!==n.compress;var i={type:e,data:t,options:n};this.emitReserved("packetCreate",i),this.writeBuffer.push(i),r&&this.once("flush",r),this.flush()}}},{key:"close",value:function(){var e=this,t=function(){e.onClose("forced close"),e.transport.close()},n=function n(){e.off("upgrade",n),e.off("upgradeError",n),t()},r=function(){e.once("upgrade",n),e.once("upgradeError",n)};return"opening"!==this.readyState&&"open"!==this.readyState||(this.readyState="closing",this.writeBuffer.length?this.once("drain",(function(){e.upgrading?r():t()})):this.upgrading?r():t()),this}},{key:"onError",value:function(e){n.priorWebsocketSuccess=!1,this.emitReserved("error",e),this.onClose("transport error",e)}},{key:"onClose",value:function(e,t){"opening"!==this.readyState&&"open"!==this.readyState&&"closing"!==this.readyState||(this.clearTimeoutFn(this.pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),"function"===typeof removeEventListener&&(removeEventListener("beforeunload",this.beforeunloadEventListener,!1),removeEventListener("offline",this.offlineEventListener,!1)),this.readyState="closed",this.id=null,this.emitReserved("close",e,t),this.writeBuffer=[],this.prevBufferLen=0)}},{key:"filterUpgrades",value:function(e){for(var t=[],n=0,r=e.length;n<r;n++)~this.transports.indexOf(e[n])&&t.push(e[n]);return t}}]),n}(pn);Kn.protocol=4;Kn.protocol;var Wn="function"===typeof ArrayBuffer,Jn=function(e){return"function"===typeof ArrayBuffer.isView?ArrayBuffer.isView(e):e.buffer instanceof ArrayBuffer},Qn=Object.prototype.toString,Yn="function"===typeof Blob||"undefined"!==typeof Blob&&"[object BlobConstructor]"===Qn.call(Blob),Xn="function"===typeof File||"undefined"!==typeof File&&"[object FileConstructor]"===Qn.call(File);function $n(e){return Wn&&(e instanceof ArrayBuffer||Jn(e))||Yn&&e instanceof Blob||Xn&&e instanceof File}function er(e,t){if(!e||"object"!==typeof e)return!1;if(Array.isArray(e)){for(var n=0,r=e.length;n<r;n++)if(er(e[n]))return!0;return!1}if($n(e))return!0;if(e.toJSON&&"function"===typeof e.toJSON&&1===arguments.length)return er(e.toJSON(),!0);for(var i in e)if(Object.prototype.hasOwnProperty.call(e,i)&&er(e[i]))return!0;return!1}function tr(e){var t=[],n=e.data,r=e;return r.data=nr(n,t),r.attachments=t.length,{packet:r,buffers:t}}function nr(e,t){if(!e)return e;if($n(e)){var n={_placeholder:!0,num:t.length};return t.push(e),n}if(Array.isArray(e)){for(var r=new Array(e.length),i=0;i<e.length;i++)r[i]=nr(e[i],t);return r}if("object"===typeof e&&!(e instanceof Date)){var o={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(o[a]=nr(e[a],t));return o}return e}function rr(e,t){return e.data=ir(e.data,t),delete e.attachments,e}function ir(e,t){if(!e)return e;if(e&&!0===e._placeholder){if("number"===typeof e.num&&e.num>=0&&e.num<t.length)return t[e.num];throw new Error("illegal attachments")}if(Array.isArray(e))for(var n=0;n<e.length;n++)e[n]=ir(e[n],t);else if("object"===typeof e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(e[r]=ir(e[r],t));return e}var or,ar=["connect","connect_error","disconnect","disconnecting","newListener","removeListener"],sr=5;!function(e){e[e.CONNECT=0]="CONNECT",e[e.DISCONNECT=1]="DISCONNECT",e[e.EVENT=2]="EVENT",e[e.ACK=3]="ACK",e[e.CONNECT_ERROR=4]="CONNECT_ERROR",e[e.BINARY_EVENT=5]="BINARY_EVENT",e[e.BINARY_ACK=6]="BINARY_ACK"}(or||(or={}));var ur=function(){function e(t){(0,i.Z)(this,e),this.replacer=t}return(0,o.Z)(e,[{key:"encode",value:function(e){return e.type!==or.EVENT&&e.type!==or.ACK||!er(e)?[this.encodeAsString(e)]:this.encodeAsBinary({type:e.type===or.EVENT?or.BINARY_EVENT:or.BINARY_ACK,nsp:e.nsp,data:e.data,id:e.id})}},{key:"encodeAsString",value:function(e){var t=""+e.type;return e.type!==or.BINARY_EVENT&&e.type!==or.BINARY_ACK||(t+=e.attachments+"-"),e.nsp&&"/"!==e.nsp&&(t+=e.nsp+","),null!=e.id&&(t+=e.id),null!=e.data&&(t+=JSON.stringify(e.data,this.replacer)),t}},{key:"encodeAsBinary",value:function(e){var t=tr(e),n=this.encodeAsString(t.packet),r=t.buffers;return r.unshift(n),r}}]),e}();function cr(e){return"[object Object]"===Object.prototype.toString.call(e)}var lr=function(e){(0,a.Z)(n,e);var t=(0,s.Z)(n);function n(e){var r;return(0,i.Z)(this,n),(r=t.call(this)).reviver=e,r}return(0,o.Z)(n,[{key:"add",value:function(e){var t;if("string"===typeof e){if(this.reconstructor)throw new Error("got plaintext data when reconstructing a packet");var r=(t=this.decodeString(e)).type===or.BINARY_EVENT;r||t.type===or.BINARY_ACK?(t.type=r?or.EVENT:or.ACK,this.reconstructor=new dr(t),0===t.attachments&&(0,Q.Z)((0,Y.Z)(n.prototype),"emitReserved",this).call(this,"decoded",t)):(0,Q.Z)((0,Y.Z)(n.prototype),"emitReserved",this).call(this,"decoded",t)}else{if(!$n(e)&&!e.base64)throw new Error("Unknown type: "+e);if(!this.reconstructor)throw new Error("got binary data when not reconstructing a packet");(t=this.reconstructor.takeBinaryData(e))&&(this.reconstructor=null,(0,Q.Z)((0,Y.Z)(n.prototype),"emitReserved",this).call(this,"decoded",t))}}},{key:"decodeString",value:function(e){var t=0,r={type:Number(e.charAt(0))};if(void 0===or[r.type])throw new Error("unknown packet type "+r.type);if(r.type===or.BINARY_EVENT||r.type===or.BINARY_ACK){for(var i=t+1;"-"!==e.charAt(++t)&&t!=e.length;);var o=e.substring(i,t);if(o!=Number(o)||"-"!==e.charAt(t))throw new Error("Illegal attachments");r.attachments=Number(o)}if("/"===e.charAt(t+1)){for(var a=t+1;++t;){if(","===e.charAt(t))break;if(t===e.length)break}r.nsp=e.substring(a,t)}else r.nsp="/";var s=e.charAt(t+1);if(""!==s&&Number(s)==s){for(var u=t+1;++t;){var c=e.charAt(t);if(null==c||Number(c)!=c){--t;break}if(t===e.length)break}r.id=Number(e.substring(u,t+1))}if(e.charAt(++t)){var l=this.tryParse(e.substr(t));if(!n.isPayloadValid(r.type,l))throw new Error("invalid payload");r.data=l}return r}},{key:"tryParse",value:function(e){try{return JSON.parse(e,this.reviver)}catch(t){return!1}}},{key:"destroy",value:function(){this.reconstructor&&(this.reconstructor.finishedReconstruction(),this.reconstructor=null)}}],[{key:"isPayloadValid",value:function(e,t){switch(e){case or.CONNECT:return cr(t);case or.DISCONNECT:return void 0===t;case or.CONNECT_ERROR:return"string"===typeof t||cr(t);case or.EVENT:case or.BINARY_EVENT:return Array.isArray(t)&&("number"===typeof t[0]||"string"===typeof t[0]&&-1===ar.indexOf(t[0]));case or.ACK:case or.BINARY_ACK:return Array.isArray(t)}}}]),n}(pn),dr=function(){function e(t){(0,i.Z)(this,e),this.packet=t,this.buffers=[],this.reconPack=t}return(0,o.Z)(e,[{key:"takeBinaryData",value:function(e){if(this.buffers.push(e),this.buffers.length===this.reconPack.attachments){var t=rr(this.reconPack,this.buffers);return this.finishedReconstruction(),t}return null}},{key:"finishedReconstruction",value:function(){this.reconPack=null,this.buffers=[]}}]),e}();function hr(e,t,n){return e.on(t,n),function(){e.off(t,n)}}var fr=Object.freeze({connect:1,connect_error:1,disconnect:1,disconnecting:1,newListener:1,removeListener:1}),pr=function(e){(0,a.Z)(n,e);var t=(0,s.Z)(n);function n(e,r,o){var a;return(0,i.Z)(this,n),(a=t.call(this)).connected=!1,a.recovered=!1,a.receiveBuffer=[],a.sendBuffer=[],a._queue=[],a._queueSeq=0,a.ids=0,a.acks={},a.flags={},a.io=e,a.nsp=r,o&&o.auth&&(a.auth=o.auth),a._opts=Object.assign({},o),a.io._autoConnect&&a.open(),a}return(0,o.Z)(n,[{key:"disconnected",get:function(){return!this.connected}},{key:"subEvents",value:function(){if(!this.subs){var e=this.io;this.subs=[hr(e,"open",this.onopen.bind(this)),hr(e,"packet",this.onpacket.bind(this)),hr(e,"error",this.onerror.bind(this)),hr(e,"close",this.onclose.bind(this))]}}},{key:"active",get:function(){return!!this.subs}},{key:"connect",value:function(){return this.connected||(this.subEvents(),this.io._reconnecting||this.io.open(),"open"===this.io._readyState&&this.onopen()),this}},{key:"open",value:function(){return this.connect()}},{key:"send",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return t.unshift("message"),this.emit.apply(this,t),this}},{key:"emit",value:function(e){if(fr.hasOwnProperty(e))throw new Error('"'+e.toString()+'" is a reserved event name');for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];if(n.unshift(e),this._opts.retries&&!this.flags.fromQueue&&!this.flags.volatile)return this._addToQueue(n),this;var i={type:or.EVENT,data:n,options:{}};if(i.options.compress=!1!==this.flags.compress,"function"===typeof n[n.length-1]){var o=this.ids++,a=n.pop();this._registerAckCallback(o,a),i.id=o}var s=this.io.engine&&this.io.engine.transport&&this.io.engine.transport.writable;return this.flags.volatile&&(!s||!this.connected)||(this.connected?(this.notifyOutgoingListeners(i),this.packet(i)):this.sendBuffer.push(i)),this.flags={},this}},{key:"_registerAckCallback",value:function(e,t){var n,r=this,i=null!==(n=this.flags.timeout)&&void 0!==n?n:this._opts.ackTimeout;if(void 0!==i){var o=this.io.setTimeoutFn((function(){delete r.acks[e];for(var n=0;n<r.sendBuffer.length;n++)r.sendBuffer[n].id===e&&r.sendBuffer.splice(n,1);t.call(r,new Error("operation has timed out"))}),i);this.acks[e]=function(){r.io.clearTimeoutFn(o);for(var e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];t.apply(r,[null].concat(n))}}else this.acks[e]=t}},{key:"emitWithAck",value:function(e){for(var t=this,n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];var o=void 0!==this.flags.timeout||void 0!==this._opts.ackTimeout;return new Promise((function(n,i){r.push((function(e,t){return o?e?i(e):n(t):n(e)})),t.emit.apply(t,[e].concat(r))}))}},{key:"_addToQueue",value:function(e){var t,n=this;"function"===typeof e[e.length-1]&&(t=e.pop());var r={id:this._queueSeq++,tryCount:0,pending:!1,args:e,flags:Object.assign({fromQueue:!0},this.flags)};e.push((function(e){if(r===n._queue[0]){if(null!==e)r.tryCount>n._opts.retries&&(n._queue.shift(),t&&t(e));else if(n._queue.shift(),t){for(var i=arguments.length,o=new Array(i>1?i-1:0),a=1;a<i;a++)o[a-1]=arguments[a];t.apply(void 0,[null].concat(o))}return r.pending=!1,n._drainQueue()}})),this._queue.push(r),this._drainQueue()}},{key:"_drainQueue",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.connected&&0!==this._queue.length){var t=this._queue[0];t.pending&&!e||(t.pending=!0,t.tryCount++,this.flags=t.flags,this.emit.apply(this,t.args))}}},{key:"packet",value:function(e){e.nsp=this.nsp,this.io._packet(e)}},{key:"onopen",value:function(){var e=this;"function"==typeof this.auth?this.auth((function(t){e._sendConnectPacket(t)})):this._sendConnectPacket(this.auth)}},{key:"_sendConnectPacket",value:function(e){this.packet({type:or.CONNECT,data:this._pid?Object.assign({pid:this._pid,offset:this._lastOffset},e):e})}},{key:"onerror",value:function(e){this.connected||this.emitReserved("connect_error",e)}},{key:"onclose",value:function(e,t){this.connected=!1,delete this.id,this.emitReserved("disconnect",e,t)}},{key:"onpacket",value:function(e){if(e.nsp===this.nsp)switch(e.type){case or.CONNECT:e.data&&e.data.sid?this.onconnect(e.data.sid,e.data.pid):this.emitReserved("connect_error",new Error("It seems you are trying to reach a Socket.IO server in v2.x with a v3.x client, but they are not compatible (more information here: https://socket.io/docs/v3/migrating-from-2-x-to-3-0/)"));break;case or.EVENT:case or.BINARY_EVENT:this.onevent(e);break;case or.ACK:case or.BINARY_ACK:this.onack(e);break;case or.DISCONNECT:this.ondisconnect();break;case or.CONNECT_ERROR:this.destroy();var t=new Error(e.data.message);t.data=e.data.data,this.emitReserved("connect_error",t)}}},{key:"onevent",value:function(e){var t=e.data||[];null!=e.id&&t.push(this.ack(e.id)),this.connected?this.emitEvent(t):this.receiveBuffer.push(Object.freeze(t))}},{key:"emitEvent",value:function(e){if(this._anyListeners&&this._anyListeners.length){var t,r=this._anyListeners.slice(),i=(0,w.Z)(r);try{for(i.s();!(t=i.n()).done;){t.value.apply(this,e)}}catch(Ji){i.e(Ji)}finally{i.f()}}(0,Q.Z)((0,Y.Z)(n.prototype),"emit",this).apply(this,e),this._pid&&e.length&&"string"===typeof e[e.length-1]&&(this._lastOffset=e[e.length-1])}},{key:"ack",value:function(e){var t=this,n=!1;return function(){if(!n){n=!0;for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];t.packet({type:or.ACK,id:e,data:i})}}}},{key:"onack",value:function(e){var t=this.acks[e.id];"function"===typeof t&&(t.apply(this,e.data),delete this.acks[e.id])}},{key:"onconnect",value:function(e,t){this.id=e,this.recovered=t&&this._pid===t,this._pid=t,this.connected=!0,this.emitBuffered(),this.emitReserved("connect"),this._drainQueue(!0)}},{key:"emitBuffered",value:function(){var e=this;this.receiveBuffer.forEach((function(t){return e.emitEvent(t)})),this.receiveBuffer=[],this.sendBuffer.forEach((function(t){e.notifyOutgoingListeners(t),e.packet(t)})),this.sendBuffer=[]}},{key:"ondisconnect",value:function(){this.destroy(),this.onclose("io server disconnect")}},{key:"destroy",value:function(){this.subs&&(this.subs.forEach((function(e){return e()})),this.subs=void 0),this.io._destroy(this)}},{key:"disconnect",value:function(){return this.connected&&this.packet({type:or.DISCONNECT}),this.destroy(),this.connected&&this.onclose("io client disconnect"),this}},{key:"close",value:function(){return this.disconnect()}},{key:"compress",value:function(e){return this.flags.compress=e,this}},{key:"volatile",get:function(){return this.flags.volatile=!0,this}},{key:"timeout",value:function(e){return this.flags.timeout=e,this}},{key:"onAny",value:function(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.push(e),this}},{key:"prependAny",value:function(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.unshift(e),this}},{key:"offAny",value:function(e){if(!this._anyListeners)return this;if(e){for(var t=this._anyListeners,n=0;n<t.length;n++)if(e===t[n])return t.splice(n,1),this}else this._anyListeners=[];return this}},{key:"listenersAny",value:function(){return this._anyListeners||[]}},{key:"onAnyOutgoing",value:function(e){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.push(e),this}},{key:"prependAnyOutgoing",value:function(e){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.unshift(e),this}},{key:"offAnyOutgoing",value:function(e){if(!this._anyOutgoingListeners)return this;if(e){for(var t=this._anyOutgoingListeners,n=0;n<t.length;n++)if(e===t[n])return t.splice(n,1),this}else this._anyOutgoingListeners=[];return this}},{key:"listenersAnyOutgoing",value:function(){return this._anyOutgoingListeners||[]}},{key:"notifyOutgoingListeners",value:function(e){if(this._anyOutgoingListeners&&this._anyOutgoingListeners.length){var t,n=this._anyOutgoingListeners.slice(),r=(0,w.Z)(n);try{for(r.s();!(t=r.n()).done;){t.value.apply(this,e.data)}}catch(Ji){r.e(Ji)}finally{r.f()}}}}]),n}(pn);function vr(e){e=e||{},this.ms=e.min||100,this.max=e.max||1e4,this.factor=e.factor||2,this.jitter=e.jitter>0&&e.jitter<=1?e.jitter:0,this.attempts=0}vr.prototype.duration=function(){var e=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var t=Math.random(),n=Math.floor(t*this.jitter*e);e=0==(1&Math.floor(10*t))?e-n:e+n}return 0|Math.min(e,this.max)},vr.prototype.reset=function(){this.attempts=0},vr.prototype.setMin=function(e){this.ms=e},vr.prototype.setMax=function(e){this.max=e},vr.prototype.setJitter=function(e){this.jitter=e};var gr=function(e){(0,a.Z)(n,e);var t=(0,s.Z)(n);function n(e,o){var a,s;(0,i.Z)(this,n),(a=t.call(this)).nsps={},a.subs=[],e&&"object"===typeof e&&(o=e,e=void 0),(o=o||{}).path=o.path||"/socket.io",a.opts=o,bn((0,ne.Z)(a),o),a.reconnection(!1!==o.reconnection),a.reconnectionAttempts(o.reconnectionAttempts||1/0),a.reconnectionDelay(o.reconnectionDelay||1e3),a.reconnectionDelayMax(o.reconnectionDelayMax||5e3),a.randomizationFactor(null!==(s=o.randomizationFactor)&&void 0!==s?s:.5),a.backoff=new vr({min:a.reconnectionDelay(),max:a.reconnectionDelayMax(),jitter:a.randomizationFactor()}),a.timeout(null==o.timeout?2e4:o.timeout),a._readyState="closed",a.uri=e;var u=o.parser||r;return a.encoder=new u.Encoder,a.decoder=new u.Decoder,a._autoConnect=!1!==o.autoConnect,a._autoConnect&&a.open(),a}return(0,o.Z)(n,[{key:"reconnection",value:function(e){return arguments.length?(this._reconnection=!!e,this):this._reconnection}},{key:"reconnectionAttempts",value:function(e){return void 0===e?this._reconnectionAttempts:(this._reconnectionAttempts=e,this)}},{key:"reconnectionDelay",value:function(e){var t;return void 0===e?this._reconnectionDelay:(this._reconnectionDelay=e,null===(t=this.backoff)||void 0===t||t.setMin(e),this)}},{key:"randomizationFactor",value:function(e){var t;return void 0===e?this._randomizationFactor:(this._randomizationFactor=e,null===(t=this.backoff)||void 0===t||t.setJitter(e),this)}},{key:"reconnectionDelayMax",value:function(e){var t;return void 0===e?this._reconnectionDelayMax:(this._reconnectionDelayMax=e,null===(t=this.backoff)||void 0===t||t.setMax(e),this)}},{key:"timeout",value:function(e){return arguments.length?(this._timeout=e,this):this._timeout}},{key:"maybeReconnectOnOpen",value:function(){!this._reconnecting&&this._reconnection&&0===this.backoff.attempts&&this.reconnect()}},{key:"open",value:function(e){var t=this;if(~this._readyState.indexOf("open"))return this;this.engine=new Kn(this.uri,this.opts);var n=this.engine,r=this;this._readyState="opening",this.skipReconnect=!1;var i=hr(n,"open",(function(){r.onopen(),e&&e()})),o=function(n){t.cleanup(),t._readyState="closed",t.emitReserved("error",n),e?e(n):t.maybeReconnectOnOpen()},a=hr(n,"error",o);if(!1!==this._timeout){var s=this._timeout,u=this.setTimeoutFn((function(){i(),o(new Error("timeout")),n.close()}),s);this.opts.autoUnref&&u.unref(),this.subs.push((function(){t.clearTimeoutFn(u)}))}return this.subs.push(i),this.subs.push(a),this}},{key:"connect",value:function(e){return this.open(e)}},{key:"onopen",value:function(){this.cleanup(),this._readyState="open",this.emitReserved("open");var e=this.engine;this.subs.push(hr(e,"ping",this.onping.bind(this)),hr(e,"data",this.ondata.bind(this)),hr(e,"error",this.onerror.bind(this)),hr(e,"close",this.onclose.bind(this)),hr(this.decoder,"decoded",this.ondecoded.bind(this)))}},{key:"onping",value:function(){this.emitReserved("ping")}},{key:"ondata",value:function(e){try{this.decoder.add(e)}catch(t){this.onclose("parse error",t)}}},{key:"ondecoded",value:function(e){var t=this;Ln((function(){t.emitReserved("packet",e)}),this.setTimeoutFn)}},{key:"onerror",value:function(e){this.emitReserved("error",e)}},{key:"socket",value:function(e,t){var n=this.nsps[e];return n?this._autoConnect&&!n.active&&n.connect():(n=new pr(this,e,t),this.nsps[e]=n),n}},{key:"_destroy",value:function(e){for(var t=0,n=Object.keys(this.nsps);t<n.length;t++){var r=n[t];if(this.nsps[r].active)return}this._close()}},{key:"_packet",value:function(e){for(var t=this.encoder.encode(e),n=0;n<t.length;n++)this.engine.write(t[n],e.options)}},{key:"cleanup",value:function(){this.subs.forEach((function(e){return e()})),this.subs.length=0,this.decoder.destroy()}},{key:"_close",value:function(){this.skipReconnect=!0,this._reconnecting=!1,this.onclose("forced close"),this.engine&&this.engine.close()}},{key:"disconnect",value:function(){return this._close()}},{key:"onclose",value:function(e,t){this.cleanup(),this.backoff.reset(),this._readyState="closed",this.emitReserved("close",e,t),this._reconnection&&!this.skipReconnect&&this.reconnect()}},{key:"reconnect",value:function(){var e=this;if(this._reconnecting||this.skipReconnect)return this;var t=this;if(this.backoff.attempts>=this._reconnectionAttempts)this.backoff.reset(),this.emitReserved("reconnect_failed"),this._reconnecting=!1;else{var n=this.backoff.duration();this._reconnecting=!0;var r=this.setTimeoutFn((function(){t.skipReconnect||(e.emitReserved("reconnect_attempt",t.backoff.attempts),t.skipReconnect||t.open((function(n){n?(t._reconnecting=!1,t.reconnect(),e.emitReserved("reconnect_error",n)):t.onreconnect()})))}),n);this.opts.autoUnref&&r.unref(),this.subs.push((function(){e.clearTimeoutFn(r)}))}}},{key:"onreconnect",value:function(){var e=this.backoff.attempts;this._reconnecting=!1,this.backoff.reset(),this.emitReserved("reconnect",e)}}]),n}(pn),mr={};function yr(e,t){"object"===typeof e&&(t=e,e=void 0);var n,r=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=arguments.length>2?arguments[2]:void 0,r=e;n=n||"undefined"!==typeof location&&location,null==e&&(e=n.protocol+"//"+n.host),"string"===typeof e&&("/"===e.charAt(0)&&(e="/"===e.charAt(1)?n.protocol+e:n.host+e),/^(https?|wss?):\/\//.test(e)||(e="undefined"!==typeof n?n.protocol+"//"+e:"https://"+e),r=Gn(e)),r.port||(/^(http|ws)$/.test(r.protocol)?r.port="80":/^(http|ws)s$/.test(r.protocol)&&(r.port="443")),r.path=r.path||"/";var i=-1!==r.host.indexOf(":")?"["+r.host+"]":r.host;return r.id=r.protocol+"://"+i+":"+r.port+t,r.href=r.protocol+"://"+i+(n&&n.port===r.port?"":":"+r.port),r}(e,(t=t||{}).path||"/socket.io"),i=r.source,o=r.id,a=r.path,s=mr[o]&&a in mr[o].nsps;return t.forceNew||t["force new connection"]||!1===t.multiplex||s?n=new gr(i,t):(mr[o]||(mr[o]=new gr(i,t)),n=mr[o]),r.query&&!t.query&&(t.query=r.queryKey),n.socket(r.path,t)}Object.assign(yr,{Manager:gr,Socket:pr,io:yr,connect:yr});var br=function(){function e(){var t=this;(0,i.Z)(this,e),this.completed=!1,this.p=new Promise((function(e,n){t.res=e,t.rej=n}))}return(0,o.Z)(e,[{key:"isCompleted",get:function(){return this.completed}},{key:"promise",get:function(){return this.p}},{key:"resolve",value:function(e){void 0!==this.res&&(this.completed=!0,this.res(e))}},{key:"reject",value:function(e){void 0!==this.rej&&(this.completed=!0,this.rej(e))}}]),e}(),wr=(Symbol.toStringTag,1e4),Sr=100,kr=function(){function e(t,n,r,o,a,s){(0,i.Z)(this,e),this.to=n,this.payloadSize=r,this.logger=o,this.requestCallback=a,this.responseCallback=s,this.results=new Map,this.workingState="working",this.requestsInFlight=0,this.endEvent=new br,this.requests=0,this.latestRequested=t,this.nextToDeliver=t,this.knewTo=void 0!==n}return(0,o.Z)(e,[{key:"working",get:function(){return"working"===this.workingState}},{key:"canceled",get:function(){return"canceled"===this.workingState}},{key:"cancel",value:function(){this.working&&(this.workingState="canceled",this.endEvent.resolve())}},{key:"run",value:function(){var e=(0,d.Z)((0,l.Z)().mark((function e(t){var n;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for((0,wt.h)(t>0,258),(0,wt.h)(this.working,259),n=t;n>0;)n--,this.addRequest();return this.dispatch(),e.abrupt("return",this.endEvent.promise);case 6:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"done",value:function(){(0,wt.h)(void 0!==this.to,260),(0,wt.h)(this.nextToDeliver>=this.to,261),this.working&&(this.workingState="done",this.endEvent.resolve())}},{key:"fail",value:function(e){this.working&&(this.workingState="done",this.endEvent.reject(e))}},{key:"dispatch",value:function(){for(;this.working;){var e=this.results.get(this.nextToDeliver);if(void 0===e)break;this.results.delete(this.nextToDeliver),(0,wt.h)(e.length<=this.payloadSize,473),this.nextToDeliver+=e.length,this.responseCallback(e)}this.working&&(0===this.requestsInFlight?((0,wt.h)(0===this.results.size,263),this.done()):void 0!==this.to&&this.nextToDeliver>=this.to&&((0,wt.h)(!this.knewTo,264),this.done()))}},{key:"getNextChunk",value:function(){if(this.working){var e=this.latestRequested;if(!(void 0!==this.to&&this.to<=e))return this.latestRequested+=this.payloadSize,void 0!==this.to&&(this.latestRequested=Math.min(this.to,this.latestRequested)),(0,wt.h)(e<this.latestRequested,265),{from:e,to:this.latestRequested}}}},{key:"addRequest",value:function(){var e=this.getNextChunk();void 0!==e&&this.addRequestCore(e.from,e.to).catch(this.fail.bind(this))}},{key:"addRequestCore",value:function(){var e=(0,d.Z)((0,l.Z)().mark((function e(t,n){var r,i,o,a,s,u,c,d,h,f,p,v,g;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:(0,wt.h)(this.working,266),r=t,i=n,this.requestsInFlight++;case 4:if(!this.working){e.next=41;break}return o=i-r,(0,wt.h)(o>0,267),void 0!==this.to&&((0,wt.h)(r<this.to,268),(0,wt.h)(i<=this.to,269)),this.requests++,a=this.requestCallback(this.requests,r,i,void 0!==this.to,{}),this.dispatch(),e.next=13,a;case 13:if(s=e.sent,u=s.payload,c=s.cancel,d=s.partial,c&&this.cancel(),!(void 0!==this.to&&r>=this.to)){e.next=22;break}return(0,wt.h)(!this.knewTo,270),0!==u.length&&this.logger.sendErrorEvent({eventName:"ParallelRequests_GotExtra",from:r,to:i,end:this.to,length:u.length}),e.abrupt("break",41);case 22:if(!this.working){e.next=39;break}if(h=r,f=u.length,p=o<=f,0!==f?(o<f&&this.logger.sendTelemetryEvent({eventName:"ParallelRequests_Over",from:r,to:i,length:f}),v=u.splice(0,o),this.results.set(r,v),r+=v.length):((0,wt.h)(!d,271),(0,wt.h)(!this.knewTo,272)),d||p){e.next=32;break}if(this.knewTo){e.next=31;break}return(void 0===this.to||this.to>r)&&(this.to=r),e.abrupt("break",41);case 31:this.logger.sendPerformanceEvent({eventName:"ParallelRequests_Partial",from:h,to:i,length:f});case 32:if(i===this.latestRequested&&(0!==u.length&&(this.results.set(r,u),r+=u.length),this.latestRequested=r,p=!0),!p){e.next=39;break}if(void 0!==(g=this.getNextChunk())){e.next=37;break}return e.abrupt("break",41);case 37:r=g.from,i=g.to;case 39:e.next=4;break;case 41:this.requestsInFlight--,this.dispatch();case 43:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()}]),e}(),Cr=function(){function e(){(0,i.Z)(this,e),this.queue=[],this.done=!1}return(0,o.Z)(e,[{key:"pushValue",value:function(e){this.pushCore(Promise.resolve({done:!1,value:e}))}},{key:"pushError",value:function(e){this.pushCore(Promise.reject(e)),this.done=!0}},{key:"pushDone",value:function(){this.pushCore(Promise.resolve({done:!0})),this.done=!0}},{key:"pushCore",value:function(e){(0,wt.h)(!this.done,274),this.deferred?((0,wt.h)(0===this.queue.length,275),this.deferred.resolve(e),this.deferred=void 0):this.queue.push(e)}},{key:"read",value:function(){var e=(0,d.Z)((0,l.Z)().mark((function e(){var t;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((0,wt.h)(void 0===this.deferred,276),void 0===(t=this.queue.shift())){e.next=4;break}return e.abrupt("return",t);case 4:return(0,wt.h)(!this.done,277),this.deferred=new br,e.abrupt("return",this.deferred.promise);case 7:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),e}();function xr(e,t,n,r,i,o){return Er.apply(this,arguments)}function Er(){return Er=(0,d.Z)((0,l.Z)().mark((function e(t,n,r,i,o,a){var s,u,c,d,h,f,p,v,g,m,y,b;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:u=0,c=[],d={partial:!1,cancel:!0,payload:[]};case 3:if(!0===(null===o||void 0===o?void 0:o.aborted)){e.next=39;break}return u++,h=Math.min(wr,Sr*Math.pow(2,u)),f=B.now(),e.prev=7,p=t(Object.assign(Object.assign({},n),{retry:u})),e.next=11,p;case 11:if(v=e.sent,g=v.messages,m=v.partialResult,c.push.apply(c,(0,x.Z)(g)),0===g.length&&r){e.next=18;break}return e.abrupt("return",{payload:c,cancel:!1,partial:m});case 18:if(void 0!==s){e.next=22;break}s=B.now(),e.next=24;break;case 22:if(!(B.now()-s>3e4)){e.next=24;break}throw(0,U.jx)("Failed to retrieve ops from storage (Too Many Retries)",{canRetry:!1},Object.assign({retry:u,driverVersion:H},n));case 24:e.next=35;break;case 26:if(e.prev=26,e.t0=e.catch(7),y=(0,U.ms)(e.t0),s=void 0,b=(0,U.ZZ)(e.t0),et(i,Object.assign(Object.assign({eventName:"GetDeltas_Error"},n),{retry:u,duration:B.now()-f,retryAfter:b,reason:a}),e.t0),y){e.next=34;break}throw e.t0;case 34:void 0!==b&&b>=0&&(h=b);case 35:return e.next=37,tt(h);case 37:e.next=3;break;case 39:return e.abrupt("return",d);case 40:case"end":return e.stop()}}),e,null,[[7,26]])}))),Er.apply(this,arguments)}var Tr={read:function(){var e=(0,d.Z)((0,l.Z)().mark((function e(){return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",{done:!0});case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()};var Ir=function(){function e(){(0,i.Z)(this,e)}return(0,o.Z)(e,[{key:"send",value:function(e){}},{key:"sendTelemetryEvent",value:function(e,t){}},{key:"sendErrorEvent",value:function(e,t){}},{key:"sendPerformanceEvent",value:function(e,t){}}]),e}();var Ar=function(){function e(t,n,r,o){(0,i.Z)(this,e),this.tenantId=t,this.id=n,this.deltaStorageService=r,this.documentStorageService=o,this.logtailSha=this.documentStorageService.logTailSha}return(0,o.Z)(e,[{key:"fetchMessages",value:function(e,t,n,r,i){return r?Tr:function(e,t,n,r,i,o,a,s){var u,c=0,h=0,f=new Cr,p={fromTotal:n,toTotal:r},v=m.Xr.start(o,Object.assign(Object.assign({eventName:"GetDeltas"},p),{reason:s})),g=new kr(n,r,i,o,function(){var t=(0,d.Z)((0,l.Z)().mark((function t(n,r,i,u,h){return(0,l.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return c++,t.abrupt("return",xr(function(){var t=(0,d.Z)((0,l.Z)().mark((function t(n){return(0,l.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",e(r,i,n));case 1:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),Object.assign(Object.assign({request:n,from:r,to:i},p),h),u,o,a,s));case 2:case"end":return t.stop()}}),t)})));return function(e,n,r,i,o){return t.apply(this,arguments)}}(),(function(e){void 0===u?(0,wt.h)(e[0].sequenceNumber===n,621):(0,wt.h)(e[0].sequenceNumber===u+1,622),u=e[e.length-1].sequenceNumber,(0,wt.h)(u-e[0].sequenceNumber+1===e.length,623),h+=e.length,f.pushValue(e)})),y=function(e){g.cancel()};return void 0!==a&&a.addEventListener("abort",y),g.run(t).finally((function(){void 0!==a&&a.removeEventListener("abort",y)})).then((function(){var e={lastFetch:u,length:h,requests:c};g.canceled?v.cancel(Object.assign(Object.assign({},e),{error:"ops request cancelled by client"})):((0,wt.h)(void 0===r||void 0!==u&&u>=r-1,624),v.end(e)),f.pushDone()})).catch((function(e){v.cancel({lastFetch:u,length:h,requests:c},e),f.pushError(e)})),f}(this.getCore.bind(this),1,e,t,2e3,new Ir,n,i)}},{key:"getCore",value:function(){var e=(0,d.Z)((0,l.Z)().mark((function e(t,n){var r,i;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.logtailSha){e.next=6;break}return e.next=3,(0,W.g)(this.documentStorageService,this.logtailSha);case 3:e.t0=e.sent,e.next=7;break;case 6:e.t0=[];case 7:if(r=e.t0,this.logtailSha=void 0,!(r.length>0)){e.next=13;break}if(!((i=r.filter((function(e){return e.sequenceNumber>=t}))).length>0)){e.next=13;break}return e.abrupt("return",{messages:i,partialResult:!0});case 13:return e.abrupt("return",this.deltaStorageService.get(this.tenantId,this.id,t,n));case 14:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()}]),e}(),Rr=function(){function e(t,n,r){var o=this,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:(0,d.Z)((0,l.Z)().mark((function e(){return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",o.restWrapper);case 1:case"end":return e.stop()}}),e)}))),s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:function(){return o.url};(0,i.Z)(this,e),this.url=t,this.restWrapper=n,this.logger=r,this.getRestWrapper=a,this.getDeltaStorageUrl=s}return(0,o.Z)(e,[{key:"get",value:function(){var e=(0,d.Z)((0,l.Z)().mark((function e(t,n,r,i){var o,a=this;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,m.Xr.timedExecAsync(this.logger,{eventName:"getDeltas",from:r,to:i},function(){var e=(0,d.Z)((0,l.Z)().mark((function e(t){var n,o,s;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,a.getRestWrapper();case 2:return n=e.sent,o=a.getDeltaStorageUrl(),e.next=6,n.get(o,{from:r-1,to:i});case 6:return s=e.sent,t.end({count:s.length}),e.abrupt("return",s);case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 2:return o=e.sent,e.abrupt("return",{messages:o,partialResult:!1});case 4:case"end":return e.stop()}}),e,this)})));return function(t,n,r,i){return e.apply(this,arguments)}}()}]),e}(),_r=n(91033),Pr=function(e){(0,a.Z)(n,e);var t=(0,s.Z)(n);function n(){var e;return(0,i.Z)(this,n),(e=t.apply(this,arguments)).prefetchCache=new Map,e.prefetchEnabled=!0,e}return(0,o.Z)(n,[{key:"policies",get:function(){var e=this.internalStorageService.policies;if(e)return Object.assign(Object.assign({},e),{caching:bt.NoCaching})}},{key:"getSnapshotTree",value:function(){var e=(0,d.Z)((0,l.Z)().mark((function e(t){var n,r=this;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=this.internalStorageService.getSnapshotTree(t),this.prefetchEnabled&&n.then((function(e){null!==e&&void 0!==e&&r.prefetchTree(e)})),e.abrupt("return",n);case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"readBlob",value:function(){var e=(0,d.Z)((0,l.Z)().mark((function e(t){return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.cachedRead(t));case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"stopPrefetch",value:function(){this.prefetchEnabled=!1,this.prefetchCache.clear()}},{key:"cachedRead",value:function(){var e=(0,d.Z)((0,l.Z)().mark((function e(t){var n,r,i=this;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.prefetchEnabled){e.next=7;break}if(void 0===(n=this.prefetchCache.get(t))){e.next=4;break}return e.abrupt("return",n);case 4:return r=this.internalStorageService.readBlob(t),this.prefetchCache.set(t,r.catch((function(e){throw(0,U.ms)(e)&&i.prefetchCache.delete(t),e}))),e.abrupt("return",r);case 7:return e.abrupt("return",this.internalStorageService.readBlob(t));case 8:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"prefetchTree",value:function(e){var t=[];this.prefetchTreeCore(e,t);for(var n=0,r=t;n<r.length;n++){var i=r[n];this.cachedRead(i)}}},{key:"prefetchTreeCore",value:function(e,t){for(var n=0,r=Object.keys(e.blobs);n<r.length;n++){var i=r[n],o=e.blobs[i];i.startsWith(".")||"header"===i||i.startsWith("quorum")?null!==o&&this.cachedRead(o):i.startsWith("deltas")||null!==o&&t.push(o)}for(var a=0,s=Object.keys(e.trees);a<s.length;a++){var u=s[a];this.prefetchTreeCore(e.trees[u],t)}}}]),n}(_r.P);function Nr(e,t){switch(t){case"base64":return Be.fromByteArray(e);case"utf8":case"utf-8":case void 0:return(new TextDecoder).decode(e);default:throw new Error("invalid/unsupported encoding")}}var Or=function(e,t){return Zr.from(e,t).buffer};function Mr(e){var t=e;return e instanceof ArrayBuffer||"object"===typeof t&&null!==t&&"number"===typeof t.byteLength&&"function"===typeof t.slice&&void 0===t.byteOffset&&void 0===t.buffer}var Fr,Zr=function(e){(0,a.Z)(n,e);var t=(0,s.Z)(n);function n(){return(0,i.Z)(this,n),t.apply(this,arguments)}return(0,o.Z)(n,[{key:"toString",value:function(e){return Nr(this,e)}}],[{key:"from",value:function(e,t,r){if("string"===typeof e)return n.fromString(e,t);if(null!==e&&"object"===typeof e&&Mr(e.buffer))return yt(0===e.byteOffset,0),yt(e.byteLength===e.buffer.byteLength,1),n.fromArrayBuffer(e.buffer,t,r);if(Mr(e))return n.fromArrayBuffer(e,t,r);throw new TypeError}},{key:"fromArrayBuffer",value:function(e,t,r){var i=null!==t&&void 0!==t?t:0,o=null!==r&&void 0!==r?r:e.byteLength-i;if(i<0||i>e.byteLength||o<0||o+i>e.byteLength)throw new RangeError;return new n(e,i,o)}},{key:"fromString",value:function(e,t){switch(t){case"base64":var r=this.sanitizeBase64(e);return new n(Be.toByteArray(r).buffer);case"utf8":case"utf-8":case void 0:return new n((new TextEncoder).encode(e).buffer);default:throw new Error("invalid/unsupported encoding")}}},{key:"isBuffer",value:function(e){throw new Error("unimplemented")}},{key:"sanitizeBase64",value:function(e){var t=e;if((t=(t=t.split("=")[0]).replace(/[^\w+-/]/g,"")).length%4!==0){t+=["","===","==","="][t.length%4]}return t}}]),n}((0,Le.Z)(Uint8Array)),Dr=n(2533),Lr=function(){function e(t){(0,i.Z)(this,e),this.props=t,this.attachmentCounter=0,this.summaryTree={}}return(0,o.Z)(e,[{key:"summary",get:function(){var e;return{type:O.Tree,tree:Object.assign({},this.summaryTree),unreferenced:null===(e=this.props)||void 0===e?void 0:e.unreferenced}}},{key:"addBlob",value:function(e,t){this.summaryTree[e]={type:O.Blob,content:t}}},{key:"addHandle",value:function(e,t,n){this.summaryTree[e]={type:O.Handle,handleType:t,handle:n}}},{key:"addTree",value:function(e,t){this.summaryTree[e]=t}},{key:"addAttachment",value:function(e){this.summaryTree[this.attachmentCounter++]={id:e,type:O.Attachment}}}]),e}();function Br(e,t){for(var n=new Lr({unreferenced:e.unreferenced}),r=0,i=Object.entries(e.blobs);r<i.length;r++){var o=(0,I.Z)(i[r],2),a=o[0],s=o[1],u=t.get(s);(0,wt.h)(void 0!==u,733),n.addBlob(a,Dr.pv.from(u).toString("utf-8"))}for(var c=0,l=Object.entries(e.trees);c<l.length;c++){var d=(0,I.Z)(l[c],2),h=d[0],f=Br(d[1],t);n.addTree(h,f)}return n.summary}function qr(e){throw new Error(arguments.length>1&&void 0!==arguments[1]?arguments[1]:"Unreachable Case")}!function(e){e.Tree=1,e.Blob=2,e.Handle=3,e.Attachment=4}(Fr||(Fr={}));var jr=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return t.map((function(e){return e.replace(/^\//,"").replace(/\/$/,"")})).filter((function(e){return!!e})).join("/")};function Ur(e,t){for(var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",i={type:"tree",entries:[]},o=0,a=Object.keys(t.tree);o<a.length;o++){var s=a[o],u=t.tree[s],c=void 0,l=void 0,d=void 0,h=jr(""===n?r:n,s);switch(u.type){case Fr.Tree:l=Ur(e,u,h,r),d=u.unreferenced||void 0;break;case Fr.Blob:l="string"===typeof u.content?{type:"blob",content:u.content,encoding:"utf-8"}:{type:"blob",content:Ct(u.content,"base64"),encoding:"base64"};break;case Fr.Handle:if(u.embedded)c=u.handle;else{if(!e)throw Error("Parent summary does not exist to reference by handle.");c=jr(e,r,u.handle)}break;case Fr.Attachment:c=u.id;break;default:qr(u,"Unknown type: ".concat(u.type))}var f={path:encodeURIComponent(s),type:(0,Ht.FE)(u)},p=void 0;if(l)kt(void 0===c,173),p=Object.assign({value:l,unreferenced:d},f);else{if(!c)throw new Error("Invalid tree entry for ".concat(u.type));p=Object.assign(Object.assign({},f),{id:c})}i.entries.push(p)}return i}function Hr(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:".app",r=new Map;e.blobs&&e.blobs.forEach((function(e){var t,n,i;r.set(e.id,(n=e.content,i=null!==(t=e.encoding)&&void 0!==t?t:"utf-8",Et.from(n,i).buffer))}));var i=null===(t=e.trees)||void 0===t?void 0:t[0],o=null===i||void 0===i?void 0:i.sequenceNumber,a=function(e,t){var n={},r={id:e.id,blobs:{},trees:{}};n[""]=r;var i,o=(0,w.Z)(e.entries);try{for(o.s();!(i=o.n()).done;){var a=i.value,s=a.path.replace(new RegExp("^".concat(t,"/")),""),u=s.lastIndexOf("/"),c=s.slice(0,Math.max(0,u)),l=s.slice(u+1),d=n[c];if("tree"===a.type){var h={blobs:{},trees:{},unreferenced:a.unreferenced};d.trees[decodeURIComponent(l)]=h,n[s]=h}else{if("blob"!==a.type)throw new Error("Unknown entry type!!");d.blobs[decodeURIComponent(l)]=a.id}}}catch(Ji){o.e(Ji)}finally{o.f()}return r}(i,n);return{blobs:r,snapshotTree:a,sequenceNumber:o}}var zr=function(){function e(t){(0,i.Z)(this,e),this.manager=t}return(0,o.Z)(e,[{key:"writeSummaryTree",value:function(){var e=(0,d.Z)((0,l.Z)().mark((function e(t,n,r,i){var o;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.writeSummaryTreeCore(n,t,r,null!==i&&void 0!==i?i:0);case 2:if(o=e.sent){e.next=5;break}throw new Error("Failed to write summary tree");case 5:return e.abrupt("return",o);case 6:case"end":return e.stop()}}),e,this)})));return function(t,n,r,i){return e.apply(this,arguments)}}()},{key:"writeSummaryTreeCore",value:function(){var e=(0,d.Z)((0,l.Z)().mark((function e(t,n,r,i){var o,a;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=Ur(t,n,"","channel"===r?".app":""),a={entries:o.entries,message:void 0,sequenceNumber:i,type:r},e.abrupt("return",this.manager.createSummary(a).then((function(e){return e.id})));case 3:case"end":return e.stop()}}),e,this)})));return function(t,n,r,i){return e.apply(this,arguments)}}()}]),e}(),Vr=function(){function e(){(0,i.Z)(this,e),this.cache=new Map}return(0,o.Z)(e,[{key:"get",value:function(){var e=(0,d.Z)((0,l.Z)().mark((function e(t){return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.cache.get(t));case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"put",value:function(){var e=(0,d.Z)((0,l.Z)().mark((function e(t,n){return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.cache.set(t,n);case 1:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()}]),e}(),Gr="latest",Kr=function(){function e(t,n,r){var o=this,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},s=arguments.length>4?arguments[4]:void 0,u=arguments.length>5&&void 0!==arguments[5]?arguments[5]:new Vr,c=arguments.length>6&&void 0!==arguments[6]?arguments[6]:new Vr,h=arguments.length>7?arguments[7]:void 0,f=arguments.length>8&&void 0!==arguments[8]?arguments[8]:function(){var e=(0,d.Z)((0,l.Z)().mark((function e(t){return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",t&&void 0!==o.noCacheGitManager?o.noCacheGitManager:o.manager);case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();(0,i.Z)(this,e),this.id=t,this.manager=n,this.logger=r,this.policies=a,this.driverPolicies=s,this.blobCache=u,this.snapshotTreeCache=c,this.noCacheGitManager=h,this.getStorageManager=f,this.firstVersionsCall=!0}return(0,o.Z)(e,[{key:"repositoryUrl",get:function(){return""}},{key:"getSummaryUploadManager",value:function(){var e=(0,d.Z)((0,l.Z)().mark((function e(){var t;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getStorageManager();case 2:return t=e.sent,e.abrupt("return",new zr(t));case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getVersions",value:function(){var e=(0,d.Z)((0,l.Z)().mark((function e(t,n){var r,i,o,a,s,u,c=this;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t===this.id||null===t){e.next=2;break}return e.abrupt("return",[{id:t,treeId:void 0}]);case 2:if(!this.firstVersionsCall||1!==n){e.next=17;break}if(this.firstVersionsCall=!1,null===(r=this.driverPolicies)||void 0===r?void 0:r.enableDiscovery){e.next=10;break}return e.next=7,this.fetchAndCacheSnapshotTree(Gr,!1);case 7:e.t0=e.sent,e.next=13;break;case 10:return e.next=12,this.fetchAndCacheSnapshotTree(Gr,!0);case 12:e.t0=e.sent;case 13:return i=e.t0,o=i.id,a=i.snapshotTree,e.abrupt("return",[{id:o,treeId:a.id}]);case 17:return s=t||this.id,e.next=20,m.Xr.timedExecAsync(this.logger,{eventName:"getVersions",versionId:s,count:n},(0,d.Z)((0,l.Z)().mark((function e(){var t;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,c.getStorageManager();case 2:return t=e.sent,e.abrupt("return",t.getCommits(s,n));case 4:case"end":return e.stop()}}),e)}))));case 20:return u=e.sent,e.abrupt("return",u.map((function(e){return{date:e.commit.author.date,id:e.sha,treeId:e.commit.tree.sha}})));case 22:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"getSnapshotTree",value:function(){var e=(0,d.Z)((0,l.Z)().mark((function e(t){var n,r;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t){e.next=8;break}return e.next=4,this.getVersions(this.id,1);case 4:if(0!==(r=e.sent).length){e.next=7;break}return e.abrupt("return",null);case 7:n=r[0];case 8:return e.next=10,this.fetchAndCacheSnapshotTree(n.id);case 10:return e.abrupt("return",e.sent.snapshotTree);case 11:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"readBlob",value:function(){var e=(0,d.Z)((0,l.Z)().mark((function e(t){var n,r,i,o=this;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.blobCache.get(this.getCacheKey(t));case 2:if(void 0===(n=e.sent)){e.next=5;break}return e.abrupt("return",n);case 5:return e.next=7,m.Xr.timedExecAsync(this.logger,{eventName:"readBlob",blobId:t},function(){var e=(0,d.Z)((0,l.Z)().mark((function e(n){var r,i;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,o.getStorageManager();case 2:return r=e.sent,e.next=5,r.getBlob(t);case 5:return i=e.sent,n.end({size:i.size}),e.abrupt("return",i);case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 7:return r=e.sent,i=Or(r.content,r.encoding),e.next=11,this.blobCache.put(this.getCacheKey(r.sha),i);case 11:return e.abrupt("return",i);case 12:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"uploadSummaryWithContext",value:function(){var e=(0,d.Z)((0,l.Z)().mark((function e(t,n){var r,i=this;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,m.Xr.timedExecAsync(this.logger,{eventName:"uploadSummaryWithContext"},(0,d.Z)((0,l.Z)().mark((function e(){var r,o;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,i.getSummaryUploadManager();case 2:return o=e.sent,e.abrupt("return",o.writeSummaryTree(t,null!==(r=n.ackHandle)&&void 0!==r?r:"","channel"));case 4:case"end":return e.stop()}}),e)}))));case 2:return r=e.sent,e.abrupt("return",r);case 4:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"downloadSummary",value:function(){var e=(0,d.Z)((0,l.Z)().mark((function e(t){var n,r,i,o,a=this;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,m.Xr.timedExecAsync(this.logger,{eventName:"getWholeFlatSummary",treeId:t.handle},function(){var e=(0,d.Z)((0,l.Z)().mark((function e(n){var r,i,o;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,a.getStorageManager();case 2:return i=e.sent,e.next=5,i.getSummary(t.handle);case 5:return o=e.sent,n.end({size:null===(r=o.trees[0])||void 0===r?void 0:r.entries.length}),e.abrupt("return",o);case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 2:return n=e.sent,r=Hr(n,""),i=r.blobs,o=r.snapshotTree,e.abrupt("return",Br(o,i));case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"createBlob",value:function(){var e=(0,d.Z)((0,l.Z)().mark((function e(t){var n,r=this;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=new Uint8Array(t),e.abrupt("return",m.Xr.timedExecAsync(this.logger,{eventName:"createBlob",size:n.length},function(){var e=(0,d.Z)((0,l.Z)().mark((function e(t){var i,o;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r.getStorageManager();case 2:return i=e.sent,e.next=5,i.createBlob(Nr(n,"base64"),"base64").then((function(e){return{id:e.sha,url:e.url}}));case 5:return o=e.sent,t.end({blobId:o.id}),e.abrupt("return",o);case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 2:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"fetchAndCacheSnapshotTree",value:function(){var e=(0,d.Z)((0,l.Z)().mark((function e(t,n){var r,i,o,a,s,u,c,h=this;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.snapshotTreeCache.get(this.getCacheKey(t));case 2:if(void 0===(r=e.sent)){e.next=5;break}return e.abrupt("return",{id:r.id,snapshotTree:r.snapshotTree});case 5:return e.next=7,m.Xr.timedExecAsync(this.logger,{eventName:"getWholeFlatSummary",treeId:t},function(){var e=(0,d.Z)((0,l.Z)().mark((function e(r){var i,o,a;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,h.getStorageManager(n);case 2:return o=e.sent,e.next=5,o.getSummary(t);case 5:return a=e.sent,r.end({size:null===(i=a.trees[0])||void 0===i?void 0:i.entries.length}),e.abrupt("return",a);case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 7:return i=e.sent,o=Hr(i),a=i.id,yt(void 0!==(s=o.snapshotTree.id),629),u={id:a,snapshotTree:o.snapshotTree},c=[this.snapshotTreeCache.put(this.getCacheKey(s),u),this.initBlobCache(o.blobs)],s!==t&&c.push(this.snapshotTreeCache.put(this.getCacheKey(t),u)),e.next=17,Promise.all(c);case 17:return e.abrupt("return",u);case 18:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"initBlobCache",value:function(){var e=(0,d.Z)((0,l.Z)().mark((function e(t){var n,r=this;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=[],t.forEach((function(e,t){var i=r.getCacheKey(t);n.push(r.blobCache.put(i,e))})),e.next=4,Promise.all(n);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"getCacheKey",value:function(e){return"".concat(this.id,":").concat(e)}}]),e}();function Wr(e,t){return Jr.apply(this,arguments)}function Jr(){return(Jr=(0,d.Z)((0,l.Z)().mark((function e(t,n){var r;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,crypto.subtle.digest(n,t);case 2:return r=e.sent,e.abrupt("return",new Uint8Array(r));case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Qr(e,t){switch(t){case"hex":return Array.prototype.map.call(e,(function(e){return e.toString(16).padStart(2,"0")})).join("");case"base64":return Be.fromByteArray(e)}}function Yr(e){return Xr.apply(this,arguments)}function Xr(){return Xr=(0,d.Z)((0,l.Z)().mark((function e(t){var r,i,o,a=arguments;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=a.length>1&&void 0!==a[1]?a[1]:"SHA-1",i=a.length>2&&void 0!==a[2]?a[2]:"hex",void 0!==crypto.subtle){e.next=4;break}return e.abrupt("return",n.e(564).then(n.bind(n,75283)).then(function(){var e=(0,d.Z)((0,l.Z)().mark((function e(n){return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",n.hashFile(t,r,i));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 4:return e.next=6,Wr(t,r);case 6:return o=e.sent,e.abrupt("return",Qr(o,i));case 8:case"end":return e.stop()}}),e)}))),Xr.apply(this,arguments)}function $r(e){return ei.apply(this,arguments)}function ei(){return(ei=(0,d.Z)((0,l.Z)().mark((function e(t){var n,r,i;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.byteLength,r="blob ".concat(n.toString()).concat(String.fromCharCode(0)),i=Et.from(r+t.toString()),e.abrupt("return",Yr(i));case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var ti=function(){function e(t,n,r){(0,i.Z)(this,e),this.manager=t,this.blobsShaCache=n,this.getPreviousFullSnapshot=r}return(0,o.Z)(e,[{key:"writeSummaryTree",value:function(){var e=(0,d.Z)((0,l.Z)().mark((function e(t,n,r,i){var o;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getPreviousFullSnapshot(n);case 2:return o=e.sent,e.abrupt("return",this.writeSummaryTreeCore(t,null!==o&&void 0!==o?o:void 0));case 4:case"end":return e.stop()}}),e,this)})));return function(t,n,r,i){return e.apply(this,arguments)}}()},{key:"writeSummaryTreeCore",value:function(){var e=(0,d.Z)((0,l.Z)().mark((function e(t,n){var r,i,o=this;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.all(Object.keys(t.tree).map(function(){var e=(0,d.Z)((0,l.Z)().mark((function e(r){var i,a,s;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=t.tree[r],e.next=3,o.writeSummaryTreeObject(i,n);case 3:return a=e.sent,s={mode:(0,Ht.ZO)(i),path:encodeURIComponent(r),sha:a,type:(0,Ht.FE)(i)},e.abrupt("return",s);case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 2:return r=e.sent,e.next=5,this.manager.createGitTree({tree:r});case 5:return i=e.sent,e.abrupt("return",i.sha);case 7:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"writeSummaryTreeObject",value:function(){var e=(0,d.Z)((0,l.Z)().mark((function e(t,n){return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:e.t0=t.type,e.next=e.t0===Fr.Blob?3:e.t0===Fr.Handle?4:e.t0===Fr.Tree?7:e.t0===Fr.Attachment?8:9;break;case 3:return e.abrupt("return",this.writeSummaryBlob(t.content));case 4:if(void 0!==n){e.next=6;break}throw Error("Parent summary does not exist to reference by handle.");case 6:return e.abrupt("return",this.getIdFromPath(t.handleType,t.handle,n));case 7:return e.abrupt("return",this.writeSummaryTreeCore(t,n));case 8:return e.abrupt("return",t.id);case 9:qr(t,"Unknown type: ".concat(t.type));case 10:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"writeSummaryBlob",value:function(){var e=(0,d.Z)((0,l.Z)().mark((function e(t){var n,r,i,o,a;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n="string"===typeof t?{parsedContent:t,encoding:"utf-8"}:{parsedContent:Ct(t,"base64"),encoding:"base64"},r=n.parsedContent,i=n.encoding,e.next=3,$r(Et.from(r,i));case 3:if(o=e.sent,this.blobsShaCache.has(o)){e.next=10;break}return this.blobsShaCache.set(o,""),e.next=8,this.manager.createBlob(r,i);case 8:a=e.sent,kt(o===a.sha,182);case 10:return e.abrupt("return",o);case 11:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getIdFromPath",value:function(e,t,n){var r=t.split("/").map((function(e){return decodeURIComponent(e)}));return""===r[0]&&r.shift(),0===r.length?n.id:this.getIdFromPathCore(e,r,n)}},{key:"getIdFromPathCore",value:function(e,t,n){var r;kt(t.length>0,179);var i=t[0];if(1===t.length)switch(e){case Fr.Blob:var o=n.blobs[i];return kt(!!o,180),o;case Fr.Tree:var a=null===(r=n.trees[i])||void 0===r?void 0:r.id;return kt(!!a,181),a;default:throw Error('Unexpected handle summary object type: "'.concat(e,'".'))}return this.getIdFromPathCore(e,t.slice(1),n.trees[i])}}]),e}(),ni=function(){function e(t,n){(0,i.Z)(this,e),this.internalGitManager=t,this.logger=n}return(0,o.Z)(e,[{key:"getHeader",value:function(){var e=(0,d.Z)((0,l.Z)().mark((function e(t,n){var r=this;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.runWithRetry((0,d.Z)((0,l.Z)().mark((function e(){return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",r.internalGitManager.getHeader(t,n));case 1:case"end":return e.stop()}}),e)}))),"gitManager_getHeader"));case 1:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"getFullTree",value:function(){var e=(0,d.Z)((0,l.Z)().mark((function e(t){var n=this;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.runWithRetry((0,d.Z)((0,l.Z)().mark((function e(){return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",n.internalGitManager.getFullTree(t));case 1:case"end":return e.stop()}}),e)}))),"gitManager_getFullTree"));case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getCommit",value:function(){var e=(0,d.Z)((0,l.Z)().mark((function e(t){var n=this;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.runWithRetry((0,d.Z)((0,l.Z)().mark((function e(){return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",n.internalGitManager.getCommit(t));case 1:case"end":return e.stop()}}),e)}))),"gitManager_getCommit"));case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getCommits",value:function(){var e=(0,d.Z)((0,l.Z)().mark((function e(t,n){var r=this;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.runWithRetry((0,d.Z)((0,l.Z)().mark((function e(){return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",r.internalGitManager.getCommits(t,n));case 1:case"end":return e.stop()}}),e)}))),"gitManager_getCommits"));case 1:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"getTree",value:function(){var e=(0,d.Z)((0,l.Z)().mark((function e(t,n){var r=this;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.runWithRetry((0,d.Z)((0,l.Z)().mark((function e(){return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",r.internalGitManager.getTree(t,n));case 1:case"end":return e.stop()}}),e)}))),"gitManager_getTree"));case 1:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"getBlob",value:function(){var e=(0,d.Z)((0,l.Z)().mark((function e(t){var n=this;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.runWithRetry((0,d.Z)((0,l.Z)().mark((function e(){return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",n.internalGitManager.getBlob(t));case 1:case"end":return e.stop()}}),e)}))),"gitManager_getBlob"));case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getRawUrl",value:function(e){return this.internalGitManager.getRawUrl(e)}},{key:"getContent",value:function(){var e=(0,d.Z)((0,l.Z)().mark((function e(t,n){var r=this;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.runWithRetry((0,d.Z)((0,l.Z)().mark((function e(){return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",r.internalGitManager.getContent(t,n));case 1:case"end":return e.stop()}}),e)}))),"gitManager_getContent"));case 1:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"createBlob",value:function(){var e=(0,d.Z)((0,l.Z)().mark((function e(t,n){var r=this;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.runWithRetry((0,d.Z)((0,l.Z)().mark((function e(){return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",r.internalGitManager.createBlob(t,n));case 1:case"end":return e.stop()}}),e)}))),"gitManager_createBlob"));case 1:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"createGitTree",value:function(){var e=(0,d.Z)((0,l.Z)().mark((function e(t){var n=this;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.runWithRetry((0,d.Z)((0,l.Z)().mark((function e(){return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",n.internalGitManager.createGitTree(t));case 1:case"end":return e.stop()}}),e)}))),"gitManager_createGitTree"));case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"createTree",value:function(){var e=(0,d.Z)((0,l.Z)().mark((function e(t){var n=this;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.runWithRetry((0,d.Z)((0,l.Z)().mark((function e(){return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",n.internalGitManager.createTree(t));case 1:case"end":return e.stop()}}),e)}))),"gitManager_createTree"));case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"createCommit",value:function(){var e=(0,d.Z)((0,l.Z)().mark((function e(t){var n=this;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.runWithRetry((0,d.Z)((0,l.Z)().mark((function e(){return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",n.internalGitManager.createCommit(t));case 1:case"end":return e.stop()}}),e)}))),"gitManager_createCommit"));case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getRef",value:function(){var e=(0,d.Z)((0,l.Z)().mark((function e(t){var n=this;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.runWithRetry((0,d.Z)((0,l.Z)().mark((function e(){return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",n.internalGitManager.getRef(t));case 1:case"end":return e.stop()}}),e)}))),"gitManager_getRef"));case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"createRef",value:function(){var e=(0,d.Z)((0,l.Z)().mark((function e(t,n){var r=this;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.runWithRetry((0,d.Z)((0,l.Z)().mark((function e(){return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",r.internalGitManager.createRef(t,n));case 1:case"end":return e.stop()}}),e)}))),"gitManager_createRef"));case 1:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"upsertRef",value:function(){var e=(0,d.Z)((0,l.Z)().mark((function e(t,n){var r=this;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.runWithRetry((0,d.Z)((0,l.Z)().mark((function e(){return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",r.internalGitManager.upsertRef(t,n));case 1:case"end":return e.stop()}}),e)}))),"gitManager_upsertRef"));case 1:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"write",value:function(){var e=(0,d.Z)((0,l.Z)().mark((function e(t,n,r,i){var o=this;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.runWithRetry((0,d.Z)((0,l.Z)().mark((function e(){return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",o.internalGitManager.write(t,n,r,i));case 1:case"end":return e.stop()}}),e)}))),"gitManager_write"));case 1:case"end":return e.stop()}}),e,this)})));return function(t,n,r,i){return e.apply(this,arguments)}}()},{key:"createSummary",value:function(){var e=(0,d.Z)((0,l.Z)().mark((function e(t){var n=this;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.runWithRetry((0,d.Z)((0,l.Z)().mark((function e(){return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",n.internalGitManager.createSummary(t));case 1:case"end":return e.stop()}}),e)}))),"gitManager_createSummary"));case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"deleteSummary",value:function(){var e=(0,d.Z)((0,l.Z)().mark((function e(t){var n=this;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.runWithRetry((0,d.Z)((0,l.Z)().mark((function e(){return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",n.internalGitManager.deleteSummary(t));case 1:case"end":return e.stop()}}),e)}))),"gitManager_deleteSummary"));case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getSummary",value:function(){var e=(0,d.Z)((0,l.Z)().mark((function e(t){var n=this;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.runWithRetry((0,d.Z)((0,l.Z)().mark((function e(){return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",n.internalGitManager.getSummary(t));case 1:case"end":return e.stop()}}),e)}))),"gitManager_getSummary"));case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"runWithRetry",value:function(){var e=(0,d.Z)((0,l.Z)().mark((function e(t,n){return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",z(t,n,this.logger,{}));case 1:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()}]),e}(),ri="undefined"===typeof window,ii=function(){function e(t,n,r){var o=this,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},s=arguments.length>4?arguments[4]:void 0,u=arguments.length>5?arguments[5]:void 0,c=arguments.length>6?arguments[6]:void 0,h=arguments.length>7&&void 0!==arguments[7]?arguments[7]:(0,d.Z)((0,l.Z)().mark((function e(){return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",o.manager);case 1:case"end":return e.stop()}}),e)})));(0,i.Z)(this,e),this.id=t,this.manager=n,this.logger=r,this.policies=a,this.getStorageManager=h,this.blobsShaCache=new Map,(!0===(null===s||void 0===s?void 0:s.enableRestLess)||ri)&&(this.blobCache=null!==u&&void 0!==u?u:new Vr,this.snapshotTreeCache=null!==c&&void 0!==c?c:new Vr)}return(0,o.Z)(e,[{key:"repositoryUrl",get:function(){return""}},{key:"getSummaryUploadManager",value:function(){var e=(0,d.Z)((0,l.Z)().mark((function e(){var t;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getStorageManager();case 2:return t=e.sent,e.abrupt("return",new ti(new ni(t,this.logger),this.blobsShaCache,this.getPreviousFullSnapshot.bind(this)));case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getVersions",value:function(){var e=(0,d.Z)((0,l.Z)().mark((function e(t,n){var r,i,o=this;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t||this.id,e.next=3,m.Xr.timedExecAsync(this.logger,{eventName:"getVersions",versionId:r,count:n},(0,d.Z)((0,l.Z)().mark((function e(){var t;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,o.getStorageManager();case 2:return t=e.sent,e.abrupt("return",t.getCommits(r,n));case 4:case"end":return e.stop()}}),e)}))));case 3:return i=e.sent,e.abrupt("return",i.map((function(e){return{date:e.commit.author.date,id:e.sha,treeId:e.commit.tree.sha}})));case 5:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"getSnapshotTree",value:function(){var e=(0,d.Z)((0,l.Z)().mark((function e(t){var n,r,i,o,a,s,u,c=this;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=t){e.next=8;break}return e.next=4,this.getVersions(this.id,1);case 4:if(0!==(o=e.sent).length){e.next=7;break}return e.abrupt("return",null);case 7:i=o[0];case 8:return e.next=10,null===(n=this.snapshotTreeCache)||void 0===n?void 0:n.get(this.getCacheKey(i.treeId));case 10:if(!(a=e.sent)){e.next=13;break}return e.abrupt("return",a.snapshotTree);case 13:return e.next=15,m.Xr.timedExecAsync(this.logger,{eventName:"getSnapshotTree",treeId:i.treeId},function(){var e=(0,d.Z)((0,l.Z)().mark((function e(t){var n,r;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,c.getStorageManager();case 2:return n=e.sent,e.next=5,n.getTree(i.treeId);case 5:return r=e.sent,t.end({size:r.tree.length}),e.abrupt("return",r);case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 15:return s=e.sent,u=(0,Ht.eB)(s,this.blobsShaCache,!0),e.next=19,null===(r=this.snapshotTreeCache)||void 0===r?void 0:r.put(this.getCacheKey(u.id),{id:i.id,snapshotTree:u});case 19:return e.abrupt("return",u);case 20:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"readBlob",value:function(){var e=(0,d.Z)((0,l.Z)().mark((function e(t){var n,r,i,o,a,s=this;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,null===(n=this.blobCache)||void 0===n?void 0:n.get(this.getCacheKey(t));case 2:if(!(i=e.sent)){e.next=5;break}return e.abrupt("return",i);case 5:return e.next=7,m.Xr.timedExecAsync(this.logger,{eventName:"readBlob",blobId:t},function(){var e=(0,d.Z)((0,l.Z)().mark((function e(n){var r,i;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,s.getStorageManager();case 2:return r=e.sent,e.next=5,r.getBlob(t);case 5:return i=e.sent,n.end({size:i.size}),e.abrupt("return",i);case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 7:return o=e.sent,this.blobsShaCache.set(o.sha,""),a=Or(o.content,o.encoding),e.next=12,null===(r=this.blobCache)||void 0===r?void 0:r.put(this.getCacheKey(o.sha),a);case 12:return e.abrupt("return",a);case 13:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"uploadSummaryWithContext",value:function(){var e=(0,d.Z)((0,l.Z)().mark((function e(t,n){var r,i=this;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,m.Xr.timedExecAsync(this.logger,{eventName:"uploadSummaryWithContext"},(0,d.Z)((0,l.Z)().mark((function e(){var r,o;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,i.getSummaryUploadManager();case 2:return o=e.sent,e.abrupt("return",o.writeSummaryTree(t,null!==(r=n.ackHandle)&&void 0!==r?r:"","channel"));case 4:case"end":return e.stop()}}),e)}))));case 2:return r=e.sent,e.abrupt("return",r);case 4:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"downloadSummary",value:function(){var e=(0,d.Z)((0,l.Z)().mark((function e(t){return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new Error("NOT IMPLEMENTED!");case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"createBlob",value:function(){var e=(0,d.Z)((0,l.Z)().mark((function e(t){var n,r=this;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=new Uint8Array(t),e.abrupt("return",m.Xr.timedExecAsync(this.logger,{eventName:"createBlob",size:n.length},function(){var e=(0,d.Z)((0,l.Z)().mark((function e(t){var i,o;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r.getStorageManager();case 2:return i=e.sent,e.next=5,i.createBlob(Nr(n,"base64"),"base64").then((function(e){return{id:e.sha,url:e.url}}));case 5:return o=e.sent,t.end({blobId:o.id}),e.abrupt("return",o);case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 2:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getPreviousFullSnapshot",value:function(){var e=(0,d.Z)((0,l.Z)().mark((function e(t){var n=this;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",t?this.getVersions(t,1).then(function(){var e=(0,d.Z)((0,l.Z)().mark((function e(t){return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n.blobsShaCache.clear(),e.abrupt("return",n.getSnapshotTree(t[0]));case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()):void 0);case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getCacheKey",value:function(e){return"".concat(this.id,":").concat(e)}}]),e}(),oi=function(e){(0,a.Z)(n,e);var t=(0,s.Z)(n);function n(e,r,o){var a,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},u=arguments.length>4?arguments[4]:void 0,c=arguments.length>5?arguments[5]:void 0,l=arguments.length>6?arguments[6]:void 0,d=arguments.length>7?arguments[7]:void 0,h=arguments.length>8?arguments[8]:void 0;return(0,i.Z)(this,n),(a=t.call(this,n.loadInternalDocumentStorageService(e,r,o,s,u,c,l,d,h))).id=e,a.manager=r,a.noCacheGitManager=d,a._logTailSha=void 0,a}return(0,o.Z)(n,[{key:"logTailSha",get:function(){return this._logTailSha}},{key:"getSnapshotTree",value:function(){var e=(0,d.Z)((0,l.Z)().mark((function e(t){var n;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.internalStorageService.getSnapshotTree(t);case 2:return null!==(n=e.sent)&&(this._logTailSha=".logTail"in n.trees?n.trees[".logTail"].blobs.logTail:void 0),e.abrupt("return",n);case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}],[{key:"loadInternalDocumentStorageService",value:function(e,t,n,r,i,o,a,s,u){var c=(null===i||void 0===i?void 0:i.enableWholeSummaryUpload)?new Kr(e,t,n,r,i,o,a,s,u):new ii(e,t,n,r,i,o,a,u);return(null===i||void 0===i?void 0:i.enableWholeSummaryUpload)||r.caching!==bt.Prefetch?c:new Pr(c)}}]),n}(_r.P);function ai(e,t){if(!e)throw new Error("number"===typeof t?"0x".concat(t.toString(16).padStart(3,"0")):t)}var si;!function(e){e.DocRead="doc:read",e.DocWrite="doc:write",e.SummaryWrite="summary:write"}(si||(si={}));var ui="1.3.6",ci=function(e){(0,a.Z)(n,e);var t=(0,s.Z)(n);function n(e,r,o){var a,s=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return(0,i.Z)(this,n),(a=t.call(this,(function(e,t){o.sendErrorEvent({eventName:"DeltaConnection:EventException",name:e},t)}))).socket=e,a.documentId=r,a.enableLongPollingDowngrades=s,a.queuedMessages=[],a.queuedSignals=[],a.earlyOpHandlerAttached=!1,a.connectionListeners=new Map,a.trackedListeners=new Map,a._disposed=!1,a.earlyOpHandler=function(e,t){var n;(n=a.queuedMessages).push.apply(n,(0,x.Z)(t))},a.earlySignalHandler=function(e){a.queuedSignals.push(e)},a.mc=(0,v.rZ)(m.G2.create(o,"DeltaConnection")),a.on("newListener",(function(e,t){if(ai(!a.disposed,522),n.eventsAlwaysForwarded.includes(e))ai(a.trackedListeners.has(e),581);else{if(!n.eventsToForward.includes(e))throw new Error("DocumentDeltaConnection: Registering for unknown event: ".concat(e));ai(0!==a.listeners(e).length===a.trackedListeners.has(e),523),a.trackedListeners.has(e)||a.addTrackedListener(e,(function(){for(var t,n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];(t=a).emit.apply(t,[e].concat(r))}))}})),a}return(0,o.Z)(n,[{key:"hasDetails",get:function(){return!!this._details}},{key:"disposed",get:function(){return ai(this._disposed||this.socket.connected,580),this._disposed}},{key:"logger",get:function(){return this.mc.logger}},{key:"details",get:function(){if(!this._details)throw new Error("Internal error: calling method before _details is initialized!");return this._details}},{key:"clientId",get:function(){return this.details.clientId}},{key:"mode",get:function(){return this.details.mode}},{key:"claims",get:function(){return this.details.claims}},{key:"existing",get:function(){return this.details.existing}},{key:"maxMessageSize",get:function(){return this.details.serviceConfiguration.maxMessageSize}},{key:"version",get:function(){return this.details.version}},{key:"serviceConfiguration",get:function(){return this.details.serviceConfiguration}},{key:"checkNotClosed",value:function(){ai(!this.disposed,524)}},{key:"initialMessages",get:function(){var e;(this.checkNotClosed(),ai(this.earlyOpHandlerAttached,142),ai(0!==this.listeners("op").length,143),this.removeEarlyOpHandler(),this.queuedMessages.length>0)&&((e=this.details.initialMessages).push.apply(e,(0,x.Z)(this.queuedMessages)),this.details.initialMessages.sort((function(e,t){return e.sequenceNumber-t.sequenceNumber})),this.queuedMessages.length=0);return this.details.initialMessages}},{key:"initialSignals",get:function(){var e;(this.checkNotClosed(),ai(0!==this.listeners("signal").length,144),this.removeEarlySignalHandler(),this.queuedSignals.length>0)&&((e=this.details.initialSignals).push.apply(e,(0,x.Z)(this.queuedSignals)),this.queuedSignals.length=0);return this.details.initialSignals}},{key:"initialClients",get:function(){return this.checkNotClosed(),this.details.initialClients}},{key:"emitMessages",value:function(e,t){this.disposed||this.socket.emit(e,this.clientId,t)}},{key:"submitCore",value:function(e,t){this.emitMessages(e,[t])}},{key:"submit",value:function(e){this.checkNotClosed(),this.submitCore("submitOp",e)}},{key:"submitSignal",value:function(e){this.checkNotClosed(),this.submitCore("submitSignal",[e])}},{key:"dispose",value:function(){this.disposeCore(!1,(0,U.jx)("Client closing delta connection",{canRetry:!0},{driverVersion:ui}))}},{key:"disposeCore",value:function(e,t){this._disposed||(this._disposed=!0,this.removeTrackedListeners(),this.disconnect(e,t))}},{key:"disconnect",value:function(e,t){this.socket.disconnect()}},{key:"initialize",value:function(){var e=(0,d.Z)((0,l.Z)().mark((function e(t,n){var r,i,o,a,s=this;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.socket.on("op",this.earlyOpHandler),this.socket.on("signal",this.earlySignalHandler),this.earlyOpHandlerAttached=!0,r=0,i=function(){return s.socket.io.reconnection()},o=function(){return i()?s.socket.io.reconnectionAttempts():0},a=function(){return o()+1},e.next=9,new Promise((function(e,o){var u=function(e,t){s.disposeCore(e,t),o(t)};s.addConnectionListener("connect_error",(function(e){var t;r++;var n=!1;try{var o=null===e||void 0===e?void 0:e.description;o&&"object"===typeof o&&("TransportError"===e.type&&(n=!0),o.target=void 0)}catch(c){}n&&s.enableLongPollingDowngrades&&"polling"!==(null===(t=s.socket.io.opts.transports)||void 0===t?void 0:t[0])&&(s.socket.io.opts.transports=["polling","websocket"],i()||(s.socket.io.reconnection(!0),s.socket.io.reconnectionAttempts(1))),i()&&r<a()||u(!0,s.createErrorObject("connect_error",e))})),s.addConnectionListener("connect_timeout",(function(){u(!0,s.createErrorObject("connect_timeout"))})),s.addConnectionListener("connect_document_success",(function(n){if(void 0===t.nonce||void 0===n.nonce||n.nonce===t.nonce){var r=t.mode,i=n.mode;if(n.claims.scopes.includes(si.DocWrite)){if(i!==r)return void u(!1,s.createErrorObject("connect_document_success","Connected in a different mode than was requested",!1))}else if("write"===i)return void u(!1,s.createErrorObject("connect_document_success","Connected in write mode without write permissions",!1));s.checkpointSequenceNumber=n.checkpointSequenceNumber,s.removeConnectionListeners(),e(n)}})),s.addTrackedListener("disconnect",(function(e){var t=s.createErrorObject("disconnect",e);s.emit("disconnect",t),u(!0,t)})),s.addTrackedListener("error",(function(e){var t=s.createErrorObject("error",e,"Invalid namespace"!==e);s.emit("error",t),u(!0,t)})),s.addConnectionListener("connect_document_error",(function(e){void 0!==t.nonce&&void 0!==e.nonce&&e.nonce!==t.nonce||u(!1,s.createErrorObject("connect_document_error",e))})),s.socket.emit("connect_document",t),s.socketConnectionTimeout=setTimeout((function(){u(!1,s.createErrorObject("orderingServiceHandshakeTimeout"))}),n+2e3)}));case 9:this._details=e.sent,ai(!this.disposed,582);case 11:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"removeEarlyOpHandler",value:function(){this.socket.removeListener("op",this.earlyOpHandler),this.earlyOpHandlerAttached=!1}},{key:"removeEarlySignalHandler",value:function(){this.socket.removeListener("signal",this.earlySignalHandler)}},{key:"addConnectionListener",value:function(e,t){ai(!n.eventsAlwaysForwarded.includes(e),583),ai(!n.eventsToForward.includes(e),584),this.socket.on(e,t),ai(!this.connectionListeners.has(e),525),this.connectionListeners.set(e,t)}},{key:"addTrackedListener",value:function(e,t){this.socket.on(e,t),ai(!this.trackedListeners.has(e),526),this.trackedListeners.set(e,t)}},{key:"removeTrackedListeners",value:function(){var e,t=(0,w.Z)(this.trackedListeners.entries());try{for(t.s();!(e=t.n()).done;){var n=(0,I.Z)(e.value,2),r=n[0],i=n[1];this.socket.off(r,i)}}catch(Ji){t.e(Ji)}finally{t.f()}this.removeConnectionListeners(),this.removeEarlyOpHandler(),this.removeEarlySignalHandler(),this.trackedListeners.clear()}},{key:"removeConnectionListeners",value:function(){void 0!==this.socketConnectionTimeout&&clearTimeout(this.socketConnectionTimeout);var e,t=(0,w.Z)(this.connectionListeners.entries());try{for(t.s();!(e=t.n()).done;){var n=(0,I.Z)(e.value,2),r=n[0],i=n[1];this.socket.off(r,i)}}catch(Ji){t.e(Ji)}finally{t.f()}this.connectionListeners.clear()}},{key:"createErrorObject",value:function(e,t){var n,r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if("TransportError"===(null===t||void 0===t?void 0:t.type)){var i=void 0!==(null===t||void 0===t?void 0:t.message)?"".concat(t.message,": "):"";n="".concat(i).concat(JSON.stringify(t,(0,pe.fd)()))}else n=function(e){var t={message:"string"===typeof(null===e||void 0===e?void 0:e.message)?e.message:String(e)};if(function(e){return null!==e&&!Array.isArray(e)&&"object"===typeof e}(e)){var n=e.errorType,r=e.stack,i=e.name;if("string"===typeof n&&(t.errorType=n),"string"===typeof r){var o="string"===typeof i?i:void 0;t.stack=function(e,t){var n=e.split("\n");return n.shift(),void 0!==t&&n.unshift(t),n.join("\n")}(r,o)}}return t}(t).message;return(0,U.jx)("socket.io (".concat(e,"): ").concat(n),{canRetry:r},{driverVersion:ui})}}]),n}(ve.M);ci.eventsToForward=["nack","op","signal","pong"],ci.eventsAlwaysForwarded=["disconnect","error"];var li,di="1.3.6";function hi(e,t,n){var r={statusCode:t,driverVersion:di};switch(t){case void 0:return new U.Xp(e,e.startsWith("NetworkError"),r);case 401:case 403:return new U.M_(e,void 0,void 0,r);case 404:var i=li.fileNotFoundOrAccessDeniedError;return new U.V2(e,i,r);case 429:return(0,U.jx)(e,{canRetry:!0,retryAfterMs:n},r);case 500:case 502:return new U.Xp(e,!0,r);default:var o={canRetry:void 0!==n,retryAfterMs:n};return(0,U.jx)(e,o,r)}}function fi(e,t,n){throw hi(e,t,n)}!function(e){e.fileNotFoundOrAccessDeniedError="fileNotFoundOrAccessDeniedError"}(li||(li={}));var pi,vi=["^0.4.0","^0.3.0","^0.2.0","^0.1.0"],gi=function(e){(0,a.Z)(n,e);var t=(0,s.Z)(n);function n(){return(0,i.Z)(this,n),t.apply(this,arguments)}return(0,o.Z)(n,[{key:"createErrorObject",value:function(e,t){var r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return r&&Number.isInteger(null===t||void 0===t?void 0:t.code)&&"string"===typeof(null===t||void 0===t?void 0:t.message)?function(e,t){return hi("R11s socket error (".concat(t,"): ").concat(e.message),e.code,e.retryAfterMs)}(t,e):(0,Q.Z)((0,Y.Z)(n.prototype),"createErrorObject",this).call(this,e,t,r)}}],[{key:"create",value:function(){var e=(0,d.Z)((0,l.Z)().mark((function e(t,r,i,o,a,s,u){var c,d,h,f,p=arguments;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return d=o(s,{query:{documentId:r,tenantId:t},reconnection:!1,transports:["websocket"],timeout:c=p.length>7&&void 0!==p[7]?p[7]:2e4}),h={client:a,id:r,mode:a.mode,tenantId:t,token:i,versions:vi,relayUserAgent:[a.details.environment," driverVersion:".concat(di)].join(";")},!0,f=new n(d,r,u,true),e.next=7,f.initialize(h,c);case 7:return e.abrupt("return",f);case 8:case"end":return e.stop()}}),e)})));return function(t,n,r,i,o,a,s){return e.apply(this,arguments)}}()}]),n}(ci),mi=function(){function e(){(0,i.Z)(this,e)}return(0,o.Z)(e,[{key:"repositoryUrl",get:function(){throw new Error("Invalid operation")}},{key:"getSnapshotTree",value:function(){var e=(0,d.Z)((0,l.Z)().mark((function e(t){return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",t?Promise.reject(new Error("Invalid operation")):null);case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"getVersions",value:function(){var e=(0,d.Z)((0,l.Z)().mark((function e(t,n){return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",[]);case 1:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"uploadSummaryWithContext",value:function(){var e=(0,d.Z)((0,l.Z)().mark((function e(t,n){return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",Promise.reject(new Error("Invalid operation")));case 1:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"downloadSummary",value:function(){var e=(0,d.Z)((0,l.Z)().mark((function e(t){return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",Promise.reject(new Error("Invalid operation")));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"createBlob",value:function(){var e=(0,d.Z)((0,l.Z)().mark((function e(t){return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",Promise.reject(new Error("Null blob storage can not create blob")));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"readBlob",value:function(){var e=(0,d.Z)((0,l.Z)().mark((function e(t){return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",Promise.reject(new Error("Null blob storage can not read blob")));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()}]),e}();!function(e){e.Method="method",e.Header="header",e.Body="body"}(pi||(pi={}));var yi,bi=function(e,t){return"".concat(e,": ").concat(t)},wi=function(){function e(){(0,i.Z)(this,e)}return(0,o.Z)(e,[{key:"translate",value:function(e){var t,n,r=Object.assign({},e),i=new URLSearchParams;if(i.append(pi.Method,null!==(t=r.method)&&void 0!==t?t:"GET"),r.headers)for(var o=0,a=Object.entries(r.headers);o<a.length;o++){var s=(0,I.Z)(a[o],2),u=s[0],c=s[1],l=bi(u,c);i.append(pi.Header,l)}if(r.data&&["post","put","patch"].includes(null===(n=r.method)||void 0===n?void 0:n.toLowerCase())){var d=JSON.stringify(r.data);i.append(pi.Body,d)}return r.data=i.toString(),r.method="POST",r.headers={"Content-Type":"application/x-www-form-urlencoded;restless"},r}}]),e}(),Si=n(84255),ki=n.n(Si),Ci=function(e){var t,n;return[void 0!==e.baseURL?"".concat(e.baseURL).concat(null!==(t=e.url)&&void 0!==t?t:""):null!==(n=e.url)&&void 0!==n?n:"",{method:e.method,headers:e.headers,body:e.data}]},xi=function(e){(0,a.Z)(n,e);var t=(0,s.Z)(n);function n(e,r,o,a,s){var u,c=arguments.length>5&&void 0!==arguments[5]?arguments[5]:{};return(0,i.Z)(this,n),(u=t.call(this,s,c)).rateLimiter=r,u.getAuthorizationHeader=o,u.useRestLess=a,u.restLess=new wi,u}return(0,o.Z)(n,[{key:"load",value:function(){var e=(0,d.Z)((0,l.Z)().mark((function e(){return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getAuthorizationHeader();case 2:this.authorizationHeader=e.sent;case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"request",value:function(){var e=(0,d.Z)((0,l.Z)().mark((function e(t,n){var r,i,o,a,s,u,c,h,f,p=this,v=arguments;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=!(v.length>2&&void 0!==v[2])||v[2],o=Object.assign(Object.assign({},t),{headers:this.generateHeaders(t.headers)}),a=this.useRestLess?this.restLess.translate(o):o,s=Ci(a),e.next=6,this.rateLimiter.schedule((0,d.Z)((0,l.Z)().mark((function e(){return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",ki().apply(void 0,(0,x.Z)(s)).catch(function(){var e=(0,d.Z)((0,l.Z)().mark((function e(t){return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:fi(["TypeError","FetchError"].includes(null===t||void 0===t?void 0:t.name)?"NetworkError: ".concat(t.message):Rt()(t));case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 1:case"end":return e.stop()}}),e)}))));case 6:if(u=e.sent,!(null===(i=u.headers.get("content-type"))||void 0===i?void 0:i.includes("application/json"))){e.next=13;break}return e.next=10,u.json();case 10:e.t0=e.sent,e.next=16;break;case 13:return e.next=15,u.text();case 15:e.t0=e.sent;case 16:if(c=e.t0,!u.ok&&u.status!==n){e.next=20;break}return h=c,e.abrupt("return",h);case 20:if(401!==u.status||!r){e.next=25;break}return e.next=23,this.getAuthorizationHeader(!0);case 23:return this.authorizationHeader=e.sent,e.abrupt("return",this.request(o,n,!1));case 25:if(!(429===u.status&&(null===c||void 0===c?void 0:c.retryAfter)>0)){e.next=27;break}return e.abrupt("return",new Promise((function(e,t){return setTimeout((function(){p.request(o,n).then(e).catch(t)}),1e3*c.retryAfter)})));case 27:f=void 0!==c?"string"===typeof c?c:Rt()(c):u.statusText,fi("R11s fetch error: ".concat(f),u.status,null===c||void 0===c?void 0:c.retryAfter);case 29:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"generateHeaders",value:function(e){var t=(null===e||void 0===e?void 0:e["x-correlation-id"])||(0,f.Z)();return Object.assign(Object.assign({},e),{"x-correlation-id":t,"x-driver-version":di,Authorization:this.authorizationHeader})}}]),n}(Zt),Ei=function(e){(0,a.Z)(n,e);var t=(0,s.Z)(n);function n(e,r,o,a,s){var u=arguments.length>5&&void 0!==arguments[5]?arguments[5]:{};return(0,i.Z)(this,n),t.call(this,e,r,o,a,s,u)}return(0,o.Z)(n,null,[{key:"load",value:function(){var e=(0,d.Z)((0,l.Z)().mark((function e(t,r,i,o,a,s,u){var c,h,f;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return c={token:"".concat((p=t,Zr.from(p,"utf8").toString("base64")))},h=function(){var e=(0,d.Z)((0,l.Z)().mark((function e(n){var o,a;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,i.fetchStorageToken(t,r,n);case 2:return o=e.sent,a={password:o.jwt,user:t},e.abrupt("return",jt(a));case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),f=new n(o,a,h,s,u,c),e.prev=3,e.next=6,f.load();case 6:e.next=13;break;case 8:return e.prev=8,e.t0=e.catch(3),o.sendErrorEvent({eventName:"R11sRestWrapperLoadFailure"},e.t0),e.next=13,f.load();case 13:return e.abrupt("return",f);case 14:case"end":return e.stop()}var p}),e,null,[[3,8]])})));return function(t,n,r,i,o,a,s){return e.apply(this,arguments)}}()}]),n}(xi),Ti=function(e){(0,a.Z)(n,e);var t=(0,s.Z)(n);function n(e,r,o,a,s){var u=arguments.length>5&&void 0!==arguments[5]?arguments[5]:{};return(0,i.Z)(this,n),t.call(this,e,r,o,a,s,u)}return(0,o.Z)(n,null,[{key:"load",value:function(){var e=(0,d.Z)((0,l.Z)().mark((function e(t,r,i,o,a,s,u){var c,h;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return c=function(){var e=(0,d.Z)((0,l.Z)().mark((function e(n){var o;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,i.fetchOrdererToken(t,r,n);case 2:return o=e.sent,e.abrupt("return","Basic ".concat(o.jwt));case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),h=new n(o,a,c,s,u),e.prev=2,e.next=5,h.load();case 5:e.next=12;break;case 7:return e.prev=7,e.t0=e.catch(2),o.sendErrorEvent({eventName:"R11sRestWrapperLoadFailure"},e.t0),e.next=12,h.load();case 12:return e.abrupt("return",h);case 13:case"end":return e.stop()}}),e,null,[[2,7]])})));return function(t,n,r,i,o,a,s){return e.apply(this,arguments)}}()}]),n}(xi),Ii=function(){function e(t,n,r,o,a,s,u,c,l,d,h,f){(0,i.Z)(this,e),this._resolvedUrl=t,this.ordererUrl=n,this.deltaStorageUrl=r,this.storageUrl=o,this.logger=a,this.tokenProvider=s,this.tenantId=u,this.documentId=c,this.driverPolicies=l,this.blobCache=d,this.snapshotTreeCache=h,this.discoverFluidResolvedUrl=f,this.lastDiscoveredAt=Date.now()}return(0,o.Z)(e,[{key:"resolvedUrl",get:function(){return this._resolvedUrl}},{key:"dispose",value:function(){}},{key:"connectToStorage",value:function(){var e=(0,d.Z)((0,l.Z)().mark((function e(){var t,n,r,i,o=this;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0===this.documentStorageService){e.next=2;break}return e.abrupt("return",this.documentStorageService);case 2:if(void 0!==this.storageUrl){e.next=4;break}return e.abrupt("return",new mi);case 4:return t=function(){var e=(0,d.Z)((0,l.Z)().mark((function e(t){var n,r,i,a,s;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(n=o.shouldUpdateDiscoveredSessionInfo())){e.next=4;break}return e.next=4,o.refreshDiscovery();case 4:if(o.storageManager&&o.noCacheStorageManager&&!n){e.next=13;break}return r=new St(o.driverPolicies.maxConcurrentStorageRequests),e.next=8,Ei.load(o.tenantId,o.documentId,o.tokenProvider,o.logger,r,o.driverPolicies.enableRestLess,o.storageUrl);case 8:i=e.sent,a=new Ut(o.storageUrl,!0,!1,i),o.storageManager=new zt(a),s=new Ut(o.storageUrl,!0,!0,i),o.noCacheStorageManager=new zt(s);case 13:return e.abrupt("return",t?o.noCacheStorageManager:o.storageManager);case 14:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),e.next=7,t();case 7:return n=e.sent,e.next=10,t(!0);case 10:return r=e.sent,i={caching:this.driverPolicies.enablePrefetch?bt.Prefetch:bt.NoCaching,minBlobSize:this.driverPolicies.aggregateBlobsSmallerThanBytes},this.documentStorageService=new oi(this.documentId,n,this.logger,i,this.driverPolicies,this.blobCache,this.snapshotTreeCache,r,t),e.abrupt("return",this.documentStorageService);case 14:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"connectToDeltaStorage",value:function(){var e=(0,d.Z)((0,l.Z)().mark((function e(){var t,n,r,i=this;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.connectToStorage();case 2:return yt(!!this.documentStorageService,177),t=function(){var e=(0,d.Z)((0,l.Z)().mark((function e(){var t,n;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t=i.shouldUpdateDiscoveredSessionInfo())){e.next=4;break}return e.next=4,i.refreshDiscovery();case 4:if(i.ordererRestWrapper&&!t){e.next=9;break}return n=new St(i.driverPolicies.maxConcurrentOrdererRequests),e.next=8,Ti.load(i.tenantId,i.documentId,i.tokenProvider,i.logger,n,i.driverPolicies.enableRestLess);case 8:i.ordererRestWrapper=e.sent;case 9:return e.abrupt("return",i.ordererRestWrapper);case 10:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),e.next=6,t();case 6:return n=e.sent,r=new Rr(this.deltaStorageUrl,n,this.logger,t,(function(){return i.deltaStorageUrl})),e.abrupt("return",new Ar(this.tenantId,this.documentId,r,this.documentStorageService));case 9:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"connectToDeltaStream",value:function(){var e=(0,d.Z)((0,l.Z)().mark((function e(t){var n,r,i=this;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=function(){var e=(0,d.Z)((0,l.Z)().mark((function e(n){var r;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!i.shouldUpdateDiscoveredSessionInfo()){e.next=3;break}return e.next=3,i.refreshDiscovery();case 3:return e.next=5,i.tokenProvider.fetchOrdererToken(i.tenantId,i.documentId,n);case 5:return r=e.sent,e.abrupt("return",gi.create(i.tenantId,i.documentId,r.jwt,yr,t,i.ordererUrl,i.logger));case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),e.prev=1,e.next=4,n();case 4:return r=e.sent,e.abrupt("return",r);case 8:if(e.prev=8,e.t0=e.catch(1),401!==(null===e.t0||void 0===e.t0?void 0:e.t0.statusCode)){e.next=12;break}return e.abrupt("return",n(!0));case 12:throw e.t0;case 13:case"end":return e.stop()}}),e,null,[[1,8]])})));return function(t){return e.apply(this,arguments)}}()},{key:"refreshDiscovery",value:function(){var e=(0,d.Z)((0,l.Z)().mark((function e(){var t=this;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.discoverP||(this.discoverP=m.Xr.timedExecAsync(this.logger,{eventName:"refreshSessionDiscovery"},(0,d.Z)((0,l.Z)().mark((function e(){return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",t.refreshDiscoveryCore());case 1:case"end":return e.stop()}}),e)}))))),e.abrupt("return",this.discoverP);case 2:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"refreshDiscoveryCore",value:function(){var e=(0,d.Z)((0,l.Z)().mark((function e(){var t;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.discoverFluidResolvedUrl();case 2:t=e.sent,this._resolvedUrl=t,this.storageUrl=t.endpoints.storageUrl,this.ordererUrl=t.endpoints.ordererUrl,this.deltaStorageUrl=t.endpoints.deltaStorageUrl;case 7:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"shouldUpdateDiscoveredSessionInfo",value:function(){var e=this;if(!this.driverPolicies.enableDiscovery)return!1;var t=Date.now()-this.lastDiscoveredAt>3e5;return t&&(this.lastDiscoveredAt=Date.now(),this.discoverP=void 0,this.refreshDiscovery().catch((function(){e.lastDiscoveredAt=0}))),t}}]),e}();function Ai(e){for(var t=0,n=Object.keys(e.tree);t<n.length;t++){var r=n[t],i=e.tree[r];switch(i.type){case yi.Tree:e.tree[r]=Ai(i);break;case yi.Blob:i.content="string"===typeof i.content?i.content:Nr(i.content,"utf8");break;case yi.Handle:throw new Error("No handle should be present for first summary!!");default:throw new Error("Unknown tree type ".concat(i.type))}}return e}!function(e){e.Tree=1,e.Blob=2,e.Handle=3,e.Attachment=4}(yi||(yi={}));var Ri=n(65915),_i=n.n(Ri),Pi=function(e){return new(_i())(e,!0)},Ni=function(e,t){return e.split("/").slice(0,-1).concat([t]).join("/")},Oi=function(e,t){if(t){var n=new(_i())(t.ordererUrl),r=new(_i())(e.endpoints.deltaStorageUrl);r.set("host",n.host);var i=new(_i())(t.historianUrl),o=new(_i())(e.endpoints.storageUrl);o.set("host",i.host);var a=Pi(e.url);return{endpoints:{deltaStorageUrl:r.toString(),ordererUrl:t.ordererUrl,storageUrl:o.toString()},id:e.id,tokens:e.tokens,type:e.type,url:new(_i())("fluid://".concat(n.host).concat(a.pathname)).toString()}}return e},Mi={enablePrefetch:!0,maxConcurrentStorageRequests:100,maxConcurrentOrdererRequests:100,aggregateBlobsSmallerThanBytes:void 0,enableDiscovery:!1,enableWholeSummaryUpload:!1,enableRestLess:!0},Fi=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};(0,i.Z)(this,e),this.tokenProvider=t,this.protocolName="fluid:",this.blobCache=new Vr,this.snapshotTreeCache=new Vr,this.driverPolicies=Object.assign(Object.assign({},Mi),n)}return(0,o.Z)(e,[{key:"createContainer",value:function(){var e=(0,d.Z)((0,l.Z)().mark((function e(t,n,r,i){var o,a,s,u,c,d,h,f,p,v,g,y,w,S,k,C,x;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(b(n),void 0!==t){e.next=3;break}throw new Error("Empty file summary creation isn't supported in this driver.");case 3:if(yt(!!n.endpoints.ordererUrl,178),(o=Pi(n.url)).pathname){e.next=7;break}throw new Error("Parsed url should contain tenant and doc Id!!");case 7:if(a=o.pathname.split("/"),s=(0,I.Z)(a,2),u=s[1],c=t.tree[".protocol"],d=t.tree[".app"],c&&d){e.next=12;break}throw new Error("Protocol and App Summary required in the full summary");case 12:return h=D(c),f=L(c),p=m.G2.create(r,"RouterliciousDriver"),v=new St(this.driverPolicies.maxConcurrentOrdererRequests),e.next=18,Ti.load(u,void 0,this.tokenProvider,p,v,this.driverPolicies.enableRestLess,n.endpoints.ordererUrl);case 18:return g=e.sent,e.next=21,g.post("/documents/".concat(u),{summary:Ai(d),sequenceNumber:h.sequenceNumber,values:f,enableDiscovery:this.driverPolicies.enableDiscovery,generateToken:void 0!==this.tokenProvider.documentPostCreateCallback});case 21:if("string"===typeof(y=e.sent)?w=y:(w=y.id,S=y.token,k=this.driverPolicies.enableDiscovery?y.session:void 0),o=Pi(n.url),!S||void 0===this.tokenProvider.documentPostCreateCallback){e.next=33;break}return e.prev=25,e.next=28,this.tokenProvider.documentPostCreateCallback(w,S);case 28:e.next=33;break;case 30:throw e.prev=30,e.t0=e.catch(25),new Zi(e.t0);case 33:if(o.set("pathname",Ni(o.pathname,w)),C=n.endpoints.deltaStorageUrl){e.next=37;break}throw new Error("All endpoints urls must be provided. [deltaStorageUrl:".concat(C,"]"));case 37:return(x=new URL(C)).pathname=Ni(x.pathname,w),e.abrupt("return",this.createDocumentService(Object.assign(Object.assign({},n),{url:o.toString(),id:w,endpoints:Object.assign(Object.assign({},n.endpoints),{deltaStorageUrl:x.toString()})}),r,i,k));case 40:case"end":return e.stop()}}),e,this,[[25,30]])})));return function(t,n,r,i){return e.apply(this,arguments)}}()},{key:"createDocumentService",value:function(){var e=(0,d.Z)((0,l.Z)().mark((function e(t,n,r,i){var o,a,s,u,c,h,f,p,v,g,y,w=this;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(b(t),o=Pi(t.url),a=o.pathname.split("/"),s=(0,I.Z)(a,3),u=s[1],(c=s[2])&&u){e.next=5;break}throw new Error("Couldn't parse documentId and/or tenantId. [documentId:".concat(c,"][tenantId:").concat(u,"]"));case 5:if(h=m.G2.create(n,"RouterliciousDriver",{all:{driverVersion:di}}),f=function(){var e=(0,d.Z)((0,l.Z)().mark((function e(){var n,r,i;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(w.driverPolicies.enableDiscovery){e.next=2;break}return e.abrupt("return",t);case 2:return n=new St(w.driverPolicies.maxConcurrentOrdererRequests),e.next=5,Ti.load(u,c,w.tokenProvider,h,n,w.driverPolicies.enableRestLess,t.endpoints.ordererUrl);case 5:return r=e.sent,e.next=8,r.get("/documents/".concat(u,"/session/").concat(c));case 8:return i=e.sent,e.abrupt("return",Oi(t,i));case 10:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),void 0===i){e.next=11;break}e.t0=Oi(t,i),e.next=14;break;case 11:return e.next=13,f();case 13:e.t0=e.sent;case 14:if(p=e.t0,v=p.endpoints.storageUrl,g=p.endpoints.ordererUrl,y=p.endpoints.deltaStorageUrl,g&&y){e.next=20;break}throw new Error("All endpoints urls must be provided. [ordererUrl:".concat(g,"][deltaStorageUrl:").concat(y,"]"));case 20:return e.abrupt("return",new Ii(p,g,y,v,h,this.tokenProvider,u,c,this.driverPolicies,this.blobCache,this.snapshotTreeCache,f));case 21:case"end":return e.stop()}}),e,this)})));return function(t,n,r,i){return e.apply(this,arguments)}}()}]),e}(),Zi=function(e){(0,a.Z)(n,e);var t=(0,s.Z)(n);function n(e){var r;return(0,i.Z)(this,n),(r=t.call(this,e.message)).innerError=e,r.name="DocumentPostCreateError",r}return(0,o.Z)(n,[{key:"stack",get:function(){return this.innerError.stack}}]),n}((0,Le.Z)(Error)),Di=n(63760),Li=n(54823),Bi=function(){function e(){(0,i.Z)(this,e)}return(0,o.Z)(e,[{key:"resolve",value:function(){var e=(0,d.Z)((0,l.Z)().mark((function e(t){var n,r,i,o,a,s;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=qi(t.url),r=n.ordererUrl,i=n.storageUrl,o=n.tenantId,a=n.containerId,!t.headers||!0!==t.headers[Li.i.createNew]){e.next=3;break}return e.abrupt("return",{endpoints:{deltaStorageUrl:"".concat(r,"/deltas/").concat(o,"/new"),ordererUrl:r,storageUrl:"".concat(i,"/repos/").concat(o)},id:"",tokens:{},type:"fluid",url:"".concat(r,"/").concat(o,"/new")});case 3:if(void 0!==a){e.next=5;break}throw new Error("Azure URL did not contain containerId");case 5:return s="".concat(r,"/").concat(o,"/").concat(a),e.abrupt("return",{endpoints:{deltaStorageUrl:"".concat(r,"/deltas/").concat(o,"/").concat(a),ordererUrl:r,storageUrl:"".concat(i,"/repos/").concat(o)},id:a,tokens:{},type:"fluid",url:s});case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"getAbsoluteUrl",value:function(){var e=(0,d.Z)((0,l.Z)().mark((function e(t,n){return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("fluid"===t.type){e.next=2;break}throw new Error("Invalid Resolved Url");case 2:return e.abrupt("return","".concat(t.url,"/").concat(n));case 3:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()}]),e}();function qi(e){var t=new URL(e),n=t.origin,r=t.searchParams,i=r.get("storage");if(null===i)throw new Error("Azure URL did not contain a storage URL");var o=r.get("tenantId");if(null===o)throw new Error("Azure URL did not contain a tenant ID");var a=decodeURIComponent(i),s=decodeURIComponent(o),u=r.get("containerId");return{ordererUrl:n,storageUrl:a,tenantId:s,containerId:null!==u?decodeURIComponent(u):void 0}}var ji=function(e,t){var n=new URL(e);return n.searchParams.append("storage",encodeURIComponent(e)),n.searchParams.append("tenantId",encodeURIComponent(t)),{url:n.href,headers:(0,Tt.Z)({},Li.i.createNew,!0)}};function Ui(e){return"remote"===e.type}var Hi,zi=function(e){return Ui(e)?e.tenantId:"local"},Vi=function(){function e(t){(0,i.Z)(this,e),this.props=t,t.connection.endpoint=t.connection.endpoint.replace(/\/$/,""),this.urlResolver=new Bi;var n=Ui(this.props.connection);this.documentServiceFactory=new Fi(this.props.connection.tokenProvider,{enableWholeSummaryUpload:n,enableDiscovery:n})}return(0,o.Z)(e,[{key:"createContainer",value:function(){var e=(0,d.Z)((0,l.Z)().mark((function e(t){var n,r,i,o;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=this.createLoader(t),e.next=3,n.createDetachedContainer({package:"no-dynamic-package",config:{}});case 3:return r=e.sent,e.next=6,this.createFluidContainer(r,this.props.connection);case 6:return i=e.sent,o=this.getContainerServices(r),e.abrupt("return",{container:i,services:o});case 9:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"copyContainer",value:function(){var e=(0,d.Z)((0,l.Z)().mark((function e(t,n,r){var i,o,a,s,u,c,d,h,f,p,v;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=this.createLoader(n),(a=new URL(this.props.connection.endpoint)).searchParams.append("storage",encodeURIComponent(this.props.connection.endpoint)),a.searchParams.append("tenantId",encodeURIComponent(zi(this.props.connection))),a.searchParams.append("containerId",encodeURIComponent(t)),e.next=7,o.resolve({url:a.href});case 7:if(void 0!==(s=e.sent).resolvedUrl){e.next=10;break}throw new Error("Source container cannot resolve URL.");case 10:return e.next=12,this.documentServiceFactory.createDocumentService(s.resolvedUrl);case 12:return u=e.sent,e.next=15,u.connectToStorage();case 15:return c=e.sent,d={type:pt.Handle,handleType:pt.Tree,handle:null!==(i=null===r||void 0===r?void 0:r.id)&&void 0!==i?i:"latest"},e.next=19,c.downloadSummary(d);case 19:return h=e.sent,e.next=22,o.rehydrateDetachedContainerFromSnapshot(JSON.stringify(h));case 22:return f=e.sent,e.next=25,this.createFluidContainer(f,this.props.connection);case 25:return p=e.sent,v=this.getContainerServices(f),e.abrupt("return",{container:p,services:v});case 28:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"getContainer",value:function(){var e=(0,d.Z)((0,l.Z)().mark((function e(t,n){var r,i,o,a,s,u;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=this.createLoader(n),(i=new URL(this.props.connection.endpoint)).searchParams.append("storage",encodeURIComponent(this.props.connection.endpoint)),i.searchParams.append("tenantId",encodeURIComponent(zi(this.props.connection))),i.searchParams.append("containerId",encodeURIComponent(t)),e.next=7,r.resolve({url:i.href});case 7:return o=e.sent,e.next=10,(0,Di.bb)(o,"/");case 10:return a=e.sent,s=new gt.G(o,a),u=this.getContainerServices(o),e.abrupt("return",{container:s,services:u});case 14:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"getContainerVersions",value:function(){var e=(0,d.Z)((0,l.Z)().mark((function e(t,n){var r,i,o,a,s,u;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(i=new URL(this.props.connection.endpoint)).searchParams.append("storage",encodeURIComponent(this.props.connection.endpoint)),i.searchParams.append("tenantId",encodeURIComponent(zi(this.props.connection))),i.searchParams.append("containerId",encodeURIComponent(t)),e.next=6,this.urlResolver.resolve({url:i.href});case 6:if(o=e.sent){e.next=9;break}throw new Error("Unable to resolved URL");case 9:return e.next=11,this.documentServiceFactory.createDocumentService(o);case 11:return a=e.sent,e.next=14,a.connectToStorage();case 14:return s=e.sent,e.next=17,s.getVersions(null,null!==(r=null===n||void 0===n?void 0:n.maxCount)&&void 0!==r?r:5);case 17:return u=e.sent,e.abrupt("return",u.map((function(e){return{id:e.id,date:e.date}})));case 19:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"getContainerServices",value:function(e){return{audience:new c(e)}}},{key:"createLoader",value:function(e){var t=new mt.Y(e),n=function(){var e=(0,d.Z)((0,l.Z)().mark((function e(){return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",{module:{fluidExport:t},details:{package:"no-dynamic-package",config:{}}});case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),r={load:n};return new vt({urlResolver:this.urlResolver,documentServiceFactory:this.documentServiceFactory,codeLoader:r,logger:this.props.logger})}},{key:"createFluidContainer",value:function(){var e=(0,d.Z)((0,l.Z)().mark((function e(t,n){var r,i,o,a;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=ji(n.endpoint,zi(n)),e.next=3,(0,Di.bb)(t,"/");case 3:return i=e.sent,o=function(){var e=(0,d.Z)((0,l.Z)().mark((function e(){var n;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.attachState===h.mB.Detached){e.next=2;break}throw new Error("Cannot attach container. Container is not in detached state");case 2:return e.next=4,t.attach(r);case 4:return b(n=t.resolvedUrl),e.abrupt("return",n.id);case 7:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),(a=new gt.G(t,i)).attach=o,e.abrupt("return",a);case 8:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()}]),e}(),Gi=n(74569),Ki=n.n(Gi),Wi=function(){function e(t,n){(0,i.Z)(this,e),this.azFunctionUrl=t,this.user=n}return(0,o.Z)(e,[{key:"fetchOrdererToken",value:function(){var e=(0,d.Z)((0,l.Z)().mark((function e(t,n){return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getToken(t,n);case 2:return e.t0=e.sent,e.abrupt("return",{jwt:e.t0});case 4:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"fetchStorageToken",value:function(){var e=(0,d.Z)((0,l.Z)().mark((function e(t,n){return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getToken(t,n);case 2:return e.t0=e.sent,e.abrupt("return",{jwt:e.t0});case 4:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"getToken",value:function(){var e=(0,d.Z)((0,l.Z)().mark((function e(t,n){var r,i,o,a;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Ki().get(this.azFunctionUrl,{params:{tenantId:t,documentId:n,userId:null===(r=this.user)||void 0===r?void 0:r.userId,userName:null===(i=this.user)||void 0===i?void 0:i.userName,additionalDetails:null===(o=this.user)||void 0===o?void 0:o.additionalDetails}});case 2:return a=e.sent,e.abrupt("return",a.data);case 4:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()}]),e}();!function(e){e.DocRead="doc:read",e.DocWrite="doc:write",e.SummaryWrite="summary:write"}(Hi||(Hi={}))},27186:function(e,t,n){"use strict";function r(e,t){if(!e)throw new Error("number"===typeof t?"0x".concat(t.toString(16).padStart(3,"0")):t)}n.d(t,{h:function(){return r}})},85681:function(e,t,n){"use strict";n.r(t),n.d(t,{BaseTelemetryNullLogger:function(){return q},Deferred:function(){return z},EventForwarder:function(){return A},Heap:function(){return _},IsoBuffer:function(){return p},Lazy:function(){return B},LazyPromise:function(){return V},NumberComparer:function(){return R},PromiseCache:function(){return H},PromiseTimer:function(){return ee},RangeTracker:function(){return W},RateLimiter:function(){return J},TelemetryNullLogger:function(){return j},Timer:function(){return $},Trace:function(){return te},TypedEventEmitter:function(){return I},Uint8ArrayToArrayBuffer:function(){return y},Uint8ArrayToString:function(){return l},assert:function(){return r.h},bufferToString:function(){return h},delay:function(){return S},doIfNotDisposed:function(){return k},fromBase64ToUtf8:function(){return v},fromUtf8ToBase64:function(){return g},gitHashFile:function(){return Z},hashFile:function(){return M},isArrayBuffer:function(){return f},performance:function(){return L},safelyParseJSON:function(){return Q},setLongTimeout:function(){return X},stringToBuffer:function(){return d},toUtf8:function(){return m},unreachableCase:function(){return ne}});var r=n(27186),i=n(15671),o=n(43144),a=n(60136),s=n(29388),u=n(28664),c=n(2009);function l(e,t){switch(t){case"base64":return c.fromByteArray(e);case"utf8":case"utf-8":case void 0:return(new TextDecoder).decode(e);default:throw new Error("invalid/unsupported encoding")}}var d=function(e,t){return p.from(e,t).buffer},h=function(e,t){return p.from(e).toString(t)};function f(e){var t=e;return e instanceof ArrayBuffer||"object"===typeof t&&null!==t&&"number"===typeof t.byteLength&&"function"===typeof t.slice&&void 0===t.byteOffset&&void 0===t.buffer}var p=function(e){(0,a.Z)(n,e);var t=(0,s.Z)(n);function n(){return(0,i.Z)(this,n),t.apply(this,arguments)}return(0,o.Z)(n,[{key:"toString",value:function(e){return l(this,e)}}],[{key:"from",value:function(e,t,r){if("string"===typeof e)return n.fromString(e,t);if(null!==e&&"object"===typeof e&&f(e.buffer))return n.fromArrayBuffer(e.buffer,e.byteOffset,e.byteLength);if(f(e))return n.fromArrayBuffer(e,t,r);throw new TypeError}},{key:"fromArrayBuffer",value:function(e,t,r){var i=null!==t&&void 0!==t?t:0,o=null!==r&&void 0!==r?r:e.byteLength-i;if(i<0||i>e.byteLength||o<0||o+i>e.byteLength)throw new RangeError;return new n(e,i,o)}},{key:"fromString",value:function(e,t){switch(t){case"base64":var r=this.sanitizeBase64(e);return new n(c.toByteArray(r).buffer);case"utf8":case"utf-8":case void 0:return new n((new TextEncoder).encode(e).buffer);default:throw new Error("invalid/unsupported encoding")}}},{key:"isBuffer",value:function(e){throw new Error("unimplemented")}},{key:"sanitizeBase64",value:function(e){var t=e;if((t=(t=t.split("=")[0]).replace(/[^\w+-/]/g,"")).length%4!==0){t+=["","===","==","="][t.length%4]}return t}}]),n}((0,u.Z)(Uint8Array)),v=function(e){return p.from(e,"base64").toString("utf-8")},g=function(e){return p.from(e,"utf8").toString("base64")},m=function(e,t){switch(t){case"utf8":case"utf-8":return e;default:return p.from(e,t).toString()}};function y(e){return 0===e.byteOffset&&e.byteLength===e.buffer.byteLength?e.buffer:e.buffer.slice(e.byteOffset,e.byteOffset+e.byteLength)}var b=n(74165),w=n(15861),S=function(){var e=(0,w.Z)((0,b.Z)().mark((function e(t){return(0,b.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e){return setTimeout((function(){return e()}),t)})));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();function k(e,t){return function(){if(e.disposed)throw new Error("Already disposed");return t.apply(void 0,arguments)}}var C=n(37762),x=n(97326),E=n(11752),T=n(61120),I=function(e){(0,a.Z)(n,e);var t=(0,s.Z)(n);function n(){var e,r,o,a,s,u,c,l;return(0,i.Z)(this,n),(l=t.call(this)).addListener=(0,E.Z)((e=(0,x.Z)(l),(0,T.Z)(n.prototype)),"addListener",e).bind((0,x.Z)(l)),l.on=(0,E.Z)((r=(0,x.Z)(l),(0,T.Z)(n.prototype)),"on",r).bind((0,x.Z)(l)),l.once=(0,E.Z)((o=(0,x.Z)(l),(0,T.Z)(n.prototype)),"once",o).bind((0,x.Z)(l)),l.prependListener=(0,E.Z)((a=(0,x.Z)(l),(0,T.Z)(n.prototype)),"prependListener",a).bind((0,x.Z)(l)),l.prependOnceListener=(0,E.Z)((s=(0,x.Z)(l),(0,T.Z)(n.prototype)),"prependOnceListener",s).bind((0,x.Z)(l)),l.removeListener=(0,E.Z)((u=(0,x.Z)(l),(0,T.Z)(n.prototype)),"removeListener",u).bind((0,x.Z)(l)),l.off=(0,E.Z)((c=(0,x.Z)(l),(0,T.Z)(n.prototype)),"off",c).bind((0,x.Z)(l)),l}return(0,o.Z)(n)}(n(47465).EventEmitter),A=function(e){(0,a.Z)(n,e);var t=(0,s.Z)(n);function n(e){var r;if((0,i.Z)(this,n),(r=t.call(this)).isDisposed=!1,r.forwardingEvents=new Map,void 0!==e){r.on(n.removeListenerEvent,(function(t){return r.unforwardEvent(e,t)})),r.on(n.newListenerEvent,(function(t){return r.forwardEvent(e,t)}))}return r}return(0,o.Z)(n,[{key:"disposed",get:function(){return this.isDisposed}},{key:"dispose",value:function(){this.isDisposed=!0;var e,t=(0,C.Z)(this.forwardingEvents.values());try{for(t.s();!(e=t.n()).done;){var n,r=e.value,i=(0,C.Z)(r.values());try{for(i.s();!(n=i.n()).done;){var o=n.value;try{o()}catch(a){}}}catch(s){i.e(s)}finally{i.f()}}}catch(s){t.e(s)}finally{t.f()}this.removeAllListeners(),this.forwardingEvents.clear()}},{key:"forwardEvent",value:function(e){for(var t=this,r=arguments.length,i=new Array(r>1?r-1:0),o=1;o<r;o++)i[o-1]=arguments[o];for(var a=function(){var r=u[s];if(void 0!==e&&void 0!==r&&!n.isEmitterEvent(r)){var i=t.forwardingEvents.get(r);if(void 0===i&&(i=new Map,t.forwardingEvents.set(r,i)),!i.has(e)){var o=function(){for(var e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];return t.emit.apply(t,[r].concat(n))};i.set(e,(function(){return e.off(r,o)})),e.on(r,o)}}},s=0,u=i;s<u.length;s++)a()}},{key:"unforwardEvent",value:function(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),i=1;i<t;i++)r[i-1]=arguments[i];for(var o=0,a=r;o<a.length;o++){var s=a[o];if(void 0!==s&&!n.isEmitterEvent(s)){var u=this.forwardingEvents.get(s);if(!0===(null===u||void 0===u?void 0:u.has(e))&&0===this.listenerCount(s)){var c=u.get(e);void 0!==c&&c(),u.delete(e),0===u.size&&this.forwardingEvents.delete(s)}}}}}],[{key:"isEmitterEvent",value:function(e){return e===n.newListenerEvent||e===n.removeListenerEvent}}]),n}(I);A.newListenerEvent="newListener",A.removeListenerEvent="removeListener";var R={compare:function(e,t){return e-t},min:Number.MIN_VALUE},_=function(){function e(t){(0,i.Z)(this,e),this.comp=t,this.L=[{value:t.min,position:0}]}return(0,o.Z)(e,[{key:"peek",value:function(){return this.L[1]}},{key:"get",value:function(){this.swap(1,this.count());var e=this.L.pop();return this.fixdown(1),e.value}},{key:"add",value:function(e){var t={value:e,position:this.L.length};return this.L.push(t),this.fixup(this.count()),t}},{key:"update",value:function(e){var t=e.position;this.isGreaterThanParent(t)?this.fixup(t):this.fixdown(t)}},{key:"remove",value:function(e){var t=e.position;this.swap(e.position,this.L.length-1),this.L.splice(this.L.length-1),t!==this.L.length&&this.update(this.L[t])}},{key:"count",value:function(){return this.L.length-1}},{key:"fixup",value:function(e){for(var t=e;this.isGreaterThanParent(t);){var n=t>>1;this.swap(t,n),t=n}}},{key:"isGreaterThanParent",value:function(e){return e>1&&this.comp.compare(this.L[e>>1].value,this.L[e].value)>0}},{key:"fixdown",value:function(e){for(var t=e;t<<1<=this.count();){var n=t<<1;if(n<this.count()&&this.comp.compare(this.L[n].value,this.L[n+1].value)>0&&n++,this.comp.compare(this.L[t].value,this.L[n].value)<=0)break;this.swap(t,n),t=n}}},{key:"swap",value:function(e,t){var n=this.L[e];this.L[e]=this.L[t],this.L[e].position=e,this.L[t]=n,this.L[t].position=t}}]),e}();function P(e,t){return N.apply(this,arguments)}function N(){return(N=(0,w.Z)((0,b.Z)().mark((function e(t,n){var r;return(0,b.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,crypto.subtle.digest(n,t);case 2:return r=e.sent,e.abrupt("return",new Uint8Array(r));case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function O(e,t){switch(t){case"hex":return Array.prototype.map.call(e,(function(e){return e.toString(16).padStart(2,"0")})).join("");case"base64":return c.fromByteArray(e)}}function M(e){return F.apply(this,arguments)}function F(){return F=(0,w.Z)((0,b.Z)().mark((function e(t){var r,i,o,a=arguments;return(0,b.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=a.length>1&&void 0!==a[1]?a[1]:"SHA-1",i=a.length>2&&void 0!==a[2]?a[2]:"hex",void 0!==crypto.subtle){e.next=4;break}return e.abrupt("return",n.e(564).then(n.bind(n,5769)).then(function(){var e=(0,w.Z)((0,b.Z)().mark((function e(n){return(0,b.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",n.hashFile(t,r,i));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 4:return e.next=6,P(t,r);case 6:return o=e.sent,e.abrupt("return",O(o,i));case 8:case"end":return e.stop()}}),e)}))),F.apply(this,arguments)}function Z(e){return D.apply(this,arguments)}function D(){return(D=(0,w.Z)((0,b.Z)().mark((function e(t){var n,r,i;return(0,b.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.byteLength,r="blob ".concat(n.toString()).concat(String.fromCharCode(0)),i=p.from(r+t.toString()),e.abrupt("return",M(i));case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var L=globalThis.performance,B=function(){function e(t){(0,i.Z)(this,e),this.valueGenerator=t,this._evaluated=!1}return(0,o.Z)(e,[{key:"evaluated",get:function(){return this._evaluated}},{key:"value",get:function(){return this._evaluated||(this._evaluated=!0,this._value=this.valueGenerator()),this._value}}]),e}(),q=function(){function e(){(0,i.Z)(this,e)}return(0,o.Z)(e,[{key:"send",value:function(e){}}]),e}(),j=function(){function e(){(0,i.Z)(this,e)}return(0,o.Z)(e,[{key:"send",value:function(e){}},{key:"sendTelemetryEvent",value:function(e,t){}},{key:"sendErrorEvent",value:function(e,t){}},{key:"sendPerformanceEvent",value:function(e,t){}}]),e}(),U=function(){function e(t,n){(0,i.Z)(this,e),this.expiry=t,this.cleanup=n,this.gcTimeouts=new Map}return(0,o.Z)(e,[{key:"schedule",value:function(e){var t=this;"indefinite"!==this.expiry.policy&&this.gcTimeouts.set(e,setTimeout((function(){t.cleanup(e),t.cancel(e)}),this.expiry.durationMs))}},{key:"cancel",value:function(e){var t=this.gcTimeouts.get(e);void 0!==t&&(clearTimeout(t),this.gcTimeouts.delete(e))}},{key:"update",value:function(e){"sliding"===this.expiry.policy&&(this.cancel(e),this.schedule(e))}}]),e}(),H=function(){function e(){var t=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=n.expiry,o=void 0===r?{policy:"indefinite"}:r,a=n.removeOnError,s=void 0===a?function(){return!0}:a;(0,i.Z)(this,e),this.cache=new Map,this.removeOnError=s,this.gc=new U(o,(function(e){return t.remove(e)}))}return(0,o.Z)(e,[{key:"has",value:function(e){return this.cache.has(e)}},{key:"get",value:function(e){return this.has(e)&&this.gc.update(e),this.cache.get(e)}},{key:"remove",value:function(e){return this.gc.cancel(e),this.cache.delete(e)}},{key:"addOrGet",value:function(){var e=(0,w.Z)((0,b.Z)().mark((function e(t,n){var r,i,o=this;return(0,b.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return void 0===(r=this.get(t))&&(i=function(){var e=(0,w.Z)((0,b.Z)().mark((function e(){return(0,b.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",n());case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),r=i(),this.cache.set(t,r),r.catch((function(e){o.removeOnError(e)&&o.remove(t)})),this.gc.schedule(t)),e.abrupt("return",r);case 3:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"add",value:function(e,t){var n=this.has(e);return this.addOrGet(e,t).catch((function(){})),!n}},{key:"addValueOrGet",value:function(){var e=(0,w.Z)((0,b.Z)().mark((function e(t,n){return(0,b.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.addOrGet(t,(0,w.Z)((0,b.Z)().mark((function e(){return(0,b.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",n);case 1:case"end":return e.stop()}}),e)})))));case 1:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"addValue",value:function(e,t){return this.add(e,(0,w.Z)((0,b.Z)().mark((function e(){return(0,b.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",t);case 1:case"end":return e.stop()}}),e)}))))}}]),e}(),z=function(){function e(){var t=this;(0,i.Z)(this,e),this.completed=!1,this.p=new Promise((function(e,n){t.res=e,t.rej=n}))}return(0,o.Z)(e,[{key:"isCompleted",get:function(){return this.completed}},{key:"promise",get:function(){return this.p}},{key:"resolve",value:function(e){void 0!==this.res&&(this.completed=!0,this.res(e))}},{key:"reject",value:function(e){void 0!==this.rej&&(this.completed=!0,this.rej(e))}}]),e}(),V=function(e){function t(e){(0,i.Z)(this,t),this.execute=e}return(0,o.Z)(t,[{key:e,get:function(){return this.getPromise()[Symbol.toStringTag]}},{key:"then",value:function(){var e=(0,w.Z)((0,b.Z)().mark((function e(t,n){var r,i=arguments;return(0,b.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(r=this.getPromise()).then.apply(r,i));case 1:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"catch",value:function(){var e=(0,w.Z)((0,b.Z)().mark((function e(t){var n,r=arguments;return(0,b.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(n=this.getPromise()).catch.apply(n,r));case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"finally",value:function(){var e=(0,w.Z)((0,b.Z)().mark((function e(t){var n,r=arguments;return(0,b.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(n=this.getPromise()).finally.apply(n,r));case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getPromise",value:function(){var e=(0,w.Z)((0,b.Z)().mark((function e(){return(0,b.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return void 0===this.result&&(this.result=this.execute()),e.abrupt("return",this.result);case 2:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),t}(Symbol.toStringTag),G=n(58121),K=n.n(G),W=function(){function e(t,n){(0,i.Z)(this,e),"number"===typeof t?(this.ranges=[{length:0,primary:t,secondary:n}],this.lastPrimary=t,this.lastSecondary=n):(this.ranges=K()(t.ranges),this.lastPrimary=t.lastPrimary,this.lastSecondary=t.lastSecondary)}return(0,o.Z)(e,[{key:"base",get:function(){return this.ranges[0].primary}},{key:"primaryHead",get:function(){return this.lastPrimary}},{key:"secondaryHead",get:function(){return this.lastSecondary}},{key:"serialize",value:function(){return{lastPrimary:this.lastPrimary,lastSecondary:this.lastSecondary,ranges:K()(this.ranges)}}},{key:"add",value:function(e,t){(0,r.h)(e>=this.lastPrimary,3),void 0!==this.lastSecondary&&(0,r.h)(t>=this.lastSecondary,4),this.lastPrimary=e,this.lastSecondary=t;var n=this.ranges[this.ranges.length-1],i=n.primary+n.length,o=n.secondary+n.length;t!==o&&(e===i?0===n.length?n.secondary=t:(n.length--,this.ranges.push({length:0,primary:e,secondary:t})):i+1===e&&o+1===t?n.length++:this.ranges.push({length:0,primary:e,secondary:t}))}},{key:"get",value:function(e){(0,r.h)(e>=this.ranges[0].primary,5);for(var t=1;t<this.ranges.length&&!(e<this.ranges[t].primary);t++);(0,r.h)(e>=this.ranges[t-1].primary,6);var n=this.ranges[t-1];return Math.min(e-n.primary,n.length)+n.secondary}},{key:"updateBase",value:function(e){(0,r.h)(e>=this.ranges[0].primary,7);for(var t=1;t<this.ranges.length&&!(e<this.ranges[t].primary);t++);(0,r.h)(e>=this.ranges[t-1].primary,8);var n=this.ranges[t-1],i=e-n.primary;n.secondary=n.secondary+Math.min(i,n.length),n.length=Math.max(n.length-i,0),n.primary=e,this.ranges=t-1>0?this.ranges.slice(t-1):this.ranges,(0,r.h)(e===this.ranges[0].primary,9)}}]),e}(),J=function(){function e(t){(0,i.Z)(this,e),this.windowMSec=t,this.requestMap=new Map}return(0,o.Z)(e,[{key:"filter",value:function(e,t){var n,r=[],i=Date.now(),o=(0,C.Z)(t);try{for(o.s();!(n=o.n()).done;){var a=n.value,s="".concat(e,"/").concat(a);if(this.requestMap.has(s)){if(this.requestMap.get(s)+this.windowMSec>i)continue;this.requestMap.set(s,i),r.push(a)}else this.requestMap.set(s,i),r.push(a)}}catch(u){o.e(u)}finally{o.f()}return r}}]),e}();function Q(e){var t;try{t=JSON.parse(e)}catch(n){return}return t}var Y=2147483647;function X(e,t,n){var r;if(t>Y){var i=t-Y;r=setTimeout((function(){return X(e,i,n)}),Y)}else r=setTimeout((function(){return e()}),Math.max(t,0));return null===n||void 0===n||n(r),r}var $=function(){function e(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(){return Date.now()};(0,i.Z)(this,e),this.defaultTimeout=t,this.defaultHandler=n,this.getCurrentTick=r}return(0,o.Z)(e,[{key:"hasTimer",get:function(){return!!this.runningState}},{key:"start",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.defaultTimeout,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.defaultHandler;this.startCore(e,t,e)}},{key:"clear",value:function(){this.runningState&&(clearTimeout(this.runningState.timeout),this.runningState=void 0)}},{key:"restart",value:function(e,t){var n,r;if(this.runningState){var i=null!==e&&void 0!==e?e:this.runningState.intendedDuration,o=null!==(r=null!==t&&void 0!==t?t:null===(n=this.runningState.restart)||void 0===n?void 0:n.handler)&&void 0!==r?r:this.runningState.handler,a=this.calculateRemainingTime(this.runningState);i<a?this.start(i,o):i===a?(this.runningState.handler=o,this.runningState.restart=void 0,this.runningState.intendedDuration=i):this.runningState.restart={startTick:this.getCurrentTick(),duration:i,handler:o}}else this.start(e,t)}},{key:"startCore",value:function(e,t,n){var r=this;this.clear(),this.runningState={startTick:this.getCurrentTick(),duration:e,intendedDuration:n,handler:t,timeout:X((function(){return r.handler()}),e,(function(e){void 0!==r.runningState&&(r.runningState.timeout=e)}))}}},{key:"handler",value:function(){(0,r.h)(!!this.runningState,10);var e=this.runningState.restart;if(void 0!==e){var t=this.calculateRemainingTime(e);this.startCore(t,(function(){return e.handler()}),e.duration)}else{var n=this.runningState.handler;this.clear(),n()}}},{key:"calculateRemainingTime",value:function(e){var t=this.getCurrentTick()-e.startTick;return e.duration-t}}]),e}(),ee=function(){function e(t,n){var r=this;(0,i.Z)(this,e),this.timer=new $(t,(function(){return r.wrapHandler(n)}))}return(0,o.Z)(e,[{key:"hasTimer",get:function(){return this.timer.hasTimer}},{key:"start",value:function(){var e=(0,w.Z)((0,b.Z)().mark((function e(t,n){var r=this;return(0,b.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.clear(),this.deferred=new z,this.timer.start(t,n?function(){return r.wrapHandler(n)}:void 0),e.abrupt("return",this.deferred.promise);case 4:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"clear",value:function(){this.timer.clear(),this.deferred&&(this.deferred.resolve({timerResult:"cancel"}),this.deferred=void 0)}},{key:"wrapHandler",value:function(e){e(),(0,r.h)(!!this.deferred,11),this.deferred.resolve({timerResult:"timeout"}),this.deferred=void 0}}]),e}(),te=function(){function e(t){(0,i.Z)(this,e),this.startTick=t,this.lastTick=t}return(0,o.Z)(e,[{key:"trace",value:function(){var e=L.now(),t={totalTimeElapsed:e-this.startTick,duration:e-this.lastTick,tick:e};return this.lastTick=e,t}}],[{key:"start",value:function(){return new e(L.now())}}]),e}();function ne(e){throw new Error(arguments.length>1&&void 0!==arguments[1]?arguments[1]:"Unreachable Case")}},90142:function(e,t,n){"use strict";var r;n.d(t,{u:function(){return r}}),function(e){e.genericError="genericError",e.throttlingError="throttlingError",e.dataCorruptionError="dataCorruptionError",e.dataProcessingError="dataProcessingError",e.usageError="usageError",e.clientSessionExpiredError="clientSessionExpiredError"}(r||(r={}))},73592:function(e,t,n){"use strict";n.d(t,{Ai:function(){return o},Tr:function(){return i},s2:function(){return r}});var r=function(e){return"object"===typeof e&&"string"===typeof(null===e||void 0===e?void 0:e.name)&&"object"===typeof(null===e||void 0===e?void 0:e.fluid)},i=function(e){var t=e;return"object"===typeof t&&("string"===typeof(null===t||void 0===t?void 0:t.package)||r(null===t||void 0===t?void 0:t.package))&&(void 0===(null===t||void 0===t?void 0:t.config)||"object"===typeof(null===t||void 0===t?void 0:t.config))},o="IFluidCodeDetailsComparer"},14993:function(e,t,n){"use strict";n.r(t),n.d(t,{AttachState:function(){return s.mB},BindState:function(){return s.xU},ContainerErrorType:function(){return o.u},IFluidCodeDetailsComparer:function(){return r.Ai},IFluidTokenProvider:function(){return u},IRuntimeFactory:function(){return s.Wy},LoaderHeader:function(){return a.A},isFluidBrowserPackage:function(){return i},isFluidCodeDetails:function(){return r.Tr},isFluidPackage:function(){return r.s2}});var r=n(73592),i=function(e){var t,n,i,o,a,s;return(0,r.s2)(e)&&"string"===typeof(null===(i=null===(n=null===(t=null===e||void 0===e?void 0:e.fluid)||void 0===t?void 0:t.browser)||void 0===n?void 0:n.umd)||void 0===i?void 0:i.library)&&Array.isArray(null===(s=null===(a=null===(o=null===e||void 0===e?void 0:e.fluid)||void 0===o?void 0:o.browser)||void 0===a?void 0:a.umd)||void 0===s?void 0:s.files)},o=n(90142),a=n(36569),s=n(57115),u="IFluidTokenProvider"},36569:function(e,t,n){"use strict";var r;n.d(t,{A:function(){return r}}),function(e){e.cache="fluid-cache",e.clientDetails="fluid-client-details",e.loadMode="loadMode",e.reconnect="fluid-reconnect",e.sequenceNumber="fluid-sequence-number",e.version="version"}(r||(r={}))},57115:function(e,t,n){"use strict";var r,i;n.d(t,{Wy:function(){return o},mB:function(){return r},xU:function(){return i}}),function(e){e.Detached="Detached",e.Attaching="Attaching",e.Attached="Attached"}(r||(r={})),function(e){e.NotBound="NotBound",e.Binding="Binding",e.Bound="Bound"}(i||(i={}));var o="IRuntimeFactory"},13093:function(e,t,n){"use strict";var r;n.d(t,{e:function(){return r}}),function(e){e[e.Disconnected=0]="Disconnected",e[e.EstablishingConnection=3]="EstablishingConnection",e[e.Connecting=1]="Connecting",e[e.CatchingUp=1]="CatchingUp",e[e.Connected=2]="Connected"}(r||(r={}))},95475:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.IContainerRuntime=void 0,t.IContainerRuntime="IContainerRuntime"},73061:function(e,t,n){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),i=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||r(t,e,n)};Object.defineProperty(t,"__esModule",{value:!0}),i(n(95475),t)},48238:function(e,t,n){"use strict";n.d(t,{kE:function(){return Kt},lf:function(){return qt}});var r=n(29439),i=n(4942),o=n(93433),a=n(74165),s=n(15861),u=n(97326),c=n(60136),l=n(29388),d=n(37762),h=n(15671),f=n(43144),p=n(57115),v=n(36569);function g(e,t){if(!e)throw new Error("number"===typeof t?"0x".concat(t.toString(16).padStart(3,"0")):t)}var m=window.performance;function y(e){throw new Error(arguments.length>1&&void 0!==arguments[1]?arguments[1]:"Unreachable Case")}var b,w,S,k=function(){function e(t){(0,h.Z)(this,e),this.startTick=t,this.lastTick=t}return(0,f.Z)(e,[{key:"trace",value:function(){var e=m.now(),t={totalTimeElapsed:e-this.startTick,duration:e-this.lastTick,tick:e};return this.lastTick=e,t}}],[{key:"start",value:function(){return new e(m.now())}}]),e}(),C=n(11752),x=n(61120),E=n(47465),T=function(e){(0,c.Z)(n,e);var t=(0,l.Z)(n);function n(){var e,r,i,o,a,s,c,l;return(0,h.Z)(this,n),(l=t.call(this)).addListener=(0,C.Z)((e=(0,u.Z)(l),(0,x.Z)(n.prototype)),"addListener",e).bind((0,u.Z)(l)),l.on=(0,C.Z)((r=(0,u.Z)(l),(0,x.Z)(n.prototype)),"on",r).bind((0,u.Z)(l)),l.once=(0,C.Z)((i=(0,u.Z)(l),(0,x.Z)(n.prototype)),"once",i).bind((0,u.Z)(l)),l.prependListener=(0,C.Z)((o=(0,u.Z)(l),(0,x.Z)(n.prototype)),"prependListener",o).bind((0,u.Z)(l)),l.prependOnceListener=(0,C.Z)((a=(0,u.Z)(l),(0,x.Z)(n.prototype)),"prependOnceListener",a).bind((0,u.Z)(l)),l.removeListener=(0,C.Z)((s=(0,u.Z)(l),(0,x.Z)(n.prototype)),"removeListener",s).bind((0,u.Z)(l)),l.off=(0,C.Z)((c=(0,u.Z)(l),(0,x.Z)(n.prototype)),"off",c).bind((0,u.Z)(l)),l}return(0,f.Z)(n)}(E.EventEmitter),I=n(98895),A=n(91075),R=n(99025),_=n(54823),P=n(65922),N=n(91688),O=n(10357);!function(e){e.NoOp="noop",e.ClientJoin="join",e.ClientLeave="leave",e.Propose="propose",e.Reject="reject",e.Summarize="summarize",e.SummaryAck="summaryAck",e.SummaryNack="summaryNack",e.Operation="op",e.RemoteHelp="remoteHelp",e.NoClient="noClient",e.RoundTrip="tripComplete",e.Control="control"}(b||(b={})),function(e){e.ThrottlingError="ThrottlingError",e.InvalidScopeError="InvalidScopeError",e.BadRequestError="BadRequestError",e.LimitExceededError="LimitExceededError"}(w||(w={})),function(e){e.Tree=1,e.Blob=2,e.Handle=3,e.Attachment=4}(S||(S={}));var M=n(62790),F=n(69514),Z=n(10003),D=n(63760),L=n(91869),B=n(79605),q=n(20644),j=n(39575),U=n(87154),H=function(){function e(t,n,r){(0,h.Z)(this,e),this.path=t,this.runtime=n,this.routeContext=r,this.absolutePath=(0,U.H)(t,this.routeContext)}return(0,f.Z)(e,[{key:"IFluidHandleContext",get:function(){return this}},{key:"attachGraph",value:function(){throw new Error("can't attach container runtime form within container!")}},{key:"isAttached",get:function(){return this.runtime.attachState!==p.mB.Detached}},{key:"resolveHandle",value:function(){var e=(0,s.Z)((0,a.Z)().mark((function e(t){return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.runtime.resolveHandle(t));case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),e}(),z=n(87922),V=function(){function e(){var t=this;(0,h.Z)(this,e),this.completed=!1,this.p=new Promise((function(e,n){t.res=e,t.rej=n}))}return(0,f.Z)(e,[{key:"isCompleted",get:function(){return this.completed}},{key:"promise",get:function(){return this.p}},{key:"resolve",value:function(e){void 0!==this.res&&(this.completed=!0,this.res(e))}},{key:"reject",value:function(e){void 0!==this.rej&&(this.completed=!0,this.rej(e))}}]),e}(),G=function(e){function t(e){(0,h.Z)(this,t),this.execute=e}return(0,f.Z)(t,[{key:e,get:function(){return this.getPromise()[Symbol.toStringTag]}},{key:"then",value:function(){var e=(0,s.Z)((0,a.Z)().mark((function e(t,n){var r,i=arguments;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(r=this.getPromise()).then.apply(r,i));case 1:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"catch",value:function(){var e=(0,s.Z)((0,a.Z)().mark((function e(t){var n,r=arguments;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(n=this.getPromise()).catch.apply(n,r));case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"finally",value:function(){var e=(0,s.Z)((0,a.Z)().mark((function e(t){var n,r=arguments;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(n=this.getPromise()).finally.apply(n,r));case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getPromise",value:function(){var e=(0,s.Z)((0,a.Z)().mark((function e(){return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return void 0===this.result&&(this.result=this.execute()),e.abrupt("return",this.result);case 2:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),t}(Symbol.toStringTag),K=n(84871),W=n(65059),J=n(1467),Q="summarizer",Y=function(e){(0,c.Z)(n,e);var t=(0,l.Z)(n);function n(e,r,i,o,a){var s;return(0,h.Z)(this,n),(s=t.call(this)).logger=e,s.summaryCollection=r,s.clientElection=i,s.maxOpsSinceLastSummary=o,s.electionEnabled=a,s.lastReportedSeq=0,s.summaryCollection.on("default",(function(e){var t,n,r,i=e.sequenceNumber,a=s.electedClientId;if(void 0!==a){var u=s.clientElection.electionSequenceNumber;if(i-(null!==(t=s.lastSummaryAckSeqForClient)&&void 0!==t?t:u)>s.maxOpsSinceLastSummary){var c=i-s.lastReportedSeq;if(c>s.maxOpsSinceLastSummary&&(s.logger.sendErrorEvent({eventName:"ElectedClientNotSummarizing",electedClientId:a,lastSummaryAckSeqForClient:s.lastSummaryAckSeqForClient,electionSequenceNumber:u,nextElectedClientId:null===(n=s.clientElection.peekNextElectedClient())||void 0===n?void 0:n.clientId,electionEnabled:s.electionEnabled}),s.lastReportedSeq=i),s.electionEnabled){var l=s.electedParentId;s.clientElection.incrementElectedClient(i),u=s.clientElection.electionSequenceNumber,i>(null!==(r=s.lastSummaryAckSeqForClient)&&void 0!==r?r:u)&&c>s.maxOpsSinceLastSummary&&s.logger.sendErrorEvent({eventName:"UnexpectedElectionSequenceNumber",lastSummaryAckSeqForClient:s.lastSummaryAckSeqForClient,electionSequenceNumber:u,sequenceNumber:i,previousClientId:a,previousParentId:l,electedParentId:s.electedParentId,electedClientId:s.electedClientId,opsSinceLastReport:c,maxOpsSinceLastSummary:o})}}}else s.clientElection.eligibleCount>0&&s.clientElection.resetElectedClient(i)})),s.summaryCollection.on(b.SummaryAck,(function(e){s.lastSummaryAckSeqForClient=e.sequenceNumber})),s.clientElection.on("election",(function(e,t){s.lastSummaryAckSeqForClient=void 0,void 0===e&&s.clientElection.eligibleCount>0&&s.clientElection.resetElectedClient(t),s.emit("electedSummarizerChanged")})),s}return(0,f.Z)(n,[{key:"electedClientId",get:function(){var e;return null===(e=this.clientElection.electedClient)||void 0===e?void 0:e.clientId}},{key:"electedParentId",get:function(){var e;return null===(e=this.clientElection.electedParent)||void 0===e?void 0:e.clientId}},{key:"serialize",value:function(){var e,t=this.clientElection.serialize(),n=t.electedClientId,r=t.electedParentId,i=t.electionSequenceNumber;return{electedClientId:n,electedParentId:r,electionSequenceNumber:null!==(e=this.lastSummaryAckSeqForClient)&&void 0!==e?e:i}}}],[{key:"isClientEligible",value:function(e){var t=e.client.details;return void 0===t||n.clientDetailsPermitElection(t)}}]),n}(T);Y.clientDetailsPermitElection=function(e){return e.capabilities.interactive||e.type===Q};var X=n(70163),$=function(e){(0,c.Z)(n,e);var t=(0,l.Z)(n);function n(){return(0,h.Z)(this,n),t.apply(this,arguments)}return(0,f.Z)(n,[{key:"get",value:function(){var e=(0,s.Z)((0,a.Z)().mark((function e(){return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw Error("Do not try to get a summarizer object from the handle. Reference it directly.");case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"attach",value:function(){}},{key:"bind",value:function(e){}}]),n}(X.B),ee=function(){function e(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(){return Date.now()};(0,h.Z)(this,e),this.defaultTimeout=t,this.defaultHandler=n,this.getCurrentTick=r}return(0,f.Z)(e,[{key:"hasTimer",get:function(){return!!this.runningState}},{key:"start",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.defaultTimeout,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.defaultHandler;this.startCore(e,t,e)}},{key:"clear",value:function(){this.runningState&&(clearTimeout(this.runningState.timeout),this.runningState=void 0)}},{key:"restart",value:function(e,t){var n,r;if(this.runningState){var i=null!==e&&void 0!==e?e:this.runningState.intendedDuration,o=null!==(r=null!==t&&void 0!==t?t:null===(n=this.runningState.restart)||void 0===n?void 0:n.handler)&&void 0!==r?r:this.runningState.handler,a=this.calculateRemainingTime(this.runningState);i<a?this.start(i,o):i===a?(this.runningState.handler=o,this.runningState.restart=void 0,this.runningState.intendedDuration=i):this.runningState.restart={startTick:this.getCurrentTick(),duration:i,handler:o}}else this.start(e,t)}},{key:"startCore",value:function(e,t,n){var r=this;this.clear(),this.runningState={startTick:this.getCurrentTick(),duration:e,intendedDuration:n,handler:t,timeout:setTimeout((function(){return r.handler()}),e)}}},{key:"handler",value:function(){g(!!this.runningState,10);var e=this.runningState.restart;if(void 0!==e){var t=this.calculateRemainingTime(e);this.startCore(t,(function(){return e.handler()}),e.duration)}else{var n=this.runningState.handler;this.clear(),n()}}},{key:"calculateRemainingTime",value:function(e){var t=this.getCurrentTick()-e.startTick;return e.duration-t}}]),e}(),te=function(){function e(t,n){var r=this;(0,h.Z)(this,e),this.timer=new ee(t,(function(){return r.wrapHandler(n)}))}return(0,f.Z)(e,[{key:"hasTimer",get:function(){return this.timer.hasTimer}},{key:"start",value:function(){var e=(0,s.Z)((0,a.Z)().mark((function e(t,n){var r=this;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.clear(),this.deferred=new V,this.timer.start(t,n?function(){return r.wrapHandler(n)}:void 0),e.abrupt("return",this.deferred.promise);case 4:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"clear",value:function(){this.timer.clear(),this.deferred&&(this.deferred.resolve({timerResult:"cancel"}),this.deferred=void 0)}},{key:"wrapHandler",value:function(e){e(),g(!!this.deferred,11),this.deferred.resolve({timerResult:"timeout"}),this.deferred=void 0}}]),e}(),ne=function(){var e=(0,s.Z)((0,a.Z)().mark((function e(t){return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e){return setTimeout((function(){return e()}),t)})));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),re=function(){function e(t,n){(0,h.Z)(this,e),this.lastOpSequenceNumber=t,this._lastAttempt=n,this._lastSuccessfulSummary=Object.assign({},n)}return(0,f.Z)(e,[{key:"lastAttempt",get:function(){return this._lastAttempt}},{key:"lastSuccessfulSummary",get:function(){return this._lastSuccessfulSummary}},{key:"updateWithLastSummaryAckInfo",value:function(e){this._lastAttempt=e,this._lastSuccessfulSummary=Object.assign({},e)}},{key:"recordAttempt",value:function(e){this._lastAttempt={refSequenceNumber:null!==e&&void 0!==e?e:this.lastOpSequenceNumber,summaryTime:Date.now()}}},{key:"markLastAttemptAsSuccessful",value:function(){this._lastSuccessfulSummary=Object.assign({},this.lastAttempt)}}]),e}(),ie=function(){function e(t,n,r,i){var o=this;(0,h.Z)(this,e),this.heuristicData=t,this.configuration=n,this.trySummarize=r,this.logger=i,this.idleTimer=new ee(this.configuration.idleTime,(function(){return o.trySummarize("idle")})),this.minOpsForLastSummaryAttempt=this.configuration.minOpsForLastSummaryAttempt}return(0,f.Z)(e,[{key:"opsSinceLastAck",get:function(){return this.heuristicData.lastOpSequenceNumber-this.heuristicData.lastSuccessfulSummary.refSequenceNumber}},{key:"run",value:function(){var e=Date.now()-this.heuristicData.lastSuccessfulSummary.summaryTime,t=this.opsSinceLastAck;e>this.configuration.maxTime?(this.idleTimer.clear(),this.trySummarize("maxTime")):t>this.configuration.maxOps?(this.idleTimer.clear(),this.trySummarize("maxOps")):this.idleTimer.restart()}},{key:"shouldRunLastSummary",value:function(){var e=this.opsSinceLastAck,t=this.minOpsForLastSummaryAttempt;return this.logger.sendTelemetryEvent({eventName:"ShouldRunLastSummary",opsSinceLastAck:e,minOpsForLastSummaryAttempt:t}),e>=t}},{key:"dispose",value:function(){this.idleTimer.clear()}}]),e}(),oe=n(1244);function ae(e,t,n){return se.apply(this,arguments)}function se(){return(se=(0,s.Z)((0,a.Z)().mark((function e(t,n,r){var i;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=[t.then((function(e){return{result:"done",value:e}})),n.then((function(e){return{result:e.timerResult}}))],void 0!==r&&i.push(r.waitCancelled.then((function(){return{result:"cancelled"}}))),e.abrupt("return",Promise.race(i));case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var ue,ce={submitSummaryFailure:"Error while generating, uploading, or submitting summary",summaryOpWaitTimeout:"Timeout while waiting for summarize op broadcast",summaryAckWaitTimeout:"Timeout while waiting for summaryAck/summaryNack op",summaryNack:"Server rejected summary via summaryNack op",disconnect:"Summary cancelled due to summarizer or main client disconnect"},le=function(){function e(){(0,h.Z)(this,e),this.summarySubmitted=new V,this.summaryOpBroadcasted=new V,this.receivedSummaryAckOrNack=new V}return(0,f.Z)(e,[{key:"fail",value:function(e,t,n,r){g(!this.receivedSummaryAckOrNack.isCompleted,606);var i={success:!1,message:e,data:void 0,error:t,retryAfterSeconds:r};this.summarySubmitted.resolve(i),this.summaryOpBroadcasted.resolve(i),this.receivedSummaryAckOrNack.resolve(Object.assign(Object.assign({},i),{data:n}))}},{key:"build",value:function(){return{summarySubmitted:this.summarySubmitted.promise,summaryOpBroadcasted:this.summaryOpBroadcasted.promise,receivedSummaryAckOrNack:this.receivedSummaryAckOrNack.promise}}}]),e}(),de=function(){function e(t,n,r,i,o,a,s){var u=this;(0,h.Z)(this,e),this.pendingAckTimer=t,this.heuristicData=n,this.submitSummaryCallback=r,this.raiseSummarizingError=i,this.successfulSummaryCallback=o,this.summaryWatcher=a,this.logger=s,this.summarizeTimer=new ee(2e4,(function(){return u.summarizeTimerHandler(2e4,1)}))}return(0,f.Z)(e,[{key:"summarize",value:function(e,t,n){var r=this,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new le;return this.summarizeCore(e,t,i,n).catch((function(t){var n="UnexpectedSummarizeError";r.logger.sendErrorEvent(Object.assign({eventName:n},e),t),i.fail(n,t)})),i.build()}},{key:"summarizeCore",value:function(){var e=(0,s.Z)((0,a.Z)().mark((function e(t,n,r,i){var o,s,u,c,l,d,h,f,p,v,m,y,w,S,k,C,x,E,T,A,R,_,P,N,O,M,F,Z,D=this;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=n.refreshLatestAck,s=n.fullTree,u=I.G2.create(this.logger,void 0,{all:t}),c=Date.now()-this.heuristicData.lastAttempt.summaryTime,l=Date.now()-this.heuristicData.lastSuccessfulSummary.summaryTime,d={fullTree:s,timeSinceLastAttempt:c,timeSinceLastSummary:l},h=I.Xr.start(u,Object.assign({eventName:"Summarize",refreshLatestAck:o},d)),f=function(e){return"".concat(e,": ").concat(ce[e])},p=function(e,t,n,o){D.raiseSummarizingError(ce[e]);var a=(0,oe.GS)(t),s=i.cancelled||(null===t||void 0===t?void 0:t.errorType)===K.C.offlineError?"generic":"error";h.cancel(Object.assign(Object.assign({},n),{reason:e,category:s,retryAfterSeconds:a}),t),r.fail(f(e),t,o,a)},this.summarizeTimer.start(),e.prev=9,e.next=12,this.submitSummaryCallback({fullTree:s,refreshLatestAck:o,summaryLogger:u,cancellationToken:i});case 12:if(v=e.sent,m=v.referenceSequenceNumber,y=m-this.heuristicData.lastSuccessfulSummary.refSequenceNumber,d=Object.assign(Object.assign({},d),{referenceSequenceNumber:m,minimumSequenceNumber:v.minimumSequenceNumber,opsSinceLastAttempt:m-this.heuristicData.lastAttempt.refSequenceNumber,opsSinceLastSummary:y}),"base"!==v.stage&&(d=Object.assign(Object.assign(Object.assign({},d),v.summaryStats),{generateDuration:v.generateDuration}),"generate"!==v.stage&&(d=Object.assign(Object.assign({},d),{handle:v.handle,uploadDuration:v.uploadDuration}),"upload"!==v.stage&&(d=Object.assign(Object.assign({},d),{clientSequenceNumber:v.clientSequenceNumber})))),"submit"===v.stage){e.next=19;break}return e.abrupt("return",p("submitSummaryFailure",v.error,d));case 19:s||v.forcedFullTree||(w=v.summaryStats,S=w.summarizedDataStoreCount,k=w.gcStateUpdatedDataStoreCount,S>(C=void 0===k?0:k)+y&&u.sendErrorEvent({eventName:"IncrementalSummaryViolation",summarizedDataStoreCount:S,gcStateUpdatedDataStoreCount:C,opsSinceLastSummary:y})),h.reportEvent("generate",Object.assign({},d)),r.summarySubmitted.resolve({success:!0,data:v}),e.next=27;break;case 24:return e.prev=24,e.t0=e.catch(9),e.abrupt("return",p("submitSummaryFailure",e.t0));case 27:return e.prev=27,this.heuristicData.recordAttempt(null===v||void 0===v?void 0:v.referenceSequenceNumber),this.summarizeTimer.clear(),e.finish(27);case 31:return e.prev=31,x=this.pendingAckTimer.start(),E=this.summaryWatcher.watchSummary(v.clientSequenceNumber),e.next=36,ae(E.waitBroadcast(),x,i);case 36:if("cancelled"!==(T=e.sent).result){e.next=39;break}return e.abrupt("return",p("disconnect"));case 39:if("done"===T.result){e.next=41;break}return e.abrupt("return",p("summaryOpWaitTimeout"));case 41:return A=T.value,R=Date.now()-this.heuristicData.lastAttempt.summaryTime,r.summaryOpBroadcasted.resolve({success:!0,data:{summarizeOp:A,broadcastDuration:R}}),this.heuristicData.lastAttempt.summarySequenceNumber=A.sequenceNumber,u.sendTelemetryEvent({eventName:"Summarize_Op",duration:R,referenceSequenceNumber:A.referenceSequenceNumber,summarySequenceNumber:A.sequenceNumber,handle:A.contents.handle}),e.next=48,ae(E.waitAckNack(),x,i);case 48:if("cancelled"!==(_=e.sent).result){e.next=51;break}return e.abrupt("return",p("disconnect"));case 51:if("done"===_.result){e.next=53;break}return e.abrupt("return",p("summaryAckWaitTimeout"));case 53:if(P=_.value,this.pendingAckTimer.clear(),N=Date.now()-this.heuristicData.lastAttempt.summaryTime,d=Object.assign({ackWaitDuration:N,ackNackSequenceNumber:P.sequenceNumber,summarySequenceNumber:P.contents.summaryProposal.summarySequenceNumber},d),P.type!==b.SummaryAck){e.next=64;break}this.heuristicData.markLastAttemptAsSuccessful(),this.successfulSummaryCallback(),h.end(Object.assign(Object.assign({},d),{handle:P.contents.handle})),r.receivedSummaryAckOrNack.resolve({success:!0,data:{summaryAckOp:P,ackNackDuration:N}}),e.next=71;break;case 64:return g(P.type===b.SummaryNack,628),O=P.contents,M=null===O||void 0===O?void 0:O.message,F=null===O||void 0===O?void 0:O.retryAfter,Z=new W.j4("Received summaryNack: ".concat(M),{retryAfterSeconds:F}),g((0,oe.GS)(Z)===F,607),e.abrupt("return",p("summaryNack",Z,Object.assign(Object.assign({},d),{nackRetryAfter:F}),{summaryNackOp:P,ackNackDuration:N}));case 71:return e.prev=71,this.pendingAckTimer.clear(),e.finish(71);case 74:case"end":return e.stop()}}),e,this,[[9,24,27,31],[31,,71,74]])})));return function(t,n,r,i){return e.apply(this,arguments)}}()},{key:"summarizeTimerHandler",value:function(e,t){var n=this;if(this.logger.sendPerformanceEvent({eventName:"SummarizeTimeout",timeoutTime:e,timeoutCount:t}),t<5){var r=2*e;this.summarizeTimer.start(r,(function(){return n.summarizeTimerHandler(r,t+1)}))}}},{key:"dispose",value:function(){this.summarizeTimer.clear()}}]),e}(),he=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"===typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n},fe=function(){function e(t,n,r,i,o,a,s,u,c){var l=this;(0,h.Z)(this,e),this.summaryWatcher=n,this.configuration=r,this.submitSummaryCallback=i,this.heuristicData=o,this.raiseSummarizingError=a,this.summaryCollection=s,this.cancellationToken=u,this.stopSummarizerCallback=c,this.stopping=!1,this._disposed=!1,this.tryWhileSummarizing=!1,this.summarizeCount=0,this.totalSuccessfulAttempts=0,this.tryGetCorrelatedLogger=function(e){return l.heuristicData.lastAttempt.refSequenceNumber===e?l.logger:void 0};var d={summarizeCount:function(){return l.summarizeCount},summarizerSuccessfulAttempts:function(){return l.totalSuccessfulAttempts}};this.logger=I.G2.create(t,"Running",{all:d}),"disableHeuristics"!==r.state&&(g("enabled"===this.configuration.state,746),this.heuristicRunner=new ie(o,this.configuration,(function(e){return l.trySummarize(e)}),this.logger)),g("disabled"!==this.configuration.state,747);var f=Math.min(this.configuration.maxAckWaitTime,6e5);this.pendingAckTimer=new te(f,(function(){l.raiseSummarizingError("Pending summary ack not received in time"),l.logger.sendErrorEvent({eventName:"SummaryAckWaitTimeout",maxAckWaitTime:f,referenceSequenceNumber:l.heuristicData.lastAttempt.refSequenceNumber,summarySequenceNumber:l.heuristicData.lastAttempt.summarySequenceNumber,timePending:Date.now()-l.heuristicData.lastAttempt.summaryTime})})),s.setPendingAckTimerTimeoutCallback(f,(function(){l.pendingAckTimer.hasTimer&&(l.logger.sendTelemetryEvent({eventName:"MissingSummaryAckFoundByOps",referenceSequenceNumber:l.heuristicData.lastAttempt.refSequenceNumber,summarySequenceNumber:l.heuristicData.lastAttempt.summarySequenceNumber}),l.pendingAckTimer.clear())})),this.generator=new de(this.pendingAckTimer,this.heuristicData,this.submitSummaryCallback,this.raiseSummarizingError,(function(){l.totalSuccessfulAttempts++}),this.summaryWatcher,this.logger)}return(0,f.Z)(e,[{key:"disposed",get:function(){return this._disposed}},{key:"dispose",value:function(){var e;this.summaryWatcher.dispose(),null===(e=this.heuristicRunner)||void 0===e||e.dispose(),this.heuristicRunner=void 0,this.generator.dispose(),this.pendingAckTimer.clear(),this.disposeEnqueuedSummary(),this._disposed=!0,this.stopping=!0}},{key:"handleSystemOp",value:function(e){switch(e.type){case b.ClientLeave:case b.ClientJoin:case b.Propose:return void this.handleOp(void 0,e);default:return}}},{key:"handleOp",value:function(e,t){var n,r=t.sequenceNumber;t.type,t.clientId,t.contents;void 0===e&&(this.heuristicData.lastOpSequenceNumber=r,this.tryRunEnqueuedSummary()||null===(n=this.heuristicRunner)||void 0===n||n.run())}},{key:"waitStop",value:function(){var e=(0,s.Z)((0,a.Z)().mark((function e(t){var n;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.stopping){e.next=2;break}return e.abrupt("return");case 2:return this.stopping=!0,this.disposeEnqueuedSummary(),t&&(null===(n=this.heuristicRunner)||void 0===n?void 0:n.shouldRunLastSummary())&&void 0===this.summarizingLock&&this.trySummarizeOnce({reason:"lastSummary"},{}),e.next=7,this.summarizingLock;case 7:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"waitStart",value:function(){var e=(0,s.Z)((0,a.Z)().mark((function e(){var t;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,ae(this.summaryWatcher.waitFlushed(),this.pendingAckTimer.start());case 2:t=e.sent,this.pendingAckTimer.clear(),this.summaryCollection.unsetPendingAckTimerTimeoutCallback(),"done"===t.result&&void 0!==t.value&&this.heuristicData.updateWithLastSummaryAckInfo({refSequenceNumber:t.value.summaryOp.referenceSequenceNumber,summaryTime:Date.now(),summarySequenceNumber:t.value.summaryOp.sequenceNumber});case 6:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"lockedRefreshSummaryAckAction",value:function(){var e=(0,s.Z)((0,a.Z)().mark((function e(t){var n,r=this;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return g(void 0===this.refreshSummaryAckLock,"Refresh Summary Ack - Caller is responsible for checking lock"),n=new V,this.refreshSummaryAckLock=n.promise,e.abrupt("return",t().finally((function(){n.resolve(),r.refreshSummaryAckLock=void 0})));case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"lockedSummaryAction",value:function(){var e=(0,s.Z)((0,a.Z)().mark((function e(t){var n,r=this;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return g(void 0===this.summarizingLock,603),n=new V,this.summarizingLock=n.promise,this.summarizeCount++,e.next=6,this.refreshSummaryAckLock;case 6:return e.abrupt("return",t().finally((function(){var e;n.resolve(),r.summarizingLock=void 0;var t=r.tryWhileSummarizing;r.tryWhileSummarizing=!1,r.stopping||r.tryRunEnqueuedSummary()||!t||null===(e=r.heuristicRunner)||void 0===e||e.run()})));case 7:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"trySummarizeOnce",value:function(e,t){var n=this,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.cancellationToken,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new le;return this.lockedSummaryAction((0,s.Z)((0,a.Z)().mark((function o(){var s;return(0,a.Z)().wrap((function(o){for(;;)switch(o.prev=o.next){case 0:return s=n.generator.summarize(e,t,r,i),o.abrupt("return",s.receivedSummaryAckOrNack);case 2:case"end":return o.stop()}}),o)})))).catch((function(e){})),i.build()}},{key:"trySummarize",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.cancellationToken;void 0===this.summarizingLock?this.lockedSummaryAction((0,s.Z)((0,a.Z)().mark((function r(){var i,o,s,u,c,l,d,h,f,p,v,g,m,y;return(0,a.Z)().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:i=[{refreshLatestAck:!1,fullTree:!1},{refreshLatestAck:!0,fullTree:!1},{refreshLatestAck:!0,fullTree:!1,delaySeconds:120},{refreshLatestAck:!0,fullTree:!0,delaySeconds:600}],s=0,u=0,l=0;case 4:if(!(l<i.length)){r.next=30;break}if(!t.cancellationToken.cancelled){r.next=7;break}return r.abrupt("return");case 7:if(!(++s>1&&"lastSummary"===e)){r.next=9;break}return r.abrupt("return");case 9:if(u++,d=i[l],h=d.delaySeconds,f=void 0===h?0:h,p=he(d,["delaySeconds"]),v=null!==o&&void 0!==o?o:f,g=Object.assign({reason:e,summaryAttempts:s,summaryAttemptsPerPhase:u,summaryAttemptPhase:l+1},p),!(v>0)){r.next=17;break}return t.logger.sendPerformanceEvent(Object.assign({eventName:"SummarizeAttemptDelay",duration:v,summaryNackDelay:void 0!==o},g)),r.next=17,ne(1e3*v);case 17:return r.next=19,t.refreshSummaryAckLock;case 19:return m=t.generator.summarize(g,p,n),r.next=22,m.receivedSummaryAckOrNack;case 22:if(!(y=r.sent).success){r.next=25;break}return r.abrupt("return");case 25:(void 0===(o=y.retryAfterSeconds)||u>1)&&(l++,u=0),c=y;case 28:r.next=4;break;case 30:t.logger.sendErrorEvent({eventName:"FailToSummarize",reason:e,message:null===c||void 0===c?void 0:c.message},null===c||void 0===c?void 0:c.error),t.stopSummarizerCallback("failToSummarize");case 32:case"end":return r.stop()}}),r)})))).catch((function(e){t.logger.sendErrorEvent({eventName:"UnexpectedSummarizeError"},e)})):this.tryWhileSummarizing=!0}},{key:"summarizeOnDemand",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new le,t=arguments.length>1?arguments[1]:void 0,n=t.reason,r=he(t,["reason"]);if(this.stopping)return e.fail("RunningSummarizer stopped or disposed",void 0),e.build();if(void 0!==this.summarizingLock)throw new O.Oi("Attempted to run an already-running summarizer on demand");return this.trySummarizeOnce({reason:"onDemand/".concat(n)},r,this.cancellationToken,e)}},{key:"enqueueSummarize",value:function(e){var t=e.reason,n=e.afterSequenceNumber,r=void 0===n?0:n,i=e.override,o=void 0!==i&&i,a=he(e,["reason","afterSequenceNumber","override"]),s="enqueue;".concat(t),u=!1;if(void 0!==this.enqueuedSummary){if(!o)return{alreadyEnqueued:!0};this.enqueuedSummary.resultsBuilder.fail("Aborted; overridden by another enqueue summarize attempt",void 0),this.enqueuedSummary=void 0,u=!0}this.enqueuedSummary={reason:s,afterSequenceNumber:r,options:a,resultsBuilder:new le};var c=this.enqueuedSummary.resultsBuilder.build();return this.tryRunEnqueuedSummary(),u?Object.assign(Object.assign({},c),{alreadyEnqueued:!0,overridden:!0}):c}},{key:"tryRunEnqueuedSummary",value:function(){if(this.stopping)return this.disposeEnqueuedSummary(),!1;if(void 0===this.enqueuedSummary||this.heuristicData.lastOpSequenceNumber<this.enqueuedSummary.afterSequenceNumber||void 0!==this.summarizingLock)return!1;var e=this.enqueuedSummary,t=e.reason,n=e.resultsBuilder,r=e.options;return this.enqueuedSummary=void 0,this.trySummarizeOnce({reason:"enqueuedSummary/".concat(t)},r,this.cancellationToken,n),!0}},{key:"disposeEnqueuedSummary",value:function(){void 0!==this.enqueuedSummary&&(this.enqueuedSummary.resultsBuilder.fail("RunningSummarizer stopped or disposed",void 0),this.enqueuedSummary=void 0)}}],[{key:"start",value:function(){var t=(0,s.Z)((0,a.Z)().mark((function t(n,r,i,o,s,u,c,l,d){var h,f;return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return f=new e(n,r,i,o,s,u,c,l,d),t.next=3,f.waitStart();case 3:return null===(h=f.heuristicRunner)||void 0===h||h.run(),t.abrupt("return",f);case 5:case"end":return t.stop()}}),t)})));return function(e,n,r,i,o,a,s,u,c){return t.apply(this,arguments)}}()}]),e}(),pe=function(e){(0,c.Z)(n,e);var t=(0,l.Z)(n);function n(e){var r,i=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return(0,h.Z)(this,n),(r=t.call(this,e)).logged=i,r.errorType="summarizingError",r.canRetry=!0,r}return(0,f.Z)(n,null,[{key:"wrap",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=arguments.length>2?arguments[2]:void 0;return(0,W.bO)(e,(function(e){return new n(e,t)}),r)}}]),n}(W.j4),ve=function(e,t){return new pe(e,t)},ge=function(e){(0,c.Z)(n,e);var t=(0,l.Z)(n);function n(e,r,i,o,c,l,d){var f;return(0,h.Z)(this,n),(f=t.call(this)).runtime=r,f.configurationGetter=i,f.internalsProvider=o,f.summaryCollection=l,f.runCoordinatorCreateFn=d,f._disposed=!1,f.starting=!1,f.stopDeferred=new V,f.summarizeOnDemand=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var r;try{if(f._disposed||(null===(r=f.runningSummarizer)||void 0===r?void 0:r.disposed))throw new O.Oi("Summarizer is already disposed.");if(void 0!==f.runtime.summarizerClientId&&f.runtime.summarizerClientId!==f.runtime.clientId)throw new O.Oi("On-demand summary attempted while an elected summarizer is present");var i,o=new le;return f.runningSummarizer?(i=f.runningSummarizer).summarizeOnDemand.apply(i,[o].concat(t)):(f.runCoordinatorCreateFn(f.runtime).then((function(e){f.start(f.runtime.clientId,e).then(function(){var n=(0,s.Z)((0,a.Z)().mark((function n(r){var i;return(0,a.Z)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return r.summarizeOnDemand.apply(r,[o].concat(t)),n.next=3,Promise.race([f.stopDeferred.promise,e.waitCancelled]);case 3:return i=n.sent,n.next=6,r.waitStop(!1);case 6:e.stop(i),f.close();case 8:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}()).catch((function(e){o.fail("Failed to start summarizer",e)}))})).catch((function(e){o.fail("Failed to create cancellation token",e)})),o.build())}catch(u){throw pe.wrap(u,!1,f.logger)}},f.enqueueSummarize=function(){var e;if(f._disposed||void 0===f.runningSummarizer||f.runningSummarizer.disposed)throw new O.Oi("Summarizer is not running or already disposed.");return(e=f.runningSummarizer).enqueueSummarize.apply(e,arguments)},f.logger=I.G2.create(f.runtime.logger,"Summarizer"),f.innerHandle=new $((0,u.Z)(f),e,c),f}return(0,f.Z)(n,[{key:"IFluidLoadable",get:function(){return this}},{key:"ISummarizer",get:function(){return this}},{key:"handle",get:function(){return this.innerHandle}},{key:"run",value:function(){var e=(0,s.Z)((0,a.Z)().mark((function e(t){return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.runCore(t);case 3:return e.abrupt("return",e.sent);case 6:throw e.prev=6,e.t0=e.catch(0),this.stop("summarizerException"),pe.wrap(e.t0,!1,this.logger);case 10:return e.prev=10,this.close(),e.finish(10);case 13:case"end":return e.stop()}}),e,this,[[0,6,10,13]])})));return function(t){return e.apply(this,arguments)}}()},{key:"stop",value:function(e){this.stopDeferred.resolve(e)}},{key:"close",value:function(){this.dispose(),this.runtime.closeFn()}},{key:"runCore",value:function(){var e=(0,s.Z)((0,a.Z)().mark((function e(t){var r,i,o,s,u=this;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.runCoordinatorCreateFn(this.runtime);case 2:if(r=e.sent,(i=Promise.race([r.waitCancelled,this.stopDeferred.promise])).then((function(e){u.logger.sendTelemetryEvent({eventName:"StoppingSummarizer",onBehalfOf:t,reason:e})})),!r.cancelled){e.next=7;break}return e.abrupt("return",r.waitCancelled);case 7:return e.next=9,this.start(t,r);case 9:return o=e.sent,e.next=12,i;case 12:return s=e.sent,e.next=15,o.waitStop(!r.cancelled&&n.stopReasonCanRunLastSummary(s));case 15:return r.stop(s),e.abrupt("return",s);case 17:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"start",value:function(){var e=(0,s.Z)((0,a.Z)().mark((function e(t,n){var r,i,o=this;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.runningSummarizer){e.next=4;break}if(!this.runningSummarizer.disposed){e.next=3;break}throw new O.Oi("Starting a disposed summarizer");case 3:return e.abrupt("return",this.runningSummarizer);case 4:if(!this.starting){e.next=6;break}throw new O.Oi("Attempting to start a summarizer that is already starting");case 6:if(this.starting=!0,this.logger.sendTelemetryEvent({eventName:"RunningSummarizer",onBehalfOf:t,initSummarySeqNumber:this.runtime.deltaManager.initialSequenceNumber,config:JSON.stringify(this.configurationGetter())}),void 0!==(r=this.runtime.clientId)){e.next=11;break}throw new O.Oi("clientId should be defined if connected.");case 11:return e.next=13,fe.start(this.logger,this.summaryCollection.createWatcher(r),this.configurationGetter(),(0,s.Z)((0,a.Z)().mark((function e(){var t,n=arguments;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(t=o.internalsProvider).submitSummary.apply(t,n));case 1:case"end":return e.stop()}}),e)}))),new re(this.runtime.deltaManager.lastSequenceNumber,{refSequenceNumber:this.runtime.deltaManager.initialSequenceNumber,summaryTime:Date.now()}),(function(e){o._disposed||o.logger.sendErrorEvent({eventName:"summarizingError"},ve(e,!0))}),this.summaryCollection,n,(function(e){return n.stop(e)}));case 13:return i=e.sent,this.runningSummarizer=i,this.starting=!1,this.handleSummaryAcks().catch((function(e){o.logger.sendErrorEvent({eventName:"HandleSummaryAckFatalError"},e)})),this.systemOpListener=function(e){return i.handleSystemOp(e)},this.runtime.deltaManager.inbound.on("op",this.systemOpListener),this.opListener=function(e,t){return i.handleOp(e,t)},this.runtime.on("batchEnd",this.opListener),e.abrupt("return",i);case 22:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"dispose",value:function(){this.stop("summarizerClientDisconnected"),this._disposed=!0,this.runningSummarizer&&(this.runningSummarizer.dispose(),this.runningSummarizer=void 0),this.systemOpListener&&this.runtime.deltaManager.inbound.off("op",this.systemOpListener),this.opListener&&this.runtime.removeListener("batchEnd",this.opListener)}},{key:"handleSummaryAcks",value:function(){var e=(0,s.Z)((0,a.Z)().mark((function e(){var t,n,r,i,o,u,c,l,d=this;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:u=this.runtime.deltaManager.initialSequenceNumber,l=(0,a.Z)().mark((function e(){var l,h,f;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return l=null!==(t=d.runningSummarizer.tryGetCorrelatedLogger(u))&&void 0!==t?t:d.logger,e.prev=1,c=void 0,e.next=5,d.summaryCollection.waitSummaryAck(u);case 5:return c=e.sent,u=c.summaryOp.referenceSequenceNumber,h=c.summaryOp.contents.handle,f=c.summaryAck.contents.handle,e.next=11,d.runningSummarizer.lockedRefreshSummaryAckAction((0,s.Z)((0,a.Z)().mark((function e(){return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",d.internalsProvider.refreshLatestSummaryAck(h,f,u,l).catch(function(){var e=(0,s.Z)((0,a.Z)().mark((function e(t){return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(0,J.IR)(t)||t.errorType!==K.C.fileNotFoundOrAccessDeniedError){e.next=4;break}l.sendTelemetryEvent({eventName:"HandleSummaryAckErrorIgnored",referenceSequenceNumber:u,proposalHandle:h,ackHandle:f},t),e.next=5;break;case 4:throw t;case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 1:case"end":return e.stop()}}),e)}))));case 11:e.next=16;break;case 13:e.prev=13,e.t0=e.catch(1),l.sendErrorEvent({eventName:"HandleSummaryAckError",referenceSequenceNumber:u,handle:null===(r=null===(n=null===c||void 0===c?void 0:c.summaryOp)||void 0===n?void 0:n.contents)||void 0===r?void 0:r.handle,ackHandle:null===(o=null===(i=null===c||void 0===c?void 0:c.summaryAck)||void 0===i?void 0:i.contents)||void 0===o?void 0:o.handle},e.t0);case 16:u++;case 17:case"end":return e.stop()}}),e,null,[[1,13]])}));case 2:if(!this.runningSummarizer){e.next=6;break}return e.delegateYield(l(),"t0",4);case 4:e.next=2;break;case 6:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}],[{key:"create",value:function(){var e=(0,s.Z)((0,a.Z)().mark((function e(t,n){var r,o,s,u;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o={headers:(r={},(0,i.Z)(r,v.A.cache,!1),(0,i.Z)(r,v.A.clientDetails,{capabilities:{interactive:!1},type:Q}),(0,i.Z)(r,_.i.summarizingClient,!0),(0,i.Z)(r,v.A.reconnect,!1),r),url:n},e.next=3,t.resolve(o);case 3:return s=e.sent,e.next=6,(0,D.bb)(s,{url:"_summarizer"});case 6:if(void 0!==(u=e.sent).ISummarizer){e.next=9;break}throw new O.Oi("Fluid object does not implement ISummarizer");case 9:return e.abrupt("return",u.ISummarizer);case 10:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"stopReasonCanRunLastSummary",value:function(e){return"parentNotConnected"===e}}]),n}(E.EventEmitter);!function(e){e[e.Off=0]="Off",e[e.Starting=1]="Starting",e[e.Running=2]="Running",e[e.Stopping=3]="Stopping"}(ue||(ue={}));var me=function(){function e(t,n,r,i,o,a){var s=this,u=arguments.length>6&&void 0!==arguments[6]?arguments[6]:{},c=u.initialDelayMs,l=void 0===c?5e3:c,d=u.opsToBypassInitialDelay,f=void 0===d?4e3:d,p=arguments.length>7?arguments[7]:void 0;(0,h.Z)(this,e),this.clientElection=t,this.connectedState=n,this.summaryCollection=r,this.requestSummarizerFn=o,this.startThrottler=a,this.disableHeuristics=p,this.state=ue.Off,this._disposed=!1,this.handleConnected=function(e){s.latestClientId=e,s.refreshSummarizer()},this.handleDisconnected=function(){s.refreshSummarizer()},this.refreshSummarizer=function(){var e=s.getShouldSummarizeState();switch(s.state){case ue.Off:return void(e.shouldSummarize&&s.startSummarization());case ue.Starting:return;case ue.Running:return void(!1===e.shouldSummarize&&s.stop(e.stopReason));case ue.Stopping:default:return}},this.summarizeOnDemand=function(){var e;if(void 0===s.summarizer)throw Error("No running summarizer client");return(e=s.summarizer).summarizeOnDemand.apply(e,arguments)},this.enqueueSummarize=function(){var e;if(void 0===s.summarizer)throw Error("No running summarizer client");return(e=s.summarizer).enqueueSummarize.apply(e,arguments)},this.logger=I.G2.create(i,"SummaryManager",{all:{clientId:function(){return s.latestClientId}}}),this.connectedState.on("connected",this.handleConnected),this.connectedState.on("disconnected",this.handleDisconnected),this.latestClientId=this.connectedState.clientId,this.opsToBypassInitialDelay=f,this.initialDelayMs=l}return(0,f.Z)(e,[{key:"disposed",get:function(){return this._disposed}},{key:"currentState",get:function(){return this.state}},{key:"start",value:function(){this.clientElection.on("electedSummarizerChanged",this.refreshSummarizer),this.refreshSummarizer()}},{key:"getShouldSummarizeState",value:function(){return this.connectedState.clientId!==this.clientElection.electedParentId||this.state!==ue.Running&&this.connectedState.clientId!==this.clientElection.electedClientId?{shouldSummarize:!1,stopReason:"parentShouldNotSummarize"}:this.connectedState.connected?this.disposed?void g(!1,608):{shouldSummarize:!0}:{shouldSummarize:!1,stopReason:"parentNotConnected"}}},{key:"startSummarization",value:function(){var e=this;g(this.state===ue.Off,609),this.state=ue.Starting,g(void 0===this.summarizer,610),this.delayBeforeCreatingSummarizer().then(function(){var t=(0,s.Z)((0,a.Z)().mark((function t(n){var r,i,o;return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!n||!1!==e.getShouldSummarizeState().shouldSummarize){t.next=2;break}return t.abrupt("return","early exit");case 2:return g(e.state===ue.Starting,611),e.state=ue.Running,t.next=6,e.requestSummarizerFn();case 6:if(r=t.sent,e.summarizer=r,!1!==(i=e.getShouldSummarizeState()).shouldSummarize){t.next=13;break}return e.state=ue.Starting,r.stop(i.stopReason),t.abrupt("return","early exit after starting summarizer");case 13:return o=e.latestClientId,t.abrupt("return",I.Xr.timedExecAsync(e.logger,{eventName:"RunningSummarizer",attempt:e.startThrottler.numAttempts},(0,s.Z)((0,a.Z)().mark((function t(){return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",r.run(o,e.disableHeuristics));case 1:case"end":return t.stop()}}),t)})))));case 15:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()).then((function(t){e.logger.sendTelemetryEvent({eventName:"EndingSummarizer",reason:t})})).catch((function(t){if(e.logger.sendTelemetryEvent({eventName:"EndingSummarizer",reason:"exception"},t),e.getShouldSummarizeState().shouldSummarize||void 0!==e.summarizer){var n=(null===t||void 0===t?void 0:t.errorType)===K.C.offlineError?"generic":"error";e.logger.sendTelemetryEvent({eventName:"SummarizerException",category:n},t)}})).finally((function(){var t;g(e.state!==ue.Off,612),e.state=ue.Off,null===(t=e.summarizer)||void 0===t||t.close(),e.summarizer=void 0,e.getShouldSummarizeState().shouldSummarize&&e.startSummarization()}))}},{key:"stop",value:function(t){var n;e.isStartingOrRunning(this.state)&&(this.state=ue.Stopping,null===(n=this.summarizer)||void 0===n||n.stop(t))}},{key:"delayBeforeCreatingSummarizer",value:function(){var e=(0,s.Z)((0,a.Z)().mark((function e(){var t,n,r,i,o,s,u,c=this;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this.startThrottler.getDelay(),this.logger.sendTelemetryEvent({eventName:"CreatingSummarizer",throttlerDelay:t,initialDelay:this.initialDelayMs,startThrottlerMaxDelayMs:this.startThrottler.maxDelayMs,opsSinceLastAck:this.summaryCollection.opsSinceLastAck,opsToBypassInitialDelay:this.opsToBypassInitialDelay}),n=!1,this.summaryCollection.opsSinceLastAck<this.opsToBypassInitialDelay&&(n=!0,t=Math.max(t,this.initialDelayMs)),!(t>0)){e.next=12;break}return o=function(){c.summaryCollection.opsSinceLastAck>=c.opsToBypassInitialDelay&&(clearTimeout(r),i())},s=new Promise((function(e){r=setTimeout((function(){return e()}),t)})),u=new Promise((function(e){i=e})),this.summaryCollection.addOpListener(o),e.next=11,Promise.race([s,u]);case 11:this.summaryCollection.removeOpListener(o);case 12:return e.abrupt("return",n);case 13:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"dispose",value:function(){this.clientElection.off("electedSummarizerChanged",this.refreshSummarizer),this.connectedState.off("connected",this.handleConnected),this.connectedState.off("disconnected",this.handleDisconnected),this._disposed=!0}}]),e}();me.isStartingOrRunning=function(e){return e===ue.Starting||e===ue.Running};var ye=function(){function e(t,n){var r=this;(0,h.Z)(this,e),this.logger=n,this.processingTimeIncrement=10,this.currentAllowedProcessingTimeForTurn=e.processingTime,this.schedulingCount=0,this.deltaManager=t,this.deltaManager.inbound.on("idle",(function(){r.inboundQueueIdle()}))}return(0,f.Z)(e,[{key:"batchBegin",value:function(e){this.processingStartTime||(this.processingStartTime=m.now()),void 0===this.schedulingLog&&this.schedulingCount%500===0&&(this.schedulingLog={opsRemainingToProcess:0,numberOfTurns:1,totalProcessingTime:0,numberOfBatchesProcessed:0,firstSequenceNumber:e.sequenceNumber,lastSequenceNumber:e.sequenceNumber,startTime:m.now()})}},{key:"batchEnd",value:function(e){var t=this;if(this.schedulingLog&&(this.schedulingLog.numberOfBatchesProcessed++,this.schedulingLog.lastSequenceNumber=e.sequenceNumber,this.schedulingLog.opsRemainingToProcess=this.deltaManager.inbound.length),this.shouldRunScheduler()){var n=m.now(),r=n-this.processingStartTime;r>this.currentAllowedProcessingTimeForTurn&&(this.deltaManager.inbound.pause(),this.currentAllowedProcessingTimeForTurn+=this.processingTimeIncrement,this.schedulingLog&&(this.schedulingLog.numberOfTurns++,this.schedulingLog.totalProcessingTime+=r),setTimeout((function(){t.schedulingLog&&t.logger.sendTelemetryEvent({eventName:"InboundOpsPartialProcessingTime",duration:I.hy.formatTick(r),opsProcessed:t.schedulingLog.lastSequenceNumber-t.schedulingLog.firstSequenceNumber+1,opsRemainingToProcess:t.deltaManager.inbound.length,processingTime:I.hy.formatTick(t.schedulingLog.totalProcessingTime),numberOfTurns:t.schedulingLog.numberOfTurns,batchesProcessed:t.schedulingLog.numberOfBatchesProcessed,timeToResume:I.hy.formatTick(m.now()-n)}),t.deltaManager.inbound.resume()})),this.processingStartTime=void 0)}}},{key:"inboundQueueIdle",value:function(){if(this.schedulingLog){var t=m.now();this.schedulingLog.totalProcessingTime+=t-this.processingStartTime,this.logger.sendTelemetryEvent({eventName:"InboundOpsProcessingTime",opsRemainingToProcess:this.schedulingLog.opsRemainingToProcess,numberOfTurns:this.schedulingLog.numberOfTurns,processingTime:I.hy.formatTick(this.schedulingLog.totalProcessingTime),opsProcessed:this.schedulingLog.lastSequenceNumber-this.schedulingLog.firstSequenceNumber+1,batchesProcessed:this.schedulingLog.numberOfBatchesProcessed,duration:I.hy.formatTick(t-this.schedulingLog.startTime),schedulingCount:this.schedulingCount}),this.schedulingLog=void 0}this.schedulingCount++,this.processingStartTime=void 0,this.currentAllowedProcessingTimeForTurn=e.processingTime}},{key:"shouldRunScheduler",value:function(){return this.deltaManager.inbound.length>0}}]),e}();ye.processingTime=50;var be=function(){function e(t,n,r){var i=this;(0,h.Z)(this,e),this.clientId=t,this.deltaManager=n,this.pongCount=0,this.msnTrackingTimestamp=0,this.opProcessingTimes={},this.opPerfData={},this.firstConnection=!0,this.bootTime=m.now(),this.connectionStartTime=0,this.gap=0,this.logger=I.G2.create(r,"OpPerf"),this.deltaManager.on("pong",(function(e){return i.recordPingTime(e)})),this.deltaManager.on("submitOp",(function(e){return i.beforeOpSubmit(e)})),this.deltaManager.on("op",(function(e){return i.afterProcessingOp(e)})),this.deltaManager.on("connect",(function(e,t){i.clientId=e.clientId,void 0!==t&&(i.connectionOpSeqNumber=i.deltaManager.lastKnownSeqNumber,i.gap=t,i.connectionStartTime=m.now(),i.gap<=0&&i.reportGettingUpToDate())})),this.deltaManager.on("disconnect",(function(){i.sequenceNumberForMsnTracking=void 0,i.clientSequenceNumberForLatencyStatistics=void 0,i.opProcessingTimes={},i.opPerfData={},i.connectionOpSeqNumber=void 0,i.firstConnection=!1,i.pongCount=0})),this.deltaManager.outbound.on("push",(function(e){var t,n=(0,d.Z)(e);try{for(n.s();!(t=n.n()).done;){var r=t.value;r.type===b.Operation&&i.clientSequenceNumberForLatencyStatistics===r.clientSequenceNumber&&(g(void 0===i.opProcessingTimes.outboundPushEventTime,712),g(void 0===i.opPerfData.durationNetwork,713),i.opProcessingTimes.outboundPushEventTime=Date.now(),g(void 0===i.opPerfData.durationOutboundBatching,714),g(void 0!==i.opProcessingTimes.submitOpEventTime,715),i.opPerfData.durationOutboundBatching=i.opProcessingTimes.outboundPushEventTime-i.opProcessingTimes.submitOpEventTime)}}catch(o){n.e(o)}finally{n.f()}})),this.deltaManager.inbound.on("push",(function(e){i.clientId===e.clientId&&e.type===b.Operation&&i.clientSequenceNumberForLatencyStatistics===e.clientSequenceNumber&&void 0!==i.opProcessingTimes.outboundPushEventTime&&(i.opProcessingTimes.inboundPushEventTime=Date.now(),i.opPerfData.durationNetwork=i.opProcessingTimes.inboundPushEventTime-i.opProcessingTimes.outboundPushEventTime,i.opProcessingTimes.outboundPushEventTime=void 0,i.opPerfData.lengthInboundQueue=i.deltaManager.inbound.length)})),this.deltaManager.inbound.on("idle",(function(e,t){"number"===typeof e&&e>=100&&i.logger.sendPerformanceEvent({eventName:"GetDeltas_OpProcessing",count:e,duration:t})}))}return(0,f.Z)(e,[{key:"reportGettingUpToDate",value:function(){this.connectionOpSeqNumber=void 0,this.logger.sendPerformanceEvent({eventName:"ConnectionSpeed",duration:m.now()-this.connectionStartTime,ops:this.gap,timeToConnect:this.firstConnection?I.hy.formatTick(this.connectionStartTime-this.bootTime):void 0,firstConnection:this.firstConnection})}},{key:"recordPingTime",value:function(e){this.pingLatency=e,this.pongCount%100===0&&this.deltaManager.active&&this.logger.sendPerformanceEvent({eventName:"DeltaLatency",duration:e}),this.pongCount++}},{key:"beforeOpSubmit",value:function(e){void 0===this.clientSequenceNumberForLatencyStatistics&&e.clientSequenceNumber%500===1&&(g(void 0===this.opProcessingTimes.outboundPushEventTime,716),g(void 0===this.opPerfData.durationNetwork,717),this.opProcessingTimes.submitOpEventTime=Date.now(),this.clientSequenceNumberForLatencyStatistics=e.clientSequenceNumber)}},{key:"afterProcessingOp",value:function(e){var t=e.sequenceNumber;if(t===this.connectionOpSeqNumber&&this.reportGettingUpToDate(),void 0===this.sequenceNumberForMsnTracking&&t%1e3===0&&(this.sequenceNumberForMsnTracking=t,this.msnTrackingTimestamp=e.timestamp),void 0!==this.sequenceNumberForMsnTracking&&e.minimumSequenceNumber>=this.sequenceNumberForMsnTracking&&(g(void 0!==this.msnTrackingTimestamp,718),this.logger.sendPerformanceEvent({eventName:"MsnStatistics",sequenceNumber:t,msnDistance:t-this.sequenceNumberForMsnTracking,duration:e.timestamp-this.msnTrackingTimestamp}),this.sequenceNumberForMsnTracking=void 0),this.clientId===e.clientId&&this.clientSequenceNumberForLatencyStatistics===e.clientSequenceNumber){g(void 0!==this.opProcessingTimes.submitOpEventTime,288);var n=Date.now();void 0!==this.opProcessingTimes.inboundPushEventTime&&(this.opPerfData.durationInboundToProcessing=n-this.opProcessingTimes.inboundPushEventTime);var r=n-this.opProcessingTimes.submitOpEventTime,i=r>5e3?"error":"performance";this.logger.sendPerformanceEvent(Object.assign({eventName:"OpRoundtripTime",sequenceNumber:t,referenceSequenceNumber:e.referenceSequenceNumber,duration:r,category:i,pingLatency:this.pingLatency,msnDistance:this.deltaManager.lastSequenceNumber-this.deltaManager.minimumSequenceNumber},this.opPerfData)),this.clientSequenceNumberForLatencyStatistics=void 0,this.opPerfData={}}}}]),e}();var we=function(){function e(t){(0,h.Z)(this,e),this.valueGenerator=t,this._evaluated=!1}return(0,f.Z)(e,[{key:"evaluated",get:function(){return this._evaluated}},{key:"value",get:function(){return this._evaluated||(this._evaluated=!0,this._value=this.valueGenerator()),this._value}}]),e}(),Se=n(63133),ke=n.n(Se),Ce=function(){function e(t,n,r){var i,o=this;(0,h.Z)(this,e),this.stateHandler=t,this.pendingStates=new(ke()),this.disposeOnce=new we((function(){o.initialStates.clear(),o.pendingStates.clear()})),this._pendingMessagesCount=0,this.isProcessingBatch=!1,this.dispose=function(){return o.disposeOnce.value},this.initialStates=new(ke())(null!==(i=null===r||void 0===r?void 0:r.pendingStates)&&void 0!==i?i:[]),this.flushModeForNextMessage=n,this.onFlushModeUpdated(n)}return(0,f.Z)(e,[{key:"pendingMessagesCount",get:function(){return this._pendingMessagesCount}},{key:"hasPendingMessages",value:function(){return 0!==this._pendingMessagesCount||!this.initialStates.isEmpty()}},{key:"getLocalState",value:function(){if(g(this.initialStates.isEmpty(),745),this.hasPendingMessages())return{pendingStates:this.pendingStates.toArray().map((function(e){return"message"===e.type?Object.assign(Object.assign({},e),{localOpMetadata:void 0}):e}))}}},{key:"disposed",get:function(){return this.disposeOnce.evaluated}},{key:"onSubmitMessage",value:function(e,t,n,r,i,o){var a={type:"message",messageType:e,clientSequenceNumber:t,referenceSequenceNumber:n,content:r,localOpMetadata:i,opMetadata:o};this.pendingStates.push(a),this._pendingMessagesCount++}},{key:"onFlushModeUpdated",value:function(e){this.pendingStates.push({type:"flushMode",flushMode:e})}},{key:"onFlush",value:function(){if(this.stateHandler.flushMode()!==M.FlushMode.Immediate){var e=this.pendingStates.peekBack();"message"===(null===e||void 0===e?void 0:e.type)&&this.pendingStates.push({type:"flush"})}}},{key:"applyStashedOpsAt",value:function(){var e=(0,s.Z)((0,a.Z)().mark((function e(t){var n,r;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.initialStates.isEmpty()){e.next=17;break}if("message"!==(n=this.initialStates.peekFront()).type){e.next=14;break}if(void 0===t){e.next=10;break}if(!(n.referenceSequenceNumber>t)){e.next=8;break}return e.abrupt("break",17);case 8:if(!(n.referenceSequenceNumber<t)){e.next=10;break}throw new Error("loaded from snapshot too recent to apply stashed ops");case 10:return e.next=12,this.stateHandler.applyStashedOp(n.messageType,n.content);case 12:r=e.sent,n.localOpMetadata=r;case 14:this.pendingStates.push(this.initialStates.shift()),e.next=0;break;case 17:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"processPendingLocalMessage",value:function(e){this.maybeProcessBatchBegin(e);var t=this.peekNextPendingState();if(g("message"===t.type,361),this.pendingStates.shift(),t.clientSequenceNumber===e.clientSequenceNumber)return this._pendingMessagesCount--,this.maybeProcessBatchEnd(e),t.localOpMetadata;var n=O.Hi.create("pending local message clientSequenceNumber mismatch","unexpectedAckReceived",e,{expectedClientSequenceNumber:t.clientSequenceNumber});this.stateHandler.close(n)}},{key:"maybeProcessBatchBegin",value:function(e){for(var t,n=!1,r=this.peekNextPendingState();"message"!==r.type;)"flushMode"===r.type&&(t=r.flushMode),"flush"===r.type&&(n=!0),this.pendingStates.shift(),r=this.peekNextPendingState();void 0!==t&&(this.flushModeForNextMessage=t),t!==M.FlushMode.Immediate&&(t===M.FlushMode.TurnBased||n)&&(g(!this.isProcessingBatch&&void 0===this.pendingBatchBeginMessage,363),this.pendingBatchBeginMessage=e,this.isProcessingBatch=!0)}},{key:"maybeProcessBatchEnd",value:function(e){var t,n;if(this.isProcessingBatch){var r=this.peekNextPendingState();if("message"!==r.type){g("flushMode"!==r.type,701),g(void 0!==this.pendingBatchBeginMessage,365);var i=null===(t=this.pendingBatchBeginMessage.metadata)||void 0===t?void 0:t.batch;if(this.pendingBatchBeginMessage===e)g(void 0===i,366);else{var o=null===(n=e.metadata)||void 0===n?void 0:n.batch;g(!0===i,367),g(!1===o,368)}this.pendingBatchBeginMessage=void 0,this.isProcessingBatch=!1}}}},{key:"checkpoint",value:function(){var e=this,t=this.pendingStates.peekBack();return{rollback:function(){try{for(;e.pendingStates.peekBack()!==t;)e.rollbackNextPendingState()}catch(r){var n=(0,W.Jn)(r,(function(e){return O.Hi.create("RollbackError: ".concat(e),"checkpointRollback",void 0)}));throw e.stateHandler.close(n),n}}}}},{key:"peekNextPendingState",value:function(){var e=this.pendingStates.peekFront();return g(!!e,369),e}},{key:"rollbackNextPendingState",value:function(){if(0!==this.pendingStates.length){this._pendingMessagesCount--;var e=this.pendingStates.pop();if("message"!==e.type)throw new Error("Can't rollback state ".concat(e.type));this.stateHandler.rollback(e.messageType,e.content,e.localOpMetadata)}}},{key:"replayPendingStates",value:function(){g(this.stateHandler.connected(),370),g(this.clientId!==this.stateHandler.clientId(),371),this.clientId=this.stateHandler.clientId(),g(this.initialStates.isEmpty(),372);var e=this.pendingStates.length;if(0!==e){this._pendingMessagesCount=0;var t=this.stateHandler.flushMode();for(this.stateHandler.setFlushMode(this.flushModeForNextMessage);e>0;){var n=this.pendingStates.shift();switch(n.type){case"message":this.stateHandler.reSubmit(n.messageType,n.content,n.localOpMetadata,n.opMetadata);break;case"flushMode":this.stateHandler.setFlushMode(n.flushMode);break;case"flush":this.stateHandler.flush()}e--}this.stateHandler.setFlushMode(t)}}}]),e}(),xe="1.3.6",Ee=function(){function e(t,n,r){(0,h.Z)(this,e),this.path=t,this.routeContext=n,this.get=r,this.attached=!1,this.absolutePath=(0,U.H)(t,this.routeContext)}return(0,f.Z)(e,[{key:"IFluidHandle",get:function(){return this}},{key:"isAttached",get:function(){return this.attached}},{key:"attachGraph",value:function(){this.attached=!0}},{key:"bind",value:function(e){throw new Error("Cannot bind to blob handle")}}]),e}(),Te=function(){function e(t,n,r,i,o,a,s){var u=this;(0,h.Z)(this,e),this.routeContext=t,this.getStorage=r,this.attachBlobCallback=i,this.gcNodeUpdated=o,this.runtime=a,this.logger=s,this.blobIds=new Set,this.pendingBlobIds=new Map,this.detachedBlobIds=new Set,this.runtime.once("dispose",(function(){var e,t=(0,d.Z)(u.pendingBlobIds.values());try{for(t.s();!(e=t.n()).done;){e.value.reject(new Error("runtime disposed while blobAttach op in flight"))}}catch(n){t.e(n)}finally{t.f()}})),this.load(n)}return(0,f.Z)(e,[{key:"hasBlob",value:function(e){return this.blobIds.has(e)||this.detachedBlobIds.has(e)}},{key:"getBlobGCNodePath",value:function(t){return"/".concat(e.basePath,"/").concat(t)}},{key:"getBlob",value:function(){var t=(0,s.Z)((0,a.Z)().mark((function t(n){var r,i,o,u=this;return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return o=null!==(i=null===(r=this.redirectTable)||void 0===r?void 0:r.get(n))&&void 0!==i?i:n,g(this.hasBlob(o),287),this.gcNodeUpdated(this.getBlobGCNodePath(n)),t.abrupt("return",new Ee("".concat(e.basePath,"/").concat(o),this.routeContext,(0,s.Z)((0,a.Z)().mark((function e(){return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",I.Xr.timedExecAsync(u.logger,{eventName:"AttachmentReadBlob",id:o},(0,s.Z)((0,a.Z)().mark((function e(){return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",u.getStorage().readBlob(o));case 1:case"end":return e.stop()}}),e)}))),{end:!0,cancel:"error"}));case 1:case"end":return e.stop()}}),e)})))));case 4:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()},{key:"createBlob",value:function(){var t=(0,s.Z)((0,a.Z)().mark((function t(n){var r,i,o,u,c=this;return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.runtime.attachState!==p.mB.Attaching){t.next=4;break}return this.logger.sendTelemetryEvent({eventName:"CreateBlobWhileAttaching"}),t.next=4,new Promise((function(e){return c.runtime.once("attached",e)}));case 4:if(this.runtime.connected||this.runtime.attachState!==p.mB.Attached){t.next=7;break}return t.next=7,new Promise((function(e){return c.runtime.once("connected",e)}));case 7:return t.next=9,I.Xr.timedExecAsync(this.logger,{eventName:"createBlob"},(0,s.Z)((0,a.Z)().mark((function e(){return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",c.getStorage().createBlob(n));case 1:case"end":return e.stop()}}),e)}))),{end:!0,cancel:"error"});case 9:if(o=t.sent,u=new Ee("".concat(e.basePath,"/").concat(o.id),this.routeContext,(0,s.Z)((0,a.Z)().mark((function e(){return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",c.getBlob(o.id).then(function(){var e=(0,s.Z)((0,a.Z)().mark((function e(t){return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",t.get());case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 1:case"end":return e.stop()}}),e)})))),this.runtime.attachState!==p.mB.Detached){t.next=14;break}return this.detachedBlobIds.add(o.id),t.abrupt("return",u);case 14:if(!this.pendingBlobIds.has(o.id)){t.next=19;break}return t.next=17,null===(r=this.pendingBlobIds.get(o.id))||void 0===r?void 0:r.promise;case 17:t.next=24;break;case 19:if(this.blobIds.has(o.id)){t.next=24;break}return this.pendingBlobIds.set(o.id,new V),this.attachBlobCallback(o.id),t.next=24,null===(i=this.pendingBlobIds.get(o.id))||void 0===i?void 0:i.promise;case 24:return t.abrupt("return",u);case 25:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()},{key:"processBlobAttachOp",value:function(e,t){if(t){var n=this.pendingBlobIds.get(e);g(void 0!==n,504),n.resolve(),this.pendingBlobIds.delete(e)}this.blobIds.add(e)}},{key:"load",value:function(e){var t,n,r,i=this;if(e.ids){var o=this.runtime.attachState===p.mB.Detached;e.ids.map((function(e){return o?i.detachedBlobIds.add(e):i.blobIds.add(e)}))}e.redirectTable&&(this.redirectTable=new Map(e.redirectTable)),this.logger.sendTelemetryEvent({eventName:"AttachmentBlobsLoaded",count:null!==(n=null===(t=e.ids)||void 0===t?void 0:t.length)&&void 0!==n?n:0,redirectTable:null===(r=e.redirectTable)||void 0===r?void 0:r.length})}},{key:"getGCData",value:function(){var e=this,t={gcNodes:{}};if(this.blobIds.forEach((function(n){t.gcNodes[e.getBlobGCNodePath(n)]=[]})),void 0!==this.redirectTable){var n,i=(0,d.Z)(this.redirectTable);try{for(i.s();!(n=i.n()).done;){var o=(0,r.Z)(n.value,2),a=o[0],s=o[1];t.gcNodes[this.getBlobGCNodePath(a)]=[this.getBlobGCNodePath(s)]}}catch(u){i.e(u)}finally{i.f()}}return t}},{key:"deleteUnusedRoutes",value:function(t){var n,r,i=(0,d.Z)(t);try{for(i.s();!(r=i.n()).done;){var o=r.value.split("/");g(3===o.length&&o[1]===e.basePath,725);var a=o[2];(null===(n=this.redirectTable)||void 0===n?void 0:n.has(a))?this.redirectTable.delete(a):this.blobIds.delete(a)}}catch(s){i.e(s)}finally{i.f()}}},{key:"summarize",value:function(t){var n=!!this.redirectTable||this.runtime.attachState!==p.mB.Detached?this.blobIds:this.detachedBlobIds,r=new L.x1;return n.forEach((function(e){r.addAttachment(e)})),this.redirectTable&&this.redirectTable.size>0&&r.addBlob(e.redirectTableBlobName,JSON.stringify(Array.from(this.redirectTable.entries()))),r.getSummaryTree()}},{key:"setRedirectTable",value:function(e){g(this.runtime.attachState===p.mB.Detached,594),g(!this.redirectTable,595);var t,n=(0,d.Z)(e);try{for(n.s();!(t=n.n()).done;){var i=(0,r.Z)(t.value,2),o=i[0],a=i[1];g(this.detachedBlobIds.delete(o),596),this.blobIds.add(a)}}catch(s){n.e(s)}finally{n.f()}g(0===this.detachedBlobIds.size,597),this.redirectTable=e}}],[{key:"load",value:function(){var e=(0,s.Z)((0,a.Z)().mark((function e(t,n){var i,o,s,u=this;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}return e.abrupt("return",{});case 2:if(!(o=t.blobs[this.redirectTableBlobName])){e.next=7;break}return e.next=6,n(o);case 6:i=e.sent;case 7:return s=Object.entries(t.blobs).filter((function(e){var t=(0,r.Z)(e,2),n=t[0];t[1];return n!==u.redirectTableBlobName})).map((function(e){var t=(0,r.Z)(e,2);t[0];return t[1]})),e.abrupt("return",{ids:s,redirectTable:i});case 9:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()}]),e}();Te.basePath="_blobs",Te.redirectTableBlobName=".redirectTable";var Ie=n(69751),Ae=function(e){(0,c.Z)(n,e);var t=(0,l.Z)(n);function n(e,r){var i;return(0,h.Z)(this,n),(i=t.call(this,e)).blobs=r,i}return(0,f.Z)(n,[{key:"policies",get:function(){return this.internalStorageService.policies}},{key:"readBlob",value:function(){var e=(0,s.Z)((0,a.Z)().mark((function e(t){var n;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0===(n=this.blobs.get(t))){e.next=3;break}return e.abrupt("return",n);case 3:return e.abrupt("return",this.internalStorageService.readBlob(t));case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),n}(n(91033).P),Re=function(e){function t(e){var n=this;(0,h.Z)(this,t),this.notBoundContexts=new Set,this._contexts=new Map,this.deferredContexts=new Map,this.disposeOnce=new we((function(){var e,t=(0,d.Z)(n.deferredContexts);try{var i=function(){var t=(0,r.Z)(e.value,2),i=t[0];t[1].promise.then((function(e){e.dispose()})).catch((function(e){n._logger.sendErrorEvent({eventName:"FluidDataStoreContextDisposeError",fluidDataStoreId:i},e)}))};for(t.s();!(e=t.n()).done;)i()}catch(o){t.e(o)}finally{t.f()}})),this.dispose=function(){return n.disposeOnce.value},this._logger=I.G2.create(e)}return(0,f.Z)(t,[{key:e,value:function(){return this._contexts.entries()}},{key:"size",get:function(){return this._contexts.size}},{key:"disposed",get:function(){return this.disposeOnce.evaluated}},{key:"notBoundLength",value:function(){return this.notBoundContexts.size}},{key:"isNotBound",value:function(e){return this.notBoundContexts.has(e)}},{key:"has",value:function(e){return this._contexts.has(e)}},{key:"get",value:function(e){return this._contexts.get(e)}},{key:"delete",value:function(e){return this.deferredContexts.delete(e),this.notBoundContexts.delete(e),this._contexts.delete(e)}},{key:"getUnbound",value:function(e){if(void 0!==this._contexts.get(e)&&this.notBoundContexts.has(e))return this._contexts.get(e)}},{key:"addUnbound",value:function(e){var t=e.id;g(!this._contexts.has(t),344),this._contexts.set(t,e),this.notBoundContexts.add(t),this.ensureDeferred(t)}},{key:"getBoundOrRemoted",value:function(){var e=(0,s.Z)((0,a.Z)().mark((function e(t,n){var r;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=this.ensureDeferred(t),n||r.isCompleted){e.next=3;break}return e.abrupt("return",void 0);case 3:return e.abrupt("return",r.promise);case 4:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"ensureDeferred",value:function(e){var t=this.deferredContexts.get(e);if(t)return t;var n=new V;return this.deferredContexts.set(e,n),n}},{key:"bind",value:function(e){g(this.notBoundContexts.delete(e),345),this.resolveDeferred(e)}},{key:"resolveDeferred",value:function(e){var t=this._contexts.get(e);g(!!t,346),g(!this.notBoundContexts.has(e),347);var n=this.deferredContexts.get(e);g(!!n,348),n.resolve(t)}},{key:"addBoundOrRemoted",value:function(e){var t=e.id;g(!this._contexts.has(t),349),this._contexts.set(t,e),this.ensureDeferred(t),this.resolveDeferred(t)}}]),t}(Symbol.iterator),_e=n(29299),Pe=n(84485);function Ne(e,t){var n,r=new Set,i=(0,o.Z)(t),a=(0,d.Z)(i);try{for(a.s();!(n=a.n()).done;){var s=n.value;if(!r.has(s)){r.add(s);var u=e[s];void 0!==u&&i.push.apply(i,(0,o.Z)(u))}}}catch(v){a.e(v)}finally{a.f()}for(var c=[],l=[],h=0,f=Object.keys(e);h<f.length;h++){var p=f[h];r.has(p)?c.push(p):l.push(p)}return{referencedNodeIds:c,deletedNodeIds:l}}var Oe=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"===typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n},Me="gc",Fe="__gc",Ze=864e5,De="DataStore",Le="SubDataStore",Be="Blob",qe="Other",je="Active",Ue="Inactive",He="SweepReady",ze=function(){function e(t,n,r,i){(0,h.Z)(this,e),this.unreferencedTimestampMs=t,this.inactiveTimeoutMs=n,this.sweepTimeoutMs=r,this._state=je,void 0!==i&&this.updateTracking(i)}return(0,f.Z)(e,[{key:"state",get:function(){return this._state}},{key:"updateTracking",value:function(e){var t=this,n=e-this.unreferencedTimestampMs;if(void 0!==this.sweepTimeoutMs&&n>=this.sweepTimeoutMs)return this._state=He,void this.clearTimers();if(n>=this.inactiveTimeoutMs)return this._state=Ue,this.clearTimers(),void(void 0!==this.sweepTimeoutMs&&Je(this.sweepTimeoutMs-n,(function(){t._state=He}),(function(e){t.sweepTimer=e})));var r=this.inactiveTimeoutMs-n;if(void 0===this.inactiveTimer){this.inactiveTimer=new ee(r,(function(){return t._state=Ue,void(void 0!==t.sweepTimeoutMs&&Je(t.sweepTimeoutMs-t.inactiveTimeoutMs,(function(){t._state=He}),(function(e){t.sweepTimer=e})))}))}this.inactiveTimer.restart(r)}},{key:"clearTimers",value:function(){var e;null===(e=this.inactiveTimer)||void 0===e||e.clear(),void 0!==this.sweepTimer&&clearTimeout(this.sweepTimer)}},{key:"stopTracking",value:function(){this.clearTimers(),this._state=je}}]),e}(),Ve=function(){function e(t){var n,i,o,u,c,l,d,f=this;(0,h.Z)(this,e),this._writeDataAtRoot=!0,this.initialStateNeedsReset=!1,this.currentGCVersion=1,this.newReferencesSinceLastRun=new Map,this.unreferencedNodesState=new Map,this.loggedUnreferencedEvents=new Set,this.pendingEventsQueue=[],this.completedRuns=0,this.runtime=t.runtime,this.isSummarizerClient=t.isSummarizerClient,this.gcOptions=t.gcOptions,this.getNodePackagePath=t.getNodePackagePath,this.getLastSummaryTimestampMs=t.getLastSummaryTimestampMs;var p,v=t.baseSnapshot,m=t.metadata,y=t.readAndParseBlob;if(this.mc=(0,A.rZ)(I.G2.create(t.baseLogger,"GarbageCollector",{all:{completedGCRuns:function(){return f.completedRuns}}})),t.existing)p=rt(m),this.gcEnabled=p>0,this.sweepEnabled=null!==(n=null===m||void 0===m?void 0:m.sweepEnabled)&&void 0!==n&&n,this.sessionExpiryTimeoutMs=null===m||void 0===m?void 0:m.sessionExpiryTimeoutMs;else{if(this.gcOptions.sweepAllowed&&!1===this.gcOptions.gcAllowed)throw new O.Oi("GC sweep phase cannot be enabled without enabling GC mark phase");this.gcEnabled=!1!==this.gcOptions.gcAllowed,this.sweepEnabled=!0===this.gcOptions.sweepAllowed,this.mc.config.getBoolean("Fluid.GarbageCollection.RunSessionExpiry")&&this.gcEnabled&&(this.sessionExpiryTimeoutMs=2592e6)}if(void 0!==this.sessionExpiryTimeoutMs&&!0!==this.mc.config.getBoolean("Fluid.GarbageCollection.DisableSessionExpiry")){var b=this.mc.config.getNumber("Fluid.GarbageCollection.TestOverride.SessionExpiryMs"),w=null!==b&&void 0!==b?b:this.sessionExpiryTimeoutMs;Je(w,(function(){f.runtime.closeFn(new O.Lf("Client session expired.",w))}),(function(e){f.sessionExpiryTimer=e})),void 0!==t.snapshotCacheExpiryMs&&(this.sweepTimeoutMs=this.sessionExpiryTimeoutMs+t.snapshotCacheExpiryMs+Ze)}if(this.latestSummaryGCVersion=null!==p&&void 0!==p?p:this.currentGCVersion,this.shouldRunGC=null!==(i=this.mc.config.getBoolean("Fluid.GarbageCollection.RunGC"))&&void 0!==i?i:this.gcEnabled&&!this.gcOptions.disableGC,this.shouldRunSweep=this.shouldRunGC&&void 0!==this.sweepTimeoutMs&&(null!==(o=this.mc.config.getBoolean("Fluid.GarbageCollection.RunSweep"))&&void 0!==o?o:this.sweepEnabled),this.trackGCState=!0===this.mc.config.getBoolean("Fluid.GarbageCollection.TrackGCState"),this.inactiveTimeoutMs=null!==(c=null!==(u=this.mc.config.getNumber("Fluid.GarbageCollection.TestOverride.InactiveTimeoutMs"))&&void 0!==u?u:this.gcOptions.inactiveTimeoutMs)&&void 0!==c?c:6048e5,void 0!==this.sweepTimeoutMs&&this.inactiveTimeoutMs>this.sweepTimeoutMs)throw new O.Oi("inactive timeout should not be greated than the sweep timeout");if(this.testMode=null!==(l=this.mc.config.getBoolean("Fluid.GarbageCollection.GCTestMode"))&&void 0!==l?l:!0===this.gcOptions.runGCInTestMode,this._writeDataAtRoot=null===(d=this.mc.config.getBoolean("Fluid.GarbageCollection.WriteDataAtRoot"))||void 0===d||d,this._writeDataAtRoot){var S=void 0!==(null===v||void 0===v?void 0:v.trees[Me]);this.initialStateNeedsReset=S!==this.shouldRunGC}var k=new G((0,s.Z)((0,a.Z)().mark((function e(){var t,n,i,o,s,u,c,l,d,h,p,b,w,S,k,C,x,E,T;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0!==v){e.next=2;break}return e.abrupt("return",void 0);case 2:if(void 0===(n=v.trees[Me])){e.next=10;break}return f._writeDataAtRoot=!0,e.next=7,Ge(n,y);case 7:return i=e.sent,f.trackGCState&&(f.latestSerializedSummaryState=JSON.stringify(We(i))),e.abrupt("return",i);case 10:o={gcNodes:{"/":{outboundRoutes:[]}}},g(void 0!==(s=kt(v,m)),680),u=0,c=Object.entries(s.trees);case 14:if(!(u<c.length)){e.next=35;break}if(l=(0,r.Z)(c[u],2),d=l[0],h=l[1],void 0!==(p=h.blobs[M.gcBlobKey])){e.next=19;break}return e.abrupt("continue",32);case 19:return e.next=21,y(p);case 21:if(b=e.sent,void 0!==(null===(t=b.gcData)||void 0===t?void 0:t.gcNodes)){e.next=24;break}return e.abrupt("continue",32);case 24:return w="/".concat(d),e.next=27,y(h.blobs[ot]);case 27:for(e.sent.isRootDataStore&&o.gcNodes["/"].outboundRoutes.push(w),S=0,k=Object.entries(b.gcData.gcNodes);S<k.length;S++)C=(0,r.Z)(k[S],2),x=C[0],E=C[1],T="/"===x?w:"".concat(w).concat(x),o.gcNodes[T]={outboundRoutes:Array.from(E)};g(void 0!==o.gcNodes[w],681),o.gcNodes[w].unreferencedTimestampMs=b.unrefTimestamp;case 32:u++,e.next=14;break;case 35:return e.abrupt("return",1===Object.keys(o.gcNodes).length?void 0:o);case 36:case"end":return e.stop()}}),e)}))));this.initializeBaseStateP=new G((0,s.Z)((0,a.Z)().mark((function e(){var t,n,i,o,s,u,c,l;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=f.runtime.getCurrentReferenceTimestampMs(),e.next=3,k;case 3:if(void 0!==(n=e.sent)){e.next=6;break}return e.abrupt("return");case 6:for(i={},o=0,s=Object.entries(n.gcNodes);o<s.length;o++)u=(0,r.Z)(s[o],2),c=u[0],void 0!==(l=u[1]).unreferencedTimestampMs&&f.unreferencedNodesState.set(c,new ze(l.unreferencedTimestampMs,f.inactiveTimeoutMs,f.sweepTimeoutMs,t)),i[c]=Array.from(l.outboundRoutes);f.previousGCDataFromLastRun={gcNodes:i};case 9:case"end":return e.stop()}}),e)})))),this.baseGCDetailsP=new G((0,s.Z)((0,a.Z)().mark((function e(){var t,n,i,o,s,u,c,l,d,h,f,p,v,g,m;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,k;case 2:if(void 0!==(t=e.sent)){e.next=5;break}return e.abrupt("return",new Map);case 5:for(n={},i=0,o=Object.entries(t.gcNodes);i<o.length;i++)s=(0,r.Z)(o[i],2),u=s[0],c=s[1],n[u]=Array.from(c.outboundRoutes);for(l=Ne(n,["/"]).referencedNodeIds,d=(0,q.$I)({gcData:{gcNodes:n},usedRoutes:l}),h=0,f=Object.entries(t.gcNodes);h<f.length;h++)p=(0,r.Z)(f[h],2),v=p[0],void 0!==(g=p[1]).unreferencedTimestampMs&&void 0!==(m=d.get(v.slice(1)))&&(m.unrefTimestamp=g.unreferencedTimestampMs);return e.abrupt("return",d);case 11:case"end":return e.stop()}}),e)}))));var C=JSON.stringify(Object.assign({gcEnabled:this.gcEnabled,sweepEnabled:this.sweepEnabled,runGC:this.shouldRunGC,runSweep:this.shouldRunSweep,writeAtRoot:this._writeDataAtRoot,testMode:this.testMode,sessionExpiry:this.sessionExpiryTimeoutMs,inactiveTimeout:this.inactiveTimeoutMs,existing:t.existing,trackGCState:this.trackGCState},this.gcOptions));this.isSummarizerClient&&this.mc.logger.sendTelemetryEvent({eventName:"GarbageCollectorLoaded",gcConfigs:C}),this.shouldRunGC&&this.initializeBaseStateP.catch((function(e){var t=O.Hi.wrapIfUnrecognized(e,"FailedToInitializeGC");throw t.addTelemetryProperties({gcConfigs:C}),t}))}return(0,f.Z)(e,[{key:"summaryStateNeedsReset",get:function(){return this.initialStateNeedsReset||this.shouldRunGC&&this.latestSummaryGCVersion!==this.currentGCVersion}},{key:"writeDataAtRoot",get:function(){return this._writeDataAtRoot}},{key:"collectGarbage",value:function(){var e=(0,s.Z)((0,a.Z)().mark((function e(t){var n,r,i,o=this;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.fullGC,r=void 0===n?!0===this.gcOptions.runFullGC||this.summaryStateNeedsReset:n,i=t.logger?I.G2.create(t.logger,void 0,{all:{completedGCRuns:function(){return o.completedRuns}}}):this.mc.logger,e.abrupt("return",I.Xr.timedExecAsync(i,{eventName:"GarbageCollection"},function(){var e=(0,s.Z)((0,a.Z)().mark((function e(t){var n,s,u;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,o.runPreGCSteps();case 2:return e.next=4,o.runtime.getGCData(r);case 4:return n=e.sent,s=Ne(n.gcNodes,["/"]),e.next=8,o.runPostGCSteps(n,s,i);case 8:return u=e.sent,t.end(Object.assign({},u)),o.completedRuns++,e.abrupt("return",u);case 12:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),{end:!0,cancel:"error"}));case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"runPreGCSteps",value:function(){var e=(0,s.Z)((0,a.Z)().mark((function e(){return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.initializeBaseStateP;case 2:return e.next=4,this.runtime.updateStateBeforeGC();case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"runPostGCSteps",value:function(){var e=(0,s.Z)((0,a.Z)().mark((function e(t,n,r){var i,o;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=this.generateStats(n),this.updateStateSinceLastRun(t,r),o=this.runtime.getCurrentReferenceTimestampMs(),this.updateCurrentState(t,n,o),this.runtime.updateUsedRoutes(n.referencedNodeIds,o),this.logSweepEvents(r,o),this.testMode&&this.runtime.deleteUnusedRoutes(n.deletedNodeIds),e.next=9,this.logUnreferencedEvents(r);case 9:return e.abrupt("return",i);case 10:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"summarize",value:function(e,t,n){var i;if(this.shouldRunGC&&void 0!==this.previousGCDataFromLastRun){for(var o={gcNodes:{}},a=0,s=Object.entries(this.previousGCDataFromLastRun.gcNodes);a<s.length;a++){var u=(0,r.Z)(s[a],2),c=u[0],l=u[1];o.gcNodes[c]={outboundRoutes:l,unreferencedTimestampMs:null===(i=this.unreferencedNodesState.get(c))||void 0===i?void 0:i.unreferencedTimestampMs}}var d=JSON.stringify(We(o));if(this.trackGCState&&(this.pendingSerializedSummaryState=d,void 0!==this.latestSerializedSummaryState&&this.latestSerializedSummaryState===d&&!e&&t)){var h=(0,L.Jz)();return h.handleNodeCount++,{summary:{type:S.Handle,handle:"/".concat(Me),handleType:S.Tree},stats:h}}var f=new L.x1;return f.addBlob("".concat(Fe,"_root"),d),f.getSummaryTree()}}},{key:"getMetadata",value:function(){return{gcFeature:this.gcEnabled?this.currentGCVersion:0,sessionExpiryTimeoutMs:this.sessionExpiryTimeoutMs,sweepEnabled:this.sweepEnabled}}},{key:"getBaseGCDetails",value:function(){var e=(0,s.Z)((0,a.Z)().mark((function e(){return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.baseGCDetailsP);case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"latestSummaryStateRefreshed",value:function(){var e=(0,s.Z)((0,a.Z)().mark((function e(t,n){var r,i,o,s,u;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.shouldRunGC&&t.latestSummaryUpdated){e.next=2;break}return e.abrupt("return");case 2:if(!t.wasSummaryTracked){e.next=7;break}return this.latestSummaryGCVersion=this.currentGCVersion,this.initialStateNeedsReset=!1,this.trackGCState&&(this.latestSerializedSummaryState=this.pendingSerializedSummaryState,this.pendingSerializedSummaryState=void 0),e.abrupt("return");case 7:if(r=t.snapshot,!(i=r.blobs[$e])){e.next=14;break}return e.next=12,n(i);case 12:o=e.sent,this.latestSummaryGCVersion=rt(o);case 14:if(void 0===(s=r.trees[Me])||!this.trackGCState){e.next=22;break}return e.next=18,Ge(s,n);case 18:u=e.sent,this.latestSerializedSummaryState=JSON.stringify(We(u)),e.next=23;break;case 22:this.latestSerializedSummaryState=void 0;case 23:this.pendingSerializedSummaryState=void 0;case 24:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"nodeUpdated",value:function(e,t,n,r,i){if(this.shouldRunGC){var o=this.unreferencedNodesState.get(e);o&&o.state!==je&&this.inactiveNodeUsed(t,e,o,void 0,r,n,i)}}},{key:"addedOutboundReference",value:function(e,t){var n;if(this.shouldRunGC){var r=null!==(n=this.newReferencesSinceLastRun.get(e))&&void 0!==n?n:[];r.push(t),this.newReferencesSinceLastRun.set(e,r);var i=this.unreferencedNodesState.get(t);i&&i.state!==je&&this.inactiveNodeUsed("Revived",t,i,e)}}},{key:"dispose",value:function(){void 0!==this.sessionExpiryTimer&&(clearTimeout(this.sessionExpiryTimer),this.sessionExpiryTimer=void 0)}},{key:"updateCurrentState",value:function(e,t,n){this.previousGCDataFromLastRun=(0,q.rn)(e),this.newReferencesSinceLastRun.clear();var r,i=(0,d.Z)(t.referencedNodeIds);try{for(i.s();!(r=i.n()).done;){var o=r.value,a=this.unreferencedNodesState.get(o);void 0!==a&&(a.stopTracking(),this.unreferencedNodesState.delete(o))}}catch(h){i.e(h)}finally{i.f()}if(void 0!==n){var s,u=(0,d.Z)(t.deletedNodeIds);try{for(u.s();!(s=u.n()).done;){var c=s.value,l=this.unreferencedNodesState.get(c);void 0===l?this.unreferencedNodesState.set(c,new ze(n,this.inactiveTimeoutMs,this.sweepTimeoutMs,n)):l.updateTracking(n)}}catch(h){u.e(h)}finally{u.f()}}}},{key:"updateStateSinceLastRun",value:function(e,t){if(void 0!==this.previousGCDataFromLastRun){var n=this.findMissingExplicitReferences(e,this.previousGCDataFromLastRun,this.newReferencesSinceLastRun);if(this.writeDataAtRoot&&n.length>0&&n.forEach((function(e){var n={eventName:"gcUnknownOutboundReferences",gcNodeId:e[0],gcRoutes:JSON.stringify(e[1])};t.sendPerformanceEvent(n)})),0!==this.newReferencesSinceLastRun.size){var r=(0,q.$4)(this.previousGCDataFromLastRun,e);this.newReferencesSinceLastRun.forEach((function(e,t){var n;void 0===r.gcNodes[t]?r.gcNodes[t]=e:(n=r.gcNodes[t]).push.apply(n,(0,o.Z)(e))}));var i,a=Ne(r.gcNodes,["/"]),s=(0,d.Z)(a.referencedNodeIds);try{for(s.s();!(i=s.n()).done;){var u=i.value,c=this.unreferencedNodesState.get(u);void 0!==c&&(c.stopTracking(),this.unreferencedNodesState.delete(u))}}catch(l){s.e(l)}finally{s.f()}}}}},{key:"findMissingExplicitReferences",value:function(e,t,n){var i=this;g(void 0!==t,695);var o=Object.entries(e.gcNodes),a=[];return o.forEach((function(e){var o,s,u=(0,r.Z)(e,2),c=u[0],l=u[1],d=null!==(o=t.gcNodes[c])&&void 0!==o?o:[],h=null!==(s=n.get(c))&&void 0!==s?s:[],f=[];l.forEach((function(e){var t=i.runtime.getNodeType(e)===Be||i.runtime.getNodeType(e)===De,n=!c.startsWith(e);t&&n&&!d.includes(e)&&!h.includes(e)&&f.push(e)})),f.length>0&&a.push([c,f])})),a}},{key:"generateStats",value:function(e){var t,n=this,r={nodeCount:0,dataStoreCount:0,attachmentBlobCount:0,unrefNodeCount:0,unrefDataStoreCount:0,unrefAttachmentBlobCount:0,updatedNodeCount:0,updatedDataStoreCount:0,updatedAttachmentBlobCount:0},i=function(e,t){r.nodeCount++;var i=void 0===n.previousGCDataFromLastRun||n.unreferencedNodesState.has(e)===t;i&&r.updatedNodeCount++,t||r.unrefNodeCount++,n.runtime.getNodeType(e)===De&&(r.dataStoreCount++,i&&r.updatedDataStoreCount++,t||r.unrefDataStoreCount++),n.runtime.getNodeType(e)===Be&&(r.attachmentBlobCount++,i&&r.updatedAttachmentBlobCount++,t||r.unrefAttachmentBlobCount++)},o=(0,d.Z)(e.referencedNodeIds);try{for(o.s();!(t=o.n()).done;){i(t.value,!0)}}catch(u){o.e(u)}finally{o.f()}var a,s=(0,d.Z)(e.deletedNodeIds);try{for(s.s();!(a=s.n()).done;){i(a.value,!1)}}catch(u){s.e(u)}finally{s.f()}return r}},{key:"logSweepEvents",value:function(e,t){var n=this;!0!==this.mc.config.getBoolean("Fluid.GarbageCollection.DisableSweepLog")&&void 0!==t&&void 0!==this.sweepTimeoutMs&&this.unreferencedNodesState.forEach((function(r,i){if(r.state===He){var o=n.runtime.getNodeType(i);if(o===De||o===Be){var a="Deleted-".concat(i);n.loggedUnreferencedEvents.has(a)||(n.loggedUnreferencedEvents.add(a),e.sendTelemetryEvent({eventName:"GCObjectDeleted",id:i,type:o,age:t-r.unreferencedTimestampMs,timeout:n.sweepTimeoutMs,completedGCRuns:n.completedRuns,lastSummaryTime:n.getLastSummaryTimestampMs()}))}}}))}},{key:"inactiveNodeUsed",value:function(e,t,n,r,i){var o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:this.runtime.getCurrentReferenceTimestampMs(),a=arguments.length>6?arguments[6]:void 0;if(void 0!==o&&n.state!==je&&(this.isSummarizerClient||"Loaded"===e)){var s=this.runtime.getNodeType(t);if(s===De||s===Be){var u=n.state,c="".concat(u,"-").concat(t,"-").concat(e);if(!this.loggedUnreferencedEvents.has(c)){this.loggedUnreferencedEvents.add(c);var l={id:t,type:s,unrefTime:n.unreferencedTimestampMs,age:o-n.unreferencedTimestampMs,timeout:n.state===Ue?this.inactiveTimeoutMs:this.sweepTimeoutMs,completedGCRuns:this.completedRuns,lastSummaryTime:this.getLastSummaryTimestampMs(),externalRequest:null===a||void 0===a?void 0:a[qt.externalRequest],viaHandle:null===a||void 0===a?void 0:a[qt.viaHandle],fromId:r};this.isSummarizerClient?this.pendingEventsQueue.push(Object.assign(Object.assign({},l),{usageType:e,state:u})):this.mc.logger.sendErrorEvent(Object.assign(Object.assign({},l),{eventName:"".concat(u,"Object_").concat(e),pkg:i?{value:i.join("/"),tag:I.XI.CodeArtifact}:void 0}))}}}}},{key:"logUnreferencedEvents",value:function(){var e=(0,s.Z)((0,a.Z)().mark((function e(t){var n,r,i,o,s,u,c,l,h,f;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=(0,d.Z)(this.pendingEventsQueue),e.prev=1,n.s();case 3:if((r=n.n()).done){e.next=23;break}if(i=r.value,o=i.usageType,s=i.state,u=Oe(i,["usageType","state"]),c=this.unreferencedNodesState.get(i.id),l=void 0===c||c.state===je,"Revived"===o!==l){e.next=21;break}return e.next=11,this.getNodePackagePath(i.id);case 11:if(h=e.sent,!i.fromId){e.next=18;break}return e.next=15,this.getNodePackagePath(i.fromId);case 15:e.t0=e.sent,e.next=19;break;case 18:e.t0=void 0;case 19:f=e.t0,t.sendErrorEvent(Object.assign(Object.assign({},u),{eventName:"".concat(s,"Object_").concat(o),pkg:h?{value:h.join("/"),tag:I.XI.CodeArtifact}:void 0,fromPkg:f?{value:f.join("/"),tag:I.XI.CodeArtifact}:void 0}));case 21:e.next=3;break;case 23:e.next=28;break;case 25:e.prev=25,e.t1=e.catch(1),n.e(e.t1);case 28:return e.prev=28,n.f(),e.finish(28);case 31:this.pendingEventsQueue=[];case 32:case"end":return e.stop()}}),e,this,[[1,25,28,31]])})));return function(t){return e.apply(this,arguments)}}()}],[{key:"create",value:function(t){return new e(t)}}]),e}();function Ge(e,t){return Ke.apply(this,arguments)}function Ke(){return(Ke=(0,s.Z)((0,a.Z)().mark((function e(t,n){var r,i,o,s,u,c;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r={gcNodes:{}},i=0,o=Object.keys(t.blobs);case 2:if(!(i<o.length)){e.next=17;break}if((s=o[i]).startsWith(Fe)){e.next=6;break}return e.abrupt("continue",14);case 6:if(void 0!==(u=t.blobs[s])){e.next=9;break}return e.abrupt("continue",14);case 9:return e.next=11,n(u);case 11:g(void 0!==(c=e.sent),685),r=(0,q.eF)(r,c);case 14:i++,e.next=2;break;case 17:return e.abrupt("return",r);case 18:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function We(e){var t=Object.entries(e.gcNodes);t.sort((function(e,t){var n=(0,r.Z)(e,1)[0],i=(0,r.Z)(t,1)[0];return n.localeCompare(i)}));for(var n={gcNodes:{}},i=0,o=t;i<o.length;i++){var a=(0,r.Z)(o[i],2),s=a[0],u=a[1];u.outboundRoutes.sort(),n.gcNodes[s]=u}return n}function Je(e,t,n){var r,i=2147483647;if(e>i){var o=e-i;r=setTimeout((function(){return Je(o,t,n)}),i)}else r=setTimeout((function(){return t()}),e);n(r)}function Qe(e){return e.summaryFormatVersion?e.summaryFormatVersion:"0.1"===e.snapshotFormatVersion?1:0}function Ye(e){return!!e.summaryFormatVersion&&!e.disableIsolatedChannels}var Xe=".aliases",$e=".metadata",et=".chunks",tt=".electedSummarizer",nt=".blobs";function rt(e){var t;return e&&null!==(t=e.gcFeature)&&void 0!==t?t:0}var it=[".protocol",".logTail",".serviceProtocol",nt,Me],ot=".component";function at(e){e.summary={type:S.Tree,tree:(0,i.Z)({},M.channelsTreeName,e.summary)},e.stats.treeNodeCount++}function st(e,t){return ut.apply(this,arguments)}function ut(){return(ut=(0,s.Z)((0,a.Z)().mark((function e(t,n){var r;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,N.g)(t,n.blobs[ot]);case 2:return r=e.sent,g(Qe(r)>0,469),e.abrupt("return",r);case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function ct(e,t,n){var r=JSON.stringify(e);return n?{pkg:r,snapshotFormatVersion:"0.1",isRootDataStore:t}:{pkg:r,summaryFormatVersion:2,isRootDataStore:t}}function lt(e,t,n){var r=ct(e,t,n);return new _e.Qp(ot,JSON.stringify(r))}var dt=function(e){(0,c.Z)(n,e);var t=(0,l.Z)(n);function n(e,r,i,o,u){var c;(0,h.Z)(this,n),(c=t.call(this)).existing=r,c.bindState=i,c.isLocalDataStore=o,c.makeLocallyVisibleFn=u,c._disposed=!1,c.detachedRuntimeCreation=!1,c.loaded=!1,c.pending=[],c._isInMemoryRoot=!1,c._containerRuntime=e.runtime,c.id=e.id,c.storage=e.storage,c.scope=e.scope,c.writeGCDataAtRoot=e.writeGCDataAtRoot,c.disableIsolatedChannels=e.disableIsolatedChannels,c.pkg=e.pkg,g(!c.id.includes("/"),314),c._attachState=c.containerRuntime.attachState!==p.mB.Detached&&c.existing?c.containerRuntime.attachState:p.mB.Detached,c.bindToContext=function(){g(c.bindState===p.xU.NotBound,315),c.bindState=p.xU.Binding,g(void 0!==c.channel,316),c.makeLocallyVisible(),c.bindState=p.xU.Bound};var l=function(){var e=(0,s.Z)((0,a.Z)().mark((function e(t,n,r){return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",c.summarizeInternal(t,n,r));case 1:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}();return c.summarizerNode=e.createSummarizerNodeFn(l,function(){var e=(0,s.Z)((0,a.Z)().mark((function e(t){return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",c.getGCDataInternal(t));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),(0,s.Z)((0,a.Z)().mark((function e(){return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",c.getBaseGCDetails());case 1:case"end":return e.stop()}}),e)})))),c.subLogger=I.G2.create(c.logger,"FluidDataStoreContext"),c.thresholdOpsCounter=new Pe.z(n.pendingOpsCountThreshold,c.subLogger),c}return(0,f.Z)(n,[{key:"packagePath",get:function(){return g(void 0!==this.pkg,313),this.pkg}},{key:"options",get:function(){return this._containerRuntime.options}},{key:"clientId",get:function(){return this._containerRuntime.clientId}},{key:"clientDetails",get:function(){return this._containerRuntime.clientDetails}},{key:"logger",get:function(){return this._containerRuntime.logger}},{key:"deltaManager",get:function(){return this._containerRuntime.deltaManager}},{key:"connected",get:function(){return this._containerRuntime.connected}},{key:"IFluidHandleContext",get:function(){return this._containerRuntime.IFluidHandleContext}},{key:"containerRuntime",get:function(){return this._containerRuntime}},{key:"isLoaded",get:function(){return this.loaded}},{key:"baseSnapshot",get:function(){return this._baseSnapshot}},{key:"disposed",get:function(){return this._disposed}},{key:"attachState",get:function(){return this._attachState}},{key:"IFluidDataStoreRegistry",get:function(){return this.registry}},{key:"isRoot",value:function(){var e=(0,s.Z)((0,a.Z)().mark((function e(){return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=this.isInMemoryRoot(),e.t0){e.next=5;break}return e.next=4,this.getInitialSnapshotDetails();case 4:e.t0=e.sent.isRootDataStore;case 5:return e.abrupt("return",e.t0);case 6:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"isInMemoryRoot",value:function(){return this._isInMemoryRoot}},{key:"dispose",value:function(){this._disposed||(this._disposed=!0,this.channelDeferred&&this.channelDeferred.promise.then((function(e){e.dispose()})).catch((function(e){})))}},{key:"rejectDeferredRealize",value:function(e,t){throw new W.j4(e,{packageName:{value:t,tag:I.XI.PackageData}})}},{key:"realize",value:function(){var e=(0,s.Z)((0,a.Z)().mark((function e(){var t=this;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return g(!this.detachedRuntimeCreation,317),this.channelDeferred||(this.channelDeferred=new V,this.realizeCore(this.existing).catch((function(e){var n,r=O.Hi.wrapIfUnrecognized(e,"realizeFluidDataStoreContext");r.addTelemetryProperties({fluidDataStoreId:{value:t.id,tag:"PackageData"}}),null===(n=t.channelDeferred)||void 0===n||n.reject(r),t.logger.sendErrorEvent({eventName:"RealizeError"},r)}))),e.abrupt("return",this.channelDeferred.promise);case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"factoryFromPackagePath",value:function(){var e=(0,s.Z)((0,a.Z)().mark((function e(t){var n,r,i,o,s,u,c;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:g(this.pkg===t,318),void 0===t&&this.rejectDeferredRealize("packages is undefined"),r=this._containerRuntime.IFluidDataStoreRegistry,o=(0,d.Z)(t),e.prev=4,o.s();case 6:if((s=o.n()).done){e.next=17;break}return u=s.value,r||this.rejectDeferredRealize("No registry for package",i),i=u,e.next=12,r.get(u);case 12:(n=e.sent)||this.rejectDeferredRealize("Registry does not contain entry for the package",u),r=n.IFluidDataStoreRegistry;case 15:e.next=6;break;case 17:e.next=22;break;case 19:e.prev=19,e.t0=e.catch(4),o.e(e.t0);case 22:return e.prev=22,o.f(),e.finish(22);case 25:return void 0===(c=null===n||void 0===n?void 0:n.IFluidDataStoreFactory)&&this.rejectDeferredRealize("Can't find factory for package",i),e.abrupt("return",{factory:c,registry:r});case 28:case"end":return e.stop()}}),e,this,[[4,19,22,25]])})));return function(t){return e.apply(this,arguments)}}()},{key:"realizeCore",value:function(){var e=(0,s.Z)((0,a.Z)().mark((function e(t){var n,r,i,o,s,u;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getInitialSnapshotDetails();case 2:return n=e.sent,this._baseSnapshot=n.snapshot,r=n.pkg,e.next=7,this.factoryFromPackagePath(r);case 7:return i=e.sent,o=i.factory,s=i.registry,g(void 0===this.registry,319),this.registry=s,e.next=14,o.instantiateDataStore(this,t);case 14:g(void 0!==(u=e.sent),320),this.bindRuntime(u);case 17:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"setConnectionState",value:function(e,t){this.verifyNotClosed(),this.loaded&&(g(this.connected===e,321),this.channel.setConnectionState(e,t))}},{key:"process",value:function(e,t,n){var r;this.verifyNotClosed();var i=e.contents,o=Object.assign(Object.assign({},e),{type:i.type,contents:i.content});if(this.summarizerNode.recordChange(o),this.loaded)return null===(r=this.channel)||void 0===r?void 0:r.process(o,t,n);g(!t,322),g(void 0!==this.pending,573),this.pending.push(o),this.thresholdOpsCounter.sendIfMultiple("StorePendingOps",this.pending.length)}},{key:"processSignal",value:function(e,t){var n;this.verifyNotClosed(),this.loaded&&(null===(n=this.channel)||void 0===n||n.processSignal(e,t))}},{key:"getQuorum",value:function(){return this._containerRuntime.getQuorum()}},{key:"getAudience",value:function(){return this._containerRuntime.getAudience()}},{key:"summarize",value:function(){var e=(0,s.Z)((0,a.Z)().mark((function e(){var t,n,r,i=arguments;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=i.length>0&&void 0!==i[0]&&i[0],n=!(i.length>1&&void 0!==i[1])||i[1],r=i.length>2?i[2]:void 0,e.abrupt("return",this.summarizerNode.summarize(t,n,r));case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"summarizeInternal",value:function(){var e=(0,s.Z)((0,a.Z)().mark((function e(t,n,r){var i,o,s,u,c,l;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.realize();case 2:return e.next=4,this.channel.summarize(t,n,r);case 4:return i=e.sent,this.disableIsolatedChannels||(at(i),o=[M.channelsTreeName]),e.next=8,this.getInitialSnapshotDetails();case 8:return s=e.sent,u=s.pkg,e.next=12,this.isRoot();case 12:return c=e.sent,l=ct(u,c,this.disableIsolatedChannels),(0,L.Rt)(i,ot,JSON.stringify(l)),this.writeGCDataAtRoot||(0,L.Rt)(i,M.gcBlobKey,JSON.stringify(this.summarizerNode.getGCSummaryDetails())),this.summarizerNode.isReferenced()||(i.summary.unreferenced=!0,i.stats.unreferencedBlobSize=i.stats.totalBlobSize),e.abrupt("return",Object.assign(Object.assign({},i),{id:this.id,pathPartsForChildren:o}));case 18:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"getGCData",value:function(){var e=(0,s.Z)((0,a.Z)().mark((function e(){var t,n=arguments;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=n.length>0&&void 0!==n[0]&&n[0],e.abrupt("return",this.summarizerNode.getGCData(t));case 2:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getGCDataInternal",value:function(){var e=(0,s.Z)((0,a.Z)().mark((function e(){var t,n=arguments;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=n.length>0&&void 0!==n[0]&&n[0],e.next=3,this.realize();case 3:return g(void 0!==this.channel,323),e.abrupt("return",this.channel.getGCData(t));case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"updateUsedRoutes",value:function(e,t){this.summarizerNode.updateUsedRoutes(e,t),this.lastUsedState={usedRoutes:e,gcTimestamp:t},this.loaded&&this.updateChannelUsedRoutes()}},{key:"addedGCOutboundReference",value:function(e,t){this._containerRuntime.addedGCOutboundReference(e,t)}},{key:"updateChannelUsedRoutes",value:function(){if(g(this.loaded,324),g(void 0!==this.channel,325),void 0!==this.lastUsedState){var e=this.lastUsedState.usedRoutes.filter((function(e){return"/"!==e&&""!==e}));this.channel.updateUsedRoutes(e,this.lastUsedState.gcTimestamp)}}},{key:"request",value:function(){var e=(0,s.Z)((0,a.Z)().mark((function e(t){var n;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.realize();case 2:return n=e.sent,e.abrupt("return",n.request(t));case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"submitMessage",value:function(e,t,n){this.verifyNotClosed(),g(!!this.channel,326);var r={content:t,type:e};this._containerRuntime.submitDataStoreOp(this.id,r,n)}},{key:"setChannelDirty",value:function(e){this.verifyNotClosed();var t=this.deltaManager.lastSequenceNumber;this.summarizerNode.invalidate(t);var n=this.summarizerNode.getChild(e);n&&n.invalidate(t)}},{key:"submitSignal",value:function(e,t){return this.verifyNotClosed(),g(!!this.channel,327),this._containerRuntime.submitDataStoreSignal(this.id,e,t)}},{key:"makeLocallyVisible",value:function(){g(void 0!==this.channel,719),this.makeLocallyVisibleFn()}},{key:"bindRuntime",value:function(e){var t;if(this.channel)throw new Error("Runtime already bound");try{g(!this.detachedRuntimeCreation,328),g(void 0!==this.channelDeferred,329),g(void 0!==this.pkg,330);var n,r=this.pending,i=(0,d.Z)(r);try{for(i.s();!(n=i.n()).done;){var o=n.value;e.process(o,!1,void 0)}}catch(a){i.e(a)}finally{i.f()}this.thresholdOpsCounter.send("ProcessPendingOps",r.length),this.pending=void 0,this.loaded=!0,this.channel=e,Object.freeze(this.pkg),this.updateChannelUsedRoutes(),this.channelDeferred.resolve(this.channel)}catch(s){null===(t=this.channelDeferred)||void 0===t||t.reject(s),this.logger.sendErrorEvent({eventName:"BindRuntimeError",fluidDataStoreId:{value:this.id,tag:"PackageData"}},s)}}},{key:"getAbsoluteUrl",value:function(){var e=(0,s.Z)((0,a.Z)().mark((function e(t){return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.attachState===p.mB.Attached){e.next=2;break}return e.abrupt("return",void 0);case 2:return e.abrupt("return",this._containerRuntime.getAbsoluteUrl(t));case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"setInMemoryRoot",value:function(){this._isInMemoryRoot=!0}},{key:"reSubmit",value:function(e,t){g(!!this.channel,331);var n=e;this.channel.reSubmit(n.type,n.content,t)}},{key:"rollback",value:function(e,t){if(!this.channel)throw new Error("Channel must exist when rolling back ops");if(!this.channel.rollback)throw new Error("Channel doesn't support rollback");var n=e;this.channel.rollback(n.type,n.content,t)}},{key:"applyStashedOp",value:function(){var e=(0,s.Z)((0,a.Z)().mark((function e(t){var n;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.channel){e.next=3;break}return e.next=3,this.realize();case 3:return g(!!this.channel,332),n=t,e.abrupt("return",this.channel.applyStashedOp(n.content));case 6:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"verifyNotClosed",value:function(){if(this._disposed)throw new Error("Context is closed")}},{key:"getCreateChildSummarizerNodeFn",value:function(e,t){var n=this;return function(r,i,o){return n.summarizerNode.createChild(r,e,t,{throwOnFailure:!0},i,o)}}},{key:"uploadBlob",value:function(){var e=(0,s.Z)((0,a.Z)().mark((function e(t){return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.containerRuntime.uploadBlob(t));case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),n}(T);dt.pendingOpsCountThreshold=1e3;var ht,ft=function(e){(0,c.Z)(n,e);var t=(0,l.Z)(n);function n(e){var r;return(0,h.Z)(this,n),(r=t.call(this,e,!0,p.xU.Bound,!1,(function(){throw new Error("Already attached")}))).initialSnapshotDetailsP=new G((0,s.Z)((0,a.Z)().mark((function e(){var t,n,i,o,u,c,l,d,h,f;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(o=!0,"string"!==typeof r.initSnapshotValue){e.next=19;break}return e.next=4,r.storage.getVersions(r.initSnapshotValue,1);case 4:return u=e.sent[0],e.next=7,r.storage.getSnapshotTree(u);case 7:if(e.t1=t=e.sent,e.t0=null!==e.t1,!e.t0){e.next=11;break}e.t0=void 0!==t;case 11:if(!e.t0){e.next=15;break}e.t2=t,e.next=16;break;case 15:e.t2=void 0;case 16:i=e.t2,e.next=20;break;case 19:i=r.initSnapshotValue;case 20:if(c=function(){var e=(0,s.Z)((0,a.Z)().mark((function e(t){return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,N.g)(r.storage,t));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),!i){e.next=27;break}return e.next=24,r.summarizerNode.loadBaseSummary(i,c);case 24:l=e.sent,i=l.baseSummary,r.pending=l.outstandingOps.concat(r.pending);case 27:if(!i||void 0===i.blobs[ot]){e.next=36;break}return e.next=30,c(i.blobs[ot]);case 30:d=e.sent,f=Qe(d),h=f<1?d.pkg.startsWith('["')&&d.pkg.endsWith('"]')?JSON.parse(d.pkg):[d.pkg]:JSON.parse(d.pkg),r.pkg=h,o=null===(n=d.isRootDataStore)||void 0===n||n,Ye(d)&&g(void 0!==(i=i.trees[M.channelsTreeName]),510);case 36:return e.abrupt("return",{pkg:r.pkg,isRootDataStore:o,snapshot:i});case 37:case"end":return e.stop()}}),e)})))),r.initSnapshotValue=e.snapshotTree,r.baseGCDetailsP=new G((0,s.Z)((0,a.Z)().mark((function t(){var n;return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.getBaseGCDetails();case 2:if(t.t1=n=t.sent,t.t0=null!==t.t1,!t.t0){t.next=6;break}t.t0=void 0!==n;case 6:if(!t.t0){t.next=10;break}t.t2=n,t.next=11;break;case 10:t.t2={};case 11:return t.abrupt("return",t.t2);case 12:case"end":return t.stop()}}),t)})))),r}return(0,f.Z)(n,[{key:"getInitialSnapshotDetails",value:function(){var e=(0,s.Z)((0,a.Z)().mark((function e(){return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.initialSnapshotDetailsP);case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getInitialGCSummaryDetails",value:function(){var e=(0,s.Z)((0,a.Z)().mark((function e(){return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.getBaseGCDetails());case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getBaseGCDetails",value:function(){var e=(0,s.Z)((0,a.Z)().mark((function e(){return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.baseGCDetailsP);case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"generateAttachMessage",value:function(){throw new Error("Cannot attach remote store")}}]),n}(dt),pt=function(e){(0,c.Z)(n,e);var t=(0,l.Z)(n);function n(e){var r;return(0,h.Z)(this,n),(r=t.call(this,e,void 0!==e.snapshotTree,e.snapshotTree?p.xU.Bound:p.xU.NotBound,!0,e.makeLocallyVisibleFn)).snapshotTree=e.snapshotTree,!0===e.isRootDataStore&&r.setInMemoryRoot(),r.createProps=e.createProps,r.attachListeners(),r}return(0,f.Z)(n,[{key:"attachListeners",value:function(){var e=this;this.once("attaching",(function(){g(e.attachState===p.mB.Detached,333),e._attachState=p.mB.Attaching})),this.once("attached",(function(){g(e.attachState===p.mB.Attaching,334),e._attachState=p.mB.Attached}))}},{key:"generateAttachMessage",value:function(){g(void 0!==this.channel,335),g(void 0!==this.pkg,336);var e=this.channel.getAttachSummary();this.disableIsolatedChannels||at(e);var t=ct(this.pkg,this.isInMemoryRoot(),this.disableIsolatedChannels);(0,L.Rt)(e,ot,JSON.stringify(t));var n=(0,L.H4)(e.summary);return{id:this.id,snapshot:n,type:this.pkg[this.pkg.length-1]}}},{key:"getInitialSnapshotDetails",value:function(){var e=(0,s.Z)((0,a.Z)().mark((function e(){var t,n,r,i;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=this.snapshotTree,i=!1,void 0===n){e.next=8;break}return e.next=5,st(this.storage,n);case 5:Ye(r=e.sent)&&g(void 0!==(n=n.trees[M.channelsTreeName]),511),void 0===this.pkg&&(this.pkg=JSON.parse(r.pkg),(null===(t=r.isRootDataStore)||void 0===t||t)&&(i=!0,this.setInMemoryRoot()));case 8:return g(void 0!==this.pkg,338),e.abrupt("return",{pkg:this.pkg,isRootDataStore:i,snapshot:n});case 10:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getInitialGCSummaryDetails",value:function(){var e=(0,s.Z)((0,a.Z)().mark((function e(){return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",{});case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"getBaseGCDetails",value:function(){var e=(0,s.Z)((0,a.Z)().mark((function e(){return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",{});case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()}]),n}(dt),vt=function(e){(0,c.Z)(n,e);var t=(0,l.Z)(n);function n(e){return(0,h.Z)(this,n),t.call(this,e)}return(0,f.Z)(n)}(pt),gt=function(e){(0,c.Z)(n,e);var t=(0,l.Z)(n);function n(e){var r;return(0,h.Z)(this,n),(r=t.call(this,e)).detachedRuntimeCreation=!0,r}return(0,f.Z)(n,[{key:"attachRuntime",value:function(){var e=(0,s.Z)((0,a.Z)().mark((function e(t,r){var i,o;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return g(this.detachedRuntimeCreation,340),g(void 0===this.channelDeferred,341),i=t.IFluidDataStoreFactory,e.next=5,this.factoryFromPackagePath(this.pkg);case 5:return g((o=e.sent).factory===i,342),g(void 0===this.registry,343),this.registry=o.registry,this.detachedRuntimeCreation=!1,this.channelDeferred=new V,(0,C.Z)((0,x.Z)(n.prototype),"bindRuntime",this).call(this,r),e.next=14,this.isRoot();case 14:if(!e.sent){e.next=16;break}void 0!==r.makeVisibleAndAttachGraph?r.makeVisibleAndAttachGraph():r.bindToContext();case 16:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"getInitialSnapshotDetails",value:function(){var e=(0,s.Z)((0,a.Z)().mark((function e(){return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.detachedRuntimeCreation){e.next=2;break}throw new Error("Detached Fluid Data Store context can't be realized! Please attach runtime first!");case 2:return e.abrupt("return",(0,C.Z)((0,x.Z)(n.prototype),"getInitialSnapshotDetails",this).call(this));case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),n}(pt),mt=function(e){return"string"===typeof(null===e||void 0===e?void 0:e.internalId)&&"string"===typeof(null===e||void 0===e?void 0:e.alias)},yt=function(e,t,n,r,i){return new wt(e,t,n,r,i)};!function(e){e.Aliased="Aliased",e.Aliasing="Aliasing",e.None="None"}(ht||(ht={}));var bt,wt=function(){function e(t,n,r,i,o){(0,h.Z)(this,e),this.fluidDataStoreChannel=t,this.internalId=n,this.runtime=r,this.datastores=i,this.logger=o,this.aliasState=ht.None}return(0,f.Z)(e,[{key:"trySetAlias",value:function(){var e=(0,s.Z)((0,a.Z)().mark((function e(t){return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.includes("/")){e.next=2;break}throw new O.Oi("The alias cannot contain slashes: '".concat(t,"'"));case 2:e.t0=this.aliasState,e.next=e.t0===ht.Aliasing?5:e.t0===ht.Aliased?9:e.t0===ht.None?10:11;break;case 5:return g(void 0!==this.aliasResult,790),e.next=8,this.aliasResult;case 8:case 9:return e.abrupt("return",this.alias===t?"Success":"AlreadyAliased");case 10:return e.abrupt("break",12);case 11:y(this.aliasState);case 12:return this.aliasState=ht.Aliasing,this.aliasResult=this.trySetAliasInternal(t),e.abrupt("return",this.aliasResult);case 15:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"trySetAliasInternal",value:function(){var e=(0,s.Z)((0,a.Z)().mark((function e(t){var n,r,i,o=this;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n={internalId:this.internalId,alias:t},void 0!==this.fluidDataStoreChannel.makeVisibleAndAttachGraph?this.fluidDataStoreChannel.makeVisibleAndAttachGraph():this.fluidDataStoreChannel.bindToContext(),this.runtime.attachState!==p.mB.Detached){e.next=6;break}return r=this.datastores.processAliasMessageCore(n),this.aliasState=ht.Aliased,e.abrupt("return",r?"Success":"Conflict");case 6:return e.next=8,this.ackBasedPromise((function(e){o.runtime.submitDataStoreAliasOp(n,e)})).then((function(e){return o.aliasState=ht.Aliased,e&&(o.alias=t),e})).catch((function(e){return o.logger.sendErrorEvent({eventName:"AliasingException",alias:{value:t,tag:I.XI.UserData},internalId:{value:o.internalId,tag:I.XI.PackageData}},e),o.aliasState=ht.None,!1}));case 8:return i=e.sent,e.abrupt("return",i?"Success":"Conflict");case 10:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"request",value:function(){var e=(0,s.Z)((0,a.Z)().mark((function e(t){return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.fluidDataStoreChannel.request(t));case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"IFluidRouter",get:function(){return this.fluidDataStoreChannel}},{key:"ackBasedPromise",value:function(){var e=(0,s.Z)((0,a.Z)().mark((function e(t){var n,r=this;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,i){n=function(){return i(new Error("ContainerRuntime disposed while this ack-based Promise was pending"))},r.runtime.disposed?n():(r.runtime.on("dispose",n),t(e,i))})).finally((function(){r.runtime.off("dispose",n)})));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()}]),e}(),St=function(){function e(t,n,i,o,u,c,l,f,v,g){var m=this,y=arguments.length>10&&void 0!==arguments[10]?arguments[10]:new Re(c);(0,h.Z)(this,e),this.baseSnapshot=t,this.runtime=n,this.submitAttachFn=i,this.getCreateChildSummarizerNodeFn=o,this.deleteChildSummarizerNodeFn=u,this.gcNodeUpdated=f,this.aliasMap=v,this.writeGCDataAtRoot=g,this.contexts=y,this.pendingAttach=new Map,this.attachOpFiredForDataStore=new Set,this.disposeOnce=new we((function(){return m.contexts.dispose()})),this.dataStoresSinceLastGC=[],this.dispose=function(){return m.disposeOnce.value},this.logger=I.G2.create(c),this.containerRuntimeHandle=new X.B(this.runtime,"/",this.runtime.IFluidHandleContext);var b=new G((0,s.Z)((0,a.Z)().mark((function e(){return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",l());case 1:case"end":return e.stop()}}),e)})))),w=function(){var e=(0,s.Z)((0,a.Z)().mark((function e(t){var n;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,b;case 2:return n=e.sent,e.abrupt("return",n.get(t));case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),S=new Map;if(t)for(var k=0,C=Object.entries(t.trees);k<C.length;k++){var x=(0,r.Z)(C[k],2),E=x[0],T=x[1];S.set(E,T)}var A,R=0,_=(0,d.Z)(S);try{var P=function(){var e,t=(0,r.Z)(A.value,2),n=t[0],i=t[1];if(i.unreferenced&&R++,m.runtime.attachState!==p.mB.Detached)e=new ft({id:n,snapshotTree:i,getBaseGCDetails:function(){var e=(0,s.Z)((0,a.Z)().mark((function e(){return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",w(n));case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),runtime:m.runtime,storage:m.runtime.storage,scope:m.runtime.scope,createSummarizerNodeFn:m.getCreateChildSummarizerNodeFn(n,{type:M.CreateSummarizerNodeSource.FromSummary}),writeGCDataAtRoot:m.writeGCDataAtRoot,disableIsolatedChannels:m.runtime.disableIsolatedChannels});else{if("object"!==typeof i)throw new W.j4("Snapshot should be there to load from!!");var o=i;e=new vt({id:n,pkg:void 0,runtime:m.runtime,storage:m.runtime.storage,scope:m.runtime.scope,createSummarizerNodeFn:m.getCreateChildSummarizerNodeFn(n,{type:M.CreateSummarizerNodeSource.FromSummary}),makeLocallyVisibleFn:function(){return m.makeDataStoreLocallyVisible(n)},snapshotTree:o,isRootDataStore:void 0,writeGCDataAtRoot:m.writeGCDataAtRoot,disableIsolatedChannels:m.runtime.disableIsolatedChannels})}m.contexts.addBoundOrRemoted(e)};for(_.s();!(A=_.n()).done;)P()}catch(N){_.e(N)}finally{_.f()}this.containerLoadStats={containerLoadDataStoreCount:S.size,referencedDataStoreCount:S.size-R}}return(0,f.Z)(e,[{key:"aliases",value:function(){return this.aliasMap}},{key:"processAttachMessage",value:function(e,t){var n,r,i=e.contents;if(this.dataStoresSinceLastGC.push(i.id),t)return g(this.pendingAttach.has(i.id),350),null===(n=this.contexts.get(i.id))||void 0===n||n.emit("attached"),void this.pendingAttach.delete(i.id);if(this.alreadyProcessed(i.id))throw new O.Jd("Duplicate DataStore created with existing id",Object.assign(Object.assign({},(0,O.HN)(e)),{dataStoreId:{value:i.id,tag:I.XI.PackageData}}));var o,u=new Map;i.snapshot&&(o=(0,Ie.m)(i.snapshot.entries,u));var c=[i.type],l=new ft({id:i.id,snapshotTree:o,getBaseGCDetails:function(){var e=(0,s.Z)((0,a.Z)().mark((function e(){return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",{});case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),runtime:this.runtime,storage:new Ae(this.runtime.storage,u),scope:this.runtime.scope,createSummarizerNodeFn:this.getCreateChildSummarizerNodeFn(i.id,{type:M.CreateSummarizerNodeSource.FromAttach,sequenceNumber:e.sequenceNumber,snapshot:null!==(r=i.snapshot)&&void 0!==r?r:{entries:[lt(c,!0,this.runtime.disableIsolatedChannels)]}}),writeGCDataAtRoot:this.writeGCDataAtRoot,disableIsolatedChannels:this.runtime.disableIsolatedChannels,pkg:c});this.contexts.addBoundOrRemoted(l)}},{key:"processAliasMessage",value:function(e,t,n){var r=e.contents;if(!mt(r))throw new O.Jd("malformedDataStoreAliasMessage",Object.assign({},(0,O.HN)(e)));var i=t,o=this.processAliasMessageCore(r);n&&i(o)}},{key:"processAliasMessageCore",value:function(e){if(this.alreadyProcessed(e.alias))return!1;var t=this.contexts.get(e.internalId);if(void 0===t)return this.logger.sendErrorEvent({eventName:"AliasFluidDataStoreNotFound",fluidDataStoreId:e.internalId}),!1;var n=new X.B(t,e.internalId,this.runtime.IFluidHandleContext);return this.runtime.addedGCOutboundReference(this.containerRuntimeHandle,n),this.aliasMap.set(e.alias,t.id),t.setInMemoryRoot(),!0}},{key:"alreadyProcessed",value:function(e){return void 0!==this.aliasMap.get(e)||void 0!==this.contexts.get(e)}},{key:"makeDataStoreLocallyVisible",value:function(e){var t=this.contexts.getUnbound(e);if(g(!!t,351),this.runtime.attachState!==p.mB.Detached){t.emit("attaching");var n=t.generateAttachMessage();this.pendingAttach.set(e,n),this.submitAttachFn(n),this.attachOpFiredForDataStore.add(e)}this.contexts.bind(e)}},{key:"createDetachedDataStoreCore",value:function(e,t){var n=this,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:(0,j.Z)();g(!r.includes("/"),780);var i=new gt({id:r,pkg:e,runtime:this.runtime,storage:this.runtime.storage,scope:this.runtime.scope,createSummarizerNodeFn:this.getCreateChildSummarizerNodeFn(r,{type:M.CreateSummarizerNodeSource.Local}),makeLocallyVisibleFn:function(){return n.makeDataStoreLocallyVisible(r)},snapshotTree:void 0,isRootDataStore:t,writeGCDataAtRoot:this.writeGCDataAtRoot,disableIsolatedChannels:this.runtime.disableIsolatedChannels});return this.contexts.addUnbound(i),i}},{key:"_createFluidDataStoreContext",value:function(e,t,n,r){var i=this;g(!t.includes("/"),781);var o=new vt({id:t,pkg:e,runtime:this.runtime,storage:this.runtime.storage,scope:this.runtime.scope,createSummarizerNodeFn:this.getCreateChildSummarizerNodeFn(t,{type:M.CreateSummarizerNodeSource.Local}),makeLocallyVisibleFn:function(){return i.makeDataStoreLocallyVisible(t)},snapshotTree:void 0,isRootDataStore:n,writeGCDataAtRoot:this.writeGCDataAtRoot,disableIsolatedChannels:this.runtime.disableIsolatedChannels,createProps:r});return this.contexts.addUnbound(o),o}},{key:"disposed",get:function(){return this.disposeOnce.evaluated}},{key:"resubmitDataStoreOp",value:function(e,t){var n=e,r=this.contexts.get(n.address);g(!!r,352),r.reSubmit(n.contents,t)}},{key:"rollbackDataStoreOp",value:function(e,t){var n=e,r=this.contexts.get(n.address);g(!!r,744),r.rollback(n.contents,t)}},{key:"applyStashedOp",value:function(){var e=(0,s.Z)((0,a.Z)().mark((function e(t){var n,r;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t,g(!!(r=this.contexts.get(n.address)),353),e.abrupt("return",r.applyStashedOp(n.contents));case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"applyStashedAttachOp",value:function(){var e=(0,s.Z)((0,a.Z)().mark((function e(t){return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.pendingAttach.set(t.id,t),this.processAttachMessage({contents:t},!1);case 2:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"processFluidDataStoreOp",value:function(e,t,n){var r=e.contents,i=Object.assign(Object.assign({},e),{contents:r.contents}),o=this.contexts.get(r.address);g(!!o,354),o.process(i,t,n),this.gcNodeUpdated("/".concat(r.address),e.timestamp,o.isLoaded?o.packagePath:void 0)}},{key:"getDataStore",value:function(){var e=(0,s.Z)((0,a.Z)().mark((function e(t,n){var r,i;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.contexts.getBoundOrRemoted(t,n);case 2:if(void 0!==(r=e.sent)){e.next=6;break}throw i={url:t},(0,D.fu)((0,D.I4)(i),i);case 6:return e.abrupt("return",r);case 7:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"processSignal",value:function(e,t,n){var r=this.contexts.get(e);if(!r)return g(!n,355),void this.logger.sendTelemetryEvent({eventName:"SignalFluidDataStoreNotFound",fluidDataStoreId:{value:e,tag:I.XI.PackageData}});r.processSignal(t,n)}},{key:"setConnectionState",value:function(e,t){var n,i=(0,d.Z)(this.contexts);try{for(i.s();!(n=i.n()).done;){var o=(0,r.Z)(n.value,2),a=o[0],s=o[1];try{s.setConnectionState(e,t)}catch(u){this.logger.sendErrorEvent({eventName:"SetConnectionStateError",clientId:t,fluidDataStore:a},u)}}}catch(c){i.e(c)}finally{i.f()}}},{key:"setAttachState",value:function(e){var t;t=e===p.mB.Attaching?"attaching":"attached";var n,i=(0,d.Z)(this.contexts);try{for(i.s();!(n=i.n()).done;){var o=(0,r.Z)(n.value,2)[1];this.contexts.isNotBound(o.id)||o.emit(t)}}catch(a){i.e(a)}finally{i.f()}}},{key:"size",get:function(){return this.contexts.size}},{key:"summarize",value:function(){var e=(0,s.Z)((0,a.Z)().mark((function e(t,n,i){var o;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=new L.x1,e.next=3,Promise.all(Array.from(this.contexts).filter((function(e){var t=(0,r.Z)(e,2),n=(t[0],t[1]);return g(n.attachState!==p.mB.Attaching,357),n.attachState===p.mB.Attached})).map(function(){var e=(0,s.Z)((0,a.Z)().mark((function e(s){var u,c,l,d;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return u=(0,r.Z)(s,2),c=u[0],l=u[1],e.next=3,l.summarize(t,n,i);case 3:d=e.sent,o.addWithStats(c,d);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 3:return e.abrupt("return",o.getSummaryTree());case 4:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"createSummary",value:function(e){var t,n=this,i=new L.x1,o=function(){var e=i.summary.tree;t=n.contexts.notBoundLength(),Array.from(n.contexts).filter((function(t){var i=(0,r.Z)(t,2),o=i[0];i[1];return!(n.contexts.isNotBound(o)||e[o]||n.attachOpFiredForDataStore.has(o))})).map((function(e){var t,o=(0,r.Z)(e,2),a=o[0],s=o[1];if(s.isLoaded){var u=s.generateAttachMessage().snapshot;t=(0,L.j9)(u,!0)}else g(!!n.baseSnapshot,358),t=(0,L.S5)(n.baseSnapshot.trees[a]);i.addWithStats(a,t)}))};do{o()}while(t!==this.contexts.notBoundLength());return i.getSummaryTree()}},{key:"updateStateBeforeGC",value:function(){var e=(0,s.Z)((0,a.Z)().mark((function e(){var t,n,r,i,o;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=(0,d.Z)(this.dataStoresSinceLastGC),e.prev=1,t.s();case 3:if((n=t.n()).done){e.next=14;break}return r=n.value,g(void 0!==(i=this.contexts.get(r)),694),e.next=9,i.isRoot();case 9:if(!e.sent){e.next=12;break}o=new X.B(i,r,this.runtime.IFluidHandleContext),this.runtime.addedGCOutboundReference(this.containerRuntimeHandle,o);case 12:e.next=3;break;case 14:e.next=19;break;case 16:e.prev=16,e.t0=e.catch(1),t.e(e.t0);case 19:return e.prev=19,t.f(),e.finish(19);case 22:this.dataStoresSinceLastGC=[];case 23:case"end":return e.stop()}}),e,this,[[1,16,19,22]])})));return function(){return e.apply(this,arguments)}}()},{key:"getGCData",value:function(){var e=(0,s.Z)((0,a.Z)().mark((function e(){var t,n,i=arguments;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=i.length>0&&void 0!==i[0]&&i[0],n=new q.iR,e.next=4,Promise.all(Array.from(this.contexts).filter((function(e){var t=(0,r.Z)(e,2);t[0];return t[1].attachState===p.mB.Attached})).map(function(){var e=(0,s.Z)((0,a.Z)().mark((function e(i){var o,s,u,c;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=(0,r.Z)(i,2),s=o[0],u=o[1],e.next=3,u.getGCData(t);case 3:c=e.sent,n.prefixAndAddNodes(s,c.gcNodes);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 4:return e.t0=n,e.next=7,this.getOutboundRoutes();case 7:return e.t1=e.sent,e.t0.addNode.call(e.t0,"/",e.t1),e.abrupt("return",n.getGCData());case 10:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"updateUsedRoutes",value:function(e,t){var n,i,o=(0,q.xu)(e),a=(0,d.Z)(o);try{for(a.s();!(i=a.n()).done;){var s=(0,r.Z)(i.value,1)[0];g(this.contexts.has(s),359)}}catch(f){a.e(f)}finally{a.f()}var u,c=(0,d.Z)(this.contexts);try{for(c.s();!(u=c.n()).done;){var l=(0,r.Z)(u.value,2),h=l[0];l[1].updateUsedRoutes(null!==(n=o.get(h))&&void 0!==n?n:[],t)}}catch(f){c.e(f)}finally{c.f()}}},{key:"deleteUnusedRoutes",value:function(e){var t,n=(0,d.Z)(e);try{for(n.s();!(t=n.n()).done;){var r=t.value.split("/");if(!(r.length>2)){var i=r[1];g(this.contexts.has(i),727),this.contexts.delete(i),this.deleteChildSummarizerNodeFn(i)}}}catch(o){n.e(o)}finally{n.f()}}},{key:"getOutboundRoutes",value:function(){var e=(0,s.Z)((0,a.Z)().mark((function e(){var t,n,i,o,s,u;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=[],n=(0,d.Z)(this.contexts),e.prev=2,n.s();case 4:if((i=n.n()).done){e.next=12;break}return o=(0,r.Z)(i.value,2),s=o[0],u=o[1],e.next=8,u.isRoot();case 8:e.sent&&t.push("/".concat(s));case 10:e.next=4;break;case 12:e.next=17;break;case 14:e.prev=14,e.t0=e.catch(2),n.e(e.t0);case 17:return e.prev=17,n.f(),e.finish(17);case 20:return e.abrupt("return",t);case 21:case"end":return e.stop()}}),e,this,[[2,14,17,20]])})));return function(){return e.apply(this,arguments)}}()},{key:"getDataStorePackagePath",value:function(){var e=(0,s.Z)((0,a.Z)().mark((function e(t){var n,r;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=this.contexts.get(t.split("/")[1]),e.next=3,null===r||void 0===r?void 0:r.getInitialSnapshotDetails();case 3:if(e.t1=n=e.sent,e.t0=null===e.t1,e.t0){e.next=7;break}e.t0=void 0===n;case 7:if(!e.t0){e.next=11;break}e.t2=void 0,e.next=12;break;case 11:e.t2=n.pkg;case 12:return e.abrupt("return",e.t2);case 13:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getGCNodeType",value:function(e){var t=e.split("/");if(this.contexts.has(t[1]))return 2===t.length?De:Le}}]),e}();function kt(e,t){if(e){if(function(e){return!!e&&!e.disableIsolatedChannels}(t)){var n=e.trees[M.channelsTreeName];return g(!!n,360),n}for(var i={},o=0,a=Object.entries(e.trees);o<a.length;o++){var s=(0,r.Z)(a[o],2),u=s[0],c=s[1];it.includes(u)||(i[u]=c)}return Object.assign(Object.assign({},e),{trees:i})}}!function(e){e[e.Local=0]="Local",e[e.Broadcast=1]="Broadcast",e[e.Acked=2]="Acked",e[e.Nacked=-1]="Nacked"}(bt||(bt={}));var Ct=function(){function e(t,n){(0,h.Z)(this,e),this.clientId=t,this.clientSequenceNumber=n,this.state=bt.Local,this.defSummaryOp=new V,this.defSummaryAck=new V}return(0,f.Z)(e,[{key:"summaryOp",get:function(){return this._summaryOp}},{key:"summaryAckNack",get:function(){return this._summaryAckNack}},{key:"hasBeenAcked",value:function(){return this.state===bt.Acked}},{key:"broadcast",value:function(e){return g(this.state===bt.Local,373),this._summaryOp=e,this.defSummaryOp.resolve(),this.state=bt.Broadcast,!0}},{key:"ackNack",value:function(e){return g(this.state===bt.Broadcast,374),this._summaryAckNack=e,this.defSummaryAck.resolve(),this.state=e.type===b.SummaryAck?bt.Acked:bt.Nacked,!0}},{key:"waitBroadcast",value:function(){var e=(0,s.Z)((0,a.Z)().mark((function e(){return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.defSummaryOp.promise;case 2:return e.abrupt("return",this._summaryOp);case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"waitAckNack",value:function(){var e=(0,s.Z)((0,a.Z)().mark((function e(){return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.defSummaryAck.promise;case 2:return e.abrupt("return",this._summaryAckNack);case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}],[{key:"createLocal",value:function(t,n){return new e(t,n)}},{key:"createFromOp",value:function(t){var n=new e(t.clientId,t.clientSequenceNumber);return n.broadcast(t),n}}]),e}(),xt=function(){function e(t,n){(0,h.Z)(this,e),this.clientId=t,this.summaryCollection=n,this.localSummaries=new Map,this._disposed=!1}return(0,f.Z)(e,[{key:"disposed",get:function(){return this._disposed}},{key:"watchSummary",value:function(e){var t=this.localSummaries.get(e);return t||(t=Ct.createLocal(this.clientId,e),this.localSummaries.set(t.clientSequenceNumber,t)),t}},{key:"waitFlushed",value:function(){return this.summaryCollection.waitFlushed()}},{key:"tryGetSummary",value:function(e){return this.localSummaries.get(e)}},{key:"setSummary",value:function(e){this.localSummaries.set(e.clientSequenceNumber,e)}},{key:"dispose",value:function(){this.summaryCollection.removeWatcher(this.clientId),this._disposed=!0}}]),e}(),Et=function(e){(0,c.Z)(n,e);var t=(0,l.Z)(n);function n(e,r){var i;return(0,h.Z)(this,n),(i=t.call(this)).deltaManager=e,i.logger=r,i.summaryWatchers=new Map,i.pendingSummaries=new Map,i.refreshWaitNextAck=new V,i.deltaManager.on("op",(function(e){return i.handleOp(e)})),i}return(0,f.Z)(n,[{key:"latestAck",get:function(){return this.lastAck}},{key:"emit",value:function(e){for(var t,r=arguments.length,i=new Array(r>1?r-1:0),o=1;o<r;o++)i[o-1]=arguments[o];return(t=(0,C.Z)((0,x.Z)(n.prototype),"emit",this)).call.apply(t,[this,e].concat(i))}},{key:"opsSinceLastAck",get:function(){var e,t;return this.deltaManager.lastSequenceNumber-(null!==(t=null===(e=this.lastAck)||void 0===e?void 0:e.summaryAck.sequenceNumber)&&void 0!==t?t:this.deltaManager.initialSequenceNumber)}},{key:"addOpListener",value:function(e){this.deltaManager.on("op",e)}},{key:"removeOpListener",value:function(e){this.deltaManager.off("op",e)}},{key:"createWatcher",value:function(e){var t=new xt(e,this);return this.summaryWatchers.set(e,t),t}},{key:"removeWatcher",value:function(e){this.summaryWatchers.delete(e)}},{key:"setPendingAckTimerTimeoutCallback",value:function(e,t){this.maxAckWaitTime=e,this.pendingAckTimerTimeoutCallback=t}},{key:"unsetPendingAckTimerTimeoutCallback",value:function(){this.maxAckWaitTime=void 0,this.pendingAckTimerTimeoutCallback=void 0}},{key:"waitFlushed",value:function(){var e=(0,s.Z)((0,a.Z)().mark((function e(){var t;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(this.pendingSummaries.size>0)){e.next=6;break}return t=Array.from(this.pendingSummaries,(function(e){return(0,r.Z)(e,2)[1].waitAckNack()})),e.next=4,Promise.all(t);case 4:e.next=0;break;case 6:return e.abrupt("return",this.lastAck);case 7:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"waitSummaryAck",value:function(){var e=(0,s.Z)((0,a.Z)().mark((function e(t){return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.lastAck&&!(this.lastAck.summaryOp.referenceSequenceNumber<t)){e.next=5;break}return e.next=3,this.refreshWaitNextAck.promise;case 3:e.next=0;break;case 5:return e.abrupt("return",this.lastAck);case 6:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"handleOp",value:function(e){var t;switch(e.type){case b.Summarize:return void this.handleSummaryOp(e);case b.SummaryAck:return void this.handleSummaryAck(e);case b.SummaryNack:return void this.handleSummaryNack(e);default:var n=e.timestamp;return void 0!==this.lastSummaryTimestamp&&void 0!==this.maxAckWaitTime&&n-this.lastSummaryTimestamp>=this.maxAckWaitTime&&(null===(t=this.pendingAckTimerTimeoutCallback)||void 0===t||t.call(this)),void this.emit("default",e)}}},{key:"handleSummaryOp",value:function(e){var t,n=this.summaryWatchers.get(e.clientId);n&&(t=n.tryGetSummary(e.clientSequenceNumber))&&t.broadcast(e),t||(t=Ct.createFromOp(e),n&&n.setSummary(t)),this.pendingSummaries.set(e.sequenceNumber,t),this.lastSummaryTimestamp=e.timestamp,this.emit(b.Summarize,e)}},{key:"handleSummaryAck",value:function(e){var t=e.contents.summaryProposal.summarySequenceNumber,n=this.pendingSummaries.get(t);n&&void 0!==n.summaryOp?(n.ackNack(e),this.pendingSummaries.delete(t),(!this.lastAck||t>this.lastAck.summaryAck.contents.summaryProposal.summarySequenceNumber)&&(this.lastAck={summaryOp:n.summaryOp,summaryAck:e},this.refreshWaitNextAck.resolve(),this.refreshWaitNextAck=new V,this.emit(b.SummaryAck,e))):t>=this.deltaManager.initialSequenceNumber&&this.logger.sendErrorEvent({eventName:"SummaryAckWithoutOp",sequenceNumber:e.sequenceNumber,summarySequenceNumber:t,initialSequenceNumber:this.deltaManager.initialSequenceNumber})}},{key:"handleSummaryNack",value:function(e){var t=e.contents.summaryProposal.summarySequenceNumber,n=this.pendingSummaries.get(t);n&&(n.ackNack(e),this.pendingSummaries.delete(t),this.emit(b.SummaryNack,e))}}]),n}(T),Tt=function(e){(0,c.Z)(n,e);var t=(0,l.Z)(n);function n(e,i,o){var a;(0,h.Z)(this,n),(a=t.call(this)).clientMap=new Map,a.rootNode={sequenceNumber:-1,olderClient:void 0,youngerClient:void 0},a._youngestClient=a.rootNode,a.logger=I.G2.create(e,"OrderedClientCollection");var s,u=o.getMembers(),c=(0,d.Z)(u);try{for(c.s();!(s=c.n()).done;){var l=(0,r.Z)(s.value,2),f=l[0],p=l[1];a.addClient(f,p)}}catch(v){c.e(v)}finally{c.f()}return o.on("addMember",(function(e,t){var n=a.addClient(e,t);a.emit("addClient",n,i.lastSequenceNumber)})),o.on("removeMember",(function(e){var t=i.lastSequenceNumber,n=a.removeClient(e);void 0===n?a.logger.sendErrorEvent({eventName:"ClientNotFound",clientId:e,sequenceNumber:t}):a.emit("removeClient",n,t)})),a}return(0,f.Z)(n,[{key:"count",get:function(){return this.clientMap.size}},{key:"oldestClient",get:function(){return this.rootNode.youngerClient}},{key:"addClient",value:function(e,t){g(t.sequenceNumber>-1,502);for(var n=this._youngestClient;n.sequenceNumber>t.sequenceNumber;)g(void 0!==n.olderClient,503),n=n.olderClient;var r={clientId:e,sequenceNumber:t.sequenceNumber,client:Object.assign({},t.client),olderClient:n,youngerClient:n.youngerClient};return r.olderClient.youngerClient=r,void 0===r.youngerClient?this._youngestClient=r:r.youngerClient.olderClient=r,this.clientMap.set(e,r),r}},{key:"removeClient",value:function(e){var t=this.clientMap.get(e);if(void 0!==t)return t.olderClient.youngerClient=t.youngerClient,void 0===t.youngerClient?this._youngestClient=t.olderClient:t.youngerClient.olderClient=t.olderClient,this.clientMap.delete(e),t}},{key:"getAllClients",value:function(){for(var e=[],t=this.rootNode;void 0!==t.youngerClient;)e.push(t.youngerClient),t=t.youngerClient;return e}}]),n}(T),It=function(e){(0,c.Z)(n,e);var t=(0,l.Z)(n);function n(e,r,i,o){var a,s,u;(0,h.Z)(this,n),(a=t.call(this)).orderedClientCollection=r,a.isEligibleFn=o,a._eligibleCount=0;var c,l=(0,d.Z)(r.getAllClients());try{for(l.s();!(c=l.n()).done;){var f=c.value;a.addClient(f,0),"number"!==typeof i&&(f.clientId===i.electedClientId&&(s=f,void 0===i.electedParentId&&f.client.details.type!==Q&&(u=f)),f.clientId===i.electedParentId&&(u=f))}}catch(p){l.e(p)}finally{l.f()}return r.on("addClient",(function(e,t){return a.addClient(e,t)})),r.on("removeClient",(function(e,t){return a.removeClient(e,t)})),"number"===typeof i?a._electionSequenceNumber=i:((null===s||void 0===s?void 0:s.clientId)!==i.electedClientId?e.sendErrorEvent({eventName:"InitialElectedClientNotFound",electionSequenceNumber:i.electionSequenceNumber,expectedClientId:i.electedClientId,electedClientId:null===s||void 0===s?void 0:s.clientId,clientCount:r.count}):void 0===s||o(s)||(s=u=a.findFirstEligibleParent(u),e.sendErrorEvent({eventName:"InitialElectedClientIneligible",electionSequenceNumber:i.electionSequenceNumber,expectedClientId:i.electedClientId,electedClientId:null===s||void 0===s?void 0:s.clientId})),a._electedParent=u,a._electedClient=s,a._electionSequenceNumber=i.electionSequenceNumber),a}return(0,f.Z)(n,[{key:"eligibleCount",get:function(){return this._eligibleCount}},{key:"electionSequenceNumber",get:function(){return this._electionSequenceNumber}},{key:"electedClient",get:function(){return this._electedClient}},{key:"electedParent",get:function(){return this._electedParent}},{key:"tryElectingClient",value:function(e,t){var n=!1,r=(null===e||void 0===e?void 0:e.client.details.type)===Q,i=this._electedClient;this._electedClient!==e&&(this._electionSequenceNumber=t,this._electedClient=e,n=!0),this._electedParent===e||r||(this._electedParent=e,n=!0),n&&this.emit("election",e,t,i)}},{key:"tryElectingParent",value:function(e,t){this._electedParent!==e&&(this._electedParent=e,this.emit("election",this._electedClient,t,this._electedClient))}},{key:"findFirstEligibleParent",value:function(e){for(var t=e;void 0!==t&&(!this.isEligibleFn(t)||t.client.details.type===Q);)t=t.youngerClient;return t}},{key:"addClient",value:function(e,t){var n;if(this.isEligibleFn(e)){this._eligibleCount++;var r=e.client.details.type===Q,i=(null===(n=this._electedClient)||void 0===n?void 0:n.client.details.type)===Q;void 0===this._electedClient||!i&&r?this.tryElectingClient(e,t):void 0!==this._electedParent||r||this.tryElectingParent(e,t)}}},{key:"removeClient",value:function(e,t){var n,r,i,o,a;if(this.isEligibleFn(e))if(this._eligibleCount--,this._electedClient===e)if(this._electedParent!==e){if(this._electedClient.client.details.type!==Q)throw new O.Oi("Elected client should be a summarizer client 1");this.tryElectingClient(this._electedParent,t)}else{var s=null!==(r=this.findFirstEligibleParent(null===(n=this._electedParent)||void 0===n?void 0:n.youngerClient))&&void 0!==r?r:this.findFirstEligibleParent(this.orderedClientCollection.oldestClient);this.tryElectingClient(s,t)}else if(this._electedParent===e){if((null===(i=this._electedClient)||void 0===i?void 0:i.client.details.type)!==Q)throw new O.Oi("Elected client should be a summarizer client 2");var u=null!==(a=this.findFirstEligibleParent(null===(o=this._electedParent)||void 0===o?void 0:o.youngerClient))&&void 0!==a?a:this.findFirstEligibleParent(this.orderedClientCollection.oldestClient);this.tryElectingParent(u,t)}}},{key:"getAllEligibleClients",value:function(){return this.orderedClientCollection.getAllClients().filter(this.isEligibleFn)}},{key:"incrementElectedClient",value:function(e){var t,n,r=null!==(n=this.findFirstEligibleParent(null===(t=this._electedParent)||void 0===t?void 0:t.youngerClient))&&void 0!==n?n:this.findFirstEligibleParent(this.orderedClientCollection.oldestClient);void 0===this._electedClient||this._electedClient===this._electedParent?this.tryElectingClient(r,e):this.tryElectingParent(r,e)}},{key:"resetElectedClient",value:function(e){var t=this.findFirstEligibleParent(this.orderedClientCollection.oldestClient);void 0===this._electedClient||this._electedClient===this._electedParent?this.tryElectingClient(t,e):this.tryElectingParent(t,e)}},{key:"peekNextElectedClient",value:function(){var e,t;return null!==(t=this.findFirstEligibleParent(null===(e=this._electedParent)||void 0===e?void 0:e.youngerClient))&&void 0!==t?t:this.findFirstEligibleParent(this.orderedClientCollection.oldestClient)}},{key:"serialize",value:function(){var e,t;return{electionSequenceNumber:this.electionSequenceNumber,electedClientId:null===(e=this.electedClient)||void 0===e?void 0:e.clientId,electedParentId:null===(t=this.electedParent)||void 0===t?void 0:t.clientId}}}]),n}(T),At=function(){function e(t,n,r){(0,h.Z)(this,e),this.delayWindowMs=t,this.maxDelayMs=n,this.delayFn=r,this.startTimes=[]}return(0,f.Z)(e,[{key:"numAttempts",get:function(){return this.startTimes.length}},{key:"getAttempts",value:function(){return(0,o.Z)(this.startTimes)}},{key:"latestAttemptTime",get:function(){return this.startTimes.length>0?this.startTimes[this.startTimes.length-1]:void 0}},{key:"getDelay",value:function(){var e=this,t=Date.now(),n=this.latestAttemptTime;if(void 0!==n){var r=n-t;r>0&&(this.startTimes=this.startTimes.map((function(e){return e-r})))}this.startTimes=this.startTimes.filter((function(n){return t-n<e.delayWindowMs}));var i=Math.min(this.delayFn(this.startTimes.length),this.maxDelayMs);return this.startTimes.push(t),this.startTimes=this.startTimes.map((function(e){return e+i})),i===this.maxDelayMs&&this.startTimes.shift(),i}}]),e}(),Rt=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.multiplier,n=void 0===t?2:t,r=e.coefficient,i=void 0===r?1:r,o=e.offset,a=void 0===o?0:o,s=e.initialDelay,u=void 0===s?void 0:s;return function(e){return Math.max(0,e<=0&&void 0!==u?u:i*Math.pow(n,e)+a)}},_t=(new Promise((function(){})),function(){function e(t){(0,h.Z)(this,e),this.runtime=t,this._cancelled=!1,this.stopDeferred=new V}return(0,f.Z)(e,[{key:"cancelled",get:function(){return this._cancelled||g(this.runtime.deltaManager.active,605),this._cancelled}},{key:"waitCancelled",get:function(){return this.stopDeferred.promise}},{key:"waitStart",value:function(){var e=(0,s.Z)((0,a.Z)().mark((function e(){var t,n=this;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.runtime.disposed){e.next=3;break}return this.stop("summarizerClientDisconnected"),e.abrupt("return");case 3:if(this.runtime.once("dispose",(function(){return n.stop("summarizerClientDisconnected")})),this.runtime.connected){e.next=8;break}return t=new Promise((function(e){return n.runtime.once("connected",e)})),e.next=8,Promise.race([t,this.waitCancelled]);case 8:this.runtime.once("disconnected",(function(){return n.stop("summarizerClientDisconnected")}));case 9:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"stop",value:function(e){this._cancelled||(this._cancelled=!0,this.stopDeferred.resolve(e))}}],[{key:"create",value:function(){var t=(0,s.Z)((0,a.Z)().mark((function t(n){var r;return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=new e(n),t.next=3,r.waitStart();case 3:return t.abrupt("return",r);case 4:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()}]),e}()),Pt=(0,f.Z)((function e(t,n,r,i){var o=this,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:function(){return m.now()};(0,h.Z)(this,e),this.batchEventEmitter=t,this.trackedBatchCount=0,this.logger=I.G2.create(n,"Batching"),this.batchEventEmitter.on("batchBegin",(function(e){o.startBatchSequenceNumber=e.sequenceNumber,o.batchProcessingStartTimeStamp=a(),o.trackedBatchCount++})),this.batchEventEmitter.on("batchEnd",(function(e,t){g(void 0!==o.startBatchSequenceNumber&&void 0!==o.batchProcessingStartTimeStamp,698);var n=t.sequenceNumber-o.startBatchSequenceNumber+1;n>=r&&o.logger.sendErrorEvent({eventName:"LengthTooBig",length:n,threshold:r,batchEndSequenceNumber:t.sequenceNumber,duration:a()-o.batchProcessingStartTimeStamp,batchError:void 0!==e}),o.trackedBatchCount%i===0&&o.logger.sendPerformanceEvent({eventName:"Length",length:n,samplingRate:i,batchEndSequenceNumber:t.sequenceNumber,duration:a()-o.batchProcessingStartTimeStamp}),o.startBatchSequenceNumber=void 0,o.batchProcessingStartTimeStamp=void 0}))})),Nt=n(28664),Ot=n(2009);var Mt=function(e,t){return Dt.from(e).toString(t)};function Ft(e){var t=e;return e instanceof ArrayBuffer||"object"===typeof t&&null!==t&&"number"===typeof t.byteLength&&"function"===typeof t.slice&&void 0===t.byteOffset&&void 0===t.buffer}var Zt,Dt=function(e){(0,c.Z)(n,e);var t=(0,l.Z)(n);function n(){return(0,h.Z)(this,n),t.apply(this,arguments)}return(0,f.Z)(n,[{key:"toString",value:function(e){return function(e,t){switch(t){case"base64":return Ot.fromByteArray(e);case"utf8":case"utf-8":case void 0:return(new TextDecoder).decode(e);default:throw new Error("invalid/unsupported encoding")}}(this,e)}}],[{key:"from",value:function(e,t,r){if("string"===typeof e)return n.fromString(e,t);if(null!==e&&"object"===typeof e&&Ft(e.buffer))return g(0===e.byteOffset,0),g(e.byteLength===e.buffer.byteLength,1),n.fromArrayBuffer(e.buffer,t,r);if(Ft(e))return n.fromArrayBuffer(e,t,r);throw new TypeError}},{key:"fromArrayBuffer",value:function(e,t,r){var i=null!==t&&void 0!==t?t:0,o=null!==r&&void 0!==r?r:e.byteLength-i;if(i<0||i>e.byteLength||o<0||o+i>e.byteLength)throw new RangeError;return new n(e,i,o)}},{key:"fromString",value:function(e,t){switch(t){case"base64":var r=this.sanitizeBase64(e);return new n(Ot.toByteArray(r).buffer);case"utf8":case"utf-8":case void 0:return new n((new TextEncoder).encode(e).buffer);default:throw new Error("invalid/unsupported encoding")}}},{key:"isBuffer",value:function(e){throw new Error("unimplemented")}},{key:"sanitizeBase64",value:function(e){var t=e;if((t=(t=t.split("=")[0]).replace(/[^\w+-/]/g,"")).length%4!==0){t+=["","===","==","="][t.length%4]}return t}}]),n}((0,Nt.Z)(Uint8Array)),Lt=function(){function e(t,n){(0,h.Z)(this,e),this.storageGetter=t,this.blobs=n}return(0,f.Z)(e,[{key:"storage",get:function(){return this._storage||(this._storage=this.storageGetter()),this._storage}},{key:"repositoryUrl",get:function(){return this.storage.repositoryUrl}},{key:"readBlob",value:function(){var e=(0,s.Z)((0,a.Z)().mark((function e(t){return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0===this.blobs[t]){e.next=2;break}return e.abrupt("return",(n=this.blobs[t],r="utf8",Dt.from(n,r).buffer));case 2:return e.abrupt("return",this.storage.readBlob(t));case 3:case"end":return e.stop()}var n,r}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getSnapshotTree",value:function(){var e=(0,s.Z)((0,a.Z)().mark((function e(t){return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.storage.getSnapshotTree(t));case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getVersions",value:function(){var e=(0,s.Z)((0,a.Z)().mark((function e(t,n){return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.storage.getVersions(t,n));case 1:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"createBlob",value:function(){var e=(0,s.Z)((0,a.Z)().mark((function e(t){return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.storage.createBlob(t));case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"uploadSummaryWithContext",value:function(){var e=(0,s.Z)((0,a.Z)().mark((function e(t,n){return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.storage.uploadSummaryWithContext(t,n));case 1:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"downloadSummary",value:function(){var e=(0,s.Z)((0,a.Z)().mark((function e(t){return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.storage.downloadSummary(t));case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}],[{key:"serializeTree",value:function(){var e=(0,s.Z)((0,a.Z)().mark((function e(t,n){var r;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r={},e.next=3,this.serializeTreeCore(t,r,n);case 3:return e.abrupt("return",r);case 4:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"serializeTreeCore",value:function(){var e=(0,s.Z)((0,a.Z)().mark((function e(t,n,r){var i,o,s,u,c,l,d,h;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(i=[],o=0,s=Object.values(t.trees);o<s.length;o++)u=s[o],i.push(this.serializeTreeCore(u,n,r));c=0,l=Object.values(t.blobs);case 3:if(!(c<l.length)){e.next=12;break}return d=l[c],e.next=7,r.readBlob(d);case 7:h=e.sent,n[d]=Mt(h,"utf8");case 9:c++,e.next=3;break;case 12:return e.abrupt("return",Promise.all(i));case 13:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"serializeTreeWithBlobContents",value:function(e){var t={};return this.serializeTreeWithBlobContentsCore(e,t),t}},{key:"serializeTreeWithBlobContentsCore",value:function(e,t){for(var n=0,r=Object.values(e.trees);n<r.length;n++){var i=r[n];this.serializeTreeWithBlobContentsCore(i,t)}for(var o=0,a=Object.values(e.blobs);o<a.length;o++){var s=a[o],u=e.blobsContents[s];g(!!u,748),t[s]=Mt(u,"utf8")}}}]),e}(),Bt=function(){function e(t,n){var r=this;(0,h.Z)(this,e),this.messageSize=new Map,this._nonSystemOpCount=0,this._opsSizeAccumulator=0,n||(t.inbound.on("push",(function(t){var n,i="string"===typeof t.contents?t.contents:null!==(n=JSON.stringify(t.contents))&&void 0!==n?n:"",o=e.messageHasData(t)?t.data:"";r.messageSize[e.messageId(t)]=i.length+o.length})),t.on("op",(function(t){var n;r._nonSystemOpCount+=(0,P.LW)(t)?1:0;var i=e.messageId(t);r._opsSizeAccumulator+=null!==(n=r.messageSize[i])&&void 0!==n?n:0,r.messageSize.delete(i)})))}return(0,f.Z)(e,[{key:"nonSystemOpCount",get:function(){return this._nonSystemOpCount}},{key:"opsSizeAccumulator",get:function(){return this._opsSizeAccumulator}},{key:"reset",value:function(){this._nonSystemOpCount=0,this._opsSizeAccumulator=0}}],[{key:"messageId",value:function(e){return e.sequenceNumber}},{key:"messageHasData",value:function(e){return void 0!==e.data}}]),e}();!function(e){e.FluidDataStoreOp="component",e.Attach="attach",e.ChunkedOp="chunkedOp",e.BlobAttach="blobAttach",e.Rejoin="rejoin",e.Alias="alias"}(Zt||(Zt={}));var qt,jt={state:"enabled",idleTime:15e3,maxTime:6e4,maxOps:100,minOpsForLastSummaryAttempt:10,maxAckWaitTime:6e4,maxOpsSinceLastSummary:7e3,initialSummarizerDelayMs:5e3,summarizerClientElection:!1};!function(e){e.wait="wait",e.externalRequest="externalRequest",e.viaHandle="viaHandle"}(qt||(qt={}));var Ut,Ht=M.FlushMode.TurnBased;!function(e){e.FluidDataStoreOp="component",e.Attach="attach",e.ChunkedOp="chunkedOp",e.BlobAttach="blobAttach",e.Rejoin="rejoin",e.Alias="alias",e.Operation="op"}(Ut||(Ut={}));var zt=function(){function e(t,n){var r=this;(0,h.Z)(this,e),this.deltaManager=t,this.logger=n,this.localPaused=!1,this.timePaused=0,this.batchCount=0,this.deltaManager.on("prepareSend",(function(e){if(0!==e.length){var t=e[0].metadata;if(null===t||void 0===t?void 0:t.batch)if(1!==e.length){var n=e[e.length-1];n.metadata=Object.assign(Object.assign({},n.metadata),{batch:!1})}else delete t.batch}})),this.deltaManager.inbound.on("push",(function(e){r.trackPending(e)})),g(!this.localPaused,659);var i,o=this.deltaManager.inbound.toArray(),a=(0,d.Z)(o);try{for(a.s();!(i=a.n()).done;){var s=i.value;this.trackPending(s)}}catch(u){a.e(u)}finally{a.f()}this.deltaManager.on("op",(function(e){return r.afterOpProcessing(e.sequenceNumber)}))}return(0,f.Z)(e,[{key:"afterOpProcessing",value:function(e){g(!this.localPaused,660),0!==this.deltaManager.inbound.length?void 0!==this.pauseSequenceNumber&&(g(e<this.pauseSequenceNumber,662),e+1===this.pauseSequenceNumber&&this.pauseQueue()):g(void 0===this.pauseSequenceNumber,661)}},{key:"pauseQueue",value:function(){g(!this.localPaused,663),this.localPaused=!0,this.timePaused=m.now(),this.deltaManager.inbound.pause()}},{key:"resumeQueue",value:function(e,t){var n=t.sequenceNumber,r=this.localPaused?m.now()-this.timePaused:void 0;this.batchCount++,this.batchCount%1e3===1&&this.logger.sendTelemetryEvent({eventName:"BatchStats",sequenceNumber:n,length:n-e+1,msnDistance:n-t.minimumSequenceNumber,duration:r,batchCount:this.batchCount,interrupted:this.localPaused}),this.localPaused&&(this.localPaused=!1,void 0!==r&&r>5e3&&this.logger.sendErrorEvent({eventName:"MaxBatchWaitTimeExceeded",duration:r,sequenceNumber:n,length:n-e}),this.deltaManager.inbound.resume())}},{key:"trackPending",value:function(e){g(0!==this.deltaManager.inbound.length,664),g(void 0===this.currentBatchClientId===(void 0===this.pauseSequenceNumber),665);var t=e.metadata,n=null===t||void 0===t?void 0:t.batch;if(!(0,P._V)(e))return g(void 0===this.currentBatchClientId,666),g(void 0===n,667),void g(!this.localPaused,668);if(void 0!==this.currentBatchClientId||void 0!==n){if((void 0!==this.currentBatchClientId||!1===n)&&this.currentBatchClientId!==e.clientId)throw new O.Jd("OpBatchIncomplete",Object.assign({runtimeVersion:xe,batchClientId:this.currentBatchClientId},(0,O.HN)(e)));n?(g(void 0===this.currentBatchClientId,670),g(!this.localPaused,671),this.pauseSequenceNumber=e.sequenceNumber,this.currentBatchClientId=e.clientId,1===this.deltaManager.inbound.length&&this.pauseQueue()):!1===n?(g(void 0!==this.pauseSequenceNumber,672),this.resumeQueue(this.pauseSequenceNumber,e),this.pauseSequenceNumber=void 0,this.currentBatchClientId=void 0):g(void 0!==this.currentBatchClientId,673)}else g(!this.localPaused,669)}}]),e}(),Vt=function(){function e(t,n,r){(0,h.Z)(this,e),this.deltaManager=t,this.emitter=n,this.logger=r,this.hitError=!1,this.deltaScheduler=new ye(this.deltaManager,I.G2.create(this.logger,"DeltaScheduler")),new zt(t,r)}return(0,f.Z)(e,[{key:"beforeOpProcessing",value:function(e){var t;if(this.batchClientId!==e.clientId){g(void 0===this.batchClientId,674),this.emitter.emit("batchBegin",e),this.deltaScheduler.batchBegin(e);var n=null===(t=null===e||void 0===e?void 0:e.metadata)||void 0===t?void 0:t.batch;this.batchClientId=n?e.clientId:void 0}}},{key:"afterOpProcessing",value:function(e,t){var n;if(g(!this.hitError,675),e)return this.hitError=!0,this.batchClientId=void 0,this.emitter.emit("batchEnd",e,t),void this.deltaScheduler.batchEnd(t);var r=null===(n=null===t||void 0===t?void 0:t.metadata)||void 0===n?void 0:n.batch;return void 0===this.batchClientId||!1===r?(this.batchClientId=void 0,this.emitter.emit("batchEnd",void 0,t),void this.deltaScheduler.batchEnd(t)):void 0}}]),e}(),Gt="_scheduler";var Kt=function(e){(0,c.Z)(n,e);var t=(0,l.Z)(n);function n(e,r,i,o,c,l,d,f,v,m,y,w,S,k){var C,x,E,T,R,_,P,M,Z,D;(0,h.Z)(this,n),void 0===k&&(k=Object.assign(Object.assign({},jt),null===(x=d.summaryOptions)||void 0===x?void 0:x.summaryConfigOverrides)),(C=t.call(this)).context=e,C.registry=r,C.runtimeOptions=d,C.containerScope=f,C.logger=v,C._storage=w,C.requestHandler=S,C.summaryConfiguration=k,C.defaultMaxConsecutiveReconnects=15,C._orderSequentiallyCalls=0,C.needsFlush=!1,C.flushTrigger=!1,C.savedOps=[],C.consecutiveReconnects=0,C._disposed=!1,C.emitDirtyDocumentEvent=!0,C.defaultTelemetrySignalSampleCount=100,C._perfSignalData={signalsLost:0,signalSequenceNumber:0,signalTimestamp:0,trackingSignalSequenceNumber:void 0},C.summarizeOnDemand=function(){var e,t;if(C.clientDetails.type===Q)return(e=C.summarizer).summarizeOnDemand.apply(e,arguments);if(void 0!==C.summaryManager)return(t=C.summaryManager).summarizeOnDemand.apply(t,arguments);throw new O.Oi("Can't summarize, disableSummaries: ".concat(C.summariesDisabled))},C.enqueueSummarize=function(){var e,t;if(C.clientDetails.type===Q)return(e=C.summarizer).enqueueSummarize.apply(e,arguments);if(void 0!==C.summaryManager)return(t=C.summaryManager).enqueueSummarize.apply(t,arguments);throw new O.Oi("Can't summarize, disableSummaries: ".concat(C.summariesDisabled))},C.messageAtLastSummary=null===i||void 0===i?void 0:i.message,C.disableIsolatedChannels=null!==(E=C.runtimeOptions.summaryOptions.disableIsolatedChannels)&&void 0!==E&&E,C._connected=C.context.connected,C.chunkMap=new Map(c),C.handleContext=new H("",(0,u.Z)(C)),C.mc=(0,A.rZ)(I.G2.create(C.logger,"ContainerRuntime")),C.summariesDisabled=C.isSummariesDisabled(),C.heuristicsDisabled=C.isHeuristicsDisabled(),C.summarizerClientElectionEnabled=C.isSummarizerClientElectionEnabled(),C.maxOpsSinceLastSummary=C.getMaxOpsSinceLastSummary(),C.initialSummarizerDelayMs=C.getInitialSummarizerDelayMs(),C._aliasingEnabled=null!==(T=C.mc.config.getBoolean("Fluid.ContainerRuntime.UseDataStoreAliasing"))&&void 0!==T&&T||null!==(R=d.useDataStoreAliasing)&&void 0!==R&&R,C._maxOpSizeInBytes=null!==(_=C.mc.config.getNumber("Fluid.ContainerRuntime.MaxOpSizeInBytes"))&&void 0!==_?_:768e3,C.maxConsecutiveReconnects=null!==(P=C.mc.config.getNumber("Fluid.ContainerRuntime.MaxConsecutiveReconnects"))&&void 0!==P?P:C.defaultMaxConsecutiveReconnects,C._flushMode=d.flushMode;var L=e.pendingLocalState,B=null!==(M=null===L||void 0===L?void 0:L.baseSnapshot)&&void 0!==M?M:e.baseSnapshot;C.garbageCollector=Ve.create({runtime:(0,u.Z)(C),gcOptions:C.runtimeOptions.gcOptions,baseSnapshot:B,baseLogger:C.mc.logger,existing:m,metadata:i,isSummarizerClient:C.context.clientDetails.type===Q,getNodePackagePath:function(){var e=(0,s.Z)((0,a.Z)().mark((function e(t){return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",C.getGCNodePackagePath(t));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),getLastSummaryTimestampMs:function(){var e;return null===(e=C.messageAtLastSummary)||void 0===e?void 0:e.timestamp},readAndParseBlob:function(){var e=(0,s.Z)((0,a.Z)().mark((function e(t){return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,N.g)(C.storage,t));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()});var q,j=C.deltaManager.initialSequenceNumber;if(C.summarizerNode=(0,F.G)(I.G2.create(C.logger,"SummarizerNode"),function(){var e=(0,s.Z)((0,a.Z)().mark((function e(t,n,r){return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",C.summarizeInternal(t,n,r));case 1:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}(),j,B?j:void 0,{canReuseHandle:!1,throwOnFailure:!0,gcDisabled:!C.garbageCollector.shouldRunGC}),B&&C.summarizerNode.loadBaseSummaryWithoutDifferential(B),C.dataStores=new St(kt(B,i),(0,u.Z)(C),(function(e){return C.submit(Zt.Attach,e)}),(function(e,t){return function(n,r,i){return C.summarizerNode.createChild(n,e,t,void 0,r,i)}}),(function(e){return C.summarizerNode.deleteChild(e)}),C.mc.logger,(0,s.Z)((0,a.Z)().mark((function e(){return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",C.garbageCollector.getBaseGCDetails());case 1:case"end":return e.stop()}}),e)}))),(function(e,t,n){return C.garbageCollector.nodeUpdated(e,"Changed",t,n)}),new Map(l),C.garbageCollector.writeDataAtRoot),C.blobManager=new Te(C.handleContext,y,(function(){return C.storage}),(function(e){return C.submit(Zt.BlobAttach,void 0,void 0,{blobId:e})}),(function(e){return C.garbageCollector.nodeUpdated(e,"Loaded")}),(0,u.Z)(C),C.logger),C.scheduleManager=new Vt(e.deltaManager,(0,u.Z)(C),I.G2.create(C.logger,"ScheduleManager")),C.deltaSender=C.deltaManager,C.pendingStateManager=new Ce({applyStashedOp:C.applyStashedOp.bind((0,u.Z)(C)),clientId:function(){return C.clientId},close:C.closeFn,connected:function(){return C.connected},flush:C.flush.bind((0,u.Z)(C)),flushMode:function(){return C.flushMode},reSubmit:C.reSubmit.bind((0,u.Z)(C)),rollback:C.rollback.bind((0,u.Z)(C)),setFlushMode:function(e){return C.setFlushMode(e)}},C._flushMode,null===L||void 0===L?void 0:L.pending),C.context.quorum.on("removeMember",(function(e){C.clearPartialChunks(e)})),C.summaryCollection=new Et(C.deltaManager,C.logger),C.dirtyContainer=C.context.attachState!==p.mB.Attached||C.pendingStateManager.hasPendingMessages(),C.context.updateDirtyContainerState(C.dirtyContainer),C.summariesDisabled)C.mc.logger.sendTelemetryEvent({eventName:"SummariesDisabled"});else{var U=I.G2.create(C.logger,"OrderedClientElection"),z=new Tt(U,C.context.deltaManager,C.context.quorum),V=new It(U,z,null!==o&&void 0!==o?o:C.context.deltaManager.lastSequenceNumber,Y.isClientEligible);if(C.summarizerClientElection=new Y(U,C.summaryCollection,V,C.maxOpsSinceLastSummary,C.summarizerClientElectionEnabled),C.context.clientDetails.type===Q)C._summarizer=new ge("/_summarizer",(0,u.Z)(C),(function(){return C.summaryConfiguration}),(0,u.Z)(C),C.handleContext,C.summaryCollection,function(){var e=(0,s.Z)((0,a.Z)().mark((function e(t){return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",_t.create(t));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());else if(Y.clientDetailsPermitElection(C.context.clientDetails)){C.summaryCollection.on("default",(function e(){C.summaryCollection.opsSinceLastAck>C.maxOpsSinceLastSummary&&(C.logger.sendErrorEvent({eventName:"SummaryStatus:Behind"}),C.summaryCollection.once(b.SummaryAck,(function(){C.logger.sendTelemetryEvent({eventName:"SummaryStatus:CaughtUp"}),C.summaryCollection.on("default",e)})),C.summaryCollection.off("default",e))})),C.summaryManager=new me(C.summarizerClientElection,(0,u.Z)(C),C.summaryCollection,C.logger,C.formRequestSummarizerFn(C.context.loader),new At(6e4,3e4,Rt({coefficient:20,initialDelay:0})),{initialDelayMs:C.initialSummarizerDelayMs},C.heuristicsDisabled),C.summaryManager.start()}}return C.deltaManager.on("readonly",(function(e){g(e===C.deltaManager.readOnlyInfo.readonly,292),g(!e||!C.connected,293),C.replayPendingStates()})),v.sendTelemetryEvent(Object.assign({eventName:"DeviceSpec"},function(){try{if("object"===typeof navigator&&null!==navigator)return{deviceMemory:navigator.deviceMemory,hardwareConcurrency:navigator.hardwareConcurrency}}catch(x){}return{}}())),m?(C.createContainerMetadata={createContainerRuntimeVersion:null===i||void 0===i?void 0:i.createContainerRuntimeVersion,createContainerTimestamp:null===i||void 0===i?void 0:i.createContainerTimestamp},q=null!==(D=null!==(Z=null===i||void 0===i?void 0:i.summaryNumber)&&void 0!==Z?Z:null===i||void 0===i?void 0:i.summaryCount)&&void 0!==D?D:0):(C.createContainerMetadata={createContainerRuntimeVersion:xe,createContainerTimestamp:Date.now()},q=0),C.nextSummaryNumber=q+1,C.logger.sendTelemetryEvent(Object.assign(Object.assign(Object.assign({eventName:"ContainerLoadStats"},C.createContainerMetadata),C.dataStores.containerLoadStats),{summaryNumber:q,summaryFormatVersion:null===i||void 0===i?void 0:i.summaryFormatVersion,disableIsolatedChannels:null===i||void 0===i?void 0:i.disableIsolatedChannels,gcVersion:null===i||void 0===i?void 0:i.gcFeature})),function(e,t,n){new be(e,t,n)}(C.context.clientId,C.deltaManager,C.logger),function(e,t){new Pt(e,t,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1e3,arguments.length>3&&void 0!==arguments[3]?arguments[3]:1e3)}((0,u.Z)(C),C.logger),C.opTracker=new Bt(C.deltaManager,!0===C.mc.config.getBoolean("Fluid.ContainerRuntime.DisableOpTracking")),C}return(0,f.Z)(n,[{key:"IContainerRuntime",get:function(){return this}},{key:"IFluidRouter",get:function(){return this}},{key:"options",get:function(){return this.context.options}},{key:"clientId",get:function(){return this.context.clientId}},{key:"clientDetails",get:function(){return this.context.clientDetails}},{key:"deltaManager",get:function(){return this.context.deltaManager}},{key:"storage",get:function(){return this._storage}},{key:"reSubmitFn",get:function(){return this.reSubmit}},{key:"closeFn",get:function(){return this.context.closeFn}},{key:"flushMode",get:function(){return this._flushMode}},{key:"scope",get:function(){return this.containerScope}},{key:"IFluidDataStoreRegistry",get:function(){return this.registry}},{key:"attachState",get:function(){return this.context.attachState}},{key:"IFluidHandleContext",get:function(){return this.handleContext}},{key:"connected",get:function(){return this._connected}},{key:"summarizerClientId",get:function(){var e;return null===(e=this.summarizerClientElection)||void 0===e?void 0:e.electedClientId}},{key:"disposed",get:function(){return this._disposed}},{key:"summarizer",get:function(){return g(void 0!==this._summarizer,599),this._summarizer}},{key:"isSummariesDisabled",value:function(){return!0===this.runtimeOptions.summaryOptions.disableSummaries||"disabled"===this.summaryConfiguration.state}},{key:"isHeuristicsDisabled",value:function(){var e;return!0===(null===(e=this.runtimeOptions.summaryOptions.summarizerOptions)||void 0===e?void 0:e.disableHeuristics)||"disableHeuristics"===this.summaryConfiguration.state}},{key:"isSummarizerClientElectionEnabled",value:function(){var e;return this.mc.config.getBoolean("Fluid.ContainerRuntime.summarizerClientElection")?null===(e=this.mc.config.getBoolean("Fluid.ContainerRuntime.summarizerClientElection"))||void 0===e||e:!0===this.runtimeOptions.summaryOptions.summarizerClientElection||"disabled"!==this.summaryConfiguration.state&&!0===this.summaryConfiguration.summarizerClientElection}},{key:"getMaxOpsSinceLastSummary",value:function(){return void 0!==this.runtimeOptions.summaryOptions.maxOpsSinceLastSummary?this.runtimeOptions.summaryOptions.maxOpsSinceLastSummary:"disabled"!==this.summaryConfiguration.state?this.summaryConfiguration.maxOpsSinceLastSummary:0}},{key:"getInitialSummarizerDelayMs",value:function(){return void 0!==this.runtimeOptions.summaryOptions.initialSummarizerDelayMs?this.runtimeOptions.summaryOptions.initialSummarizerDelayMs:"disabled"!==this.summaryConfiguration.state?this.summaryConfiguration.initialSummarizerDelayMs:0}},{key:"dispose",value:function(e){var t;this._disposed||(this._disposed=!0,this.logger.sendTelemetryEvent({eventName:"ContainerRuntimeDisposed",isDirty:this.isDirty,lastSequenceNumber:this.deltaManager.lastSequenceNumber,attachState:this.attachState},e),void 0!==this.summaryManager&&this.summaryManager.dispose(),this.garbageCollector.dispose(),null===(t=this._summarizer)||void 0===t||t.dispose(),this.dataStores.dispose(),this.pendingStateManager.dispose(),this.emit("dispose"),this.removeAllListeners())}},{key:"IFluidTokenProvider",get:function(){var e;if(null===(e=this.options)||void 0===e?void 0:e.intelligence)return{intelligence:this.options.intelligence}}},{key:"request",value:function(){var e=(0,s.Z)((0,a.Z)().mark((function e(t){var n;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,n=Z.R.create(t),"_summarizer"!==n.pathParts[0]||1!==n.pathParts.length){e.next=7;break}if(void 0===this._summarizer){e.next=6;break}return e.abrupt("return",{status:200,mimeType:"fluid/object",value:this.summarizer});case 6:case 9:return e.abrupt("return",(0,D.I4)(t));case 7:if(void 0===this.requestHandler){e.next=9;break}return e.abrupt("return",this.requestHandler(n,this));case 12:return e.prev=12,e.t0=e.catch(0),e.abrupt("return",(0,D.Nj)(e.t0));case 15:case"end":return e.stop()}}),e,this,[[0,12]])})));return function(t){return e.apply(this,arguments)}}()},{key:"resolveHandle",value:function(){var e=(0,s.Z)((0,a.Z)().mark((function e(t){var n,r,i,o,s;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,n=Z.R.create(t),"_channels"!==(r=n.pathParts[0])){e.next=5;break}return e.abrupt("return",this.resolveHandle(n.createSubRequest(1)));case 5:if(r!==Te.basePath||!n.isLeaf(2)){e.next=16;break}return e.next=8,this.blobManager.getBlob(n.pathParts[1]);case 8:if(!(i=e.sent)){e.next=13;break}return e.abrupt("return",{status:200,mimeType:"fluid/object",value:i.get()});case 13:case 23:return e.abrupt("return",(0,D.I4)(t));case 14:e.next=23;break;case 16:if(!(n.pathParts.length>0)){e.next=23;break}return e.next=19,this.getDataStoreFromRequest(r,t);case 19:return o=e.sent,g((s=n.createSubRequest(1)).url.startsWith("/"),294),e.abrupt("return",o.IFluidRouter.request(s));case 26:return e.prev=26,e.t0=e.catch(0),e.abrupt("return",(0,D.Nj)(e.t0));case 29:case"end":return e.stop()}}),e,this,[[0,26]])})));return function(t){return e.apply(this,arguments)}}()},{key:"internalId",value:function(e){var t;return null!==(t=this.dataStores.aliases().get(e))&&void 0!==t?t:e}},{key:"getDataStoreFromRequest",value:function(){var e=(0,s.Z)((0,a.Z)().mark((function e(t,n){var r,i,o,s,u,c,l,d,h;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s="boolean"!==typeof(null===(r=n.headers)||void 0===r?void 0:r[qt.wait])||(null===(i=n.headers)||void 0===i?void 0:i[qt.wait]),u=this.internalId(t),e.next=4,this.dataStores.getDataStore(u,s);case 4:if(c=e.sent,!(null===(o=n.headers)||void 0===o?void 0:o[qt.externalRequest])||!this.garbageCollector.shouldRunGC){e.next=11;break}return e.next=8,c.getBaseGCDetails();case 8:if(void 0===(l=e.sent.usedRoutes)||l.includes("")||l.includes("/")){e.next=11;break}throw(0,D.fu)((0,D.I4)(n),n);case 11:return e.next=13,c.realize();case 13:return d=e.sent,h=(0,q.aG)(n.url.split("?")[0]),this.garbageCollector.nodeUpdated("/".concat(h),"Loaded",void 0,c.packagePath,null===n||void 0===n?void 0:n.headers),e.abrupt("return",d);case 17:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"addMetadataToSummary",value:function(e){var t,n,r=Object.assign(Object.assign(Object.assign(Object.assign({},this.createContainerMetadata),{summaryCount:this.nextSummaryNumber,summaryNumber:this.nextSummaryNumber++,summaryFormatVersion:1,disableIsolatedChannels:this.disableIsolatedChannels||void 0}),this.garbageCollector.getMetadata()),{message:null!==(n=this.deltaManager.lastMessage,t=void 0===n?void 0:{clientId:n.clientId,clientSequenceNumber:n.clientSequenceNumber,minimumSequenceNumber:n.minimumSequenceNumber,referenceSequenceNumber:n.referenceSequenceNumber,sequenceNumber:n.sequenceNumber,timestamp:n.timestamp,type:n.type})&&void 0!==t?t:this.messageAtLastSummary});(0,L.Rt)(e,$e,JSON.stringify(r))}},{key:"addContainerStateToSummary",value:function(e,t,n,r){var i;if(this.addMetadataToSummary(e),this.chunkMap.size>0){var a=JSON.stringify((0,o.Z)(this.chunkMap));(0,L.Rt)(e,et,a)}var s=this.dataStores.aliases();if(s.size>0&&(0,L.Rt)(e,Xe,JSON.stringify((0,o.Z)(s))),this.summarizerClientElection){var u=JSON.stringify(null===(i=this.summarizerClientElection)||void 0===i?void 0:i.serialize());(0,L.Rt)(e,tt,u)}var c=this.blobManager.summarize();if(Object.keys(c.summary.tree).length>0&&(0,L.Jv)(e,nt,c),this.garbageCollector.writeDataAtRoot){var l=this.garbageCollector.summarize(t,n,r);void 0!==l&&(0,L.QA)(e,Me,l)}}},{key:"shouldContinueReconnecting",value:function(){return this.maxConsecutiveReconnects<=0||(this.pendingStateManager.hasPendingMessages()?(this.consecutiveReconnects===Math.floor(this.maxConsecutiveReconnects/2)&&this.mc.logger.sendTelemetryEvent({eventName:"ReconnectsWithNoProgress",attempts:this.consecutiveReconnects,pendingMessages:this.pendingStateManager.pendingMessagesCount}),this.consecutiveReconnects<this.maxConsecutiveReconnects):(this.resetReconnectCount(),!0))}},{key:"resetReconnectCount",value:function(){this.consecutiveReconnects=0}},{key:"replayPendingStates",value:function(){if(this.canSendOps()){var e,t=this.dirtyContainer;this.dirtyContainer=!1,g(this.emitDirtyDocumentEvent,295),this.emitDirtyDocumentEvent=!1;try{this.pendingStateManager.replayPendingStates()}finally{e=this.dirtyContainer,this.dirtyContainer=t,this.emitDirtyDocumentEvent=!0}this.updateDocumentDirtyState(e)}}},{key:"applyStashedOp",value:function(){var e=(0,s.Z)((0,a.Z)().mark((function e(t,n){return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:e.t0=t,e.next=e.t0===Zt.FluidDataStoreOp?3:e.t0===Zt.Attach?4:e.t0===Zt.Alias||e.t0===Zt.BlobAttach?5:e.t0===Zt.ChunkedOp?6:e.t0===Zt.Rejoin?7:8;break;case 3:return e.abrupt("return",this.dataStores.applyStashedOp(n));case 4:return e.abrupt("return",this.dataStores.applyStashedAttachOp(n));case 5:return e.abrupt("return");case 6:throw new Error("chunkedOp not expected here");case 7:throw new Error("rejoin not expected here");case 8:y(t,"Unknown ContainerMessageType: ".concat(t));case 9:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"setConnectionState",value:function(e,t){this.verifyNotClosed();var n=this._connected!==e,r=n&&e;this._connected=e,e||(this._perfSignalData.signalsLost=0,this._perfSignalData.signalTimestamp=0,this._perfSignalData.trackingSignalSequenceNumber=void 0),!r||(this.consecutiveReconnects++,this.shouldContinueReconnecting())?(n&&this.replayPendingStates(),this.dataStores.setConnectionState(e,t),(0,R.Qq)(this.mc.logger,this,e,t)):this.closeFn(O.Hi.create("Runtime detected too many reconnects with no progress syncing local ops","setConnectionState",void 0,{dataLoss:1,attempts:this.consecutiveReconnects,pendingMessages:this.pendingStateManager.pendingMessagesCount}))}},{key:"process",value:function(e,t){var n,r;if(this.verifyNotClosed(),(0,P._V)(e)){(null!==(n=this.mc.config.getBoolean("enableOfflineLoad"))&&void 0!==n?n:this.runtimeOptions.enableOfflineLoad)&&this.savedOps.push(e);var i=Object.assign({},e);this.scheduleManager.beforeOpProcessing(i);try{var o;switch(i=function(e){if(e.type===b.Operation){if(void 0!==e.contents.address&&void 0===e.contents.type)e.type=Zt.FluidDataStoreOp;else{var t=e.contents;g(void 0!==t.type,289),e.type=t.type,e.contents=t.contents}g((0,P._V)(e),290)}return e}(i),i=this.processRemoteChunkedMessage(i),t&&i.type!==Zt.ChunkedOp&&(o=this.pendingStateManager.processPendingLocalMessage(i)),this.pendingStateManager.hasPendingMessages()||this.updateDocumentDirtyState(!1),i.type){case Zt.Attach:this.dataStores.processAttachMessage(i,t);break;case Zt.Alias:this.processAliasMessage(i,o,t);break;case Zt.FluidDataStoreOp:this.dataStores.processFluidDataStoreOp(i,t,o);break;case Zt.BlobAttach:g(null===(r=null===i||void 0===i?void 0:i.metadata)||void 0===r?void 0:r.blobId,298),this.blobManager.processBlobAttachOp(i.metadata.blobId,t)}this.emit("op",i),this.scheduleManager.afterOpProcessing(void 0,i),t&&this.resetReconnectCount()}catch(a){throw this.scheduleManager.afterOpProcessing(a,i),a}}}},{key:"processAliasMessage",value:function(e,t,n){this.dataStores.processAliasMessage(e,t,n)}},{key:"sendSignalTelemetryEvent",value:function(e){var t=Date.now()-this._perfSignalData.signalTimestamp;this.logger.sendPerformanceEvent({eventName:"SignalLatency",duration:t,signalsLost:this._perfSignalData.signalsLost}),this._perfSignalData.signalsLost=0,this._perfSignalData.signalTimestamp=0}},{key:"processSignal",value:function(e,t){var n=e.content,r={clientId:e.clientId,content:n.contents.content,type:n.contents.type};e.clientId===this.clientId&&this.connected&&(void 0!==this._perfSignalData.trackingSignalSequenceNumber&&n.clientSignalSequenceNumber>this._perfSignalData.trackingSignalSequenceNumber?(this._perfSignalData.signalsLost++,this._perfSignalData.trackingSignalSequenceNumber=void 0,this.logger.sendErrorEvent({eventName:"SignalLost",type:n.contents.type,signalsLost:this._perfSignalData.signalsLost,trackingSequenceNumber:this._perfSignalData.trackingSignalSequenceNumber,clientSignalSequenceNumber:n.clientSignalSequenceNumber})):n.clientSignalSequenceNumber===this._perfSignalData.trackingSignalSequenceNumber&&(this.sendSignalTelemetryEvent(n.clientSignalSequenceNumber),this._perfSignalData.trackingSignalSequenceNumber=void 0)),void 0!==n.address?this.dataStores.processSignal(n.address,r,t):this.emit("signal",r,t)}},{key:"getRootDataStore",value:function(){var e=(0,s.Z)((0,a.Z)().mark((function e(t){var n,r,i,o=arguments;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=!(o.length>1&&void 0!==o[1])||o[1],r=this.internalId(t),e.next=4,this.dataStores.getDataStore(r,n);case 4:return i=e.sent,e.t0=g,e.next=8,i.isRoot();case 8:return e.t1=e.sent,(0,e.t0)(e.t1,299),e.abrupt("return",i.realize());case 11:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"setFlushMode",value:function(e){e!==this._flushMode&&(this.mc.logger.sendTelemetryEvent({eventName:"FlushMode Updated",old:this._flushMode,new:e}),e===M.FlushMode.Immediate&&this.flush(),this._flushMode=e,this.pendingStateManager.onFlushModeUpdated(e))}},{key:"flush",value:function(){if(g(0===this._orderSequentiallyCalls,588),this.deltaSender&&(this.pendingStateManager.onFlush(),this.needsFlush&&(this.needsFlush=!1,this.canSendOps())))return this.deltaSender.flush()}},{key:"orderSequentially",value:function(e){if(this.flushMode!==M.FlushMode.TurnBased){var t=this.flushMode;this.setFlushMode(M.FlushMode.TurnBased);try{this.trackOrderSequentiallyCalls(e),this.flush()}finally{this.setFlushMode(t)}}else this.trackOrderSequentiallyCalls(e)}},{key:"trackOrderSequentiallyCalls",value:function(e){var t;this.mc.config.getBoolean("Fluid.ContainerRuntime.EnableRollback")&&(t=this.pendingStateManager.checkpoint());try{this._orderSequentiallyCalls++,e()}catch(n){throw t?t.rollback():this.closeFn(new O.pY("orderSequentially callback exception",n)),n}finally{this._orderSequentiallyCalls--}}},{key:"createDataStore",value:function(){var e=(0,s.Z)((0,a.Z)().mark((function e(t){var n;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=(0,j.Z)(),e.t0=yt,e.next=4,this._createDataStore(t,!1,n);case 4:return e.t1=e.sent,e.t2=n,e.t3=this,e.t4=this.dataStores,e.t5=this.mc.logger,e.abrupt("return",(0,e.t0)(e.t1,e.t2,e.t3,e.t4,e.t5));case 10:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"createRootDataStoreLegacy",value:function(){var e=(0,s.Z)((0,a.Z)().mark((function e(t,n){var r;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._createDataStore(t,!0,n);case 2:return void 0!==(r=e.sent).makeVisibleAndAttachGraph?r.makeVisibleAndAttachGraph():r.bindToContext(),e.abrupt("return",r);case 5:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"createRootDataStore",value:function(){var e=(0,s.Z)((0,a.Z)().mark((function e(t,n){return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!n.includes("/")){e.next=2;break}throw new O.Oi("Id cannot contain slashes: '".concat(n,"'"));case 2:return e.abrupt("return",!0===this._aliasingEnabled?this.createAndAliasDataStore(t,n):this.createRootDataStoreLegacy(t,n));case 3:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"createAndAliasDataStore",value:function(){var e=(0,s.Z)((0,a.Z)().mark((function e(t,n,r){var i,o,s,u;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=(0,j.Z)(),e.next=3,this._createDataStore(t,!1,i,r);case 3:return o=e.sent,s=yt(o,i,this,this.dataStores,this.mc.logger),e.next=7,s.trySetAlias(n);case 7:if("Success"===(u=e.sent)){e.next=10;break}throw new O.pY("dataStoreAliasFailure",void 0,{alias:{value:n,tag:I.XI.UserData},internalId:{value:i,tag:I.XI.PackageData},aliasResult:u});case 10:return e.abrupt("return",s);case 11:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"createDetachedRootDataStore",value:function(e,t){if(t.includes("/"))throw new O.Oi("Id cannot contain slashes: '".concat(t,"'"));return this.dataStores.createDetachedDataStoreCore(e,!0,t)}},{key:"createDetachedDataStore",value:function(e){return this.dataStores.createDetachedDataStoreCore(e,!1)}},{key:"_createDataStoreWithPropsLegacy",value:function(){var e=(0,s.Z)((0,a.Z)().mark((function e(t,n){var r,i,o,s=arguments;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=s.length>2&&void 0!==s[2]?s[2]:(0,j.Z)(),i=s.length>3&&void 0!==s[3]&&s[3],e.next=4,this.dataStores._createFluidDataStoreContext(Array.isArray(t)?t:[t],r,i,n).realize();case 4:return o=e.sent,i&&(void 0!==o.makeVisibleAndAttachGraph?o.makeVisibleAndAttachGraph():o.bindToContext(),this.logger.sendTelemetryEvent({eventName:"Root datastore with props",hasProps:void 0!==n})),e.abrupt("return",yt(o,r,this,this.dataStores,this.mc.logger));case 7:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"_createDataStoreWithProps",value:function(){var e=(0,s.Z)((0,a.Z)().mark((function e(t,n){var r,i,o=arguments;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=o.length>2&&void 0!==o[2]?o[2]:(0,j.Z)(),i=o.length>3&&void 0!==o[3]&&o[3],e.abrupt("return",!0===this._aliasingEnabled&&i?this.createAndAliasDataStore(t,r,n):this._createDataStoreWithPropsLegacy(t,n,r,i));case 3:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"_createDataStore",value:function(){var e=(0,s.Z)((0,a.Z)().mark((function e(t,n){var r,i,o=arguments;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=o.length>2&&void 0!==o[2]?o[2]:(0,j.Z)(),i=o.length>3?o[3]:void 0,e.abrupt("return",this.dataStores._createFluidDataStoreContext(Array.isArray(t)?t:[t],r,n,i).realize());case 3:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"canSendOps",value:function(){return this.connected&&!this.deltaManager.readOnlyInfo.readonly}},{key:"getQuorum",value:function(){return this.context.quorum}},{key:"getAudience",value:function(){return this.context.audience}},{key:"isDirty",get:function(){return this.dirtyContainer}},{key:"isContainerMessageDirtyable",value:function(e,t){if(e===Zt.Attach){if(t.id===Gt)return!1}else if(e===Zt.FluidDataStoreOp){if(t.address===Gt)return!1}return!0}},{key:"createNewSignalEnvelope",value:function(e,t,n){var r=++this._perfSignalData.signalSequenceNumber,i={address:e,clientSignalSequenceNumber:r,contents:{type:t,content:n}};return r%this.defaultTelemetrySignalSampleCount===1&&void 0===this._perfSignalData.trackingSignalSequenceNumber&&(this._perfSignalData.signalTimestamp=Date.now(),this._perfSignalData.trackingSignalSequenceNumber=r),i}},{key:"submitSignal",value:function(e,t){this.verifyNotClosed();var n=this.createNewSignalEnvelope(void 0,e,t);return this.context.submitSignalFn(n)}},{key:"submitDataStoreSignal",value:function(e,t,n){var r=this.createNewSignalEnvelope(e,t,n);return this.context.submitSignalFn(r)}},{key:"setAttachState",value:function(e){e===p.mB.Attaching?g(this.attachState===p.mB.Attaching,301):(g(this.attachState===p.mB.Attached,302),this.emit("attached")),e!==p.mB.Attached||this.pendingStateManager.hasPendingMessages()||this.updateDocumentDirtyState(!1),this.dataStores.setAttachState(e)}},{key:"createSummary",value:function(e,t){e&&this.blobManager.setRedirectTable(e);var n=this.dataStores.createSummary(t);return this.disableIsolatedChannels||at(n),this.addContainerStateToSummary(n,!0,!1,t),n.summary}},{key:"getAbsoluteUrl",value:function(){var e=(0,s.Z)((0,a.Z)().mark((function e(t){return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0!==this.context.getAbsoluteUrl){e.next=2;break}throw new Error("Driver does not implement getAbsoluteUrl");case 2:if(this.attachState===p.mB.Attached){e.next=4;break}return e.abrupt("return",void 0);case 4:return e.abrupt("return",this.context.getAbsoluteUrl(t));case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"summarizeInternal",value:function(){var e=(0,s.Z)((0,a.Z)().mark((function e(t,n,r){var i,o;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.dataStores.summarize(t,n,r);case 2:return i=e.sent,this.disableIsolatedChannels||(at(i),o=[M.channelsTreeName]),this.addContainerStateToSummary(i,t,n,r),e.abrupt("return",Object.assign(Object.assign({},i),{id:"",pathPartsForChildren:o}));case 6:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"summarize",value:function(){var e=(0,s.Z)((0,a.Z)().mark((function e(t){var n,r,i,o,s,u,c,l,d,h,f,p,v,m,y;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.verifyNotClosed(),n=t.fullTree,r=void 0!==n&&n,i=t.trackState,o=void 0===i||i,s=t.summaryLogger,u=void 0===s?this.mc.logger:s,c=t.runGC,l=void 0===c?this.garbageCollector.shouldRunGC:c,d=t.runSweep,h=t.fullGC,!l){e.next=6;break}return e.next=5,this.collectGarbage({logger:u,runSweep:d,fullGC:h});case 5:f=e.sent;case 6:return p=new L.TA,e.next=9,this.summarizerNode.summarize(r,o,p);case 9:return v=e.sent,m=v.stats,y=v.summary,this.logger.sendTelemetryEvent({eventName:"SummarizeTelemetry",details:p.serialize()}),g(y.type===S.Tree,303),e.abrupt("return",{stats:m,summary:y,gcStats:f});case 15:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"updateStateBeforeGC",value:function(){var e=(0,s.Z)((0,a.Z)().mark((function e(){return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.dataStores.updateStateBeforeGC());case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getGCData",value:function(){var e=(0,s.Z)((0,a.Z)().mark((function e(t){var n,r,i;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=new q.iR,e.next=3,this.dataStores.getGCData(t);case 3:return r=e.sent,n.addNodes(r.gcNodes),i=this.blobManager.getGCData(t),n.addNodes(i.gcNodes),e.abrupt("return",n.getGCData());case 8:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"updateUsedRoutes",value:function(e,t){this.summarizerNode.updateUsedRoutes([""]);var n,r=[],i=(0,d.Z)(e);try{for(i.s();!(n=i.n()).done;){var o=n.value;o.split("/")[1]!==Te.basePath&&r.push(o)}}catch(a){i.e(a)}finally{i.f()}return this.dataStores.updateUsedRoutes(r,t)}},{key:"deleteUnusedRoutes",value:function(e){var t,n=[],r=[],i=(0,d.Z)(e);try{for(i.s();!(t=i.n()).done;){var o=t.value;this.isBlobPath(o)?n.push(o):r.push(o)}}catch(a){i.e(a)}finally{i.f()}this.blobManager.deleteUnusedRoutes(n),this.dataStores.deleteUnusedRoutes(r)}},{key:"getCurrentReferenceTimestampMs",value:function(){var e,t,n;return null!==(t=null===(e=this.deltaManager.lastMessage)||void 0===e?void 0:e.timestamp)&&void 0!==t?t:null===(n=this.messageAtLastSummary)||void 0===n?void 0:n.timestamp}},{key:"getNodeType",value:function(e){var t;return this.isBlobPath(e)?Be:null!==(t=this.dataStores.getGCNodeType(e))&&void 0!==t?t:qe}},{key:"getGCNodePackagePath",value:function(){var e=(0,s.Z)((0,a.Z)().mark((function e(t){return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:e.t0=this.getNodeType(t),e.next=e.t0===Be?3:e.t0===De||e.t0===Le?4:5;break;case 3:return e.abrupt("return",["_blobs"]);case 4:return e.abrupt("return",this.dataStores.getDataStorePackagePath(t));case 5:g(!1,734);case 6:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"isBlobPath",value:function(e){var t=e.split("/");return!(t.length<2||t[1]!==Te.basePath)}},{key:"collectGarbage",value:function(){var e=(0,s.Z)((0,a.Z)().mark((function e(t){return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.garbageCollector.collectGarbage(t));case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"addedGCOutboundReference",value:function(e,t){this.garbageCollector.addedOutboundReference(e.absolutePath,t.absolutePath)}},{key:"submitSummary",value:function(){var e=(0,s.Z)((0,a.Z)().mark((function e(t){var n,r,i,o,u,c,l,d,h,f,p,v,m,y,w,C,x,E,T,A,R,_,P,N,O,F,Z,D,B,q,j,U,H,z,V,G=this;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(o=t.fullTree,u=t.refreshLatestAck,c=t.summaryLogger,l=this.nextSummaryNumber,d=I.G2.create(c,void 0,{all:{summaryNumber:l}}),!u){e.next=12;break}return e.next=6,this.refreshLatestSummaryAckFromServer(I.G2.create(d,void 0,{all:{safeSummary:!0}}));case 6:if(f=e.sent,p=f.latestSnapshotRefSeq,h=f.latestSnapshotVersionId,!(p>this.deltaManager.lastSequenceNumber)){e.next=12;break}return e.next=12,I.Xr.timedExecAsync(d,{eventName:"WaitingForSeq",lastSequenceNumber:this.deltaManager.lastSequenceNumber,targetSequenceNumber:p,lastKnownSeqNumber:this.deltaManager.lastKnownSeqNumber},(0,s.Z)((0,a.Z)().mark((function e(){return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",Wt(G.deltaManager,p));case 1:case"end":return e.stop()}}),e)}))),{start:!0,end:!0,cancel:"error"});case 12:return e.prev=12,e.next=15,this.deltaManager.inbound.pause();case 15:if(v=this.deltaManager.lastSequenceNumber,m=this.deltaManager.minimumSequenceNumber,y="Summary @".concat(v,":").concat(this.deltaManager.minimumSequenceNumber),v!==(null===(n=this.deltaManager.lastMessage)||void 0===n?void 0:n.sequenceNumber)&&d.sendErrorEvent({eventName:"LastSequenceMismatch",error:y}),this.summarizerNode.startSummary(v,d),(C=(w=function(){return t.cancellationToken.cancelled?{continue:!1,error:"disconnected"}:(g(G.connected,600),G.deltaManager.lastSequenceNumber!==v?{continue:!1,error:"lastSequenceNumber changed before uploading to storage. ".concat(G.deltaManager.lastSequenceNumber," !== ").concat(v)}:{continue:!0})})()).continue){e.next=24;break}return e.abrupt("return",{stage:"base",referenceSequenceNumber:v,minimumSequenceNumber:m,error:C.error});case 24:return x=k.start(),T=this.garbageCollector.summaryStateNeedsReset,e.prev=26,e.next=29,this.summarize({fullTree:o||T,trackState:!0,summaryLogger:d,runGC:this.garbageCollector.shouldRunGC});case 29:E=e.sent,e.next=35;break;case 32:return e.prev=32,e.t0=e.catch(26),e.abrupt("return",{stage:"base",referenceSequenceNumber:v,minimumSequenceNumber:m,error:e.t0});case 35:if(R=(A=E).summary,_=A.stats,this.messageAtLastSummary=this.deltaManager.lastMessage,g((P=this.disableIsolatedChannels?R:R.tree[M.channelsTreeName]).type===S.Tree,508),N=Object.values(P.tree).filter((function(e){return e.type===S.Handle})).length,O=R.tree[Me]?(0,L.i6)(R.tree[Me]):void 0,F=Object.assign({dataStoreCount:this.dataStores.size,summarizedDataStoreCount:this.dataStores.size-N,gcStateUpdatedDataStoreCount:null===(r=E.gcStats)||void 0===r?void 0:r.updatedDataStoreCount,gcBlobNodeCount:null===O||void 0===O?void 0:O.blobNodeCount,gcTotalBlobsSize:null===O||void 0===O?void 0:O.totalBlobSize,opsSizesSinceLastSummary:this.opTracker.opsSizeAccumulator,nonSystemOpsSinceLastSummary:this.opTracker.nonSystemOpCount,summaryNumber:l},_),Z={referenceSequenceNumber:v,minimumSequenceNumber:m,summaryTree:R,summaryStats:F,generateDuration:x.trace().duration,forcedFullTree:T},(C=w()).continue){e.next=46;break}return e.abrupt("return",Object.assign(Object.assign({stage:"generate"},Z),{error:C.error}));case 46:return D=this.summaryCollection.latestAck,B=(null===D||void 0===D?void 0:D.summaryAck.contents.handle)!==h&&void 0!==h?{proposalHandle:void 0,ackHandle:h,referenceSequenceNumber:v}:void 0===D?{proposalHandle:void 0,ackHandle:null===(i=this.context.getLoadedFromVersion())||void 0===i?void 0:i.id,referenceSequenceNumber:v}:{proposalHandle:D.summaryOp.contents.handle,ackHandle:D.summaryAck.contents.handle,referenceSequenceNumber:v},e.prev=48,e.next=51,this.storage.uploadSummaryWithContext(E.summary,B);case 51:q=e.sent,e.next=57;break;case 54:return e.prev=54,e.t1=e.catch(48),e.abrupt("return",Object.assign(Object.assign({stage:"generate"},Z),{error:e.t1}));case 57:if(j=B.ackHandle,U={handle:q,head:j,message:y,parents:j?[j]:[]},H=Object.assign(Object.assign({},Z),{handle:q,uploadDuration:x.trace().duration}),(C=w()).continue){e.next=63;break}return e.abrupt("return",Object.assign(Object.assign({stage:"upload"},H),{error:C.error}));case 63:e.prev=63,z=this.submitSystemMessage(b.Summarize,U),e.next=70;break;case 67:return e.prev=67,e.t2=e.catch(63),e.abrupt("return",Object.assign(Object.assign({stage:"upload"},H),{error:e.t2}));case 70:return V=Object.assign(Object.assign({stage:"submit"},H),{clientSequenceNumber:z,submitOpDuration:x.trace().duration}),this.summarizerNode.completeSummary(q),this.opTracker.reset(),e.abrupt("return",V);case 74:return e.prev=74,this.summarizerNode.clearSummary(),this.deltaManager.inbound.resume(),e.finish(74);case 78:case"end":return e.stop()}}),e,this,[[12,,74,78],[26,32],[48,54],[63,67]])})));return function(t){return e.apply(this,arguments)}}()},{key:"processRemoteChunkedMessage",value:function(e){if(e.type!==Zt.ChunkedOp)return e;var t=e.clientId,n=e.contents;if(this.addChunk(t,n),n.chunkId===n.totalChunks){var r=Object.assign({},e),i=this.chunkMap.get(t).join("");return r.contents=JSON.parse(i),r.type=n.originalType,this.clearPartialChunks(t),r}return e}},{key:"addChunk",value:function(e,t){var n=this.chunkMap.get(e);void 0===n&&(n=[],this.chunkMap.set(e,n)),g(t.chunkId===n.length+1,305),n.push(t.contents)}},{key:"clearPartialChunks",value:function(e){this.chunkMap.has(e)&&this.chunkMap.delete(e)}},{key:"updateDocumentDirtyState",value:function(e){this.dirtyContainer!==e&&(this.dirtyContainer=e,this.emitDirtyDocumentEvent&&(this.emit(e?"dirty":"saved"),this.context.updateDirtyContainerState(e)))}},{key:"submitDataStoreOp",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0,r={address:e,contents:t};this.submit(Zt.FluidDataStoreOp,r,n)}},{key:"submitDataStoreAliasOp",value:function(e,t){if(!mt(e))throw new O.Oi("malformedDataStoreAliasMessage");this.submit(Zt.Alias,e,t)}},{key:"uploadBlob",value:function(){var e=(0,s.Z)((0,a.Z)().mark((function e(t){return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.verifyNotClosed(),e.abrupt("return",this.blobManager.createBlob(t));case 2:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"submit",value:function(e,t){var n=this,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:void 0;this.verifyNotClosed(),g(this.attachState!==p.mB.Detached,306);var o=-1,a=i;if(this.canSendOps()){var s=JSON.stringify(t),u=this.context.deltaManager.maxMessageSize;this.flushMode!==M.FlushMode.TurnBased||this.needsFlush||(a=Object.assign(Object.assign({},i),{batch:!0}),this.needsFlush=!0,this.flushTrigger||Promise.resolve().then((function(){n.flushTrigger=!1,n.flush()}))),o=this.submitMaybeChunkedMessages(e,t,s,u,this._flushMode===M.FlushMode.TurnBased,a)}this.pendingStateManager.onSubmitMessage(e,o,this.deltaManager.lastSequenceNumber,t,r,a),this.isContainerMessageDirtyable(e,t)&&this.updateDocumentDirtyState(!0)}},{key:"submitMaybeChunkedMessages",value:function(e,t,n,r,i){var o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:void 0;return this._maxOpSizeInBytes>=0?!n||n.length<=this._maxOpSizeInBytes?this.submitRuntimeMessage(e,t,i,o):(this.closeFn(new O.pY("OpTooLarge",void 0,{length:{value:n.length,tag:I.XI.PackageData},limit:{value:this._maxOpSizeInBytes,tag:I.XI.PackageData}})),-1):!n||n.length<=r?this.submitRuntimeMessage(e,t,i,o):this.submitChunkedMessage(e,n,r)}},{key:"submitChunkedMessage",value:function(e,t,n){for(var r=t.length,i=Math.floor((r-1)/n)+1,o=0,a=0,s=1;s<=i;s+=1){var u={chunkId:s,contents:t.substr(o,n),originalType:e,totalChunks:i};o+=n,a=this.submitRuntimeMessage(Zt.ChunkedOp,u,!1)}return a}},{key:"submitSystemMessage",value:function(e,t){this.verifyNotClosed(),g(this.connected,307);var n=this.flushMode===M.FlushMode.TurnBased&&this.needsFlush;return n&&this.mc.logger.sendErrorEvent({eventName:"submitSystemMessageError",type:e}),this.context.submitFn(e,t,n)}},{key:"submitRuntimeMessage",value:function(e,t,n,r){this.verifyNotClosed(),g(this.connected,601);var i={type:e,contents:t};return this.context.submitFn(b.Operation,i,n,r)}},{key:"verifyNotClosed",value:function(){if(this._disposed)throw new Error("Runtime is closed")}},{key:"reSubmit",value:function(e,t,n,r){switch(e){case Zt.FluidDataStoreOp:this.dataStores.resubmitDataStoreOp(t,n);break;case Zt.Attach:case Zt.Alias:this.submit(e,t,n);break;case Zt.ChunkedOp:throw new Error("chunkedOp not expected here");case Zt.BlobAttach:this.submit(e,t,n,r);break;case Zt.Rejoin:this.submit(e,t);break;default:y(e,"Unknown ContainerMessageType: ".concat(e))}}},{key:"rollback",value:function(e,t,n){if(e!==Zt.FluidDataStoreOp)throw new Error("Can't rollback ".concat(e));this.dataStores.rollbackDataStoreOp(t,n)}},{key:"refreshLatestSummaryAck",value:function(){var e=(0,s.Z)((0,a.Z)().mark((function e(t,n,r,i){var o,u,c,l,d=this;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=function(){var e=(0,s.Z)((0,a.Z)().mark((function e(t){return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,N.g)(d.storage,t));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),e.next=3,this.fetchSnapshotFromStorage(n,i,{eventName:"RefreshLatestSummaryGetSnapshot",ackHandle:n,summaryRefSeq:r,fetchLatest:!1});case 3:return u=e.sent,c=u.snapshotTree,e.next=7,this.summarizerNode.refreshLatestSummary(t,r,(0,s.Z)((0,a.Z)().mark((function e(){return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",c);case 1:case"end":return e.stop()}}),e)}))),o,i);case 7:return l=e.sent,e.next=10,this.garbageCollector.latestSummaryStateRefreshed(l,o);case 10:case"end":return e.stop()}}),e,this)})));return function(t,n,r,i){return e.apply(this,arguments)}}()},{key:"refreshLatestSummaryAckFromServer",value:function(){var e=(0,s.Z)((0,a.Z)().mark((function e(t){var n,r,i,o,u,c,l=this;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.fetchSnapshotFromStorage(null,t,{eventName:"RefreshLatestSummaryGetSnapshot",fetchLatest:!0});case 2:return n=e.sent,r=n.snapshotTree,i=n.versionId,o=function(){var e=(0,s.Z)((0,a.Z)().mark((function e(t){return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,N.g)(l.storage,t));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),e.next=8,(0,B.G)(r,o);case 8:return u=e.sent,e.next=11,this.summarizerNode.refreshLatestSummary(void 0,u,(0,s.Z)((0,a.Z)().mark((function e(){return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",r);case 1:case"end":return e.stop()}}),e)}))),o,t);case 11:return c=e.sent,e.next=14,this.garbageCollector.latestSummaryStateRefreshed(c,o);case 14:return e.abrupt("return",{latestSnapshotRefSeq:u,latestSnapshotVersionId:i});case 15:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"fetchSnapshotFromStorage",value:function(){var e=(0,s.Z)((0,a.Z)().mark((function e(t,n,r){var i=this;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",I.Xr.timedExecAsync(n,r,function(){var e=(0,s.Z)((0,a.Z)().mark((function e(n){var r,o,s,u;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r={},o=k.start(),e.next=4,i.storage.getVersions(t,1);case 4:return g(!!(s=e.sent)&&!!s[0],311),r.getVersionDuration=o.trace().duration,e.next=9,i.storage.getSnapshotTree(s[0]);case 9:return g(!!(u=e.sent),312),r.getSnapshotDuration=o.trace().duration,n.end(r),e.abrupt("return",{snapshotTree:u,versionId:s[0].id});case 14:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 1:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"notifyAttaching",value:function(e){var t;(null!==(t=this.mc.config.getBoolean("enableOfflineLoad"))&&void 0!==t?t:this.runtimeOptions.enableOfflineLoad)&&(this.baseSnapshotBlobs=Lt.serializeTreeWithBlobContents(e))}},{key:"getSnapshotBlobs",value:function(){var e=(0,s.Z)((0,a.Z)().mark((function e(){var t;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((null!==(t=this.mc.config.getBoolean("enableOfflineLoad"))&&void 0!==t?t:this.runtimeOptions.enableOfflineLoad)&&this.attachState===p.mB.Attached&&!this.context.pendingLocalState){e.next=2;break}return e.abrupt("return");case 2:return g(!!this.context.baseSnapshot,741),e.next=5,Lt.serializeTree(this.context.baseSnapshot,this.storage);case 5:this.baseSnapshotBlobs=e.sent;case 6:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getPendingLocalState",value:function(){var e;if(!(null!==(e=this.mc.config.getBoolean("enableOfflineLoad"))&&void 0!==e?e:this.runtimeOptions.enableOfflineLoad))throw new O.Oi("can't get state when offline load disabled");var t=this.context.pendingLocalState;return t?{pending:this.pendingStateManager.getLocalState(),snapshotBlobs:t.snapshotBlobs,baseSnapshot:t.baseSnapshot,savedOps:this.savedOps}:(g(!!this.context.baseSnapshot,742),g(!!this.baseSnapshotBlobs,743),{pending:this.pendingStateManager.getLocalState(),snapshotBlobs:this.baseSnapshotBlobs,baseSnapshot:this.context.baseSnapshot,savedOps:this.savedOps})}},{key:"formRequestSummarizerFn",value:function(e){return(0,s.Z)((0,a.Z)().mark((function t(){var n,r,o,s;return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r={headers:(n={},(0,i.Z)(n,v.A.cache,!1),(0,i.Z)(n,v.A.clientDetails,{capabilities:{interactive:!1},type:Q}),(0,i.Z)(n,_.i.summarizingClient,!0),(0,i.Z)(n,v.A.reconnect,!1),n),url:"/_summarizer"},t.next=3,(0,D.bb)(e,r);case 3:if(o=t.sent,s=o.ISummarizer){t.next=7;break}throw new O.Oi("Fluid object does not implement ISummarizer");case 7:return t.abrupt("return",s);case 8:case"end":return t.stop()}}),t)})))}},{key:"processSavedOps",value:function(){var e=(0,s.Z)((0,a.Z)().mark((function e(t){var n,r,i;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=(0,d.Z)(t.savedOps),e.prev=1,n.s();case 3:if((r=n.n()).done){e.next=10;break}return i=r.value,this.process(i,!1),e.next=8,this.pendingStateManager.applyStashedOpsAt(i.sequenceNumber);case 8:e.next=3;break;case 10:e.next=15;break;case 12:e.prev=12,e.t0=e.catch(1),n.e(e.t0);case 15:return e.prev=15,n.f(),e.finish(15);case 18:return e.next=20,this.pendingStateManager.applyStashedOpsAt();case 20:case"end":return e.stop()}}),e,this,[[1,12,15,18]])})));return function(t){return e.apply(this,arguments)}}()}],[{key:"load",value:function(){var e=(0,s.Z)((0,a.Z)().mark((function e(t,i,o){var u,c,l,d,h,f,p,v,m,y,b,w,S,k,C,x,E,T,A,R,_,P,M,F,Z,D,L,B,q,j,U,H,V,G,K,W,J,Q,Y=arguments;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return u=Y.length>3&&void 0!==Y[3]?Y[3]:{},c=Y.length>4&&void 0!==Y[4]?Y[4]:t.scope,l=Y.length>5?Y[5]:void 0,v=null!==(d=(p=t).taggedLogger)&&void 0!==d?d:new I.cP(p.logger),m=I.G2.create(v,void 0,{all:{runtimeVersion:xe}}),y=u.summaryOptions,b=void 0===y?{}:y,w=u.gcOptions,S=void 0===w?{}:w,k=u.loadSequenceNumberVerification,C=void 0===k?"close":k,x=u.useDataStoreAliasing,E=void 0!==x&&x,T=u.flushMode,A=void 0===T?Ht:T,R=u.enableOfflineLoad,_=void 0!==R&&R,P=t.pendingLocalState,M=null!==(h=null===P||void 0===P?void 0:P.baseSnapshot)&&void 0!==h?h:t.baseSnapshot,F=P?new Lt((function(){return t.storage}),P.snapshotBlobs):t.storage,Z=new z.P(i),D=function(){var e=(0,s.Z)((0,a.Z)().mark((function e(t){var n;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=null===M||void 0===M?void 0:M.blobs[t],!M||!n){e.next=4;break}return g(void 0!==F,501),e.abrupt("return",(0,N.g)(F,n));case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),e.next=14,Promise.all([D(et),D($e),D(tt),D(Xe)]);case 14:return L=e.sent,B=(0,r.Z)(L,4),q=B[0],j=B[1],U=B[2],H=B[3],V=!0===l||!0===t.existing,e.next=23,Te.load(null===M||void 0===M?void 0:M.trees[nt],function(){var e=(0,s.Z)((0,a.Z)().mark((function e(t){return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return g(void 0!==F,598),e.abrupt("return",(0,N.g)(F,t));case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 23:if(G=e.sent,K=null===(f=null===j||void 0===j?void 0:j.message)||void 0===f?void 0:f.sequenceNumber,P||void 0===K||(W=t.deltaManager.initialSequenceNumber,"bypass"!==C&&K!==W&&(J=new O.Jd("Summary metadata mismatch",{runtimeVersion:xe,runtimeSequenceNumber:K,protocolSequenceNumber:W}),"log"===C?m.sendErrorEvent({eventName:"SequenceNumberMismatch"},J):t.closeFn(J))),Q=new n(t,Z,j,U,null!==q&&void 0!==q?q:[],null!==H&&void 0!==H?H:[],{summaryOptions:b,gcOptions:S,loadSequenceNumberVerification:C,useDataStoreAliasing:E,flushMode:A,enableOfflineLoad:_},c,m,V,G,F,o),!P){e.next=31;break}return e.next=30,Q.processSavedOps(P);case 30:P.savedOps=[];case 31:return e.next=33,Q.getSnapshotBlobs();case 33:return e.abrupt("return",Q);case 34:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}()}]),n}(T),Wt=function(){var e=(0,s.Z)((0,a.Z)().mark((function e(t,n){return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,r){t.on("closed",r);t.on("op",(function r(i){i.sequenceNumber>=n&&(e(),t.off("op",r))}))})));case 1:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()},87922:function(e,t,n){"use strict";n.d(t,{P:function(){return c}});var r=n(74165),i=n(15861),o=n(37762),a=n(15671),s=n(43144),u=n(10357),c=function(){function e(t){(0,a.Z)(this,e),this.map=new Map;var n,r=(0,o.Z)(t);try{for(r.s();!(n=r.n()).done;){var i=n.value;if(this.map.has(i[0]))throw new u.Oi("Duplicate entry names exist");this.map.set(i[0],i[1])}}catch(s){r.e(s)}finally{r.f()}}return(0,s.Z)(e,[{key:"IFluidDataStoreRegistry",get:function(){return this}},{key:"get",value:function(){var e=(0,i.Z)((0,r.Z)().mark((function e(t){return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.map.has(t)){e.next=2;break}return e.abrupt("return",this.map.get(t));case 2:return e.abrupt("return",void 0);case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),e}()},10357:function(e,t,n){"use strict";n.d(t,{FQ:function(){return l},HN:function(){return v},Hi:function(){return p},Jd:function(){return f},Lf:function(){return h},Oi:function(){return d},pY:function(){return c}});var r=n(43144),i=n(15671),o=n(60136),a=n(29388),s=n(90142),u=n(65059),c=function(e){(0,o.Z)(n,e);var t=(0,a.Z)(n);function n(e,r,o){var a;return(0,i.Z)(this,n),(a=t.call(this,e,o,new Set(["error"]))).error=r,a.errorType=s.u.genericError,a}return(0,r.Z)(n)}(u.j4),l=function(e){(0,o.Z)(n,e);var t=(0,a.Z)(n);function n(e,r,o){var a;return(0,i.Z)(this,n),(a=t.call(this,e,o)).retryAfterSeconds=r,a.errorType=s.u.throttlingError,a}return(0,r.Z)(n,null,[{key:"wrap",value:function(e,t,r){return(0,u.bO)(e,(function(e){return new n(e,t)}),r)}}]),n}(u.j4),d=function(e){(0,o.Z)(n,e);var t=(0,a.Z)(n);function n(e){var r;return(0,i.Z)(this,n),(r=t.call(this,e,{usageError:!0})).errorType="usageError",r}return(0,r.Z)(n)}(u.j4),h=function(e){(0,o.Z)(n,e);var t=(0,a.Z)(n);function n(e,r){var o;return(0,i.Z)(this,n),(o=t.call(this,e,{timeoutMs:r})).expiryMs=r,o.errorType=s.u.clientSessionExpiredError,o}return(0,r.Z)(n)}(u.j4),f=function(e){(0,o.Z)(n,e);var t=(0,a.Z)(n);function n(e,r){var o;return(0,i.Z)(this,n),(o=t.call(this,e,Object.assign(Object.assign({},r),{dataProcessingError:1}))).errorType=s.u.dataCorruptionError,o.canRetry=!1,o}return(0,r.Z)(n)}(u.j4),p=function(e){(0,o.Z)(n,e);var t=(0,a.Z)(n);function n(e){var r;return(0,i.Z)(this,n),(r=t.call(this,e)).errorType=s.u.dataProcessingError,r.canRetry=!1,r}return(0,r.Z)(n,null,[{key:"create",value:function(e,t,r){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},o=n.wrapIfUnrecognized(e,t,r);return o.addTelemetryProperties(i),o}},{key:"wrapIfUnrecognized",value:function(e,t,r){var i=Object.assign({dataProcessingError:1,dataProcessingCodepath:t},void 0===r?void 0:v(r)),o=(0,u.SC)(e,{props:i});if(!(0,u.XY)(o))return o;var a=(0,u.Jn)(o,(function(e){return new n(e)}));return a.addTelemetryProperties(o.getTelemetryProperties()),a}}]),n}(u.j4),v=function(e){return{messageClientId:e.clientId,messageSequenceNumber:e.sequenceNumber,messageClientSequenceNumber:e.clientSequenceNumber,messageReferenceSequenceNumber:e.referenceSequenceNumber,messageMinimumSequenceNumber:e.minimumSequenceNumber,messageTimestamp:e.timestamp}}},42595:function(e,t,n){"use strict";n.d(t,{Zb:function(){return Q},eH:function(){return Y}});var r=n(11752),i=n(61120),o=n(29439),a=n(37762),s=n(74165),u=n(15861),c=n(15671),l=n(43144),d=n(97326),h=n(60136),f=n(29388),p=n(57115),v=n(10357),g=function(){function e(){var t=this;(0,c.Z)(this,e),this.completed=!1,this.p=new Promise((function(e,n){t.res=e,t.rej=n}))}return(0,l.Z)(e,[{key:"isCompleted",get:function(){return this.completed}},{key:"promise",get:function(){return this.p}},{key:"resolve",value:function(e){void 0!==this.res&&(this.completed=!0,this.res(e))}},{key:"reject",value:function(e){void 0!==this.rej&&(this.completed=!0,this.rej(e))}}]),e}(),m=function(e){function t(e){(0,c.Z)(this,t),this.execute=e}return(0,l.Z)(t,[{key:e,get:function(){return this.getPromise()[Symbol.toStringTag]}},{key:"then",value:function(){var e=(0,u.Z)((0,s.Z)().mark((function e(t,n){var r,i=arguments;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(r=this.getPromise()).then.apply(r,i));case 1:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"catch",value:function(){var e=(0,u.Z)((0,s.Z)().mark((function e(t){var n,r=arguments;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(n=this.getPromise()).catch.apply(n,r));case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"finally",value:function(){var e=(0,u.Z)((0,s.Z)().mark((function e(t){var n,r=arguments;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(n=this.getPromise()).finally.apply(n,r));case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getPromise",value:function(){var e=(0,u.Z)((0,s.Z)().mark((function e(){return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return void 0===this.result&&(this.result=this.execute()),e.abrupt("return",this.result);case 2:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),t}(Symbol.toStringTag);function y(e,t){if(!e)throw new Error("number"===typeof t?"0x".concat(t.toString(16).padStart(3,"0")):t)}var b,w=function(e){(0,h.Z)(n,e);var t=(0,f.Z)(n);function n(){var e,o,a,s,u,l,h,f;return(0,c.Z)(this,n),(f=t.call(this)).addListener=(0,r.Z)((e=(0,d.Z)(f),(0,i.Z)(n.prototype)),"addListener",e).bind((0,d.Z)(f)),f.on=(0,r.Z)((o=(0,d.Z)(f),(0,i.Z)(n.prototype)),"on",o).bind((0,d.Z)(f)),f.once=(0,r.Z)((a=(0,d.Z)(f),(0,i.Z)(n.prototype)),"once",a).bind((0,d.Z)(f)),f.prependListener=(0,r.Z)((s=(0,d.Z)(f),(0,i.Z)(n.prototype)),"prependListener",s).bind((0,d.Z)(f)),f.prependOnceListener=(0,r.Z)((u=(0,d.Z)(f),(0,i.Z)(n.prototype)),"prependOnceListener",u).bind((0,d.Z)(f)),f.removeListener=(0,r.Z)((l=(0,d.Z)(f),(0,i.Z)(n.prototype)),"removeListener",l).bind((0,d.Z)(f)),f.off=(0,r.Z)((h=(0,d.Z)(f),(0,i.Z)(n.prototype)),"off",h).bind((0,d.Z)(f)),f}return(0,l.Z)(n)}(n(47465).EventEmitter),S=n(98895),k=n(99025),C=n(65059),x=n(69751);!function(e){e.Tree=1,e.Blob=2,e.Handle=3,e.Attachment=4}(b||(b={}));var E=n(62790),T=n(87154),I=n(10003),A=n(63760),R=n(91869),_=n(20644),P=n(39575),N=function(){function e(t,n,r,i,o){(0,c.Z)(this,e),this.objectId=t,this._connected=n,this.submit=r,this.dirty=i,this.addedGCOutboundReference=o}return(0,l.Z)(e,[{key:"handler",get:function(){return y(!!this._handler,375),this._handler}},{key:"connected",get:function(){return this._connected}},{key:"attach",value:function(e){y(void 0===this._handler,376),this._handler=e}},{key:"setConnectionState",value:function(e){this._connected=e,this.handler.setConnectionState(e)}},{key:"process",value:function(e,t,n){try{this.handler.process(e,t,n)}catch(r){throw v.Hi.wrapIfUnrecognized(r,"channelDeltaConnectionFailedToProcessMessage",e)}}},{key:"reSubmit",value:function(e,t){this.handler.reSubmit(e,t)}},{key:"rollback",value:function(e,t){if(void 0===this.handler.rollback)throw new Error("Handler doesn't support rollback");this.handler.rollback(e,t)}},{key:"applyStashedOp",value:function(e){return this.handler.applyStashedOp(e)}}]),e}(),O=n(43096),M=function(){function e(t,n,r,i){(0,c.Z)(this,e),this.tree=t,this.storage=n,this.logger=r,this.extraBlobs=i,this.flattenedTree={},void 0!==t&&e.flattenTree("",t,this.flattenedTree)}return(0,l.Z)(e,[{key:"contains",value:function(){var e=(0,u.Z)((0,s.Z)().mark((function e(t){return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",void 0!==this.flattenedTree[t]);case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"readBlob",value:function(){var e=(0,u.Z)((0,s.Z)().mark((function e(t){var n,r,i,o=this;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getIdForPath(t);case 2:if(n=e.sent,void 0===(r=void 0!==this.extraBlobs?this.extraBlobs.get(n):void 0)){e.next=6;break}return e.abrupt("return",r);case 6:return(i=this.storage.readBlob(n)).catch((function(e){return o.logger.sendErrorEvent({eventName:"ChannelStorageBlobError"},e)})),e.abrupt("return",i);case 9:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"list",value:function(){var e=(0,u.Z)((0,s.Z)().mark((function e(t){var n,r,i,o;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(r=this.tree,i=(0,O.g)(t);void 0!==r&&i.length>0;)o=i.shift(),r=r.trees[o];if(void 0!==r&&0===i.length){e.next=5;break}throw new Error("path does not exist");case 5:return e.abrupt("return",Object.keys(null!==(n=null===r||void 0===r?void 0:r.blobs)&&void 0!==n?n:{}));case 6:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getIdForPath",value:function(){var e=(0,u.Z)((0,s.Z)().mark((function e(t){return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.flattenedTree[t]);case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}],[{key:"flattenTree",value:function(t,n,r){for(var i in n.trees)e.flattenTree("".concat(t).concat(i,"/"),n.trees[i],r);for(var o in n.blobs)r["".concat(t).concat(o)]=n.blobs[o]}}]),e}(),F=".attributes";function Z(e,t,n,r,i,o,a,s,u){return{deltaConnection:new N(e,t,(function(e,t){return n(e,t)}),r,i),objectStorage:new M(s,o,a,u)}}function D(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3?arguments[3]:void 0,i=e.getAttachSummary(t,n,r);return(0,R.Rt)(i,F,JSON.stringify(e.attributes)),i}function L(e){return B.apply(this,arguments)}function B(){return B=(0,u.Z)((0,s.Z)().mark((function e(t){var n,r,i,o,a=arguments;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=a.length>1&&void 0!==a[1]&&a[1],r=a.length>2&&void 0!==a[2]&&a[2],i=a.length>3?a[3]:void 0,e.next=5,t.summarize(n,r,i);case 5:return o=e.sent,(0,R.Rt)(o,F,JSON.stringify(t.attributes)),e.abrupt("return",o);case 8:case"end":return e.stop()}}),e)}))),B.apply(this,arguments)}var q,j=n(58121),U=n.n(j),H=n(91688),z=function(){function e(t){(0,c.Z)(this,e),this.valueGenerator=t,this._evaluated=!1}return(0,l.Z)(e,[{key:"evaluated",get:function(){return this._evaluated}},{key:"value",get:function(){return this._evaluated||(this._evaluated=!0,this._value=this.valueGenerator()),this._value}}]),e}(),V=function(){function e(t,n,r,i){(0,c.Z)(this,e),this.id=t,this.registry=n,this.runtime=r,this.servicesGetter=i,this.globallyVisible=!1,this.pending=[],y(!this.id.includes("/"),783)}return(0,l.Z)(e,[{key:"getChannel",value:function(){var e=(0,u.Z)((0,s.Z)().mark((function e(){return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return y(void 0!==this.channel,519),e.abrupt("return",this.channel);case 2:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"isLoaded",get:function(){return void 0!==this.channel}},{key:"setConnectionState",value:function(e,t){this.globallyVisible&&this.isLoaded&&this.servicesGetter().value.deltaConnection.setConnectionState(e)}},{key:"processOp",value:function(e,t,n){y(this.globallyVisible,723),this.isLoaded?this.servicesGetter().value.deltaConnection.process(e,t,n):(y(!1===t,393),this.pending.push(e))}},{key:"reSubmit",value:function(e,t){y(this.isLoaded,394),y(this.globallyVisible,724),this.servicesGetter().value.deltaConnection.reSubmit(e,t)}},{key:"rollback",value:function(e,t){y(this.isLoaded,750),y(this.globallyVisible,751),this.servicesGetter().value.deltaConnection.rollback(e,t)}},{key:"applyStashedOp",value:function(){throw new Error("no stashed ops on local channel")}},{key:"summarize",value:function(){var e=(0,u.Z)((0,s.Z)().mark((function e(){var t,n,r,i=arguments;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=i.length>0&&void 0!==i[0]&&i[0],n=i.length>1&&void 0!==i[1]&&i[1],r=i.length>2?i[2]:void 0,y(this.isLoaded&&void 0!==this.channel,396),e.abrupt("return",L(this.channel,t,n,r));case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getAttachSummary",value:function(e){return y(this.isLoaded&&void 0!==this.channel,397),D(this.channel,!0,!1,e)}},{key:"makeVisible",value:function(){if(this.globallyVisible)throw new Error("Channel is already globally visible");this.isLoaded&&(y(!!this.channel,402),this.channel.connect(this.servicesGetter().value)),this.globallyVisible=!0}},{key:"getGCData",value:function(){var e=(0,u.Z)((0,s.Z)().mark((function e(){var t,n=arguments;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=n.length>0&&void 0!==n[0]&&n[0],y(this.isLoaded&&void 0!==this.channel,403),e.abrupt("return",this.channel.getGCData(t));case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"updateUsedRoutes",value:function(e,t){}}]),e}(),G=function(e){(0,h.Z)(n,e);var t=(0,f.Z)(n);function n(e,r,i,o,a,s,u,l,d,h){var f;(0,c.Z)(this,n),(f=t.call(this,e,r,i,(function(){return f.services}))).snapshotTree=h;var p=new Map,v=U()(f.snapshotTree);return f.isSnapshotInOldFormatAndCollectBlobs(v,p)&&f.sanitizeSnapshot(v),f.services=new z((function(){return Z(f.id,o.connected,u,f.dirtyFn,d,a,s,v,p)})),f.dirtyFn=function(){l(e)},f}return(0,l.Z)(n,[{key:"getChannel",value:function(){var e=(0,u.Z)((0,s.Z)().mark((function e(){return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0!==this.channel){e.next=4;break}return e.next=3,this.loadChannel().catch((function(e){throw v.Hi.wrapIfUnrecognized(e,"rehydratedLocalChannelContextFailedToLoadChannel",void 0)}));case 3:this.channel=e.sent;case 4:return e.abrupt("return",this.channel);case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"loadChannel",value:function(){var e=(0,u.Z)((0,s.Z)().mark((function e(){var t,n,r,i,o;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return y(!this.isLoaded,398),e.t0=y,e.next=4,this.services.value.objectStorage.contains(".attributes");case 4:return e.t1=e.sent,(0,e.t0)(e.t1,400),e.next=8,(0,H.g)(this.services.value.objectStorage,".attributes");case 8:if(t=e.sent,y(void 0===this.factory,520),this.factory=this.registry.get(t.type),void 0!==this.factory){e.next=13;break}throw new Error("Channel Factory ".concat(t.type," not registered"));case 13:return e.next=15,this.factory.load(this.runtime,this.id,this.services.value,t);case 15:n=e.sent,this.channel=n,r=(0,a.Z)(this.pending);try{for(r.s();!(i=r.n()).done;)o=i.value,this.services.value.deltaConnection.process(o,!1,void 0)}catch(s){r.e(s)}finally{r.f()}return e.abrupt("return",this.channel);case 20:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"isSnapshotInOldFormatAndCollectBlobs",value:function(e,t){var n=!1,r=e.blobsContents;Object.entries(r).forEach((function(r){var i=(0,o.Z)(r,2),a=i[0],s=i[1];t.set(a,s),void 0!==e.blobs[a]&&(n=!0)}));for(var i=0,a=Object.values(e.trees);i<a.length;i++){var s=a[i];n=n||this.isSnapshotInOldFormatAndCollectBlobs(s,t)}return n}},{key:"sanitizeSnapshot",value:function(e){var t,n=new Map(Object.entries(e.blobs)),r=(0,a.Z)(n.entries());try{for(r.s();!(t=r.n()).done;){var i=(0,o.Z)(t.value,2),s=i[0],u=i[1];void 0===n.get(u)&&delete e.blobs[s]}}catch(h){r.e(h)}finally{r.f()}for(var c=0,l=Object.values(e.trees);c<l.length;c++){var d=l[c];this.sanitizeSnapshot(d)}}}]),n}(V),K=function(e){(0,h.Z)(n,e);var t=(0,f.Z)(n);function n(e,r,i,o,a,s,u,l,d,h){var f;if((0,c.Z)(this,n),f=t.call(this,e,r,o,(function(){return f.services})),y(void 0!==i,521),f.factory=r.get(i),void 0===f.factory)throw new Error("Channel Factory ".concat(i," not registered"));return f.channel=f.factory.create(o,e),f.services=new z((function(){return Z(f.id,a.connected,l,f.dirtyFn,h,s,u)})),f.dirtyFn=function(){d(e)},f}return(0,l.Z)(n)}(V),W=n(84485),J=function(){function e(t,n,r,i,o,a,l,d,h,f,p,v,g){var m=this;(0,c.Z)(this,e),this.runtime=t,this.dataStoreContext=n,this.id=l,this.registry=h,this.attachMessageType=g,this.isLoaded=!1,this.pending=[],y(!this.id.includes("/"),784),this.subLogger=S.G2.create(this.runtime.logger,"RemoteChannelContext"),this.services=Z(this.id,this.dataStoreContext.connected,i,(function(){return o(m.id)}),a,r,this.subLogger,d,f);var b=function(){var e=(0,u.Z)((0,s.Z)().mark((function e(t,n,r){return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",m.summarizeInternal(t,n,r));case 1:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}();this.summarizerNode=p(b,function(){var e=(0,u.Z)((0,s.Z)().mark((function e(t){return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",m.getGCDataInternal(t));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),(0,u.Z)((0,s.Z)().mark((function e(){return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",v());case 1:case"end":return e.stop()}}),e)})))),this.thresholdOpsCounter=new W.z(e.pendingOpsCountThreshold,this.subLogger)}return(0,l.Z)(e,[{key:"getChannel",value:function(){return void 0===this.channelP&&(this.channelP=this.loadChannel()),this.channelP}},{key:"setConnectionState",value:function(e,t){this.isLoaded&&this.services.deltaConnection.setConnectionState(e)}},{key:"applyStashedOp",value:function(e){return y(this.isLoaded,404),this.services.deltaConnection.applyStashedOp(e)}},{key:"processOp",value:function(e,t,n){this.summarizerNode.invalidate(e.sequenceNumber),this.isLoaded?this.services.deltaConnection.process(e,t,n):(y(!t,405),y(void 0!==this.pending,574),this.pending.push(e),this.thresholdOpsCounter.sendIfMultiple("StorePendingOps",this.pending.length))}},{key:"reSubmit",value:function(e,t){y(this.isLoaded,406),this.services.deltaConnection.reSubmit(e,t)}},{key:"rollback",value:function(e,t){y(this.isLoaded,752),this.services.deltaConnection.rollback(e,t)}},{key:"summarize",value:function(){var e=(0,u.Z)((0,s.Z)().mark((function e(){var t,n,r,i=arguments;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=i.length>0&&void 0!==i[0]&&i[0],n=!(i.length>1&&void 0!==i[1])||i[1],r=i.length>2?i[2]:void 0,e.abrupt("return",this.summarizerNode.summarize(t,n,r));case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"summarizeInternal",value:function(){var e=(0,u.Z)((0,s.Z)().mark((function e(t,n,r){var i,o;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getChannel();case 2:return i=e.sent,e.next=5,L(i,t,n,r);case 5:return o=e.sent,e.abrupt("return",Object.assign(Object.assign({},o),{id:this.id}));case 7:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"loadChannel",value:function(){var e=(0,u.Z)((0,s.Z)().mark((function e(){var t,n,r,i,o,u;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return y(!this.isLoaded,407),e.next=3,this.services.objectStorage.contains(F);case 3:if(!e.sent){e.next=7;break}return e.next=6,(0,H.g)(this.services.objectStorage,F);case 6:t=e.sent;case 7:if(void 0!==t){e.next=16;break}if(void 0!==this.attachMessageType){e.next=10;break}throw new v.Jd("channelTypeNotAvailable",{channelId:{value:this.id,tag:S.XI.PackageData},dataStoreId:{value:this.dataStoreContext.id,tag:S.XI.PackageData},dataStorePackagePath:this.dataStoreContext.packagePath.join("/")});case 10:if(void 0!==(n=this.registry.get(this.attachMessageType))){e.next=13;break}throw new v.Jd("channelFactoryNotRegisteredForAttachMessageType",{channelId:{value:this.id,tag:S.XI.PackageData},dataStoreId:{value:this.dataStoreContext.id,tag:S.XI.PackageData},dataStorePackagePath:this.dataStoreContext.packagePath.join("/"),channelFactoryType:this.attachMessageType});case 13:t=n.attributes,e.next=19;break;case 16:if(void 0!==(n=this.registry.get(t.type))){e.next=19;break}throw new v.Jd("channelFactoryNotRegisteredForGivenType",{channelId:{value:this.id,tag:S.XI.PackageData},dataStoreId:{value:this.dataStoreContext.id,tag:S.XI.PackageData},dataStorePackagePath:this.dataStoreContext.packagePath.join("/"),channelFactoryType:t.type});case 19:return void 0!==t.snapshotFormatVersion&&t.snapshotFormatVersion!==n.attributes.snapshotFormatVersion&&this.subLogger.sendTelemetryEvent({eventName:"ChannelAttributesVersionMismatch",channelType:{value:t.type,tag:S.XI.PackageData},channelSnapshotVersion:{value:"".concat(t.snapshotFormatVersion,"@").concat(t.packageVersion),tag:S.XI.PackageData},channelCodeVersion:{value:"".concat(n.attributes.snapshotFormatVersion,"@").concat(n.attributes.packageVersion),tag:S.XI.PackageData}}),e.next=22,n.load(this.runtime,this.id,this.services,t);case 22:r=e.sent,y(void 0!==this.pending,575),i=(0,a.Z)(this.pending);try{for(i.s();!(o=i.n()).done;)u=o.value,this.services.deltaConnection.process(u,!1,void 0)}catch(s){i.e(s)}finally{i.f()}return this.thresholdOpsCounter.send("ProcessPendingOps",this.pending.length),this.channel=r,this.pending=void 0,this.isLoaded=!0,this.services.deltaConnection.setConnectionState(this.dataStoreContext.connected),e.abrupt("return",this.channel);case 32:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getGCData",value:function(){var e=(0,u.Z)((0,s.Z)().mark((function e(){var t,n=arguments;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=n.length>0&&void 0!==n[0]&&n[0],e.abrupt("return",this.summarizerNode.getGCData(t));case 2:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getGCDataInternal",value:function(){var e=(0,u.Z)((0,s.Z)().mark((function e(){var t,n,r=arguments;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=r.length>0&&void 0!==r[0]&&r[0],e.next=3,this.getChannel();case 3:return n=e.sent,e.abrupt("return",n.getGCData(t));case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"updateUsedRoutes",value:function(e,t){this.summarizerNode.updateUsedRoutes([""])}}]),e}();J.pendingOpsCountThreshold=1e3,function(e){e.Attach="attach",e.ChannelOp="op"}(q||(q={}));var Q=function(e){(0,h.Z)(n,e);var t=(0,f.Z)(n);function n(e,r,i){var o;(0,c.Z)(this,n),(o=t.call(this)).dataStoreContext=e,o.sharedObjectRegistry=r,o._disposed=!1,o.contexts=new Map,o.contextsDeferred=new Map,o.pendingAttach=new Map,o.deferredAttached=new g,o.localChannelContextQueue=new Map,o.notBoundedChannelContextSet=new Set,o.pendingHandlesToMakeVisible=new Set,y(!e.id.includes("/"),782),o.logger=S.G2.create(e.logger,"FluidDataStoreRuntime",{all:{dataStoreId:(0,P.Z)()}}),o.id=e.id,o.options=e.options,o.deltaManager=e.deltaManager,o.quorum=e.getQuorum(),o.audience=e.getAudience();var a=e.baseSnapshot;return o.channelsBaseGCDetails=new m((0,u.Z)((0,s.Z)().mark((function e(){var t,n,r,i;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,null!==(r=null===(n=(t=o.dataStoreContext).getBaseGCDetails)||void 0===n?void 0:n.call(t))&&void 0!==r?r:o.dataStoreContext.getInitialGCSummaryDetails();case 2:return i=e.sent,e.abrupt("return",(0,_.$I)(i));case 4:case"end":return e.stop()}}),e)})))),void 0!==(null===a||void 0===a?void 0:a.trees)&&Object.keys(a.trees).forEach((function(t){if("_search"!==t){var n;e.isLocalDataStore?(n=new G(t,o.sharedObjectRegistry,(0,d.Z)(o),o.dataStoreContext,o.dataStoreContext.storage,o.logger,(function(e,n){return o.submitChannelOp(t,e,n)}),(function(e){return o.setChannelDirty(e)}),(function(e,t){return o.addedGCOutboundReference(e,t)}),a.trees[t]),e.attachState!==p.mB.Detached?n.makeVisible():o.localChannelContextQueue.set(t,n)):n=new J((0,d.Z)(o),e,e.storage,(function(e,n){return o.submitChannelOp(t,e,n)}),(function(e){return o.setChannelDirty(e)}),(function(e,t){return o.addedGCOutboundReference(e,t)}),t,a.trees[t],o.sharedObjectRegistry,void 0,o.dataStoreContext.getCreateChildSummarizerNodeFn(t,{type:E.CreateSummarizerNodeSource.FromSummary}),(0,u.Z)((0,s.Z)().mark((function e(){return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",o.getChannelBaseGCDetails(t));case 1:case"end":return e.stop()}}),e)}))));var r=new g;r.resolve(n),o.contexts.set(t,n),o.contextsDeferred.set(t,r)}})),o.attachListener(),o.bindState=i?p.xU.Bound:p.xU.NotBound,o._attachState=e.attachState,o.visibilityState=i?e.attachState===p.mB.Detached?E.VisibilityState.LocallyVisible:E.VisibilityState.GloballyVisible:E.VisibilityState.NotVisible,i&&o.deferredAttached.resolve(),o}return(0,l.Z)(n,[{key:"IFluidRouter",get:function(){return this}},{key:"connected",get:function(){return this.dataStoreContext.connected}},{key:"clientId",get:function(){return this.dataStoreContext.clientId}},{key:"clientDetails",get:function(){return this.dataStoreContext.clientDetails}},{key:"isAttached",get:function(){return this.attachState!==p.mB.Detached}},{key:"attachState",get:function(){return this._attachState}},{key:"absolutePath",get:function(){return(0,T.H)(this.id,this.routeContext)}},{key:"routeContext",get:function(){return this.dataStoreContext.IFluidHandleContext}},{key:"IFluidHandleContext",get:function(){return this}},{key:"rootRoutingContext",get:function(){return this}},{key:"channelsRoutingContext",get:function(){return this}},{key:"objectsRoutingContext",get:function(){return this}},{key:"disposed",get:function(){return this._disposed}},{key:"dispose",value:function(){this._disposed||(this._disposed=!0,this.emit("dispose"),this.removeAllListeners())}},{key:"resolveHandle",value:function(){var e=(0,u.Z)((0,s.Z)().mark((function e(t){return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.request(t));case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"request",value:function(){var e=(0,u.Z)((0,s.Z)().mark((function e(t){var n,r,i,o;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,n=I.R.create(t),"_channels"!==(r=n.pathParts[0])&&"_custom"!==r){e.next=5;break}return e.abrupt("return",this.request(n.createSubRequest(1)));case 5:if(!this.contextsDeferred.has(r)||!n.isLeaf(1)){e.next=20;break}return e.prev=6,e.next=9,this.contextsDeferred.get(r).promise;case 9:return i=e.sent,e.next=12,i.getChannel();case 12:return o=e.sent,e.abrupt("return",{mimeType:"fluid/object",status:200,value:o});case 16:return e.prev=16,e.t0=e.catch(6),this.logger.sendErrorEvent({eventName:"GetChannelFailedInRequest"},e.t0),e.abrupt("return",(0,A.Ys)(500,"Failed to get Channel: ".concat(e.t0),t));case 20:return e.abrupt("return",(0,A.I4)(t));case 23:return e.prev=23,e.t1=e.catch(0),e.abrupt("return",(0,A.Nj)(e.t1));case 26:case"end":return e.stop()}}),e,this,[[0,23],[6,16]])})));return function(t){return e.apply(this,arguments)}}()},{key:"getChannel",value:function(){var e=(0,u.Z)((0,s.Z)().mark((function e(t){var n,r;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.verifyNotClosed(),this.contextsDeferred.has(t)||this.contextsDeferred.set(t,new g),e.next=4,this.contextsDeferred.get(t).promise;case 4:return n=e.sent,e.next=7,n.getChannel();case 7:return r=e.sent,e.abrupt("return",r);case 9:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"createChannel",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:(0,P.Z)(),n=arguments.length>1?arguments[1]:void 0;if(t.includes("/"))throw new v.Oi("Id cannot contain slashes: ".concat(t));this.verifyNotClosed(),y(!this.contexts.has(t),377),this.notBoundedChannelContextSet.add(t);var r=new K(t,this.sharedObjectRegistry,n,this,this.dataStoreContext,this.dataStoreContext.storage,this.logger,(function(n,r){return e.submitChannelOp(t,n,r)}),(function(t){return e.setChannelDirty(t)}),(function(t,n){return e.addedGCOutboundReference(t,n)}));if(this.contexts.set(t,r),this.contextsDeferred.has(t))this.contextsDeferred.get(t).resolve(r);else{var i=new g;i.resolve(r),this.contextsDeferred.set(t,i)}return y(!!r.channel,378),r.channel}},{key:"bindChannel",value:function(e){y(this.notBoundedChannelContextSet.has(e.id),379),this.notBoundedChannelContextSet.delete(e.id),this.isAttached?this.attachChannel(e):this.pendingHandlesToMakeVisible.has(e.handle)||(this.bind(e.handle),this.localChannelContextQueue.has(e.id)||this.localChannelContextQueue.set(e.id,this.contexts.get(e.id)))}},{key:"makeVisibleAndAttachGraph",value:function(){this.visibilityState===E.VisibilityState.NotVisible&&(this.visibilityState=E.VisibilityState.LocallyVisible,this.pendingHandlesToMakeVisible.forEach((function(e){e.attachGraph()})),this.pendingHandlesToMakeVisible.clear(),this.bindToContext())}},{key:"attachGraph",value:function(){this.makeVisibleAndAttachGraph()}},{key:"bindToContext",value:function(){this.bindState===p.xU.NotBound&&(this.bindState=p.xU.Binding,this.dataStoreContext.bindToContext(),this.bindState=p.xU.Bound)}},{key:"bind",value:function(e){this.visibilityState===E.VisibilityState.NotVisible?this.pendingHandlesToMakeVisible.add(e):e.attachGraph()}},{key:"setConnectionState",value:function(e,t){this.verifyNotClosed();var n,r=(0,a.Z)(this.contexts);try{for(r.s();!(n=r.n()).done;){(0,o.Z)(n.value,2)[1].setConnectionState(e,t)}}catch(i){r.e(i)}finally{r.f()}(0,k.Qq)(this.logger,this,e,t)}},{key:"getQuorum",value:function(){return this.quorum}},{key:"getAudience",value:function(){return this.audience}},{key:"uploadBlob",value:function(){var e=(0,u.Z)((0,s.Z)().mark((function e(t){return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.verifyNotClosed(),e.abrupt("return",this.dataStoreContext.uploadBlob(t));case 2:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"process",value:function(e,t,n){var r=this;this.verifyNotClosed();try{switch(e.type){case q.Attach:var i=e.contents,o=i.id;if(t)y(this.pendingAttach.has(o),380),this.pendingAttach.delete(o);else{y(!this.contexts.has(o),381);var a=new Map,c=(0,x.m)(i.snapshot.entries,a),l=new J(this,this.dataStoreContext,this.dataStoreContext.storage,(function(e,t){return r.submitChannelOp(o,e,t)}),(function(e){return r.setChannelDirty(e)}),(function(e,t){return r.addedGCOutboundReference(e,t)}),o,c,this.sharedObjectRegistry,a,this.dataStoreContext.getCreateChildSummarizerNodeFn(o,{type:E.CreateSummarizerNodeSource.FromAttach,sequenceNumber:e.sequenceNumber,snapshot:i.snapshot}),(0,u.Z)((0,s.Z)().mark((function e(){return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",r.getChannelBaseGCDetails(o));case 1:case"end":return e.stop()}}),e)}))),i.type);if(this.contexts.set(o,l),this.contextsDeferred.has(o))this.contextsDeferred.get(o).resolve(l);else{var d=new g;d.resolve(l),this.contextsDeferred.set(o,d)}}break;case q.ChannelOp:this.processChannelOp(e,t,n)}this.emit("op",e)}catch(h){throw v.Hi.wrapIfUnrecognized(h,"fluidDataStoreRuntimeFailedToProcessMessage",e)}}},{key:"processSignal",value:function(e,t){this.emit("signal",e,t)}},{key:"isChannelAttached",value:function(e){return!this.notBoundedChannelContextSet.has(e)&&!this.localChannelContextQueue.has(e)&&!this.pendingAttach.has(e)}},{key:"getOutboundRoutes",value:function(){var e,t=[],n=(0,a.Z)(this.contexts);try{for(n.s();!(e=n.n()).done;){var r=(0,o.Z)(e.value,1)[0];t.push("".concat(this.absolutePath,"/").concat(r))}}catch(i){n.e(i)}finally{n.f()}return t}},{key:"updateGCNodes",value:function(e){e.addRouteToAllNodes(this.absolutePath),e.addNode("/",this.getOutboundRoutes())}},{key:"getGCData",value:function(){var e=(0,u.Z)((0,s.Z)().mark((function e(){var t,n,r=this,i=arguments;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=i.length>0&&void 0!==i[0]&&i[0],n=new _.iR,e.next=4,Promise.all(Array.from(this.contexts).filter((function(e){var t=(0,o.Z)(e,2),n=t[0];t[1];return r.isChannelAttached(n)})).map(function(){var e=(0,u.Z)((0,s.Z)().mark((function e(r){var i,a,u,c;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=(0,o.Z)(r,2),a=i[0],u=i[1],e.next=3,u.getGCData(t);case 3:c=e.sent,n.prefixAndAddNodes(a,c.gcNodes);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 4:return this.updateGCNodes(n),e.abrupt("return",n.getGCData());case 6:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"updateUsedRoutes",value:function(e,t){var n,r,i=(0,_.xu)(e),s=(0,a.Z)(i);try{for(s.s();!(r=s.n()).done;){var u=(0,o.Z)(r.value,1)[0];y(this.contexts.has(u),382)}}catch(f){s.e(f)}finally{s.f()}var c,l=(0,a.Z)(this.contexts);try{for(l.s();!(c=l.n()).done;){var d=(0,o.Z)(c.value,2),h=d[0];d[1].updateUsedRoutes(null!==(n=i.get(h))&&void 0!==n?n:[],t)}}catch(f){l.e(f)}finally{l.f()}}},{key:"addedGCOutboundReference",value:function(e,t){var n,r;null===(r=(n=this.dataStoreContext).addedGCOutboundReference)||void 0===r||r.call(n,e,t)}},{key:"getChannelBaseGCDetails",value:function(){var e=(0,u.Z)((0,s.Z)().mark((function e(t){var n,r;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.channelsBaseGCDetails;case 2:return void 0===(r=e.sent.get(t))?r={}:void 0!==(null===(n=r.gcData)||void 0===n?void 0:n.gcNodes)&&(0,_.DJ)(r.gcData.gcNodes,this.absolutePath),void 0!==r.usedRoutes&&0!==r.usedRoutes.length||(r.usedRoutes=[""]),e.abrupt("return",r);case 6:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"summarize",value:function(){var e=(0,u.Z)((0,s.Z)().mark((function e(){var t,n,r,i,a=this,c=arguments;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=c.length>0&&void 0!==c[0]&&c[0],n=!(c.length>1&&void 0!==c[1])||c[1],r=c.length>2?c[2]:void 0,i=new R.x1,e.next=6,Promise.all(Array.from(this.contexts).filter((function(e){var t=(0,o.Z)(e,2),n=t[0],r=(t[1],a.isChannelAttached(n));return y(r,383),r})).map(function(){var e=(0,u.Z)((0,s.Z)().mark((function e(a){var u,c,l,d;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return u=(0,o.Z)(a,2),c=u[0],l=u[1],e.next=3,l.summarize(t,n,r);case 3:d=e.sent,i.addWithStats(c,d);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 6:return e.abrupt("return",i.getSummaryTree());case 7:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getAttachSummary",value:function(e){this.attachGraph();var t,n=new R.x1,r=(0,a.Z)(this.contexts);try{for(r.s();!(t=r.n()).done;){var i=(0,o.Z)(t.value,2),s=i[0],u=i[1];if(!(u instanceof V))throw new C.j4("Should only be called with local channel handles");if(!this.notBoundedChannelContextSet.has(s)){var c=void 0;if(u.isLoaded){var l=u.getAttachSummary(e);y(l.summary.type===b.Tree,384),c={stats:l.stats,summary:l.summary}}else y(!!this.dataStoreContext.baseSnapshot,385),c=(0,R.S5)(this.dataStoreContext.baseSnapshot.trees[s]);n.addWithStats(s,c)}}}catch(d){r.e(d)}finally{r.f()}return n.getSummaryTree()}},{key:"submitMessage",value:function(e,t,n){this.submit(e,t,n)}},{key:"submitSignal",value:function(e,t){return this.verifyNotClosed(),this.dataStoreContext.submitSignal(e,t)}},{key:"waitAttached",value:function(){var e=(0,u.Z)((0,s.Z)().mark((function e(){return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.deferredAttached.promise);case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"attachChannel",value:function(e){if(this.verifyNotClosed(),!e.handle.isAttached){e.handle.attachGraph(),y(this.isAttached,386),y(this.visibilityState===E.VisibilityState.GloballyVisible,720);var t=D(e,!0,!1),n=(0,R.H4)(t.summary),r={id:e.id,snapshot:n,type:e.attributes.type};this.pendingAttach.set(e.id,r),this.submit(q.Attach,r),this.contexts.get(e.id).makeVisible()}}},{key:"submitChannelOp",value:function(e,t,n){var r={address:e,contents:t};this.submit(q.ChannelOp,r,n)}},{key:"submit",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0;this.verifyNotClosed(),this.dataStoreContext.submitMessage(e,t,n)}},{key:"reSubmit",value:function(e,t,n){switch(this.verifyNotClosed(),e){case q.ChannelOp:var r=t,i=this.contexts.get(r.address);y(!!i,387),i.reSubmit(r.contents,n);break;case q.Attach:this.submit(e,t,n);break;default:!function(e){throw new Error(arguments.length>1&&void 0!==arguments[1]?arguments[1]:"Unreachable Case")}(e)}}},{key:"rollback",value:function(e,t,n){if(this.verifyNotClosed(),e!==q.ChannelOp)throw new C.j4("Can't rollback ".concat(e," message"));var r=t,i=this.contexts.get(r.address);y(!!i,749),i.rollback(r.contents,n)}},{key:"applyStashedOp",value:function(){var e=(0,u.Z)((0,s.Z)().mark((function e(t){var n,r;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t,y(!!(r=this.contexts.get(n.address)),388),e.next=5,r.getChannel();case 5:return e.abrupt("return",r.applyStashedOp(n.contents));case 6:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"setChannelDirty",value:function(e){this.verifyNotClosed(),this.dataStoreContext.setChannelDirty(e)}},{key:"processChannelOp",value:function(e,t,n){this.verifyNotClosed();var r=e.contents,i=Object.assign(Object.assign({},e),{contents:r.contents}),o=this.contexts.get(r.address);return y(!!o,389),o.processOp(i,t,n),o}},{key:"attachListener",value:function(){var e=this;this.setMaxListeners(Number.MAX_SAFE_INTEGER),this.dataStoreContext.once("attaching",(function(){e.attachGraph(),e._attachState=p.mB.Attaching,y(e.visibilityState===E.VisibilityState.LocallyVisible,721),e.visibilityState=E.VisibilityState.GloballyVisible,e.localChannelContextQueue.forEach((function(e){e.makeVisible()})),e.localChannelContextQueue.clear(),e.deferredAttached.resolve(),e.emit("attaching")})),this.dataStoreContext.once("attached",(function(){y(e.visibilityState===E.VisibilityState.GloballyVisible,722),e._attachState=p.mB.Attached,e.emit("attached")}))}},{key:"verifyNotClosed",value:function(){if(this._disposed)throw new C.j4("Runtime is closed")}}],[{key:"load",value:function(e,t,r){return new n(e,t,r)}}]),n}(w),Y=function(e){return function(t){(0,h.Z)(o,t);var n=(0,f.Z)(o);function o(){return(0,c.Z)(this,o),n.apply(this,arguments)}return(0,l.Z)(o,[{key:"request",value:function(){var t=(0,u.Z)((0,s.Z)().mark((function t(n){var a;return(0,s.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,(0,r.Z)((0,i.Z)(o.prototype),"request",this).call(this,n);case 2:if(404!==(a=t.sent).status){t.next=5;break}return t.abrupt("return",e(n,this));case 5:return t.abrupt("return",a);case 6:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()}]),o}(arguments.length>1&&void 0!==arguments[1]?arguments[1]:Q)}},70163:function(e,t,n){"use strict";n.d(t,{B:function(){return u}});var r=n(74165),i=n(15861),o=n(15671),a=n(43144),s=n(87154),u=function(){function e(t,n,r){(0,o.Z)(this,e),this.value=t,this.path=n,this.routeContext=r,this.pendingHandlesToMakeVisible=new Set,this.locallyVisible=!1,this.absolutePath=(0,s.H)(n,this.routeContext)}return(0,a.Z)(e,[{key:"IFluidHandle",get:function(){return this}},{key:"isAttached",get:function(){return this.routeContext.isAttached}},{key:"visible",get:function(){return this.isAttached||this.locallyVisible}},{key:"get",value:function(){var e=(0,i.Z)((0,r.Z)().mark((function e(){return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.value);case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"attachGraph",value:function(){this.visible||(this.locallyVisible=!0,this.pendingHandlesToMakeVisible.forEach((function(e){e.attachGraph()})),this.pendingHandlesToMakeVisible.clear(),this.routeContext.attachGraph())}},{key:"bind",value:function(e){this.visible?e.attachGraph():this.pendingHandlesToMakeVisible.add(e)}}]),e}()},84871:function(e,t,n){"use strict";var r;n.d(t,{C:function(){return r}}),function(e){e.genericError="genericError",e.genericNetworkError="genericNetworkError",e.authorizationError="authorizationError",e.fileNotFoundOrAccessDeniedError="fileNotFoundOrAccessDeniedError",e.throttlingError="throttlingError",e.offlineError="offlineError",e.unsupportedClientProtocolVersion="unsupportedClientProtocolVersion",e.writeError="writeError",e.fetchFailure="fetchFailure",e.incorrectServerResponse="incorrectServerResponse",e.fileOverwrittenInStorage="fileOverwrittenInStorage",e.deltaStreamConnectionForbidden="deltaStreamConnectionForbidden",e.locationRedirection="locationRedirection"}(r||(r={}))},54823:function(e,t,n){"use strict";var r;n.d(t,{i:function(){return r}}),function(e){e.summarizingClient="fluid-client-summarizer",e.createNew="createNew"}(r||(r={}))},69751:function(e,t,n){"use strict";n.d(t,{m:function(){return f}});var r,i,o=n(93433),a=n(37762),s=n(2533),u=n(9997);!function(e){e.File="100644",e.Executable="100755",e.Directory="040000",e.Symlink="120000"}(r||(r={})),function(e){e.Blob="Blob",e.Tree="Tree",e.Attachment="Attachment"}(i||(i={}));var c=n(29299),l=n(39575);function d(e,t,n){var c,h=[],f=(0,a.Z)(t);try{for(f.s();!(c=f.n()).done;){var p=c.value,v="".concat(e).concat(p.path);if(p.type===i.Blob){var g=p.value,m=(0,s.k8)(g.contents,g.encoding),y=(0,l.Z)();n.set(y,m);var b={mode:r[p.mode],path:v,sha:y,size:0,type:"blob",url:""};h.push(b)}else if(p.type===i.Tree){(0,u.h)(p.type===i.Tree,257);var w=p.value,S={mode:r[p.mode],path:v,sha:"",size:-1,type:"tree",url:""};h.push(S);var k=d("".concat(v,"/"),w.entries,n);h.push.apply(h,(0,o.Z)(k))}}}catch(C){f.e(C)}finally{f.f()}return h}function h(e,t){return{sha:"",tree:d("",e,t),url:""}}function f(e,t){var n=h(e,t);return(0,c.eB)(n)}},91033:function(e,t,n){"use strict";n.d(t,{P:function(){return s}});var r=n(74165),i=n(15861),o=n(15671),a=n(43144),s=function(){function e(t){(0,o.Z)(this,e),this.internalStorageService=t}return(0,a.Z)(e,[{key:"policies",get:function(){var e;return null!==(e=this._policies)&&void 0!==e?e:this.internalStorageService.policies},set:function(e){this._policies=e}},{key:"repositoryUrl",get:function(){return this.internalStorageService.repositoryUrl}},{key:"getSnapshotTree",value:function(){var e=(0,i.Z)((0,r.Z)().mark((function e(t,n){return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.internalStorageService.getSnapshotTree(t,n));case 1:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"getVersions",value:function(){var e=(0,i.Z)((0,r.Z)().mark((function e(t,n,i){return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.internalStorageService.getVersions(t,n,i));case 1:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"uploadSummaryWithContext",value:function(){var e=(0,i.Z)((0,r.Z)().mark((function e(t,n){return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.internalStorageService.uploadSummaryWithContext(t,n));case 1:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"downloadSummary",value:function(){var e=(0,i.Z)((0,r.Z)().mark((function e(t){return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.internalStorageService.downloadSummary(t));case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"createBlob",value:function(){var e=(0,i.Z)((0,r.Z)().mark((function e(t){return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.internalStorageService.createBlob(t));case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"readBlob",value:function(){var e=(0,i.Z)((0,r.Z)().mark((function e(t){return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.internalStorageService.readBlob(t));case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),e}()},65922:function(e,t,n){"use strict";var r,i,o;function a(e){if(s(e))return!0;switch(e.type){case r.Propose:case r.Reject:case r.NoOp:return!0;default:return!1}}function s(e){return e.type===r.Operation||e.type===r.Summarize}function u(e){return!!Object.values(o).includes(e.type)}n.d(t,{ag:function(){return a},LW:function(){return s},_V:function(){return u}}),function(e){e.NoOp="noop",e.ClientJoin="join",e.ClientLeave="leave",e.Propose="propose",e.Reject="reject",e.Summarize="summarize",e.SummaryAck="summaryAck",e.SummaryNack="summaryNack",e.Operation="op",e.RemoteHelp="remoteHelp",e.NoClient="noClient",e.RoundTrip="tripComplete",e.Control="control"}(r||(r={})),function(e){e.ThrottlingError="ThrottlingError",e.InvalidScopeError="InvalidScopeError",e.BadRequestError="BadRequestError",e.LimitExceededError="LimitExceededError"}(i||(i={})),function(e){e.FluidDataStoreOp="component",e.Attach="attach",e.ChunkedOp="chunkedOp",e.BlobAttach="blobAttach",e.Rejoin="rejoin",e.Alias="alias",e.Operation="op"}(o||(o={}))},1244:function(e,t,n){"use strict";n.d(t,{GS:function(){return k},Gg:function(){return d},M_:function(){return v},V2:function(){return m},Xp:function(){return h},Yz:function(){return i},ZZ:function(){return C},j:function(){return b},jx:function(){return w},ms:function(){return S},y7:function(){return p}});var r,i,o=n(43144),a=n(15671),s=n(60136),u=n(29388),c=n(84871),l=n(65059);function d(){return"object"===typeof navigator&&null!==navigator&&"boolean"===typeof navigator.onLine?navigator.onLine?i.Online:i.Offline:i.Unknown}!function(e){e[e.Offline=0]="Offline",e[e.Online=1]="Online",e[e.Unknown=2]="Unknown"}(i||(i={}));var h=function(e){(0,s.Z)(n,e);var t=(0,u.Z)(n);function n(e,r,i){var o;return(0,a.Z)(this,n),(o=t.call(this,e,i)).canRetry=r,o.errorType=c.C.genericNetworkError,o}return(0,o.Z)(n)}(l.j4),f="deltaStreamConnectionForbidden",p=function(e){(0,s.Z)(n,e);var t=(0,u.Z)(n);function n(e,r){var i;return(0,a.Z)(this,n),(i=t.call(this,e,Object.assign(Object.assign({},r),{statusCode:400}))).errorType=n.errorType,i.canRetry=!1,i}return(0,o.Z)(n)}(l.j4);p.errorType=null!==(r=c.C[f])&&void 0!==r?r:f;var v=function(e){(0,s.Z)(n,e);var t=(0,u.Z)(n);function n(e,r,i,o){var s;return(0,a.Z)(this,n),(s=t.call(this,e,o,new Set(["claims","tenantId"]))).claims=r,s.tenantId=i,s.errorType=c.C.authorizationError,s.canRetry=!1,s}return(0,o.Z)(n)}(l.j4),g=function(e){(0,s.Z)(n,e);var t=(0,u.Z)(n);function n(e,r,i,o){var s;return(0,a.Z)(this,n),(s=t.call(this,e,o)).errorType=r,s.canRetry=i,s}return(0,o.Z)(n)}(l.j4),m=function(e){(0,s.Z)(n,e);var t=(0,u.Z)(n);function n(e,r,i){var o;return(0,a.Z)(this,n),(o=t.call(this,e,r,!1,i)).errorType=r,o}return(0,o.Z)(n)}(g),y=function(e){(0,s.Z)(n,e);var t=(0,u.Z)(n);function n(e,r,i){var o;return(0,a.Z)(this,n),(o=t.call(this,e,i)).retryAfterSeconds=r,o.errorType=c.C.throttlingError,o.canRetry=!0,o}return(0,o.Z)(n)}(l.j4),b=function(e,t){return new m(e,c.C.writeError,t)};function w(e,t,n){return void 0!==t.retryAfterMs&&t.canRetry?new y(e,t.retryAfterMs/1e3,n):new h(e,t.canRetry,n)}var S=function(e){return!0===(null===e||void 0===e?void 0:e.canRetry)},k=function(e){return null===e||void 0===e?void 0:e.retryAfterSeconds},C=function(e){return void 0!==(null===e||void 0===e?void 0:e.retryAfterSeconds)?1e3*e.retryAfterSeconds:void 0}},91688:function(e,t,n){"use strict";n.d(t,{g:function(){return a}});var r=n(74165),i=n(15861),o=n(2533);function a(e,t){return s.apply(this,arguments)}function s(){return(s=(0,i.Z)((0,r.Z)().mark((function e(t,n){var i,a;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.readBlob(n);case 2:return i=e.sent,a=(0,o.zT)(i,"utf8"),e.abrupt("return",JSON.parse(a));case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}},9997:function(e,t,n){"use strict";function r(e,t){if(!e)throw new Error("number"===typeof t?"0x".concat(t.toString(16).padStart(3,"0")):t)}n.d(t,{h:function(){return r}})},2533:function(e,t,n){"use strict";n.d(t,{k8:function(){return l},pv:function(){return f},zT:function(){return d}});var r=n(15671),i=n(43144),o=n(60136),a=n(29388),s=n(28664),u=n(2009),c=n(9997);var l=function(e,t){return f.from(e,t).buffer},d=function(e,t){return f.from(e).toString(t)};function h(e){var t=e;return e instanceof ArrayBuffer||"object"===typeof t&&null!==t&&"number"===typeof t.byteLength&&"function"===typeof t.slice&&void 0===t.byteOffset&&void 0===t.buffer}var f=function(e){(0,o.Z)(n,e);var t=(0,a.Z)(n);function n(){return(0,r.Z)(this,n),t.apply(this,arguments)}return(0,i.Z)(n,[{key:"toString",value:function(e){return function(e,t){switch(t){case"base64":return u.fromByteArray(e);case"utf8":case"utf-8":case void 0:return(new TextDecoder).decode(e);default:throw new Error("invalid/unsupported encoding")}}(this,e)}}],[{key:"from",value:function(e,t,r){if("string"===typeof e)return n.fromString(e,t);if(null!==e&&"object"===typeof e&&h(e.buffer))return(0,c.h)(0===e.byteOffset,0),(0,c.h)(e.byteLength===e.buffer.byteLength,1),n.fromArrayBuffer(e.buffer,t,r);if(h(e))return n.fromArrayBuffer(e,t,r);throw new TypeError}},{key:"fromArrayBuffer",value:function(e,t,r){var i=null!==t&&void 0!==t?t:0,o=null!==r&&void 0!==r?r:e.byteLength-i;if(i<0||i>e.byteLength||o<0||o+i>e.byteLength)throw new RangeError;return new n(e,i,o)}},{key:"fromString",value:function(e,t){switch(t){case"base64":var r=this.sanitizeBase64(e);return new n(u.toByteArray(r).buffer);case"utf8":case"utf-8":case void 0:return new n((new TextEncoder).encode(e).buffer);default:throw new Error("invalid/unsupported encoding")}}},{key:"isBuffer",value:function(e){throw new Error("unimplemented")}},{key:"sanitizeBase64",value:function(e){var t=e;if((t=(t=t.split("=")[0]).replace(/[^\w+-/]/g,"")).length%4!==0){t+=["","===","==","="][t.length%4]}return t}}]),n}((0,s.Z)(Uint8Array))},99039:function(e,t,n){"use strict";n.d(t,{G:function(){return c}});var r=n(74165),i=n(15861),o=n(15671),a=n(43144),s=n(60136),u=n(29388),c=function(e){(0,s.Z)(n,e);var t=(0,u.Z)(n);function n(e,r){var i;return(0,o.Z)(this,n),(i=t.call(this)).container=e,i.rootDataObject=r,i.connectedHandler=function(){return i.emit("connected")},i.disconnectedHandler=function(){return i.emit("disconnected")},i.disposedHandler=function(e){return i.emit("disposed",e)},i.savedHandler=function(){return i.emit("saved")},i.dirtyHandler=function(){return i.emit("dirty")},e.on("connected",i.connectedHandler),e.on("closed",i.disposedHandler),e.on("disconnected",i.disconnectedHandler),e.on("saved",i.savedHandler),e.on("dirty",i.dirtyHandler),i}return(0,a.Z)(n,[{key:"isDirty",get:function(){return this.container.isDirty}},{key:"attachState",get:function(){return this.container.attachState}},{key:"disposed",get:function(){return this.container.closed}},{key:"connectionState",get:function(){return this.container.connectionState}},{key:"initialObjects",get:function(){return this.rootDataObject.initialObjects}},{key:"attach",value:function(){var e=(0,i.Z)((0,r.Z)().mark((function e(){return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new Error("Cannot attach container. Container is not in detached state");case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"connect",value:function(){var e=(0,i.Z)((0,r.Z)().mark((function e(){var t,n;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:null===(n=(t=this.container).connect)||void 0===n||n.call(t);case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"disconnect",value:function(){var e=(0,i.Z)((0,r.Z)().mark((function e(){var t,n;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:null===(n=(t=this.container).disconnect)||void 0===n||n.call(t);case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"create",value:function(){var e=(0,i.Z)((0,r.Z)().mark((function e(t){return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.rootDataObject.create(t));case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"dispose",value:function(){this.container.close(),this.container.off("connected",this.connectedHandler),this.container.off("closed",this.disposedHandler),this.container.off("disconnected",this.disconnectedHandler),this.container.off("saved",this.savedHandler),this.container.off("dirty",this.dirtyHandler)}}]),n}(n(87918).L)},80124:function(e,t,n){"use strict";n.d(t,{Y:function(){return k},i:function(){return w}});var r=n(93433),i=n(4942),o=n(74165),a=n(29439),s=n(15861),u=n(15671),c=n(43144),l=n(60136),d=n(29388),h=n(35537),f=n(91693),p=n(84488),v=n(94104),g=n(62790),m=n(63760),y=function(e){return void 0!==(null===e||void 0===e?void 0:e.factory)},b=function(e){return void 0!==(null===e||void 0===e?void 0:e.getFactory)},w=function(e){(0,l.Z)(n,e);var t=(0,d.Z)(n);function n(){var e;return(0,u.Z)(this,n),(e=t.apply(this,arguments)).initialObjectsDirKey="initial-objects-key",e._initialObjects={},e}return(0,c.Z)(n,[{key:"initialObjectsDir",get:function(){var e=this.root.getSubDirectory(this.initialObjectsDirKey);if(void 0===e)throw new Error("InitialObjects sub-directory was not initialized");return e}},{key:"initializingFirstTime",value:function(){var e=(0,s.Z)((0,o.Z)().mark((function e(t){var n,r=this;return(0,o.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.root.createSubDirectory(this.initialObjectsDirKey),n=[],Object.entries(t.initialObjects).forEach((function(e){var t=(0,a.Z)(e,2),i=t[0],u=t[1],c=function(){var e=(0,s.Z)((0,o.Z)().mark((function e(){var t;return(0,o.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r.create(u);case 2:t=e.sent,r.initialObjectsDir.set(i,t.handle);case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();n.push(c())})),e.next=5,Promise.all(n);case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"hasInitialized",value:function(){var e=(0,s.Z)((0,o.Z)().mark((function e(){var t,n,r,u,c=this;return(0,o.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=[],n=(0,o.Z)().mark((function e(){var n,l,d,h;return(0,o.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=(0,a.Z)(u[r],2),l=n[0],d=n[1],h=function(){var e=(0,s.Z)((0,o.Z)().mark((function e(){var t;return(0,o.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,d.get();case 2:t=e.sent,Object.assign(c._initialObjects,(0,i.Z)({},l,t));case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),t.push(h());case 3:case"end":return e.stop()}}),e)})),r=0,u=Array.from(this.initialObjectsDir.entries());case 3:if(!(r<u.length)){e.next=8;break}return e.delegateYield(n(),"t0",5);case 5:r++,e.next=3;break;case 8:return e.next=10,Promise.all(t);case 10:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"initialObjects",get:function(){if(0===Object.keys(this._initialObjects).length)throw new Error("Initial Objects were not correctly initialized");return this._initialObjects}},{key:"create",value:function(){var e=(0,s.Z)((0,o.Z)().mark((function e(t){return(0,o.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!y(t)){e.next=4;break}return e.abrupt("return",this.createDataObject(t));case 4:if(!b(t)){e.next=6;break}return e.abrupt("return",this.createSharedObject(t));case 6:throw new Error("Could not create new Fluid object because an unknown object was passed");case 7:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"createDataObject",value:function(){var e=(0,s.Z)((0,o.Z)().mark((function e(t){var n,i,a;return(0,o.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.factory,i=[].concat((0,r.Z)(this.context.packagePath),[n.type]),e.next=4,this.context.containerRuntime.createDataStore(i);case 4:return a=e.sent,e.abrupt("return",(0,m.bb)(a,"/"));case 6:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"createSharedObject",value:function(e){var t=e.getFactory();return this.runtime.createChannel(void 0,t.type)}}]),n}(h.L),S="rootDOId",k=function(e){(0,l.Z)(n,e);var t=(0,d.Z)(n);function n(e){var i;(0,u.Z)(this,n);var o=function(e){var t,n=new Set,i=new Set;if(new Set([].concat((0,r.Z)(Object.values(e.initialObjects)),(0,r.Z)(null!==(t=e.dynamicObjectTypes)&&void 0!==t?t:[]))).forEach((function(e){if(b(e))i.add(e.getFactory());else{if(!y(e))throw new Error("Entry is neither a DataObject or a SharedObject");n.add([e.factory.type,Promise.resolve(e.factory)])}})),0===n.size&&0===i.size)throw new Error("Container cannot be initialized without any DataTypes");return[Array.from(n),Array.from(i)]}(e),s=(0,a.Z)(o,2),c=s[0],l=s[1],d=new f.M("rootDO",w,l,{},c);return(i=t.call(this,[d.registryEntry],void 0,[(0,p.cd)(S)],{flushMode:g.FlushMode.Immediate})).rootDataObjectFactory=d,i.initialObjects=e.initialObjects,i}return(0,c.Z)(n,[{key:"containerInitializingFirstTime",value:function(){var e=(0,s.Z)((0,o.Z)().mark((function e(t){return(0,o.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.rootDataObjectFactory.createRootInstance(S,t,{initialObjects:this.initialObjects});case 2:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),n}(v.I)},11071:function(e,t,n){"use strict";n.d(t,{c:function(){return s}});var r=n(15671),i=n(43144),o=n(60136),a=n(29388),s=function(e){(0,o.Z)(n,e);var t=(0,a.Z)(n);function n(e){var i;return(0,r.Z)(this,n),(i=t.call(this)).container=e,i.lastMembers=new Map,i.audience=e.audience,i.getMembers(),i.audience.on("addMember",(function(e,t){if(i.shouldIncludeAsMember(t)){var n=i.getMember(e);i.emit("memberAdded",e,n),i.emit("membersChanged")}})),i.audience.on("removeMember",(function(e){i.lastMembers.has(e)&&(i.emit("memberRemoved",e,i.lastMembers.get(e)),i.emit("membersChanged"))})),i.container.on("connected",(function(){return i.emit("membersChanged")})),i}return(0,i.Z)(n,[{key:"getMembers",value:function(){var e=this,t=new Map,n=new Map;return this.audience.getMembers().forEach((function(r,i){if(e.shouldIncludeAsMember(r)){var o=r.user.id,a=t.get(o);void 0===a&&(a=e.createServiceMember(r),t.set(o,a)),a.connections.push({id:i,mode:r.mode}),n.set(i,a)}})),this.lastMembers=n,t}},{key:"getMyself",value:function(){var e=this.container.clientId;if(void 0!==e)return this.getMember(e)}},{key:"getMember",value:function(e){var t=this.audience.getMember(e);if(void 0!==t){var n=this.getMembers().get(null===t||void 0===t?void 0:t.user.id);if(void 0===n)throw Error("Attempted to fetch client ".concat(e," that is not part of the current member list"));return n}}},{key:"shouldIncludeAsMember",value:function(e){return e.details.capabilities.interactive}}]),n}(n(87918).L)},87918:function(e,t,n){"use strict";n.d(t,{L:function(){return d}});var r=n(43144),i=n(15671),o=n(97326),a=n(60136),s=n(29388),u=n(11752),c=n(61120),l=n(47465),d=function(e){(0,a.Z)(n,e);var t=(0,s.Z)(n);function n(){var e,r,a,s,l,d,h,f;return(0,i.Z)(this,n),(f=t.call(this)).addListener=(0,u.Z)((e=(0,o.Z)(f),(0,c.Z)(n.prototype)),"addListener",e).bind((0,o.Z)(f)),f.on=(0,u.Z)((r=(0,o.Z)(f),(0,c.Z)(n.prototype)),"on",r).bind((0,o.Z)(f)),f.once=(0,u.Z)((a=(0,o.Z)(f),(0,c.Z)(n.prototype)),"once",a).bind((0,o.Z)(f)),f.prependListener=(0,u.Z)((s=(0,o.Z)(f),(0,c.Z)(n.prototype)),"prependListener",s).bind((0,o.Z)(f)),f.prependOnceListener=(0,u.Z)((l=(0,o.Z)(f),(0,c.Z)(n.prototype)),"prependOnceListener",l).bind((0,o.Z)(f)),f.removeListener=(0,u.Z)((d=(0,o.Z)(f),(0,c.Z)(n.prototype)),"removeListener",d).bind((0,o.Z)(f)),f.off=(0,u.Z)((h=(0,o.Z)(f),(0,c.Z)(n.prototype)),"off",h).bind((0,o.Z)(f)),f}return(0,r.Z)(n)}(l.EventEmitter)},20644:function(e,t,n){"use strict";n.d(t,{iR:function(){return m},rn:function(){return d},$4:function(){return g},eF:function(){return v},DJ:function(){return p},aG:function(){return c},$I:function(){return h},xu:function(){return f}});var r=n(15671),i=n(43144),o=n(37762),a=n(93433),s=n(29439);function u(e,t){if(!e)throw new Error("number"===typeof t?"0x".concat(t.toString(16).padStart(3,"0")):t)}function c(e){return e.replace(/^\/+|\/+$/g,"")}function l(e){return e.replace(/\/+$/g,"")}function d(e){for(var t={},n=0,r=Object.entries(e.gcNodes);n<r.length;n++){var i=(0,s.Z)(r[n],2),o=i[0],a=i[1];t[o]=Array.from(a)}return{gcNodes:t}}function h(e){var t=new Map;if(void 0===e.gcData)return t;var n=e.gcData.gcNodes;delete n["/"];for(var r=0,i=Object.entries(n);r<i.length;r++){var c=(0,s.Z)(i[r],2),l=c[0],d=c[1];u(l.startsWith("/"),686);var h=l.split("/")[1],f=l.slice(h.length+1);""===f&&(f="/");var p=t.get(h);void 0===p&&(p={gcData:{gcNodes:{}},usedRoutes:[]}),u(void 0!==p.gcData,687),p.gcData.gcNodes[f]=(0,a.Z)(new Set(d)),t.set(h,p)}if(void 0===e.usedRoutes)return t;var v,g=e.usedRoutes.filter((function(e){return""!==e&&"/"!==e})),m=(0,o.Z)(g);try{for(m.s();!(v=m.n()).done;){var y=v.value;u(y.startsWith("/"),688);var b=y.split("/")[1],w=y.slice(b.length+1),S=t.get(b);u(void 0!==(null===S||void 0===S?void 0:S.usedRoutes),689),S.usedRoutes.push(w),t.set(b,S)}}catch(k){m.e(k)}finally{m.f()}return t}function f(e){var t,n=e.filter((function(e){return""!==e&&"/"!==e})),r=new Map,i=(0,o.Z)(n);try{for(i.s();!(t=i.n()).done;){var a=t.value;u(a.startsWith("/"),408);var s=a.split("/")[1],c=a.slice(s.length+1),l=r.get(s);void 0!==l?l.push(c):r.set(s,[c])}}catch(d){i.e(d)}finally{i.f()}return r}function p(e,t){for(var n=0,r=Object.entries(e);n<r.length;n++){var i=(0,s.Z)(r[n],2),o=i[0],u=i[1],c=new Set(u);c.delete(t),e[o]=(0,a.Z)(c)}}function v(e,t){for(var n,r={},i=0,o=Object.entries(e.gcNodes);i<o.length;i++){var c=(0,s.Z)(o[i],2),l=c[0],d=c[1];r[l]={outboundRoutes:Array.from(d.outboundRoutes),unreferencedTimestampMs:d.unreferencedTimestampMs}}for(var h=0,f=Object.entries(t.gcNodes);h<f.length;h++){var p=(0,s.Z)(f[h],2),v=p[0],g=p[1],m=r[v];void 0===m?m={outboundRoutes:Array.from(g.outboundRoutes),unreferencedTimestampMs:g.unreferencedTimestampMs}:(void 0!==g.unreferencedTimestampMs&&void 0!==m.unreferencedTimestampMs&&u(g.unreferencedTimestampMs===m.unreferencedTimestampMs,690),m={outboundRoutes:(0,a.Z)(new Set([].concat((0,a.Z)(g.outboundRoutes),(0,a.Z)(m.outboundRoutes)))),unreferencedTimestampMs:null!==(n=g.unreferencedTimestampMs)&&void 0!==n?n:m.unreferencedTimestampMs}),r[v]=m}return{gcNodes:r}}function g(e,t){for(var n=d(e),r=0,i=Object.entries(t.gcNodes);r<i.length;r++){var o=(0,s.Z)(i[r],2),u=o[0],c=o[1];if(void 0===n.gcNodes[u])n.gcNodes[u]=Array.from(c);else{var l=[].concat((0,a.Z)(c),(0,a.Z)(n.gcNodes[u]));n.gcNodes[u]=(0,a.Z)(new Set(l))}}return n}var m=function(){function e(){(0,r.Z)(this,e),this.gcNodesSet={}}return(0,i.Z)(e,[{key:"gcNodes",get:function(){for(var e={},t=0,n=Object.entries(this.gcNodesSet);t<n.length;t++){var r=(0,s.Z)(n[t],2),i=r[0],o=r[1];e[i]=(0,a.Z)(o)}return e}},{key:"addNode",value:function(e,t){this.gcNodesSet[e]=new Set(t)}},{key:"prefixAndAddNodes",value:function(e,t){for(var n=0,r=Object.entries(t);n<r.length;n++){var i=(0,s.Z)(r[n],2),o=i[0],a=i[1],u=o.replace(/^\/+/g,"");u=l(u="/".concat(e,"/").concat(u)),this.gcNodesSet[u]=new Set(a)}}},{key:"addNodes",value:function(e){for(var t=0,n=Object.entries(e);t<n.length;t++){var r=(0,s.Z)(n[t],2),i=r[0],o=r[1];this.gcNodesSet[i]=new Set(o)}}},{key:"addRouteToAllNodes",value:function(e){for(var t=0,n=Object.values(this.gcNodesSet);t<n.length;t++){n[t].add(e)}}},{key:"getGCData",value:function(){return{gcNodes:this.gcNodes}}}]),e}()},24615:function(e,t,n){"use strict";n.d(t,{y:function(){return _},u:function(){return P}});var r,i,o=n(4942),a=n(29439),s=n(37762),u=n(97326),c=n(60136),l=n(29388),d=n(74165),h=n(15861),f=n(15671),p=n(43144),v=n(18012),g=n(11752),m=n(61120),y=function(e){(0,c.Z)(n,e);var t=(0,l.Z)(n);function n(){var e,r,i,o,a,s,c,l;return(0,f.Z)(this,n),(l=t.call(this)).addListener=(0,g.Z)((e=(0,u.Z)(l),(0,m.Z)(n.prototype)),"addListener",e).bind((0,u.Z)(l)),l.on=(0,g.Z)((r=(0,u.Z)(l),(0,m.Z)(n.prototype)),"on",r).bind((0,u.Z)(l)),l.once=(0,g.Z)((i=(0,u.Z)(l),(0,m.Z)(n.prototype)),"once",i).bind((0,u.Z)(l)),l.prependListener=(0,g.Z)((o=(0,u.Z)(l),(0,m.Z)(n.prototype)),"prependListener",o).bind((0,u.Z)(l)),l.prependOnceListener=(0,g.Z)((a=(0,u.Z)(l),(0,m.Z)(n.prototype)),"prependOnceListener",a).bind((0,u.Z)(l)),l.removeListener=(0,g.Z)((s=(0,u.Z)(l),(0,m.Z)(n.prototype)),"removeListener",s).bind((0,u.Z)(l)),l.off=(0,g.Z)((c=(0,u.Z)(l),(0,m.Z)(n.prototype)),"off",c).bind((0,u.Z)(l)),l}return(0,p.Z)(n)}(n(47465).EventEmitter),b=n(10357),w=n(91688),S=n(90586),k=n(25006),C=n(97468),x=n(91869),E=n(5982),T=n(57994),I=n(55476),A=E.posix,R="header",_=function(){function e(){(0,f.Z)(this,e)}return(0,p.Z)(e,[{key:"type",get:function(){return e.Type}},{key:"attributes",get:function(){return e.Attributes}},{key:"load",value:function(){var e=(0,h.Z)((0,d.Z)().mark((function e(t,n,r,i){var o;return(0,d.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=new P(n,t,i),e.next=3,o.load(r);case 3:return e.abrupt("return",o);case 4:case"end":return e.stop()}}),e)})));return function(t,n,r,i){return e.apply(this,arguments)}}()},{key:"create",value:function(t,n){var r=new P(n,t,e.Attributes);return r.initializeLocal(),r}}]),e}();_.Type="https://graph.microsoft.com/types/directory",_.Attributes={type:_.Type,snapshotFormatVersion:"0.1",packageVersion:I.Z};var P=function(e,t){(0,c.Z)(i,e);var n=(0,l.Z)(i);function i(e,t,o){var a;return(0,f.Z)(this,i),(a=n.call(this,e,t,o,"fluid_directory_"))[r]="SharedDirectory",a.root=new F((0,u.Z)(a),a.runtime,a.serializer,A.sep),a.messageHandlers=new Map,a.localValueMaker=new T.oU(a.serializer),a.setMessageHandlers(),a.root.on("containedValueChanged",(function(e,t){a.emit("containedValueChanged",e,t,(0,u.Z)(a))})),a.root.on("subDirectoryCreated",(function(e,t){a.emit("subDirectoryCreated",e,t,(0,u.Z)(a))})),a.root.on("subDirectoryDeleted",(function(e,t){a.emit("subDirectoryDeleted",e,t,(0,u.Z)(a))})),a}return(0,p.Z)(i,[{key:"absolutePath",get:function(){return this.root.absolutePath}},{key:"get",value:function(e){return this.root.get(e)}},{key:"set",value:function(e,t){return this.root.set(e,t),this}},{key:"dispose",value:function(e){this.root.dispose(e)}},{key:"disposed",get:function(){return this.root.disposed}},{key:"delete",value:function(e){return this.root.delete(e)}},{key:"clear",value:function(){this.root.clear()}},{key:"has",value:function(e){return this.root.has(e)}},{key:"size",get:function(){return this.root.size}},{key:"forEach",value:function(e){this.root.forEach(e)}},{key:t,value:function(){return this.root[Symbol.iterator]()}},{key:"entries",value:function(){return this.root.entries()}},{key:"countSubDirectory",value:function(){return this.root.countSubDirectory()}},{key:"keys",value:function(){return this.root.keys()}},{key:"values",value:function(){return this.root.values()}},{key:"createSubDirectory",value:function(e){return this.root.createSubDirectory(e)}},{key:"getSubDirectory",value:function(e){return this.root.getSubDirectory(e)}},{key:"hasSubDirectory",value:function(e){return this.root.hasSubDirectory(e)}},{key:"deleteSubDirectory",value:function(e){return this.root.deleteSubDirectory(e)}},{key:"subdirectories",value:function(){return this.root.subdirectories()}},{key:"getWorkingDirectory",value:function(e){var t=this.makeAbsolute(e);if(t===A.sep)return this.root;var n,r=this.root,i=t.substr(1).split(A.sep),o=(0,s.Z)(i);try{for(o.s();!(n=o.n()).done;){var a=n.value;if(!(r=r.getSubDirectory(a)))return}}catch(u){o.e(u)}finally{o.f()}return r}},{key:"summarizeCore",value:function(e,t){return this.serializeDirectory(this.root,e)}},{key:"submitDirectoryMessage",value:function(e,t){this.submitLocalMessage(e,t)}},{key:"onDisconnect",value:function(){}},{key:"reSubmitCore",value:function(e,t){var n=e,r=this.messageHandlers.get(n.type);(0,v.h)(void 0!==r,13),r.submit(n,t)}},{key:"loadCore",value:function(){var e=(0,h.Z)((0,d.Z)().mark((function e(t){var n,r,i=this;return(0,d.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,w.g)(t,R);case 2:if(n=e.sent,r=n,!Array.isArray(r.blobs)){e.next=10;break}return this.populate(r.content),e.next=8,Promise.all(r.blobs.map(function(){var e=(0,h.Z)((0,d.Z)().mark((function e(n){var r;return(0,d.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,w.g)(t,n);case 2:r=e.sent,i.populate(r);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 8:e.next=11;break;case 10:this.populate(n);case 11:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"populate",value:function(e){var t=[];for(t.push([this.root,e]);t.length>0;){var n=t.pop(),r=(0,a.Z)(n,2),i=r[0],o=r[1];if(o.subdirectories)for(var s=0,u=Object.entries(o.subdirectories);s<u.length;s++){var c=(0,a.Z)(u[s],2),l=c[0],d=c[1],h=i.getSubDirectory(l);h||(h=new F(this,this.runtime,this.serializer,A.join(i.absolutePath,l)),i.populateSubDirectory(l,h)),t.push([h,d])}if(o.storage)for(var f=0,p=Object.entries(o.storage);f<p.length;f++){var v=(0,a.Z)(p[f],2),g=v[0],m=v[1],y=this.makeLocal(g,i.absolutePath,m);i.populateStorage(g,y)}}}},{key:"processCore",value:function(e,t,n){if(e.type===S.C.Operation){var r=e.contents,i=this.messageHandlers.get(r.type);(0,v.h)(void 0!==i,14),i.process(r,t,n)}}},{key:"rollback",value:function(e,t){var n=e,r=this.getWorkingDirectory(n.path);r&&r.rollback(n,t)}},{key:"makeAbsolute",value:function(e){return A.resolve(A.sep,e)}},{key:"makeLocal",value:function(e,t,n){return(0,v.h)(n.type===k.G[k.G.Plain]||n.type===k.G[k.G.Shared],484),this.localValueMaker.fromSerializable(n)}},{key:"setMessageHandlers",value:function(){var e=this;this.messageHandlers.set("clear",{process:function(t,n,r){var i=e.getWorkingDirectory(t.path);i&&i.processClearMessage(t,n,r)},submit:function(t,n){var r=e.getWorkingDirectory(t.path);r&&r.resubmitClearMessage(t,n)}}),this.messageHandlers.set("delete",{process:function(t,n,r){var i=e.getWorkingDirectory(t.path);i&&i.processDeleteMessage(t,n,r)},submit:function(t,n){var r=e.getWorkingDirectory(t.path);r&&r.resubmitKeyMessage(t,n)}}),this.messageHandlers.set("set",{process:function(t,n,r){var i=e.getWorkingDirectory(t.path);if(i){var o=n?void 0:e.makeLocal(t.key,t.path,t.value);i.processSetMessage(t,o,n,r)}},submit:function(t,n){var r=e.getWorkingDirectory(t.path);r&&r.resubmitKeyMessage(t,n)}}),this.messageHandlers.set("createSubDirectory",{process:function(t,n,r){var i=e.getWorkingDirectory(t.path);i&&i.processCreateSubDirectoryMessage(t,n,r)},submit:function(t,n){var r=e.getWorkingDirectory(t.path);r&&r.resubmitSubDirectoryMessage(t,n)}}),this.messageHandlers.set("deleteSubDirectory",{process:function(t,n,r){var i=e.getWorkingDirectory(t.path);i&&i.processDeleteSubDirectoryMessage(t,n,r)},submit:function(t,n){var r=e.getWorkingDirectory(t.path);r&&r.resubmitSubDirectoryMessage(t,n)}})}},{key:"applyStashedOp",value:function(){throw new Error("not implemented")}},{key:"serializeDirectory",value:function(e,t,n){var r=new x.x1,i=0,u=[],c=[],l={};for(c.push([e,l]);c.length>0;){var d,h=c.pop(),f=(0,a.Z)(h,2),p=f[0],v=f[1],g=(0,s.Z)(p.getSerializedStorage(t));try{for(g.s();!(d=g.n()).done;){var m=(0,a.Z)(d.value,2),y=m[0],b=m[1];v.storage||(v.storage={});var w={type:b.type,value:b.value&&JSON.parse(b.value)};if(b.value&&b.value.length>=8192){var S={},k=S;if(p.absolutePath!==A.sep){var C,E=(0,s.Z)(p.absolutePath.substr(1).split(A.sep));try{for(E.s();!(C=E.n()).done;){var T=C.value,I={};k.subdirectories=(0,o.Z)({},T,I),k=I}}catch(L){E.e(L)}finally{E.f()}}k.storage=(0,o.Z)({},y,w);var _="blob".concat(i);i++,u.push(_),r.addBlob(_,JSON.stringify(S))}else v.storage[y]=w}}catch(L){g.e(L)}finally{g.f()}var P,N=(0,s.Z)(p.subdirectories());try{for(N.s();!(P=N.n()).done;){var O=(0,a.Z)(P.value,2),M=O[0],F=O[1];v.subdirectories||(v.subdirectories={});var Z={};v.subdirectories[M]=Z,c.push([F,Z])}}catch(L){N.e(L)}finally{N.f()}}var D={blobs:u,content:l};return r.addBlob(R,JSON.stringify(D)),r.getSummaryTree()}}],[{key:"create",value:function(e,t){return e.createChannel(t,_.Type)}},{key:"getFactory",value:function(){return new _}}]),i}(C.h,(r=Symbol.toStringTag,Symbol.iterator));function N(e){return void 0!==e&&"number"===typeof e.pendingMessageId&&"edit"===e.type}function O(e){return void 0!==e&&"clear"===e.type&&"number"===typeof e.pendingMessageId&&"object"===typeof e.previousStorage}function M(e){return void 0!==e&&"number"===typeof e.pendingMessageId&&("createSubDir"===e.type&&"boolean"===typeof e.previouslyExisted||"deleteSubDir"===e.type)}var F=function(e,t){(0,c.Z)(r,e);var n=(0,l.Z)(r);function r(e,t,o,a){var s;return(0,f.Z)(this,r),(s=n.call(this)).directory=e,s.runtime=t,s.serializer=o,s.absolutePath=a,s._deleted=!1,s[i]="SubDirectory",s._storage=new Map,s._subdirectories=new Map,s.pendingKeys=new Map,s.pendingSubDirectories=new Map,s.pendingMessageId=-1,s.pendingClearMessageIds=[],s}return(0,p.Z)(r,[{key:"dispose",value:function(e){this._deleted=!0,this.emit("disposed",this)}},{key:"undispose",value:function(){this._deleted=!1}},{key:"disposed",get:function(){return this._deleted}},{key:"throwIfDisposed",value:function(){if(this._deleted)throw new b.Oi("Cannot access Disposed subDirectory")}},{key:"has",value:function(e){return this.throwIfDisposed(),this._storage.has(e)}},{key:"get",value:function(e){var t;return this.throwIfDisposed(),null===(t=this._storage.get(e))||void 0===t?void 0:t.value}},{key:"set",value:function(e,t){if(this.throwIfDisposed(),void 0===e||null===e)throw new Error("Undefined and null keys are not supported");var n=this.directory.localValueMaker.fromInMemory(t),r=(0,T.wA)(n,this.serializer,this.directory.handle),i=this.setCore(e,n,!0);if(!this.directory.isAttached())return this;var o={key:e,path:this.absolutePath,type:"set",value:r};return this.submitKeyMessage(o,i),this}},{key:"countSubDirectory",value:function(){return this._subdirectories.size}},{key:"createSubDirectory",value:function(e){if(this.throwIfDisposed(),void 0===e||null===e)throw new Error("SubDirectory name may not be undefined or null");if(e.includes(A.sep))throw new Error("SubDirectory name may not contain ".concat(A.sep));var t=this.createSubDirectoryCore(e,!0),n=this._subdirectories.get(e);if(!this.directory.isAttached())return n;var r={path:this.absolutePath,subdirName:e,type:"createSubDirectory"};return this.submitCreateSubDirectoryMessage(r,!t),n}},{key:"getSubDirectory",value:function(e){return this.throwIfDisposed(),this._subdirectories.get(e)}},{key:"hasSubDirectory",value:function(e){return this.throwIfDisposed(),this._subdirectories.has(e)}},{key:"deleteSubDirectory",value:function(e){this.throwIfDisposed();var t=this.deleteSubDirectoryCore(e,!0);if(!this.directory.isAttached())return void 0!==t;var n={path:this.absolutePath,subdirName:e,type:"deleteSubDirectory"};return this.submitDeleteSubDirectoryMessage(n,t),void 0!==t}},{key:"subdirectories",value:function(){return this.throwIfDisposed(),this._subdirectories.entries()}},{key:"getWorkingDirectory",value:function(e){return this.throwIfDisposed(),this.directory.getWorkingDirectory(this.makeAbsolute(e))}},{key:"delete",value:function(e){this.throwIfDisposed();var t=this.deleteCore(e,!0);if(!this.directory.isAttached())return void 0!==t;var n={key:e,path:this.absolutePath,type:"delete"};return this.submitKeyMessage(n,t),void 0!==t}},{key:"clear",value:function(){if(this.throwIfDisposed(),this.directory.isAttached()){var e=new Map(this._storage);this.clearCore(!0);var t={path:this.absolutePath,type:"clear"};this.submitClearMessage(t,e)}else this.clearCore(!0)}},{key:"forEach",value:function(e){this.throwIfDisposed(),this._storage.forEach((function(t,n,r){e(t.value,n,r)}))}},{key:"size",get:function(){return this.throwIfDisposed(),this._storage.size}},{key:"entries",value:function(){this.throwIfDisposed();var e=this._storage.entries();return(0,o.Z)({next:function(){var t=e.next();return t.done?{value:void 0,done:!0}:{value:[t.value[0],t.value[1].value],done:!1}}},Symbol.iterator,(function(){return this}))}},{key:"keys",value:function(){return this.throwIfDisposed(),this._storage.keys()}},{key:"values",value:function(){this.throwIfDisposed();var e=this._storage.values();return(0,o.Z)({next:function(){var t=e.next();return t.done?{value:void 0,done:!0}:{value:t.value.value,done:!1}}},Symbol.iterator,(function(){return this}))}},{key:t,value:function(){return this.throwIfDisposed(),this.entries()}},{key:"processClearMessage",value:function(e,t,n){if(this.throwIfDisposed(),t){(0,v.h)(O(n),15);var r=this.pendingClearMessageIds.shift();(0,v.h)(r===n.pendingMessageId,810)}else this.clearExceptPendingKeys()}},{key:"processDeleteMessage",value:function(e,t,n){this.throwIfDisposed(),this.needProcessStorageOperation(e,t,n)&&this.deleteCore(e.key,t)}},{key:"processSetMessage",value:function(e,t,n,r){this.throwIfDisposed(),this.needProcessStorageOperation(e,n,r)&&this.setCore(e.key,t,n)}},{key:"processCreateSubDirectoryMessage",value:function(e,t,n){this.throwIfDisposed(),this.needProcessSubDirectoryOperation(e,t,n)&&this.createSubDirectoryCore(e.subdirName,t)}},{key:"processDeleteSubDirectoryMessage",value:function(e,t,n){this.throwIfDisposed(),this.needProcessSubDirectoryOperation(e,t,n)&&this.deleteSubDirectoryCore(e.subdirName,t)}},{key:"submitClearMessage",value:function(e,t){this.throwIfDisposed();var n=++this.pendingMessageId;this.pendingClearMessageIds.push(n);var r={type:"clear",pendingMessageId:n,previousStorage:t};this.directory.submitDirectoryMessage(e,r)}},{key:"resubmitClearMessage",value:function(e,t){(0,v.h)(O(t),811);var n=this.pendingClearMessageIds.shift();(0,v.h)(n===t.pendingMessageId,812),this.submitClearMessage(e,t.previousStorage)}},{key:"getKeyMessageId",value:function(e){var t=++this.pendingMessageId,n=this.pendingKeys.get(e.key);return void 0!==n?n.push(t):this.pendingKeys.set(e.key,[t]),t}},{key:"submitKeyMessage",value:function(e,t){this.throwIfDisposed();var n={type:"edit",pendingMessageId:this.getKeyMessageId(e),previousValue:t};this.directory.submitDirectoryMessage(e,n)}},{key:"resubmitKeyMessage",value:function(e,t){(0,v.h)(N(t),813);var n=this.pendingKeys.get(e.key);(0,v.h)(void 0!==n&&n[0]===t.pendingMessageId,814),n.shift(),0===n.length&&this.pendingKeys.delete(e.key),this.submitKeyMessage(e,t.previousValue)}},{key:"getSubDirMessageId",value:function(e){var t=++this.pendingMessageId,n=this.pendingSubDirectories.get(e.subdirName);return void 0!==n?n.push(t):this.pendingSubDirectories.set(e.subdirName,[t]),t}},{key:"submitCreateSubDirectoryMessage",value:function(e,t){this.throwIfDisposed();var n={type:"createSubDir",pendingMessageId:this.getSubDirMessageId(e),previouslyExisted:t};this.directory.submitDirectoryMessage(e,n)}},{key:"submitDeleteSubDirectoryMessage",value:function(e,t){this.throwIfDisposed();var n={type:"deleteSubDir",pendingMessageId:this.getSubDirMessageId(e),subDirectory:t};this.directory.submitDirectoryMessage(e,n)}},{key:"resubmitSubDirectoryMessage",value:function(e,t){(0,v.h)(M(t),815);var n=this.pendingSubDirectories.get(e.subdirName);(0,v.h)(void 0!==n&&n[0]===t.pendingMessageId,816),n.shift(),0===n.length&&this.pendingSubDirectories.delete(e.subdirName),"createSubDir"===t.type?this.submitCreateSubDirectoryMessage(e,t.previouslyExisted):this.submitDeleteSubDirectoryMessage(e,t.subDirectory)}},{key:"getSerializedStorage",value:(0,d.Z)().mark((function e(t){var n,r,i,o,u,c,l;return(0,d.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.throwIfDisposed(),n=(0,s.Z)(this._storage),e.prev=2,n.s();case 4:if((r=n.n()).done){e.next=12;break}return i=(0,a.Z)(r.value,2),o=i[0],u=i[1],c=u.makeSerialized(t,this.directory.handle),l=[o,c],e.next=10,l;case 10:e.next=4;break;case 12:e.next=17;break;case 14:e.prev=14,e.t0=e.catch(2),n.e(e.t0);case 17:return e.prev=17,n.f(),e.finish(17);case 20:case"end":return e.stop()}}),e,this,[[2,14,17,20]])}))},{key:"populateStorage",value:function(e,t){this.throwIfDisposed(),this._storage.set(e,t)}},{key:"populateSubDirectory",value:function(e,t){this.throwIfDisposed(),this._subdirectories.set(e,t)}},{key:"getLocalValue",value:function(e){return this.throwIfDisposed(),this._storage.get(e)}},{key:"rollbackPendingMessageId",value:function(e,t,n){var r=e.get(t),i=null===r||void 0===r?void 0:r.pop();if(!r||i!==n)throw new Error("Rollback op does not match last pending");0===r.length&&e.delete(t)}},{key:"rollback",value:function(e,t){var n,r=this;if(void 0===(n=t)||"number"!==typeof n.pendingMessageId||!("edit"===n.type||"deleteSubDir"===n.type||"clear"===n.type&&"object"===typeof n.previousStorage||"createSubDir"===n.type&&"boolean"===typeof n.previouslyExisted))throw new Error("Invalid localOpMetadata");if("clear"===e.type&&"clear"===t.type){t.previousStorage.forEach((function(e,t){r.setCore(t,e,!0)}));var i=this.pendingClearMessageIds.pop();if(void 0===i||i!==t.pendingMessageId)throw new Error("Rollback op does match last clear")}else if("delete"!==e.type&&"set"!==e.type||"edit"!==t.type)if("createSubDirectory"===e.type&&"createSubDir"===t.type)t.previouslyExisted||this.deleteSubDirectoryCore(e.subdirName,!0),this.rollbackPendingMessageId(this.pendingSubDirectories,e.subdirName,t.pendingMessageId);else{if("deleteSubDirectory"!==e.type||"deleteSubDir"!==t.type)throw new Error("Unsupported op for rollback");void 0!==t.subDirectory&&(this.undeleteSubDirectoryTree(t.subDirectory),this._subdirectories.set(e.subdirName,t.subDirectory),this.emit("subDirectoryCreated",e.subdirName,!0,this)),this.rollbackPendingMessageId(this.pendingSubDirectories,e.subdirName,t.pendingMessageId)}else void 0===t.previousValue?this.deleteCore(e.key,!0):this.setCore(e.key,t.previousValue,!0),this.rollbackPendingMessageId(this.pendingKeys,e.key,t.pendingMessageId)}},{key:"makeAbsolute",value:function(e){return A.resolve(this.absolutePath,e)}},{key:"needProcessStorageOperation",value:function(e,t,n){if(this.pendingClearMessageIds.length>0)return t&&(0,v.h)(void 0!==n&&N(n)&&n.pendingMessageId<this.pendingClearMessageIds[0],16),!1;if(void 0!==this.pendingKeys.get(e.key)){if(t){(0,v.h)(void 0!==n&&N(n),17);var r=this.pendingKeys.get(e.key);(0,v.h)(void 0!==r&&r[0]===n.pendingMessageId,817),r.shift(),0===r.length&&this.pendingKeys.delete(e.key)}return!1}return!t}},{key:"needProcessSubDirectoryOperation",value:function(e,t,n){if(void 0!==this.pendingSubDirectories.get(e.subdirName)){if(t){(0,v.h)(M(n),18);var r=this.pendingSubDirectories.get(e.subdirName);(0,v.h)(void 0!==r&&r[0]===n.pendingMessageId,818),r.shift(),0===r.length&&this.pendingSubDirectories.delete(e.subdirName)}return!1}return!t}},{key:"clearExceptPendingKeys",value:function(){var e=this,t=new Map;this.pendingKeys.forEach((function(n,r,i){t.set(r,e._storage.get(r))})),this.clearCore(!1),t.forEach((function(t,n,r){e.setCore(n,t,!0)}))}},{key:"clearCore",value:function(e){this._storage.clear(),this.directory.emit("clear",e,this.directory)}},{key:"deleteCore",value:function(e,t){var n=this._storage.get(e),r=null===n||void 0===n?void 0:n.value;if(this._storage.delete(e)){var i={key:e,path:this.absolutePath,previousValue:r};this.directory.emit("valueChanged",i,t,this.directory);var o={key:e,previousValue:r};this.emit("containedValueChanged",o,t,this)}return n}},{key:"setCore",value:function(e,t,n){var r=this._storage.get(e),i=null===r||void 0===r?void 0:r.value;this._storage.set(e,t);var o={key:e,path:this.absolutePath,previousValue:i};this.directory.emit("valueChanged",o,n,this.directory);var a={key:e,previousValue:i};return this.emit("containedValueChanged",a,n,this),r}},{key:"createSubDirectoryCore",value:function(e,t){if(!this._subdirectories.has(e)){var n=A.join(this.absolutePath,e),i=new r(this.directory,this.runtime,this.serializer,n);return this.registerEventsOnSubDirectory(i,e),this._subdirectories.set(e,i),this.emit("subDirectoryCreated",e,t,this),!0}return!1}},{key:"registerEventsOnSubDirectory",value:function(e,t){var n=this;e.on("subDirectoryCreated",(function(e,r){n.emit("subDirectoryCreated",A.join(t,e),r,n)})),e.on("subDirectoryDeleted",(function(e,r){n.emit("subDirectoryDeleted",A.join(t,e),r,n)}))}},{key:"deleteSubDirectoryCore",value:function(e,t){var n=this._subdirectories.get(e);return void 0!==n&&(this._subdirectories.delete(e),this.disposeSubDirectoryTree(n),this.emit("subDirectoryDeleted",e,t,this)),n}},{key:"disposeSubDirectoryTree",value:function(e){if(e){var t,n=e.subdirectories(),r=(0,s.Z)(n);try{for(r.s();!(t=r.n()).done;){var i=(0,a.Z)(t.value,2),o=(i[0],i[1]);this.disposeSubDirectoryTree(o)}}catch(u){r.e(u)}finally{r.f()}"function"===typeof e.dispose&&e.dispose()}}},{key:"undeleteSubDirectoryTree",value:function(e){var t,n=(0,s.Z)(this._subdirectories.entries());try{for(n.s();!(t=n.n()).done;){var r=(0,a.Z)(t.value,2),i=(r[0],r[1]);this.undeleteSubDirectoryTree(i)}}catch(o){n.e(o)}finally{n.f()}e.undispose()}}]),r}(y,(i=Symbol.toStringTag,Symbol.iterator))},57994:function(e,t,n){"use strict";n.d(t,{oU:function(){return c},wA:function(){return s}});var r=n(15671),i=n(43144),o=n(25006),a=n(38697);function s(e,t,n){var r=e.makeSerialized(t,n);return{type:r.type,value:r.value&&JSON.parse(r.value)}}var u=function(){function e(t){(0,r.Z)(this,e),this.value=t}return(0,i.Z)(e,[{key:"type",get:function(){return o.G[o.G.Plain]}},{key:"makeSerialized",value:function(e,t){var n=(0,a.Yv)(this.value,e,t);return{type:this.type,value:n}}}]),e}(),c=function(){function e(t){(0,r.Z)(this,e),this.serializer=t}return(0,i.Z)(e,[{key:"fromSerializable",value:function(e){if(e.type===o.G[o.G.Shared]){e.type=o.G[o.G.Plain];var t={type:"__fluid_handle__",url:e.value};e.value=t}var n=(0,a.lB)(e.value,this.serializer);return new u(n)}},{key:"fromInMemory",value:function(e){return new u(e)}}]),e}()},2517:function(e,t,n){"use strict";n.d(t,{c:function(){return E},G:function(){return T}});var r=n(4942),i=n(97326),o=n(60136),a=n(29388),s=n(74165),u=n(15861),c=n(15671),l=n(43144),d=n(90586),h=n(91688),f=n(97468),p=n(91869),v=n(29439),g=n(25006),m=n(18012),y=n(57994);function b(e){return void 0!==e&&"number"===typeof e.pendingMessageId&&("add"===e.type||"edit"===e.type)}function w(e){return void 0!==e&&"clear"===e.type&&"number"===typeof e.pendingMessageId}var S,k=function(e){function t(e,n,r,i,o){(0,c.Z)(this,t),this.serializer=e,this.handle=n,this.submitMessage=r,this.isAttached=i,this.eventEmitter=o,this.messageHandlers=new Map,this.data=new Map,this.pendingKeys=new Map,this.pendingMessageId=-1,this.pendingClearMessageIds=[],this.localValueMaker=new y.oU(e),this.messageHandlers=this.getMessageHandlers()}return(0,l.Z)(t,[{key:"size",get:function(){return this.data.size}},{key:"keys",value:function(){return this.data.keys()}},{key:"entries",value:function(){var e=this.data.entries();return(0,r.Z)({next:function(){var t=e.next();return t.done?{value:void 0,done:!0}:{value:[t.value[0],t.value[1].value],done:!1}}},Symbol.iterator,(function(){return this}))}},{key:"values",value:function(){var e=this.data.values();return(0,r.Z)({next:function(){var t=e.next();return t.done?{value:void 0,done:!0}:{value:t.value.value,done:!1}}},Symbol.iterator,(function(){return this}))}},{key:e,value:function(){return this.entries()}},{key:"forEach",value:function(e){this.data.forEach((function(t,n,r){e(t.value,n,r)}))}},{key:"get",value:function(e){var t=this.data.get(e);return void 0===t?void 0:t.value}},{key:"has",value:function(e){return this.data.has(e)}},{key:"set",value:function(e,t){if(void 0===e||null===e)throw new Error("Undefined and null keys are not supported");var n=this.localValueMaker.fromInMemory(t),r=(0,y.wA)(n,this.serializer,this.handle),i=this.setCore(e,n,!0);if(this.isAttached()){var o={key:e,type:"set",value:r};this.submitMapKeyMessage(o,i)}}},{key:"delete",value:function(e){var t=this.deleteCore(e,!0);if(!this.isAttached())return void 0!==t;var n={key:e,type:"delete"};return this.submitMapKeyMessage(n,t),void 0!==t}},{key:"clear",value:function(){var e=this.isAttached()?new Map(this.data):void 0;if(this.clearCore(!0),this.isAttached()){this.submitMapClearMessage({type:"clear"},e)}}},{key:"getSerializedStorage",value:function(e){var t=this,n={};return this.data.forEach((function(r,i){n[i]=r.makeSerialized(e,t.handle)})),n}},{key:"getSerializableStorage",value:function(e){var t=this,n={};return this.data.forEach((function(r,i){n[i]=(0,y.wA)(r,e,t.handle)})),n}},{key:"serialize",value:function(e){return JSON.stringify(this.getSerializableStorage(e))}},{key:"populateFromSerializable",value:function(e){for(var t=0,n=Object.entries(e);t<n.length;t++){var r=(0,v.Z)(n[t],2),i=r[0],o=r[1],a={key:i,value:this.makeLocal(i,o)};this.data.set(a.key,a.value)}}},{key:"populate",value:function(e){this.populateFromSerializable(JSON.parse(e))}},{key:"trySubmitMessage",value:function(e,t){var n=this.messageHandlers.get(e.type);return void 0!==n&&(n.submit(e,t),!0)}},{key:"tryGetStashedOpLocalMetadata",value:function(e){var t=this.messageHandlers.get(e.type);if(void 0===t)throw new Error("no apply stashed op handler");return t.getStashedOpLocalMetadata(e)}},{key:"tryProcessMessage",value:function(e,t,n){var r=this.messageHandlers.get(e.type);return void 0!==r&&(r.process(e,t,n),!0)}},{key:"rollback",value:function(e,t){var n,r=this;if(void 0===(n=t)||"number"!==typeof n.pendingMessageId||"add"!==n.type&&"edit"!==n.type&&"clear"!==n.type)throw new Error("Invalid localOpMetadata");if("clear"===e.type&&"clear"===t.type){if(void 0===t.previousMap)throw new Error("Cannot rollback without previous map");t.previousMap.forEach((function(e,t){r.setCore(t,e,!0)}));var i=this.pendingClearMessageIds.pop();if(void 0===i||i!==t.pendingMessageId)throw new Error("Rollback op does match last clear")}else{if("delete"!==e.type&&"set"!==e.type)throw new Error("Unsupported op for rollback");if("add"===t.type)this.deleteCore(e.key,!0);else{if("edit"!==t.type||void 0===t.previousValue)throw new Error("Cannot rollback without previous value");this.setCore(e.key,t.previousValue,!0)}var o=this.pendingKeys.get(e.key),a=null===o||void 0===o?void 0:o.pop();if(!o||a!==t.pendingMessageId)throw new Error("Rollback op does not match last pending");0===o.length&&this.pendingKeys.delete(e.key)}}},{key:"setCore",value:function(e,t,n){var r=this.data.get(e),i=null===r||void 0===r?void 0:r.value;return this.data.set(e,t),this.eventEmitter.emit("valueChanged",{key:e,previousValue:i},n,this.eventEmitter),r}},{key:"clearCore",value:function(e){this.data.clear(),this.eventEmitter.emit("clear",e,this.eventEmitter)}},{key:"deleteCore",value:function(e,t){var n=this.data.get(e),r=null===n||void 0===n?void 0:n.value;return this.data.delete(e)&&this.eventEmitter.emit("valueChanged",{key:e,previousValue:r},t,this.eventEmitter),n}},{key:"clearExceptPendingKeys",value:function(){var e=this,t=new Map;this.pendingKeys.forEach((function(n,r){t.set(r,e.data.get(r))})),this.clearCore(!1),t.forEach((function(t,n){e.setCore(n,t,!0)}))}},{key:"makeLocal",value:function(e,t){if(t.type===g.G[g.G.Plain]||t.type===g.G[g.G.Shared])return this.localValueMaker.fromSerializable(t);throw new Error("Unknown local value type")}},{key:"needProcessKeyOperation",value:function(e,t,n){if(this.pendingClearMessageIds.length>0)return t&&(0,m.h)(void 0!==n&&b(n)&&n.pendingMessageId<this.pendingClearMessageIds[0],19),!1;if(void 0!==this.pendingKeys.get(e.key)){if(t){(0,m.h)(void 0!==n&&b(n),20);var r=this.pendingKeys.get(e.key);(0,m.h)(void 0!==r&&r[0]===n.pendingMessageId,762),r.shift(),0===r.length&&this.pendingKeys.delete(e.key)}return!1}return!t}},{key:"getMessageHandlers",value:function(){var e=this,t=new Map;return t.set("clear",{process:function(t,n,r){if(n){(0,m.h)(w(r),21);var i=e.pendingClearMessageIds.shift();(0,m.h)(i===r.pendingMessageId,763)}else 0===e.pendingKeys.size?e.clearCore(n):e.clearExceptPendingKeys()},submit:function(t,n){(0,m.h)(w(n),764);var r=e.pendingClearMessageIds.shift();(0,m.h)(r===n.pendingMessageId,765),e.submitMapClearMessage(t,n.previousMap)},getStashedOpLocalMetadata:function(t){return{type:"clear",pendingMessageId:e.getMapClearMessageId()}}}),t.set("delete",{process:function(t,n,r){e.needProcessKeyOperation(t,n,r)&&e.deleteCore(t.key,n)},submit:function(t,n){e.resubmitMapKeyMessage(t,n)},getStashedOpLocalMetadata:function(t){return{type:"edit",pendingMessageId:e.getMapKeyMessageId(t)}}}),t.set("set",{process:function(t,n,r){if(e.needProcessKeyOperation(t,n,r)){var i=e.makeLocal(t.key,t.value);e.setCore(t.key,i,n)}},submit:function(t,n){e.resubmitMapKeyMessage(t,n)},getStashedOpLocalMetadata:function(t){return{type:"edit",pendingMessageId:e.getMapKeyMessageId(t)}}}),t}},{key:"getMapClearMessageId",value:function(){var e=++this.pendingMessageId;return this.pendingClearMessageIds.push(e),e}},{key:"submitMapClearMessage",value:function(e,t){var n={type:"clear",pendingMessageId:this.getMapClearMessageId(),previousMap:t};this.submitMessage(e,n)}},{key:"getMapKeyMessageId",value:function(e){var t=++this.pendingMessageId,n=this.pendingKeys.get(e.key);return void 0!==n?n.push(t):this.pendingKeys.set(e.key,[t]),t}},{key:"submitMapKeyMessage",value:function(e,t){var n=this.getMapKeyMessageId(e),r=t?{type:"edit",pendingMessageId:n,previousValue:t}:{type:"add",pendingMessageId:n};this.submitMessage(e,r)}},{key:"resubmitMapKeyMessage",value:function(e,t){(0,m.h)(b(t),766);var n=this.pendingKeys.get(e.key);(0,m.h)(void 0!==n&&n[0]===t.pendingMessageId,767),n.shift(),0===n.length&&this.pendingKeys.delete(e.key);var r=this.getMapKeyMessageId(e),i="edit"===t.type?{type:"edit",pendingMessageId:r,previousValue:t.previousValue}:{type:"add",pendingMessageId:r};this.submitMessage(e,i)}}]),t}(Symbol.iterator),C=n(55476),x="header",E=function(){function e(){(0,c.Z)(this,e)}return(0,l.Z)(e,[{key:"type",get:function(){return e.Type}},{key:"attributes",get:function(){return e.Attributes}},{key:"load",value:function(){var e=(0,u.Z)((0,s.Z)().mark((function e(t,n,r,i){var o;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=new T(n,t,i),e.next=3,o.load(r);case 3:return e.abrupt("return",o);case 4:case"end":return e.stop()}}),e)})));return function(t,n,r,i){return e.apply(this,arguments)}}()},{key:"create",value:function(t,n){var r=new T(n,t,e.Attributes);return r.initializeLocal(),r}}]),e}();E.Type="https://graph.microsoft.com/types/map",E.Attributes={type:E.Type,snapshotFormatVersion:"0.2",packageVersion:C.Z};var T=function(e,t){(0,o.Z)(f,e);var n=(0,a.Z)(f);function f(e,t,r){var o;return(0,c.Z)(this,f),(o=n.call(this,e,t,r,"fluid_map_"))[S]="SharedMap",o.kernel=new k(o.serializer,o.handle,(function(e,t){return o.submitLocalMessage(e,t)}),(function(){return o.isAttached()}),(0,i.Z)(o)),o}return(0,l.Z)(f,[{key:"keys",value:function(){return this.kernel.keys()}},{key:"entries",value:function(){return this.kernel.entries()}},{key:"values",value:function(){return this.kernel.values()}},{key:t,value:function(){return this.kernel.entries()}},{key:"size",get:function(){return this.kernel.size}},{key:"forEach",value:function(e){this.kernel.forEach(e)}},{key:"get",value:function(e){return this.kernel.get(e)}},{key:"has",value:function(e){return this.kernel.has(e)}},{key:"set",value:function(e,t){return this.kernel.set(e,t),this}},{key:"delete",value:function(e){return this.kernel.delete(e)}},{key:"clear",value:function(){this.kernel.clear()}},{key:"summarizeCore",value:function(e,t){for(var n=0,i=0,o={},a=[],s=new p.x1,u=this.kernel.getSerializedStorage(e),c=0,l=Object.keys(u);c<l.length;c++){var d=l[c],h=u[d];if(h.value&&h.value.length>=8192){var f="blob".concat(i);i++,a.push(f);var v=(0,r.Z)({},d,{type:h.type,value:JSON.parse(h.value)});s.addBlob(f,JSON.stringify(v))}else{if(n+=h.type.length+21,h.value&&(n+=h.value.length),n>16384){var g="blob".concat(i);i++,a.push(g),s.addBlob(g,JSON.stringify(o)),o={},n=0}o[d]={type:h.type,value:void 0===h.value?void 0:JSON.parse(h.value)}}}var m={blobs:a,content:o};return s.addBlob(x,JSON.stringify(m)),s.getSummaryTree()}},{key:"loadCore",value:function(){var e=(0,u.Z)((0,s.Z)().mark((function e(t){var n,r,i=this;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,h.g)(t,x);case 2:if(n=e.sent,r=n,!Array.isArray(r.blobs)){e.next=10;break}return this.kernel.populateFromSerializable(r.content),e.next=8,Promise.all(r.blobs.map(function(){var e=(0,u.Z)((0,s.Z)().mark((function e(n){var r;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,h.g)(t,n);case 2:r=e.sent,i.kernel.populateFromSerializable(r);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 8:e.next=11;break;case 10:this.kernel.populateFromSerializable(n);case 11:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"onDisconnect",value:function(){}},{key:"reSubmitCore",value:function(e,t){this.kernel.trySubmitMessage(e,t)}},{key:"applyStashedOp",value:function(e){return this.kernel.tryProcessMessage(e,!1,void 0),this.kernel.tryGetStashedOpLocalMetadata(e)}},{key:"processCore",value:function(e,t,n){e.type===d.C.Operation&&this.kernel.tryProcessMessage(e.contents,t,n)}},{key:"rollback",value:function(e,t){this.kernel.rollback(e,t)}}],[{key:"create",value:function(e,t){return e.createChannel(t,E.Type)}},{key:"getFactory",value:function(){return new E}}]),f}(f.h,(S=Symbol.toStringTag,Symbol.iterator))},55476:function(e,t,n){"use strict";n.d(t,{Z:function(){return r}});var r="1.3.6"},18012:function(e,t,n){"use strict";function r(e,t){if(!e)throw new Error("number"===typeof t?"0x".concat(t.toString(16).padStart(3,"0")):t)}n.d(t,{h:function(){return r}})},90586:function(e,t,n){"use strict";var r,i;n.d(t,{C:function(){return r}}),function(e){e.NoOp="noop",e.ClientJoin="join",e.ClientLeave="leave",e.Propose="propose",e.Reject="reject",e.Summarize="summarize",e.SummaryAck="summaryAck",e.SummaryNack="summaryNack",e.Operation="op",e.RemoteHelp="remoteHelp",e.NoClient="noClient",e.RoundTrip="tripComplete",e.Control="control"}(r||(r={})),function(e){e.ThrottlingError="ThrottlingError",e.InvalidScopeError="InvalidScopeError",e.BadRequestError="BadRequestError",e.LimitExceededError="LimitExceededError"}(i||(i={}))},29299:function(e,t,n){"use strict";n.d(t,{sG:function(){return v},Qp:function(){return f},VN:function(){return p},eB:function(){return h},ZO:function(){return l},FE:function(){return d}});var r,i,o,a=n(43144),s=n(15671),u=n(37762);function c(e){throw new Error(arguments.length>1&&void 0!==arguments[1]?arguments[1]:"Unreachable Case")}function l(e){var t=e.type===r.Handle?e.handleType:e.type;switch(t){case r.Blob:case r.Attachment:return i.File;case r.Tree:return i.Directory;default:c(t,"Unknown type: ".concat(t))}}function d(e){var t=e.type===r.Handle?e.handleType:e.type;switch(t){case r.Blob:case r.Attachment:return"blob";case r.Tree:return"tree";default:c(t,"Unknown type: ".concat(t))}}function h(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Map,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r={},i={id:e.sha,blobs:{},trees:{}};r[""]=i;var o,a=(0,u.Z)(e.tree);try{for(a.s();!(o=a.n()).done;){var s=o.value,c=n?s.path.replace(/^\.app\//,""):s.path,l=c.lastIndexOf("/"),d=c.slice(0,Math.max(0,l)),h=c.slice(l+1),f=r[d];if("tree"===s.type){var p={id:s.sha,blobs:{},commits:{},trees:{}};f.trees[decodeURIComponent(h)]=p,r[c]=p}else{if("blob"!==s.type)throw new Error("Unknown entry type!!");f.blobs[decodeURIComponent(h)]=s.sha,t.set(s.sha,"/".concat(c))}}}catch(v){a.e(v)}finally{a.f()}return i}!function(e){e.Tree=1,e.Blob=2,e.Handle=3,e.Attachment=4}(r||(r={})),function(e){e.File="100644",e.Executable="100755",e.Directory="040000",e.Symlink="120000"}(i||(i={})),function(e){e.Blob="Blob",e.Tree="Tree",e.Attachment="Attachment"}(o||(o={}));var f=(0,a.Z)((function e(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"utf-8";(0,s.Z)(this,e),this.path=t,this.mode=i.File,this.type=o.Blob,this.value={contents:n,encoding:r}})),p=(0,a.Z)((function e(t,n){(0,s.Z)(this,e),this.path=t,this.value=n,this.mode=i.Directory,this.type=o.Tree})),v=(0,a.Z)((function e(t,n){(0,s.Z)(this,e),this.path=t,this.id=n,this.mode=i.File,this.type=o.Attachment,this.value={id:n}}))},30405:function(e,t,n){"use strict";n.d(t,{F:function(){return d}});var r=n(74165),i=n(37762),o=n(15861),a=n(15671),s=n(43144),u=n(10003),c=n(63760),l=function(){function e(){(0,a.Z)(this,e),this.handlers=[]}return(0,s.Z)(e,[{key:"pushHandler",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var r;void 0!==t&&(r=this.handlers).push.apply(r,t)}},{key:"handleRequest",value:function(){var e=(0,o.Z)((0,r.Z)().mark((function e(t,n){var o,a,s,l,d;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:o=u.R.create(t),a=(0,i.Z)(this.handlers),e.prev=2,a.s();case 4:if((s=a.n()).done){e.next=13;break}return l=s.value,e.next=8,l(o,n);case 8:if(void 0===(d=e.sent)){e.next=11;break}return e.abrupt("return",d);case 11:e.next=4;break;case 13:e.next=18;break;case 15:e.prev=15,e.t0=e.catch(2),a.e(e.t0);case 18:return e.prev=18,a.f(),e.finish(18);case 21:return e.abrupt("return",(0,c.I4)(t));case 22:case"end":return e.stop()}}),e,this,[[2,15,18,21]])})));return function(t,n){return e.apply(this,arguments)}}()}]),e}();function d(){var e=new l;return e.pushHandler.apply(e,arguments),function(){var t=(0,o.Z)((0,r.Z)().mark((function t(n,i){return(0,r.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",e.handleRequest(n,i));case 1:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}()}},31954:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.VisibilityState=t.FlushMode=void 0,function(e){e[e.Immediate=0]="Immediate",e[e.TurnBased=1]="TurnBased"}(t.FlushMode||(t.FlushMode={})),t.VisibilityState={NotVisible:"NotVisible",LocallyVisible:"LocallyVisible",GloballyVisible:"GloballyVisible"}},10723:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.IFluidDataStoreFactory=void 0,t.IFluidDataStoreFactory="IFluidDataStoreFactory"},19336:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.IFluidDataStoreRegistry=void 0,t.IFluidDataStoreRegistry="IFluidDataStoreRegistry"},76218:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.gcBlobKey=void 0,t.gcBlobKey="gc"},62790:function(e,t,n){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),i=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||r(t,e,n)};Object.defineProperty(t,"__esModule",{value:!0}),i(n(10723),t),i(n(19336),t),i(n(31954),t),i(n(76218),t),i(n(43045),t),i(n(67103),t)},43045:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})},67103:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.totalBlobSizePropertyName=t.blobCountPropertyName=t.channelsTreeName=t.CreateSummarizerNodeSource=void 0,function(e){e[e.FromSummary=0]="FromSummary",e[e.FromAttach=1]="FromAttach",e[e.Local=2]="Local"}(t.CreateSummarizerNodeSource||(t.CreateSummarizerNodeSource={})),t.channelsTreeName=".channels",t.blobCountPropertyName="BlobCount",t.totalBlobSizePropertyName="TotalBlobSize"},87154:function(e,t,n){"use strict";function r(e,t){if(""===e)return void 0===t?"":t.absolutePath;var n=e.startsWith("/")?e.slice(1):e;return n=n.endsWith("/")?n.slice(0,-1):n,void 0===t?"/".concat(n):"".concat("/"===t.absolutePath?"":t.absolutePath,"/").concat(n)}n.d(t,{H:function(){return r}})},63760:function(e,t,n){"use strict";n.d(t,{I4:function(){return d},N_:function(){return f},Nj:function(){return s},Ys:function(){return h},bb:function(){return c},fu:function(){return u}});var r=n(74165),i=n(15861),o=n(84826),a=n(65059);function s(e){if(null!==e&&"object"===typeof e&&!0===e.errorFromRequestFluidObject){var t=e;return{mimeType:"text/plain",status:t.code,value:t.message,get stack(){return t.stack}}}var n=(0,a.FM)();return{mimeType:"text/plain",status:500,value:"".concat(e),get stack(){var t;return null!==(t=null===e||void 0===e?void 0:e.stack)&&void 0!==t?t:n.stack}}}function u(e,t){var n=e.value,r=(0,a.FM)();return{errorFromRequestFluidObject:!0,message:n,name:"Error",code:e.status,get stack(){var t;return null!==(t=e.stack)&&void 0!==t?t:r.stack}}}function c(e,t){return l.apply(this,arguments)}function l(){return(l=(0,i.Z)((0,r.Z)().mark((function e(t,n){var i,a;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i="string"===typeof n?{url:n}:n,e.next=3,t.request(i);case 3:if(200===(a=e.sent).status&&"fluid/object"===a.mimeType){e.next=6;break}throw u(a);case 6:return(0,o.h)(a.value,410),e.abrupt("return",a.value);case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var d=function(e){return h(404,"not found",e)};function h(e,t,n){var r;(0,o.h)(200!==e,411);var i=null===(r=n.url)||void 0===r?void 0:r.split("?")[0],s=(0,a.FM)();return{mimeType:"text/plain",status:e,value:void 0===i?t:"".concat(t,": ").concat(i),get stack(){return s.stack}}}function f(e,t){return{type:e,get IFluidDataStoreFactory(){return this},get IFluidDataStoreRegistry(){return this},instantiateDataStore:function(){var e=(0,i.Z)((0,r.Z)().mark((function e(n,i){return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t;case 2:return e.abrupt("return",e.sent.instantiateDataStore(n,i));case 3:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),get:function(){var e=(0,i.Z)((0,r.Z)().mark((function e(n){var i;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t;case 2:if(e.t1=i=e.sent.IFluidDataStoreRegistry,e.t0=null===e.t1,e.t0){e.next=6;break}e.t0=void 0===i;case 6:if(!e.t0){e.next=10;break}e.t2=void 0,e.next=11;break;case 10:e.t2=i.get(n);case 11:return e.abrupt("return",e.t2);case 12:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()}}},17267:function(e,t,n){"use strict";n.r(t),n.d(t,{ObjectStoragePartition:function(){return o.M},RequestParser:function(){return s.R},RuntimeFactoryHelper:function(){return u._},SummaryTreeBuilder:function(){return d.x1},TelemetryContext:function(){return d.TA},addBlobToSummary:function(){return d.Rt},addSummarizeResultToSummary:function(){return d.QA},addTreeToSummary:function(){return d.Jv},calculateStats:function(){return d.i6},convertSnapshotTreeToSummaryTree:function(){return d.S5},convertSummaryTreeToITree:function(){return d.H4},convertToSummaryTree:function(){return d.j9},convertToSummaryTreeWithStats:function(){return d.MH},create404Response:function(){return i.I4},createDataStoreFactory:function(){return i.N_},createResponseError:function(){return i.Ys},createRootSummarizerNode:function(){return c.j},createRootSummarizerNodeWithGC:function(){return l.G},exceptionToResponse:function(){return i.Nj},generateHandleContextPath:function(){return r.H},getBlobSize:function(){return d.$A},getNormalizedObjectStoragePathParts:function(){return a.g},listBlobsAtTreePath:function(){return a.W},mergeStats:function(){return d.Jz},requestFluidObject:function(){return i.bb},responseToException:function(){return i.fu},seqFromTree:function(){return h.G},utf8ByteLength:function(){return d.mL}});var r=n(87154),i=n(63760),o=n(62311),a=n(43096),s=n(10003),u=n(18279),c=n(92646),l=n(69514),d=n(91869),h=n(79605)},62311:function(e,t,n){"use strict";n.d(t,{M:function(){return u}});var r=n(74165),i=n(15861),o=n(15671),a=n(43144),s=n(84826),u=function(){function e(t,n){(0,o.Z)(this,e),this.storage=t,this.path=n,(0,s.h)(!n.endsWith("/"),412)}return(0,a.Z)(e,[{key:"readBlob",value:function(){var e=(0,i.Z)((0,r.Z)().mark((function e(t){return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.storage.readBlob("".concat(this.path,"/").concat(t)));case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"contains",value:function(){var e=(0,i.Z)((0,r.Z)().mark((function e(t){return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.storage.contains("".concat(this.path,"/").concat(t)));case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"list",value:function(){var e=(0,i.Z)((0,r.Z)().mark((function e(t){return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.storage.list("".concat(this.path,"/").concat(t)));case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),e}()},43096:function(e,t,n){"use strict";n.d(t,{W:function(){return a},g:function(){return o}});var r=n(74165),i=n(15861);function o(e){var t=e;return t.startsWith("/")&&(t=t.substr(1)),t.endsWith("/")&&(t=t.substr(0,t.length-1)),t.length>0?t.split("/"):[]}function a(e,t){return s.apply(this,arguments)}function s(){return(s=(0,i.Z)((0,r.Z)().mark((function e(t,n){var i,a,s;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:i=o(n),a=t,s=(0,r.Z)().mark((function e(){var t,n;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=i.shift(),n=a.entries.find((function(e){return"Tree"===e.type&&e.path===t})),a="Tree"===(null===n||void 0===n?void 0:n.type)?n.value:void 0;case 3:case"end":return e.stop()}}),e)}));case 3:if(!(void 0!==(null===a||void 0===a?void 0:a.entries)&&i.length>0)){e.next=7;break}return e.delegateYield(s(),"t0",5);case 5:e.next=3;break;case 7:if(void 0!==(null===a||void 0===a?void 0:a.entries)&&0===i.length){e.next=9;break}throw new Error("path does not exist");case 9:return e.abrupt("return",a.entries.filter((function(e){return"Blob"===e.type})).map((function(e){return e.path})));case 10:case"end":return e.stop()}}),e)})))).apply(this,arguments)}},10003:function(e,t,n){"use strict";n.d(t,{R:function(){return o}});var r=n(15671),i=n(43144),o=function(){function e(t){(0,r.Z)(this,e),this.request=t;var n=this.request.url.indexOf("?");this.query=n>=0?this.request.url.substring(n):""}return(0,i.Z)(e,[{key:"url",get:function(){return this.request.url}},{key:"headers",get:function(){return this.request.headers}},{key:"pathParts",get:function(){return void 0===this.requestPathParts&&(this.requestPathParts=e.getPathParts(this.url)),this.requestPathParts}},{key:"isLeaf",value:function(e){return""===this.query&&this.pathParts.length===e}},{key:"createSubRequest",value:function(e){var t=this.pathParts.length;if(e<0||e>t)throw new Error("incorrect sub-request");if(e===t&&this.url.includes("?"))return{url:"/".concat(this.query),headers:this.headers};var n="/".concat(this.pathParts.slice(e).join("/"));return{url:""===this.query?n:"".concat(n,"/").concat(this.query),headers:this.headers}}}],[{key:"getPathParts",value:function(e){var t=e.indexOf("?");return e.substring(0,t<0?e.length:t).split("/").reduce((function(e,t){return void 0!==t&&t.length>0&&e.push(decodeURIComponent(t)),e}),[])}},{key:"create",value:function(t){return t instanceof e?t:new e(t)}}]),e}()},18279:function(e,t,n){"use strict";n.d(t,{_:function(){return s}});var r=n(74165),i=n(15861),o=n(15671),a=n(43144),s=function(){function e(){(0,o.Z)(this,e)}return(0,a.Z)(e,[{key:"IRuntimeFactory",get:function(){return this}},{key:"instantiateRuntime",value:function(){var e=(0,i.Z)((0,r.Z)().mark((function e(t,n){var i,o;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=void 0===n?!0===t.existing:n,e.next=3,this.preInitialize(t,i);case 3:if(o=e.sent,!i){e.next=9;break}return e.next=7,this.instantiateFromExisting(o);case 7:e.next=11;break;case 9:return e.next=11,this.instantiateFirstTime(o);case 11:return e.next=13,this.hasInitialized(o);case 13:return e.abrupt("return",o);case 14:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"instantiateFirstTime",value:function(){var e=(0,i.Z)((0,r.Z)().mark((function e(t){return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"instantiateFromExisting",value:function(){var e=(0,i.Z)((0,r.Z)().mark((function e(t){return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"hasInitialized",value:function(){var e=(0,i.Z)((0,r.Z)().mark((function e(t){return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()}]),e}()},92646:function(e,t,n){"use strict";n.d(t,{j:function(){return g},z:function(){return v}});var r=n(29439),i=n(74165),o=n(15861),a=n(37762),s=n(15671),u=n(43144),c=n(62790),l=n(27209),d=n(84826),h=n(94550),f=n(91869),p=n(71641),v=function(){function e(t,n,r,i,o,a,u){var c;(0,s.Z)(this,e),this.defaultLogger=t,this.summarizeInternalFn=n,this._changeSequenceNumber=i,this._latestSummary=o,this.initialSummary=a,this.wipSummaryLogger=u,this.children=new Map,this.pendingSummaries=new Map,this.outstandingOps=[],this.wipSkipRecursion=!1,this.canReuseHandle=null===(c=r.canReuseHandle)||void 0===c||c,this.throwOnError=!0,this.trackingSequenceNumber=this._changeSequenceNumber}return(0,u.Z)(e,[{key:"referenceSequenceNumber",get:function(){var e,t;return null!==(t=null===(e=this._latestSummary)||void 0===e?void 0:e.referenceSequenceNumber)&&void 0!==t?t:0}},{key:"startSummary",value:function(e,t){(0,d.h)(void 0===this.wipSummaryLogger,415),(0,d.h)(void 0===this.wipReferenceSequenceNumber,416),this.wipSummaryLogger=t;var n,r=(0,a.Z)(this.children.values());try{for(r.s();!(n=r.n()).done;){n.value.startSummary(e,this.wipSummaryLogger)}}catch(i){r.e(i)}finally{r.f()}this.wipReferenceSequenceNumber=e}},{key:"summarize",value:function(){var e=(0,o.Z)((0,i.Z)().mark((function e(t){var n,r,o,a,s,u,c,h,v,g=arguments;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(g.length>1&&void 0!==g[1])||g[1],n=g.length>2?g[2]:void 0,(0,d.h)(this.isTrackingInProgress(),417),(0,d.h)(void 0!==this.wipSummaryLogger,418),!this.canReuseHandle||t||this.hasChanged()){e.next=12;break}if(void 0===(r=this._latestSummary)){e.next=12;break}return this.wipLocalPaths={localPath:r.localPath,additionalPath:r.additionalPath},this.wipSkipRecursion=!0,(o=(0,f.Jz)()).handleNodeCount++,e.abrupt("return",{summary:{type:l.J.Handle,handle:r.fullPath.path,handleType:l.J.Tree},stats:o});case 12:return e.prev=12,e.next=15,this.summarizeInternalFn(t,!0,n);case 15:return a=e.sent,this.wipLocalPaths={localPath:p.Zo.create(a.id)},void 0!==a.pathPartsForChildren&&(this.wipLocalPaths.additionalPath=p.Zo.createAndConcat(a.pathPartsForChildren)),e.abrupt("return",{summary:a.summary,stats:a.stats});case 21:if(e.prev=21,e.t0=e.catch(12),!(this.throwOnError||this.trackingSequenceNumber<this._changeSequenceNumber)){e.next=25;break}throw e.t0;case 25:if(s=this._latestSummary,u=this.initialSummary,void 0===s){e.next=32;break}c={fromSummary:!0,summaryNode:s},h=s.localPath,e.next=38;break;case 32:if(void 0===(null===u||void 0===u?void 0:u.summary)){e.next=37;break}c={fromSummary:!1,initialSummary:u.summary},h=p.Zo.create(u.id),e.next=38;break;case 37:throw e.t0;case 38:return this.wipSummaryLogger.sendErrorEvent({eventName:"SummarizingWithBasePlusOps"},e.t0),v=(0,p.Cr)(c,this.outstandingOps),this.wipLocalPaths={localPath:h,additionalPath:v.additionalPath},this.wipSkipRecursion=!0,e.abrupt("return",{summary:v.summary,stats:v.stats});case 43:case"end":return e.stop()}}),e,this,[[12,21]])})));return function(t){return e.apply(this,arguments)}}()},{key:"completeSummary",value:function(e){this.completeSummaryCore(e,void 0,!1)}},{key:"completeSummaryCore",value:function(e,t,n){(0,d.h)(void 0!==this.wipSummaryLogger,419),(0,d.h)(void 0!==this.wipReferenceSequenceNumber,420);var r=this.wipLocalPaths;if(n){var i=this._latestSummary;if(void 0===i)return void this.clearSummary();r={localPath:i.localPath,additionalPath:i.additionalPath}}(0,d.h)(!!r,421);var o,s=new p.Yl(Object.assign(Object.assign({},r),{referenceSequenceNumber:this.wipReferenceSequenceNumber,basePath:t})),u=s.fullPathForChildren,c=(0,a.Z)(this.children.values());try{for(c.s();!(o=c.n()).done;){o.value.completeSummaryCore(e,u,this.wipSkipRecursion||n)}}catch(l){c.e(l)}finally{c.f()}this.pendingSummaries.set(e,s),this.clearSummary()}},{key:"clearSummary",value:function(){this.wipReferenceSequenceNumber=void 0,this.wipLocalPaths=void 0,this.wipSkipRecursion=!1,this.wipSummaryLogger=void 0;var e,t=(0,a.Z)(this.children.values());try{for(t.s();!(e=t.n()).done;){e.value.clearSummary()}}catch(n){t.e(n)}finally{t.f()}}},{key:"refreshLatestSummary",value:function(){var e=(0,o.Z)((0,i.Z)().mark((function e(t,n,r,o,a){var s,u;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0===t){e.next=5;break}if(void 0===(s=this.pendingSummaries.get(t))){e.next=5;break}return this.refreshLatestSummaryFromPending(t,s.referenceSequenceNumber),e.abrupt("return",{latestSummaryUpdated:!0,wasSummaryTracked:!0});case 5:if(!(this.referenceSequenceNumber>=n)){e.next=7;break}return e.abrupt("return",{latestSummaryUpdated:!1});case 7:return e.next=9,r();case 9:return u=e.sent,e.next=12,this.refreshLatestSummaryFromSnapshot(n,u,void 0,p.Zo.create(""),a,o);case 12:return e.abrupt("return",{latestSummaryUpdated:!0,wasSummaryTracked:!1,snapshot:u});case 13:case"end":return e.stop()}}),e,this)})));return function(t,n,r,i,o){return e.apply(this,arguments)}}()},{key:"refreshLatestSummaryFromPending",value:function(e,t){var n=this.pendingSummaries.get(e);if(void 0!==n){(0,d.h)(t===n.referenceSequenceNumber,423),this.pendingSummaries.delete(e),this.refreshLatestSummaryCore(t),this._latestSummary=n;var r,i=(0,a.Z)(this.children.values());try{for(i.s();!(r=i.n()).done;){r.value.refreshLatestSummaryFromPending(e,t)}}catch(o){i.e(o)}finally{i.f()}}else(0,d.h)(void 0===this._latestSummary,422)}},{key:"refreshLatestSummaryFromSnapshot",value:function(){var e=(0,o.Z)((0,i.Z)().mark((function e(t,n,a,s,u,c){var l,d,h,f,v,g,m;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(this.referenceSequenceNumber>=t)){e.next=2;break}return e.abrupt("return");case 2:return this.refreshLatestSummaryCore(t),l=(0,p.MD)(n,u),d=l.baseSummary,h=l.pathParts,this._latestSummary=new p.Yl({referenceSequenceNumber:t,basePath:a,localPath:s}),f=(0,p.TI)(d),v=f.childrenTree,void 0!==(g=f.childrenPathPart)&&h.push(g),h.length>0&&(this._latestSummary.additionalPath=p.Zo.createAndConcat(h)),m=this._latestSummary.fullPathForChildren,e.next=11,Promise.all(Array.from(this.children).filter((function(e){var t=(0,r.Z)(e,1)[0];return void 0!==v.trees[t]})).map(function(){var e=(0,o.Z)((0,i.Z)().mark((function e(n){var o,a,s;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=(0,r.Z)(n,2),a=o[0],s=o[1],e.abrupt("return",s.refreshLatestSummaryFromSnapshot(t,v.trees[a],m,p.Zo.create(a),u,c));case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 11:case"end":return e.stop()}}),e,this)})));return function(t,n,r,i,o,a){return e.apply(this,arguments)}}()},{key:"refreshLatestSummaryCore",value:function(e){var t,n=(0,a.Z)(this.pendingSummaries);try{for(n.s();!(t=n.n()).done;){var i=(0,r.Z)(t.value,2),o=i[0];i[1].referenceSequenceNumber<e&&this.pendingSummaries.delete(o)}}catch(s){n.e(s)}finally{n.f()}for(;this.outstandingOps.length>0&&this.outstandingOps[0].sequenceNumber<=e;)this.outstandingOps.shift()}},{key:"loadBaseSummaryWithoutDifferential",value:function(e){var t=(0,p.TI)(e).childrenPathPart;void 0!==t&&void 0!==this._latestSummary&&(this._latestSummary.additionalPath=p.Zo.create(t))}},{key:"loadBaseSummary",value:function(){var e=(0,o.Z)((0,i.Z)().mark((function e(t,n){var r,o,a,s,u;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=(0,p.MD)(t,this.defaultLogger),e.next=3,r.getOutstandingOps(n);case 3:return o=e.sent,a=(0,p.TI)(r.baseSummary),void 0!==(s=a.childrenPathPart)&&r.pathParts.push(s),r.pathParts.length>0&&void 0!==this._latestSummary&&(this._latestSummary.additionalPath=p.Zo.createAndConcat(r.pathParts)),o.length>0&&(u=o[o.length-1].sequenceNumber,(0,d.h)(u<=this.trackingSequenceNumber,425)),e.abrupt("return",{baseSummary:r.baseSummary,outstandingOps:o});case 9:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"recordChange",value:function(e){var t=this.outstandingOps[this.outstandingOps.length-1];void 0!==t&&(0,d.h)(t.sequenceNumber<e.sequenceNumber,426),this.invalidate(e.sequenceNumber),this.trackingSequenceNumber=e.sequenceNumber,this.outstandingOps.push(e)}},{key:"invalidate",value:function(e){e>this._changeSequenceNumber&&(this._changeSequenceNumber=e)}},{key:"hasChanged",value:function(){return this._changeSequenceNumber>this.referenceSequenceNumber}},{key:"latestSummary",get:function(){return this._latestSummary}},{key:"createChild",value:function(t,n,r){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};(0,d.h)(!this.children.has(n),427);var o=this.getCreateDetailsForChild(n,r),a=new e(this.defaultLogger,t,i,o.changeSequenceNumber,o.latestSummary,o.initialSummary,this.wipSummaryLogger);return this.maybeUpdateChildState(a),this.children.set(n,a),a}},{key:"getChild",value:function(e){return this.children.get(e)}},{key:"getCreateDetailsForChild",value:function(e,t){var n,r,i,o,a=this._latestSummary;switch(t.type){case c.CreateSummarizerNodeSource.FromAttach:if(void 0!==a&&t.sequenceNumber<=a.referenceSequenceNumber)i=a.createForChild(e);else{var s=(0,f.j9)(t.snapshot);r={sequenceNumber:t.sequenceNumber,id:e,summary:s}}o=t.sequenceNumber;break;case c.CreateSummarizerNodeSource.FromSummary:void 0===this.initialSummary&&(0,d.h)(!!a,428);case c.CreateSummarizerNodeSource.Local:var u=this.initialSummary;if(void 0!==u){var v,g;if(void 0!==u.summary){var m=(0,p.ZI)(u.summary.summary).childrenTree;(0,d.h)(m.type===l.J.Tree,470),v=m.tree[e]}t.type===c.CreateSummarizerNodeSource.FromSummary&&(0,d.h)(!!v,429),void 0!==v&&((0,d.h)(v.type===l.J.Tree,430),g={summary:v,stats:(0,f.i6)(v)}),r={sequenceNumber:u.sequenceNumber,id:e,summary:g}}i=null===a||void 0===a?void 0:a.createForChild(e),o=null!==(n=null===a||void 0===a?void 0:a.referenceSequenceNumber)&&void 0!==n?n:-1;break;default:var y=t.type;(0,h.U)(t,"Unexpected CreateSummarizerNodeSource: ".concat(y))}return{initialSummary:r,latestSummary:i,changeSequenceNumber:o}}},{key:"maybeUpdateChildState",value:function(e){if(this.isTrackingInProgress()&&(e.wipReferenceSequenceNumber=this.wipReferenceSequenceNumber),void 0!==e._latestSummary){var t,n=(0,a.Z)(this.pendingSummaries.entries());try{for(n.s();!(t=n.n()).done;){var i=(0,r.Z)(t.value,2),o=i[0],s=i[1],u=new p.Yl({referenceSequenceNumber:s.referenceSequenceNumber,basePath:e._latestSummary.basePath,localPath:e._latestSummary.localPath});e.addPendingSummary(o,u)}}catch(c){n.e(c)}finally{n.f()}}}},{key:"addPendingSummary",value:function(e,t){this.pendingSummaries.set(e,t)}},{key:"isTrackingInProgress",value:function(){return void 0!==this.wipReferenceSequenceNumber}}]),e}(),g=function(e,t,n,r){return new v(e,t,arguments.length>4&&void 0!==arguments[4]?arguments[4]:{},n,void 0===r?void 0:p.Yl.createForRoot(r))}},71641:function(e,t,n){"use strict";n.d(t,{Cr:function(){return y},MD:function(){return m},TI:function(){return b},Yl:function(){return g},ZI:function(){return w},Zo:function(){return v}});var r=n(74165),i=n(37762),o=n(15861),a=n(15671),s=n(43144),u=n(84826),c=n(27209),l=n(62790),d=n(91869),h="_baseSummary",f="_outstandingOps",p=100,v=function(){function e(t){(0,a.Z)(this,e),this.path=t}return(0,s.Z)(e,[{key:"toString",value:function(){return this.path}},{key:"concat",value:function(t){return new e("".concat(this.path,"/").concat(t.path))}}],[{key:"create",value:function(t){return new e(encodeURIComponent(t))}},{key:"createAndConcat",value:function(t){for(var n,r=e.create(null!==(n=t[0])&&void 0!==n?n:""),i=1;i<t.length;i++)r=r.concat(e.create(t[i]));return r}}]),e}(),g=function(){function e(t){(0,a.Z)(this,e),this.summary=t}return(0,s.Z)(e,[{key:"referenceSequenceNumber",get:function(){return this.summary.referenceSequenceNumber}},{key:"basePath",get:function(){return this.summary.basePath}},{key:"localPath",get:function(){return this.summary.localPath}},{key:"additionalPath",get:function(){return this.summary.additionalPath},set:function(e){this.summary.additionalPath=e}},{key:"fullPath",get:function(){var e,t;return null!==(t=null===(e=this.basePath)||void 0===e?void 0:e.concat(this.localPath))&&void 0!==t?t:this.localPath}},{key:"fullPathForChildren",get:function(){return void 0!==this.additionalPath?this.fullPath.concat(this.additionalPath):this.fullPath}},{key:"createForChild",value:function(t){return new e({referenceSequenceNumber:this.referenceSequenceNumber,basePath:this.fullPathForChildren,localPath:v.create(t)})}}],[{key:"createForRoot",value:function(t){return new e({referenceSequenceNumber:t,basePath:void 0,localPath:v.create("")})}}]),e}();function m(e,t){for(var n=e,a=[],s=[],c=0;;c++){c>p&&t.sendTelemetryEvent({eventName:"DecodeSummaryMaxDepth",maxDecodeDepth:p});var l=n.blobs[f],d=n.trees[h];if(void 0===l&&void 0===d)return{baseSummary:n,pathParts:a,getOutstandingOps:function(e){return(0,o.Z)((0,r.Z)().mark((function n(){var o,a,u,c,l,d,h;return(0,r.Z)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:o=[],a=(0,i.Z)(s),n.prev=2,a.s();case 4:if((u=a.n()).done){n.next=13;break}return c=u.value,n.next=8,e(c);case 8:if(l=n.sent,o.length>0&&l.length>0&&(d=o[o.length-1].sequenceNumber,(h=l[0].sequenceNumber)<=d))for(t.sendTelemetryEvent({eventName:"DuplicateOutstandingOps",message:"newEarliestSeq <= latestSeq in decodeSummary: ".concat(h," <= ").concat(d)});l.length>0&&l[0].sequenceNumber<=d;)l.shift();o=o.concat(l);case 11:n.next=4;break;case 13:n.next=18;break;case 15:n.prev=15,n.t0=n.catch(2),a.e(n.t0);case 18:return n.prev=18,a.f(),n.finish(18);case 21:return n.abrupt("return",o);case 22:case"end":return n.stop()}}),n,null,[[2,15,18,21]])})))()}};(0,u.h)(!!l,431),(0,u.h)(void 0!==d,432),n=d,a.push(h),s.unshift(l)}}function y(e,t){var n=v.create(h),r=new d.x1;if(r.addBlob(f,JSON.stringify(t)),e.fromSummary){var i=e.summaryNode;void 0!==i.additionalPath&&(n=n.concat(i.additionalPath)),r.addHandle(h,c.J.Tree,i.fullPath.path)}else r.addWithStats(h,e.initialSummary);var o=r.getSummaryTree();return Object.assign(Object.assign({},o),{additionalPath:n})}function b(e){var t=e.trees[l.channelsTreeName];return void 0!==t?{childrenTree:t,childrenPathPart:l.channelsTreeName}:{childrenTree:e,childrenPathPart:void 0}}function w(e){var t=e.tree[l.channelsTreeName];return void 0!==t?{childrenTree:t,childrenPathPart:l.channelsTreeName}:{childrenTree:e,childrenPathPart:void 0}}},69514:function(e,t,n){"use strict";n.d(t,{G:function(){return b}});var r=n(74165),i=n(15861),o=n(11752),a=n(61120),s=n(43144),u=n(15671),c=n(60136),l=n(29388),d=function(e){function t(e){(0,u.Z)(this,t),this.execute=e}return(0,s.Z)(t,[{key:e,get:function(){return this.getPromise()[Symbol.toStringTag]}},{key:"then",value:function(){var e=(0,i.Z)((0,r.Z)().mark((function e(t,n){var i,o=arguments;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(i=this.getPromise()).then.apply(i,o));case 1:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"catch",value:function(){var e=(0,i.Z)((0,r.Z)().mark((function e(t){var n,i=arguments;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(n=this.getPromise()).catch.apply(n,i));case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"finally",value:function(){var e=(0,i.Z)((0,r.Z)().mark((function e(t){var n,i=arguments;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(n=this.getPromise()).finally.apply(n,i));case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getPromise",value:function(){var e=(0,i.Z)((0,r.Z)().mark((function e(){return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return void 0===this.result&&(this.result=this.execute()),e.abrupt("return",this.result);case 2:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),t}(Symbol.toStringTag),h=n(84826),f=n(20644),p=n(62790),v=n(92646),g=n(71641),m=function(e){(0,c.Z)(n,e);var t=(0,l.Z)(n);function n(e,r){var i;return(0,u.Z)(this,n),(i=t.call(this,r)).serializedUsedRoutes=e,i}return(0,s.Z)(n)}(g.Yl),y=function(e){(0,c.Z)(n,e);var t=(0,l.Z)(n);function n(e,o,a,s,c,l,h,f,p){var v;return(0,u.Z)(this,n),v=t.call(this,e,function(){var e=(0,i.Z)((0,r.Z)().mark((function e(t,n,i){return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",o(t,!0,i));case 1:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}(),a,s,c,l,h),v.summarizeFn=o,v.getGCDataFn=f,v.baseGCDetailsLoaded=!1,v.usedRoutes=[""],v.gcDisabled=!0===a.gcDisabled,v.baseGCDetailsP=new d((0,i.Z)((0,r.Z)().mark((function e(){var t;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,null===p||void 0===p?void 0:p();case 2:if(e.t1=t=e.sent,e.t0=null!==e.t1,!e.t0){e.next=6;break}e.t0=void 0!==t;case 6:if(!e.t0){e.next=10;break}e.t2=t,e.next=11;break;case 10:e.t2={usedRoutes:[]};case 11:return e.abrupt("return",e.t2);case 12:case"end":return e.stop()}}),e)})))),v}return(0,s.Z)(n,[{key:"getGCSummaryDetails",value:function(){return this.getBaseGCDetails()}},{key:"getBaseGCDetails",value:function(){return{gcData:this.gcData,usedRoutes:this.usedRoutes,unrefTimestamp:this.unreferencedTimestampMs}}},{key:"loadBaseGCDetails",value:function(){var e=(0,i.Z)((0,r.Z)().mark((function e(){var t,n;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.baseGCDetailsP;case 2:if(n=e.sent,!this.baseGCDetailsLoaded){e.next=5;break}return e.abrupt("return");case 5:this.baseGCDetailsLoaded=!0,void 0!==n.gcData&&(this.gcData=(0,f.rn)(n.gcData)),this.referenceUsedRoutes=null===(t=n.usedRoutes)||void 0===t?void 0:t.sort(),this.unreferencedTimestampMs=n.unrefTimestamp;case 9:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"summarize",value:function(){var e=(0,i.Z)((0,r.Z)().mark((function e(t){var i,s,u=arguments;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=!(u.length>1&&void 0!==u[1])||u[1],s=u.length>2?u[2]:void 0,!this.gcDisabled&&this.isTrackingInProgress()&&(0,h.h)(void 0!==this.wipSerializedUsedRoutes,433),e.abrupt("return",i?(0,o.Z)((0,a.Z)(n.prototype),"summarize",this).call(this,t,!0,s):this.summarizeFn(t,i,s));case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getGCData",value:function(){var e=(0,i.Z)((0,r.Z)().mark((function e(){var t,n,i=arguments;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=i.length>0&&void 0!==i[0]&&i[0],(0,h.h)(!this.gcDisabled,434),(0,h.h)(void 0!==this.getGCDataFn,435),e.next=5,this.loadBaseGCDetails();case 5:if(t||this.hasDataChanged()||void 0===this.gcData){e.next=7;break}return e.abrupt("return",(0,f.rn)(this.gcData));case 7:return e.next=9,this.getGCDataFn(t);case 9:return n=e.sent,this.gcData=(0,f.rn)(n),e.abrupt("return",n);case 12:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"startSummary",value:function(e,t){this.gcDisabled||(0,h.h)(void 0===this.wipSerializedUsedRoutes,436),(0,o.Z)((0,a.Z)(n.prototype),"startSummary",this).call(this,e,t)}},{key:"completeSummaryCore",value:function(e,t,r){var i;if(this.gcDisabled||(i=this.wipSerializedUsedRoutes,(0,h.h)(void 0!==i,437)),(0,o.Z)((0,a.Z)(n.prototype),"completeSummaryCore",this).call(this,e,t,r),!this.gcDisabled){var s=this.pendingSummaries.get(e);if(void 0!==s){var u=new m(i,s);this.pendingSummaries.set(e,u)}}}},{key:"clearSummary",value:function(){this.wipSerializedUsedRoutes=void 0,(0,o.Z)((0,a.Z)(n.prototype),"clearSummary",this).call(this)}},{key:"refreshLatestSummaryFromPending",value:function(e,t){if(!this.gcDisabled){var r=this.pendingSummaries.get(e);void 0!==r&&(this.referenceUsedRoutes=JSON.parse(r.serializedUsedRoutes))}return(0,o.Z)((0,a.Z)(n.prototype),"refreshLatestSummaryFromPending",this).call(this,e,t)}},{key:"refreshLatestSummaryFromSnapshot",value:function(){var e=(0,i.Z)((0,r.Z)().mark((function e(t,i,s,u,c,l){var d,h;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.gcDisabled){e.next=9;break}if(void 0===(d=i.blobs[p.gcBlobKey])){e.next=9;break}return e.next=5,l(d);case 5:if(h=e.sent,!(this.referenceSequenceNumber>=t)){e.next=8;break}return e.abrupt("return");case 8:this.referenceUsedRoutes=h.usedRoutes;case 9:return e.abrupt("return",(0,o.Z)((0,a.Z)(n.prototype),"refreshLatestSummaryFromSnapshot",this).call(this,t,i,s,u,c,l));case 10:case"end":return e.stop()}}),e,this)})));return function(t,n,r,i,o,a){return e.apply(this,arguments)}}()},{key:"createChild",value:function(e,t,r){var i,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},a=arguments.length>4?arguments[4]:void 0,s=arguments.length>5?arguments[5]:void 0;(0,h.h)(!this.children.has(t),438);var u=this.getCreateDetailsForChild(t,r),c=new n(this.defaultLogger,e,Object.assign(Object.assign({},o),{gcDisabled:null!==(i=o.gcDisabled)&&void 0!==i?i:this.gcDisabled}),u.changeSequenceNumber,u.latestSummary,u.initialSummary,this.wipSummaryLogger,a,s);return this.maybeUpdateChildState(c),this.children.set(t,c),c}},{key:"deleteChild",value:function(e){this.children.delete(e)}},{key:"getChild",value:function(e){return this.children.get(e)}},{key:"isReferenced",value:function(){return this.usedRoutes.includes("")||this.usedRoutes.includes("/")}},{key:"updateUsedRoutes",value:function(e,t){this.usedRoutes=e.sort(),!this.gcDisabled&&this.isTrackingInProgress()&&(this.wipSerializedUsedRoutes=JSON.stringify(this.usedRoutes)),this.isReferenced()?this.unreferencedTimestampMs=void 0:void 0===this.unreferencedTimestampMs&&(this.unreferencedTimestampMs=t)}},{key:"hasChanged",value:function(){return this.hasDataChanged()||this.hasUsedStateChanged()}},{key:"hasDataChanged",value:function(){return(0,o.Z)((0,a.Z)(n.prototype),"hasChanged",this).call(this)}},{key:"hasUsedStateChanged",value:function(){return!this.gcDisabled&&(void 0===this.referenceUsedRoutes||JSON.stringify(this.usedRoutes)!==JSON.stringify(this.referenceUsedRoutes))}}]),n}(v.z),b=function(e,t,n,r){var i=arguments.length>5?arguments[5]:void 0,o=arguments.length>6?arguments[6]:void 0;return new y(e,t,arguments.length>4&&void 0!==arguments[4]?arguments[4]:{},n,void 0===r?void 0:g.Yl.createForRoot(r),void 0,void 0,i,o)}},91869:function(e,t,n){"use strict";n.d(t,{x1:function(){return _},TA:function(){return F},Rt:function(){return I},QA:function(){return R},Jv:function(){return A},i6:function(){return T},S5:function(){return O},H4:function(){return M},j9:function(){return N},MH:function(){return P},$A:function(){return x},Jz:function(){return k},mL:function(){return C}});var r=n(29439),i=n(37762),o=n(15671),a=n(43144),s=n(60136),u=n(29388),c=n(28664),l=n(2009),d=n(84826);function h(e,t){switch(t){case"base64":return l.fromByteArray(e);case"utf8":case"utf-8":case void 0:return(new TextDecoder).decode(e);default:throw new Error("invalid/unsupported encoding")}}var f=function(e,t){return m.from(e).toString(t)};function p(e){var t=e;return e instanceof ArrayBuffer||"object"===typeof t&&null!==t&&"number"===typeof t.byteLength&&"function"===typeof t.slice&&void 0===t.byteOffset&&void 0===t.buffer}var v,g,m=function(e){(0,s.Z)(n,e);var t=(0,u.Z)(n);function n(){return(0,o.Z)(this,n),t.apply(this,arguments)}return(0,a.Z)(n,[{key:"toString",value:function(e){return h(this,e)}}],[{key:"from",value:function(e,t,r){if("string"===typeof e)return n.fromString(e,t);if(null!==e&&"object"===typeof e&&p(e.buffer))return(0,d.h)(0===e.byteOffset,0),(0,d.h)(e.byteLength===e.buffer.byteLength,1),n.fromArrayBuffer(e.buffer,t,r);if(p(e))return n.fromArrayBuffer(e,t,r);throw new TypeError}},{key:"fromArrayBuffer",value:function(e,t,r){var i=null!==t&&void 0!==t?t:0,o=null!==r&&void 0!==r?r:e.byteLength-i;if(i<0||i>e.byteLength||o<0||o+i>e.byteLength)throw new RangeError;return new n(e,i,o)}},{key:"fromString",value:function(e,t){switch(t){case"base64":var r=this.sanitizeBase64(e);return new n(l.toByteArray(r).buffer);case"utf8":case"utf-8":case void 0:return new n((new TextEncoder).encode(e).buffer);default:throw new Error("invalid/unsupported encoding")}}},{key:"isBuffer",value:function(e){throw new Error("unimplemented")}},{key:"sanitizeBase64",value:function(e){var t=e;if((t=(t=t.split("=")[0]).replace(/[^\w+-/]/g,"")).length%4!==0){t+=["","===","==","="][t.length%4]}return t}}]),n}((0,c.Z)(Uint8Array)),y=function(e){return m.from(e,"base64").toString("utf-8")},b=n(94550),w=n(29299),S=n(27209);function k(){for(var e={treeNodeCount:0,blobNodeCount:0,handleNodeCount:0,totalBlobSize:0,unreferencedBlobSize:0},t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];for(var i=0,o=n;i<o.length;i++){var a=o[i];e.treeNodeCount+=a.treeNodeCount,e.blobNodeCount+=a.blobNodeCount,e.handleNodeCount+=a.handleNodeCount,e.totalBlobSize+=a.totalBlobSize,e.unreferencedBlobSize+=a.unreferencedBlobSize}return e}function C(e){for(var t=e.length,n=e.length-1;n>=0;n--){var r=e.charCodeAt(n);r>127&&r<=2047?t++:r>2047&&r<=65535&&(t+=2),r>=56320&&r<=57343&&n--}return t}function x(e){return"string"===typeof e?C(e):e.byteLength}function E(e,t){switch(e.type){case S.J.Tree:t.treeNodeCount++;for(var n=0,r=Object.values(e.tree);n<r.length;n++){E(r[n],t)}return;case S.J.Handle:return void t.handleNodeCount++;case S.J.Blob:return t.blobNodeCount++,void(t.totalBlobSize+=x(e.content));default:return}}function T(e){var t=k();return E(e,t),t}function I(e,t,n){var r={type:S.J.Blob,content:n};e.summary.tree[t]=r,e.stats.blobNodeCount++,e.stats.totalBlobSize+=x(n)}function A(e,t,n){e.summary.tree[t]=n.summary,e.stats=k(e.stats,n.stats)}function R(e,t,n){e.summary.tree[t]=n.summary,e.stats=k(e.stats,n.stats)}!function(e){e.File="100644",e.Executable="100755",e.Directory="040000",e.Symlink="120000"}(v||(v={})),function(e){e.Blob="Blob",e.Tree="Tree",e.Attachment="Attachment"}(g||(g={}));var _=function(){function e(){(0,o.Z)(this,e),this.attachmentCounter=0,this.summaryTree={},this.summaryStats=k(),this.summaryStats.treeNodeCount++}return(0,a.Z)(e,[{key:"summary",get:function(){return{type:S.J.Tree,tree:Object.assign({},this.summaryTree)}}},{key:"stats",get:function(){return Object.assign({},this.summaryStats)}},{key:"addBlob",value:function(e,t){I({summary:{type:S.J.Tree,tree:this.summaryTree},stats:this.summaryStats},e,t)}},{key:"addHandle",value:function(e,t,n){this.summaryTree[e]={type:S.J.Handle,handleType:t,handle:n},this.summaryStats.handleNodeCount++}},{key:"addWithStats",value:function(e,t){this.summaryTree[e]=t.summary,this.summaryStats=k(this.summaryStats,t.stats)}},{key:"addAttachment",value:function(e){this.summaryTree[this.attachmentCounter++]={id:e,type:S.J.Attachment}}},{key:"getSummaryTree",value:function(){return{summary:this.summary,stats:this.stats}}}]),e}();function P(e){var t,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=new _,o=(0,i.Z)(e.entries);try{for(o.s();!(t=o.n()).done;){var a=t.value;switch(a.type){case g.Blob:var s=a.value,u=void 0;u="base64"===s.encoding?m.from(s.contents,"base64"):s.contents,r.addBlob(a.path,u);break;case g.Tree:var c=N(a.value,n);r.addWithStats(a.path,c);break;case g.Attachment:var l=a.value.id;r.addAttachment(l);break;default:throw new Error("Unexpected TreeEntry type")}}}catch(h){o.e(h)}finally{o.f()}var d=r.getSummaryTree();return d.summary.unreferenced=e.unreferenced,d}function N(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(e.id&&!t){var n=k();return n.handleNodeCount++,{summary:{handle:e.id,handleType:S.J.Tree,type:S.J.Handle},stats:n}}return P(e,t)}function O(e){for(var t=new _,n=0,i=Object.entries(e.blobs);n<i.length;n++){var o=(0,r.Z)(i[n],2),a=o[0],s=o[1],u=void 0;if(void 0!==e.blobsContents){var c=e.blobsContents[s];void 0!==c&&(u=f(c,"utf-8"))}else void 0!==e.blobs[s]&&(u=y(e.blobs[s]));void 0!==u&&t.addBlob(a,u)}for(var l=0,d=Object.entries(e.trees);l<d.length;l++){var h=(0,r.Z)(d[l],2),p=h[0],v=O(h[1]);t.addWithStats(p,v)}var g=t.getSummaryTree();return g.summary.unreferenced=e.unreferenced,g}function M(e){for(var t=[],n=0,i=Object.entries(e.tree);n<i.length;n++){var o=(0,r.Z)(i[n],2),a=o[0],s=o[1];switch(s.type){case S.J.Blob:var u=void 0,c="utf-8";"string"===typeof s.content?u=s.content:(u=h(s.content,"base64"),c="base64"),t.push(new w.Qp(a,u,c));break;case S.J.Tree:t.push(new w.VN(a,M(s)));break;case S.J.Attachment:t.push(new w.sG(a,s.id));break;case S.J.Handle:throw new Error("Should not have Handle type in summary tree");default:(0,b.U)(s,"Unexpected summary tree type")}}return{entries:t,unreferenced:e.unreferenced}}var F=function(){function e(){(0,o.Z)(this,e),this.telemetry=new Map}return(0,a.Z)(e,[{key:"set",value:function(e,t,n){this.telemetry.set("".concat(e).concat(t),n)}},{key:"get",value:function(e,t){return this.telemetry.get("".concat(e).concat(t))}},{key:"serialize",value:function(){var e={};return this.telemetry.forEach((function(t,n){e[n]=t})),JSON.stringify(e)}}]),e}()},79605:function(e,t,n){"use strict";n.d(t,{G:function(){return o}});var r=n(74165),i=n(15861);function o(e,t){return a.apply(this,arguments)}function a(){return(a=(0,i.Z)((0,r.Z)().mark((function e(t,n){var i,o;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=t.trees[".protocol"].blobs.attributes,e.next=3,n(i);case 3:return o=e.sent,e.abrupt("return",o.sequenceNumber);case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}},84826:function(e,t,n){"use strict";function r(e,t){if(!e)throw new Error("number"===typeof t?"0x".concat(t.toString(16).padStart(3,"0")):t)}n.d(t,{h:function(){return r}})},94550:function(e,t,n){"use strict";function r(e){throw new Error(arguments.length>1&&void 0!==arguments[1]?arguments[1]:"Unreachable Case")}n.d(t,{U:function(){return r}})},27209:function(e,t,n){"use strict";var r;n.d(t,{J:function(){return r}}),function(e){e.Tree=1,e.Blob=2,e.Handle=3,e.Attachment=4}(r||(r={}))},44521:function(e,t,n){e.exports=n(9403)},24668:function(e,t,n){"use strict";var r=n(20047),i=n(12131),o=n(19953),a=n(99425),s=n(12669),u=n(22575),c=n(21068),l=n(34765),d=n(25047),h=n(42176);e.exports=function(e){return new Promise((function(t,n){var f,p=e.data,v=e.headers,g=e.responseType;function m(){e.cancelToken&&e.cancelToken.unsubscribe(f),e.signal&&e.signal.removeEventListener("abort",f)}r.isFormData(p)&&delete v["Content-Type"];var y=new XMLHttpRequest;if(e.auth){var b=e.auth.username||"",w=e.auth.password?unescape(encodeURIComponent(e.auth.password)):"";v.Authorization="Basic "+btoa(b+":"+w)}var S=s(e.baseURL,e.url);function k(){if(y){var r="getAllResponseHeaders"in y?u(y.getAllResponseHeaders()):null,o={data:g&&"text"!==g&&"json"!==g?y.response:y.responseText,status:y.status,statusText:y.statusText,headers:r,config:e,request:y};i((function(e){t(e),m()}),(function(e){n(e),m()}),o),y=null}}if(y.open(e.method.toUpperCase(),a(S,e.params,e.paramsSerializer),!0),y.timeout=e.timeout,"onloadend"in y?y.onloadend=k:y.onreadystatechange=function(){y&&4===y.readyState&&(0!==y.status||y.responseURL&&0===y.responseURL.indexOf("file:"))&&setTimeout(k)},y.onabort=function(){y&&(n(l("Request aborted",e,"ECONNABORTED",y)),y=null)},y.onerror=function(){n(l("Network Error",e,null,y)),y=null},y.ontimeout=function(){var t=e.timeout?"timeout of "+e.timeout+"ms exceeded":"timeout exceeded",r=e.transitional||d;e.timeoutErrorMessage&&(t=e.timeoutErrorMessage),n(l(t,e,r.clarifyTimeoutError?"ETIMEDOUT":"ECONNABORTED",y)),y=null},r.isStandardBrowserEnv()){var C=(e.withCredentials||c(S))&&e.xsrfCookieName?o.read(e.xsrfCookieName):void 0;C&&(v[e.xsrfHeaderName]=C)}"setRequestHeader"in y&&r.forEach(v,(function(e,t){"undefined"===typeof p&&"content-type"===t.toLowerCase()?delete v[t]:y.setRequestHeader(t,e)})),r.isUndefined(e.withCredentials)||(y.withCredentials=!!e.withCredentials),g&&"json"!==g&&(y.responseType=e.responseType),"function"===typeof e.onDownloadProgress&&y.addEventListener("progress",e.onDownloadProgress),"function"===typeof e.onUploadProgress&&y.upload&&y.upload.addEventListener("progress",e.onUploadProgress),(e.cancelToken||e.signal)&&(f=function(e){y&&(n(!e||e&&e.type?new h("canceled"):e),y.abort(),y=null)},e.cancelToken&&e.cancelToken.subscribe(f),e.signal&&(e.signal.aborted?f():e.signal.addEventListener("abort",f))),p||(p=null),y.send(p)}))}},9403:function(e,t,n){"use strict";var r=n(20047),i=n(48956),o=n(72483),a=n(23576);var s=function e(t){var n=new o(t),s=i(o.prototype.request,n);return r.extend(s,o.prototype,n),r.extend(s,n),s.create=function(n){return e(a(t,n))},s}(n(97595));s.Axios=o,s.Cancel=n(42176),s.CancelToken=n(98352),s.isCancel=n(45904),s.VERSION=n(5991).version,s.all=function(e){return Promise.all(e)},s.spread=n(79287),s.isAxiosError=n(12762),e.exports=s,e.exports.default=s},42176:function(e){"use strict";function t(e){this.message=e}t.prototype.toString=function(){return"Cancel"+(this.message?": "+this.message:"")},t.prototype.__CANCEL__=!0,e.exports=t},98352:function(e,t,n){"use strict";var r=n(42176);function i(e){if("function"!==typeof e)throw new TypeError("executor must be a function.");var t;this.promise=new Promise((function(e){t=e}));var n=this;this.promise.then((function(e){if(n._listeners){var t,r=n._listeners.length;for(t=0;t<r;t++)n._listeners[t](e);n._listeners=null}})),this.promise.then=function(e){var t,r=new Promise((function(e){n.subscribe(e),t=e})).then(e);return r.cancel=function(){n.unsubscribe(t)},r},e((function(e){n.reason||(n.reason=new r(e),t(n.reason))}))}i.prototype.throwIfRequested=function(){if(this.reason)throw this.reason},i.prototype.subscribe=function(e){this.reason?e(this.reason):this._listeners?this._listeners.push(e):this._listeners=[e]},i.prototype.unsubscribe=function(e){if(this._listeners){var t=this._listeners.indexOf(e);-1!==t&&this._listeners.splice(t,1)}},i.source=function(){var e;return{token:new i((function(t){e=t})),cancel:e}},e.exports=i},45904:function(e){"use strict";e.exports=function(e){return!(!e||!e.__CANCEL__)}},72483:function(e,t,n){"use strict";var r=n(20047),i=n(99425),o=n(80370),a=n(45954),s=n(23576),u=n(10090),c=u.validators;function l(e){this.defaults=e,this.interceptors={request:new o,response:new o}}l.prototype.request=function(e,t){"string"===typeof e?(t=t||{}).url=e:t=e||{},(t=s(this.defaults,t)).method?t.method=t.method.toLowerCase():this.defaults.method?t.method=this.defaults.method.toLowerCase():t.method="get";var n=t.transitional;void 0!==n&&u.assertOptions(n,{silentJSONParsing:c.transitional(c.boolean),forcedJSONParsing:c.transitional(c.boolean),clarifyTimeoutError:c.transitional(c.boolean)},!1);var r=[],i=!0;this.interceptors.request.forEach((function(e){"function"===typeof e.runWhen&&!1===e.runWhen(t)||(i=i&&e.synchronous,r.unshift(e.fulfilled,e.rejected))}));var o,l=[];if(this.interceptors.response.forEach((function(e){l.push(e.fulfilled,e.rejected)})),!i){var d=[a,void 0];for(Array.prototype.unshift.apply(d,r),d=d.concat(l),o=Promise.resolve(t);d.length;)o=o.then(d.shift(),d.shift());return o}for(var h=t;r.length;){var f=r.shift(),p=r.shift();try{h=f(h)}catch(v){p(v);break}}try{o=a(h)}catch(v){return Promise.reject(v)}for(;l.length;)o=o.then(l.shift(),l.shift());return o},l.prototype.getUri=function(e){return e=s(this.defaults,e),i(e.url,e.params,e.paramsSerializer).replace(/^\?/,"")},r.forEach(["delete","get","head","options"],(function(e){l.prototype[e]=function(t,n){return this.request(s(n||{},{method:e,url:t,data:(n||{}).data}))}})),r.forEach(["post","put","patch"],(function(e){l.prototype[e]=function(t,n,r){return this.request(s(r||{},{method:e,url:t,data:n}))}})),e.exports=l},80370:function(e,t,n){"use strict";var r=n(20047);function i(){this.handlers=[]}i.prototype.use=function(e,t,n){return this.handlers.push({fulfilled:e,rejected:t,synchronous:!!n&&n.synchronous,runWhen:n?n.runWhen:null}),this.handlers.length-1},i.prototype.eject=function(e){this.handlers[e]&&(this.handlers[e]=null)},i.prototype.forEach=function(e){r.forEach(this.handlers,(function(t){null!==t&&e(t)}))},e.exports=i},12669:function(e,t,n){"use strict";var r=n(34049),i=n(23827);e.exports=function(e,t){return e&&!r(t)?i(e,t):t}},34765:function(e,t,n){"use strict";var r=n(34485);e.exports=function(e,t,n,i,o){var a=new Error(e);return r(a,t,n,i,o)}},45954:function(e,t,n){"use strict";var r=n(20047),i=n(70693),o=n(45904),a=n(97595),s=n(42176);function u(e){if(e.cancelToken&&e.cancelToken.throwIfRequested(),e.signal&&e.signal.aborted)throw new s("canceled")}e.exports=function(e){return u(e),e.headers=e.headers||{},e.data=i.call(e,e.data,e.headers,e.transformRequest),e.headers=r.merge(e.headers.common||{},e.headers[e.method]||{},e.headers),r.forEach(["delete","get","head","post","put","patch","common"],(function(t){delete e.headers[t]})),(e.adapter||a.adapter)(e).then((function(t){return u(e),t.data=i.call(e,t.data,t.headers,e.transformResponse),t}),(function(t){return o(t)||(u(e),t&&t.response&&(t.response.data=i.call(e,t.response.data,t.response.headers,e.transformResponse))),Promise.reject(t)}))}},34485:function(e){"use strict";e.exports=function(e,t,n,r,i){return e.config=t,n&&(e.code=n),e.request=r,e.response=i,e.isAxiosError=!0,e.toJSON=function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:this.config,code:this.code,status:this.response&&this.response.status?this.response.status:null}},e}},23576:function(e,t,n){"use strict";var r=n(20047);e.exports=function(e,t){t=t||{};var n={};function i(e,t){return r.isPlainObject(e)&&r.isPlainObject(t)?r.merge(e,t):r.isPlainObject(t)?r.merge({},t):r.isArray(t)?t.slice():t}function o(n){return r.isUndefined(t[n])?r.isUndefined(e[n])?void 0:i(void 0,e[n]):i(e[n],t[n])}function a(e){if(!r.isUndefined(t[e]))return i(void 0,t[e])}function s(n){return r.isUndefined(t[n])?r.isUndefined(e[n])?void 0:i(void 0,e[n]):i(void 0,t[n])}function u(n){return n in t?i(e[n],t[n]):n in e?i(void 0,e[n]):void 0}var c={url:a,method:a,data:a,baseURL:s,transformRequest:s,transformResponse:s,paramsSerializer:s,timeout:s,timeoutMessage:s,withCredentials:s,adapter:s,responseType:s,xsrfCookieName:s,xsrfHeaderName:s,onUploadProgress:s,onDownloadProgress:s,decompress:s,maxContentLength:s,maxBodyLength:s,transport:s,httpAgent:s,httpsAgent:s,cancelToken:s,socketPath:s,responseEncoding:s,validateStatus:u};return r.forEach(Object.keys(e).concat(Object.keys(t)),(function(e){var t=c[e]||o,i=t(e);r.isUndefined(i)&&t!==u||(n[e]=i)})),n}},12131:function(e,t,n){"use strict";var r=n(34765);e.exports=function(e,t,n){var i=n.config.validateStatus;n.status&&i&&!i(n.status)?t(r("Request failed with status code "+n.status,n.config,null,n.request,n)):e(n)}},70693:function(e,t,n){"use strict";var r=n(20047),i=n(97595);e.exports=function(e,t,n){var o=this||i;return r.forEach(n,(function(n){e=n.call(o,e,t)})),e}},97595:function(e,t,n){"use strict";var r=n(20047),i=n(53836),o=n(34485),a=n(25047),s={"Content-Type":"application/x-www-form-urlencoded"};function u(e,t){!r.isUndefined(e)&&r.isUndefined(e["Content-Type"])&&(e["Content-Type"]=t)}var c={transitional:a,adapter:function(){var e;return("undefined"!==typeof XMLHttpRequest||"undefined"!==typeof process&&"[object process]"===Object.prototype.toString.call(process))&&(e=n(24668)),e}(),transformRequest:[function(e,t){return i(t,"Accept"),i(t,"Content-Type"),r.isFormData(e)||r.isArrayBuffer(e)||r.isBuffer(e)||r.isStream(e)||r.isFile(e)||r.isBlob(e)?e:r.isArrayBufferView(e)?e.buffer:r.isURLSearchParams(e)?(u(t,"application/x-www-form-urlencoded;charset=utf-8"),e.toString()):r.isObject(e)||t&&"application/json"===t["Content-Type"]?(u(t,"application/json"),function(e,t,n){if(r.isString(e))try{return(t||JSON.parse)(e),r.trim(e)}catch(i){if("SyntaxError"!==i.name)throw i}return(n||JSON.stringify)(e)}(e)):e}],transformResponse:[function(e){var t=this.transitional||c.transitional,n=t&&t.silentJSONParsing,i=t&&t.forcedJSONParsing,a=!n&&"json"===this.responseType;if(a||i&&r.isString(e)&&e.length)try{return JSON.parse(e)}catch(s){if(a){if("SyntaxError"===s.name)throw o(s,this,"E_JSON_PARSE");throw s}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*"}}};r.forEach(["delete","get","head"],(function(e){c.headers[e]={}})),r.forEach(["post","put","patch"],(function(e){c.headers[e]=r.merge(s)})),e.exports=c},25047:function(e){"use strict";e.exports={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1}},5991:function(e){e.exports={version:"0.26.1"}},48956:function(e){"use strict";e.exports=function(e,t){return function(){for(var n=new Array(arguments.length),r=0;r<n.length;r++)n[r]=arguments[r];return e.apply(t,n)}}},99425:function(e,t,n){"use strict";var r=n(20047);function i(e){return encodeURIComponent(e).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}e.exports=function(e,t,n){if(!t)return e;var o;if(n)o=n(t);else if(r.isURLSearchParams(t))o=t.toString();else{var a=[];r.forEach(t,(function(e,t){null!==e&&"undefined"!==typeof e&&(r.isArray(e)?t+="[]":e=[e],r.forEach(e,(function(e){r.isDate(e)?e=e.toISOString():r.isObject(e)&&(e=JSON.stringify(e)),a.push(i(t)+"="+i(e))})))})),o=a.join("&")}if(o){var s=e.indexOf("#");-1!==s&&(e=e.slice(0,s)),e+=(-1===e.indexOf("?")?"?":"&")+o}return e}},23827:function(e){"use strict";e.exports=function(e,t){return t?e.replace(/\/+$/,"")+"/"+t.replace(/^\/+/,""):e}},19953:function(e,t,n){"use strict";var r=n(20047);e.exports=r.isStandardBrowserEnv()?{write:function(e,t,n,i,o,a){var s=[];s.push(e+"="+encodeURIComponent(t)),r.isNumber(n)&&s.push("expires="+new Date(n).toGMTString()),r.isString(i)&&s.push("path="+i),r.isString(o)&&s.push("domain="+o),!0===a&&s.push("secure"),document.cookie=s.join("; ")},read:function(e){var t=document.cookie.match(new RegExp("(^|;\\s*)("+e+")=([^;]*)"));return t?decodeURIComponent(t[3]):null},remove:function(e){this.write(e,"",Date.now()-864e5)}}:{write:function(){},read:function(){return null},remove:function(){}}},34049:function(e){"use strict";e.exports=function(e){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(e)}},12762:function(e,t,n){"use strict";var r=n(20047);e.exports=function(e){return r.isObject(e)&&!0===e.isAxiosError}},21068:function(e,t,n){"use strict";var r=n(20047);e.exports=r.isStandardBrowserEnv()?function(){var e,t=/(msie|trident)/i.test(navigator.userAgent),n=document.createElement("a");function i(e){var r=e;return t&&(n.setAttribute("href",r),r=n.href),n.setAttribute("href",r),{href:n.href,protocol:n.protocol?n.protocol.replace(/:$/,""):"",host:n.host,search:n.search?n.search.replace(/^\?/,""):"",hash:n.hash?n.hash.replace(/^#/,""):"",hostname:n.hostname,port:n.port,pathname:"/"===n.pathname.charAt(0)?n.pathname:"/"+n.pathname}}return e=i(window.location.href),function(t){var n=r.isString(t)?i(t):t;return n.protocol===e.protocol&&n.host===e.host}}():function(){return!0}},53836:function(e,t,n){"use strict";var r=n(20047);e.exports=function(e,t){r.forEach(e,(function(n,r){r!==t&&r.toUpperCase()===t.toUpperCase()&&(e[t]=n,delete e[r])}))}},22575:function(e,t,n){"use strict";var r=n(20047),i=["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"];e.exports=function(e){var t,n,o,a={};return e?(r.forEach(e.split("\n"),(function(e){if(o=e.indexOf(":"),t=r.trim(e.substr(0,o)).toLowerCase(),n=r.trim(e.substr(o+1)),t){if(a[t]&&i.indexOf(t)>=0)return;a[t]="set-cookie"===t?(a[t]?a[t]:[]).concat([n]):a[t]?a[t]+", "+n:n}})),a):a}},79287:function(e){"use strict";e.exports=function(e){return function(t){return e.apply(null,t)}}},10090:function(e,t,n){"use strict";var r=n(5991).version,i={};["object","boolean","number","function","string","symbol"].forEach((function(e,t){i[e]=function(n){return typeof n===e||"a"+(t<1?"n ":" ")+e}}));var o={};i.transitional=function(e,t,n){function i(e,t){return"[Axios v"+r+"] Transitional option '"+e+"'"+t+(n?". "+n:"")}return function(n,r,a){if(!1===e)throw new Error(i(r," has been removed"+(t?" in "+t:"")));return t&&!o[r]&&(o[r]=!0,console.warn(i(r," has been deprecated since v"+t+" and will be removed in the near future"))),!e||e(n,r,a)}},e.exports={assertOptions:function(e,t,n){if("object"!==typeof e)throw new TypeError("options must be an object");for(var r=Object.keys(e),i=r.length;i-- >0;){var o=r[i],a=t[o];if(a){var s=e[o],u=void 0===s||a(s,o,e);if(!0!==u)throw new TypeError("option "+o+" must be "+u)}else if(!0!==n)throw Error("Unknown option "+o)}},validators:i}},20047:function(e,t,n){"use strict";var r=n(48956),i=Object.prototype.toString;function o(e){return Array.isArray(e)}function a(e){return"undefined"===typeof e}function s(e){return"[object ArrayBuffer]"===i.call(e)}function u(e){return null!==e&&"object"===typeof e}function c(e){if("[object Object]"!==i.call(e))return!1;var t=Object.getPrototypeOf(e);return null===t||t===Object.prototype}function l(e){return"[object Function]"===i.call(e)}function d(e,t){if(null!==e&&"undefined"!==typeof e)if("object"!==typeof e&&(e=[e]),o(e))for(var n=0,r=e.length;n<r;n++)t.call(null,e[n],n,e);else for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.call(null,e[i],i,e)}e.exports={isArray:o,isArrayBuffer:s,isBuffer:function(e){return null!==e&&!a(e)&&null!==e.constructor&&!a(e.constructor)&&"function"===typeof e.constructor.isBuffer&&e.constructor.isBuffer(e)},isFormData:function(e){return"[object FormData]"===i.call(e)},isArrayBufferView:function(e){return"undefined"!==typeof ArrayBuffer&&ArrayBuffer.isView?ArrayBuffer.isView(e):e&&e.buffer&&s(e.buffer)},isString:function(e){return"string"===typeof e},isNumber:function(e){return"number"===typeof e},isObject:u,isPlainObject:c,isUndefined:a,isDate:function(e){return"[object Date]"===i.call(e)},isFile:function(e){return"[object File]"===i.call(e)},isBlob:function(e){return"[object Blob]"===i.call(e)},isFunction:l,isStream:function(e){return u(e)&&l(e.pipe)},isURLSearchParams:function(e){return"[object URLSearchParams]"===i.call(e)},isStandardBrowserEnv:function(){return("undefined"===typeof navigator||"ReactNative"!==navigator.product&&"NativeScript"!==navigator.product&&"NS"!==navigator.product)&&("undefined"!==typeof window&&"undefined"!==typeof document)},forEach:d,merge:function e(){var t={};function n(n,r){c(t[r])&&c(n)?t[r]=e(t[r],n):c(n)?t[r]=e({},n):o(n)?t[r]=n.slice():t[r]=n}for(var r=0,i=arguments.length;r<i;r++)d(arguments[r],n);return t},extend:function(e,t,n){return d(t,(function(t,i){e[i]=n&&"function"===typeof t?r(t,n):t})),e},trim:function(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")},stripBOM:function(e){return 65279===e.charCodeAt(0)&&(e=e.slice(1)),e}}},97468:function(e,t,n){"use strict";n.d(t,{h:function(){return N}});var r=n(74165),i=n(15861),o=n(29439),a=n(15671),s=n(43144),u=n(97326),c=n(11752),l=n(61120),d=n(60136),h=n(29388),f=n(39575);function p(e,t){if(!e)throw new Error("number"===typeof t?"0x".concat(t.toString(16).padStart(3,"0")):t)}var v=n(57115),g=n(62790),m=n(98895),y=n(91075),b=n(37171),w=n(27866),S=n(10357),k=n(93433),C=n(87154),x=n(4942),E=n(48238),T=n(63760),I=function(){function e(t,n){(0,a.Z)(this,e),this.absolutePath=t,this.routeContext=n,this.isAttached=!0,p(t.startsWith("/"),413)}return(0,s.Z)(e,[{key:"IFluidRouter",get:function(){return this}},{key:"IFluidHandleContext",get:function(){return this}},{key:"IFluidHandle",get:function(){return this}},{key:"get",value:function(){var e=(0,i.Z)((0,r.Z)().mark((function e(){var t;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return void 0===this.objectP&&(t={url:this.absolutePath,headers:(0,x.Z)({},E.lf.viaHandle,!0)},this.objectP=this.routeContext.resolveHandle(t).then((function(e){if("fluid/object"===e.mimeType)return e.value;throw(0,T.fu)(e,t)}))),e.abrupt("return",this.objectP);case 2:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"attachGraph",value:function(){}},{key:"bind",value:function(e){e.attachGraph()}},{key:"request",value:function(){var e=(0,i.Z)((0,r.Z)().mark((function e(t){var n,i;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.get();case 3:return n=e.sent,i=n.IFluidRouter,e.abrupt("return",void 0!==i?i.request(t):(0,T.I4)(t));case 8:return e.prev=8,e.t0=e.catch(0),e.abrupt("return",(0,T.Nj)(e.t0));case 11:case"end":return e.stop()}}),e,this,[[0,8]])})));return function(t){return e.apply(this,arguments)}}()}]),e}(),A=function(){function e(t,n){var r=this;for((0,a.Z)(this,e),this.context=t,this.handleParsedCb=n,this.encodeValue=function(e,t){var n=null===e||void 0===e?void 0:e.IFluidHandle;return void 0!==n?r.serializeHandle(n,t):e},this.decodeValue=function(e){if(function(e){return"__fluid_handle__"===(null===e||void 0===e?void 0:e.type)}(e)){var t=e.url.startsWith("/")?e.url:(0,C.H)(e.url,r.context),n=new I(t,r.root);return r.handleParsedCb(n),n}return e},this.root=this.context;void 0!==this.root.routeContext;)this.root=this.root.routeContext}return(0,s.Z)(e,[{key:"IFluidSerializer",get:function(){return this}},{key:"encode",value:function(e,t){return e&&"object"===typeof e?this.recursivelyReplace(e,this.encodeValue,t):e}},{key:"decode",value:function(e){return e&&"object"===typeof e?this.recursivelyReplace(e,this.decodeValue):e}},{key:"stringify",value:function(e,t){var n=this;return JSON.stringify(e,(function(e,r){return n.encodeValue(r,t)}))}},{key:"parse",value:function(e){var t=this;return JSON.parse(e,(function(e,n){return t.decodeValue(n)}))}},{key:"recursivelyReplace",value:function(e,t,n){var r,i=t(e,n);if(i!==e)return i;for(var o=0,a=Object.keys(e);o<a.length;o++){var s=a[o],u=e[s];if(u&&"object"===typeof u){var c=this.recursivelyReplace(u,t,n);c!==u&&((r=null!==r&&void 0!==r?r:Array.isArray(e)?(0,k.Z)(e):Object.assign({},e))[s]=c)}}return null!==r&&void 0!==r?r:e}},{key:"serializeHandle",value:function(e,t){return t.bind(e),{type:"__fluid_handle__",url:e.absolutePath}}}]),e}(),R=function(e){(0,d.Z)(n,e);var t=(0,h.Z)(n);function n(e,r,i){return(0,a.Z)(this,n),t.call(this,e,r,i)}return(0,s.Z)(n,[{key:"isAttached",get:function(){return this.value.isAttached()}},{key:"attachGraph",value:function(){this.value.bindToContext(),(0,c.Z)((0,l.Z)(n.prototype),"attachGraph",this).call(this)}}]),n}(n(70163).B),_=function(e){(0,d.Z)(n,e);var t=(0,h.Z)(n);function n(){var e;return(0,a.Z)(this,n),(e=t.apply(this,arguments)).serializedRoutes=new Set,e}return(0,s.Z)(n,[{key:"getSerializedRoutes",value:function(){return Array.from(this.serializedRoutes)}},{key:"serializeHandle",value:function(e,t){return this.serializedRoutes.add(e.absolutePath),(0,c.Z)((0,l.Z)(n.prototype),"serializeHandle",this).call(this,e,t)}}]),n}(A),P=function(e){(0,d.Z)(n,e);var t=(0,h.Z)(n);function n(e,r,i){var s;(0,a.Z)(this,n),(s=t.call(this,(function(e,t){return s.eventListenerErrorHandler(e,t)}))).id=e,s.runtime=r,s.attributes=i,s._connected=!1,s._isBoundToContext=!1,p(!e.includes("/"),772),s.handle=new R((0,u.Z)(s),e,r.IFluidHandleContext),s.logger=m.G2.create(r.logger,void 0,{all:{sharedObjectId:(0,f.Z)(),ddsType:{value:s.attributes.type,tag:m.XI.CodeArtifact}}}),s.mc=(0,y.rZ)(s.logger);var c=s.setUpSampledTelemetryHelpers(),l=(0,o.Z)(c,2);return s.opProcessingHelper=l[0],s.callbacksHelper=l[1],s.attachListeners(),s}return(0,s.Z)(n,[{key:"IFluidLoadable",get:function(){return this}},{key:"connected",get:function(){return this._connected}},{key:"setUpSampledTelemetryHelpers",value:function(){var e,t,n=this;p(void 0!==this.mc&&void 0!==this.logger,"this.mc and/or this.logger has not been set");var r=new b.E({eventName:"ddsOpProcessing",category:"performance"},this.logger,null!==(e=this.mc.config.getNumber("Fluid.SharedObject.OpProcessingTelemetrySampling"))&&void 0!==e?e:100,!0,new Map([["local",{localOp:!0}],["remote",{localOp:!1}]])),i=new b.E({eventName:"ddsEventCallbacks",category:"performance"},this.logger,null!==(t=this.mc.config.getNumber("Fluid.SharedObject.DdsCallbacksTelemetrySampling"))&&void 0!==t?t:100,!0);return this.runtime.once("dispose",(function(){n.callbacksHelper.dispose(),n.opProcessingHelper.dispose()})),[r,i]}},{key:"closeWithError",value:function(e){void 0===this.closeError&&(this.closeError=e)}},{key:"verifyNotClosed",value:function(){if(void 0!==this.closeError)throw this.closeError}},{key:"eventListenerErrorHandler",value:function(e,t){var n=S.Hi.wrapIfUnrecognized(t,"SharedObjectEventListenerException");throw n.addTelemetryProperties({emittedEventName:String(e)}),this.closeWithError(n),n}},{key:"attachListeners",value:function(){var e=this;this.isAttached()||this.runtime.once("attaching",(function(){e.didAttach()}))}},{key:"load",value:function(){var e=(0,i.Z)((0,r.Z)().mark((function e(t){return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.runtime.attachState!==v.mB.Detached&&(this.services=t),e.next=3,this.loadCore(t.objectStorage);case 3:this.runtime.attachState!==v.mB.Detached&&this.attachDeltaHandler();case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"initializeLocal",value:function(){this.initializeLocalCore()}},{key:"bindToContext",value:function(){this._isBoundToContext||(this._isBoundToContext=!0,this.runtime.bindChannel(this))}},{key:"connect",value:function(e){this.services=e,this.attachDeltaHandler()}},{key:"isAttached",value:function(){return void 0!==this.services&&this.runtime.attachState!==v.mB.Detached}},{key:"handleDecoded",value:function(e){var t,n,r;this.isAttached()&&(null===(r=null===(t=this.services)||void 0===t?void 0:(n=t.deltaConnection).addedGCOutboundReference)||void 0===r||r.call(n,this.handle,e))}},{key:"initializeLocalCore",value:function(){}},{key:"didAttach",value:function(){}},{key:"submitLocalMessage",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0;this.verifyNotClosed(),this.isAttached()&&this.services.deltaConnection.submit(e,t)}},{key:"dirty",value:function(){this.isAttached()&&this.services.deltaConnection.dirty()}},{key:"onConnect",value:function(){}},{key:"reSubmitCore",value:function(e,t){this.submitLocalMessage(e,t)}},{key:"newAckBasedPromise",value:function(){var e=(0,i.Z)((0,r.Z)().mark((function e(t){var n,i=this;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,r){n=function(){return r(new Error("FluidDataStoreRuntime disposed while this ack-based Promise was pending"))},i.runtime.disposed?n():(i.runtime.on("dispose",n),t(e,r))})).finally((function(){i.runtime.off("dispose",n)})));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"attachDeltaHandler",value:function(){var e=this;p(void 0!==this.services,122),this._isBoundToContext=!0,this.didAttach(),this.services.deltaConnection.attach({process:function(t,n,r){e.process(t,n,r)},setConnectionState:function(t){e.setConnectionState(t)},reSubmit:function(t,n){e.reSubmit(t,n)},applyStashedOp:function(t){return e.applyStashedOp(t)},rollback:function(t,n){e.rollback(t,n)}}),this.setConnectionState(this.services.deltaConnection.connected)}},{key:"setConnectionState",value:function(e){this._connected!==e&&(this._connected=e,e?this.onConnect():this.onDisconnect())}},{key:"process",value:function(e,t,n){var r=this;this.verifyNotClosed(),this.emitInternal("pre-op",e,t,this),this.opProcessingHelper.measure((function(){r.processCore(e,t,n)}),t?"local":"remote"),this.emitInternal("op",e,t,this)}},{key:"reSubmit",value:function(e,t){this.reSubmitCore(e,t)}},{key:"rollback",value:function(e,t){throw new Error("rollback not supported")}},{key:"emit",value:function(e){for(var t=this,r=arguments.length,i=new Array(r>1?r-1:0),o=1;o<r;o++)i[o-1]=arguments[o];return this.callbacksHelper.measure((function(){var r;return(r=(0,c.Z)((0,l.Z)(n.prototype),"emit",t)).call.apply(r,[t,e].concat(i))}))}},{key:"emitInternal",value:function(e){for(var t,r=arguments.length,i=new Array(r>1?r-1:0),o=1;o<r;o++)i[o-1]=arguments[o];return(t=(0,c.Z)((0,l.Z)(n.prototype),"emit",this)).call.apply(t,[this,e].concat(i))}}]),n}(w.M),N=function(e){(0,d.Z)(n,e);var t=(0,h.Z)(n);function n(e,r,i,o){var s;return(0,a.Z)(this,n),(s=t.call(this,e,r,i)).telemetryContextPrefix=o,s._isGCing=!1,s._serializer=new A(s.runtime.channelsRoutingContext,(function(e){return s.handleDecoded(e)})),s}return(0,s.Z)(n,[{key:"serializer",get:function(){return p(!this._isGCing,117),this._serializer}},{key:"getAttachSummary",value:function(){var e=arguments.length>2?arguments[2]:void 0,t=this.summarizeCore(this.serializer,e);return this.incrementTelemetryMetric(g.blobCountPropertyName,t.stats.blobNodeCount,e),this.incrementTelemetryMetric(g.totalBlobSizePropertyName,t.stats.totalBlobSize,e),t}},{key:"summarize",value:function(){var e=(0,i.Z)((0,r.Z)().mark((function e(){var t,n,i=arguments;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i.length>0&&void 0!==i[0]&&i[0],i.length>1&&void 0!==i[1]&&i[1],t=i.length>2?i[2]:void 0,n=this.summarizeCore(this.serializer,t),this.incrementTelemetryMetric(g.blobCountPropertyName,n.stats.blobNodeCount,t),this.incrementTelemetryMetric(g.totalBlobSizePropertyName,n.stats.totalBlobSize,t),e.abrupt("return",n);case 7:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getGCData",value:function(){var e,t=this;p(!this._isGCing,120),this._isGCing=!0;try{var n=new _(this.runtime.channelsRoutingContext,(function(e){return t.handleDecoded(e)}));this.processGCDataCore(n),e={gcNodes:{"/":n.getSerializedRoutes()}},p(this._isGCing,121)}finally{this._isGCing=!1}return e}},{key:"processGCDataCore",value:function(e){this.summarizeCore(e)}},{key:"incrementTelemetryMetric",value:function(e,t,n){var r,i=null!==(r=null===n||void 0===n?void 0:n.get(this.telemetryContextPrefix,e))&&void 0!==r?r:0;null===n||void 0===n||n.set(this.telemetryContextPrefix,e,i+t)}}]),n}(P)},38697:function(e,t,n){"use strict";n.d(t,{Ho:function(){return s},Yv:function(){return i},i8:function(){return o},lB:function(){return a}});var r=n(91869);function i(e,t,n){return void 0!==e?t.stringify(e,n):e}function o(e,t,n){return t.encode(e,n)}function a(e,t){return void 0!==e?t.parse(JSON.stringify(e)):e}function s(e,t){var n=new r.x1;return n.addBlob(e,t),n.getSummaryTree()}},25006:function(e,t,n){"use strict";var r;n.d(t,{G:function(){return r}}),function(e){e[e.Shared=0]="Shared",e[e.Plain=1]="Plain"}(r||(r={}))},37306:function(e,t,n){"use strict";n.d(t,{Q:function(){return l}});var r=n(4942),i=n(74165),o=n(15861),a=n(37762),s=n(15671),u=n(43144),c="IFluidDependencySynthesizer",l=function(){function e(){(0,s.Z)(this,e),this.providers=new Map;for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];this.parents=n.filter((function(e){return void 0!==e}))}return(0,u.Z)(e,[{key:"IFluidDependencySynthesizer",get:function(){return this}},{key:"register",value:function(e,t){if(this.providers.has(e))throw new Error("Attempting to register a provider of type ".concat(e," that already exists"));this.providers.set(e,t)}},{key:"unregister",value:function(e){this.providers.has(e)&&this.providers.delete(e)}},{key:"synthesize",value:function(e,t){var n=this,r={};return this.generateRequired(r,t),this.generateOptional(r,e),Object.defineProperty(r,c,{get:function(){return n}}),r}},{key:"has",value:function(e,t){return!!this.providers.has(e)||!0!==t&&this.parents.some((function(t){return t.has(e)}))}},{key:"getProvider",value:function(t){if(this.has(t)){if(this.providers.has(t))return this.providers.get(t);var n,r=(0,a.Z)(this.parents);try{for(r.s();!(n=r.n()).done;){var i=n.value;if(i instanceof e)return i.getProvider(t);var o=i;if(void 0!==(null===o||void 0===o?void 0:o.getProvider))return o.getProvider(t)}}catch(s){r.e(s)}finally{r.f()}}}},{key:"generateRequired",value:function(e,t){if(void 0!==t)for(var n=0,r=Object.keys(t);n<r.length;n++){var i=r[n],o=this.resolveProvider(i);if(void 0===o)throw new Error("Object attempted to be created without registered required provider ".concat(i));Object.defineProperty(e,i,o)}}},{key:"generateOptional",value:function(e,t){var n;if(void 0!==t)for(var r=0,a=Object.keys(t);r<a.length;r++){var s=a[r],u=null!==(n=this.resolveProvider(s))&&void 0!==n?n:{get:function(){var e=(0,o.Z)((0,i.Z)().mark((function e(){return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",void 0);case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()};Object.defineProperty(e,s,u)}}},{key:"resolveProvider",value:function(e){var t=this.providers.get(e);if(void 0!==t)return"function"===typeof t?{get:function(){if(t&&"function"===typeof t)return Promise.resolve(this[c]).then(function(){var e=(0,o.Z)((0,i.Z)().mark((function e(n){return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",t(n));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()).then((function(t){return null===t||void 0===t?void 0:t[e]}))}}:{get:function(){if(t)return Promise.resolve(t).then((function(t){if(t)return t[e]}))}};var n,s=(0,a.Z)(this.parents);try{for(s.s();!(n=s.n()).done;){var u=n.value,l=(0,r.Z)({},e,e),d=u.synthesize(l,{}),h=Object.getOwnPropertyDescriptor(d,e);if(void 0!==h)return h}}catch(f){s.e(f)}finally{s.f()}}}]),e}()},91075:function(e,t,n){"use strict";n.d(t,{MD:function(){return v},yV:function(){return g},rZ:function(){return m},UK:function(){return y},of:function(){return c}});var r=n(5647),i=n(93433),o=n(15671),a=n(43144),s=n(37762),u=n(4942),c=new(function(){function e(t){(0,o.Z)(this,e),this.valueGenerator=t,this._evaluated=!1}return(0,a.Z)(e,[{key:"evaluated",get:function(){return this._evaluated}},{key:"value",get:function(){return this._evaluated||(this._evaluated=!0,this._value=this.valueGenerator()),this._value}}]),e}())((function(){return d(p())})),l={getRawConfig:function(){}},d=function(e){return void 0!==e&&null!==e?new v({getRawConfig:function(t){var n,r;try{return null===(r=f(null!==(n=e.getItem(t))&&void 0!==n?n:void 0))||void 0===r?void 0:r.raw}catch(i){}}}):l};function h(e){switch(e){case"boolean":case"number":case"string":return!0;default:return!1}}function f(e){var t,n=e;if("string"===typeof e)try{n=JSON.parse(e),t={raw:e,string:e}}catch(c){}if(void 0===n)return t;var r=typeof n;if(h(r))return Object.assign(Object.assign({},t),(0,u.Z)({raw:e},r,n));if(Array.isArray(n)){var i=typeof n[0];if(!h(i))return t;var o,a=(0,s.Z)(n);try{for(a.s();!(o=a.n()).done;){if(typeof o.value!==i)return t}}catch(l){a.e(l)}finally{a.f()}return Object.assign(Object.assign({},t),(0,u.Z)({raw:e},"".concat(i,"[]"),n))}return t}var p=function(){try{return null!==sessionStorage?sessionStorage:void 0}catch(e){return}},v=function(){function e(){(0,o.Z)(this,e),this.configCache=new Map,this.orderedBaseProviders=[];for(var t=new Set,n=arguments.length,r=new Array(n),a=0;a<n;a++)r[a]=arguments[a];for(var s=[].concat(r);s.length>0;){var u=s.shift();void 0!==u&&b(u)&&!t.has(u)&&(t.add(u),u instanceof e?s.push.apply(s,(0,i.Z)(u.orderedBaseProviders)):this.orderedBaseProviders.push(u))}}return(0,a.Z)(e,[{key:"getBoolean",value:function(e){var t;return null===(t=this.getCacheEntry(e))||void 0===t?void 0:t.boolean}},{key:"getNumber",value:function(e){var t;return null===(t=this.getCacheEntry(e))||void 0===t?void 0:t.number}},{key:"getString",value:function(e){var t;return null===(t=this.getCacheEntry(e))||void 0===t?void 0:t.string}},{key:"getBooleanArray",value:function(e){var t;return null===(t=this.getCacheEntry(e))||void 0===t?void 0:t["boolean[]"]}},{key:"getNumberArray",value:function(e){var t;return null===(t=this.getCacheEntry(e))||void 0===t?void 0:t["number[]"]}},{key:"getStringArray",value:function(e){var t;return null===(t=this.getCacheEntry(e))||void 0===t?void 0:t["string[]"]}},{key:"getRawConfig",value:function(e){var t;return null===(t=this.getCacheEntry(e))||void 0===t?void 0:t.raw}},{key:"getCacheEntry",value:function(e){if(!this.configCache.has(e)){var t,n=(0,s.Z)(this.orderedBaseProviders);try{for(n.s();!(t=n.n()).done;){var r=t.value,i=f(null===r||void 0===r?void 0:r.getRawConfig(e));if(void 0!==i)return this.configCache.set(e,i),i}}catch(o){n.e(o)}finally{n.f()}this.configCache.set(e,{raw:void 0})}return this.configCache.get(e)}}]),e}();function g(e){var t=e;return b(null===t||void 0===t?void 0:t.config)&&void 0!==(null===t||void 0===t?void 0:t.logger)}function m(e){return g(e)?e:y(e,c.value)}function y(e){if(g(e))throw new Error("Logger is already a monitoring context");for(var t=e,n=arguments.length,i=new Array(n>1?n-1:0),o=1;o<n;o++)i[o-1]=arguments[o];return t.config=(0,r.Z)(v,i),t.logger=e,t}function b(e){return"function"===typeof(null===e||void 0===e?void 0:e.getRawConfig)}},61484:function(e,t,n){"use strict";n.d(t,{b:function(){return l}});var r=n(15671),i=n(43144),o=n(60136),a=n(29388),s=n(60987),u=n(18392),c=n(98895),l=function(e){(0,o.Z)(n,e);var t=(0,a.Z)(n);function n(e,i,o){var a;return(0,r.Z)(this,n),(a=t.call(this,void 0,o)).debug=e,a.debugErr=i,a}return(0,i.Z)(n,[{key:"send",value:function(e){var t=this.prepareEvent(e),n="error"===t.category,r=n?this.debugErr:this.debug,i=e.eventName.lastIndexOf(c.hy.eventNamespaceSeparator),o=e.eventName.substring(i+1);i>0&&(r=r.extend(e.eventName.substring(0,i))),t.eventName=void 0;var a;a="tick=".concat(c.hy.formatTick(s.S.now()));var u,l=t.stack?t.stack:"";t.stack=void 0;try{u=JSON.stringify(t)}catch(d){t.error=void 0,u=JSON.stringify(t)}"{}"===u&&(u=""),n&&(r.enabled=!0),r("".concat(o," ").concat(u," ").concat(a," ").concat(l))}}],[{key:"create",value:function(e,t){var r=(0,u.debug)(e),i=(0,u.debug)(e);return i.log=console.error.bind(console),i.enabled=!0,new n(r,i,t)}},{key:"mixinDebugLogger",value:function(e,t,r){if(!t)return n.create(e,r);var i=new c.yw(void 0,r);return i.addLogger(n.create(e,this.tryGetBaseLoggerProps(t))),i.addLogger(c.G2.create(t,e)),i}},{key:"tryGetBaseLoggerProps",value:function(e){if(e instanceof c.hy)return e.properties}}]),n}(c.hy)},65059:function(e,t,n){"use strict";n.d(t,{FM:function(){return g},Jn:function(){return y},SC:function(){return v},XY:function(){return S},YC:function(){return h},bO:function(){return b},fd:function(){return C},gr:function(){return m},j4:function(){return x},nE:function(){return p},zt:function(){return k}});var r=n(97326),i=n(15671),o=n(43144),a=n(60136),s=n(29388),u=n(28664),c=n(39575),l=n(1467),d=function(e){return null!==e&&!Array.isArray(e)&&"object"===typeof e};function h(e,t){var n={message:"string"===typeof(null===e||void 0===e?void 0:e.message)?e.message:String(e)};if(d(e)){var r=e.errorType,i=e.stack,o=e.name;if("string"===typeof r&&(n.errorType=r),"string"===typeof i){var a="string"===typeof o?o:void 0;n.stack=function(e,n){if(!t)return e;var r=e.split("\n");return r.shift(),void 0!==n&&r.unshift(n),r.join("\n")}(i,a)}}return n}var f,p=function(e){return"function"===typeof(null===e||void 0===e?void 0:e.getTelemetryProperties)};function v(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if((0,l.n5)(e)&&function(e){var t=e;void 0===t.errorInstanceId&&(t.errorInstanceId=(0,c.Z)())}(e),(0,l.IR)(e))return e.addTelemetryProperties(null!==(t=n.props)&&void 0!==t?t:{}),e;var r=h(e,!1),i=r.message,o=r.stack,a=new E({message:i,stack:o});if("object"===typeof e&&null!==e){var s=e.canRetry,u=e.retryAfterSeconds;Object.assign(v,{canRetry:s,retryAfterSeconds:u})}"object"!==typeof e&&a.addTelemetryProperties({typeofError:typeof e});var d=p(e)?e.getTelemetryProperties():{};return a.addTelemetryProperties(Object.assign(Object.assign(Object.assign({},d),n.props),{untrustedOrigin:1})),a}function g(){var e=new Error("<<generated stack>>");if(void 0===f&&(f=void 0!==e.stack),f)return e;try{throw e}catch(t){return t}}function m(){return g().stack}function y(e,t){var n=h(e,!1),r=n.message,i=n.stack,o=t(r);return void 0!==i&&w(o,i),S(e)&&o.addTelemetryProperties({untrustedOrigin:1}),(0,l.uD)(e)&&(o.overwriteErrorInstanceId(e.errorInstanceId),o.addTelemetryProperties({innerErrorInstanceId:e.errorInstanceId})),p(e)&&o.addTelemetryProperties(e.getTelemetryProperties()),o}function b(e,t,n){var r=y(e,t),i=r.errorInstanceId,o=i;return n.sendTelemetryEvent({eventName:"WrapError",errorInstanceId:i,wrappedByErrorInstanceId:o},e),r}function w(e,t){try{Object.assign(e,{stack:t})}catch(n){e.addTelemetryProperties({stack2:t})}}function S(e){return!(0,l.n5)(e)||1===e.getTelemetryProperties().untrustedOrigin&&e.errorType===E.normalizedErrorType}function k(e){return"object"!==typeof(null===e||void 0===e?void 0:e.value)&&"string"===typeof(null===e||void 0===e?void 0:e.tag)}var C=function(){var e=new WeakSet;return function(t,n){if("object"===typeof n&&null!==n){if(e.has(n))return"<removed/circular>";e.add(n)}return n}},x=function(e){(0,a.Z)(n,e);var t=(0,s.Z)(n);function n(e,r){var o,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Set;return(0,i.Z)(this,n),(o=t.call(this,e)).omitPropsFromLogging=a,o._errorInstanceId=(0,c.Z)(),o.fluidErrorCode="-",a.add("omitPropsFromLogging"),a.add("_errorInstanceId"),r&&o.addTelemetryProperties(r),o}return(0,o.Z)(n,[{key:"errorInstanceId",get:function(){return this._errorInstanceId}},{key:"overwriteErrorInstanceId",value:function(e){this._errorInstanceId=e}},{key:"addTelemetryProperties",value:function(e){!function(e,t){for(var n=0,r=Object.keys(t);n<r.length;n++){var i=r[n];void 0===e[i]&&(e[i]=t[i])}}(this,e)}},{key:"getTelemetryProperties",value:function(){var e=function(e,t){for(var n={},r=0,i=Object.keys(e);r<i.length;r++){var o=i[r];if(!t.has(o)){var a=e[o];switch(typeof a){case"string":case"number":case"boolean":case"undefined":n[o]=a;break;default:k(a)?n[o]=a:n[o]="REDACTED (arbitrary object)"}}}return n}(this,this.omitPropsFromLogging);return Object.assign(Object.assign({},e),{stack:this.stack,message:this.message,errorInstanceId:this._errorInstanceId})}}]),n}((0,u.Z)(Error)),E=function(e){(0,a.Z)(n,e);var t=(0,s.Z)(n);function n(e){var o;return(0,i.Z)(this,n),(o=t.call(this,e.message)).errorType=n.normalizedErrorType,void 0!==e.stack&&w((0,r.Z)(o),e.stack),o}return(0,o.Z)(n)}(x);E.normalizedErrorType="genericError"},27866:function(e,t,n){"use strict";n.d(t,{M:function(){return l}});var r=n(15671),i=n(43144),o=n(11752),a=n(61120),s=n(60136),u=n(29388),c=n(97326),l=function(e){(0,s.Z)(n,e);var t=(0,u.Z)(n);function n(e){var i;return(0,r.Z)(this,n),(i=t.call(this)).errorHandler=e,i}return(0,i.Z)(n,[{key:"emit",value:function(e){try{for(var t,r=arguments.length,i=new Array(r>1?r-1:0),s=1;s<r;s++)i[s-1]=arguments[s];return(t=(0,o.Z)((0,a.Z)(n.prototype),"emit",this)).call.apply(t,[this,e].concat(i))}catch(u){return this.errorHandler(e,u),!0}}}]),n}(function(e){(0,s.Z)(n,e);var t=(0,u.Z)(n);function n(){var e,i,s,u,l,d,h,f;return(0,r.Z)(this,n),(f=t.call(this)).addListener=(0,o.Z)((e=(0,c.Z)(f),(0,a.Z)(n.prototype)),"addListener",e).bind((0,c.Z)(f)),f.on=(0,o.Z)((i=(0,c.Z)(f),(0,a.Z)(n.prototype)),"on",i).bind((0,c.Z)(f)),f.once=(0,o.Z)((s=(0,c.Z)(f),(0,a.Z)(n.prototype)),"once",s).bind((0,c.Z)(f)),f.prependListener=(0,o.Z)((u=(0,c.Z)(f),(0,a.Z)(n.prototype)),"prependListener",u).bind((0,c.Z)(f)),f.prependOnceListener=(0,o.Z)((l=(0,c.Z)(f),(0,a.Z)(n.prototype)),"prependOnceListener",l).bind((0,c.Z)(f)),f.removeListener=(0,o.Z)((d=(0,c.Z)(f),(0,a.Z)(n.prototype)),"removeListener",d).bind((0,c.Z)(f)),f.off=(0,o.Z)((h=(0,c.Z)(f),(0,a.Z)(n.prototype)),"off",h).bind((0,c.Z)(f)),f}return(0,i.Z)(n)}(n(47465).EventEmitter))},99025:function(e,t,n){"use strict";n.d(t,{Eb:function(){return o},Qq:function(){return a},h$:function(){return i},tZ:function(){return r}});var r="connected",i="disconnected";function o(e,t,n){try{for(var r=arguments.length,i=new Array(r>3?r-3:0),o=3;o<r;o++)i[o-3]=arguments[o];e.emit.apply(e,[n].concat(i))}catch(a){t.sendErrorEvent({eventName:"RaiseEventError",event:n},a)}}function a(e,t,n,o){try{n?t.emit(r,o):t.emit(i)}catch(a){e.sendErrorEvent({eventName:"RaiseConnectedEventError"},a)}}},1467:function(e,t,n){"use strict";n.d(t,{IR:function(){return o},n5:function(){return a},uD:function(){return i}});var r=function(e){return"function"===typeof(null===e||void 0===e?void 0:e.getTelemetryProperties)&&"function"===typeof(null===e||void 0===e?void 0:e.addTelemetryProperties)},i=function(e){return"string"===typeof(null===e||void 0===e?void 0:e.errorInstanceId)};function o(e){return"string"===typeof(null===e||void 0===e?void 0:e.errorType)&&"string"===typeof(null===e||void 0===e?void 0:e.message)&&i(e)&&r(e)}function a(e){return"string"===typeof(null===e||void 0===e?void 0:e.errorType)&&"string"===typeof(null===e||void 0===e?void 0:e.message)&&r(e)}},24589:function(e,t,n){"use strict";n.r(t),n.d(t,{ChildLogger:function(){return u.G2},DebugLogger:function(){return r.b},EventEmitterWithErrorHandling:function(){return o.M},LoggingError:function(){return i.j4},MockLogger:function(){return f},MultiSinkLogger:function(){return u.yw},PerformanceEvent:function(){return u.Xr},SampledTelemetryHelper:function(){return g.E},TaggedLoggerAdapter:function(){return u.cP},TelemetryDataTag:function(){return u.XI},TelemetryLogger:function(){return u.hy},TelemetryUTLogger:function(){return u.nI},ThresholdCounter:function(){return p.z},connectedEventName:function(){return a.tZ},disconnectedEventName:function(){return a.h$},extractLogSafeErrorProperties:function(){return i.YC},generateErrorWithStack:function(){return i.FM},generateStack:function(){return i.gr},getCircularReplacer:function(){return i.fd},hasErrorInstanceId:function(){return s.uD},isExternalError:function(){return i.XY},isFluidError:function(){return s.IR},isILoggingError:function(){return i.nE},isTaggedTelemetryPropertyValue:function(){return i.zt},isValidLegacyError:function(){return s.n5},logIfFalse:function(){return v.M},loggerToMonitoringContext:function(){return m.rZ},mixinMonitoringContext:function(){return m.UK},normalizeError:function(){return i.SC},raiseConnectedEvent:function(){return a.Qq},safeRaiseEvent:function(){return a.Eb},sessionStorageConfigProvider:function(){return m.of},wrapError:function(){return i.Jn},wrapErrorAndLog:function(){return i.bO}});var r=n(61484),i=n(65059),o=n(27866),a=n(99025),s=n(1467),u=n(98895),c=n(15671),l=n(43144),d=n(60136),h=n(29388),f=function(e){(0,d.Z)(n,e);var t=(0,h.Z)(n);function n(){var e;return(0,c.Z)(this,n),(e=t.call(this)).events=[],e}return(0,l.Z)(n,[{key:"clear",value:function(){this.events=[]}},{key:"send",value:function(e){this.events.push(e)}},{key:"matchEvents",value:function(e){var t=this.getMatchedEventsCount(e);return 0===e.length-t}},{key:"assertMatch",value:function(e,t){var n=this.events;if(!this.matchEvents(e))throw new Error("".concat(t,"\nexpected:\n").concat(JSON.stringify(e),"\n\nactual:\n").concat(JSON.stringify(n)))}},{key:"matchAnyEvent",value:function(e){return this.getMatchedEventsCount(e)>0}},{key:"assertMatchAny",value:function(e,t){var n=this.events;if(!this.matchAnyEvent(e))throw new Error("".concat(t,"\nexpected:\n").concat(JSON.stringify(e),"\n\nactual:\n").concat(JSON.stringify(n)))}},{key:"getMatchedEventsCount",value:function(e){var t=0;return this.events.forEach((function(r){t<e.length&&n.eventsMatch(r,e[t])&&++t})),this.events=[],t}}],[{key:"eventsMatch",value:function(e,t){var n=Object.assign(Object.assign({},e),t);return JSON.stringify(n)===JSON.stringify(e)}}]),n}(u.hy),p=n(84485),v=n(58375),g=n(37171),m=n(91075)},98895:function(e,t,n){"use strict";n.d(t,{G2:function(){return m},yw:function(){return y},Xr:function(){return b},cP:function(){return g},XI:function(){return d},hy:function(){return v},nI:function(){return w}});var r=n(74165),i=n(15861),o=n(97326),a=n(60136),s=n(29388),u=n(15671),c=n(43144),l=function(){function e(){(0,u.Z)(this,e)}return(0,c.Z)(e,[{key:"send",value:function(e){}}]),e}();var d,h=n(60987),f=n(91075),p=n(65059);!function(e){e.PackageData="PackageData",e.CodeArtifact="CodeArtifact",e.UserData="UserData"}(d||(d={}));var v=function(){function e(t,n){(0,u.Z)(this,e),this.namespace=t,this.properties=n}return(0,c.Z)(e,[{key:"sendTelemetryEvent",value:function(e,t){var n;this.sendTelemetryEventCore(Object.assign(Object.assign({},e),{category:null!==(n=e.category)&&void 0!==n?n:"generic"}),t)}},{key:"sendTelemetryEventCore",value:function(t,n){var r=Object.assign({},t);void 0!==n&&e.prepareErrorObject(r,n,!1),"number"===typeof r.duration&&(r.duration=e.formatTick(r.duration)),this.send(r)}},{key:"sendErrorEvent",value:function(e,t){this.sendTelemetryEventCore(Object.assign(Object.assign({error:e.eventName},e),{category:"error"}),t)}},{key:"sendPerformanceEvent",value:function(e,t){var n,r=Object.assign(Object.assign({},e),{category:null!==(n=e.category)&&void 0!==n?n:"performance"});this.sendTelemetryEventCore(r,t)}},{key:"prepareEvent",value:function(t){var n="error"===t.category||void 0!==t.error,r=Object.assign({},t);if(void 0!==this.namespace&&(r.eventName="".concat(this.namespace).concat(e.eventNamespaceSeparator).concat(r.eventName)),this.properties){var i=[];i.push(this.properties.all),n&&i.push(this.properties.error);for(var o=0,a=i;o<a.length;o++){var s=a[o];if(void 0!==s)for(var u=0,c=Object.keys(s);u<c.length;u++){var l=c[u];if(void 0===t[l]){var d=s[l],h="function"===typeof d?d():d;void 0!==h&&(r[l]=h)}}}}return r}}],[{key:"formatTick",value:function(e){return Math.floor(e)}},{key:"numberFromString",value:function(e){if(void 0!==e&&null!==e){var t=Number(e);return Number.isNaN(t)?e:t}}},{key:"sanitizePkgName",value:function(e){return e.replace("@","").replace("/","-")}},{key:"prepareErrorObject",value:function(e,t,n){var r=(0,p.YC)(t,!0),i=r.message,o=r.errorType,a=r.stack;if(e.stack=a,e.error=i,e.errorType=o,(0,p.nE)(t))for(var s=t.getTelemetryProperties(),u=0,c=Object.keys(s);u<c.length;u++){var l=c[u];void 0===e[l]&&(e[l]=s[l])}void 0===e.stack&&n&&(e.stack=(0,p.gr)())}}]),e}();v.eventNamespaceSeparator=":";var g=function(){function e(t){(0,u.Z)(this,e),this.logger=t}return(0,c.Z)(e,[{key:"send",value:function(e){for(var t={category:e.category,eventName:e.eventName},n=0,r=Object.keys(e);n<r.length;n++){var i=r[n],o=e[i],a="object"===typeof o?o:{value:o,tag:void 0},s=a.value;switch(a.tag){case void 0:case d.PackageData:t[i]=s;break;case d.UserData:t[i]="REDACTED (UserData)";break;default:t[i]="REDACTED (unknown tag)"}}this.logger.send(t)}}]),e}(),m=function(e){(0,a.Z)(n,e);var t=(0,s.Z)(n);function n(e,r,i){var a;return(0,u.Z)(this,n),(a=t.call(this,r,i)).baseLogger=e,(0,f.yV)(e)&&(0,f.UK)((0,o.Z)(a),new f.MD(e.config)),a}return(0,c.Z)(n,[{key:"send",value:function(e){this.baseLogger.send(this.prepareEvent(e))}}],[{key:"create",value:function(e,t,r){if(e instanceof n){for(var i={},o=0,a=[e.properties,r];o<a.length;o++){var s=a[o];void 0!==s&&(void 0!==s.all&&(i.all=Object.assign(Object.assign({},i.all),s.all)),void 0!==s.error&&(i.error=Object.assign(Object.assign({},i.error),s.error)))}var u=void 0===e.namespace?t:void 0===t?e.namespace:"".concat(e.namespace).concat(v.eventNamespaceSeparator).concat(t);return new n(e.baseLogger,u,i)}return new n(e||new l,t,r)}}]),n}(v),y=function(e){(0,a.Z)(n,e);var t=(0,s.Z)(n);function n(e,r){var i;return(0,u.Z)(this,n),(i=t.call(this,e,r)).loggers=[],i}return(0,c.Z)(n,[{key:"addLogger",value:function(e){void 0!==e&&null!==e&&this.loggers.push(e)}},{key:"send",value:function(e){var t=this.prepareEvent(e);this.loggers.forEach((function(e){e.send(t)}))}}]),n}(v),b=function(){function e(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{end:!0,cancel:"generic"};(0,u.Z)(this,e),this.logger=t,this.markers=r,this.startTime=h.S.now(),this.event=Object.assign({},n),this.markers.start&&this.reportEvent("start"),"object"===typeof window&&null!=window&&window.performance&&(this.startMark="".concat(n.eventName,"-start"),window.performance.mark(this.startMark))}return(0,c.Z)(e,[{key:"duration",get:function(){return h.S.now()-this.startTime}},{key:"reportProgress",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"update";this.reportEvent(t,e)}},{key:"autoEnd",value:function(){this.event&&this.markers.end&&this.reportEvent("end"),this.performanceEndMark(),this.event=void 0}},{key:"end",value:function(e){this.reportEvent("end",e),this.performanceEndMark(),this.event=void 0}},{key:"performanceEndMark",value:function(){if(this.startMark&&this.event){var e="".concat(this.event.eventName,"-end");window.performance.mark(e),window.performance.measure("".concat(this.event.eventName),this.startMark,e),this.startMark=void 0}}},{key:"cancel",value:function(e,t){void 0!==this.markers.cancel&&this.reportEvent("cancel",Object.assign({category:this.markers.cancel},e),t),this.event=void 0}},{key:"reportEvent",value:function(e,t,n){if(this.event){var r=Object.assign(Object.assign({},this.event),t);r.eventName="".concat(r.eventName,"_").concat(e),"start"!==e&&(r.duration=this.duration),this.logger.sendPerformanceEvent(r,n)}}}],[{key:"start",value:function(t,n,r){return new e(t,n,r)}},{key:"timedExec",value:function(t,n,r,i){var o=e.start(t,n,i);try{var a=r(o);return o.autoEnd(),a}catch(s){throw o.cancel(void 0,s),s}}},{key:"timedExecAsync",value:function(){var t=(0,i.Z)((0,r.Z)().mark((function t(n,i,o,a){var s,u;return(0,r.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return s=e.start(n,i,a),t.prev=1,t.next=4,o(s);case 4:return u=t.sent,s.autoEnd(),t.abrupt("return",u);case 9:throw t.prev=9,t.t0=t.catch(1),s.cancel(void 0,t.t0),t.t0;case 13:case"end":return t.stop()}}),t,null,[[1,9]])})));return function(e,n,r,i){return t.apply(this,arguments)}}()}]),e}(),w=function(){function e(){(0,u.Z)(this,e)}return(0,c.Z)(e,[{key:"send",value:function(e){}},{key:"sendTelemetryEvent",value:function(e,t){}},{key:"sendErrorEvent",value:function(e,t){this.reportError("errorEvent in UT logger!",e,t)}},{key:"sendPerformanceEvent",value:function(e,t){}},{key:"logGenericError",value:function(e,t){this.reportError("genericError in UT logger!",{eventName:e},t)}},{key:"logException",value:function(e,t){this.reportError("exception in UT logger!",e,t)}},{key:"debugAssert",value:function(e,t){this.reportError("debugAssert in UT logger!")}},{key:"shipAssert",value:function(e,t){this.reportError("shipAssert in UT logger!")}},{key:"reportError",value:function(e,t,n){var r=new Error(e);throw r.error=r,r.event=t,console.error(e),console.error(r),r}}]),e}()},37171:function(e,t,n){"use strict";n.d(t,{E:function(){return a}});var r=n(15671),i=n(43144),o=n(60987),a=function(){function e(t,n,i){var o=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new Map;(0,r.Z)(this,e),this.eventBase=t,this.logger=n,this.sampleThreshold=i,this.includeAggregateMetrics=o,this.perBucketProperties=a,this.disposed=!1,this.measurementsMap=new Map}return(0,i.Z)(e,[{key:"measure",value:function(e){var t,n,r,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",a=o.S.now(),s=e(),u=o.S.now()-a,c=this.measurementsMap.get(i);return void 0===c&&(c={count:0,duration:-1},this.measurementsMap.set(i,c)),c.count++,c.duration=u,this.includeAggregateMetrics&&(c.totalDuration=(null!==(t=c.totalDuration)&&void 0!==t?t:0)+u,c.minDuration=Math.min(null!==(n=c.minDuration)&&void 0!==n?n:u,u),c.maxDuration=Math.max(null!==(r=c.maxDuration)&&void 0!==r?r:0,u)),c.count>=this.sampleThreshold&&this.flushBucket(i),s}},{key:"flushBucket",value:function(e){var t=this.measurementsMap.get(e);if(void 0!==t&&0!==t.count){var n=this.perBucketProperties.get(e),r=Object.assign(Object.assign(Object.assign({},this.eventBase),n),t);this.logger.sendPerformanceEvent(r),this.measurementsMap.delete(e)}}},{key:"dispose",value:function(e){var t=this;this.measurementsMap.forEach((function(e,n){return t.flushBucket(n)}))}}]),e}()},84485:function(e,t,n){"use strict";n.d(t,{z:function(){return o}});var r=n(15671),i=n(43144),o=function(){function e(t,n){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:t;(0,r.Z)(this,e),this.threshold=t,this.logger=n,this.thresholdMultiple=i}return(0,i.Z)(e,[{key:"send",value:function(e,t){t<this.threshold||this.logger.sendPerformanceEvent({eventName:e,value:t})}},{key:"sendIfMultiple",value:function(e,t){t===this.thresholdMultiple&&(this.logger.sendPerformanceEvent({eventName:e,value:t}),this.thresholdMultiple=2*this.thresholdMultiple)}}]),e}()},58375:function(e,t,n){"use strict";function r(e,t,n){if(e)return!0;var r="string"===typeof n?{eventName:n,category:"error"}:Object.assign({category:"error"},n);return t.send(r),!1}n.d(t,{M:function(){return r}})},60987:function(e,t,n){"use strict";n.d(t,{S:function(){return r}});var r=window.performance},64562:function(e,t,n){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.generateTestUser=void 0;var i=r(n(21552)),o=n(24659);t.generateTestUser=function(){return{id:(0,o.v4)(),name:(0,i.default)()}}},70580:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.generateTestUser=t.InsecureTokenProvider=void 0;var r=n(69005);Object.defineProperty(t,"InsecureTokenProvider",{enumerable:!0,get:function(){return r.InsecureTokenProvider}});var i=n(64562);Object.defineProperty(t,"generateTestUser",{enumerable:!0,get:function(){return i.generateTestUser}})},49811:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.shortCodeMap=void 0,t.shortCodeMap={"0x000":"nonzero isobuffer byte offset","0x001":"unexpected isobuffer byte length","0x003":"Primary to add to range < last primary!","0x004":"Secondary to add to range < last secondary!","0x005":"Target primary to retrieve < first range's primary!","0x006":"Target primary to retrieve < last range's primary!","0x007":"Target primary to update < first range's primary!","0x008":"Target primary to update < last range's primary!","0x009":"After update, target primary is not first range's primary!","0x00a":"Running timer missing handler","0x00b":"Handler executed without deferred","0x00c":"messageId is incorrect from from the local client's ACK","0x00d":"Missing message handler for message type","0x00e":"Missing message handler for message type","0x00f":"pendingMessageId is missing from the local client's operation","0x010":"Received out of order storage op when there is an unackd clear message","0x011":"pendingMessageId is missing from the local client's operation","0x012":"pendingMessageId is missing from the local client's operation","0x013":"Received out of order op when there is an unackd clear message","0x014":"pendingMessageId is missing from the local client's operation","0x015":"pendingMessageId is missing from the local client's clear operation","0x016":"apply stashed op not implemented for custom value type ops","0x017":"Trying to add invalid handle!","0x018":"Trying to insert handle into position with already valid handle!","0x019":"SharedMatrix.openUndo() supports at most a single IUndoConsumer.","0x01a":"Trying to set out-of-bounds cell!","0x01b":"Trying to set multiple out-of-bounds cells!","0x01c":"The 'localSeq' of the vector submitting an op must >= the 'localSeq' of the other vector.","0x01d":"Trying to submit message to runtime while detached!","0x01e":"Row and col collab window 'localSeq' desynchronized!","0x01f":"Row and col collab window 'collaborating' status desynchronized!","0x020":"Unknown SharedMatrix 'op' type.","0x021":"SharedMatrix message contents have unexpected type!","0x022":"SharedMatrix row and/or col handles are invalid!","0x023":"The 'localSeq' of pending write (if any) must be <= the localSeq of the currently processed op.","0x024":"Start of PermutationSegment already allocated!","0x025":"Trying to set start of PermutationSegment to invalid handle!","0x026":"Trying to split segment at out-of-bounds position!","0x027":"Trying to get handle of out-of-bounds position!","0x028":"'localSeq' for op being resubmitted must be <= the 'localSeq' of the last submitted op.","0x029":"Invalid handle at start of containing segment!","0x02a":"On vector undo, unexpected 'currentOp' type/state!","0x02b":"Must not nest calls to IRevertible.revert()","0x02c":"On cellSet(), invalid row and/or column handles!","0x02d":"Unexpected op type on range remove!","0x02e":"Unexpected op type on range annotate!","0x02f":"Unexpected op type on range insert!","0x030":"Incoming remote op sequence# <= local collabWindow's currentSequence#","0x031":"Incoming remote op minSequence# < local collabWindow's minSequence#","0x032":"localSeq greater than collab window","0x033":"Segment group undefined","0x034":"Segment group not at head of merge tree pending queue","0x035":"Segment group not at head of segment pending queue","0x036":"Segment has no pending properties","0x037":"Segment already has assigned sequence number","0x038":"Incoming op sequence# < local collabWindow's currentSequence#","0x039":"Incoming op sequence# < minSequence#","0x03a":"Number of ops in 'resetOp' must match the number of segment groups provided.","0x03b":"Number of ops in 'resetOp' must match the number of segment groups provided.","0x03c":"Reset op has 'group' delta type!","0x03d":"segmentGroup is array rather than singleton!","0x03e":"minSeq mismatch between collab window and delta manager!","0x03f":"New format should not emit catchup ops","0x040":"Child count is not within [1,7] range!","0x041":"Unexpected child ordinal length!","0x043":"On ack, unexpected segmentGroup!","0x044":"On annotate ack, missing segment property manager!","0x045":"On insert, seq number already assigned!","0x046":"On remove ack, missing removal info!","0x048":"onMinGE()","0x049":"Trying to reload from segments while collaborating!","0x04f":"minSeq of collab window > target minSeq!","0x050":"Next segment changes are undefined!","0x051":"Too many children on merge block!","0x054":"Sequence number less than minSeq!","0x055":"Sequence number is not sorted!","0x056":"Unexpected total for accumulation of all seglen adjustments!","0x057":"Negative length after length adjustment!","0x058":"Both overlapRemoveClients and clientPartials are set!","0x059":"Client view exists but flat view does not!","0x05a":"Mismatch between number of partial lengths on client and flat views!","0x05b":"Flat view exists but client view does not!","0x05c":"Trying to update more annotate props than do exist!","0x05d":"emit: mismatch in segmentsTotalLength","0x05e":"emit: mismatch in totalSegmentCount","0x05f":"Missing blob header on legacy snapshot!","0x060":"There should be only one blob with catch up ops","0x061":"Mismatch in totalLength","0x062":"Mismatch in totalSegmentCount","0x063":"Mismatch in totalLength","0x064":"Mismatch in totalSegmentCount","0x065":"On removal info preservation, segment has invalid removed sequence number!","0x066":"Corrupted preservation of segment metadata!","0x067":"Missing clientId for removal!","0x068":"On consensusOrderedCollection load, job tracking size > 0","0x069":"On consensusOrderedCollection load, data size > 0","0x06a":"Trying to submit message while detached!","0x06b":"Loading snapshot into a non-empty collection","0x06c":"Value should be undefined or non-empty","0x06d":"SharedObjects contained in ConsensusRegisterCollection can no longer be deserialized as of 0.17","0x06e":"Message's reference sequence number < op's reference sequence number!","0x06f":"data missing for non-atomic inbound update!","0x070":"sequence numbers are expected to be 0 when unattached","0x071":"Versions should naturally be ordered by sequenceNumber","0x072":"Unexpected local op when loading not finished","0x073":"Sequence message not operation","0x074":"Snapshot called when not fully loaded","0x075":"SummarySerializer should be used for serializing data during summary.","0x078":"Possible re-entrancy! Summary should not already be in progress.","0x079":"Possible re-entrancy! Summary should have been in progress.","0x07a":"Services should be there to attach delta handler","0x07b":"Unexpected op","0x07c":"Unexpected op type","0x07d":"Unexpected op","0x07e":"Unexpected op type","0x07f":"clientId undefined","0x080":"Invalid document service!","0x081":"Document service already set!","0x082":"Document storage service already set!","0x083":"User selection status does not match replay controller use status!","0x084":"On storage resolve, user selection already made!","0x085":"On storage resolve, missing storage!","0x086":"After storage resolve, user selection status still false!","0x088":"Missing button ops button!","0x089":"Stringified length of chunk contents > total starting length","0x08a":"resetting ChunkedOpProcessor that never wrote back its contents","0x08b":"Unexpected type on contents for fix of an attach!","0x08c":"innerContent for fixing op contents is undefined!","0x08d":"After sanitize, pending incomplete ops!","0x08e":"Potentially missed initial messages","0x08f":"No op handler is setup!","0x090":"No signal handler is setup!","0x091":"Retrieved ops' first sequence number has unexpected value!","0x092":"version input for reading snapshot tree is null!","0x093":"invalid version input for reading snapshot tree!","0x094":"Missing snapshot tree!","0x096":"Trying to remove valid tree IDs in removeNullTreeIds()!","0x097":"Missing param from office.com URL parameter","0x098":"OuterDocumentServiceFactoryProxy unavailable","0x099":"OuterUrlResolverProxy unavailable","0x09a":"'documentId' must be a defined, non-zero length string.","0x09d":"Connection details should contain epoch","0x09f":"No more socketIO refs to remove!","0x0a0":"Unexpected socketIO references on timeout","0x0a1":"Socket reference set unexpectedly does not point to this socket!","0x0a2":"reentrancy not supported!","0x0a4":"Unexpected blob encoding type","0x0a5":"Trying to set ops when they are already set!","0x0a8":"Docid should not contain slashes!!","0x0ad":"Snapshot entry has both a tree value and a referenced id!","0x0ae":"Tried to create rate limiter with 0 max requests!","0x0b0":"Missing document snapshot tree!","0x0b1":"Storage service not initialized","0x0b2":"Missing orderer URL!","0x0b7":"Pathname should be defined","0x0b8":"'tenantId' and 'documentId' must be defined, non-zero length strings.","0x0b9":"PathName should exist","0x0ba":"Tenant id should exist","0x0bb":"Document id should exist","0x0bc":"Runtime has no DataObject!","0x0bd":"Object runtime already has DataObject!","0x0be":"Trying to initialize from existing while initProps is set!","0x0bf":"set called recursively from the interception callback","0x0c0":"set called recursively from the interception callback","0x0c1":"Interception wrapper methods called recursively from the interception callback","0x0c2":"Interception wrapper methods called recursively from the interception callback","0x0c3":"Interception wrapper methods called recursively from the interception callback","0x0c4":"Interception wrapper methods called recursively from the interception callback","0x0c5":"Interception wrapper methods called recursively from the interception callback","0x0c6":"Interception wrapper methods called recursively from the interception callback","0x0c7":"Interception wrapper methods called recursively from the interception callback","0x0c8":"Interception wrapper methods called recursively from the interception callback","0x0c9":"Interception wrapper methods called recursively from the interception callback","0x0ca":"Trying to use legacy graph attach!","0x0cd":"Container disconnected while waiting for ops!","0x0cf":"disconnect event was not raised!","0x0d1":"Container should be attached before close","0x0d2":"resolved url should be valid Fluid url","0x0d3":"Should only be called in detached container","0x0d6":"Inbound queue should be empty when attaching","0x0d9":"Attempting to connect() a closed DeltaManager","0x0dd":"Existing context not disposed","0x0de":"Mismatch in connection state while setting","0x0df":"Missing active connection","0x0e0":"lost minBlobSize policy","0x0e2":"DeltaManager already has attached op handler!","0x0e3":"Newly set op handler is null/undefined!","0x0e4":"Lost old connection!","0x0e6":"old connection exists on new connection setup","0x0e7":"claims/connectionMode mismatch","0x0e8":"readonly perf with write connection","0x0e9":"messageBuffer is not empty on new connection","0x0eb":"Missing connection for reconnect","0x0ec":"Unexpected value for previously processed message's sequence number","0x0ed":"non-system message have to have clientId","0x0ee":"Not accounting local messages correctly","0x0ef":"client seq# not growing","0x0f0":"Incoming local client seq# > generated by this client","0x0f2":"previouslyProcessedMessage","0x0f3":"not positive","0x0f4":"Nonzero pause-count on resume()","0x0f6":"real blob ID exists","0x0f7":"aggregate blob missing","0x0f8":"blob from aggregate blob exists on its own","0x0f9":"never read summary","0x0fa":"virtual blob not found","0x0fb":"logic err with aggregator","0x0fc":"tree reuse at lower level","0x0fd":"data stores are writing incremental summaries!","0x0fe":"attachment is aggregate blob","0x0ff":"duplicate aggregate blob","0x100":"logic error","0x101":"Unexpected tree entry type on flatten!","0x102":"invalid level of concurrency","0x103":"trying to parallel run while not working","0x104":"undefined end point for parallel fetch","0x105":"unexpected end point for parallel fetch","0x107":"ending dispatch with remaining results to be sent","0x108":"ending results dispatch but knew in advance about more requests","0x109":"unexpected next chunk position","0x10a":"cannot add parallel request while not working","0x10b":"invalid parallel request range","0x10c":"invalid parallel request start point","0x10d":"invalid parallel request end point","0x10e":"should not throw result if we knew about boundary in advance","0x10f":"empty/partial chunks should not be returned by caching","0x110":"callback should retry until valid fetch before it learns new boundary","0x112":"cannot push onto queue if done","0x113":"deferred queue should be empty","0x114":"cannot pop if deferred","0x115":"queue should not be done during pop","0x116":"Missing handle on scheduler load","0x117":"Trying to get missing clientId!","0x118":"Bad client interactive check","0x119":"This agent became inactive while releasing","0x11a":"Unsuccessful registration","0x11b":"Trying to clear tasks on inactive agent","0x11c":"Detached object routing context","0x11d":"task is already running","0x11e":"client is undefined","0x11f":"requesting unknown blobs","0x120":"Undefined latency statistics (op send time)","0x121":"Undefined inner contents type!","0x122":"Message to unpack is not proper runtime message","0x124":"inconsistent readonly property/event state","0x125":"Unsafe to transition to read-only state!","0x126":"Expected createSubRequest url to include a leading slash","0x127":"dirty document event not set on replay","0x12a":"Missing blob id on metadata","0x12b":"did not get root data store","0x12d":"Container Context should already be in attaching state","0x12e":"Container Context should already be in attached state","0x12f":"Container Runtime's summarize should always return a tree","0x131":"Mismatch between new chunkId and expected chunkMap","0x132":"sending ops in detached container","0x133":"Container disconnected when trying to submit system message","0x137":"Failed to get version from storage","0x138":"Failed to get snapshot from storage","0x139":"Undefined package path","0x13a":"Data store ID contains slash","0x13b":"datastore context is already in bound state","0x13c":"undefined channel on datastore context","0x13d":"Detached runtime creation on realize()","0x13e":"Unexpected package path","0x13f":"datastore context registry is already set","0x140":"undefined channel on datastore context","0x141":"Unexpected connected state","0x142":"local store channel is not loaded","0x143":"Channel should not be undefined when running GC","0x144":"Channel should be loaded when updating used routes","0x145":"Channel should be present when data store is loaded","0x146":"Channel must exist when submitting message","0x147":"Channel must exist on submitting signal","0x148":"Detached runtime creation on runtime bind","0x149":"Undefined channel deferral","0x14a":"Undefined package path","0x14b":"Channel must exist when resubmitting ops","0x14c":"Channel must exist when rebasing ops","0x14d":"Should move from detached to attaching","0x14e":"Should move from attaching to attached","0x14f":"There should be a channel when generating attach message","0x150":"pkg should be available in local data store context","0x152":"pkg should be available in local data store","0x154":"runtime creation is already attached","0x155":"channel deferral is already set","0x156":"Unexpected factory for package path","0x157":"datastore registry already attached","0x158":"Creating store with existing ID","0x159":"The given id was not found in notBoundContexts to delete","0x15a":"Cannot find context to resolve to","0x15b":"Expected this id to already be removed from notBoundContexts","0x15c":"Cannot find deferred to resolve","0x15d":"Creating store with existing ID","0x15e":"Local object does not have matching attach message id","0x15f":"Could not find unbound context to bind","0x160":"There should be a store context for the op","0x161":"There should be a store context for the op","0x162":"There should be a store context for the op","0x163":"Missing datastore for local signal","0x165":"Summarizer cannot work if client has local changes","0x166":"BaseSnapshot should be there as detached container loaded from snapshot","0x167":"Used route does not belong to any known data store","0x168":"Expected tree in snapshot not found","0x169":"No pending message found for this remote message","0x16b":"The pending batch state indicates we are already processing a batch","0x16d":"There is no pending batch begin message","0x16e":"Batch with single message should not have batch metadata","0x16f":"Did not receive batch begin metadata","0x170":"Did not receive batch end metadata","0x171":"No pending state found for the remote message","0x172":"The connection state is not consistent with the runtime","0x173":"replayPendingStates called twice for same clientId!","0x174":"initial states should be empty before replaying pending","0x175":"Can only broadcast if summarizer starts in local state","0x176":"Can only ack/nack if summarizer is in broadcasting state","0x177":"Missing delta handler","0x178":"Missing delta handler on attach","0x179":"createChannel() with existing ID","0x17a":"Channel should be loaded when created!!","0x17b":"Channel to be binded should be in not bounded set","0x17c":"Unexpected attach (local) channel OP","0x17e":"Used route does not belong to any known context","0x17f":"Not expecting detached channels during summarize","0x180":"getAttachSummary should always return a tree","0x181":"BaseSnapshot should be there as detached container loaded from snapshot","0x182":"Data store should be attached to attach the channel.","0x183":"There should be a channel context for the op","0x184":"There should be a channel context for the op","0x185":"Channel not found","0x189":"Should always be remote because a local dds shouldn't generate ops before loading","0x18a":"Channel should be loaded to resubmit ops","0x18c":"Channel should be loaded to summarize","0x18d":"Channel should be loaded to take snapshot","0x18e":"Channel must not already be loaded when loading","0x190":".attributes blob should be present","0x192":"Channel should be there if loaded!!","0x193":"Channel should be loaded to run GC","0x194":"Remote channel must be loaded when rebasing op","0x195":"Remote channel must not be local when processing op","0x196":"Remote channel must be loaded when resubmitting op","0x197":"Remote channel must not already be loaded when loading","0x198":"Used route should always be an absolute route","0x19a":"Invalid response value for Fluid object request","0x19b":"Cannot not create response error on 200 status","0x19c":"storage service path has trailing separator","0x19d":"Handles should always have absolute paths","0x19f":"wipSummaryLogger should not be set yet in startSummary","0x1a0":"Already tracking a summary","0x1a1":"summarize should not be called when not tracking the summary","0x1a2":"wipSummaryLogger should have been set in startSummary or ctor","0x1a3":"wipSummaryLogger should have been set in startSummary or ctor","0x1a4":"Not tracking a summary","0x1a5":"Tracked summary local paths not set","0x1a6":"Not found pending summary, but this node has previously completed a summary","0x1a7":"Pending summary reference sequence number should be consistent","0x1a9":"When loading base summary, expected outstanding ops <= tracking sequence number","0x1aa":"Out of order change recorded","0x1ab":"Create SummarizerNode child already exists","0x1ac":"Cannot create child from summary if parent does not have latest summary","0x1ad":"Missing child summary tree","0x1ae":"Child summary object is not a tree","0x1af":"Outstanding ops blob missing, but base summary tree exists","0x1b0":"Base summary tree missing, but outstanding ops blob exists","0x1b1":"wip used routes should be set if tracking a summary","0x1b2":"Getting GC data should not be called when GC is disabled!","0x1b3":"GC data cannot be retrieved without getGCDataFn","0x1b4":"We should not already be tracking used routes when to track a new summary","0x1b5":"We should have been tracking used routes","0x1b6":"Create SummarizerNode child already exists","0x1b7":"Bad session state for processing quorum messages","0x1b8":"Bad session state for processing quorum messages","0x1b9":"Unexpected value for sequence number of first message in file","0x1ba":"should not return empty buckets","0x1bb":"Unexpected sequence number on first of messages to save","0x1bc":"Unexpected sequence number on last of messages to save","0x1bd":"Stopped writing at unexpected sequence number","0x1c5":"snapshot should be set before retrieving it","0x1c6":"snapshot should be set before retrieving it","0x1c7":"snapshot should be set before retrieving it as expanded string","0x1c8":"Mismatch between document sequence number and current op number","0x1c9":"Leftover documents after replay!","0x1ca":"replay-to target is <= current op in replay cycle","0x1cb":"Bad window to verify snapshot","0x1cc":"Unexpected previous snapshot op number","0x1ce":"clientId not found","0x1cf":"clientId not found","0x1d0":"sequenceNumber not found","0x1d3":"Missing client id on disconnect","0x1d5":"Invalid snapshot format version","0x1d6":"Parent summary object is not a tree","0x1d8":"Should only transition from Connecting state","0x1d9":"addRequestCore() should break into smaller chunks","0x1da":"Client id should be set if connected","0x1db":"epoch exists","0x1dc":"all entries have to have epoch","0x1dd":"no epoch","0x1de":"Not an ODSP resolved url","0x1e0":"Protocol and App summary trees should be present","0x1e2":"Caller must ensure 'isAttached()' before calling 'sendSetCellOp'.","0x1e4":"Unexpected serializable type","0x1e5":"Storage token should not be null","0x1e6":"Epoch  should be present in response","0x1e7":"caching was not performed!","0x1e8":"reentrancy","0x1e9":"Pending ops","0x1ea":"Prefetch snapshot only available for odsp!","0x1eb":"Snapshot should be prefetched!","0x1ec":"No refresh token provided.","0x1ed":"Share link should be present","0x1ef":"services must be defined","0x1f0":"Unexpected mismatch in readonly","0x1f5":"Attached state should have storage","0x1f6":"Negative client sequence number not allowed","0x1f7":"Previous client should always be defined","0x1f8":"local BlobAttach op with no pending blob","0x1fc":"summary is not a tree","0x1fe":"isolated channels subtree should exist in remote datastore snapshot","0x1ff":"isolated channels subtree should exist in local datastore snapshot","0x200":"Returned odsp snapshot is malformed. No trees!","0x201":"Returned odsp snapshot is malformed. No blobs!","0x203":"Summary handle is undefined","0x205":"attach() called more than once","0x207":"Channel should be defined","0x208":"Factory should be undefined before loading","0x209":"Factory Type should be defined","0x20a":"register for event on disposed object","0x20b":"mismatch","0x20c":"connection disposed","0x20d":"double connection listener","0x20e":"double tracked listener","0x20f":"Driver min read version should >= to server minReadVersion","0x210":"Snapshot should be created with minReadVersion or above","0x219":"1 root should be there","0x21b":"Snapshot id should be provided","0x21c":"Seq number should be provided","0x21d":"body is not string","0x21e":"improper boundary format","0x220":"socket key collision","0x221":"Root tree should contain the id","0x222":"Root tree should contain the id!!","0x223":"unexpected end of buffer","0x224":"Skip length should be positive","0x225":"Data should be there","0x226":"Should write complete data","0x227":"Data should be there","0x22b":"Should be a pair","0x22c":"reading pairs","0x231":"Number should be an integer","0x232":"Payload should not be negative","0x233":"Unexpected data at the end of buffer","0x234":"has joinOpTimer","0x235":"no joinOpTimer","0x236":"In all cases it should be already installed","0x237":"Snapshot should exist","0x238":"called only in connected state","0x239":"called only in disconnected state","0x23a":"seq#'s","0x23b":"we are not packing at the right level","0x23c":"we are not packing at the right level","0x23d":"pending is undefined","0x23e":"pending is undefined","0x23f":"pending undefined","0x240":"Binary format snapshot only for odsp driver!!","0x241":"disconnect should result in stopSequenceNumberUpdate() call","0x242":"has timer","0x243":"stopSequenceNumberUpdate should be called as result of sending any op!","0x244":"Socket is closed, but connection is not!","0x245":"tracked listener","0x246":"checking consistency of socket & _disposed flags","0x247":"Use addTrackedListener instead","0x248":"should not subscribe to forwarded events","0x24c":"Cannot call `flush()` from `orderSequentially`'s callback","0x24e":"assertion for type narrowing","0x250":"serialized container with attachment blobs must be rehydrated with detached blob storage","0x251":"creation summary has to have seq=0 && handle === undefined","0x252":"redirect table can only be set in detached container","0x253":"redirect table already exists","0x254":"unrecognized id in redirect table","0x255":"detached blob id absent in redirect table","0x256":"storage undefined in attached container","0x257":"This is not summarizing container","0x258":"connected","0x259":"Container disconnected when trying to submit system message","0x25b":"Caller is responsible for checking lock","0x25d":"We should never connect as 'read'","0x25e":"no reason to call fail if all promises have been completed","0x25f":"retryAfterSeconds","0x260":"Disposed should mean disconnected!","0x261":"Expected: off","0x262":"Old summarizer is still working!","0x263":"Expected: starting","0x264":"Expected: Not Off","0x266":"lastKnownSeqNumber should never be below last processed sequence number","0x267":"lastObservedSeqNumber should be updated first","0x268":"There can't be pending fetch that early in boot sequence!","0x269":"pending ops are not dropped","0x26a":"not closed","0x26b":"initial state","0x26c":"handler should be installed","0x26d":"wrong start","0x26e":"wrong start","0x26f":"continuous and no duplicates","0x270":"All requested ops fetched","0x272":"empty request","0x273":"Invalid document id from parsed URL","0x274":"type check","0x275":"Root tree should contain the id","0x278":"API is not supported for non-connecting or closed container","0x27b":"reentrancy may result in incorrect behavior","0x280":"Validate first op seq number","0x281":"Unreferenced if present should be true","0x282":"Headers should be present now","0x283":"Length of data len should fit in the bytes from the map","0x284":"Length of id should fit in the bytes from the map","0x285":"Start code should not undefined","0x286":"End code should not undefined","0x287":"key must exist in the map","0x288":"All properties should exist","0x289":"logic error","0x28a":"can't be disposed - Callers need to ensure that!","0x292":"Unexpected undefined result from getFileLinkCore","0x293":"initial state","0x294":"can't have op processing paused if we are processing an op","0x295":"there should be no pending batch if we have no ops","0x296":"we should never start processing incomplete batch!","0x297":"always called from resumed state","0x298":"we have something in the queue that generates this event","0x299":"non-synchronized state","0x29a":"System message in the middle of batch!","0x29b":"system op in a batch?","0x29c":"we should be processing ops when there is no active batch","0x29d":"we should be processing ops when there is no active batch","0x29e":"there can't be active batch","0x29f":"we should be processing ops when there is no active batch","0x2a0":"batch presence was validated above","0x2a1":"logic error","0x2a2":"Batch is interrupted by other client op. Should be caught by trackPending()","0x2a3":"container should be closed on any error","0x2a5":"join timer","0x2a6":"waitingForLeaveOp should imply writeConnection (we need to be ready to flush pending ops)","0x2a7":"Container is not attached","0x2a8":"Expected data store snapshot tree in base snapshot","0x2a9":"GC nodes for data store not in GC blob","0x2ac":"Connected when timeout waiting for leave from previous session fired!","0x2ad":"GC blob missing from snapshot","0x2ae":"node id should always be an absolute route","0x2af":"Child GC data should have been initialized","0x2b0":"Used route should always be an absolute route","0x2b1":"This should have be initiallized when generate GC nodes above","0x2b2":"Two entries for the same GC node with different unreferenced timestamp","0x2b3":"logic error","0x2b4":"not connected on sending ops!","0x2b5":"logic error","0x2b6":"Missing data store context","0x2b8":"Chunk should be set in map","0x2ba":"batchBegin must fire before batchEnd","0x2bb":"Instrumented token fetcher with throwOnNullToken = true should never return null","0x2bc":"Instrumented token fetcher with throwOnNullToken =true should never return null","0x2bd":"We should not see a pending FlushMode until we see a flush when processing a batch","0x2be":"LocalReferences array contains a gap","0x2bf":"both removedClientIds and removedSeq should be set or not set","0x2c0":"ID must be created before adding interval to collection","0x2c1":"Creating an interval collection that already exists?","0x2c2":"Create Version should be equal to currentReadVersion","0x2c4":"client should not be summarizer before container is created","0x2c5":"Attempting to connect() a closed Container","0x2c6":"Attempting to connect() a container that is not attached","0x2c7":"Attempting to disconnect() a closed Container","0x2c8":"outboundPushEventTime should be undefined","0x2c9":"durationNetwork should be undefined","0x2ca":"durationOutboundBatching should be undefined","0x2cb":"submitOpEventTime should be undefined","0x2cc":"OpTimeSittingInboundQueue should be undefined","0x2cd":"durationNetwork should be undefined","0x2ce":"msnTrackingTimestamp should not be undefined","0x2cf":"undefined channel on datastore context","0x2d0":"Data store should be globally visible to attach channels.","0x2d1":"Data store should be locally visible before it can become globally visible.","0x2d2":"Data store should be globally visible when its attached.","0x2d3":"Local channel must be globally visible when processing op","0x2d4":"Local channel must be globally visible when resubmitting op","0x2d5":"Invalid blob node id in unused routes.","0x2d7":"No data store with specified id","0x2d8":"Empty change event should not be emitted.","0x2da":"Unknown SharedMatrix 'op' type.","0x2db":"Applying op must generate a pending segment","0x2dc":"Cannot find code proposal","0x2dd":"Cannot find blob for a given id","0x2de":"Package path requested for unsupported node type.","0x2df":"transient references cannot be bound to segments","0x2e0":"lref not a Local Reference","0x2e1":"Support for plain value types removed.","0x2e2":"Must only wait for leave message when clientId in quorum","0x2e3":"Must have a valid protocol handler instance","0x2e4":"there should be service config for active connection","0x2e5":"Must have a base snapshot","0x2e6":"Must have a base snapshot","0x2e7":"Must serialize base snapshot blobs before getting runtime state","0x2e8":"There should be a store context for the op","0x2e9":"Must call getLocalState() after applying initial states","0x2ea":"Configuration state should be enabled","0x2eb":"Summary not supported with configuration disabled","0x2ec":"Blob must be present in blobsContents","0x2ed":"There should be a channel context for the op","0x2ee":"Channel should be loaded to rollback ops","0x2ef":"Local channel must be globally visible when rolling back op","0x2f0":"Remote channel must be loaded when rolling back op","0x2f1":"slideReferences from a segment which has not been removed and acked","0x2f2":"Ref not in the segment localRefs","0x2f3":"Ref not in the segment localRefs","0x2f4":"localRefs must be allocated","0x2f5":"op create references must be SlideOnRemove","0x2f6":"SlideOnRemove references must be op created","0x2f8":"Unexpected accept op, nothing pending","0x2f9":"Unexpected accept op, client not in expectedSignoffs","0x2fa":"Unexpected pending message received","0x2fb":"pendingMessageId does not match","0x2fc":"Invalid localOpMetadata for clear","0x2fd":"pendingMessageId does not match","0x2fe":"Invalid localOpMetadata in submit","0x2ff":"Unexpected pending message received","0x300":"localSeq greater than collab window","0x301":"Either seq or localSeq should be defined","0x302":"No segment found","0x303":"Invalid offset","0x304":"Id cannot contain slashes","0x305":"registerDependent on disposed Dependee","0x306":"invalidateDependents on disposed Dependee","0x307":"endInitialization should be called exactly once","0x308":"onDispose should be set when disposing","0x309":"Cannot unregister dependees on a disposed SimpleObservingDependent.","0x30a":"shouldClientJoinWrite should imply this is a writeConnection","0x30b":"Must have a valid protocol handler instance","0x30c":"Id cannot contain slashes","0x30d":"Id cannot contain slashes","0x30e":"Id cannot contain slashes. DataStoreContext should have validated this.","0x30f":"Channel context ID cannot contain slashes","0x310":"Channel context ID cannot contain slashes","0x311":"expected id to exist on interval","0x312":"snapshot should be parsed","0x313":'Specified user was not of type "TinyliciousUser".',"0x314":"Container properly closed","0x315":"re-entrancy","0x316":"There should be a cached promise of in-progress aliasing","0x317":"dataStoreFactory is undefined","0x318":"resolvedUrl is undefined","0x319":"No delta connection server associated with specified document ID","0x31a":"resolvedUrl is undefined","0x31b":"container1.resolvedUrl is undefined","0x31c":"rightDiv is undefined","0x31d":'options are not of type "IRouterliciousRouteOptions" as expected',"0x31e":"options.tenantId is undefined","0x320":"options.tenantId is undefined","0x322":"options.fluidHost is undefined","0x324":"options.server is undefined","0x325":"options.odspAccessToken is undefined","0x326":"lockResolver is undefined","0x327":"options.server is undefined","0x328":"options.server is undefined","0x329":"browser.umd property is undefined","0x32a":"pendingMessageId does not match","0x32b":"Invalid localOpMetadata for clear","0x32c":"pendingMessageId does not match","0x32d":"Invalid localOpMetadata in submit","0x32e":"Unexpected pending message received","0x32f":"Invalid localOpMetadata for sub directory op","0x330":"Unexpected pending message received","0x331":"Unexpected pending message received","0x332":"Unexpected pending message received","0x333":"PathShared.splice can only insert detached ranges","0x334":"Anchor must not be double freed","0x335":"ObjectForest.getRoot only valid for existing roots","0x336":"ObjectForest must only be given its own Anchors","0x337":"ObjectForest must only be given its own Cursor type","0x338":"ObjectForest must only be given its own Cursor","0x339":"Anchor must not be double freed","0x33a":"Anchor must not be double freed","0x33b":"Cursor must not be freed","0x33c":"Cursor must not be freed","0x33d":"Cursor must be current to be used","0x33e":"Cursor must be current to be used","0x33f":"Cursor must not be double freed","0x340":"Cursor must be current to be used","0x341":"Cursor must be current to be used","0x342":'Invalid usage. "blobid" should always be null',"0x343":'Invalid usage. "count" should always be 1',"0x344":"this.pendingConnection should be undefined","0x345":"this.pendingConnection is undefined when trying to cancel","0x346":"inboundQueuePausedFromInit should be true"}},82408:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.generateUser=t.generateToken=void 0;var r=n(6313),i=n(24659);function o(){return{id:(0,i.v4)(),name:(0,i.v4)()}}t.generateToken=function(e,t,n,a,s){var u=arguments.length>5&&void 0!==arguments[5]?arguments[5]:3600,c=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"1.0",l=s||o();""!==l.id&&void 0!==l.id||(l=o());var d=Math.round(Date.now()/1e3),h={documentId:null!==a&&void 0!==a?a:"",scopes:n,tenantId:e,user:l,iat:d,exp:d+u,ver:c,jti:(0,i.v4)()},f={utf8:t};return r.KJUR.jws.JWS.sign(null,JSON.stringify({alg:"HS256",typ:"JWT"}),h,f)},t.generateUser=o},69005:function(e,t,n){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),i=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||r(t,e,n)};Object.defineProperty(t,"__esModule",{value:!0}),i(n(49590),t),i(n(93408),t),i(n(53887),t),i(n(14777),t),i(n(87245),t),i(n(17501),t),i(n(28958),t),i(n(61660),t)},49590:function(e,t,n){"use strict";var r=n(17061).default,i=n(17156).default,o=n(56690).default,a=n(89728).default;Object.defineProperty(t,"__esModule",{value:!0}),t.InsecureTokenProvider=void 0;var s=n(21885),u=n(82408),c=function(){function e(t,n){o(this,e),this.tenantKey=t,this.user=n}return a(e,[{key:"fetchOrdererToken",value:function(){var e=i(r().mark((function e(t,n){return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",{fromCache:!0,jwt:(0,u.generateToken)(t,this.tenantKey,[s.ScopeType.DocRead,s.ScopeType.DocWrite,s.ScopeType.SummaryWrite],n,this.user)});case 1:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"fetchStorageToken",value:function(){var e=i(r().mark((function e(t,n){return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",{fromCache:!0,jwt:(0,u.generateToken)(t,this.tenantKey,[s.ScopeType.DocRead,s.ScopeType.DocWrite,s.ScopeType.SummaryWrite],n,this.user)});case 1:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()}]),e}();t.InsecureTokenProvider=c},53887:function(e,t,n){"use strict";var r=n(17061).default,i=n(17156).default,o=n(56690).default,a=n(89728).default,s=n(61655).default,u=n(26389).default;Object.defineProperty(t,"__esModule",{value:!0}),t.MockDeltaManager=t.MockDeltaQueue=void 0;var c=n(47465),l=n(13114),d=function(e){s(n,e);var t=u(n);function n(){var e;return o(this,n),(e=t.call(this)).queue=[],e.pauseCount=0,e.processCallback=function(){},e}return a(n,[{key:"disposed",get:function(){}},{key:"paused",get:function(){return 0!==this.pauseCount}},{key:"length",get:function(){return this.queue.length}},{key:"idle",get:function(){return 0===this.queue.length}},{key:"process",value:function(){var e=this;Promise.resolve().then((function(){for(;0===e.pauseCount&&e.length>0;){var t=e.pop();(0,l.assert)(void 0!==t,"this is impossible due to the above length check"),e.processCallback(t)}}))}},{key:"push",value:function(e){this.queue.push(e),this.emit("push",e),this.process()}},{key:"pop",value:function(){return this.queue.shift()}},{key:"pause",value:function(){var e=i(r().mark((function e(){return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.pauseCount++,e.abrupt("return");case 2:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"resume",value:function(){this.pauseCount--,this.process()}},{key:"peek",value:function(){return this.queue[0]}},{key:"toArray",value:function(){return this.queue}},{key:"dispose",value:function(){}},{key:"waitTillProcessingDone",value:function(){var e=i(r().mark((function e(){return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new Error("NYI");case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()}]),n}(c.EventEmitter);t.MockDeltaQueue=d;var h=function(e){s(n,e);var t=u(n);function n(){var e;return o(this,n),(e=t.call(this)).readOnlyInfo={readonly:!1},e.clientType=void 0,e.clientDetails=void 0,e._inbound=void 0,e._inboundSignal=void 0,e._outbound=void 0,e.minimumSequenceNumber=0,e.lastSequenceNumber=0,e.lastKnownSeqNumber=0,e.initialSequenceNumber=0,e.hasCheckpointSequenceNumber=!1,e._inbound=new d,e._outbound=new d,e._inboundSignal=new d,e}return a(n,[{key:"disposed",get:function(){}},{key:"IDeltaSender",get:function(){return this}},{key:"inbound",get:function(){return this._inbound}},{key:"outbound",get:function(){return this._outbound}},{key:"inboundSignal",get:function(){return this._inboundSignal}},{key:"version",get:function(){}},{key:"maxMessageSize",get:function(){return 0}},{key:"serviceConfiguration",get:function(){}},{key:"active",get:function(){return!0}},{key:"close",value:function(){}},{key:"submitSignal",value:function(e){}},{key:"flush",value:function(){}},{key:"submit",value:function(e,t){return 0}},{key:"dispose",value:function(){}}]),n}(l.TypedEventEmitter);t.MockDeltaManager=h},14777:function(e,t,n){"use strict";var r=n(17061).default,i=n(17156).default,o=n(56690).default,a=n(89728).default;Object.defineProperty(t,"__esModule",{value:!0}),t.MockHandle=void 0;var s=n(14993),u=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"mock-handle-".concat(Math.random().toString(36).slice(2)),r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"/".concat(n);o(this,e),this.value=t,this.path=n,this.absolutePath=r,this.graphAttachState=s.AttachState.Detached}return a(e,[{key:"IFluidHandle",get:function(){return this}},{key:"isAttached",get:function(){return this.graphAttachState===s.AttachState.Attached}},{key:"get",value:function(){var e=i(r().mark((function e(){return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.value);case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"attachGraph",value:function(){this.graphAttachState=s.AttachState.Attached}},{key:"bind",value:function(){throw Error("MockHandle.bind() unimplemented.")}}]),e}();t.MockHandle=u},28958:function(e,t,n){"use strict";var r=n(74704).default,i=n(17061).default,o=n(17156).default,a=n(56690).default,s=n(89728).default;Object.defineProperty(t,"__esModule",{value:!0}),t.MockStorage=void 0;var u=n(13114),c=n(17267),l=function(){function e(t){a(this,e),this.tree=t}return s(e,[{key:"readBlob",value:function(){var t=o(i().mark((function t(n){var r;return i().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=e.readBlobCore(this.tree,n.split("/")),(0,u.assert)(void 0!==r,"Blob does not exist: ".concat(n)),t.abrupt("return",(0,u.stringToBuffer)(r.contents,r.encoding));case 3:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()},{key:"contains",value:function(){var t=o(i().mark((function t(n){return i().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",void 0!==e.readBlobCore(this.tree,n.split("/")));case 1:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()},{key:"list",value:function(){var e=o(i().mark((function e(t){return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.listBlobsAtTreePath)(this.tree,t));case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}],[{key:"createFromSummary",value:function(t){return new e((0,c.convertSummaryTreeToITree)(t))}},{key:"readBlobCore",value:function(t,n){if(t){var i,o=r(t.entries);try{for(o.s();!(i=o.n()).done;){var a=i.value;if(a.path===n[0])return"Blob"===a.type?((0,u.assert)(1===n.length,JSON.stringify(Object.assign({},arguments))),a.value):"Tree"===a.type?e.readBlobCore(a.value,n.slice(1)):void 0}}catch(s){o.e(s)}finally{o.f()}}else;}}]),e}();t.MockStorage=l},87245:function(e,t,n){"use strict";var r=n(17061).default,i=n(17156).default,o=n(61655).default,a=n(26389).default,s=n(74704).default,u=n(27424).default,c=n(56690).default,l=n(89728).default;Object.defineProperty(t,"__esModule",{value:!0}),t.MockSharedObjectServices=t.MockObjectStorageService=t.MockEmptyDeltaConnection=t.MockFluidDataStoreRuntime=t.MockQuorumClients=t.MockContainerRuntimeFactory=t.MockContainerRuntime=t.MockDeltaConnection=void 0;var d=n(47465),h=n(13114),f=n(14993),p=n(24589),v=n(21885),g=n(17267),m=n(24659),y=n(53887),b=function(){function e(t,n){c(this,e),this.submitFn=t,this.dirtyFn=n,this._connected=!0}return l(e,[{key:"connected",get:function(){return this._connected}},{key:"attach",value:function(e){this.handler=e,e.setConnectionState(this.connected)}},{key:"submit",value:function(e,t){return this.submitFn(e,t)}},{key:"dirty",value:function(){this.dirtyFn()}},{key:"setConnectionState",value:function(e){var t;this._connected=e,null===(t=this.handler)||void 0===t||t.setConnectionState(e)}},{key:"process",value:function(e,t,n){var r;null===(r=this.handler)||void 0===r||r.process(e,t,n)}},{key:"reSubmit",value:function(e,t){var n;null===(n=this.handler)||void 0===n||n.reSubmit(e,t)}}]),e}();t.MockDeltaConnection=b;var w=function(){function e(t,n){var r;c(this,e),this.dataStoreRuntime=t,this.factory=n,this.clientSequenceNumber=0,this.deltaConnections=[],this.pendingMessages=[],this.deltaManager=new y.MockDeltaManager,this.dataStoreRuntime.deltaManager=this.deltaManager,this.dataStoreRuntime.quorum=n.quorum,this.clientId=null!==(r=this.dataStoreRuntime.clientId)&&void 0!==r?r:(0,m.v4)(),n.quorum.addMember(this.clientId,{})}return l(e,[{key:"createDeltaConnection",value:function(){var e=this,t=new b((function(t,n){return e.submit(t,n)}),(function(){return e.dirty()}));return this.deltaConnections.push(t),t}},{key:"submit",value:function(e,t){var n=this.clientSequenceNumber++,r={clientId:this.clientId,clientSequenceNumber:n,contents:e,referenceSequenceNumber:this.deltaManager.lastSequenceNumber,type:v.MessageType.Operation};return this.factory.pushMessage(r),this.addPendingMessage(e,t,n),n}},{key:"dirty",value:function(){}},{key:"process",value:function(e){this.deltaManager.lastSequenceNumber=e.sequenceNumber,this.deltaManager.lastMessage=e,this.deltaManager.minimumSequenceNumber=e.minimumSequenceNumber;var t=this.processInternal(e),n=u(t,2),r=n[0],i=n[1];this.deltaConnections.forEach((function(t){t.process(e,r,i)}))}},{key:"addPendingMessage",value:function(e,t,n){var r={content:e,clientSequenceNumber:n,localOpMetadata:t};this.pendingMessages.push(r)}},{key:"processInternal",value:function(e){var t,n=this.clientId===e.clientId;if(n){var r=this.pendingMessages.shift();(0,h.assert)((null===r||void 0===r?void 0:r.clientSequenceNumber)===e.clientSequenceNumber,"Unexpected client sequence number from message"),t=r.localOpMetadata}return[n,t]}}]),e}();t.MockContainerRuntime=w;var S=function(){function e(){c(this,e),this.sequenceNumber=0,this.minSeq=new Map,this.quorum=new k,this.messages=[],this.runtimes=[]}return l(e,[{key:"outstandingMessageCount",get:function(){return this.messages.length}},{key:"getMinSeq",value:function(){var e,t,n=s(this.minSeq);try{for(n.s();!(t=n.n()).done;){var r=u(t.value,2)[1];e=e?Math.min(e,r):r}}catch(i){n.e(i)}finally{n.f()}return null!==e&&void 0!==e?e:0}},{key:"createContainerRuntime",value:function(e){var t=new w(e,this);return this.runtimes.push(t),t}},{key:"pushMessage",value:function(e){e.clientId&&void 0!==e.referenceSequenceNumber&&!this.minSeq.has(e.clientId)&&this.minSeq.set(e.clientId,e.referenceSequenceNumber),this.messages.push(e)}},{key:"processOneMessage",value:function(){if(0===this.messages.length)throw new Error("Tried to process a message that did not exist");var e=this.messages.shift();e=JSON.parse(JSON.stringify(e)),this.minSeq.set(e.clientId,e.referenceSequenceNumber),e.sequenceNumber=++this.sequenceNumber,e.minimumSequenceNumber=this.getMinSeq();var t,n=s(this.runtimes);try{for(n.s();!(t=n.n()).done;){t.value.process(e)}}catch(r){n.e(r)}finally{n.f()}}},{key:"processSomeMessages",value:function(e){if(e>this.messages.length)throw new Error("Tried to process more messages than exist");for(var t=0;t<e;t++)this.processOneMessage()}},{key:"processAllMessages",value:function(){for(;this.messages.length>0;)this.processOneMessage()}}]),e}();t.MockContainerRuntimeFactory=S;var k=function(){function e(){var t;c(this,e),this.eventEmitter=new d.EventEmitter,this.disposed=!1;for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];this.members=new Map(null!==(t=r)&&void 0!==t?t:[])}return l(e,[{key:"addMember",value:function(e,t){this.members.set(e,t),this.eventEmitter.emit("addMember",e,t)}},{key:"removeMember",value:function(e){this.members.delete(e)&&this.eventEmitter.emit("removeMember",e)}},{key:"getMembers",value:function(){return this.members}},{key:"getMember",value:function(e){return this.getMembers().get(e)}},{key:"dispose",value:function(){throw new Error("Method not implemented.")}},{key:"addListener",value:function(e,t){throw new Error("Method not implemented.")}},{key:"on",value:function(e,t){switch(e){case"afterOn":return this.eventEmitter.on(e,t),this;case"addMember":case"removeMember":return this.eventEmitter.on(e,t),this.eventEmitter.emit("afterOn",e),this;default:throw new Error("Method not implemented.")}}},{key:"once",value:function(e,t){throw new Error("Method not implemented.")}},{key:"prependListener",value:function(e,t){throw new Error("Method not implemented.")}},{key:"prependOnceListener",value:function(e,t){throw new Error("Method not implemented.")}},{key:"removeListener",value:function(e,t){return this.eventEmitter.removeListener(e,t),this}},{key:"off",value:function(e,t){return this.eventEmitter.off(e,t),this}},{key:"removeAllListeners",value:function(e){throw new Error("Method not implemented.")}},{key:"setMaxListeners",value:function(e){throw new Error("Method not implemented.")}},{key:"getMaxListeners",value:function(){throw new Error("Method not implemented.")}},{key:"listeners",value:function(e){throw new Error("Method not implemented.")}},{key:"rawListeners",value:function(e){throw new Error("Method not implemented.")}},{key:"emit",value:function(e){throw new Error("Method not implemented.")}},{key:"eventNames",value:function(){throw new Error("Method not implemented.")}},{key:"listenerCount",value:function(e){throw new Error("Method not implemented.")}}]),e}();t.MockQuorumClients=k;var C=function(e){o(n,e);var t=a(n);function n(){var e;return c(this,n),(e=t.apply(this,arguments)).documentId=void 0,e.id=(0,m.v4)(),e.existing=void 0,e.options={},e.clientId=(0,m.v4)(),e.path="",e.connected=!0,e.deltaManager=new y.MockDeltaManager,e.loader=void 0,e.logger=p.DebugLogger.create("fluid:MockFluidDataStoreRuntime"),e.quorum=new k,e._local=!1,e._disposed=!1,e}return l(n,[{key:"IFluidHandleContext",get:function(){return this}},{key:"rootRoutingContext",get:function(){return this}},{key:"channelsRoutingContext",get:function(){return this}},{key:"objectsRoutingContext",get:function(){return this}},{key:"IFluidRouter",get:function(){return this}},{key:"absolutePath",get:function(){return"/".concat(this.id)}},{key:"local",get:function(){return this._local},set:function(e){this._local=e}},{key:"disposed",get:function(){return this._disposed}},{key:"dispose",value:function(){this._disposed=!0}},{key:"getChannel",value:function(){var e=i(r().mark((function e(t){return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",null);case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"createChannel",value:function(e,t){return null}},{key:"isAttached",get:function(){return!this.local}},{key:"attachState",get:function(){return this.local?f.AttachState.Detached:f.AttachState.Attached}},{key:"bindChannel",value:function(e){}},{key:"attachGraph",value:function(){}},{key:"bindToContext",value:function(){}},{key:"bind",value:function(e){}},{key:"getQuorum",value:function(){return this.quorum}},{key:"getAudience",value:function(){return null}},{key:"save",value:function(e){}},{key:"close",value:function(){var e=i(r().mark((function e(){return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return");case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"uploadBlob",value:function(){var e=i(r().mark((function e(t){return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",null);case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"getBlob",value:function(){var e=i(r().mark((function e(t){return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",null);case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"submitMessage",value:function(e,t){return null}},{key:"submitSignal",value:function(e,t){return null}},{key:"process",value:function(e,t){}},{key:"processSignal",value:function(e,t){}},{key:"updateMinSequenceNumber",value:function(e){}},{key:"setConnectionState",value:function(e,t){}},{key:"resolveHandle",value:function(){var e=i(r().mark((function e(t){return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.request(t));case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"request",value:function(){var e=i(r().mark((function e(t){return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",null);case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"addedGCOutboundReference",value:function(e,t){}},{key:"summarize",value:function(){var e=i(r().mark((function e(t,n){var i;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(i=(0,g.mergeStats)()).treeNodeCount++,e.abrupt("return",{summary:{type:v.SummaryType.Tree,tree:{}},stats:i});case 3:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"getGCData",value:function(){var e=i(r().mark((function e(){return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",{gcNodes:{}});case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"updateUsedRoutes",value:function(e,t){}},{key:"getAttachSnapshot",value:function(){return[]}},{key:"getAttachSummary",value:function(){var e=(0,g.mergeStats)();return e.treeNodeCount++,{summary:{type:v.SummaryType.Tree,tree:{}},stats:e}}},{key:"setAttachState",value:function(e){}},{key:"waitAttached",value:function(){var e=i(r().mark((function e(){return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return");case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"requestDataStore",value:function(){var e=i(r().mark((function e(t){return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",null);case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"reSubmit",value:function(e,t){}},{key:"applyStashedOp",value:function(){var e=i(r().mark((function e(t){return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return");case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"rollback",value:function(e,t){}}]),n}(d.EventEmitter);t.MockFluidDataStoreRuntime=C;var x=function(){function e(){c(this,e),this.connected=!1}return l(e,[{key:"attach",value:function(e){}},{key:"submit",value:function(e){return(0,h.assert)(!1,"Throw submit error on mock empty delta connection"),0}},{key:"dirty",value:function(){}}]),e}();t.MockEmptyDeltaConnection=x;var E=function(){function e(t){c(this,e),this.contents=t}return l(e,[{key:"readBlob",value:function(){var e=i(r().mark((function e(t){return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,h.stringToBuffer)(this.contents[t],"utf8"));case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"contains",value:function(){var e=i(r().mark((function e(t){return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",void 0!==this.contents[t]);case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"list",value:function(){var e=i(r().mark((function e(t){var n;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=(0,g.getNormalizedObjectStoragePathParts)(t).length,e.abrupt("return",Object.keys(this.contents).filter((function(e){return e.startsWith(t)&&e.split("/").length===n+1})));case 2:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),e}();t.MockObjectStorageService=E;var T=function(){function e(t){c(this,e),this.deltaConnection=new x,this.objectStorage=new E(t)}return l(e,null,[{key:"createFromSummary",value:function(t){for(var n={},r=0,i=Object.entries(t.tree);r<i.length;r++){var o=u(i[r],2),a=o[0],s=o[1];(0,h.assert)(s.type===v.SummaryType.Blob,"Unexpected summary type on mock createFromSummary"),n[a]=s.content}return new e(n)}}]),e}();t.MockSharedObjectServices=T},93408:function(e,t,n){"use strict";var r=n(17061).default,i=n(17156).default,o=n(56690).default,a=n(89728).default;Object.defineProperty(t,"__esModule",{value:!0}),t.MockFluidDataStoreContext=void 0;var s=n(24589),u=n(24659),c=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:(0,u.v4)(),n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:s.DebugLogger.create("fluid:MockFluidDataStoreContext");o(this,e),this.id=t,this.existing=n,this.logger=r,this.documentId=void 0,this.isLocalDataStore=!0,this.packagePath=void 0,this.options=void 0,this.clientId=(0,u.v4)(),this.clientDetails=void 0,this.connected=!0,this.deltaManager=void 0,this.containerRuntime=void 0,this.storage=void 0,this.IFluidDataStoreRegistry=void 0,this.IFluidHandleContext=void 0,this.attachState=void 0,this.scope=void 0}return a(e,[{key:"on",value:function(e,t){switch(e){case"attaching":case"attached":return this;default:throw new Error("Method not implemented.")}}},{key:"once",value:function(e,t){return this}},{key:"off",value:function(e,t){throw new Error("Method not implemented.")}},{key:"getQuorum",value:function(){}},{key:"getAudience",value:function(){}},{key:"submitMessage",value:function(e,t,n){throw new Error("Method not implemented.")}},{key:"submitSignal",value:function(e,t){throw new Error("Method not implemented.")}},{key:"bindToContext",value:function(){throw new Error("Method not implemented.")}},{key:"setChannelDirty",value:function(e){throw new Error("Method not implemented.")}},{key:"getAbsoluteUrl",value:function(){var e=i(r().mark((function e(t){return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new Error("Method not implemented.");case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"getCreateChildSummarizerNodeFn",value:function(e,t){throw new Error("Method not implemented.")}},{key:"uploadBlob",value:function(){var e=i(r().mark((function e(t){return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new Error("Method not implemented.");case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"getInitialGCSummaryDetails",value:function(){var e=i(r().mark((function e(){return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new Error("Method not implemented.");case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"getBaseGCDetails",value:function(){var e=i(r().mark((function e(){return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new Error("Method not implemented.");case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()}]),e}();t.MockFluidDataStoreContext=c},17501:function(e,t,n){"use strict";var r=n(74704).default,i=n(56690).default,o=n(89728).default,a=n(41588).default,s=n(73808).default,u=n(61655).default,c=n(26389).default;Object.defineProperty(t,"__esModule",{value:!0}),t.MockContainerRuntimeFactoryForReconnection=t.MockContainerRuntimeForReconnection=void 0;var l=n(24659),d=n(13114),h=n(87245),f=function(e){u(n,e);var t=c(n);function n(e,r){var o;return i(this,n),(o=t.call(this,e,r)).pendingRemoteMessages=[],o._connected=!0,o}return o(n,[{key:"connected",get:function(){return this._connected},set:function(e){var t=this;if(this._connected!==e){if(this._connected=e,e){var n,i=r(this.pendingRemoteMessages);try{for(i.s();!(n=i.n()).done;){var o=n.value;this.process(o)}}catch(a){i.e(a)}finally{i.f()}this.pendingRemoteMessages.length=0,this.clientSequenceNumber=0,this.clientId=(0,l.v4)(),this.dataStoreRuntime.clientId=this.clientId,this.factory.quorum.addMember(this.clientId,{}),this.reSubmitMessages()}else{this.factory.clearOutstandingClientMessages(this.clientId),this.factory.quorum.removeMember(this.clientId)}this.deltaConnections.forEach((function(e){e.setConnectionState(t.connected)}))}}},{key:"process",value:function(e){this.connected?a(s(n.prototype),"process",this).call(this,e):this.pendingRemoteMessages.push(e)}},{key:"submit",value:function(e,t){return this.connected?a(s(n.prototype),"submit",this).call(this,e,t):(this.addPendingMessage(e,t,-1),-1)}},{key:"reSubmitMessages",value:function(){for(var e=this,t=this.pendingMessages.length,n=function(){var n=e.pendingMessages.shift();(0,d.assert)(void 0!==n,"this is impossible due to the above length check"),e.deltaConnections.forEach((function(e){e.reSubmit(n.content,n.localOpMetadata)})),t--};t>0;)n()}}]),n}(h.MockContainerRuntime);t.MockContainerRuntimeForReconnection=f;var p=function(e){u(n,e);var t=c(n);function n(){return i(this,n),t.apply(this,arguments)}return o(n,[{key:"createContainerRuntime",value:function(e){var t=new f(e,this);return this.runtimes.push(t),t}},{key:"clearOutstandingClientMessages",value:function(e){this.messages=this.messages.filter((function(t){return t.clientId!==e}))}}]),n}(h.MockContainerRuntimeFactory);t.MockContainerRuntimeFactoryForReconnection=p},61660:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.validateAssertionError=void 0;var r=n(49811);t.validateAssertionError=function(e,t){var n,i=null!==(n=r.shortCodeMap[e.message])&&void 0!==n?n:e.message;if(i!==t)throw new Error("Unexpected assertion thrown: ".concat(e.message," ('").concat(i,"')"));return!0}},13114:function(e,t,n){"use strict";function r(e,t){if(!e)throw new Error("number"===typeof t?"0x".concat(t.toString(16).padStart(3,"0")):t)}n.r(t),n.d(t,{BaseTelemetryNullLogger:function(){return B},BatchManager:function(){return _},Deferred:function(){return z},EventForwarder:function(){return Z},Heap:function(){return L},IsoBuffer:function(){return p},Lazy:function(){return te},LazyPromise:function(){return V},NumberComparer:function(){return D},PromiseCache:function(){return H},PromiseTimer:function(){return X},RangeTracker:function(){return W},RateLimiter:function(){return J},TelemetryNullLogger:function(){return q},Timer:function(){return Y},Trace:function(){return $},TypedEventEmitter:function(){return F},Uint8ArrayToArrayBuffer:function(){return re},Uint8ArrayToString:function(){return l},assert:function(){return r},bufferToString:function(){return h},delay:function(){return ne},doIfNotDisposed:function(){return P},extractLogSafeErrorProperties:function(){return j},fromBase64ToUtf8:function(){return E},fromUtf8ToBase64:function(){return T},gitHashFile:function(){return k},hashFile:function(){return w},isArrayBuffer:function(){return f},performance:function(){return x},safelyParseJSON:function(){return Q},stringToBuffer:function(){return d},toUtf8:function(){return I},unreachableCase:function(){return ee}});var i=n(15671),o=n(43144),a=n(60136),s=n(29388),u=n(28664),c=n(2009);function l(e,t){switch(t){case"base64":return c.fromByteArray(e);case"utf8":case"utf-8":case void 0:return(new TextDecoder).decode(e);default:throw new Error("invalid/unsupported encoding")}}var d=function(e,t){return p.from(e,t).buffer},h=function(e,t){return p.from(e).toString(t)};function f(e){var t=e;return e instanceof ArrayBuffer||"object"===typeof t&&null!==t&&"number"===typeof t.byteLength&&"function"===typeof t.slice&&void 0===t.byteOffset&&void 0===t.buffer}var p=function(e){(0,a.Z)(n,e);var t=(0,s.Z)(n);function n(){return(0,i.Z)(this,n),t.apply(this,arguments)}return(0,o.Z)(n,[{key:"toString",value:function(e){return l(this,e)}}],[{key:"from",value:function(e,t,i){if("string"===typeof e)return n.fromString(e,t);if(null!==e&&"object"===typeof e&&f(e.buffer))return r(0===e.byteOffset,0),r(e.byteLength===e.buffer.byteLength,1),n.fromArrayBuffer(e.buffer,t,i);if(f(e))return n.fromArrayBuffer(e,t,i);throw new TypeError}},{key:"fromArrayBuffer",value:function(e,t,r){var i=null!==t&&void 0!==t?t:0,o=null!==r&&void 0!==r?r:e.byteLength-i;if(i<0||i>e.byteLength||o<0||o+i>e.byteLength)throw new RangeError;return new n(e,i,o)}},{key:"fromString",value:function(e,t){switch(t){case"base64":var r=this.sanitizeBase64(e);return new n(c.toByteArray(r).buffer);case"utf8":case"utf-8":case void 0:return new n((new TextEncoder).encode(e).buffer);default:throw new Error("invalid/unsupported encoding")}}},{key:"isBuffer",value:function(e){throw new Error("unimplemented")}},{key:"sanitizeBase64",value:function(e){var t=e;if((t=(t=t.split("=")[0]).replace(/[^\w+-/]/g,"")).length%4!==0){t+=["","===","==","="][t.length%4]}return t}}]),n}((0,u.Z)(Uint8Array)),v=n(74165),g=n(15861);function m(e,t){return y.apply(this,arguments)}function y(){return(y=(0,g.Z)((0,v.Z)().mark((function e(t,n){var r;return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,crypto.subtle.digest(n,t);case 2:return r=e.sent,e.abrupt("return",new Uint8Array(r));case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function b(e,t){switch(t){case"hex":return Array.prototype.map.call(e,(function(e){return e.toString(16).padStart(2,"0")})).join("");case"base64":return c.fromByteArray(e)}}function w(e){return S.apply(this,arguments)}function S(){return S=(0,g.Z)((0,v.Z)().mark((function e(t){var r,i,o,a=arguments;return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=a.length>1&&void 0!==a[1]?a[1]:"SHA-1",i=a.length>2&&void 0!==a[2]?a[2]:"hex",void 0!==crypto.subtle){e.next=4;break}return e.abrupt("return",n.e(564).then(n.bind(n,65644)).then(function(){var e=(0,g.Z)((0,v.Z)().mark((function e(n){return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",n.hashFile(t,r,i));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 4:return e.next=6,m(t,r);case 6:return o=e.sent,e.abrupt("return",b(o,i));case 8:case"end":return e.stop()}}),e)}))),S.apply(this,arguments)}function k(e){return C.apply(this,arguments)}function C(){return(C=(0,g.Z)((0,v.Z)().mark((function e(t){var n,r,i;return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.byteLength,r="blob ".concat(n.toString()).concat(String.fromCharCode(0)),i=p.from(r+t.toString()),e.abrupt("return",w(i));case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var x=window.performance,E=function(e){return p.from(e,"base64").toString("utf-8")},T=function(e){return p.from(e,"utf8").toString("base64")},I=function(e,t){switch(t){case"utf8":case"utf-8":return e;default:return p.from(e,t).toString()}},A=n(29439),R=n(37762),_=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:100;(0,i.Z)(this,e),this.process=t,this.maxBatchSize=n,this.pendingWork=new Map}return(0,o.Z)(e,[{key:"add",value:function(e,t){var n=this;this.pendingWork.has(e)||this.pendingWork.set(e,[]),this.pendingWork.get(e).push(t),this.pendingWork.get(e).length>=this.maxBatchSize?(void 0!==this.pendingTimer&&clearTimeout(this.pendingTimer),this.pendingTimer=void 0,this.startWork()):void 0===this.pendingTimer&&(this.pendingTimer=setTimeout((function(){n.pendingTimer=void 0,n.startWork()}),0))}},{key:"drain",value:function(){this.startWork()}},{key:"startWork",value:function(){var e=this.pendingWork;this.pendingWork=new Map;var t,n=(0,R.Z)(e);try{for(n.s();!(t=n.n()).done;){var r=(0,A.Z)(t.value,2),i=r[0],o=r[1];this.process(i,o)}}catch(a){n.e(a)}finally{n.f()}}}]),e}();function P(e,t){return function(){if(e.disposed)throw new Error("Already disposed");return t.apply(void 0,arguments)}}var N=n(97326),O=n(11752),M=n(61120),F=function(e){(0,a.Z)(n,e);var t=(0,s.Z)(n);function n(){var e,r,o,a,s,u,c,l;return(0,i.Z)(this,n),(l=t.call(this)).addListener=(0,O.Z)((e=(0,N.Z)(l),(0,M.Z)(n.prototype)),"addListener",e).bind((0,N.Z)(l)),l.on=(0,O.Z)((r=(0,N.Z)(l),(0,M.Z)(n.prototype)),"on",r).bind((0,N.Z)(l)),l.once=(0,O.Z)((o=(0,N.Z)(l),(0,M.Z)(n.prototype)),"once",o).bind((0,N.Z)(l)),l.prependListener=(0,O.Z)((a=(0,N.Z)(l),(0,M.Z)(n.prototype)),"prependListener",a).bind((0,N.Z)(l)),l.prependOnceListener=(0,O.Z)((s=(0,N.Z)(l),(0,M.Z)(n.prototype)),"prependOnceListener",s).bind((0,N.Z)(l)),l.removeListener=(0,O.Z)((u=(0,N.Z)(l),(0,M.Z)(n.prototype)),"removeListener",u).bind((0,N.Z)(l)),l.off=(0,O.Z)((c=(0,N.Z)(l),(0,M.Z)(n.prototype)),"off",c).bind((0,N.Z)(l)),l}return(0,o.Z)(n)}(n(47465).EventEmitter),Z=function(e){(0,a.Z)(n,e);var t=(0,s.Z)(n);function n(e){var r;if((0,i.Z)(this,n),(r=t.call(this)).isDisposed=!1,r.forwardingEvents=new Map,void 0!==e){r.on(n.removeListenerEvent,(function(t){return r.unforwardEvent(e,t)})),r.on(n.newListenerEvent,(function(t){return r.forwardEvent(e,t)}))}return r}return(0,o.Z)(n,[{key:"disposed",get:function(){return this.isDisposed}},{key:"dispose",value:function(){this.isDisposed=!0;var e,t=(0,R.Z)(this.forwardingEvents.values());try{for(t.s();!(e=t.n()).done;){var n,r=e.value,i=(0,R.Z)(r.values());try{for(i.s();!(n=i.n()).done;){var o=n.value;try{o()}catch(a){}}}catch(s){i.e(s)}finally{i.f()}}}catch(s){t.e(s)}finally{t.f()}this.removeAllListeners(),this.forwardingEvents.clear()}},{key:"forwardEvent",value:function(e){for(var t=this,r=arguments.length,i=new Array(r>1?r-1:0),o=1;o<r;o++)i[o-1]=arguments[o];for(var a=function(){var r=u[s];if(void 0!==e&&void 0!==r&&!n.isEmitterEvent(r)){var i=t.forwardingEvents.get(r);if(void 0===i&&(i=new Map,t.forwardingEvents.set(r,i)),!i.has(e)){var o=function(){for(var e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];return t.emit.apply(t,[r].concat(n))};i.set(e,(function(){return e.off(r,o)})),e.on(r,o)}}},s=0,u=i;s<u.length;s++)a()}},{key:"unforwardEvent",value:function(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),i=1;i<t;i++)r[i-1]=arguments[i];for(var o=0,a=r;o<a.length;o++){var s=a[o];if(void 0!==s&&!n.isEmitterEvent(s)){var u=this.forwardingEvents.get(s);if((null===u||void 0===u?void 0:u.has(e))&&0===this.listenerCount(s)){var c=u.get(e);void 0!==c&&c(),u.delete(e),0===u.size&&this.forwardingEvents.delete(s)}}}}}],[{key:"isEmitterEvent",value:function(e){return e===n.newListenerEvent||e===n.removeListenerEvent}}]),n}(F);Z.newListenerEvent="newListener",Z.removeListenerEvent="removeListener";var D={compare:function(e,t){return e-t},min:Number.MIN_VALUE},L=function(){function e(t){(0,i.Z)(this,e),this.comp=t,this.L=[{value:t.min,position:0}]}return(0,o.Z)(e,[{key:"peek",value:function(){return this.L[1]}},{key:"get",value:function(){this.swap(1,this.count());var e=this.L.pop();return this.fixdown(1),e.value}},{key:"add",value:function(e){var t={value:e,position:this.L.length};return this.L.push(t),this.fixup(this.count()),t}},{key:"update",value:function(e){var t=e.position;this.isGreaterThanParent(t)?this.fixup(t):this.fixdown(t)}},{key:"remove",value:function(e){var t=e.position;this.swap(e.position,this.L.length-1),this.L.splice(this.L.length-1),t!==this.L.length&&this.update(this.L[t])}},{key:"count",value:function(){return this.L.length-1}},{key:"fixup",value:function(e){for(var t=e;this.isGreaterThanParent(t);){var n=t>>1;this.swap(t,n),t=n}}},{key:"isGreaterThanParent",value:function(e){return e>1&&this.comp.compare(this.L[e>>1].value,this.L[e].value)>0}},{key:"fixdown",value:function(e){for(var t=e;t<<1<=this.count();){var n=t<<1;if(n<this.count()&&this.comp.compare(this.L[n].value,this.L[n+1].value)>0&&n++,this.comp.compare(this.L[t].value,this.L[n].value)<=0)break;this.swap(t,n),t=n}}},{key:"swap",value:function(e,t){var n=this.L[e];this.L[e]=this.L[t],this.L[e].position=e,this.L[t]=n,this.L[t].position=t}}]),e}(),B=function(){function e(){(0,i.Z)(this,e)}return(0,o.Z)(e,[{key:"send",value:function(e){}}]),e}(),q=function(){function e(){(0,i.Z)(this,e)}return(0,o.Z)(e,[{key:"send",value:function(e){}},{key:"sendTelemetryEvent",value:function(e,t){}},{key:"sendErrorEvent",value:function(e,t){}},{key:"sendPerformanceEvent",value:function(e,t){}}]),e}();function j(e){var t,n={message:"string"===typeof(null===e||void 0===e?void 0:e.message)?e.message:String(e)};if(null!==(t=e)&&!Array.isArray(t)&&"object"===typeof t){var r=e.errorType,i=e.stack,o=e.name;if("string"===typeof r&&(n.errorType=r),"string"===typeof i){var a="string"===typeof o?o:void 0;n.stack=function(e,t){var n=e.split("\n");return n.shift(),void 0!==t&&n.unshift(t),n.join("\n")}(i,a)}}return n}var U=function(){function e(t,n){(0,i.Z)(this,e),this.expiry=t,this.cleanup=n,this.gcTimeouts=new Map}return(0,o.Z)(e,[{key:"schedule",value:function(e){var t=this;"indefinite"!==this.expiry.policy&&this.gcTimeouts.set(e,setTimeout((function(){t.cleanup(e),t.cancel(e)}),this.expiry.durationMs))}},{key:"cancel",value:function(e){var t=this.gcTimeouts.get(e);void 0!==t&&(clearTimeout(t),this.gcTimeouts.delete(e))}},{key:"update",value:function(e){"sliding"===this.expiry.policy&&(this.cancel(e),this.schedule(e))}}]),e}(),H=function(){function e(){var t=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=n.expiry,o=void 0===r?{policy:"indefinite"}:r,a=n.removeOnError,s=void 0===a?function(){return!0}:a;(0,i.Z)(this,e),this.cache=new Map,this.removeOnError=s,this.gc=new U(o,(function(e){return t.remove(e)}))}return(0,o.Z)(e,[{key:"has",value:function(e){return this.cache.has(e)}},{key:"get",value:function(e){return this.has(e)&&this.gc.update(e),this.cache.get(e)}},{key:"remove",value:function(e){return this.gc.cancel(e),this.cache.delete(e)}},{key:"addOrGet",value:function(){var e=(0,g.Z)((0,v.Z)().mark((function e(t,n){var r,i,o=this;return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return void 0===(r=this.get(t))&&(i=function(){var e=(0,g.Z)((0,v.Z)().mark((function e(){return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",n());case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),r=i(),this.cache.set(t,r),r.catch((function(e){o.removeOnError(e)&&o.remove(t)})),this.gc.schedule(t)),e.abrupt("return",r);case 3:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"add",value:function(e,t){var n=this.has(e);return this.addOrGet(e,t).catch((function(){})),!n}},{key:"addValueOrGet",value:function(){var e=(0,g.Z)((0,v.Z)().mark((function e(t,n){return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.addOrGet(t,(0,g.Z)((0,v.Z)().mark((function e(){return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",n);case 1:case"end":return e.stop()}}),e)})))));case 1:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"addValue",value:function(e,t){return this.add(e,(0,g.Z)((0,v.Z)().mark((function e(){return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",t);case 1:case"end":return e.stop()}}),e)}))))}}]),e}(),z=function(){function e(){var t=this;(0,i.Z)(this,e),this.completed=!1,this.p=new Promise((function(e,n){t.res=e,t.rej=n}))}return(0,o.Z)(e,[{key:"isCompleted",get:function(){return this.completed}},{key:"promise",get:function(){return this.p}},{key:"resolve",value:function(e){void 0!==this.res&&(this.completed=!0,this.res(e))}},{key:"reject",value:function(e){void 0!==this.rej&&(this.completed=!0,this.rej(e))}}]),e}(),V=function(e){function t(e){(0,i.Z)(this,t),this.execute=e}return(0,o.Z)(t,[{key:e,get:function(){return this.getPromise()[Symbol.toStringTag]}},{key:"then",value:function(){var e=(0,g.Z)((0,v.Z)().mark((function e(t,n){var r,i=arguments;return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(r=this.getPromise()).then.apply(r,i));case 1:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"catch",value:function(){var e=(0,g.Z)((0,v.Z)().mark((function e(t){var n,r=arguments;return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(n=this.getPromise()).catch.apply(n,r));case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"finally",value:function(){var e=(0,g.Z)((0,v.Z)().mark((function e(t){var n,r=arguments;return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(n=this.getPromise()).finally.apply(n,r));case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getPromise",value:function(){var e=(0,g.Z)((0,v.Z)().mark((function e(){return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return void 0===this.result&&(this.result=this.execute()),e.abrupt("return",this.result);case 2:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),t}(Symbol.toStringTag),G=n(58121),K=n.n(G),W=function(){function e(t,n){(0,i.Z)(this,e),"number"===typeof t?(this.ranges=[{length:0,primary:t,secondary:n}],this.lastPrimary=t,this.lastSecondary=n):(this.ranges=K()(t.ranges),this.lastPrimary=t.lastPrimary,this.lastSecondary=t.lastSecondary)}return(0,o.Z)(e,[{key:"base",get:function(){return this.ranges[0].primary}},{key:"primaryHead",get:function(){return this.lastPrimary}},{key:"secondaryHead",get:function(){return this.lastSecondary}},{key:"serialize",value:function(){return{lastPrimary:this.lastPrimary,lastSecondary:this.lastSecondary,ranges:K()(this.ranges)}}},{key:"add",value:function(e,t){r(e>=this.lastPrimary,3),void 0!==this.lastSecondary&&r(t>=this.lastSecondary,4),this.lastPrimary=e,this.lastSecondary=t;var n=this.ranges[this.ranges.length-1],i=n.primary+n.length,o=n.secondary+n.length;t!==o&&(e===i?0===n.length?n.secondary=t:(n.length--,this.ranges.push({length:0,primary:e,secondary:t})):i+1===e&&o+1===t?n.length++:this.ranges.push({length:0,primary:e,secondary:t}))}},{key:"get",value:function(e){r(e>=this.ranges[0].primary,5);for(var t=1;t<this.ranges.length&&!(e<this.ranges[t].primary);t++);r(e>=this.ranges[t-1].primary,6);var n=this.ranges[t-1];return Math.min(e-n.primary,n.length)+n.secondary}},{key:"updateBase",value:function(e){r(e>=this.ranges[0].primary,7);for(var t=1;t<this.ranges.length&&!(e<this.ranges[t].primary);t++);r(e>=this.ranges[t-1].primary,8);var n=this.ranges[t-1],i=e-n.primary;n.secondary=n.secondary+Math.min(i,n.length),n.length=Math.max(n.length-i,0),n.primary=e,this.ranges=t-1>0?this.ranges.slice(t-1):this.ranges,r(e===this.ranges[0].primary,9)}}]),e}(),J=function(){function e(t){(0,i.Z)(this,e),this.windowMSec=t,this.requestMap=new Map}return(0,o.Z)(e,[{key:"filter",value:function(e,t){var n,r=[],i=Date.now(),o=(0,R.Z)(t);try{for(o.s();!(n=o.n()).done;){var a=n.value,s="".concat(e,"/").concat(a);if(this.requestMap.has(s)){if(this.requestMap.get(s)+this.windowMSec>i)continue;this.requestMap.set(s,i),r.push(a)}else this.requestMap.set(s,i),r.push(a)}}catch(u){o.e(u)}finally{o.f()}return r}}]),e}();function Q(e){var t;try{t=JSON.parse(e)}catch(n){}return t}var Y=function(){function e(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(){return Date.now()};(0,i.Z)(this,e),this.defaultTimeout=t,this.defaultHandler=n,this.getCurrentTick=r}return(0,o.Z)(e,[{key:"hasTimer",get:function(){return!!this.runningState}},{key:"start",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.defaultTimeout,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.defaultHandler;this.startCore(e,t,e)}},{key:"clear",value:function(){this.runningState&&(clearTimeout(this.runningState.timeout),this.runningState=void 0)}},{key:"restart",value:function(e,t){var n,r;if(this.runningState){var i=null!==e&&void 0!==e?e:this.runningState.intendedDuration,o=null!==(r=null!==t&&void 0!==t?t:null===(n=this.runningState.restart)||void 0===n?void 0:n.handler)&&void 0!==r?r:this.runningState.handler,a=this.calculateRemainingTime(this.runningState);i<a?this.start(i,o):i===a?(this.runningState.handler=o,this.runningState.restart=void 0,this.runningState.intendedDuration=i):this.runningState.restart={startTick:this.getCurrentTick(),duration:i,handler:o}}else this.start(e,t)}},{key:"startCore",value:function(e,t,n){var r=this;this.clear(),this.runningState={startTick:this.getCurrentTick(),duration:e,intendedDuration:n,handler:t,timeout:setTimeout((function(){return r.handler()}),e)}}},{key:"handler",value:function(){r(!!this.runningState,10);var e=this.runningState.restart;if(void 0!==e){var t=this.calculateRemainingTime(e);this.startCore(t,(function(){return e.handler()}),e.duration)}else{var n=this.runningState.handler;this.clear(),n()}}},{key:"calculateRemainingTime",value:function(e){var t=this.getCurrentTick()-e.startTick;return e.duration-t}}]),e}(),X=function(){function e(t,n){var r=this;(0,i.Z)(this,e),this.timer=new Y(t,(function(){return r.wrapHandler(n)}))}return(0,o.Z)(e,[{key:"hasTimer",get:function(){return this.timer.hasTimer}},{key:"start",value:function(){var e=(0,g.Z)((0,v.Z)().mark((function e(t,n){var r=this;return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.clear(),this.deferred=new z,this.timer.start(t,n?function(){return r.wrapHandler(n)}:void 0),e.abrupt("return",this.deferred.promise);case 4:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"clear",value:function(){this.timer.clear(),this.deferred&&(this.deferred.resolve({timerResult:"cancel"}),this.deferred=void 0)}},{key:"wrapHandler",value:function(e){e(),r(!!this.deferred,11),this.deferred.resolve({timerResult:"timeout"}),this.deferred=void 0}}]),e}(),$=function(){function e(t){(0,i.Z)(this,e),this.startTick=t,this.lastTick=t}return(0,o.Z)(e,[{key:"trace",value:function(){var e=x.now(),t={totalTimeElapsed:e-this.startTick,duration:e-this.lastTick,tick:e};return this.lastTick=e,t}}],[{key:"start",value:function(){return new e(x.now())}}]),e}();function ee(e){throw new Error(arguments.length>1&&void 0!==arguments[1]?arguments[1]:"Unreachable Case")}var te=function(){function e(t){(0,i.Z)(this,e),this.valueGenerator=t,this._evaluated=!1}return(0,o.Z)(e,[{key:"evaluated",get:function(){return this._evaluated}},{key:"value",get:function(){return this._evaluated||(this._evaluated=!0,this._value=this.valueGenerator()),this._value}}]),e}(),ne=function(){var e=(0,g.Z)((0,v.Z)().mark((function e(t){return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e){return setTimeout((function(){return e()}),t)})));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();function re(e){return 0===e.byteOffset&&e.byteLength===e.buffer.byteLength?e.buffer:e.buffer.slice(e.byteOffset,e.byteOffset+e.byteLength)}},21885:function(e,t,n){"use strict";var r,i,o,a,s,u;n.r(t),n.d(t,{FileMode:function(){return o},MessageType:function(){return r},NackErrorType:function(){return i},ScopeType:function(){return u},SummaryType:function(){return s},TreeEntry:function(){return a}}),function(e){e.NoOp="noop",e.ClientJoin="join",e.ClientLeave="leave",e.Propose="propose",e.Reject="reject",e.Summarize="summarize",e.SummaryAck="summaryAck",e.SummaryNack="summaryNack",e.Operation="op",e.RemoteHelp="remoteHelp",e.NoClient="noClient",e.RoundTrip="tripComplete",e.Control="control"}(r||(r={})),function(e){e.ThrottlingError="ThrottlingError",e.InvalidScopeError="InvalidScopeError",e.BadRequestError="BadRequestError",e.LimitExceededError="LimitExceededError"}(i||(i={})),function(e){e.File="100644",e.Executable="100755",e.Directory="040000",e.Symlink="120000"}(o||(o={})),function(e){e.Blob="Blob",e.Tree="Tree",e.Attachment="Attachment"}(a||(a={})),function(e){e.Tree=1,e.Blob=2,e.Handle=3,e.Attachment=4}(s||(s={})),function(e){e.DocRead="doc:read",e.DocWrite="doc:write",e.SummaryWrite="summary:write"}(u||(u={}))},19299:function(e,t,n){"use strict";var r=n(861).default,i=n(17061).default,o=n(56690).default,a=n(89728).default,s=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{u(r.next(e))}catch(t){o(t)}}function s(e){try{u(r.throw(e))}catch(t){o(t)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}u((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.AzureLiveShareHost=void 0;var u=n(44402),c=n(99299),l=function(){function e(t){o(this,e),this._shouldWarnLocalTimestamp=t,this._azureAudienceDeferred=new c.Deferred,this.hasWarned=!1}return a(e,[{key:"setAudience",value:function(e){this._azureAudienceDeferred.resolve(e)}},{key:"registerClientId",value:function(e){var t;return s(this,void 0,void 0,i().mark((function n(){var r;return i().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,this.getClientInfo(e);case 2:return r=n.sent,n.abrupt("return",null!==(t=null===r||void 0===r?void 0:r.roles)&&void 0!==t?t:[]);case 4:case"end":return n.stop()}}),n,this)})))}},{key:"getClientInfo",value:function(e){return s(this,void 0,void 0,i().mark((function t(){var n;return i().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.getAudienceMemberInfo(e);case 2:if(n=t.sent){t.next=5;break}throw new Error("AzureLiveShareHost.getClientInfo: audience member not found");case 5:return t.abrupt("return",{userId:n.userId,roles:this.getRolesForAudienceMember(n),displayName:n.userName});case 6:case"end":return t.stop()}}),t,this)})))}},{key:"getNtpTime",value:function(){return s(this,void 0,void 0,i().mark((function e(){var t;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return!this.hasWarned&&this._shouldWarnLocalTimestamp&&(console.warn("AzureLiveShareHost is using a local timestamp, which could cause issues when use some LiveDataObject data structures across multiple clients.\n\n                To disable this warning, set _shouldWarn in AzureLiveShareHost.create() to false.\n\n                To resolve synchronization issues you may encounter, you should implement a service API to get this timestamp value and override this function."),this.hasWarned=!0),t=new Date,e.abrupt("return",Promise.resolve({ntpTime:t.toUTCString(),ntpTimeInUTC:t.getTime()}));case 3:case"end":return e.stop()}}),e,this)})))}},{key:"getClientRoles",value:function(e){return s(this,void 0,void 0,i().mark((function t(){var n;return i().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.getClientInfo(e);case 2:return n=t.sent,t.abrupt("return",null===n||void 0===n?void 0:n.roles);case 4:case"end":return t.stop()}}),t,this)})))}},{key:"getFluidTenantInfo",value:function(){return s(this,void 0,void 0,i().mark((function e(){return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new Error("AzureLiveShareHost.getFluidTenantInfo: not implemented exception");case 1:case"end":return e.stop()}}),e)})))}},{key:"getFluidToken",value:function(e){return s(this,void 0,void 0,i().mark((function e(){return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new Error("AzureLiveShareHost.getFluidToken: not implemented exception");case 1:case"end":return e.stop()}}),e)})))}},{key:"getFluidContainerId",value:function(){return s(this,void 0,void 0,i().mark((function e(){return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new Error("AzureLiveShareHost.getFluidContainerId: not implemented exception");case 1:case"end":return e.stop()}}),e)})))}},{key:"setFluidContainerId",value:function(e){return s(this,void 0,void 0,i().mark((function e(){return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new Error("AzureLiveShareHost.setFluidContainerId: not implemented exception");case 1:case"end":return e.stop()}}),e)})))}},{key:"getAudienceMemberInfo",value:function(e){return s(this,void 0,void 0,i().mark((function t(){var n,o,a,s;return i().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this._azureAudienceDeferred.promise;case 2:n=t.sent.getMembers(),o=r(n.values()),a=0;case 5:if(!(a<o.length)){t.next=12;break}if(!(s=o[a]).connections.find((function(t){return t.id===e}))){t.next=9;break}return t.abrupt("return",s);case 9:a++,t.next=5;break;case 12:return t.abrupt("return",void 0);case 13:case"end":return t.stop()}}),t,this)})))}},{key:"getRolesForAudienceMember",value:function(e){return 0===e.connections.length?[]:"write"===e.connections[e.connections.length-1].mode?[u.UserMeetingRole.presenter]:[u.UserMeetingRole.attendee]}}],[{key:"create",value:function(){return new e(!(arguments.length>0&&void 0!==arguments[0])||arguments[0])}}]),e}();t.AzureLiveShareHost=l},6515:function(e,t,n){"use strict";var r=n(56690).default,i=n(89728).default;Object.defineProperty(t,"__esModule",{value:!0}),t.DynamicObjectRegistry=void 0;var o=n(33226),a="@microsoft/live-share:DYNAMIC-LOADABLE-OBJECTS",s=function(){function e(){r(this,e)}return i(e,null,[{key:"dynamicLoadableObjects",get:function(){return"undefined"===typeof window?this._dynamicLoadableObjects:window[a]||this._dynamicLoadableObjects}},{key:"registerObjectClass",value:function(e,t){var n=this.dynamicLoadableObjects;n.has(t)||(n.set(t,e),"undefined"!==typeof window&&(window[a]=n))}}]),e}();s._dynamicLoadableObjects=new Map,t.DynamicObjectRegistry=s,s.registerObjectClass(o.SharedMap,o.SharedMap.getFactory().type),s.registerObjectClass(o.SharedString,o.SharedString.getFactory().type),s.registerObjectClass(o.SharedDirectory,o.SharedDirectory.getFactory().type)},75527:function(e,t,n){"use strict";var r=n(56690).default,i=n(89728).default,o=n(61655).default,a=n(26389).default;Object.defineProperty(t,"__esModule",{value:!0}),t.HostTimestampProvider=void 0;var s=function(e){o(n,e);var t=a(n);function n(e){var i;return r(this,n),(i=t.call(this))._host=e,i}return i(n,[{key:"getNtpTime",value:function(){return this._host.getNtpTime()}}]),n}(n(11402).TimestampProvider);t.HostTimestampProvider=s},90030:function(e,t,n){"use strict";var r=n(17061).default,i=n(56690).default,o=n(89728).default,a=n(61655).default,s=n(26389).default,u=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{u(r.next(e))}catch(t){o(t)}}function s(e){try{u(r.throw(e))}catch(t){o(t)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}u((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.LiveDataObject=void 0;var c=n(72117),l=n(85681),d=n(99299),h=function(e){a(n,e);var t=s(n);function n(e){var r;return i(this,n),(r=t.call(this,e))._allowedRoles=[],r._liveRuntime=null,r}return o(n,[{key:"liveRuntime",get:function(){return(0,l.assert)(null!==this._liveRuntime,"LiveShareRuntime not initialized. Ensure your Fluid `ContainerSchema` was first wrapped inside of `getLiveShareSchema`, or use `.joinContainer()` in `LiveShareClient`."),this._liveRuntime}},{key:"waitUntilConnected",value:function(){return(0,d.waitUntilConnected)(this.runtime)}},{key:"verifyLocalUserRoles",value:function(){var e;return u(this,void 0,void 0,r().mark((function t(){var n;return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.waitUntilConnected();case 2:return n=t.sent,t.abrupt("return",this.liveRuntime.verifyRolesAllowed(n,null!==(e=this._allowedRoles)&&void 0!==e?e:[]));case 4:case"end":return t.stop()}}),t,this)})))}},{key:"__dangerouslySetLiveRuntime",value:function(e){this._liveRuntime=e}},{key:"onLocalUserAllowed",value:function(e){return u(this,void 0,void 0,r().mark((function t(){return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.verifyLocalUserRoles();case 2:if(t.sent){t.next=5;break}return t.abrupt("return");case 5:e();case 6:case"end":return t.stop()}}),t,this)})))}}]),n}(c.DataObject);h.LiveEnabled=!0,t.LiveDataObject=h},24133:function(e,t,n){"use strict";var r=n(17061).default,i=n(56690).default,o=n(89728).default,a=n(61655).default,s=n(26389).default,u=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{u(r.next(e))}catch(t){o(t)}}function s(e){try{u(r.throw(e))}catch(t){o(t)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}u((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.LiveEvent=t.LiveEventEvents=void 0;var c,l=n(72117),d=n(25593),h=n(16078),f=n(6515),p=n(90030),v=n(99299);!function(e){e.received="received"}(c=t.LiveEventEvents||(t.LiveEventEvents={}));var g=function(e){a(n,e);var t=s(n);function n(){return i(this,n),t.apply(this,arguments)}return o(n,[{key:"isInitialized",get:function(){return!!this._eventTarget}},{key:"initialize",value:function(e){var t=this;if(this._eventTarget)throw new Error("LiveEvent already started.");this._allowedRoles=null!==e&&void 0!==e?e:[];var n=new d.LiveEventScope(this.runtime,this.liveRuntime,e);return this._eventTarget=new h.LiveEventTarget(n,"event",(function(e,n){t.emit(c.received,(0,v.cloneValue)(e.data),n,e.clientId,e.timestamp)})),Promise.resolve()}},{key:"send",value:function(e){return u(this,void 0,void 0,r().mark((function t(){return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this._eventTarget){t.next=2;break}throw new Error("LiveEvent not started.");case 2:return t.next=4,this._eventTarget.sendEvent(e);case 4:return t.abrupt("return",t.sent);case 5:case"end":return t.stop()}}),t,this)})))}}],[{key:"isNewer",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;if(e)if(e.timestamp==t.timestamp){if((e.clientId||"").localeCompare(t.clientId||"")<=0)return!1}else if(e.timestamp>t.timestamp){if(e.timestamp-t.timestamp>n)return!1}else{if(t.timestamp-e.timestamp<n)return!1}return!0}}]),n}(p.LiveDataObject);g.TypeName="@microsoft/live-share:LiveEvent",g.factory=new l.DataObjectFactory(g.TypeName,g,[],{}),t.LiveEvent=g,f.DynamicObjectRegistry.registerObjectClass(g,g.TypeName)},25593:function(e,t,n){"use strict";var r=n(17061).default,i=n(56690).default,o=n(89728).default,a=n(61655).default,s=n(26389).default,u=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{u(r.next(e))}catch(t){o(t)}}function s(e){try{u(r.throw(e))}catch(t){o(t)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}u((r=r.apply(e,t||[])).next())}))},c=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.LiveEventScope=void 0;var l=c(n(47465)),d=n(85681),h=n(99299),f=function(e){a(n,e);var t=s(n);function n(e,r,o){var a;return i(this,n),(a=t.call(this))._liveRuntime=r,a.emitter=new l.default,a._runtime=e,a._allowedRoles=o||[],a.emitter.on("error",(function(e){a.emit("error",e)})),a._runtime.on("signal",(function(e,t){if(e.clientId&&a._runtime.connected){var n=e.clientId;e.content.clientId=n,a._liveRuntime.verifyRolesAllowed(n,a._allowedRoles).then((function(r){r?a.emitter.emit(e.type,e.content,t):a._runtime.logger.sendErrorEvent({eventName:"LiveEvent:invalidRole"},new Error('The clientId of "'.concat(n,"\" doesn't have a role of ").concat(JSON.stringify(a._allowedRoles),".")))})).catch((function(e){a._runtime.logger.sendErrorEvent({eventName:"LiveEvent:invalidRole"},e)}))}})),a}return o(n,[{key:"allowedRoles",get:function(){return this._allowedRoles},set:function(e){this._allowedRoles=e}},{key:"clientId",get:function(){return this._runtime.clientId}},{key:"onEvent",value:function(e,t){return this.emitter.on(e,t),this}},{key:"offEvent",value:function(e,t){return this.emitter.off(e,t),this}},{key:"sendEvent",value:function(e,t){return u(this,void 0,void 0,r().mark((function n(){var i,o;return r().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,this.waitUntilConnected();case 2:return i=n.sent,n.next=5,this._liveRuntime.verifyRolesAllowed(i,this._allowedRoles);case 5:if(n.sent){n.next=8;break}throw new Error("The local user doesn't have a role of ".concat(JSON.stringify(this._allowedRoles),"."));case 8:return o={clientId:i,name:e,timestamp:this._liveRuntime.getTimestamp(),data:t},this._runtime.submitSignal(e,o),n.abrupt("return",o);case 11:case"end":return n.stop()}}),n,this)})))}},{key:"waitUntilConnected",value:function(){return(0,h.waitUntilConnected)(this._runtime)}}]),n}(d.TypedEventEmitter);t.LiveEventScope=f},24034:function(e,t,n){"use strict";var r=n(17061).default,i=n(56690).default,o=n(89728).default,a=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{u(r.next(e))}catch(t){o(t)}}function s(e){try{u(r.throw(e))}catch(t){o(t)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}u((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.LiveEventSource=void 0;var s=function(){function e(t,n){i(this,e),this._scope=t,this._eventName=n}return o(e,[{key:"sendEvent",value:function(e){return a(this,void 0,void 0,r().mark((function t(){return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this._scope.sendEvent(this._eventName,e);case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),t,this)})))}}]),e}();t.LiveEventSource=s},16078:function(e,t,n){"use strict";var r=n(89728).default,i=n(56690).default,o=n(61655).default,a=n(26389).default;Object.defineProperty(t,"__esModule",{value:!0}),t.LiveEventTarget=void 0;var s=function(e){o(n,e);var t=a(n);function n(e,r,o){var a;return i(this,n),a=t.call(this,e,r),e.onEvent(r,o),a}return r(n)}(n(24034).LiveEventSource);t.LiveEventTarget=s},51788:function(e,t,n){"use strict";var r=n(56690).default,i=n(89728).default;Object.defineProperty(t,"__esModule",{value:!0}),t.LiveEventTimer=void 0;var o=n(32420),a=function(){function e(t,n,i){var a=arguments.length>3&&void 0!==arguments[3]&&arguments[3];r(this,e),this._isRunning=!1,this._eventSource=t,this._createEvent=n,this._delay=new o.TimeInterval(i),this.repeat=a}return i(e,[{key:"delay",get:function(){return this._delay.milliseconds},set:function(e){this._delay.milliseconds=e}},{key:"isRunning",get:function(){return this._isRunning}},{key:"sendEvent",value:function(){var e=this._createEvent();return this._eventSource.sendEvent(e)}},{key:"start",value:function(){this.stop(),this._isRunning=!0,this.delayedEmit(this.delay)}},{key:"stop",value:function(){void 0!=this._timer&&(clearTimeout(this._timer),this._timer=void 0),this._isRunning=!1}},{key:"delayedEmit",value:function(e){var t=this;this._timer=setTimeout((function(){t._timer=void 0;var e=(new Date).getTime();if(t.sendEvent().catch((function(e){console.warn(e)})),t._isRunning&&t.repeat){var n=((new Date).getTime()-e)%t.delay;t.delayedEmit(t.delay-n)}}),e)}}]),e}();t.LiveEventTimer=a},72508:function(e,t,n){"use strict";var r=n(56690).default,i=n(89728).default;Object.defineProperty(t,"__esModule",{value:!0}),t.LiveObjectSynchronizer=void 0;var o=function(){function e(t,n,i){r(this,e),this.id=t,this.runtime=n,this.liveRuntime=i,this._isDisposed=!1}return i(e,[{key:"start",value:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return this.liveRuntime.objectManager.registerObject(this.id,this.runtime,e,{updateState:t,getLocalUserCanSend:n,shouldUpdateTimestampPeriodically:r})}},{key:"dispose",value:function(){this._isDisposed||(this._isDisposed=!0,this.liveRuntime.objectManager.unregisterObject(this.id))}},{key:"getLatestEvent",value:function(){return this.liveRuntime.objectManager.getLatestEventForObject(this.id)}},{key:"getLatestEventForClient",value:function(e){return this.liveRuntime.objectManager.getLatestEventForObjectClient(this.id,e)}},{key:"getEvents",value:function(){return this.liveRuntime.objectManager.getEventsForObject(this.id)}},{key:"sendEvent",value:function(e){return this.liveRuntime.objectManager.sendEventForObject(this.id,e)}}]),e}();t.LiveObjectSynchronizer=o},19167:function(e,t,n){"use strict";var r=n(17061).default,i=n(56690).default,o=n(89728).default,a=n(41588).default,s=n(73808).default,u=n(61655).default,c=n(26389).default,l=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{u(r.next(e))}catch(t){o(t)}}function s(e){try{u(r.throw(e))}catch(t){o(t)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}u((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.LivePresence=t.LivePresenceEvents=void 0;var d,h=n(72117),f=n(60605),p=n(72508),v=n(25037),g=n(99299),m=n(32420),y=n(6515),b=n(44402),w=n(90030);!function(e){e.presenceChanged="presenceChanged"}(d=t.LivePresenceEvents||(t.LivePresenceEvents={}));var S=function(e){u(n,e);var t=c(n);function n(){var e;return i(this,n),(e=t.apply(this,arguments))._expirationPeriod=new m.TimeInterval(2e4),e._users=[],e._lastEmitPresenceStateMap=new Map,e}return o(n,[{key:"isInitialized",get:function(){return!!this._synchronizer}},{key:"expirationPeriod",get:function(){return this._expirationPeriod.seconds},set:function(e){var t=this;this._expirationPeriod.seconds=e>.1?e:.1,this.getUsers().forEach((function(e){e.expirationPeriod=t._expirationPeriod}))}},{key:"localUser",get:function(){var e,t=null===(e=this._currentPresence)||void 0===e?void 0:e.clientId;if(t)return this.getUserForClient(t)}},{key:"initialize",value:function(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:f.PresenceState.online,i=arguments.length>2?arguments[2]:void 0;return l(this,void 0,void 0,r().mark((function o(){var a=this;return r().wrap((function(o){for(;;)switch(o.prev=o.next){case 0:if(!this._synchronizer){o.next=2;break}throw new Error("LivePresence: already started.");case 2:return this._logger=new v.LiveTelemetryLogger(this.runtime,this.liveRuntime),this._allowedRoles=i||[],o.next=6,this.waitUntilConnected();case 6:return o.t0=o.sent,o.t1={state:n,data:e},this._currentPresence={clientId:o.t0,name:"UpdatePresence",timestamp:0,data:o.t1},this._synchronizer=new p.LiveObjectSynchronizer(this.id,this.runtime,this.liveRuntime),o.next=12,this._synchronizer.start(this._currentPresence.data,(function(e,t,n){return l(a,void 0,void 0,r().mark((function t(){return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.updateMembersList(e,n);case 2:return t.abrupt("return",!1);case 3:case"end":return t.stop()}}),t,this)})))}),(function(e){return l(a,void 0,void 0,r().mark((function t(){return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!e){t.next=2;break}return t.abrupt("return",!0);case 2:return t.prev=2,t.next=5,this.verifyLocalUserRoles();case 5:return t.abrupt("return",t.sent);case 8:return t.prev=8,t.t0=t.catch(2),t.abrupt("return",!1);case 11:case"end":return t.stop()}}),t,this,[[2,8]])})))}),!0);case 12:return o.next=14,this.update(this._currentPresence.data.data,this._currentPresence.data.state).catch((function(){}));case 14:null===(t=this._synchronizer.getEvents())||void 0===t||t.forEach((function(e){e.clientId!==a._currentPresence.clientId&&a.updateMembersList(e,!1).catch((function(){}))}));case 15:case"end":return o.stop()}}),o,this)})))}},{key:"dispose",value:function(){a(s(n.prototype),"dispose",this).call(this),this._synchronizer&&this._synchronizer.dispose()}},{key:"getUsers",value:function(e){return e?this._users.filter((function(t){return t.state==e})):this._users}},{key:"update",value:function(e,t){var n;return l(this,void 0,void 0,r().mark((function i(){var o;return r().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(this._synchronizer&&this._currentPresence){r.next=2;break}throw new Error("LivePresence: not started.");case 2:return r.next=4,this._synchronizer.sendEvent({state:null!==t&&void 0!==t?t:this._currentPresence.data.state,data:null!==(n=(0,g.cloneValue)(e))&&void 0!==n?n:this._currentPresence.data.data});case 4:return o=r.sent,r.next=7,this.updateMembersList(o,!0);case 7:case"end":return r.stop()}}),i,this)})))}},{key:"getUserForClient",value:function(e){return this._users.find((function(t){return t.isFromClient(e)}))}},{key:"getUser",value:function(e){return this._users.find((function(t){return t.userId==e}))}},{key:"updateMembersList",value:function(e,t){var n;return l(this,void 0,void 0,r().mark((function i(){var o;return r().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.prev=0,r.next=3,this.liveRuntime.verifyRolesAllowed(e.clientId,this._allowedRoles);case 3:if(r.sent){r.next=6;break}return r.abrupt("return",!1);case 6:return t&&(this._currentPresence=e),r.next=9,this.liveRuntime.getClientInfo(e.clientId);case 9:if(o=r.sent){r.next=12;break}return r.abrupt("return",!1);case 12:if(!this.useTransientParticipantWorkaround(o)){r.next=14;break}return r.abrupt("return",this.transientParticipantWorkaround(e,t,o));case 14:return r.abrupt("return",this.updateMembersListWithInfo(e,t,o));case 17:r.prev=17,r.t0=r.catch(0),null===(n=this._logger)||void 0===n||n.sendErrorEvent(g.TelemetryEvents.LiveState.RoleVerificationError,r.t0);case 20:return r.abrupt("return",!1);case 21:case"end":return r.stop()}}),i,this,[[0,17]])})))}},{key:"useTransientParticipantWorkaround",value:function(e){var t={userId:e.userId,roles:[b.UserMeetingRole.guest],displayName:void 0};return JSON.stringify(e)===JSON.stringify(t)}},{key:"transientParticipantWorkaround",value:function(e,t,n){var r=this._users.find((function(e){return e.userId===n.userId}));if(r){var i={userId:r.userId,roles:r.roles,displayName:r.displayName};return this.updateMembersListWithInfo(e,t,i)}return this.updateMembersListWithInfo(e,t,n)}},{key:"updateMembersListWithInfo",value:function(e,t,n){for(var r=this,i=function(n){var i,o;r._lastEmitPresenceStateMap.set(n.userId,n.state),r.emit(d.presenceChanged,n,t,e.clientId),t?null===(i=r._logger)||void 0===i||i.sendTelemetryEvent(g.TelemetryEvents.LivePresence.LocalPresenceChanged,{user:e}):null===(o=r._logger)||void 0===o||o.sendTelemetryEvent(g.TelemetryEvents.LivePresence.RemotePresenceChanged,{user:e})},o=!1,a=!0,s=0;s<this._users.length;s++){var u=this._users[s];n.userId===u.userId?(u.updateReceived(e,n,t)&&(i(u),o=!0),a=!1):this._lastEmitPresenceStateMap.get(u.userId)!==u.state&&(i(u),o=!0)}if(!a)return o;var c=new f.LivePresenceUser(n,e,this._expirationPeriod,this.liveRuntime,t);return this._users.push(c),i(c),!0}}]),n}(w.LiveDataObject);S.TypeName="@microsoft/live-share:LivePresence",S.factory=new h.DataObjectFactory(S.TypeName,S,[],{}),t.LivePresence=S,y.DynamicObjectRegistry.registerObjectClass(S,S.TypeName)},45767:function(e,t,n){"use strict";var r=n(56690).default,i=n(89728).default;Object.defineProperty(t,"__esModule",{value:!0}),t.LivePresenceConnection=void 0;var o=n(99299),a=n(24133),s=n(60605),u=function(){function e(t,n,i,o){r(this,e),this._evt=t,this._isLocalConnection=n,this._expirationPeriod=i,this._liveRuntime=o}return i(e,[{key:"isLocalConnection",get:function(){return this._isLocalConnection}},{key:"clientId",get:function(){return this._evt.clientId}},{key:"state",get:function(){return this.hasExpired()?s.PresenceState.offline:this._evt.data.state}},{key:"data",get:function(){return(0,o.cloneValue)(this._evt.data.data)}},{key:"updateConnection",value:function(e){if(this._evt.clientId!==e.clientId)throw new Error("LivePresenceConnection.updateConnection called with event with different clientId");a.LiveEvent.isNewer(this._evt,e)&&(this._evt=e)}},{key:"expirationPeriod",set:function(e){this._expirationPeriod=e}},{key:"hasExpired",value:function(){var e=this._liveRuntime.getTimestamp()-this._evt.timestamp;return!this._isLocalConnection&&e>this._expirationPeriod.milliseconds}}]),e}();t.LivePresenceConnection=u},60605:function(e,t,n){"use strict";var r=n(56690).default,i=n(89728).default;Object.defineProperty(t,"__esModule",{value:!0}),t.LivePresenceUser=t.PresenceState=void 0;var o,a=n(24133),s=n(99299),u=n(45767);!function(e){e.online="online",e.away="away",e.offline="offline"}(o=t.PresenceState||(t.PresenceState={}));var c=function(){function e(t,n,i,o,a){r(this,e),this._clientInfo=t,this._evt=n,this._expirationPeriod=i,this._liveRuntime=o,this._connections=new Map,this._isLocalUser=!1,this.updateClients(this._evt,a),this._lastUpdateTime=this._liveRuntime.getTimestamp()}return i(e,[{key:"isLocalUser",get:function(){return this._isLocalUser}},{key:"userId",get:function(){return this._clientInfo.userId}},{key:"displayName",get:function(){return this._clientInfo.displayName}},{key:"state",get:function(){return this.hasExpired()?o.offline:this._evt.data.state}},{key:"data",get:function(){return(0,s.cloneValue)(this._evt.data.data)}},{key:"roles",get:function(){return this._clientInfo.roles}},{key:"getConnections",value:function(e){var t=[];return this._connections.forEach((function(n){void 0!=e&&n.state!=e||t.push(n)})),t}},{key:"getConnection",value:function(e){return this._connections.get(e)}},{key:"isFromClient",value:function(e){return void 0!==this._connections.get(e)}},{key:"updateReceived",value:function(e,t,n){var r=this.updateClients(e,n),i=this._evt,o=this._clientInfo;return a.LiveEvent.isNewer(i,e)?(this._evt=e,this._clientInfo=t,this._lastUpdateTime=this._liveRuntime.getTimestamp(),r||e.data.state!=i.data.state||JSON.stringify(t)!=JSON.stringify(o)||JSON.stringify(e.data.data)!=JSON.stringify(i.data.data)):r}},{key:"expirationPeriod",set:function(e){this._expirationPeriod=e,this._connections.forEach((function(t){t.expirationPeriod=e}))}},{key:"hasExpired",value:function(){var e=this._liveRuntime.getTimestamp()-this._lastUpdateTime;return!this._isLocalUser&&e>this._expirationPeriod.milliseconds}},{key:"updateClients",value:function(e,t){var n=this._connections.get(e.clientId);return n?(n.updateConnection(e),!1):(this._connections.set(e.clientId,new u.LivePresenceConnection(e,t,this._expirationPeriod,this._liveRuntime)),!(!t||this._isLocalUser)&&(this._isLocalUser=t,!0))}}]),e}();t.LivePresenceUser=c},81202:function(e,t,n){"use strict";var r=n(17061).default,i=n(56690).default,o=n(89728).default,a=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{u(r.next(e))}catch(t){o(t)}}function s(e){try{u(r.throw(e))}catch(t){o(t)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}u((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.LiveShareClient=void 0;var s=n(99299),u=n(30),c=n(44402),l=n(26103),d=n(70970),h=n(72950),f=n(82918),p=(new Map).set("https://alfred.westus2.fluidrelay.azure.com","https://us.fluidrelay.azure.com").set("https://alfred.westeurope.fluidrelay.azure.com","https://eu.fluidrelay.azure.com").set("https://alfred.southeastasia.fluidrelay.azure.com","https://global.fluidrelay.azure.com"),v=function(){function e(t,n){if(i(this,e),this._host=d.TestLiveShareHost.create(void 0,void 0),this.maxContainerLookupTries=3,!t||"function"!=typeof t.getFluidTenantInfo)throw new Error("LiveShareClient: host not passed in");this._host=t,this._options=Object.assign({},n)}return o(e,[{key:"isTesting",get:function(){var e;return"local"==(null===(e=this._options.connection)||void 0===e?void 0:e.type)||this._host instanceof d.TestLiveShareHost}},{key:"joinContainer",value:function(e,t){var n;return a(this,void 0,void 0,r().mark((function i(){var o,a,c,d,v,g,m,y,b,w;return r().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(performance.mark("TeamsSync: join container"),r.prev=1,o=this.isTesting?new l.LocalTimestampProvider:null===(n=this._options)||void 0===n?void 0:n.timestampProvider,a=new h.LiveShareRuntime(this._host,o,this._options.roleVerifier),c=a.start(),d=(0,f.getLiveShareContainerSchemaProxy)(e,a),v=this._options.connection){r.next=27;break}return r.next=10,this._host.getFluidTenantInfo();case 10:if(g=r.sent,m=g.serviceEndpoint){r.next=18;break}if(!p.has(g.serviceEndpoint)){r.next=17;break}m=p.get(g.serviceEndpoint),r.next=18;break;case 17:throw new Error("LiveShareClient: Unable to find fluid endpoint for: ".concat(g.serviceEndpoint));case 18:if("local"!=g.tenantId){r.next=26;break}return r.t0=m,r.next=22,(0,s.getInsecureTokenProvider)();case 22:r.t1=r.sent,v={type:"local",endpoint:r.t0,tokenProvider:r.t1},r.next=27;break;case 26:v={type:"remote",tenantId:g.tenantId,endpoint:m,tokenProvider:new s.LiveShareTokenProvider(this._host)};case 27:return y=new u.AzureClient({connection:v,logger:this._options.logger}),b=this.getOrCreateContainer(y,d,0,t),r.next=31,Promise.all([b,c]);case 31:return w=r.sent,a.setAudience(w[0].services.audience),performance.mark("TeamsSync: container connecting"),r.abrupt("return",Object.assign(Object.assign({},w[0]),{timestampProvider:a.timestampProvider}));case 35:return r.prev=35,performance.measure("TeamsSync: container joined","TeamsSync: join container"),r.finish(35);case 38:case"end":return r.stop()}}),i,this,[[1,,35,38]])})))}},{key:"getOrCreateContainer",value:function(e,t,n,i){return a(this,void 0,void 0,r().mark((function o(){var a;return r().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,this._host.getFluidContainerId();case 2:if(!(a=r.sent).shouldCreate){r.next=9;break}return r.next=6,this.createNewContainer(e,t,n,i);case 6:case 23:return r.abrupt("return",r.sent);case 9:if(!a.containerId){r.next=18;break}return r.t0=Object,r.t1={created:!1},r.next=14,e.getContainer(a.containerId,t);case 14:return r.t2=r.sent,r.abrupt("return",r.t0.assign.call(r.t0,r.t1,r.t2));case 18:if(!(n<this.maxContainerLookupTries&&a.retryAfter>0)){r.next=26;break}return r.next=21,this.wait(a.retryAfter);case 21:return r.next=23,this.getOrCreateContainer(e,t,n+1,i);case 26:throw new Error("LiveShareClient: timed out attempting to create or get container for current context.");case 27:case"end":return r.stop()}}),o,this)})))}},{key:"createNewContainer",value:function(e,t,n,i){return a(this,void 0,void 0,r().mark((function n(){var o,a,s,u,l;return r().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,e.createContainer(t);case 2:return o=n.sent,a=o.container,s=o.services,i&&i(a),n.next=8,a.attach();case 8:return u=n.sent,n.next=11,this._host.setFluidContainerId(u);case 11:if((l=n.sent).containerState==c.ContainerState.added){n.next=22;break}return a.dispose(),n.t0=Object,n.t1={created:!1},n.next=18,e.getContainer(l.containerId,t);case 18:return n.t2=n.sent,n.abrupt("return",n.t0.assign.call(n.t0,n.t1,n.t2));case 22:return n.abrupt("return",{container:a,services:s,created:!0});case 23:case"end":return n.stop()}}),n,this)})))}},{key:"wait",value:function(e){return new Promise((function(t){setTimeout((function(){return t()}),e)}))}}]),e}();t.LiveShareClient=v},72950:function(e,t,n){"use strict";var r=n(17061).default,i=n(56690).default,o=n(89728).default,a=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{u(r.next(e))}catch(t){o(t)}}function s(e){try{u(r.throw(e))}catch(t){o(t)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}u((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.LiveShareRuntime=void 0;var s=n(85681),u=n(75527),c=n(99299),l=function(){function e(t,n,r){var o=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];i(this,e),this._started=!1,this._objectManager=null,this._host=o?new c.BackwardsCompatibilityHostDecorator(new c.LiveShareHostDecorator(t)):t,this._timestampProvider=n||new u.HostTimestampProvider(this._host),this._roleVerifier=r||new c.RoleVerifier(this._host)}return o(e,[{key:"objectManager",get:function(){return(0,s.assert)(null!==this._objectManager,"LiveObjectSynchronizerManager not initialized."),this._objectManager}},{key:"timestampProvider",get:function(){return this._timestampProvider}},{key:"host",get:function(){return this._host}},{key:"getTimestamp",value:function(){return this._timestampProvider.getTimestamp()}},{key:"verifyRolesAllowed",value:function(e,t){return this._roleVerifier.verifyRolesAllowed(e,t)}},{key:"getClientInfo",value:function(e){return this._host.getClientInfo(e)}},{key:"setTimestampProvider",value:function(e){this._timestampProvider=e}},{key:"setRoleVerifier",value:function(e){this._roleVerifier=e}},{key:"setHost",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this._host=t?new c.BackwardsCompatibilityHostDecorator(new c.LiveShareHostDecorator(e)):e,this._timestampProvider instanceof u.HostTimestampProvider&&(this._timestampProvider.stop(),this.setTimestampProvider(new u.HostTimestampProvider(this._host))),this._roleVerifier instanceof c.RoleVerifier&&this.setRoleVerifier(new c.RoleVerifier(this._host))}},{key:"setAudience",value:function(e){var t;this._audience=e,null===(t=this._objectManager)||void 0===t||t.setAudience(this._audience)}},{key:"start",value:function(){return a(this,void 0,void 0,r().mark((function e(){return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._started){e.next=2;break}throw new Error("LiveShareRuntime.start(): cannot call start when already started");case 2:if(this._started=!0,this._objectManager&&this.startObjectSynchronizerManager(),!(0,c.isTimestampProvider)(this._timestampProvider)||this._timestampProvider.isRunning){e.next=7;break}return e.next=7,this._timestampProvider.start();case 7:case"end":return e.stop()}}),e,this)})))}},{key:"stop",value:function(){var e;if(!this._started)throw new Error("LiveShareRuntime.stop(): cannot call stop when not already started");this._started=!1,(0,c.isTimestampProvider)(this._timestampProvider)&&this._timestampProvider.isRunning&&this._timestampProvider.stop(),null===(e=this._objectManager)||void 0===e||e.stop()}},{key:"__dangerouslySetContainerRuntime",value:function(e){this._containerRuntime!==e&&(this._containerRuntime=e,this._objectManager?this._objectManager.__dangerouslySetContainerRuntime(e):(this._objectManager=new c.LiveObjectManager(this,this._containerRuntime),this.startObjectSynchronizerManager()))}},{key:"startObjectSynchronizerManager",value:function(){this.objectManager.start()}}]),e}();t.LiveShareRuntime=l},32936:function(e,t,n){"use strict";var r=n(17061).default,i=n(56690).default,o=n(89728).default,a=n(41588).default,s=n(73808).default,u=n(61655).default,c=n(26389).default,l=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{u(r.next(e))}catch(t){o(t)}}function s(e){try{u(r.throw(e))}catch(t){o(t)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}u((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.LiveState=t.LiveStateEvents=void 0;var d,h=n(72117),f=n(85681),p=n(99299),v=n(25037),g=n(24133),m=n(72508),y=n(6515),b=n(90030);!function(e){e.stateChanged="stateChanged"}(d=t.LiveStateEvents||(t.LiveStateEvents={}));var w=function(e){u(n,e);var t=c(n);function n(){return i(this,n),t.apply(this,arguments)}return o(n,[{key:"isInitialized",get:function(){return!!this._synchronizer}},{key:"state",get:function(){return this.latestEvent.data}},{key:"initialize",value:function(e,t){return l(this,void 0,void 0,r().mark((function n(){var i,o,a,s=this;return r().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(!this.isInitialized){n.next=2;break}throw new Error("LiveState already started.");case 2:return this._logger=new v.LiveTelemetryLogger(this.runtime,this.liveRuntime),this.latestEvent={clientId:"",name:"ChangeState",timestamp:0,data:e},this._allowedRoles=t||[],this._synchronizer=new m.LiveObjectSynchronizer(this.id,this.runtime,this.liveRuntime),n.next=8,this._synchronizer.start(e,(function(e,t,n){return l(s,void 0,void 0,r().mark((function i(){return r().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,this.onReceivedStateEvent(e,t,n);case 2:return r.abrupt("return",r.sent);case 3:case"end":return r.stop()}}),i,this)})))}),(function(e){return l(s,void 0,void 0,r().mark((function t(){return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!e){t.next=2;break}return t.abrupt("return",!0);case 2:return t.prev=2,t.next=5,this.verifyLocalUserRoles();case 5:return t.abrupt("return",t.sent);case 8:return t.prev=8,t.t0=t.catch(2),t.abrupt("return",!1);case 11:case"end":return t.stop()}}),t,this,[[2,8]])})))}));case 8:if(i=this._synchronizer.getEvents()){n.next=11;break}return n.abrupt("return");case 11:o=0;case 12:if(!(o<i.length)){n.next=30;break}return a=i[o],n.t0=this,n.t1=a,n.t2=a.clientId,n.t3=a.clientId,n.next=20,this.waitUntilConnected();case 20:return n.t4=n.sent,n.t5=n.t3===n.t4,n.next=24,n.t0.onReceivedStateEvent.call(n.t0,n.t1,n.t2,n.t5);case 24:if(!n.sent){n.next=27;break}return n.abrupt("break",30);case 27:o++,n.next=12;break;case 30:case"end":return n.stop()}}),n,this)})))}},{key:"dispose",value:function(){a(s(n.prototype),"dispose",this).call(this),this._synchronizer&&this._synchronizer.dispose()}},{key:"set",value:function(e){return l(this,void 0,void 0,r().mark((function t(){var n,i;return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.isInitialized){t.next=2;break}throw new Error("LiveState not started.");case 2:return n=(0,p.cloneValue)(e),t.next=5,this._synchronizer.sendEvent(n);case 5:i=t.sent,this.updateState(i,!0);case 7:case"end":return t.stop()}}),t,this)})))}},{key:"latestEvent",get:function(){return(0,f.assert)(void 0!==this._latestEvent,"LiveState is not initialized"),this._latestEvent},set:function(e){this._latestEvent=e}},{key:"onReceivedStateEvent",value:function(e,t,n){var i;return l(this,void 0,void 0,r().mark((function o(){return r().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.prev=0,r.next=3,this.liveRuntime.verifyRolesAllowed(t,this._allowedRoles);case 3:if(r.sent&&g.LiveEvent.isNewer(this.latestEvent,e)){r.next=6;break}return r.abrupt("return",!1);case 6:if(JSON.stringify(this.latestEvent.data)!==JSON.stringify(e.data)){r.next=8;break}return r.abrupt("return",!1);case 8:return this.updateState(e,n),r.abrupt("return",!0);case 12:return r.prev=12,r.t0=r.catch(0),null===(i=this._logger)||void 0===i||i.sendErrorEvent(p.TelemetryEvents.LiveState.RoleVerificationError,r.t0),r.abrupt("return",!1);case 16:case"end":return r.stop()}}),o,this,[[0,12]])})))}},{key:"updateState",value:function(e,t){var n,r=this.latestEvent.data,i=e.data;this.latestEvent=e,this.emit(d.stateChanged,(0,p.cloneValue)(e.data),t,e.clientId,e.timestamp),null===(n=this._logger)||void 0===n||n.sendTelemetryEvent(p.TelemetryEvents.LiveState.StateChanged,{oldState:r,newState:i})}}]),n}(b.LiveDataObject);w.TypeName="@microsoft/live-share:LiveState",w.factory=new h.DataObjectFactory(w.TypeName,w,[],{}),t.LiveState=w,y.DynamicObjectRegistry.registerObjectClass(w,w.TypeName)},25037:function(e,t,n){"use strict";var r=n(56690).default,i=n(89728).default;Object.defineProperty(t,"__esModule",{value:!0}),t.LiveTelemetryLogger=void 0;var o=function(){function e(t,n){r(this,e),this._liveRuntime=n,this._runtime=t}return i(e,[{key:"sendTelemetryEvent",value:function(e,t,n){if(this._runtime.logger){var r=this.createTelemetryEvent(e,n);this._runtime.logger.sendTelemetryEvent(r,t)}}},{key:"sendErrorEvent",value:function(e,t,n){if(this._runtime.logger){var r=this.createTelemetryEvent(e,n);this._runtime.logger.sendErrorEvent(r,t)}}},{key:"sendPerformanceEvent",value:function(e,t,n,r){if(this._runtime.logger){var i=Object.assign({duration:t},this.createTelemetryEvent(e,r));this._runtime.logger.sendPerformanceEvent(i,n)}}},{key:"createTelemetryEvent",value:function(t,n){var r=this._liveRuntime.getTimestamp();return Object.assign({eventName:t,clientId:this._runtime.clientId,correlationId:e.formatCorrelationId(this._runtime.clientId,r),timestamp:r},n)}}],[{key:"formatCorrelationId",value:function(e,t){return"".concat(e,":").concat(t)}}]),e}();t.LiveTelemetryLogger=o},12870:function(e,t,n){"use strict";var r=n(17061).default,i=n(56690).default,o=n(89728).default,a=n(41588).default,s=n(73808).default,u=n(61655).default,c=n(26389).default,l=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{u(r.next(e))}catch(t){o(t)}}function s(e){try{u(r.throw(e))}catch(t){o(t)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}u((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.LiveTimer=t.LiveTimerEvents=void 0;var d,h=n(72117),f=n(72508),p=n(24133),v=n(6515),g=n(90030);!function(e){e.started="started",e.played="played",e.paused="paused",e.finished="finished",e.onTick="onTick"}(d=t.LiveTimerEvents||(t.LiveTimerEvents={}));var m=function(e){u(n,e);var t=c(n);function n(){var e;return i(this,n),(e=t.apply(this,arguments))._currentConfig={clientId:"",timestamp:0,data:{duration:0,position:0,running:!1}},e._defaultTickRate=20,e._tickRate=e._defaultTickRate,e}return o(n,[{key:"isInitialized",get:function(){return!!this._synchronizer}},{key:"tickRate",get:function(){return this._tickRate},set:function(e){this._tickRate=e}},{key:"initialize",value:function(e){return l(this,void 0,void 0,r().mark((function t(){var n,i,o,a=this;return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!this.isInitialized){t.next=2;break}throw new Error("LiveTimer already started.");case 2:return this._allowedRoles=e||[],this._synchronizer=new f.LiveObjectSynchronizer(this.id,this.runtime,this.liveRuntime),t.next=6,this._synchronizer.start(this._currentConfig.data,(function(e,t){return l(a,void 0,void 0,r().mark((function n(){return r().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,this.remoteConfigReceived(e,t);case 2:return n.abrupt("return",n.sent);case 3:case"end":return n.stop()}}),n,this)})))}),(function(e){return l(a,void 0,void 0,r().mark((function t(){return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!e){t.next=2;break}return t.abrupt("return",!0);case 2:return t.prev=2,t.next=5,this.verifyLocalUserRoles();case 5:return t.abrupt("return",t.sent);case 8:return t.prev=8,t.t0=t.catch(2),t.abrupt("return",!1);case 11:case"end":return t.stop()}}),t,this,[[2,8]])})))}));case 6:if(n=this._synchronizer.getEvents()){t.next=9;break}return t.abrupt("return");case 9:i=0;case 10:if(!(i<n.length)){t.next=20;break}return o=n[i],t.next=14,this.remoteConfigReceived(Object.assign(Object.assign({},o),{clientId:o.clientId}),o.clientId);case 14:if(!t.sent){t.next=17;break}return t.abrupt("break",20);case 17:i++,t.next=10;break;case 20:case"end":return t.stop()}}),t,this)})))}},{key:"dispose",value:function(){a(s(n.prototype),"dispose",this).call(this),this._synchronizer&&this._synchronizer.dispose()}},{key:"start",value:function(e){return l(this,void 0,void 0,r().mark((function t(){return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.isInitialized){t.next=2;break}throw new Error("LiveTimer not started.");case 2:return t.next=4,this.playInternal(e,0);case 4:case"end":return t.stop()}}),t,this)})))}},{key:"play",value:function(){return l(this,void 0,void 0,r().mark((function e(){return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.isInitialized){e.next=2;break}throw new Error("LiveTimer not started.");case 2:if(this._currentConfig.data.running||!(this._currentConfig.data.position<this._currentConfig.data.duration)){e.next=5;break}return e.next=5,this.playInternal(this._currentConfig.data.duration,this._currentConfig.data.position);case 5:case"end":return e.stop()}}),e,this)})))}},{key:"playInternal",value:function(e,t){return l(this,void 0,void 0,r().mark((function n(){var i;return r().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.t0=this.liveRuntime.getTimestamp(),n.next=3,this.waitUntilConnected();case 3:return n.t1=n.sent,n.t2={duration:e,position:t,running:!0},i={timestamp:n.t0,clientId:n.t1,data:n.t2},n.next=8,this.updateConfig(i,!0);case 8:case"end":return n.stop()}}),n,this)})))}},{key:"pause",value:function(){return l(this,void 0,void 0,r().mark((function e(){var t,n;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.isInitialized){e.next=2;break}throw new Error("LiveTimer not started.");case 2:if(!this._currentConfig.data.running){e.next=12;break}return t=this.liveRuntime.getTimestamp(),e.t0=t,e.next=7,this.waitUntilConnected();case 7:return e.t1=e.sent,e.t2={duration:this._currentConfig.data.duration,position:this._currentConfig.data.position+(t-this._currentConfig.timestamp),running:!1},n={timestamp:e.t0,clientId:e.t1,data:e.t2},e.next=12,this.updateConfig(n,!0);case 12:case"end":return e.stop()}}),e,this)})))}},{key:"remoteConfigReceived",value:function(e,t){return l(this,void 0,void 0,r().mark((function n(){var i,o,a,s,u,c;return r().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,this.liveRuntime.verifyRolesAllowed(t,this._allowedRoles);case 3:if(i=n.sent,o={timestamp:this._currentConfig.timestamp,clientId:this._currentConfig.clientId},a=p.LiveEvent.isNewer(o,e),s=this.liveRuntime.getTimestamp(),u=this.endTimeFromConfig(e),!(i&&0===this._currentConfig.timestamp&&!0===e.data.running&&s>=u)){n.next=12;break}return c={timestamp:u,clientId:e.clientId,data:{duration:e.data.duration,position:e.data.duration,running:!1}},this.updateConfig(c,!1),n.abrupt("return",!0);case 12:if(JSON.stringify(this._currentConfig.data)!==JSON.stringify(e.data)||this._currentConfig.timestamp!==e.timestamp){n.next=14;break}return n.abrupt("return",!1);case 14:if(!i||!a){n.next=17;break}return this.updateConfig(e,!1),n.abrupt("return",!0);case 17:return n.abrupt("return",!1);case 20:return n.prev=20,n.t0=n.catch(0),n.abrupt("return",!1);case 23:case"end":return n.stop()}}),n,this,[[0,20]])})))}},{key:"updateConfig",value:function(e,t){return l(this,void 0,void 0,r().mark((function n(){var i;return r().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(i=Object.assign({clientId:e.clientId,configChangedAt:e.timestamp},e.data),this._currentConfig=e,0===e.data.position?this.emit(d.started,i,t):e.data.duration===e.data.position?this.emit(d.finished,i):e.data.running?this.emit(d.played,i,t):this.emit(d.paused,i,t),e.data.running&&this.startTicking(),!t){n.next=8;break}return n.next=7,this._synchronizer.sendEvent(e.data);case 7:return n.abrupt("return",n.sent);case 8:case"end":return n.stop()}}),n,this)})))}},{key:"startTicking",value:function(){var e=this;this.scheduleAnimationFrame((function t(){if(e._currentConfig.data.running){var n=e.liveRuntime.getTimestamp(),r=e.endTimeFromConfig(e._currentConfig);if(n>=r){var i={timestamp:r,clientId:e._currentConfig.clientId,data:{duration:e._currentConfig.data.duration,position:e._currentConfig.data.duration,running:!1}};e.updateConfig(i,!1).catch((function(e){console.error(e)}))}else e.emit(d.onTick,r-n),e.scheduleAnimationFrame(t)}}))}},{key:"scheduleAnimationFrame",value:function(e){this._tickRate<=this._defaultTickRate&&"function"==typeof requestAnimationFrame?requestAnimationFrame(e):setTimeout(e,this._tickRate)}},{key:"endTimeFromConfig",value:function(e){return e.timestamp-e.data.position+e.data.duration}}]),n}(g.LiveDataObject);m.TypeName="@microsoft/live-share:LiveTimer",m.factory=new h.DataObjectFactory(m.TypeName,m,[],{}),t.LiveTimer=m,v.DynamicObjectRegistry.registerObjectClass(m,m.TypeName)},26103:function(e,t,n){"use strict";var r=n(56690).default,i=n(89728).default;Object.defineProperty(t,"__esModule",{value:!0}),t.LocalTimestampProvider=void 0;var o=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];r(this,e),this._lastTimeSent=0,t&&(e._warned=!0)}return i(e,[{key:"getTimestamp",value:function(){return e._warned||(console.warn("LiveEvent is using a LocalTimestampProvider which could cause issues when used across multiple clients."),e._warned=!0),this._lastTimeSent=Math.max((new Date).getTime(),this._lastTimeSent+1)}},{key:"getMaxTimestampError",value:function(){return 0}}]),e}();o._warned=!1,t.LocalTimestampProvider=o},70970:function(e,t,n){"use strict";var r=n(17061).default,i=n(56690).default,o=n(89728).default,a=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{u(r.next(e))}catch(t){o(t)}}function s(e){try{u(r.throw(e))}catch(t){o(t)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}u((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.TestLiveShareHost=void 0;var s=n(44402),u=function(){function e(t,n){i(this,e),this._getLocalTestContainerId=t,this._setLocalTestContainerId=n,this.roleCache=new Map,this.defaultRemoteRoles=[s.UserMeetingRole.organizer,s.UserMeetingRole.presenter,s.UserMeetingRole.attendee],this.defaultLocalRoles=[s.UserMeetingRole.organizer,s.UserMeetingRole.presenter,s.UserMeetingRole.attendee]}return o(e,[{key:"getFluidTenantInfo",value:function(){return e.ensureWarned(),Promise.resolve({tenantId:"local",serviceEndpoint:"http://localhost:7070"})}},{key:"getFluidToken",value:function(t){return Promise.resolve(e.LOCAL_MODE_TEST_TOKEN)}},{key:"getFluidContainerId",value:function(){var e=this.getLocalTestContainerId();return Promise.resolve({containerState:e?s.ContainerState.alreadyExists:s.ContainerState.notFound,shouldCreate:!e,containerId:e,retryAfter:0})}},{key:"setFluidContainerId",value:function(e){return this.setLocalTestContainerId(e),Promise.resolve({containerState:s.ContainerState.added,containerId:e,shouldCreate:!1,retryAfter:0})}},{key:"getNtpTime",value:function(){var e=new Date;return Promise.resolve({ntpTime:e.toUTCString(),ntpTimeInUTC:e.getTime()})}},{key:"registerClientId",value:function(e){if(this.roleCache.has(e))throw new Error("Already registered clientId");return this.addClient(e,this.defaultLocalRoles),Promise.resolve(this.defaultLocalRoles)}},{key:"addClient",value:function(e,t){return this.roleCache.set(e,t),this}},{key:"getClientInfo",value:function(e){return a(this,void 0,void 0,r().mark((function t(){var n;return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.t0=e,t.next=3,this.getClientRoles(e);case 3:return t.t1=t.sent,t.t2=e.substring(0,4),n={userId:t.t0,roles:t.t1,displayName:t.t2},t.abrupt("return",Promise.resolve(n));case 7:case"end":return t.stop()}}),t,this)})))}},{key:"getClientRoles",value:function(e){return a(this,void 0,void 0,r().mark((function t(){var n;return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e){t.next=2;break}throw new Error("TestLiveShareHost: called getClientRoles() without a clientId");case 2:return n=this.roleCache.has(e)?this.roleCache.get(e):this.defaultRemoteRoles,t.abrupt("return",Promise.resolve(n));case 4:case"end":return t.stop()}}),t,this)})))}},{key:"getLocalTestContainerId",value:function(){return this._getLocalTestContainerId?this._getLocalTestContainerId():window.location.hash?window.location.hash.substring(1):void 0}},{key:"setLocalTestContainerId",value:function(e){this._setLocalTestContainerId?this._setLocalTestContainerId(e):window.location.hash=e}}],[{key:"create",value:function(t,n){return new e(t,n)}},{key:"ensureWarned",value:function(){e._warned||(console.warn("TestLiveShareHost is being used. This should only be used for local testing purposes."),e._warned=!0)}}]),e}();u.LOCAL_MODE_TEST_TOKEN="test-token",u._warned=!1,t.TestLiveShareHost=u},32420:function(e,t,n){"use strict";var r=n(56690).default,i=n(89728).default;Object.defineProperty(t,"__esModule",{value:!0}),t.TimeInterval=void 0;var o=function(){function e(t){r(this,e),this._value=t}return i(e,[{key:"milliseconds",get:function(){return this._value},set:function(e){this._value=e}},{key:"seconds",get:function(){return this._value/1e3},set:function(e){this._value=Math.floor(1e3*e)}}]),e}();t.TimeInterval=o},11402:function(e,t,n){"use strict";var r=n(17061).default,i=n(56690).default,o=n(89728).default,a=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{u(r.next(e))}catch(t){o(t)}}function s(e){try{u(r.throw(e))}catch(t){o(t)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}u((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.TimestampProvider=void 0;var s=function(){function e(){i(this,e),this._retries=0,this._lastTimeSent=0}return o(e,[{key:"isRunning",get:function(){return!!this._serverTime}},{key:"getTimestamp",value:function(){if(!this._serverTime)throw new Error("TimestampProvider: can't call getTimestamp() before calling start().");return this._lastTimeSent=Math.max((new Date).getTime()+this._serverTime.offset,this._lastTimeSent+1)}},{key:"getMaxTimestampError",value:function(){if(!this._serverTime)throw new Error("DefaultTimestampProvider: can't call getMaxTimestampError() before calling initialize().");return Math.floor(this._serverTime.requestLatency/2)}},{key:"start",value:function(){return a(this,void 0,void 0,r().mark((function e(){return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.stop(),performance.mark("TeamsSync: starting clock"),e.prev=2,e.next=5,this.improveAccuracy();case 5:return e.prev=5,performance.measure("TeamsSync: clock startup","TeamsSync: starting clock"),e.finish(5);case 8:case"end":return e.stop()}}),e,this,[[2,,5,8]])})))}},{key:"stop",value:function(){this._syncTimer&&(clearTimeout(this._syncTimer),this._syncTimer=void 0),this._serverTime=void 0,this._retries=0}},{key:"improveAccuracy",value:function(){return a(this,void 0,void 0,r().mark((function e(){var t;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getSessionTimeOffset();case 2:t=e.sent,!this._serverTime||t.requestLatency<this._serverTime.requestLatency?(this._serverTime=t,this._retries=0):this._retries++,this._retries<=5?this._syncTimer=setTimeout(this.improveAccuracy.bind(this),5e3):this._syncTimer=void 0;case 5:case"end":return e.stop()}}),e,this)})))}},{key:"getSessionTimeOffset",value:function(){return a(this,void 0,void 0,r().mark((function e(){var t,n,i,o,a,s;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=performance.now(),e.next=3,this.getNtpTime();case 3:return n=e.sent,i=performance.now(),o=(new Date).getTime(),a=i-t,s=n.ntpTimeInUTC+Math.floor(a/2),e.abrupt("return",{serverTimeInUtc:s,localTimeInUtc:o,requestLatency:a,offset:s-o});case 9:case"end":return e.stop()}}),e,this)})))}}]),e}();t.TimestampProvider=s},75862:function(e,t,n){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n);var i=Object.getOwnPropertyDescriptor(t,n);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,r,i)}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),i=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||r(t,e,n)};Object.defineProperty(t,"__esModule",{value:!0}),i(n(6515),t),i(n(75527),t),i(n(44402),t),i(n(24133),t),i(n(25593),t),i(n(24034),t),i(n(16078),t),i(n(51788),t),i(n(19167),t),i(n(60605),t),i(n(81202),t),i(n(32936),t),i(n(25037),t),i(n(12870),t),i(n(26103),t),i(n(70970),t),i(n(32420),t),i(n(11402),t),i(n(82918),t),i(n(90030),t),i(n(72950),t),i(n(19299),t),i(n(72508),t)},44402:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ContainerState=t.UserMeetingRole=void 0,function(e){e.guest="Guest",e.attendee="Attendee",e.presenter="Presenter",e.organizer="Organizer"}(t.UserMeetingRole||(t.UserMeetingRole={})),function(e){e.added="Added",e.alreadyExists="AlreadyExists",e.conflict="Conflict",e.notFound="NotFound"}(t.ContainerState||(t.ContainerState={}))},18798:function(e,t,n){"use strict";var r=n(17061).default,i=n(56690).default,o=n(89728).default,a=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{u(r.next(e))}catch(t){o(t)}}function s(e){try{u(r.throw(e))}catch(t){o(t)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}u((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.BackwardsCompatibilityHostDecorator=void 0;var s=n(97152),u=n(78329),c=n(70489),l=[100,200,200,400,600],d=function(){function e(t){i(this,e),this._host=t,this._userRolesRequestCache=new s.RequestCache(3e5),this._totalTries=4,this._getClientInfoTriesRemaining=this._totalTries,this._getClientInfoExists=!1,this._hasWarnedPolyfill=!1,this.warmupCheckGetClientInfoExists()}return o(e,[{key:"getFluidTenantInfo",value:function(){return this._host.getFluidTenantInfo()}},{key:"getFluidToken",value:function(e){return this._host.getFluidToken(e)}},{key:"getFluidContainerId",value:function(){return this._host.getFluidContainerId()}},{key:"setFluidContainerId",value:function(e){return this._host.setFluidContainerId(e)}},{key:"getNtpTime",value:function(){return this._host.getNtpTime()}},{key:"getClientRoles",value:function(e){return a(this,void 0,void 0,r().mark((function t(){var n=this;return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e){t.next=2;break}throw new Error("BackwardsCompatibilityHostDecorator: called getClientInfo() without a clientId");case 2:return t.abrupt("return",this._userRolesRequestCache.cacheRequest(e,(function(){return(0,c.waitForResult)((function(){return a(n,void 0,void 0,r().mark((function t(){return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this._host.getClientRoles(e);case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),t,this)})))}),(function(e){return(0,u.isClientRolesResponse)(e)?{response:e}:(0,u.isMobileWorkaroundRolesResponse)(e)?{response:e.userRoles}:null}),(function(){return new Error("BackwardsCompatibilityHostDecorator: timed out getting roles for a remote client ID")}),l)})));case 3:case"end":return t.stop()}}),t,this)})))}},{key:"getClientInfo",value:function(e){return a(this,void 0,void 0,r().mark((function t(){var n,i,o,a,s=this;return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!this._getClientInfoExists){t.next=4;break}return t.next=3,this._host.getClientInfo(e);case 3:case 32:return t.abrupt("return",t.sent);case 4:if(!(this._getClientInfoTriesRemaining<=0)){t.next=10;break}return this._hasWarnedPolyfill||(console.warn("BackwardsCompatibilityHostDecorator.getClientInfo: using getClientInfo polyfill"),this._hasWarnedPolyfill=!0),t.next=8,this.getClientRoles(e);case 8:return n=t.sent,t.abrupt("return",{userId:e,displayName:void 0,roles:null!==n&&void 0!==n?n:[]});case 10:return i=this.getClientRoles(e),t.prev=11,t.next=14,this._host.getClientInfo(e,(function(){s._getClientInfoExists=!0}),this.getRetrySchedule());case 14:return o=t.sent,this._getClientInfoExists=!0,t.abrupt("return",o);case 19:if(t.prev=19,t.t0=t.catch(11),!(0,u.isErrorLike)(t.t0)||!t.t0.message.includes("timed out")){t.next=28;break}return this._getClientInfoTriesRemaining--,this._getClientInfoTriesRemaining<=0&&console.warn("BackwardsCompatibilityHostDecorator.getClientInfo: will use getClientInfo polyfill"),t.next=26,i;case 26:return a=t.sent,t.abrupt("return",{userId:e,displayName:void 0,roles:null!==a&&void 0!==a?a:[]});case 28:return this._getClientInfoExists=!0,console.log("BackwardsCompatibilityHostDecorator: error, retryingWithActual"),t.next=32,this.getClientInfo(e);case 33:case"end":return t.stop()}}),t,this,[[11,19]])})))}},{key:"registerClientId",value:function(e){return a(this,void 0,void 0,r().mark((function t(){return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",this._host.registerClientId(e));case 1:case"end":return t.stop()}}),t,this)})))}},{key:"warmupCheckGetClientInfoExists",value:function(){var e=this;this._getClientInfoExists||this._host.getClientInfo("fakeId",(function(){e._getClientInfoExists=!0}),[]).catch((function(t){t.message.includes("timed out")?(e._getClientInfoTriesRemaining--,e._getClientInfoTriesRemaining>0?e.warmupCheckGetClientInfoExists():console.warn("BackwardsCompatibilityHostDecorator.getClientInfo: will use getClientInfo polyfill")):e._getClientInfoExists=!0}))}},{key:"getRetrySchedule",value:function(){var e=this._totalTries-Math.max(0,this._getClientInfoTriesRemaining);return l.slice(0,e)}}]),e}();t.BackwardsCompatibilityHostDecorator=d},19280:function(e,t,n){"use strict";var r=n(38416).default,i=n(17061).default,o=n(56690).default,a=n(89728).default,s=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{u(r.next(e))}catch(t){o(t)}}function s(e){try{u(r.throw(e))}catch(t){o(t)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}u((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.ContainerSynchronizer=void 0;var u=n(55701),c=n(70489),l=function(){function e(t,n,r,i){o(this,e),this._runtime=t,this._containerRuntime=n,this._liveRuntime=r,this._objectStore=i,this._objects=new Map,this._connectedKeys=[],this._refCount=0,this.startListeningForConnected()}return a(e,[{key:"registerObject",value:function(e,t){if(this._objects.has(e))throw new Error("LiveObjectSynchronizer: too many calls to registerObject() for object '".concat(e,"'"));this._connectedKeys.push(e),this._objects.set(e,t),this._runtime.clientId&&this._runtime.clientId!==this._connectSentForClientId&&this.onConnected(this._runtime.clientId),0==this._refCount++&&this.startBackgroundObjectUpdates()}},{key:"unregisterObject",value:function(e){if(this._objects.has(e)){if(this._objects.delete(e),0==--this._refCount)return this.stopBackgroundObjectUpdates(),!0;this._connectedKeys=this._connectedKeys.filter((function(t){return t!=e}))}return!1}},{key:"onSendUpdates",value:function(){return s(this,void 0,void 0,i().mark((function e(){return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.sendGroupEvent(this._connectedKeys,u.ObjectSynchronizerEvents.update).catch((function(e){return console.error(e)}));case 2:case"end":return e.stop()}}),e,this)})))}},{key:"sendEventForObject",value:function(e,t){return s(this,void 0,void 0,i().mark((function n(){var o,a,s;return i().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(o=this._objects.get(e)){n.next=3;break}throw new Error("ContainerSynchronizer.sendEventForObject(): cannot send an event for an object that is not registered");case 3:return n.next=5,o.getLocalUserCanSend(!1);case 5:if(n.sent){n.next=8;break}throw new Error("The local user doesn't meet the app requirements to send a message for this object");case 8:return n.next=10,this.sendEventUpdates(r({},e,{data:t,timestamp:this._liveRuntime.getTimestamp()}),u.ObjectSynchronizerEvents.update);case 10:if(a=n.sent){n.next=13;break}throw new Error("Unable to send an event with empty updates");case 13:return s={clientId:a.clientId,timestamp:a.data[e].timestamp,name:a.name,data:a.data[e].data},n.abrupt("return",s);case 15:case"end":return n.stop()}}),n,this)})))}},{key:"__dangerouslySetContainerRuntime",value:function(e){this._containerRuntime!==e&&(this._containerRuntime=e)}},{key:"onConnected",value:function(e){return s(this,void 0,void 0,i().mark((function t(){return i().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e!==this._connectSentForClientId){t.next=2;break}return t.abrupt("return");case 2:return this._connectSentForClientId&&this._objectStore.clientIdDidChange(this._connectSentForClientId,e),this._connectSentForClientId=e,this._liveRuntime.host.registerClientId(e).catch((function(e){console.error(e)})),t.prev=5,t.next=8,this.sendGroupEvent(this._connectedKeys,u.ObjectSynchronizerEvents.connect);case 8:t.next=13;break;case 10:t.prev=10,t.t0=t.catch(5),console.error("LiveObjectSynchronizer: error sending update - ".concat(t.t0.toString()));case 13:case"end":return t.stop()}}),t,this,[[5,10]])})))}},{key:"sendEventUpdates",value:function(e,t){return s(this,void 0,void 0,i().mark((function n(){var r;return i().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(!(Object.keys(e).length>0)){n.next=11;break}return n.next=4,this.waitUntilConnected();case 4:return n.t0=n.sent,n.t1=e,n.t2=t===u.ObjectSynchronizerEvents.connect?0:this._liveRuntime.getTimestamp(),n.t3=t,r={clientId:n.t0,data:n.t1,timestamp:n.t2,name:n.t3},this._containerRuntime.submitSignal(t,r),n.abrupt("return",r);case 11:case"end":return n.stop()}}),n,this)})))}},{key:"sendGroupEvent",value:function(e,t){return s(this,void 0,void 0,i().mark((function n(){var r,o,a,s,c,l,d,h;return i().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return r=[],o={},n.next=4,this.waitUntilConnected();case 4:a=n.sent,s=0;case 6:if(!(s<e.length)){n.next=29;break}if(c=e[s],n.prev=8,l=this._objects.get(c),n.t0=l,!n.t0){n.next=15;break}return n.next=14,l.getLocalUserCanSend(t===u.ObjectSynchronizerEvents.connect);case 14:n.t0=n.sent;case 15:if(!n.t0){n.next=20;break}if("object"!=typeof(d=this._objectStore.getLatestEventForObjectClient(c,a))){n.next=20;break}return o[c]={data:d.data,timestamp:l.shouldUpdateTimestampPeriodically?this._liveRuntime.getTimestamp():t===u.ObjectSynchronizerEvents.connect?0:d.timestamp},n.abrupt("continue",26);case 20:n.next=25;break;case 22:n.prev=22,n.t1=n.catch(8),console.error("LiveObjectSynchronizer: error getting an objects state - ".concat(n.t1.toString()));case 25:r.push(c);case 26:s++,n.next=6;break;case 29:return h=Object.keys(o),n.next=32,this.sendEventUpdates(o,t);case 32:return n.abrupt("return",{sent:h,skipped:r});case 33:case"end":return n.stop()}}),n,this,[[8,22]])})))}},{key:"onReceiveUpdate",value:function(e,t,n,r){return s(this,void 0,void 0,i().mark((function o(){var a;return i().wrap((function(i){for(;;)switch(i.prev=i.next){case 0:if(a=this._objects.get(e)){i.next=3;break}return i.abrupt("return");case 3:return i.next=5,a.updateState(t,t.clientId,n);case 5:if(i.sent){i.next=8;break}return i.abrupt("return");case 8:return i.t0=r,i.t1=e,i.t2=Object,i.t3=Object.assign({},t),i.next=14,this.waitUntilConnected();case 14:i.t4=i.sent,i.t5={clientId:i.t4},i.t6=i.t2.assign.call(i.t2,i.t3,i.t5),(0,i.t0)(i.t1,i.t6);case 18:case"end":return i.stop()}}),o,this)})))}},{key:"waitUntilConnected",value:function(){return(0,c.waitUntilConnected)(this._runtime)}},{key:"startListeningForConnected",value:function(){this._onBoundConnectedListener&&this.stopListeningForConnected(),this._onBoundConnectedListener=this.onConnected.bind(this),this._runtime.on("connected",this._onBoundConnectedListener)}},{key:"stopListeningForConnected",value:function(){this._onBoundConnectedListener&&this._runtime.off("connected",this._onBoundConnectedListener)}},{key:"startBackgroundObjectUpdates",value:function(){this.stopBackgroundObjectUpdates(),this._onReceiveObjectUpdateListener=this.onReceiveUpdate.bind(this),this._objectStore.on(u.ObjectSynchronizerEvents.update,this._onReceiveObjectUpdateListener),this._onSendUpdatesIntervalCallback=this.onSendUpdates.bind(this),this._hTimer=setInterval(this._onSendUpdatesIntervalCallback,this._liveRuntime.objectManager.updateInterval)}},{key:"stopBackgroundObjectUpdates",value:function(){this._hTimer&&(clearInterval(this._hTimer),this._hTimer=void 0,this._onSendUpdatesIntervalCallback=void 0),this._onReceiveObjectUpdateListener&&(this._objectStore.off("update",this._onReceiveObjectUpdateListener),this._onReceiveObjectUpdateListener=void 0)}}]),e}();t.ContainerSynchronizer=l},89919:function(e,t,n){"use strict";var r=n(56690).default,i=n(89728).default;Object.defineProperty(t,"__esModule",{value:!0}),t.Deferred=void 0;var o=function(){function e(){var t=this;r(this,e),this._promise=new Promise((function(e,n){t._resolve=e,t._reject=n}))}return i(e,[{key:"promise",get:function(){return this._promise}},{key:"resolve",get:function(){return this._resolve}},{key:"reject",get:function(){return this._reject}}]),e}();t.Deferred=o},36516:function(e,t,n){"use strict";var r=n(861).default,i=n(17061).default,o=n(56690).default,a=n(89728).default,s=n(61655).default,u=n(26389).default,c=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{u(r.next(e))}catch(t){o(t)}}function s(e){try{u(r.throw(e))}catch(t){o(t)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}u((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.LiveObjectManager=void 0;var l=n(85681),d=n(24133),h=n(99299),f=function(e){s(n,e);var t=u(n);function n(e,r){var i;return o(this,n),(i=t.call(this))._liveRuntime=e,i._containerRuntime=r,i.objectStoreMap=new Map,i.updateInterval=1e4,i}return a(n,[{key:"start",value:function(){this.startReceivingSignalUpdates()}},{key:"stop",value:function(){this.stopReceivingSignalUpdates(),this.objectStoreMap.clear()}},{key:"registerObject",value:function(e,t,n,r){return c(this,void 0,void 0,i().mark((function o(){var a;return i().wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return this._synchronizer||(this._synchronizer=new h.ContainerSynchronizer(t,this._containerRuntime,this._liveRuntime,this)),this._synchronizer.registerObject(e,r),i.next=4,(0,h.waitUntilConnected)(t);case 4:i.t0=i.sent,i.t1=n,i.t2=h.ObjectSynchronizerEvents.update,a={clientId:i.t0,timestamp:0,data:i.t1,name:i.t2},this.updateEventLocallyInStore(e,a);case 9:case"end":return i.stop()}}),o,this)})))}},{key:"unregisterObject",value:function(e){this._synchronizer&&this._synchronizer.unregisterObject(e)}},{key:"getLatestEventForObject",value:function(e){var t;return null===(t=this.getEventsForObject(e))||void 0===t?void 0:t[0]}},{key:"getLatestEventForObjectClient",value:function(e,t){var n;return null===(n=this.objectStoreMap.get(e))||void 0===n?void 0:n.get(t)}},{key:"getEventsForObject",value:function(e){var t,n=this.objectStoreMap.get(e);if(n)return null===(t=r(n.values()))||void 0===t?void 0:t.sort((function(e,t){return t.timestamp-e.timestamp}))}},{key:"sendEventForObject",value:function(e,t){return c(this,void 0,void 0,i().mark((function n(){var r;return i().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(this._synchronizer){n.next=2;break}throw new Error("LiveObjectManager.sendEventForObject: cannot send the event");case 2:return n.next=4,this._synchronizer.sendEventForObject(e,t);case 4:return r=n.sent,this.updateEventLocallyInStore(e,r),n.abrupt("return",r);case 7:case"end":return n.stop()}}),n,this)})))}},{key:"clientIdDidChange",value:function(e,t){this.objectStoreMap.forEach((function(n){var r=n.get(e);r&&(n.set(t,r),n.delete(e))}))}},{key:"__dangerouslySetContainerRuntime",value:function(e){var t;this._containerRuntime!==e&&(this.stopReceivingSignalUpdates(),this._containerRuntime=e,this.startReceivingSignalUpdates(),null===(t=this._synchronizer)||void 0===t||t.__dangerouslySetContainerRuntime(e))}},{key:"setAudience",value:function(e){this._audience=e}},{key:"onReceivedSignal",value:function(e,t){var n;!t&&e.clientId&&(0,h.isILiveEvent)(e.content)&&"object"===typeof e.content.data&&(this.dispatchUpdates(h.ObjectSynchronizerEvents.update,e.clientId,e.content.data,t),e.type===h.ObjectSynchronizerEvents.connect&&(null===(n=this._synchronizer)||void 0===n||n.onSendUpdates()))}},{key:"dispatchUpdates",value:function(e,t,n,r){for(var i in n){var o=n[i],a={clientId:t,timestamp:o.timestamp,data:(0,h.cloneValue)(o.data),name:e};this.updateEventLocallyInStore(i,a)&&this.emit(h.ObjectSynchronizerEvents.update,i,(0,h.cloneValue)(a),r,this.updateEventLocallyInStore.bind(this))}}},{key:"updateEventLocallyInStore",value:function(e,t){var n=this.objectStoreMap.get(e);if(n){var r=n.get(t.clientId);if(r&&!d.LiveEvent.isNewer(r,t))return!1;n.set(t.clientId,t)}else(n=new Map).set(t.clientId,t),this.objectStoreMap.set(e,n);return!0}},{key:"startReceivingSignalUpdates",value:function(){this._onBoundReceivedSignalListener&&this.stopReceivingSignalUpdates(),this._onBoundReceivedSignalListener=this.onReceivedSignal.bind(this),this._containerRuntime.on("signal",this._onBoundReceivedSignalListener)}},{key:"stopReceivingSignalUpdates",value:function(){this._onBoundReceivedSignalListener&&this._containerRuntime.off("signal",this._onBoundReceivedSignalListener)}}]),n}(l.TypedEventEmitter);t.LiveObjectManager=f},80340:function(e,t,n){"use strict";var r=n(17061).default,i=n(56690).default,o=n(89728).default,a=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{u(r.next(e))}catch(t){o(t)}}function s(e){try{u(r.throw(e))}catch(t){o(t)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}u((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.LiveShareHostDecorator=void 0;var s=n(97152),u=n(78329),c=n(70489),l=[100,200,200,400,600],d=function(){function e(t){i(this,e),this._host=t,this._registerRequestCache=new s.RequestCache(4e3),this._userInfoRequestCache=new s.RequestCache(4e3)}return o(e,[{key:"getFluidTenantInfo",value:function(){return this._host.getFluidTenantInfo()}},{key:"getFluidToken",value:function(e){return this._host.getFluidToken(e)}},{key:"getFluidContainerId",value:function(){return this._host.getFluidContainerId()}},{key:"setFluidContainerId",value:function(e){return this._host.setFluidContainerId(e)}},{key:"getNtpTime",value:function(){return this._host.getNtpTime()}},{key:"getClientRoles",value:function(e){return a(this,void 0,void 0,r().mark((function t(){return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",this._host.getClientRoles(e));case 1:case"end":return t.stop()}}),t,this)})))}},{key:"getClientInfo",value:function(e,t,n){return a(this,void 0,void 0,r().mark((function i(){var o,s=this;return r().wrap((function(i){for(;;)switch(i.prev=i.next){case 0:if(e){i.next=2;break}throw new Error("LiveShareHostDecorator: called getClientInfo() without a clientId");case 2:return o=n?"".concat(e,"backwardsCompat"):e,i.abrupt("return",this._userInfoRequestCache.cacheRequest(o,(function(){return(0,c.waitForResult)((function(){return a(s,void 0,void 0,r().mark((function t(){return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this._host.getClientInfo(e);case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),t,this)})))}),(function(e){return(0,u.isIClientInfo)(e)?{response:e}:null}),(function(e){return new Error("LiveShareHostDecorator: getting client info for a remote client ID for reason: ".concat((0,u.isErrorLike)(e)?e.message:"unknown"))}),null!==n&&void 0!==n?n:l,(function(t){return"fakeId"===e?new Error((0,u.isErrorLike)(t)?t.message:"an unknown error occurred"):null}),t)})));case 4:case"end":return i.stop()}}),i,this)})))}},{key:"registerClientId",value:function(e){return a(this,void 0,void 0,r().mark((function t(){var n=this;return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",this._registerRequestCache.cacheRequest(e,(function(){return(0,c.waitForResult)((function(){return a(n,void 0,void 0,r().mark((function t(){return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this._host.registerClientId(e);case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),t,this)})))}),(function(e){return(0,u.isClientRolesResponse)(e)?{response:e}:(0,u.isMobileWorkaroundRolesResponse)(e)?{response:e.userRoles}:null}),(function(e){return new Error("LiveShareHostDecorator: registering local client ID for reason: ".concat((0,u.isErrorLike)(e)?e.message:"unknown"))}),l)})));case 1:case"end":return t.stop()}}),t,this)})))}}]),e}();t.LiveShareHostDecorator=d},38988:function(e,t,n){"use strict";var r=n(17061).default,i=n(56690).default,o=n(89728).default,a=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{u(r.next(e))}catch(t){o(t)}}function s(e){try{u(r.throw(e))}catch(t){o(t)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}u((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.LiveShareTokenProvider=void 0;var s=function(){function e(t){i(this,e),this._host=t}return o(e,[{key:"fetchOrdererToken",value:function(e,t,n){return a(this,void 0,void 0,r().mark((function i(){var o;return r().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,this.fetchFluidToken(e,t,n);case 2:return o=r.sent,r.abrupt("return",o);case 4:case"end":return r.stop()}}),i,this)})))}},{key:"fetchStorageToken",value:function(e,t,n){return a(this,void 0,void 0,r().mark((function i(){var o;return r().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,this.fetchFluidToken(e,t,n);case 2:return o=r.sent,r.abrupt("return",o);case 4:case"end":return r.stop()}}),i,this)})))}},{key:"fetchFluidToken",value:function(e,t,n){return a(this,void 0,void 0,r().mark((function i(){var o;return r().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(this._frsToken&&!n&&this._tenantId===e&&this._documentId===t){r.next=7;break}return r.next=3,this._host.getFluidToken(t);case 3:this._frsToken=r.sent,o=!1,r.next=8;break;case 7:o=!0;case 8:return this._tenantId=e,t&&(this._documentId=t),r.abrupt("return",{jwt:this._frsToken,fromCache:o});case 11:case"end":return r.stop()}}),i,this)})))}}]),e}();t.LiveShareTokenProvider=s},97152:function(e,t,n){"use strict";var r=n(56690).default,i=n(89728).default;Object.defineProperty(t,"__esModule",{value:!0}),t.RequestCache=void 0;var o=function(){function e(t){r(this,e),this._cache=new Map,this._cacheLifetime=t}return i(e,[{key:"cacheRequest",value:function(e,t){var n,r=(new Date).getTime();if(this._cache.has(e)&&r<(n=this._cache.get(e)).startTime+this._cacheLifetime)return n.promise;var i=t();return this._cache.set(e,{startTime:r,promise:i}),i}},{key:"has",value:function(e){return this._cache.has(e)}}]),e}();t.RequestCache=o},94243:function(e,t,n){"use strict";var r=n(17061).default,i=n(56690).default,o=n(89728).default,a=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{u(r.next(e))}catch(t){o(t)}}function s(e){try{u(r.throw(e))}catch(t){o(t)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}u((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.RoleVerifier=void 0;var s=function(){function e(t){i(this,e),this._host=t}return o(e,[{key:"verifyRolesAllowed",value:function(e,t){var n;return a(this,void 0,void 0,r().mark((function i(){var o,a,s,u;return r().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(e){r.next=2;break}throw new Error("RoleVerifier: called verifyRolesAllowed() without a clientId");case 2:if(!(Array.isArray(t)&&t.length>0)){r.next=16;break}return r.next=5,this._host.getClientInfo(e);case 5:o=r.sent,a=null!==(n=null===o||void 0===o?void 0:o.roles)&&void 0!==n?n:[],s=0;case 8:if(!(s<t.length)){r.next=15;break}if(u=t[s],!(a.indexOf(u)>=0)){r.next=12;break}return r.abrupt("return",!0);case 12:s++,r.next=8;break;case 15:return r.abrupt("return",!1);case 16:return r.abrupt("return",!0);case 17:case"end":return r.stop()}}),i,this)})))}}]),e}();t.RoleVerifier=s},55701:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ObjectSynchronizerEvents=t.TelemetryEvents=void 0,t.TelemetryEvents={LivePresence:{LocalPresenceChanged:"LivePresence:LocalPresenceChange",RemotePresenceChanged:"LivePresence:RemotePresenceChange",GetClientInfoError:"LivePresence:GetClientInfoError",RoleVerificationError:"LivePresence:RoleVerificationError"},LiveState:{StateChanged:"LiveState:StateChanged",RoleVerificationError:"LiveState:RoleVerificationError"}},t.ObjectSynchronizerEvents={update:"update",connect:"connect"}},99299:function(e,t,n){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n);var i=Object.getOwnPropertyDescriptor(t,n);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,r,i)}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),i=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||r(t,e,n)};Object.defineProperty(t,"__esModule",{value:!0}),i(n(55701),t),i(n(38988),t),i(n(97152),t),i(n(94243),t),i(n(70489),t),i(n(80340),t),i(n(18798),t),i(n(89919),t),i(n(78329),t),i(n(7603),t),i(n(36516),t),i(n(19280),t)},7603:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})},78329:function(e,t){"use strict";function n(e){return Array.isArray(e)&&e.every((function(e){return"string"===typeof e}))}Object.defineProperty(t,"__esModule",{value:!0}),t.isTimestampProvider=t.isILiveEvent=t.isErrorLike=t.isIClientInfo=t.isClientRolesResponse=t.isMobileWorkaroundRolesResponse=void 0,t.isMobileWorkaroundRolesResponse=function(e){return n(null===e||void 0===e?void 0:e.userRoles)},t.isClientRolesResponse=n,t.isIClientInfo=function(e){return void 0===e||void 0!==(null===e||void 0===e?void 0:e.userId)&&n(null===e||void 0===e?void 0:e.roles)},t.isErrorLike=function(e){return"string"===typeof(null===e||void 0===e?void 0:e.message)},t.isILiveEvent=function(e){return"object"===typeof e&&"string"===typeof e.clientId&&"number"===typeof e.timestamp&&"string"===typeof e.name},t.isTimestampProvider=function(e){return"function"===typeof(null===e||void 0===e?void 0:e.start)}},70489:function(e,t,n){"use strict";var r=n(17061).default,i=n(89728).default,o=n(56690).default,a=n(61655).default,s=n(26389).default,u=n(33496).default,c=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{u(r.next(e))}catch(t){o(t)}}function s(e){try{u(r.throw(e))}catch(t){o(t)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}u((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.waitUntilConnected=t.getInsecureTokenProvider=t.timeoutRequest=t.waitForResult=t.TimeoutError=t.waitForDelay=t.parseJwt=t.decodeBase64=t.cloneValue=void 0;var l=n(20527);function d(e){return"function"==typeof atob?atob(e):Buffer.from(e,"base64").toString()}t.cloneValue=function(e){return"object"==typeof e?JSON.parse(JSON.stringify(e)):e},t.decodeBase64=d;function h(e){return new Promise((function(t){setTimeout((function(){return t()}),e)}))}t.parseJwt=function(e){try{return JSON.parse(d(e.split(".")[1]))}catch(t){return null}},t.waitForDelay=h;var f=function(e){a(n,e);var t=s(n);function n(){return o(this,n),t.call(this,"timed out")}return i(n)}(u(Error));function p(e,t,n){var i=this;return new Promise((function(o,a){return c(i,void 0,void 0,r().mark((function i(){var s,u;return r().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return s=setTimeout((function(){a(new f),s=null}),t),r.prev=1,r.next=4,e();case 4:u=r.sent,o(u),null==s&&(null===n||void 0===n||n()),r.next=13;break;case 9:r.prev=9,r.t0=r.catch(1),a(r.t0),null==s&&(null===n||void 0===n||n());case 13:clearTimeout(s);case 14:case"end":return r.stop()}}),i,null,[[1,9]])})))}))}t.TimeoutError=f,t.waitForResult=function(e,t,n,i,o,a){var s=this,u=arguments.length>6&&void 0!==arguments[6]?arguments[6]:1e3,l=0;return new Promise((function(d,v){return c(s,void 0,void 0,r().mark((function s(){var c,g,m;return r().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.prev=1,r.next=4,p(e,Math.max(u*(l+1),3*u),a);case 4:if(c=r.sent,null===(g=t(c))){r.next=11;break}return d(g.response),r.abrupt("break",30);case 11:if(!(l>=i.length)){r.next=14;break}return v(new Error("waitForResult: invalid response")),r.abrupt("break",30);case 14:r.next=26;break;case 16:if(r.prev=16,r.t0=r.catch(1),!(l>=i.length)){r.next=21;break}return v(n(r.t0)),r.abrupt("break",30);case 21:if(!o||r.t0 instanceof f){r.next=26;break}if(null===(m=o(r.t0))){r.next=26;break}return v(m),r.abrupt("break",30);case 26:return r.next=28,h(i[l++]);case 28:r.next=0;break;case 30:case"end":return r.stop()}}),s,null,[[1,16]])})))}))},t.timeoutRequest=p,t.getInsecureTokenProvider=function(){var e,t;return c(this,void 0,void 0,r().mark((function i(){var o,a,s,u;return r().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.prev=0,r.next=3,n(70580);case 3:return o=r.sent,a=o.InsecureTokenProvider,s=null===(t=null===(e=new URL(window.location.href))||void 0===e?void 0:e.searchParams)||void 0===t?void 0:t.get("userId"),u=new a("",{id:null!==s&&void 0!==s?s:(0,l.v4)(),name:"Test User"}),r.abrupt("return",u);case 10:throw r.prev=10,r.t0=r.catch(0),new Error("@microsoft/live-share: when using 'local' connection type, you must have @fluidframework/test-client-utils installed");case 13:case"end":return r.stop()}}),i,null,[[0,10]])})))},t.waitUntilConnected=function(e){return new Promise((function(t){e.clientId?t(e.clientId):e.on("connected",(function n(r){e.off("connected",n),t(r)}))}))}},82918:function(e,t,n){"use strict";var r=n(89728).default,i=n(56690).default,o=n(94993).default,a=n(61655).default,s=n(26389).default,u=n(27424).default,c=this&&this.__setFunctionName||function(e,t,n){return"symbol"===typeof t&&(t=t.description?"[".concat(t.description,"]"):""),Object.defineProperty(e,"name",{configurable:!0,value:n?"".concat(n," ",t):t})};function l(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Map;if(!0===e.LiveEnabled){var u=e.TypeName,l=n.get(u);if(void 0!==l)return l;var d=function(e,t){var n,u=function(e){a(u,e);var n=s(u);function u(e){var r;if(i(this,u),(r=n.call(this,e)).__dangerouslySetLiveRuntime(t),!r.context||!r.context.containerRuntime)throw Error("getLiveDataObjectProxyClassInternal: required dependencies unknown");return!1===r.context.clientDetails.capabilities.interactive?o(r):(t.__dangerouslySetContainerRuntime(r.context.containerRuntime),r)}return r(u)}(e),l=(n=function(e){a(n,e);var t=s(n);function n(){return i(this,n),t.apply(this,arguments)}return r(n)}(e),c(n,"DynamicClass"),n.TypeName=e.TypeName,n.factory=new Proxy(e.factory,{get:function(e,t,n){return"ctor"===t?u:Reflect.get(e,t,n)}}),n);return l}(e,t);return n.set(u,d),d}return e}Object.defineProperty(t,"__esModule",{value:!0}),t.getLiveDataObjectClassProxy=t.getLiveShareContainerSchemaProxy=void 0,t.getLiveShareContainerSchemaProxy=function(e,t){var n,r=new Map,i=Object.entries(e.initialObjects).map((function(e){var n=u(e,2);return[n[0],l(n[1],t,r)]}));return{initialObjects:Object.fromEntries(i),dynamicObjectTypes:null===(n=e.dynamicObjectTypes)||void 0===n?void 0:n.map((function(e){return l(e,t,r)}))}},t.getLiveDataObjectClassProxy=l},20527:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"NIL",{enumerable:!0,get:function(){return s.default}}),Object.defineProperty(t,"parse",{enumerable:!0,get:function(){return d.default}}),Object.defineProperty(t,"stringify",{enumerable:!0,get:function(){return l.default}}),Object.defineProperty(t,"v1",{enumerable:!0,get:function(){return r.default}}),Object.defineProperty(t,"v3",{enumerable:!0,get:function(){return i.default}}),Object.defineProperty(t,"v4",{enumerable:!0,get:function(){return o.default}}),Object.defineProperty(t,"v5",{enumerable:!0,get:function(){return a.default}}),Object.defineProperty(t,"validate",{enumerable:!0,get:function(){return c.default}}),Object.defineProperty(t,"version",{enumerable:!0,get:function(){return u.default}});var r=h(n(94194)),i=h(n(62298)),o=h(n(39849)),a=h(n(79985)),s=h(n(61891)),u=h(n(95908)),c=h(n(51295)),l=h(n(92090)),d=h(n(18094));function h(e){return e&&e.__esModule?e:{default:e}}},51936:function(e,t){"use strict";function n(e){return 14+(e+64>>>9<<4)+1}function r(e,t){var n=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(n>>16)<<16|65535&n}function i(e,t,n,i,o,a){return r((s=r(r(t,e),r(i,a)))<<(u=o)|s>>>32-u,n);var s,u}function o(e,t,n,r,o,a,s){return i(t&n|~t&r,e,t,o,a,s)}function a(e,t,n,r,o,a,s){return i(t&r|n&~r,e,t,o,a,s)}function s(e,t,n,r,o,a,s){return i(t^n^r,e,t,o,a,s)}function u(e,t,n,r,o,a,s){return i(n^(t|~r),e,t,o,a,s)}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var c=function(e){if("string"===typeof e){var t=unescape(encodeURIComponent(e));e=new Uint8Array(t.length);for(var i=0;i<t.length;++i)e[i]=t.charCodeAt(i)}return function(e){for(var t=[],n=32*e.length,r="0123456789abcdef",i=0;i<n;i+=8){var o=e[i>>5]>>>i%32&255,a=parseInt(r.charAt(o>>>4&15)+r.charAt(15&o),16);t.push(a)}return t}(function(e,t){e[t>>5]|=128<<t%32,e[n(t)-1]=t;for(var i=1732584193,c=-271733879,l=-1732584194,d=271733878,h=0;h<e.length;h+=16){var f=i,p=c,v=l,g=d;i=o(i,c,l,d,e[h],7,-680876936),d=o(d,i,c,l,e[h+1],12,-389564586),l=o(l,d,i,c,e[h+2],17,606105819),c=o(c,l,d,i,e[h+3],22,-1044525330),i=o(i,c,l,d,e[h+4],7,-176418897),d=o(d,i,c,l,e[h+5],12,1200080426),l=o(l,d,i,c,e[h+6],17,-1473231341),c=o(c,l,d,i,e[h+7],22,-45705983),i=o(i,c,l,d,e[h+8],7,1770035416),d=o(d,i,c,l,e[h+9],12,-1958414417),l=o(l,d,i,c,e[h+10],17,-42063),c=o(c,l,d,i,e[h+11],22,-1990404162),i=o(i,c,l,d,e[h+12],7,1804603682),d=o(d,i,c,l,e[h+13],12,-40341101),l=o(l,d,i,c,e[h+14],17,-1502002290),i=a(i,c=o(c,l,d,i,e[h+15],22,1236535329),l,d,e[h+1],5,-165796510),d=a(d,i,c,l,e[h+6],9,-1069501632),l=a(l,d,i,c,e[h+11],14,643717713),c=a(c,l,d,i,e[h],20,-373897302),i=a(i,c,l,d,e[h+5],5,-701558691),d=a(d,i,c,l,e[h+10],9,38016083),l=a(l,d,i,c,e[h+15],14,-660478335),c=a(c,l,d,i,e[h+4],20,-405537848),i=a(i,c,l,d,e[h+9],5,568446438),d=a(d,i,c,l,e[h+14],9,-1019803690),l=a(l,d,i,c,e[h+3],14,-187363961),c=a(c,l,d,i,e[h+8],20,1163531501),i=a(i,c,l,d,e[h+13],5,-1444681467),d=a(d,i,c,l,e[h+2],9,-51403784),l=a(l,d,i,c,e[h+7],14,1735328473),i=s(i,c=a(c,l,d,i,e[h+12],20,-1926607734),l,d,e[h+5],4,-378558),d=s(d,i,c,l,e[h+8],11,-2022574463),l=s(l,d,i,c,e[h+11],16,1839030562),c=s(c,l,d,i,e[h+14],23,-35309556),i=s(i,c,l,d,e[h+1],4,-1530992060),d=s(d,i,c,l,e[h+4],11,1272893353),l=s(l,d,i,c,e[h+7],16,-155497632),c=s(c,l,d,i,e[h+10],23,-1094730640),i=s(i,c,l,d,e[h+13],4,681279174),d=s(d,i,c,l,e[h],11,-358537222),l=s(l,d,i,c,e[h+3],16,-722521979),c=s(c,l,d,i,e[h+6],23,76029189),i=s(i,c,l,d,e[h+9],4,-640364487),d=s(d,i,c,l,e[h+12],11,-421815835),l=s(l,d,i,c,e[h+15],16,530742520),i=u(i,c=s(c,l,d,i,e[h+2],23,-995338651),l,d,e[h],6,-198630844),d=u(d,i,c,l,e[h+7],10,1126891415),l=u(l,d,i,c,e[h+14],15,-1416354905),c=u(c,l,d,i,e[h+5],21,-57434055),i=u(i,c,l,d,e[h+12],6,1700485571),d=u(d,i,c,l,e[h+3],10,-1894986606),l=u(l,d,i,c,e[h+10],15,-1051523),c=u(c,l,d,i,e[h+1],21,-2054922799),i=u(i,c,l,d,e[h+8],6,1873313359),d=u(d,i,c,l,e[h+15],10,-30611744),l=u(l,d,i,c,e[h+6],15,-1560198380),c=u(c,l,d,i,e[h+13],21,1309151649),i=u(i,c,l,d,e[h+4],6,-145523070),d=u(d,i,c,l,e[h+11],10,-1120210379),l=u(l,d,i,c,e[h+2],15,718787259),c=u(c,l,d,i,e[h+9],21,-343485551),i=r(i,f),c=r(c,p),l=r(l,v),d=r(d,g)}return[i,c,l,d]}(function(e){if(0===e.length)return[];for(var t=8*e.length,r=new Uint32Array(n(t)),i=0;i<t;i+=8)r[i>>5]|=(255&e[i/8])<<i%32;return r}(e),8*e.length))};t.default=c},34053:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n={randomUUID:"undefined"!==typeof crypto&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)};t.default=n},61891:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;t.default="00000000-0000-0000-0000-000000000000"},18094:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r,i=(r=n(51295))&&r.__esModule?r:{default:r};var o=function(e){if(!(0,i.default)(e))throw TypeError("Invalid UUID");var t,n=new Uint8Array(16);return n[0]=(t=parseInt(e.slice(0,8),16))>>>24,n[1]=t>>>16&255,n[2]=t>>>8&255,n[3]=255&t,n[4]=(t=parseInt(e.slice(9,13),16))>>>8,n[5]=255&t,n[6]=(t=parseInt(e.slice(14,18),16))>>>8,n[7]=255&t,n[8]=(t=parseInt(e.slice(19,23),16))>>>8,n[9]=255&t,n[10]=(t=parseInt(e.slice(24,36),16))/1099511627776&255,n[11]=t/4294967296&255,n[12]=t>>>24&255,n[13]=t>>>16&255,n[14]=t>>>8&255,n[15]=255&t,n};t.default=o},31460:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;t.default=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i},45055:function(e,t){"use strict";var n;Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){if(!n&&!(n="undefined"!==typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return n(r)};var r=new Uint8Array(16)},17926:function(e,t){"use strict";function n(e,t,n,r){switch(e){case 0:return t&n^~t&r;case 1:case 3:return t^n^r;case 2:return t&n^t&r^n&r}}function r(e,t){return e<<t|e>>>32-t}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=function(e){var t=[1518500249,1859775393,2400959708,3395469782],i=[1732584193,4023233417,2562383102,271733878,3285377520];if("string"===typeof e){var o=unescape(encodeURIComponent(e));e=[];for(var a=0;a<o.length;++a)e.push(o.charCodeAt(a))}else Array.isArray(e)||(e=Array.prototype.slice.call(e));e.push(128);for(var s=e.length/4+2,u=Math.ceil(s/16),c=new Array(u),l=0;l<u;++l){for(var d=new Uint32Array(16),h=0;h<16;++h)d[h]=e[64*l+4*h]<<24|e[64*l+4*h+1]<<16|e[64*l+4*h+2]<<8|e[64*l+4*h+3];c[l]=d}c[u-1][14]=8*(e.length-1)/Math.pow(2,32),c[u-1][14]=Math.floor(c[u-1][14]),c[u-1][15]=8*(e.length-1)&4294967295;for(var f=0;f<u;++f){for(var p=new Uint32Array(80),v=0;v<16;++v)p[v]=c[f][v];for(var g=16;g<80;++g)p[g]=r(p[g-3]^p[g-8]^p[g-14]^p[g-16],1);for(var m=i[0],y=i[1],b=i[2],w=i[3],S=i[4],k=0;k<80;++k){var C=Math.floor(k/20),x=r(m,5)+n(C,y,b,w)+S+t[C]+p[k]>>>0;S=w,w=b,b=r(y,30)>>>0,y=m,m=x}i[0]=i[0]+m>>>0,i[1]=i[1]+y>>>0,i[2]=i[2]+b>>>0,i[3]=i[3]+w>>>0,i[4]=i[4]+S>>>0}return[i[0]>>24&255,i[0]>>16&255,i[0]>>8&255,255&i[0],i[1]>>24&255,i[1]>>16&255,i[1]>>8&255,255&i[1],i[2]>>24&255,i[2]>>16&255,i[2]>>8&255,255&i[2],i[3]>>24&255,i[3]>>16&255,i[3]>>8&255,255&i[3],i[4]>>24&255,i[4]>>16&255,i[4]>>8&255,255&i[4]]};t.default=i},92090:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,t.unsafeStringify=s;var r,i=(r=n(51295))&&r.__esModule?r:{default:r};for(var o=[],a=0;a<256;++a)o.push((a+256).toString(16).slice(1));function s(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return(o[e[t+0]]+o[e[t+1]]+o[e[t+2]]+o[e[t+3]]+"-"+o[e[t+4]]+o[e[t+5]]+"-"+o[e[t+6]]+o[e[t+7]]+"-"+o[e[t+8]]+o[e[t+9]]+"-"+o[e[t+10]]+o[e[t+11]]+o[e[t+12]]+o[e[t+13]]+o[e[t+14]]+o[e[t+15]]).toLowerCase()}var u=function(e){var t=s(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0);if(!(0,i.default)(t))throw TypeError("Stringified UUID is invalid");return t};t.default=u},94194:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r,i,o,a=(r=n(45055))&&r.__esModule?r:{default:r},s=n(92090);var u=0,c=0;var l=function(e,t,n){var r=t&&n||0,l=t||new Array(16),d=(e=e||{}).node||i,h=void 0!==e.clockseq?e.clockseq:o;if(null==d||null==h){var f=e.random||(e.rng||a.default)();null==d&&(d=i=[1|f[0],f[1],f[2],f[3],f[4],f[5]]),null==h&&(h=o=16383&(f[6]<<8|f[7]))}var p=void 0!==e.msecs?e.msecs:Date.now(),v=void 0!==e.nsecs?e.nsecs:c+1,g=p-u+(v-c)/1e4;if(g<0&&void 0===e.clockseq&&(h=h+1&16383),(g<0||p>u)&&void 0===e.nsecs&&(v=0),v>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");u=p,c=v,o=h;var m=(1e4*(268435455&(p+=122192928e5))+v)%4294967296;l[r++]=m>>>24&255,l[r++]=m>>>16&255,l[r++]=m>>>8&255,l[r++]=255&m;var y=p/4294967296*1e4&268435455;l[r++]=y>>>8&255,l[r++]=255&y,l[r++]=y>>>24&15|16,l[r++]=y>>>16&255,l[r++]=h>>>8|128,l[r++]=255&h;for(var b=0;b<6;++b)l[r+b]=d[b];return t||(0,s.unsafeStringify)(l)};t.default=l},62298:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=o(n(32023)),i=o(n(51936));function o(e){return e&&e.__esModule?e:{default:e}}var a=(0,r.default)("v3",48,i.default);t.default=a},32023:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.URL=t.DNS=void 0,t.default=function(e,t,n){function r(e,r,a,s){var u;if("string"===typeof e&&(e=function(e){e=unescape(encodeURIComponent(e));for(var t=[],n=0;n<e.length;++n)t.push(e.charCodeAt(n));return t}(e)),"string"===typeof r&&(r=(0,o.default)(r)),16!==(null===(u=r)||void 0===u?void 0:u.length))throw TypeError("Namespace must be array-like (16 iterable integer values, 0-255)");var c=new Uint8Array(16+e.length);if(c.set(r),c.set(e,r.length),(c=n(c))[6]=15&c[6]|t,c[8]=63&c[8]|128,a){s=s||0;for(var l=0;l<16;++l)a[s+l]=c[l];return a}return(0,i.unsafeStringify)(c)}try{r.name=e}catch(u){}return r.DNS=a,r.URL=s,r};var r,i=n(92090),o=(r=n(18094))&&r.__esModule?r:{default:r};var a="6ba7b810-9dad-11d1-80b4-00c04fd430c8";t.DNS=a;var s="6ba7b811-9dad-11d1-80b4-00c04fd430c8";t.URL=s},39849:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=a(n(34053)),i=a(n(45055)),o=n(92090);function a(e){return e&&e.__esModule?e:{default:e}}var s=function(e,t,n){if(r.default.randomUUID&&!t&&!e)return r.default.randomUUID();var a=(e=e||{}).random||(e.rng||i.default)();if(a[6]=15&a[6]|64,a[8]=63&a[8]|128,t){n=n||0;for(var s=0;s<16;++s)t[n+s]=a[s];return t}return(0,o.unsafeStringify)(a)};t.default=s},79985:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=o(n(32023)),i=o(n(17926));function o(e){return e&&e.__esModule?e:{default:e}}var a=(0,r.default)("v5",80,i.default);t.default=a},51295:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r,i=(r=n(31460))&&r.__esModule?r:{default:r};var o=function(e){return"string"===typeof e&&i.default.test(e)};t.default=o},95908:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r,i=(r=n(51295))&&r.__esModule?r:{default:r};var o=function(e){if(!(0,i.default)(e))throw TypeError("Invalid UUID");return parseInt(e.slice(14,15),16)};t.default=o},9069:function(e,t,n){var r=n(861).default;"undefined"!=typeof self&&self,e.exports=function(){var e={302:function(e,t,n){t.formatArgs=function(t){if(t[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+t[0]+(this.useColors?"%c ":" ")+"+"+e.exports.humanize(this.diff),this.useColors){var n="color: "+this.color;t.splice(1,0,n,"color: inherit");var r=0,i=0;t[0].replace(/%[a-zA-Z%]/g,(function(e){"%%"!==e&&(r++,"%c"===e&&(i=r))})),t.splice(i,0,n)}},t.save=function(e){try{e?t.storage.setItem("debug",e):t.storage.removeItem("debug")}catch(e){}},t.load=function(){var e;try{e=t.storage.getItem("debug")}catch(e){}return!e&&"undefined"!=typeof process&&"env"in process&&(e={NODE_ENV:"production",PUBLIC_URL:".",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0,REACT_APP_CLIENT_ID:"69d2d73f-7402-4632-9876-6dd3a1891bde",REACT_APP_START_LOGIN_PAGE_URL:"https://m365tab111aef.z33.web.core.windows.net/auth-start.html"}.DEBUG),e},t.useColors=function(){return!("undefined"==typeof window||!window.process||"renderer"!==window.process.type&&!window.process.__nwjs)||("undefined"==typeof navigator||!navigator.userAgent||!navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))&&("undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/))},t.storage=function(){try{return localStorage}catch(e){}}(),t.destroy=function(){var e=!1;return function(){e||(e=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}}(),t.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],t.log=console.debug||console.log||function(){},e.exports=n(65)(t),e.exports.formatters.j=function(e){try{return JSON.stringify(e)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}}},65:function(e,t,n){e.exports=function(e){function t(e){var n,r,o,a=null;function s(){for(var e=arguments.length,r=new Array(e),i=0;i<e;i++)r[i]=arguments[i];if(s.enabled){var o=s,a=Number(new Date),u=a-(n||a);o.diff=u,o.prev=n,o.curr=a,n=a,r[0]=t.coerce(r[0]),"string"!=typeof r[0]&&r.unshift("%O");var c=0;r[0]=r[0].replace(/%([a-zA-Z%])/g,(function(e,n){if("%%"===e)return"%";c++;var i=t.formatters[n];if("function"==typeof i){var a=r[c];e=i.call(o,a),r.splice(c,1),c--}return e})),t.formatArgs.call(o,r),(o.log||t.log).apply(o,r)}}return s.namespace=e,s.useColors=t.useColors(),s.color=t.selectColor(e),s.extend=i,s.destroy=t.destroy,Object.defineProperty(s,"enabled",{enumerable:!0,configurable:!1,get:function(){return null!==a?a:(r!==t.namespaces&&(r=t.namespaces,o=t.enabled(e)),o)},set:function(e){a=e}}),"function"==typeof t.init&&t.init(s),s}function i(e,n){var r=t(this.namespace+(void 0===n?":":n)+e);return r.log=this.log,r}function o(e){return e.toString().substring(2,e.toString().length-2).replace(/\.\*\?$/,"*")}return t.debug=t,t.default=t,t.coerce=function(e){return e instanceof Error?e.stack||e.message:e},t.disable=function(){var e=[].concat(r(t.names.map(o)),r(t.skips.map(o).map((function(e){return"-"+e})))).join(",");return t.enable(""),e},t.enable=function(e){var n;t.save(e),t.namespaces=e,t.names=[],t.skips=[];var r=("string"==typeof e?e:"").split(/[\s,]+/),i=r.length;for(n=0;n<i;n++)r[n]&&("-"===(e=r[n].replace(/\*/g,".*?"))[0]?t.skips.push(new RegExp("^"+e.slice(1)+"$")):t.names.push(new RegExp("^"+e+"$")))},t.enabled=function(e){if("*"===e[e.length-1])return!0;var n,r;for(n=0,r=t.skips.length;n<r;n++)if(t.skips[n].test(e))return!1;for(n=0,r=t.names.length;n<r;n++)if(t.names[n].test(e))return!0;return!1},t.humanize=n(247),t.destroy=function(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")},Object.keys(e).forEach((function(n){t[n]=e[n]})),t.names=[],t.skips=[],t.formatters={},t.selectColor=function(e){for(var n=0,r=0;r<e.length;r++)n=(n<<5)-n+e.charCodeAt(r),n|=0;return t.colors[Math.abs(n)%t.colors.length]},t.enable(t.load()),t}},247:function(e){var t=1e3,n=60*t,r=60*n,i=24*r,o=7*i,a=365.25*i;function s(e){if(!((e=String(e)).length>100)){var s=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(e);if(s){var u=parseFloat(s[1]);switch((s[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return u*a;case"weeks":case"week":case"w":return u*o;case"days":case"day":case"d":return u*i;case"hours":case"hour":case"hrs":case"hr":case"h":return u*r;case"minutes":case"minute":case"mins":case"min":case"m":return u*n;case"seconds":case"second":case"secs":case"sec":case"s":return u*t;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return u;default:return}}}}function u(e){var o=Math.abs(e);return o>=i?Math.round(e/i)+"d":o>=r?Math.round(e/r)+"h":o>=n?Math.round(e/n)+"m":o>=t?Math.round(e/t)+"s":e+"ms"}function c(e){var o=Math.abs(e);return o>=i?l(e,o,i,"day"):o>=r?l(e,o,r,"hour"):o>=n?l(e,o,n,"minute"):o>=t?l(e,o,t,"second"):e+" ms"}function l(e,t,n,r){var i=t>=1.5*n;return Math.round(e/n)+" "+r+(i?"s":"")}e.exports=function(e,t){t=t||{};var n=typeof e;if("string"===n&&e.length>0)return s(e);if("number"===n&&isFinite(e))return t.long?c(e):u(e);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(e))}}},t={};function n(r){var i=t[r];if(void 0!==i)return i.exports;var o=t[r]={exports:{}};return e[r](o,o.exports,n),o.exports}n.d=function(e,t){for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var i={};return function(){"use strict";n.r(i),n.d(i,{ActionObjectType:function(){return P},ChannelType:function(){return U},ChildAppWindow:function(){return Pn},DialogDimension:function(){return q},ErrorCode:function(){return O},FileOpenPreference:function(){return _},FrameContexts:function(){return D},HostClientType:function(){return F},HostName:function(){return Z},LiveShareHost:function(){return Hr},NotificationTypes:function(){return Tt},ParentAppWindow:function(){return Nn},SecondaryM365ContentIdName:function(){return N},TaskModuleDimension:function(){return H},TeamType:function(){return L},UserSettingTypes:function(){return At},UserTeamRole:function(){return B},ViewerActionTypes:function(){return It},app:function(){return Ee},appEntity:function(){return li},appInitialization:function(){return lr},appInstallDialog:function(){return zt},appNotification:function(){return Vt},authentication:function(){return Se},barCode:function(){return hn},calendar:function(){return Fn},call:function(){return cr},chat:function(){return fn},conversations:function(){return Rt},dialog:function(){return ke},enablePrintCapability:function(){return mr},executeDeepLink:function(){return Or},files:function(){return ai},geoLocation:function(){return pn},getAdaptiveCardSchemaVersion:function(){return An},getContext:function(){return br},getMruTabInstances:function(){return Pr},getTabInstances:function(){return _r},initialize:function(){return gr},initializeWithFrameContext:function(){return Fr},liveShare:function(){return jr},location:function(){return _n},logs:function(){return Et},mail:function(){return Zn},marketplace:function(){return oi},media:function(){return dn},meeting:function(){return On},meetingRoom:function(){return si},menus:function(){return Ce},monetization:function(){return Mn},navigateBack:function(){return Br},navigateCrossDomain:function(){return Lr},navigateToTab:function(){return Dr},notifications:function(){return ui},openFilePreview:function(){return Ht},pages:function(){return Te},people:function(){return Dn},print:function(){return yr},profile:function(){return Ln},registerAppButtonClickHandler:function(){return kr},registerAppButtonHoverEnterHandler:function(){return Cr},registerAppButtonHoverLeaveHandler:function(){return xr},registerBackButtonHandler:function(){return Er},registerBeforeUnloadHandler:function(){return Ir},registerChangeSettingsHandler:function(){return Rr},registerCustomHandler:function(){return jt},registerFocusEnterHandler:function(){return Ar},registerFullScreenHandler:function(){return Sr},registerOnLoadHandler:function(){return Tr},registerOnThemeChangeHandler:function(){return wr},registerUserSettingsChangeHandler:function(){return Ut},remoteCamera:function(){return ci},returnFocus:function(){return Zr},search:function(){return or},secondaryBrowser:function(){return Rn},sendCustomEvent:function(){return qt},sendCustomMessage:function(){return Bt},setFrameContext:function(){return Mr},settings:function(){return dr},shareDeepLink:function(){return Nr},sharing:function(){return ar},stageView:function(){return sr},tasks:function(){return qr},teams:function(){return di},teamsCore:function(){return xe},uploadCustomApp:function(){return Lt},version:function(){return Ie},video:function(){return ir},videoEx:function(){return fi},webStorage:function(){return ur}});var e="2.0.1",t="2.0.2",r="2.0.3",o="2.0.4",a="2.0.1",s="1.9.0",u="2.0.0",c="1.7.0",l="1.8.0",d="1.9.0",h=["teams.microsoft.com","teams.microsoft.us","gov.teams.microsoft.us","dod.teams.microsoft.us","int.teams.microsoft.com","teams.live.com","devspaces.skype.com","ssauth.skype.com","local.teams.live.com","local.teams.live.com:8080","local.teams.office.com","local.teams.office.com:8080","outlook.office.com","outlook-sdf.office.com","outlook.office365.com","outlook-sdf.office365.com","outlook.live.com","outlook-sdf.live.com","*.teams.microsoft.com","*.www.office.com","www.office.com","word.office.com","excel.office.com","powerpoint.office.com","www.officeppe.com","*.www.microsoft365.com","www.microsoft365.com"],f=/^https:\/\//,p="https",v="teams.microsoft.com",g="The library has not yet been initialized",m="The runtime has not yet been initialized",y="The runtime version is not supported",b="The call was not properly started",w=function(){function e(){}return e.initializeCalled=!1,e.initializeCompleted=!1,e.additionalValidOrigins=[],e.isFramelessWindow=!1,e.printCapabilityEnabled=!1,e}(),S=(0,n(302).debug)("teamsJs");function k(e){return S.extend(e)}var C,x={randomUUID:"undefined"!=typeof crypto&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)},E=new Uint8Array(16);function T(){if(!C&&!(C="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return C(E)}for(var I=[],A=0;A<256;++A)I.push((A+256).toString(16).slice(1));function R(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return(I[e[t+0]]+I[e[t+1]]+I[e[t+2]]+I[e[t+3]]+"-"+I[e[t+4]]+I[e[t+5]]+"-"+I[e[t+6]]+I[e[t+7]]+"-"+I[e[t+8]]+I[e[t+9]]+"-"+I[e[t+10]]+I[e[t+11]]+I[e[t+12]]+I[e[t+13]]+I[e[t+14]]+I[e[t+15]]).toLowerCase()}var _,P,N,O,M,F,Z,D,L,B,q,j=function(e,t,n){if(x.randomUUID&&!t&&!e)return x.randomUUID();var r=(e=e||{}).random||(e.rng||T)();if(r[6]=15&r[6]|64,r[8]=63&r[8]|128,t){n=n||0;for(var i=0;i<16;++i)t[n+i]=r[i];return t}return R(r)};!function(e){e.Inline="inline",e.Desktop="desktop",e.Web="web"}(_||(_={})),function(e){e.M365Content="m365content"}(P||(P={})),function(e){e.DriveId="driveId",e.GroupId="groupId",e.SiteId="siteId",e.UserId="userId"}(N||(N={})),function(e){e[e.NOT_SUPPORTED_ON_PLATFORM=100]="NOT_SUPPORTED_ON_PLATFORM",e[e.INTERNAL_ERROR=500]="INTERNAL_ERROR",e[e.NOT_SUPPORTED_IN_CURRENT_CONTEXT=501]="NOT_SUPPORTED_IN_CURRENT_CONTEXT",e[e.PERMISSION_DENIED=1e3]="PERMISSION_DENIED",e[e.NETWORK_ERROR=2e3]="NETWORK_ERROR",e[e.NO_HW_SUPPORT=3e3]="NO_HW_SUPPORT",e[e.INVALID_ARGUMENTS=4e3]="INVALID_ARGUMENTS",e[e.UNAUTHORIZED_USER_OPERATION=5e3]="UNAUTHORIZED_USER_OPERATION",e[e.INSUFFICIENT_RESOURCES=6e3]="INSUFFICIENT_RESOURCES",e[e.THROTTLE=7e3]="THROTTLE",e[e.USER_ABORT=8e3]="USER_ABORT",e[e.OPERATION_TIMED_OUT=8001]="OPERATION_TIMED_OUT",e[e.OLD_PLATFORM=9e3]="OLD_PLATFORM",e[e.FILE_NOT_FOUND=404]="FILE_NOT_FOUND",e[e.SIZE_EXCEEDED=1e4]="SIZE_EXCEEDED"}(O||(O={})),function(e){e.GeoLocation="geolocation",e.Media="media"}(M||(M={})),function(e){e.desktop="desktop",e.web="web",e.android="android",e.ios="ios",e.ipados="ipados",e.rigel="rigel",e.surfaceHub="surfaceHub",e.teamsRoomsWindows="teamsRoomsWindows",e.teamsRoomsAndroid="teamsRoomsAndroid",e.teamsPhones="teamsPhones",e.teamsDisplays="teamsDisplays"}(F||(F={})),function(e){e.office="Office",e.outlook="Outlook",e.outlookWin32="OutlookWin32",e.orange="Orange",e.teams="Teams",e.teamsModern="TeamsModern"}(Z||(Z={})),function(e){e.settings="settings",e.content="content",e.authentication="authentication",e.remove="remove",e.task="task",e.sidePanel="sidePanel",e.stage="stage",e.meetingStage="meetingStage"}(D||(D={})),function(e){e[e.Standard=0]="Standard",e[e.Edu=1]="Edu",e[e.Class=2]="Class",e[e.Plc=3]="Plc",e[e.Staff=4]="Staff"}(L||(L={})),function(e){e[e.Admin=0]="Admin",e[e.User=1]="User",e[e.Guest=2]="Guest"}(B||(B={})),function(e){e.Large="large",e.Medium="medium",e.Small="small"}(q||(q={}));var U,H=q;!function(e){e.Regular="Regular",e.Private="Private",e.Shared="Shared"}(U||(U={}));var z={errorCode:O.NOT_SUPPORTED_ON_PLATFORM},V={majorVersion:1,minorVersion:5},G={adaptiveCardSchemaVersion:{majorVersion:1,minorVersion:5}};function K(e,t){if("*."===e.substring(0,2)){var n=e.substring(1);if(t.length>n.length&&t.split(".").length===n.split(".").length&&t.substring(t.length-n.length)===n)return!0}else if(e===t)return!0;return!1}function W(e){if(!oe(e))return!1;var t=e.host;if(h.some((function(e){return K(e,t)})))return!0;for(var n=0,r=w.additionalValidOrigins;n<r.length;n++){var i=r[n];if(K("https://"===i.substring(0,8)?i.substring(8):i,t))return!0}return!1}function J(e){return function(t,n){if(!t)throw new Error(e||n)}}function Q(e,t){if("string"!=typeof e||"string"!=typeof t)return NaN;var n=e.split("."),r=t.split(".");function i(e){return/^\d+$/.test(e)}if(!n.every(i)||!r.every(i))return NaN;for(;n.length<r.length;)n.push("0");for(;r.length<n.length;)r.push("0");for(var o=0;o<n.length;++o)if(Number(n[o])!=Number(r[o]))return Number(n[o])>Number(r[o])?1:-1;return 0}function Y(){return j()}function X(e){return Object.keys(e).forEach((function(t){"object"==typeof e[t]&&X(e[t])})),Object.freeze(e)}function $(e,t){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];var i=e.apply(void 0,n);return i.then((function(e){t&&t(void 0,e)})).catch((function(e){t&&t(e)})),i}function ee(e,t){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];var i=e.apply(void 0,n);return i.then((function(){t&&t(null)})).catch((function(e){t&&t(e)})),i}function te(e,t){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];var i=e.apply(void 0,n);return i.then((function(e){t&&t(null,e)})).catch((function(e){t&&t(e,null)})),i}function ne(e,t,n){return new Promise((function(r,i){var o=setTimeout(i,t,n);e().then((function(e){clearTimeout(o),r(e)})).catch((function(e){clearTimeout(o),i(e)}))}))}function re(e){var t=new URL("https://teams.microsoft.com/l/entity/"+encodeURIComponent(e.appId)+"/"+encodeURIComponent(e.pageId));return e.webUrl&&t.searchParams.append("webUrl",e.webUrl),(e.channelId||e.subPageId)&&t.searchParams.append("context",JSON.stringify({channelId:e.channelId,subEntityId:e.subPageId})),t.toString()}function ie(e){return!(Q("".concat(e.majorVersion,".").concat(e.minorVersion),"".concat(V.majorVersion,".").concat(V.minorVersion))>=0)}function oe(e){return"https:"===e.protocol}var ae=function(){return ae=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},ae.apply(this,arguments)},se=k("runtime"),ue=2;function ce(e){return e.apiVersion===ue}function le(e){if(ce(e))return!0;throw-1===e.apiVersion?new Error(m):new Error(y)}var de={apiVersion:-1,supports:{}},he={apiVersion:2,hostVersionsInfo:G,isLegacyTeams:!0,supports:{appInstallDialog:{},appEntity:{},call:{},chat:{},conversations:{},dialog:{card:{bot:{}},url:{bot:{}},update:{}},interactive:{},logs:{},meetingRoom:{},menus:{},monetization:{},notifications:{},pages:{appButton:{},tabs:{},config:{},backStack:{},fullTrust:{}},remoteCamera:{},stageView:{},teams:{fullTrust:{}},teamsCore:{},video:{sharedFrame:{}}}},fe=[F.desktop,F.web,F.android,F.ios,F.rigel,F.surfaceHub,F.teamsRoomsWindows,F.teamsRoomsAndroid,F.teamsPhones,F.teamsDisplays];function pe(e){var t=e;if(t.apiVersion<ue&&ve.forEach((function(e){t.apiVersion===e.versionToUpgradeFrom&&(t=e.upgradeToNextVersion(t))})),ce(t))return t;throw new Error("Received a runtime that could not be upgraded to the latest version")}var ve=[{versionToUpgradeFrom:1,upgradeToNextVersion:function(e){var t;return{apiVersion:2,hostVersionsInfo:void 0,isLegacyTeams:e.isLegacyTeams,supports:ae(ae({},e.supports),{dialog:e.supports.dialog?{card:void 0,url:e.supports.dialog,update:null===(t=e.supports.dialog)||void 0===t?void 0:t.update}:void 0})}}}],ge={"1.9.0":[{capability:{location:{}},hostClientTypes:fe}],"2.0.0":[{capability:{people:{}},hostClientTypes:fe},{capability:{sharing:{}},hostClientTypes:[F.desktop,F.web]}],"2.0.1":[{capability:{teams:{fullTrust:{joinedTeams:{}}}},hostClientTypes:[F.android,F.desktop,F.ios,F.teamsRoomsAndroid,F.teamsPhones,F.teamsDisplays,F.web]},{capability:{webStorage:{}},hostClientTypes:[F.desktop]}],"2.0.5":[{capability:{webStorage:{}},hostClientTypes:[F.android,F.desktop,F.ios]}]},me=se.extend("generateBackCompatRuntimeConfig");function ye(e){me("generating back compat runtime config for %s",e);var t=ae({},he.supports);me("Supported capabilities in config before updating based on highestSupportedVersion: %o",t),Object.keys(ge).forEach((function(n){Q(e,n)>=0&&ge[n].forEach((function(e){e.hostClientTypes.includes(w.hostClientType)&&(t=ae(ae({},t),e.capability))}))}));var n={apiVersion:2,hostVersionsInfo:G,isLegacyTeams:!0,supports:t};return me("Runtime config after updating based on highestSupportedVersion: %o",n),n}var be=se.extend("applyRuntimeConfig");function we(e){"string"==typeof e.apiVersion&&(be("Trying to apply runtime with string apiVersion, processing as v1: %o",e),e=ae(ae({},e),{apiVersion:1})),be("Fast-forwarding runtime %o",e);var t=pe(e);be("Applying runtime %o",t),de=X(t)}var Se,ke,Ce,xe,Ee,Te,Ie="2.14.0",Ae=k("internal"),Re=Ae.extend("ensureInitializeCalled"),_e=Ae.extend("ensureInitialized");function Pe(){if(!w.initializeCalled)throw Re(g),new Error(g)}function Ne(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];if(!w.initializeCompleted)throw _e("%s. initializeCalled: %s",g,w.initializeCalled.toString()),new Error(g);if(t&&t.length>0){for(var r=!1,i=0;i<t.length;i++)if(t[i]===w.frameContext){r=!0;break}if(!r)throw new Error("This call is only allowed in following contexts: ".concat(JSON.stringify(t),". ")+'Current context: "'.concat(w.frameContext,'".'))}return le(e)}function Oe(t){void 0===t&&(t=e);var n=Q(w.clientSupportedSDKVersion,t);return!isNaN(n)&&n>=0}function Me(){return w.hostClientType==F.android||w.hostClientType==F.ios||w.hostClientType==F.ipados}function Fe(t){if(void 0===t&&(t=e),!Me())throw{errorCode:O.NOT_SUPPORTED_ON_PLATFORM};if(!Oe(t))throw{errorCode:O.OLD_PLATFORM}}function Ze(e){var t=w.additionalValidOrigins.concat(e.filter((function(e){return"string"==typeof e&&f.test(e)}))),n={};t=t.filter((function(e){return!n[e]&&(n[e]=!0,!0)})),w.additionalValidOrigins=t}function De(){return"undefined"==typeof window}function Le(e){return{actionInfo:e.actionInfo,app:{locale:e.locale,sessionId:e.appSessionId?e.appSessionId:"",theme:e.theme?e.theme:"default",iconPositionVertical:e.appIconPosition,osLocaleInfo:e.osLocaleInfo,parentMessageId:e.parentMessageId,userClickTime:e.userClickTime,userFileOpenPreference:e.userFileOpenPreference,host:{name:e.hostName?e.hostName:Z.teams,clientType:e.hostClientType?e.hostClientType:F.web,sessionId:e.sessionId?e.sessionId:"",ringId:e.ringId},appLaunchId:e.appLaunchId},page:{id:e.entityId,frameContext:e.frameContext?e.frameContext:w.frameContext,subPageId:e.subEntityId,isFullScreen:e.isFullScreen,isMultiWindow:e.isMultiWindow,sourceOrigin:e.sourceOrigin},user:{id:e.userObjectId,displayName:e.userDisplayName,isCallingAllowed:e.isCallingAllowed,isPSTNCallingAllowed:e.isPSTNCallingAllowed,licenseType:e.userLicenseType,loginHint:e.loginHint,userPrincipalName:e.userPrincipalName,tenant:e.tid?{id:e.tid,teamsSku:e.tenantSKU}:void 0},channel:e.channelId?{id:e.channelId,displayName:e.channelName,relativeUrl:e.channelRelativeUrl,membershipType:e.channelType,defaultOneNoteSectionId:e.defaultOneNoteSectionId,ownerGroupId:e.hostTeamGroupId,ownerTenantId:e.hostTeamTenantId}:void 0,chat:e.chatId?{id:e.chatId}:void 0,meeting:e.meetingId?{id:e.meetingId}:void 0,sharepoint:e.sharepoint,team:e.teamId?{internalId:e.teamId,displayName:e.teamName,type:e.teamType,groupId:e.groupId,templateId:e.teamTemplateId,isArchived:e.isTeamArchived,userRole:e.userTeamRole}:void 0,sharePointSite:e.teamSiteUrl||e.teamSiteDomain||e.teamSitePath||e.mySitePath||e.mySiteDomain?{teamSiteUrl:e.teamSiteUrl,teamSiteDomain:e.teamSiteDomain,teamSitePath:e.teamSitePath,teamSiteId:e.teamSiteId,mySitePath:e.mySitePath,mySiteDomain:e.mySiteDomain}:void 0}}!function(e){var t,n,r;function i(e){return new Promise((function(n,r){if(w.hostClientType===F.desktop||w.hostClientType===F.android||w.hostClientType===F.ios||w.hostClientType===F.ipados||w.hostClientType===F.rigel||w.hostClientType===F.teamsRoomsWindows||w.hostClientType===F.teamsRoomsAndroid||w.hostClientType===F.teamsPhones||w.hostClientType===F.teamsDisplays){var i=document.createElement("a");i.href=e.url,n(dt("authentication.authenticate",[i.href,e.width,e.height,e.isExternal]).then((function(e){var t=e[0],n=e[1];if(t)return n;throw new Error(n)})))}else t={success:n,fail:r},u(e)}))}function o(e){return new Promise((function(t){t(dt("authentication.getAuthToken",[null==e?void 0:e.resources,null==e?void 0:e.claims,null==e?void 0:e.silent]))})).then((function(e){var t=e[0],n=e[1];if(t)return n;throw new Error(n)}))}function a(){return new Promise((function(e){e(dt("authentication.getUser"))})).then((function(e){var t=e[0],n=e[1];if(t)return n;throw new Error(n)}))}function s(){c();try{rt.childWindow&&rt.childWindow.close()}finally{rt.childWindow=null,rt.childOrigin=null}}function u(e){s();var t=e.width||600,n=e.height||400;t=Math.min(t,rt.currentWindow.outerWidth-400),n=Math.min(n,rt.currentWindow.outerHeight-200);var r=document.createElement("a");r.href=e.url.replace("{oauthRedirectMethod}","web");var i=void 0!==rt.currentWindow.screenLeft?rt.currentWindow.screenLeft:rt.currentWindow.screenX,o=void 0!==rt.currentWindow.screenTop?rt.currentWindow.screenTop:rt.currentWindow.screenY;i+=rt.currentWindow.outerWidth/2-t/2,o+=rt.currentWindow.outerHeight/2-n/2,rt.childWindow=rt.currentWindow.open(r.href,"_blank","toolbar=no, location=yes, status=no, menubar=no, scrollbars=yes, top="+o+", left="+i+", width="+t+", height="+n),rt.childWindow?l():h("FailedToOpenWindow")}function c(){n&&(clearInterval(n),n=0),Ge("initialize"),Ge("navigateCrossDomain")}function l(){c(),n=rt.currentWindow.setInterval((function(){if(!rt.childWindow||rt.childWindow.closed)h("CancelledByUser");else{var e=rt.childOrigin;try{rt.childOrigin="*",Mt("ping")}finally{rt.childOrigin=e}}}),100),Ve("initialize",(function(){return[D.authentication,w.hostClientType]})),Ve("navigateCrossDomain",(function(){return!1}))}function d(e){try{t&&t.success(e)}finally{t=null,s()}}function h(e){try{t&&t.fail(new Error(e))}finally{t=null,s()}}function f(e,t,n){if(e){var r=document.createElement("a");r.href=decodeURIComponent(e),r.host&&r.host!==window.location.host&&"outlook.office.com"===r.host&&r.search.indexOf("client_type=Win32_Outlook")>-1&&(t&&"result"===t&&(n&&(r.href=p(r.href,"result",n)),rt.currentWindow.location.assign(p(r.href,"authSuccess",""))),t&&"reason"===t&&(n&&(r.href=p(r.href,"reason",n)),rt.currentWindow.location.assign(p(r.href,"authFailure",""))))}}function p(e,t,n){var r=e.indexOf("#"),i=-1===r?"#":e.substr(r);return i=i+"&"+t+(""!==n?"="+n:""),(e=-1===r?e:e.substr(0,r))+i}e.initialize=function(){Ve("authentication.authenticate.success",d,!1),Ve("authentication.authenticate.failure",h,!1)},e.registerAuthenticationHandlers=function(e){r=e},e.authenticate=function(e){var t=void 0!==e,n=t?e:r;if(!n)throw new Error("No parameters are provided for authentication");return Ne(de,D.content,D.sidePanel,D.settings,D.remove,D.task,D.stage,D.meetingStage),i(n).then((function(e){try{return n&&n.successCallback?(n.successCallback(e),""):e}finally{t||(r=null)}})).catch((function(e){try{if(n&&n.failureCallback)return n.failureCallback(e.message),"";throw e}finally{t||(r=null)}}))},e.getAuthToken=function(e){return Pe(),o(e).then((function(t){return e&&e.successCallback?(e.successCallback(t),""):t})).catch((function(t){if(e&&e.failureCallback)return e.failureCallback(t.message),"";throw t}))},e.getUser=function(e){return Pe(),a().then((function(t){return e&&e.successCallback?(e.successCallback(t),null):t})).catch((function(t){if(e&&e.failureCallback)return e.failureCallback(t.message),null;throw t}))},e.notifySuccess=function(e,t){f(t,"result",e),Ne(de,D.authentication),ft("authentication.authenticate.success",[e]),Nt(rt.parentWindow,(function(){return setTimeout((function(){return rt.currentWindow.close()}),200)}))},e.notifyFailure=function(e,t){f(t,"reason",e),Ne(de,D.authentication),ft("authentication.authenticate.failure",[e]),Nt(rt.parentWindow,(function(){return setTimeout((function(){return rt.currentWindow.close()}),200)}))},function(e){e.Public="public",e.EUDB="eudb",e.Other="other"}(e.DataResidency||(e.DataResidency={}))}(Se||(Se={})),function(e){var t=[];function n(e){w.frameContext&&(w.frameContext===D.task?t.push(e):Ge("messageForChild"))}e.initialize=function(){Ve("messageForChild",n,!1)},function(e){function n(){return Ne(de)&&void 0!==(de.supports.dialog&&de.supports.dialog.url)}function r(e){return{url:e.url,height:e.size?e.size.height:q.Small,width:e.size?e.size.width:q.Small,title:e.title,fallbackUrl:e.fallbackUrl}}function i(e){var t=r(e);return t.completionBotId=e.completionBotId,t}e.open=function(e,t,i){if(Ne(de,D.content,D.sidePanel,D.meetingStage),!n())throw z;i&&Ve("messageForParent",i),ft("tasks.startTask",[r(e)],(function(e,n){null==t||t({err:e,result:n}),Ge("messageForParent")}))},e.submit=function(e,t){if(Ne(de,D.content,D.task),!n())throw z;ft("tasks.completeTask",[e,t?Array.isArray(t)?t:[t]:[]])},e.sendMessageToParentFromDialog=function(e){if(Ne(de,D.task),!n())throw z;ft("messageForParent",[e])},e.sendMessageToDialog=function(e){if(Ne(de,D.content,D.sidePanel,D.meetingStage),!n())throw z;ft("messageForChild",[e])},e.registerOnMessageFromParent=function(e){if(Ne(de,D.task),!n())throw z;for(Ge("messageForChild"),Ve("messageForChild",e),t.reverse();t.length>0;)e(t.pop())},e.isSupported=n,function(e){function t(){return Ne(de)&&void 0!==(de.supports.dialog&&de.supports.dialog.url&&de.supports.dialog.url.bot)}e.open=function(e,n,r){if(Ne(de,D.content,D.sidePanel,D.meetingStage),!t())throw z;r&&Ve("messageForParent",r),ft("tasks.startTask",[i(e)],(function(e,t){null==n||n({err:e,result:t}),Ge("messageForParent")}))},e.isSupported=t}(e.bot||(e.bot={})),e.getDialogInfoFromUrlDialogInfo=r,e.getDialogInfoFromBotUrlDialogInfo=i}(e.url||(e.url={})),e.isSupported=function(){return!(!Ne(de)||!de.supports.dialog)},function(e){function t(){return!(!Ne(de)||!de.supports.dialog)&&!!de.supports.dialog.update}e.resize=function(e){if(Ne(de,D.content,D.sidePanel,D.task,D.meetingStage),!t())throw z;ft("tasks.updateTask",[e])},e.isSupported=t}(e.update||(e.update={})),function(e){function t(){var e=de.hostVersionsInfo&&de.hostVersionsInfo.adaptiveCardSchemaVersion&&!ie(de.hostVersionsInfo.adaptiveCardSchemaVersion);return Ne(de)&&void 0!==(e&&de.supports.dialog&&de.supports.dialog.card)}function n(e){return{card:e.card,height:e.size?e.size.height:q.Small,width:e.size?e.size.width:q.Small,title:e.title}}function r(e){var t=n(e);return t.completionBotId=e.completionBotId,t}e.open=function(e,r){if(Ne(de,D.content,D.sidePanel,D.meetingStage),!t())throw z;ft("tasks.startTask",[n(e)],(function(e,t){null==r||r({err:e,result:t})}))},e.isSupported=t,function(e){function t(){var e=de.hostVersionsInfo&&de.hostVersionsInfo.adaptiveCardSchemaVersion&&!ie(de.hostVersionsInfo.adaptiveCardSchemaVersion);return Ne(de)&&void 0!==(e&&de.supports.dialog&&de.supports.dialog.card&&de.supports.dialog.card.bot)}e.open=function(e,n){if(Ne(de,D.content,D.sidePanel,D.meetingStage),!t())throw z;ft("tasks.startTask",[r(e)],(function(e,t){null==n||n({err:e,result:t})}))},e.isSupported=t}(e.bot||(e.bot={}))}(e.adaptiveCard||(e.adaptiveCard={}))}(ke||(ke={})),function(e){!function(e){e[e.ifRoom=0]="ifRoom",e[e.overflowOnly=1]="overflowOnly"}(e.DisplayMode||(e.DisplayMode={}));var t,n,r,i=function(){this.enabled=!0,this.selected=!1};function o(e){r&&r(e)||(Ne(de),ft("viewConfigItemPress",[e]))}function a(e){t&&t(e)||(Ne(de),ft("handleNavBarMenuItemPress",[e]))}function s(e){n&&n(e)||(Ne(de),ft("handleActionMenuItemPress",[e]))}function u(){return!(!Ne(de)||!de.supports.menus)}e.MenuItem=i,function(e){e.dropDown="dropDown",e.popOver="popOver"}(e.MenuListType||(e.MenuListType={})),e.initialize=function(){Ve("navBarMenuItemPress",a,!1),Ve("actionMenuItemPress",s,!1),Ve("setModuleView",o,!1)},e.setUpViews=function(e,t){if(Ne(de),!u())throw z;r=t,ft("setUpViews",[e])},e.setNavBarMenu=function(e,n){if(Ne(de),!u())throw z;t=n,ft("setNavBarMenu",[e])},e.showActionMenu=function(e,t){if(Ne(de),!u())throw z;n=t,ft("showActionMenu",[e])},e.isSupported=u}(Ce||(Ce={})),function(e){function t(){if("undefined"==typeof window)throw new Error("window object undefined at print call");window.print()}function n(e,t){e&&Ne(de),e&&t&&t(),Ye(e)}function r(e,t){e&&Ne(de),e&&t&&t(),$e(e)}function i(){return!(!Ne(de)||!de.supports.teamsCore)}e.enablePrintCapability=function(){if(!w.printCapabilityEnabled){if(Ne(de),!i())throw z;w.printCapabilityEnabled=!0,document.addEventListener("keydown",(function(e){(e.ctrlKey||e.metaKey)&&80===e.keyCode&&(t(),e.cancelBubble=!0,e.preventDefault(),e.stopImmediatePropagation())}))}},e.print=t,e.registerOnLoadHandler=function(e){n(e,(function(){if(e&&!i())throw z}))},e.registerOnLoadHandlerHelper=n,e.registerBeforeUnloadHandler=function(e){r(e,(function(){if(e&&!i())throw z}))},e.registerBeforeUnloadHandlerHelper=r,e.isSupported=i}(xe||(xe={})),function(t){var n=k("app");t.Messages={AppLoaded:"appInitialization.appLoaded",Success:"appInitialization.success",Failure:"appInitialization.failure",ExpectedFailure:"appInitialization.expectedFailure"},function(e){e.AuthFailed="AuthFailed",e.Timeout="Timeout",e.Other="Other"}(t.FailedReason||(t.FailedReason={})),function(e){e.PermissionError="PermissionError",e.NotFound="NotFound",e.Throttling="Throttling",e.Offline="Offline",e.Other="Other"}(t.ExpectedFailureReason||(t.ExpectedFailureReason={})),t.isInitialized=function(){return w.initializeCompleted},t.getFrameContext=function(){return w.frameContext};var r=5e3;t.initialize=function(e){return De()?(n.extend("initialize")("window object undefined at initialization"),Promise.resolve()):ne((function(){return o(e)}),r,new Error("SDK initialization timed out."))};var i=n.extend("initializeHelper");function o(t){return new Promise((function(n){w.initializeCalled||(w.initializeCalled=!0,Ue(),w.initializePromise=ot(t).then((function(t){var n=t.context,r=t.clientType,o=t.runtimeConfig,a=t.clientSupportedSDKVersion,s=void 0===a?e:a;w.frameContext=n,w.hostClientType=r,w.clientSupportedSDKVersion=s;try{i("Parsing %s",o);var u=JSON.parse(o);if(i("Checking if %o is a valid runtime object",null!=u?u:"null"),!u||!u.apiVersion)throw new Error("Received runtime config is invalid");o&&we(u)}catch(t){if(!(t instanceof SyntaxError))throw t;try{if(i("Attempting to parse %s as an SDK version",o),isNaN(Q(o,e))||(w.clientSupportedSDKVersion=o),u=JSON.parse(s),i("givenRuntimeConfig parsed to %o",null!=u?u:"null"),!u)throw new Error("givenRuntimeConfig string was successfully parsed. However, it parsed to value of null");we(u)}catch(e){if(!(e instanceof SyntaxError))throw e;we(ye(w.clientSupportedSDKVersion))}}w.initializeCompleted=!0})),Se.initialize(),Ce.initialize(),Te.config.initialize(),ke.initialize()),Array.isArray(t)&&Ze(t),n(w.initializePromise)}))}function a(e){e&&Pe(),Je(e)}t._initialize=function(e){rt.currentWindow=e},t._uninitialize=function(){w.initializeCalled&&(w.frameContext&&(a(null),Te.backStack.registerBackButtonHandler(null),Te.registerFullScreenHandler(null),xe.registerBeforeUnloadHandler(null),xe.registerOnLoadHandler(null),Et.registerGetLogHandler(null)),w.frameContext===D.settings&&Te.config.registerOnSaveHandler(null),w.frameContext===D.remove&&Te.config.registerOnRemoveHandler(null),w.initializeCalled=!1,w.initializeCompleted=!1,w.initializePromise=null,w.additionalValidOrigins=[],w.frameContext=null,w.hostClientType=null,w.isFramelessWindow=!1,at())},t.getContext=function(){return new Promise((function(e){Pe(),e(st("getContext"))})).then((function(e){return Le(e)}))},t.notifyAppLoaded=function(){Pe(),ft(t.Messages.AppLoaded,[Ie])},t.notifySuccess=function(){Pe(),ft(t.Messages.Success,[Ie])},t.notifyFailure=function(e){Pe(),ft(t.Messages.Failure,[e.reason,e.message])},t.notifyExpectedFailure=function(e){Pe(),ft(t.Messages.ExpectedFailure,[e.reason,e.message])},t.registerOnThemeChangeHandler=a,t.openLink=function(e){return new Promise((function(t){Ne(de,D.content,D.sidePanel,D.settings,D.task,D.stage,D.meetingStage),t(ut("executeDeepLink",e))}))}}(Ee||(Ee={})),function(e){function t(e){if(Ne(de,D.content),!n())throw z;ft("setFrameContext",[e])}function n(){return!(!Ne(de)||!de.supports.pages)}e.returnFocus=function(e){if(Ne(de),!n())throw z;ft("returnFocus",[e])},e.registerFocusEnterHandler=function(e){We("focusEnter",e,[],(function(){if(!n())throw z}))},e.setCurrentFrame=t,e.initializeWithFrameContext=function(e,n,r){Ee.initialize(r).then((function(){return n&&n()})),t(e)},e.getConfig=function(){return new Promise((function(e){if(Ne(de,D.content,D.settings,D.remove,D.sidePanel),!n())throw z;e(st("settings.getSettings"))}))},e.navigateCrossDomain=function(e){return new Promise((function(t){if(Ne(de,D.content,D.sidePanel,D.settings,D.remove,D.task,D.stage,D.meetingStage),!n())throw z;t(ct("navigateCrossDomain","Cross-origin navigation is only supported for URLs matching the pattern registered in the manifest.",e))}))},e.navigateToApp=function(e){return new Promise((function(t){if(Ne(de,D.content,D.sidePanel,D.settings,D.task,D.stage,D.meetingStage),!n())throw z;de.isLegacyTeams?t(ut("executeDeepLink",re(e))):t(ut("pages.navigateToApp",e))}))},e.shareDeepLink=function(e){if(Ne(de,D.content,D.sidePanel,D.meetingStage),!n())throw z;ft("shareDeepLink",[e.subPageId,e.subPageLabel,e.subPageWebUrl])},e.registerFullScreenHandler=function(e){We("fullScreenChange",e,[],(function(){if(e&&!n())throw z}))},e.isSupported=n,function(e){function t(){return!(!Ne(de)||!de.supports.pages)&&!!de.supports.pages.tabs}e.navigateToTab=function(e){return new Promise((function(n){if(Ne(de),!t())throw z;n(ct("navigateToTab","Invalid internalTabInstanceId and/or channelId were/was provided",e))}))},e.getTabInstances=function(e){return new Promise((function(n){if(Ne(de),!t())throw z;n(st("getTabInstances",e))}))},e.getMruTabInstances=function(e){return new Promise((function(n){if(Ne(de),!t())throw z;n(st("getMruTabInstances",e))}))},e.isSupported=t}(e.tabs||(e.tabs={})),function(e){var t,n;function r(e,n){e&&Ne(de,D.settings),n&&n(),t=e,e&&ft("registerHandler",["save"])}function i(e,t){e&&Ne(de,D.remove,D.settings),t&&t(),n=e,e&&ft("registerHandler",["remove"])}function o(e){var n=new a(e);t?t(n):rt.childWindow?Mt("settings.save",[e]):n.notifySuccess()}e.initialize=function(){Ve("settings.save",o,!1),Ve("settings.remove",s,!1)},e.setValidityState=function(e){if(Ne(de,D.settings,D.remove),!c())throw z;ft("settings.setValidityState",[e])},e.setConfig=function(e){return new Promise((function(t){if(Ne(de,D.content,D.settings,D.sidePanel),!c())throw z;t(ut("settings.setSettings",e))}))},e.registerOnSaveHandler=function(e){r(e,(function(){if(e&&!c())throw z}))},e.registerOnSaveHandlerHelper=r,e.registerOnRemoveHandler=function(e){i(e,(function(){if(e&&!c())throw z}))},e.registerOnRemoveHandlerHelper=i,e.registerChangeConfigHandler=function(e){We("changeSettings",e,[D.content],(function(){if(!c())throw z}))};var a=function(){function e(e){this.notified=!1,this.result=e||{}}return e.prototype.notifySuccess=function(){this.ensureNotNotified(),ft("settings.save.success"),this.notified=!0},e.prototype.notifyFailure=function(e){this.ensureNotNotified(),ft("settings.save.failure",[e]),this.notified=!0},e.prototype.ensureNotNotified=function(){if(this.notified)throw new Error("The SaveEvent may only notify success or failure once.")},e}();function s(){var e=new u;n?n(e):rt.childWindow?Mt("settings.remove",[]):e.notifySuccess()}var u=function(){function e(){this.notified=!1}return e.prototype.notifySuccess=function(){this.ensureNotNotified(),ft("settings.remove.success"),this.notified=!0},e.prototype.notifyFailure=function(e){this.ensureNotNotified(),ft("settings.remove.failure",[e]),this.notified=!0},e.prototype.ensureNotNotified=function(){if(this.notified)throw new Error("The removeEventType may only notify success or failure once.")},e}();function c(){return!(!Ne(de)||!de.supports.pages)&&!!de.supports.pages.config}e.isSupported=c}(e.config||(e.config={})),function(e){var t;function n(){return new Promise((function(e){if(Ne(de),!o())throw z;e(ct("navigateBack","Back navigation is not supported in the current client or context."))}))}function r(e,n){e&&Ne(de),n&&n(),t=e,e&&ft("registerHandler",["backButton"])}function i(){t&&t()||(rt.childWindow?Mt("backButtonPress",[]):n())}function o(){return!(!Ne(de)||!de.supports.pages)&&!!de.supports.pages.backStack}e._initialize=function(){Ve("backButtonPress",i,!1)},e.navigateBack=n,e.registerBackButtonHandler=function(e){r(e,(function(){if(e&&!o())throw z}))},e.registerBackButtonHandlerHelper=r,e.isSupported=o}(e.backStack||(e.backStack={})),function(e){function t(){return!(!Ne(de)||!de.supports.pages)&&!!de.supports.pages.fullTrust}e.enterFullscreen=function(){if(Ne(de,D.content),!t())throw z;ft("enterFullscreen",[])},e.exitFullscreen=function(){if(Ne(de,D.content),!t())throw z;ft("exitFullscreen",[])},e.isSupported=t}(e.fullTrust||(e.fullTrust={})),function(e){function t(){return!(!Ne(de)||!de.supports.pages)&&!!de.supports.pages.appButton}e.onClick=function(e){We("appButtonClick",e,[D.content],(function(){if(!t())throw z}))},e.onHoverEnter=function(e){We("appButtonHoverEnter",e,[D.content],(function(){if(!t())throw z}))},e.onHoverLeave=function(e){We("appButtonHoverLeave",e,[D.content],(function(){if(!t())throw z}))},e.isSupported=t}(e.appButton||(e.appButton={})),function(e){function t(){return!(!Ne(de)||!de.supports.pages)&&!!de.supports.pages.currentApp}e.navigateTo=function(e){return new Promise((function(n){if(Ne(de,D.content,D.sidePanel,D.settings,D.task,D.stage,D.meetingStage),!t())throw z;n(lt("pages.currentApp.navigateTo",e))}))},e.navigateToDefaultPage=function(){return new Promise((function(e){if(Ne(de,D.content,D.sidePanel,D.settings,D.task,D.stage,D.meetingStage),!t())throw z;e(lt("pages.currentApp.navigateToDefaultPage"))}))},e.isSupported=t}(e.currentApp||(e.currentApp={}))}(Te||(Te={}));var Be=function(e,t,n){if(n||2===arguments.length)for(var r,i=0,o=t.length;i<o;i++)!r&&i in t||(r||(r=Array.prototype.slice.call(t,0,i)),r[i]=t[i]);return e.concat(r||Array.prototype.slice.call(t))},qe=k("handlers"),je=function(){function e(){}return e.handlers={},e}();function Ue(){je.handlers.themeChange=Qe,je.handlers.load=Xe,je.handlers.beforeUnload=et,Te.backStack._initialize()}var He=qe.extend("callHandler");function ze(e,t){var n=je.handlers[e];return n?(He("Invoking the registered handler for message %s with arguments %o",e,t),[!0,n.apply(this,t)]):rt.childWindow?(Mt(e,t),[!1,void 0]):(He("Handler for action message %s not found.",e),[!1,void 0])}function Ve(e,t,n,r){void 0===n&&(n=!0),void 0===r&&(r=[]),t?(je.handlers[e]=t,n&&ft("registerHandler",Be([e],r,!0))):delete je.handlers[e]}function Ge(e){delete je.handlers[e]}function Ke(e){return null!=je.handlers[e]}function We(e,t,n,r){t&&Ne.apply(void 0,Be([de],n,!1)),r&&r(),Ve(e,t)}function Je(e){je.themeChangeHandler=e,e&&ft("registerHandler",["themeChange"])}function Qe(e){je.themeChangeHandler&&je.themeChangeHandler(e),rt.childWindow&&Mt("themeChange",[e])}function Ye(e){je.loadHandler=e,e&&ft("registerHandler",["load"])}function Xe(e){je.loadHandler&&je.loadHandler(e),rt.childWindow&&Mt("load",[e])}function $e(e){je.beforeUnloadHandler=e,e&&ft("registerHandler",["beforeUnload"])}function et(){var e=function(){ft("readyToUnload",[])};je.beforeUnloadHandler&&je.beforeUnloadHandler(e)||(rt.childWindow?Mt("beforeUnload"):e())}var tt=function(e,t,n){if(n||2===arguments.length)for(var r,i=0,o=t.length;i<o;i++)!r&&i in t||(r||(r=Array.prototype.slice.call(t,0,i)),r[i]=t[i]);return e.concat(r||Array.prototype.slice.call(t))},nt=k("communication"),rt=function(){},it=function(){function e(){}return e.parentMessageQueue=[],e.childMessageQueue=[],e.nextMessageId=0,e.callbacks={},e.promiseCallbacks={},e}();function ot(e){if(it.messageListener=function(e){return gt(e)},rt.currentWindow=rt.currentWindow||window,rt.parentWindow=rt.currentWindow.parent!==rt.currentWindow.self?rt.currentWindow.parent:rt.currentWindow.opener,(rt.parentWindow||e)&&rt.currentWindow.addEventListener("message",it.messageListener,!1),!rt.parentWindow){var t=rt.currentWindow;if(!t.nativeInterface)return Promise.reject(new Error("Initialization Failed. No Parent window found."));w.isFramelessWindow=!0,t.onNativeMessage=wt}try{return rt.parentOrigin="*",dt("initialize",[Ie,ue]).then((function(e){return{context:e[0],clientType:e[1],runtimeConfig:e[2],clientSupportedSDKVersion:e[3]}}))}finally{rt.parentOrigin=null}}function at(){rt.currentWindow&&rt.currentWindow.removeEventListener("message",it.messageListener,!1),rt.currentWindow=null,rt.parentWindow=null,rt.parentOrigin=null,rt.childWindow=null,rt.childOrigin=null,it.parentMessageQueue=[],it.childMessageQueue=[],it.nextMessageId=0,it.callbacks={},it.promiseCallbacks={}}function st(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];return dt(e,t).then((function(e){return e[0]}))}function ut(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];return dt(e,t).then((function(e){var t=e[0],n=e[1];if(!t)throw new Error(n)}))}function ct(e,t){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];return dt(e,n).then((function(e){var n=e[0],r=e[1];if(!n)throw new Error(r||t)}))}function lt(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];return dt(e,t).then((function(e){var t=e[0],n=e[1];if(t)throw t;return n}))}function dt(e,t){return void 0===t&&(t=void 0),new Promise((function(n){n(ht(vt(e,t).id))}))}function ht(e){return new Promise((function(t){it.promiseCallbacks[e]=t}))}function ft(e,t,n){var r;t instanceof Function?n=t:t instanceof Array&&(r=t);var i=vt(e,r);n&&(it.callbacks[i.id]=n)}var pt=nt.extend("sendMessageToParentHelper");function vt(e,t){var n=pt,r=rt.parentWindow,i=Ft(e,t);if(n("Message %i information: %o",i.id,{actionName:e,args:t}),w.isFramelessWindow)rt.currentWindow&&rt.currentWindow.nativeInterface&&(n("Sending message %i to parent via framelessPostMessage interface",i.id),rt.currentWindow.nativeInterface.framelessPostMessage(JSON.stringify(i)));else{var o=xt(r);r&&o?(n("Sending message %i to parent via postMessage",i.id),r.postMessage(i,o)):(n("Adding message %i to parent message queue",i.id),Ct(r).push(i))}return i}function gt(e){if(e&&e.data&&"object"==typeof e.data){var t=e.source||e.originalEvent&&e.originalEvent.source,n=e.origin||e.originalEvent&&e.originalEvent.origin;mt(t,n)&&(yt(t,n),t===rt.parentWindow?wt(e):t===rt.childWindow&&kt(e))}}function mt(e,t){return(!rt.currentWindow||e!==rt.currentWindow)&&(!!(rt.currentWindow&&rt.currentWindow.location&&t&&t===rt.currentWindow.location.origin)||W(new URL(t)))}function yt(e,t){w.isFramelessWindow||rt.parentWindow&&!rt.parentWindow.closed&&e!==rt.parentWindow?rt.childWindow&&!rt.childWindow.closed&&e!==rt.childWindow||(rt.childWindow=e,rt.childOrigin=t):(rt.parentWindow=e,rt.parentOrigin=t),rt.parentWindow&&rt.parentWindow.closed&&(rt.parentWindow=null,rt.parentOrigin=null),rt.childWindow&&rt.childWindow.closed&&(rt.childWindow=null,rt.childOrigin=null),Pt(rt.parentWindow),Pt(rt.childWindow)}var bt=nt.extend("handleParentMessage");function wt(e){var t=bt;if("id"in e.data&&"number"==typeof e.data.id){var n=e.data,r=it.callbacks[n.id];t("Received a response from parent for message %i",n.id),r&&(t("Invoking the registered callback for message %i with arguments %o",n.id,n.args),r.apply(null,tt(tt([],n.args,!0),[n.isPartialResponse],!1)),St(e)||(t("Removing registered callback for message %i",n.id),delete it.callbacks[n.id]));var i=it.promiseCallbacks[n.id];i&&(t("Invoking the registered promise callback for message %i with arguments %o",n.id,n.args),i(n.args),t("Removing registered promise callback for message %i",n.id),delete it.promiseCallbacks[n.id])}else"func"in e.data&&"string"==typeof e.data.func?(t("Received an action message %s from parent",(n=e.data).func),ze(n.func,n.args)):t("Received an unknown message: %O",e)}function St(e){return!0===e.data.isPartialResponse}function kt(e){if("id"in e.data&&"func"in e.data){var t=e.data,n=ze(t.func,t.args),r=n[0],i=n[1];r&&void 0!==i?Ot(t.id,Array.isArray(i)?i:[i]):ft(t.func,t.args,(function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];if(rt.childWindow){var r=e.pop();Ot(t.id,e,r)}}))}}function Ct(e){return e===rt.parentWindow?it.parentMessageQueue:e===rt.childWindow?it.childMessageQueue:[]}function xt(e){return e===rt.parentWindow?rt.parentOrigin:e===rt.childWindow?rt.childOrigin:null}var Et,Tt,It,At,Rt,_t=nt.extend("flushMessageQueue");function Pt(e){for(var t=xt(e),n=Ct(e),r=e==rt.parentWindow?"parent":"child";e&&t&&n.length>0;){var i=n.shift();_t("Flushing message %i from "+r+" message queue via postMessage.",i.id),e.postMessage(i,t)}}function Nt(e,t){var n=rt.currentWindow.setInterval((function(){0===Ct(e).length&&(clearInterval(n),t())}),100)}function Ot(e,t,n){var r=rt.childWindow,i=Zt(e,t,n),o=xt(r);r&&o&&r.postMessage(i,o)}function Mt(e,t){var n=rt.childWindow,r=Dt(e,t),i=xt(n);n&&i?n.postMessage(r,i):Ct(n).push(r)}function Ft(e,t){return{id:it.nextMessageId++,func:e,timestamp:Date.now(),args:t||[]}}function Zt(e,t,n){return{id:e,args:t||[],isPartialResponse:n}}function Dt(e,t){return{func:e,args:t||[]}}function Lt(e,t){Ne(de),ft("uploadCustomApp",[e],t||J())}function Bt(e,t,n){Ne(de),ft(e,t,n)}function qt(e,t){if(Ne(de),!rt.childWindow)throw new Error("The child window has not yet been initialized or is not present");Mt(e,t)}function jt(e,t){var n=this;Ne(de),Ve(e,(function(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];return t.apply(n,e)}))}function Ut(e,t){Ne(de),Ve("userSettingsChange",t,!0,[e])}function Ht(e){Ne(de,D.content,D.task),ft("openFilePreview",[e.entityId,e.title,e.description,e.type,e.objectUrl,e.downloadUrl,e.webPreviewUrl,e.webEditUrl,e.baseUrl,e.editFile,e.subEntityId,e.viewerAction,e.fileOpenPreference,e.conversationId])}!function(e){function t(){return!(!Ne(de)||!de.supports.logs)}e.registerGetLogHandler=function(e){if(e&&Ne(de),e&&!t())throw z;e?Ve("log.request",(function(){ft("log.receive",[e()])})):Ge("log.request")},e.isSupported=t}(Et||(Et={})),function(e){e.fileDownloadStart="fileDownloadStart",e.fileDownloadComplete="fileDownloadComplete"}(Tt||(Tt={})),function(e){e.view="view",e.edit="edit",e.editNew="editNew"}(It||(It={})),function(e){e.fileOpenPreference="fileOpenPreference",e.theme="theme"}(At||(At={})),function(e){function t(){return!(!Ne(de)||!de.supports.conversations)}e.openConversation=function(e){return new Promise((function(n){if(Ne(de,D.content),!t())throw z;var r=ut("conversations.openConversation",{title:e.title,subEntityId:e.subEntityId,conversationId:e.conversationId,channelId:e.channelId,entityId:e.entityId});e.onStartConversation&&Ve("startConversation",(function(t,n,r,i){return e.onStartConversation({subEntityId:t,conversationId:n,channelId:r,entityId:i})})),e.onCloseConversation&&Ve("closeConversation",(function(t,n,r,i){return e.onCloseConversation({subEntityId:t,conversationId:n,channelId:r,entityId:i})})),n(r)}))},e.closeConversation=function(){if(Ne(de,D.content),!t())throw z;ft("conversations.closeConversation"),Ge("startConversation"),Ge("closeConversation")},e.getChatMembers=function(){return new Promise((function(e){if(Ne(de),!t())throw z;e(st("getChatMembers"))}))},e.isSupported=t}(Rt||(Rt={}));var zt,Vt,Gt="/l/app/",Kt="/l/meeting/new",Wt="attendees",Jt="startTime",Qt="endTime",Yt="subject",Xt="content",$t="/l/call/0/0",en="source",tn="withVideo",nn="/l/chat/0/0",rn="users",on="topicName",an="message";function sn(e,t,n){if(0===e.length)throw new Error("Must have at least one user when creating a chat deep link");var r="".concat(rn,"=")+e.map((function(e){return encodeURIComponent(e)})).join(","),i=void 0===t?"":"&".concat(on,"=").concat(encodeURIComponent(t)),o=void 0===n?"":"&".concat(an,"=").concat(encodeURIComponent(n));return"".concat(p,"://").concat(v).concat(nn,"?").concat(r).concat(i).concat(o)}function un(e,t,n){if(0===e.length)throw new Error("Must have at least one target when creating a call deep link");var r="".concat(rn,"=")+e.map((function(e){return encodeURIComponent(e)})).join(","),i=void 0===t?"":"&".concat(tn,"=").concat(encodeURIComponent(t)),o=void 0===n?"":"&".concat(en,"=").concat(encodeURIComponent(n));return"".concat(p,"://").concat(v).concat($t,"?").concat(r).concat(i).concat(o)}function cn(e,t,n,r,i){var o=void 0===e?"":"".concat(Wt,"=")+e.map((function(e){return encodeURIComponent(e)})).join(","),a=void 0===t?"":"&".concat(Jt,"=").concat(encodeURIComponent(t)),s=void 0===n?"":"&".concat(Qt,"=").concat(encodeURIComponent(n)),u=void 0===r?"":"&".concat(Yt,"=").concat(encodeURIComponent(r)),c=void 0===i?"":"&".concat(Xt,"=").concat(encodeURIComponent(i));return"".concat(p,"://").concat(v).concat(Kt,"?").concat(o).concat(a).concat(s).concat(u).concat(c)}function ln(e){if(!e)throw new Error("App ID must be set when creating an app install dialog deep link");return"".concat(p,"://").concat(v).concat(Gt).concat(encodeURIComponent(e))}!function(e){function t(){return!(!Ne(de)||!de.supports.appInstallDialog)}e.openAppInstallDialog=function(e){return new Promise((function(n){if(Ne(de,D.content,D.sidePanel,D.settings,D.task,D.stage,D.meetingStage),!t())throw new Error("Not supported");de.isLegacyTeams?n(ut("executeDeepLink",ln(e.appId))):(ft("appInstallDialog.openAppInstallDialog",[e]),n())}))},e.isSupported=t}(zt||(zt={})),function(e){function t(e){var t;return{title:e.title,content:e.content,notificationIconAsSring:null===(t=e.icon)||void 0===t?void 0:t.href,displayDurationInSeconds:e.displayDurationInSeconds,notificationActionUrlAsString:e.notificationActionUrl.href}}function n(e){return["https:"].includes(e.protocol)}function r(e,t){return e.length<=t}function i(e){if(!e.title)throw new Error("Must supply notification title");if(!r(e.title,75))throw new Error("Invalid notification title length: Maximum title length ".concat(75,", title length supplied ").concat(e.title.length));if(!e.content)throw new Error("Must supply notification content");if(!r(e.content,1500))throw new Error("Invalid notification content length: Maximum content length ".concat(1500,", content length supplied ").concat(e.content.length));if(!e.notificationActionUrl)throw new Error("Must supply notification url");if(!n(e.notificationActionUrl))throw new Error("Invalid notificationAction url");if(void 0!==(null==e?void 0:e.icon)&&!n(null==e?void 0:e.icon))throw new Error("Invalid icon url");if(!e.displayDurationInSeconds)throw new Error("Must supply notification display duration in seconds");if(e.displayDurationInSeconds<0)throw new Error("Notification display time must be greater than zero")}function o(){return!(!Ne(de)||!de.supports.appNotification)}e.displayInAppNotification=function(e){if(Ne(de,D.content,D.stage,D.sidePanel,D.meetingStage),!o())throw z;return i(e),lt("appNotification.displayNotification",t(e))},e.isSupported=o}(Vt||(Vt={}));var dn,hn,fn,pn,vn=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();function gn(e,t){if(null==e||null==t||e.length<=0)return null;var n,r=1;return e.sort((function(e,t){return e.sequence>t.sequence?1:-1})),e.forEach((function(e){e.sequence==r&&(n=n?new Blob([n,e.file],{type:t}):new Blob([e.file],{type:t}),r++)})),n}function mn(e,t){if(null==e||null==t)return null;for(var n=atob(e.chunk),r=new Array(n.length),i=0;i<n.length;i++)r[i]=n.charCodeAt(i);var o=new Uint8Array(r),a=new Blob([o],{type:t});return{sequence:e.chunkSequence,file:a}}function yn(e){kn(e)?Fe(t):Cn(e)?Fe(r):Sn(e)&&Fe(o)}function bn(e){return!(e.mediaType!=dn.MediaType.Video||!e.videoProps||!e.videoProps.videoController)}function wn(e){return!(null==e||e.maxMediaCount>10)}function Sn(e){var t;return!((null==e?void 0:e.mediaType)!=dn.MediaType.Image||!(null===(t=null==e?void 0:e.imageProps)||void 0===t?void 0:t.imageOutputFormats))}function kn(e){return!(!e||e.mediaType!=dn.MediaType.VideoAndImage&&!e.videoAndImageProps)}function Cn(e){return!(!e||e.mediaType!=dn.MediaType.Video||!e.videoProps||e.videoProps.isFullScreenMode)}function xn(e,t,n){return null!=e&&null!=t&&t==dn.FileFormat.ID&&null!=n}function En(e){return!(null==e||e.length<=0||e.length>10)}function Tn(e){return!e||!(null===e.timeOutIntervalInSec||e.timeOutIntervalInSec<=0||e.timeOutIntervalInSec>60)}function In(e){if(e){if(e.title&&"string"!=typeof e.title)return!1;if(e.setSelected&&"object"!=typeof e.setSelected)return!1;if(e.openOrgWideSearchInChatOrChannel&&"boolean"!=typeof e.openOrgWideSearchInChatOrChannel)return!1;if(e.singleSelect&&"boolean"!=typeof e.singleSelect)return!1}return!0}function An(){return de.hostVersionsInfo?de.hostVersionsInfo.adaptiveCardSchemaVersion:void 0}!function(e){!function(e){e.Base64="base64",e.ID="id"}(e.FileFormat||(e.FileFormat={}));var t=function(){};function n(){return!(!Ne(de)||!de.supports.permissions)}e.File=t,e.captureImage=function(e){if(!e)throw new Error("[captureImage] Callback cannot be null");Ne(de,D.content,D.task),w.isFramelessWindow?Oe(c)?ft("captureImage",e):e({errorCode:O.OLD_PLATFORM},void 0):e({errorCode:O.NOT_SUPPORTED_ON_PLATFORM},void 0)},e.hasPermission=function(){if(Ne(de,D.content,D.task),!n())throw z;var e=M.Media;return new Promise((function(t){t(lt("permissions.has",e))}))},e.requestPermission=function(){if(Ne(de,D.content,D.task),!n())throw z;var e=M.Media;return new Promise((function(t){t(lt("permissions.request",e))}))};var i=function(e){function t(t){void 0===t&&(t=null);var n=e.call(this)||this;return t&&(n.content=t.content,n.format=t.format,n.mimeType=t.mimeType,n.name=t.name,n.preview=t.preview,n.size=t.size),n}return vn(t,e),t.prototype.getMedia=function(e){if(!e)throw new Error("[get Media] Callback cannot be null");Ne(de,D.content,D.task),Oe(l)?xn(this.mimeType,this.format,this.content)?Oe("2.0.0")?this.getMediaViaCallback(e):this.getMediaViaHandler(e):e({errorCode:O.INVALID_ARGUMENTS},null):e({errorCode:O.OLD_PLATFORM},null)},t.prototype.getMediaViaCallback=function(e){var t={mediaMimeType:this.mimeType,assembleAttachment:[]};ft("getMedia",[this.content],(function(n){if(e)if(n&&n.error)e(n.error,null);else if(n&&n.mediaChunk)if(n.mediaChunk.chunkSequence<=0){var r=gn(t.assembleAttachment,t.mediaMimeType);e(n.error,r)}else{var i=mn(n.mediaChunk,t.mediaMimeType);t.assembleAttachment.push(i)}else e({errorCode:O.INTERNAL_ERROR,message:"data received is null"},null)}))},t.prototype.getMediaViaHandler=function(e){var t=Y(),n={mediaMimeType:this.mimeType,assembleAttachment:[]},r=[t,this.content];this.content&&e&&ft("getMedia",r),Ve("getMedia"+t,(function(r){if(e){var i=JSON.parse(r);if(i.error)e(i.error,null),Ge("getMedia"+t);else if(i.mediaChunk)if(i.mediaChunk.chunkSequence<=0){var o=gn(n.assembleAttachment,n.mediaMimeType);e(i.error,o),Ge("getMedia"+t)}else{var a=mn(i.mediaChunk,n.mediaMimeType);n.assembleAttachment.push(a)}else e({errorCode:O.INTERNAL_ERROR,message:"data received is null"},null),Ge("getMedia"+t)}}))},t}(t);e.Media=i;var o,a,s=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return vn(t,e),t.prototype.getMediaType=function(){return a.Video},t.prototype.notifyEventToApp=function(e){if(this.controllerCallback)switch(e){case o.StartRecording:if(this.controllerCallback.onRecordingStarted){this.controllerCallback.onRecordingStarted();break}}},t}(function(){function e(e){this.controllerCallback=e}return e.prototype.notifyEventToHost=function(e,t){Ne(de,D.content,D.task);try{Fe(r)}catch(e){return void(t&&t(e))}ft("media.controller",[{mediaType:this.getMediaType(),mediaControllerEvent:e}],(function(e){t&&t(e)}))},e.prototype.stop=function(e){this.notifyEventToHost(o.StopRecording,e)},e}());e.VideoController=s,function(e){e[e.StartRecording=1]="StartRecording",e[e.StopRecording=2]="StopRecording"}(o=e.MediaControllerEvent||(e.MediaControllerEvent={})),function(e){e[e.Photo=1]="Photo",e[e.Document=2]="Document",e[e.Whiteboard=3]="Whiteboard",e[e.BusinessCard=4]="BusinessCard"}(e.CameraStartMode||(e.CameraStartMode={})),function(e){e[e.Camera=1]="Camera",e[e.Gallery=2]="Gallery"}(e.Source||(e.Source={})),function(e){e[e.Image=1]="Image",e[e.Video=2]="Video",e[e.VideoAndImage=3]="VideoAndImage",e[e.Audio=4]="Audio"}(a=e.MediaType||(e.MediaType={})),function(e){e[e.ID=1]="ID",e[e.URL=2]="URL"}(e.ImageUriType||(e.ImageUriType={})),function(e){e[e.IMAGE=1]="IMAGE",e[e.PDF=2]="PDF"}(e.ImageOutputFormats||(e.ImageOutputFormats={})),e.selectMedia=function(e,t){if(!t)throw new Error("[select Media] Callback cannot be null");if(Ne(de,D.content,D.task),Oe(l)){try{yn(e)}catch(e){return void t(e,null)}if(wn(e))ft("selectMedia",[e],(function(n,r,o){if(o)bn(e)&&e.videoProps.videoController.notifyEventToApp(o);else if(r){for(var a=[],s=0,u=r;s<u.length;s++){var c=u[s];a.push(new i(c))}t(n,a)}else t(n,null)}));else{var n={errorCode:O.INVALID_ARGUMENTS};t(n,null)}}else{var r={errorCode:O.OLD_PLATFORM};t(r,null)}},e.viewImages=function(e,t){if(!t)throw new Error("[view images] Callback cannot be null");Ne(de,D.content,D.task),Oe(l)?En(e)?ft("viewImages",[e],t):t({errorCode:O.INVALID_ARGUMENTS}):t({errorCode:O.OLD_PLATFORM})},e.scanBarCode=function(e,t){if(!e)throw new Error("[media.scanBarCode] Callback cannot be null");Ne(de,D.content,D.task),w.hostClientType!==F.desktop&&w.hostClientType!==F.web&&w.hostClientType!==F.rigel&&w.hostClientType!==F.teamsRoomsWindows&&w.hostClientType!==F.teamsRoomsAndroid&&w.hostClientType!==F.teamsPhones&&w.hostClientType!==F.teamsDisplays?Oe(d)?Tn(t)?ft("media.scanBarCode",[t],e):e({errorCode:O.INVALID_ARGUMENTS},null):e({errorCode:O.OLD_PLATFORM},null):e({errorCode:O.NOT_SUPPORTED_ON_PLATFORM},null)}}(dn||(dn={})),function(e){function t(){return!!(Ne(de)&&de.supports.barCode&&de.supports.permissions)}e.scanBarCode=function(e){return new Promise((function(n){if(Ne(de,D.content,D.task),!t())throw z;if(!Tn(e))throw{errorCode:O.INVALID_ARGUMENTS};n(lt("media.scanBarCode",e))}))},e.hasPermission=function(){if(Ne(de,D.content,D.task),!t())throw z;var e=M.Media;return new Promise((function(t){t(lt("permissions.has",e))}))},e.requestPermission=function(){if(Ne(de,D.content,D.task),!t())throw z;var e=M.Media;return new Promise((function(t){t(lt("permissions.request",e))}))},e.isSupported=t}(hn||(hn={})),function(e){function t(e){return new Promise((function(t){if(Ne(de,D.content,D.task),!n())throw z;de.isLegacyTeams?t(ut("executeDeepLink",sn([e.user],void 0,e.message))):t(ut("chat.openChat",{members:e.user,message:e.message}))}))}function n(){return!(!Ne(de)||!de.supports.chat)}e.openChat=t,e.openGroupChat=function(e){return new Promise((function(r){if(e.users.length<1)throw Error("OpenGroupChat Failed: No users specified");if(1===e.users.length)t({user:e.users[0],message:e.message});else{if(Ne(de,D.content,D.task),!n())throw z;de.isLegacyTeams?r(ut("executeDeepLink",sn(e.users,e.topic,e.message))):r(ut("chat.openChat",{members:e.users,message:e.message,topic:e.topic}))}}))},e.isSupported=n}(fn||(fn={})),function(e){function t(){return!!(Ne(de)&&de.supports.geoLocation&&de.supports.permissions)}e.getCurrentLocation=function(){if(Ne(de,D.content,D.task),!t())throw z;return lt("location.getLocation",{allowChooseLocation:!1,showMap:!1})},e.hasPermission=function(){if(Ne(de,D.content,D.task),!t())throw z;var e=M.GeoLocation;return new Promise((function(t){t(lt("permissions.has",e))}))},e.requestPermission=function(){if(Ne(de,D.content,D.task),!t())throw z;var e=M.GeoLocation;return new Promise((function(t){t(lt("permissions.request",e))}))},e.isSupported=t,function(e){function t(){return!!(Ne(de)&&de.supports.geoLocation&&de.supports.geoLocation.map&&de.supports.permissions)}e.chooseLocation=function(){if(Ne(de,D.content,D.task),!t())throw z;return lt("location.getLocation",{allowChooseLocation:!0,showMap:!0})},e.showLocation=function(e){if(Ne(de,D.content,D.task),!t())throw z;if(!e)throw{errorCode:O.INVALID_ARGUMENTS};return lt("location.showLocation",e)},e.isSupported=t}(e.map||(e.map={}))}(pn||(pn={}));var Rn,_n,Pn=function(){function e(){}return e.prototype.postMessage=function(e,t){Ne(de),ft("messageForChild",[e],t||J())},e.prototype.addEventListener=function(e,t){Ne(de),"message"===e&&Ve("messageForParent",t)},e}(),Nn=function(){function e(){}return Object.defineProperty(e,"Instance",{get:function(){return this._instance||(this._instance=new this)},enumerable:!1,configurable:!0}),e.prototype.postMessage=function(e,t){Ne(de,D.task),ft("messageForParent",[e],t||J())},e.prototype.addEventListener=function(e,t){Ne(de,D.task),"message"===e&&Ve("messageForChild",t)},e}();!function(e){function t(){return!(!Ne(de)||!de.supports.secondaryBrowser)}e.open=function(e){if(Ne(de,D.content),!t())throw z;if(!e||!oe(e))throw{errorCode:O.INVALID_ARGUMENTS,message:"Invalid Url: Only https URL is allowed"};return lt("secondaryBrowser.open",e.toString())},e.isSupported=t}(Rn||(Rn={})),function(e){function t(){return!(!Ne(de)||!de.supports.location)}e.getLocation=function(e,n){if(!n)throw new Error("[location.getLocation] Callback cannot be null");if(Ne(de,D.content,D.task),!Oe(s))throw{errorCode:O.OLD_PLATFORM};if(!e)throw{errorCode:O.INVALID_ARGUMENTS};if(!t())throw z;ft("location.getLocation",[e],n)},e.showLocation=function(e,n){if(!n)throw new Error("[location.showLocation] Callback cannot be null");if(Ne(de,D.content,D.task),!Oe(s))throw{errorCode:O.OLD_PLATFORM};if(!e)throw{errorCode:O.INVALID_ARGUMENTS};if(!t())throw z;ft("location.showLocation",[e],n)},e.isSupported=t}(_n||(_n={}));var On,Mn,Fn,Zn,Dn,Ln,Bn=function(e,t,n,r){function i(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,o){function a(e){try{u(r.next(e))}catch(e){o(e)}}function s(e){try{u(r.throw(e))}catch(e){o(e)}}function u(e){e.done?n(e.value):i(e.value).then(a,s)}u((r=r.apply(e,t||[])).next())}))},qn=function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(e){return function(t){return u([e,t])}}function u(s){if(n)throw new TypeError("Generator is already executing.");for(;o&&(o=0,s[0]&&(a=0)),a;)try{if(n=1,r&&(i=2&s[0]?r.return:s[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,s[1])).done)return i;switch(r=0,i&&(s=[2&s[0],i.value]),s[0]){case 0:case 1:i=s;break;case 4:return a.label++,{value:s[1],done:!1};case 5:a.label++,r=s[1],s=[0];continue;case 7:s=a.ops.pop(),a.trys.pop();continue;default:if(!((i=(i=a.trys).length>0&&i[i.length-1])||6!==s[0]&&2!==s[0])){a=0;continue}if(3===s[0]&&(!i||s[1]>i[0]&&s[1]<i[3])){a.label=s[1];break}if(6===s[0]&&a.label<i[1]){a.label=i[1],i=s;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(s);break}i[2]&&a.ops.pop(),a.trys.pop();continue}s=t.call(e,a)}catch(e){s=[6,e],r=0}finally{n=i=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}};function jn(e){return e?e.modality&&"string"!=typeof e.modality?[!1,"modality must be a string"]:e.targetElementBoundingRect&&"object"==typeof e.targetElementBoundingRect?e.triggerType&&"string"==typeof e.triggerType?Un(e.persona):[!1,"triggerType must be a valid string"]:[!1,"targetElementBoundingRect must be a DOMRect"]:[!1,"A request object is required"]}function Un(e){return e?e.displayName&&"string"!=typeof e.displayName?[!1,"displayName must be a string"]:e.identifiers&&"object"==typeof e.identifiers?e.identifiers.AadObjectId||e.identifiers.Smtp||e.identifiers.Upn?e.identifiers.AadObjectId&&"string"!=typeof e.identifiers.AadObjectId?[!1,"AadObjectId identifier must be a string"]:e.identifiers.Smtp&&"string"!=typeof e.identifiers.Smtp?[!1,"Smtp identifier must be a string"]:e.identifiers.Upn&&"string"!=typeof e.identifiers.Upn?[!1,"Upn identifier must be a string"]:[!0,void 0]:[!1,"at least one valid identifier must be provided"]:[!1,"persona identifiers object must be provided"]:[!1,"persona object must be provided"]}!function(e){var t;function n(e,n){var r=this;ft("meeting.requestAppAudioHandling",[e.isAppHandlingAudio],(function(o,a){if(o&&null!=a)throw new Error("[requestAppAudioHandling] Callback response - both parameters cannot be set");if(o)throw new Error("[requestAppAudioHandling] Callback response - SDK error ".concat(o.errorCode," ").concat(o.message));if("boolean"!=typeof a)throw new Error("[requestAppAudioHandling] Callback response - isHostAudioless must be a boolean");Ve("meeting.micStateChanged",(function(n){return Bn(r,void 0,void 0,(function(){var r,o;return qn(this,(function(a){switch(a.label){case 0:return a.trys.push([0,2,,3]),[4,e.micMuteStateChangedCallback(n)];case 1:return r=a.sent(),o=r.isMicMuted===n.isMicMuted,i(r,o?t.HostInitiated:t.AppDeclinedToChange),[3,3];case 2:return a.sent(),i(n,t.AppFailedToChange),[3,3];case 3:return[2]}}))}))})),n(a)}))}function r(e,t){ft("meeting.requestAppAudioHandling",[e.isAppHandlingAudio],(function(e,n){if(e&&null!=n)throw new Error("[requestAppAudioHandling] Callback response - both parameters cannot be set");if(e)throw new Error("[requestAppAudioHandling] Callback response - SDK error ".concat(e.errorCode," ").concat(e.message));if("boolean"!=typeof n)throw new Error("[requestAppAudioHandling] Callback response - isHostAudioless must be a boolean");Ke("meeting.micStateChanged")&&Ge("meeting.micStateChanged"),t(n)}))}function i(e,t){Ne(de,D.sidePanel,D.meetingStage),ft("meeting.updateMicState",[e,t])}!function(e){e[e.HostInitiated=0]="HostInitiated",e[e.AppInitiated=1]="AppInitiated",e[e.AppDeclinedToChange=2]="AppDeclinedToChange",e[e.AppFailedToChange=3]="AppFailedToChange"}(t||(t={})),function(e){e.like="like",e.heart="heart",e.laugh="laugh",e.surprised="surprised",e.applause="applause"}(e.MeetingReactionType||(e.MeetingReactionType={})),function(e){e.Unknown="Unknown",e.Adhoc="Adhoc",e.Scheduled="Scheduled",e.Recurring="Recurring",e.Broadcast="Broadcast",e.MeetNow="MeetNow"}(e.MeetingType||(e.MeetingType={})),function(e){e.OneOnOneCall="oneOnOneCall",e.GroupCall="groupCall"}(e.CallType||(e.CallType={})),e.getIncomingClientAudioState=function(e){if(!e)throw new Error("[get incoming client audio state] Callback cannot be null");Ne(de,D.sidePanel,D.meetingStage),ft("getIncomingClientAudioState",e)},e.toggleIncomingClientAudio=function(e){if(!e)throw new Error("[toggle incoming client audio] Callback cannot be null");Ne(de,D.sidePanel,D.meetingStage),ft("toggleIncomingClientAudio",e)},e.getMeetingDetails=function(e){if(!e)throw new Error("[get meeting details] Callback cannot be null");Ne(de,D.sidePanel,D.meetingStage,D.settings,D.content),ft("meeting.getMeetingDetails",e)},e.getAuthenticationTokenForAnonymousUser=function(e){if(!e)throw new Error("[get Authentication Token For AnonymousUser] Callback cannot be null");Ne(de,D.sidePanel,D.meetingStage,D.task),ft("meeting.getAuthenticationTokenForAnonymousUser",e)},e.getLiveStreamState=function(e){if(!e)throw new Error("[get live stream state] Callback cannot be null");Ne(de,D.sidePanel),ft("meeting.getLiveStreamState",e)},e.requestStartLiveStreaming=function(e,t,n){if(!e)throw new Error("[request start live streaming] Callback cannot be null");Ne(de,D.sidePanel),ft("meeting.requestStartLiveStreaming",[t,n],e)},e.requestStopLiveStreaming=function(e){if(!e)throw new Error("[request stop live streaming] Callback cannot be null");Ne(de,D.sidePanel),ft("meeting.requestStopLiveStreaming",e)},e.registerLiveStreamChangedHandler=function(e){if(!e)throw new Error("[register live stream changed handler] Handler cannot be null");Ne(de,D.sidePanel),Ve("meeting.liveStreamChanged",e)},e.shareAppContentToStage=function(e,t){if(!e)throw new Error("[share app content to stage] Callback cannot be null");Ne(de,D.sidePanel,D.meetingStage),ft("meeting.shareAppContentToStage",[t],e)},e.getAppContentStageSharingCapabilities=function(e){if(!e)throw new Error("[get app content stage sharing capabilities] Callback cannot be null");Ne(de,D.sidePanel,D.meetingStage),ft("meeting.getAppContentStageSharingCapabilities",e)},e.stopSharingAppContentToStage=function(e){if(!e)throw new Error("[stop sharing app content to stage] Callback cannot be null");Ne(de,D.sidePanel,D.meetingStage),ft("meeting.stopSharingAppContentToStage",e)},e.getAppContentStageSharingState=function(e){if(!e)throw new Error("[get app content stage sharing state] Callback cannot be null");Ne(de,D.sidePanel,D.meetingStage),ft("meeting.getAppContentStageSharingState",e)},e.registerSpeakingStateChangeHandler=function(e){if(!e)throw new Error("[registerSpeakingStateChangeHandler] Handler cannot be null");Ne(de,D.sidePanel,D.meetingStage),Ve("meeting.speakingStateChanged",e)},e.registerRaiseHandStateChangedHandler=function(e){if(!e)throw new Error("[registerRaiseHandStateChangedHandler] Handler cannot be null");Ne(de,D.sidePanel,D.meetingStage),Ve("meeting.raiseHandStateChanged",e)},e.registerMeetingReactionReceivedHandler=function(e){if(!e)throw new Error("[registerMeetingReactionReceivedHandler] Handler cannot be null");Ne(de,D.sidePanel,D.meetingStage),Ve("meeting.meetingReactionReceived",e)},function(e){e.setOptions=function(e){Ne(de,D.sidePanel),e.contentUrl&&new URL(e.contentUrl),ft("meeting.appShareButton.setOptions",[e])}}(e.appShareButton||(e.appShareButton={})),e.requestAppAudioHandling=function(e,t){if(!t)throw new Error("[requestAppAudioHandling] Callback response cannot be null");if(!e.micMuteStateChangedCallback)throw new Error("[requestAppAudioHandling] Callback Mic mute state handler cannot be null");Ne(de,D.sidePanel,D.meetingStage),e.isAppHandlingAudio?n(e,t):r(e,t)},e.updateMicState=function(e){i(e,t.AppInitiated)}}(On||(On={})),function(e){function t(){return!(!Ne(de)||!de.supports.monetization)}e.openPurchaseExperience=function(e,n){var r,i;return"function"==typeof e?(r=e,i=n):i=e,Ne(de,D.content),te((function(){return new Promise((function(e){if(!t())throw z;e(lt("monetization.openPurchaseExperience",i))}))}),r)},e.isSupported=t}(Mn||(Mn={})),function(e){function t(){return!(!Ne(de)||!de.supports.calendar)}e.openCalendarItem=function(e){return new Promise((function(n){if(Ne(de,D.content),!t())throw new Error("Not supported");if(!e.itemId||!e.itemId.trim())throw new Error("Must supply an itemId to openCalendarItem");n(ut("calendar.openCalendarItem",e))}))},e.composeMeeting=function(e){return new Promise((function(n){if(Ne(de,D.content),!t())throw new Error("Not supported");de.isLegacyTeams?n(ut("executeDeepLink",cn(e.attendees,e.startTime,e.endTime,e.subject,e.content))):n(ut("calendar.composeMeeting",e))}))},e.isSupported=t}(Fn||(Fn={})),function(e){function t(){return!(!Ne(de)||!de.supports.mail)}e.openMailItem=function(e){return new Promise((function(n){if(Ne(de,D.content),!t())throw new Error("Not supported");if(!e.itemId||!e.itemId.trim())throw new Error("Must supply an itemId to openMailItem");n(ut("mail.openMailItem",e))}))},e.composeMail=function(e){return new Promise((function(n){if(Ne(de,D.content),!t())throw new Error("Not supported");n(ut("mail.composeMail",e))}))},e.isSupported=t,function(e){e.New="new",e.Reply="reply",e.ReplyAll="replyAll",e.Forward="forward"}(e.ComposeMailType||(e.ComposeMailType={}))}(Zn||(Zn={})),function(e){function t(e){return new Promise((function(t){if(!Oe(u))throw{errorCode:O.OLD_PLATFORM};if(!In(e))throw{errorCode:O.INVALID_ARGUMENTS};if(!n())throw z;t(lt("people.selectPeople",e))}))}function n(){return!(!Ne(de)||!de.supports.people)}e.selectPeople=function(e,n){var r,i,o;return Ne(de,D.content,D.task,D.settings),"function"==typeof e?(i=(r=[e,n])[0],o=r[1]):o=e,$(t,i,o)},e.isSupported=n}(Dn||(Dn={})),function(e){e.showProfile=function(e){return Ne(de,D.content),new Promise((function(t){var n=jn(e),r=n[0],i=n[1];if(!r)throw{errorCode:O.INVALID_ARGUMENTS,message:i};t(lt("profile.showProfile",{modality:e.modality,persona:e.persona,triggerType:e.triggerType,targetRectangle:{x:e.targetElementBoundingRect.x,y:e.targetElementBoundingRect.y,width:e.targetElementBoundingRect.width,height:e.targetElementBoundingRect.height}}))}))},e.isSupported=function(){return!(!Ne(de)||!de.supports.profile)}}(Ln||(Ln={}));var Hn,zn=function(){function e(){}return e.setTimeout=function(t,n){var r=performance.now(),i=Y();return e.setTimeoutCallbacks[i]={callback:t,timeoutInMs:n,startedAtInMs:r},i},e.clearTimeout=function(t){delete e.setTimeoutCallbacks[t]},e.setInterval=function(t,n){e.setTimeout((function r(){t(),e.setTimeout(r,n)}),n)},e.tick=function(){var t=performance.now(),n=[];for(var r in e.setTimeoutCallbacks)t-(a=e.setTimeoutCallbacks[r]).startedAtInMs>=a.timeoutInMs&&n.push(r);for(var i=0,o=n;i<o.length;i++){var a,s=o[i];(a=e.setTimeoutCallbacks[s]).callback(),delete e.setTimeoutCallbacks[s]}},e.setTimeoutCallbacks={},e}(),Vn=function(){function e(e,t){this.reportStatisticsResult=t,this.sampleCount=0,this.distributionBins=new Uint32Array(e)}return e.prototype.processStarts=function(e,t,n,r){zn.tick(),this.suitableForThisSession(e,t,n,r)||this.reportAndResetSession(this.getStatistics(),e,r,t,n),this.start()},e.prototype.processEnds=function(){var e=performance.now()-this.frameProcessingStartedAt,t=Math.floor(Math.max(0,Math.min(this.distributionBins.length-1,e)));this.distributionBins[t]+=1,this.sampleCount+=1},e.prototype.getStatistics=function(){return this.currentSession?{effectId:this.currentSession.effectId,effectParam:this.currentSession.effectParam,frameHeight:this.currentSession.frameHeight,frameWidth:this.currentSession.frameWidth,duration:performance.now()-this.currentSession.startedAtInMs,sampleCount:this.sampleCount,distributionBins:this.distributionBins.slice()}:null},e.prototype.start=function(){this.frameProcessingStartedAt=performance.now()},e.prototype.suitableForThisSession=function(e,t,n,r){return this.currentSession&&this.currentSession.effectId===e&&this.currentSession.effectParam===r&&this.currentSession.frameWidth===t&&this.currentSession.frameHeight===n},e.prototype.reportAndResetSession=function(e,t,n,r,i){var o=this;e&&this.reportStatisticsResult(e),this.resetCurrentSession(this.getNextTimeout(t,this.currentSession),t,n,r,i),this.timeoutId&&zn.clearTimeout(this.timeoutId),this.timeoutId=zn.setTimeout(function(){return o.reportAndResetSession(o.getStatistics(),t,n,r,i)}.bind(this),this.currentSession.timeoutInMs)},e.prototype.resetCurrentSession=function(e,t,n,r,i){this.currentSession={startedAtInMs:performance.now(),timeoutInMs:e,effectId:t,effectParam:n,frameWidth:r,frameHeight:i},this.sampleCount=0,this.distributionBins.fill(0)},e.prototype.getNextTimeout=function(t,n){return n&&n.effectId===t?Math.min(e.maxSessionTimeoutInMs,2*n.timeoutInMs):e.initialSessionTimeoutInMs},e.initialSessionTimeoutInMs=1e3,e.maxSessionTimeoutInMs=3e4,e}(),Gn=function(){function e(t){var n=this;this.reportPerformanceEvent=t,this.isFirstFrameProcessed=!1,this.frameProcessTimeLimit=100,this.frameProcessingStartedAt=0,this.frameProcessingTimeCost=0,this.processedFrameCount=0,this.performanceStatistics=new Vn(e.distributionBinSize,(function(e){return n.reportPerformanceEvent("video.performance.performanceDataGenerated",[e])}))}return e.prototype.startMonitorSlowFrameProcessing=function(){var t=this;zn.setInterval((function(){if(0!==t.processedFrameCount){var e=t.frameProcessingTimeCost/t.processedFrameCount;e>t.frameProcessTimeLimit&&t.reportPerformanceEvent("video.performance.frameProcessingSlow",[e]),t.frameProcessingTimeCost=0,t.processedFrameCount=0}}),e.calculateFPSInterval)},e.prototype.setFrameProcessTimeLimit=function(e){this.frameProcessTimeLimit=e},e.prototype.reportApplyingVideoEffect=function(e,t){var n,r;(null===(n=this.applyingEffect)||void 0===n?void 0:n.effectId)===e&&(null===(r=this.applyingEffect)||void 0===r?void 0:r.effectParam)===t||(this.applyingEffect={effectId:e,effectParam:t},this.appliedEffect=void 0)},e.prototype.reportVideoEffectChanged=function(e,t){void 0===this.applyingEffect||this.applyingEffect.effectId!==e&&this.applyingEffect.effectParam!==t||(this.appliedEffect={effectId:e,effectParam:t},this.applyingEffect=void 0,this.isFirstFrameProcessed=!1)},e.prototype.reportStartFrameProcessing=function(e,t){zn.tick(),this.appliedEffect&&(this.frameProcessingStartedAt=performance.now(),this.performanceStatistics.processStarts(this.appliedEffect.effectId,e,t,this.appliedEffect.effectParam))},e.prototype.reportFrameProcessed=function(){var e;this.appliedEffect&&(this.processedFrameCount++,this.frameProcessingTimeCost+=performance.now()-this.frameProcessingStartedAt,this.performanceStatistics.processEnds(),this.isFirstFrameProcessed||(this.isFirstFrameProcessed=!0,this.reportPerformanceEvent("video.performance.firstFrameProcessed",[Date.now(),this.appliedEffect.effectId,null===(e=this.appliedEffect)||void 0===e?void 0:e.effectParam])))},e.prototype.reportGettingTextureStream=function(e){this.gettingTextureStreamStartedAt=performance.now(),this.currentStreamId=e},e.prototype.reportTextureStreamAcquired=function(){if(void 0!==this.gettingTextureStreamStartedAt){var e=performance.now()-this.gettingTextureStreamStartedAt;this.reportPerformanceEvent("video.performance.textureStreamAcquired",[this.currentStreamId,e])}},e.distributionBinSize=1e3,e.calculateFPSInterval=1e3,e}(),Kn=function(e,t,n,r){function i(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,o){function a(e){try{u(r.next(e))}catch(e){o(e)}}function s(e){try{u(r.throw(e))}catch(e){o(e)}}function u(e){e.done?n(e.value):i(e.value).then(a,s)}u((r=r.apply(e,t||[])).next())}))},Wn=function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(e){return function(t){return u([e,t])}}function u(s){if(n)throw new TypeError("Generator is already executing.");for(;o&&(o=0,s[0]&&(a=0)),a;)try{if(n=1,r&&(i=2&s[0]?r.return:s[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,s[1])).done)return i;switch(r=0,i&&(s=[2&s[0],i.value]),s[0]){case 0:case 1:i=s;break;case 4:return a.label++,{value:s[1],done:!1};case 5:a.label++,r=s[1],s=[0];continue;case 7:s=a.ops.pop(),a.trys.pop();continue;default:if(!((i=(i=a.trys).length>0&&i[i.length-1])||6!==s[0]&&2!==s[0])){a=0;continue}if(3===s[0]&&(!i||s[1]>i[0]&&s[1]<i[3])){a.label=s[1];break}if(6===s[0]&&a.label<i[1]){a.label=i[1],i=s;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(s);break}i[2]&&a.ops.pop(),a.trys.pop();continue}s=t.call(e,a)}catch(e){s=[6,e],r=0}finally{n=i=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}};function Jn(e,t,n,r){return Kn(this,void 0,void 0,(function(){var i;return Wn(this,(function(o){switch(o.label){case 0:return i=Xn,[4,Yn(e,n,r)];case 1:return[2,i.apply(void 0,[o.sent(),new $n(n,t)])]}}))}))}function Qn(e,t,n,r){return Kn(this,void 0,void 0,(function(){var i;return Wn(this,(function(o){switch(o.label){case 0:return i=Xn,[4,Yn(e,n,r)];case 1:return[2,i.apply(void 0,[o.sent(),new nr(n,t)])]}}))}))}function Yn(e,t,n){return Kn(this,void 0,void 0,(function(){var r,i,o,a,s;return Wn(this,(function(u){switch(u.label){case 0:if(De())throw z;r=window.chrome,u.label=1;case 1:return u.trys.push([1,3,,4]),null==n||n.reportGettingTextureStream(e),[4,r.webview.getTextureStream(e)];case 2:if(i=u.sent(),0===(o=i.getVideoTracks()).length)throw new Error("No video track in stream ".concat(e));return null==n||n.reportTextureStreamAcquired(),[2,o[0]];case 3:throw a=u.sent(),s="Failed to get video track from stream ".concat(e,", error: ").concat(a),t(s),new Error("Internal error: can't get video track from stream ".concat(e));case 4:return[2]}}))}))}function Xn(e,t){if(De())throw z;var n=new(0,window.MediaStreamTrackProcessor)({track:e}).readable,r=new(0,window.MediaStreamTrackGenerator)({kind:"video"}),i=r.writable;return n.pipeThrough(new TransformStream(t)).pipeTo(i),r}!function(e){e.TimestampIsNull="timestamp of the original video frame is null",e.UnsupportedVideoFramePixelFormat="Unsupported video frame pixel format"}(Hn||(Hn={}));var $n=function(e,t){var n=this;this.notifyError=e,this.videoFrameHandler=t,this.transform=function(e,t){return Kn(n,void 0,void 0,(function(){var n,r,i,o;return Wn(this,(function(a){switch(a.label){case 0:if(null===(n=e.timestamp))return[3,5];a.label=1;case 1:return a.trys.push([1,3,,4]),[4,this.videoFrameHandler({videoFrame:e})];case 2:return r=a.sent(),i=new VideoFrame(r,{timestamp:n}),t.enqueue(i),e.close(),r.close(),[3,4];case 3:return o=a.sent(),e.close(),this.notifyError(o),[3,4];case 4:return[3,6];case 5:this.notifyError(Hn.TimestampIsNull),a.label=6;case 6:return[2]}}))}))}},er=function(){function e(e,t){if(this.headerBuffer=e,this.notifyError=t,this.ONE_TEXTURE_INPUT_ID=1869900081,this.INVALID_HEADER_ERROR="Invalid video frame header",this.UNSUPPORTED_LAYOUT_ERROR="Unsupported texture layout",this.headerDataView=new Uint32Array(e),this.headerDataView.length<8)throw this.notifyError(this.INVALID_HEADER_ERROR),new Error(this.INVALID_HEADER_ERROR);if(this.headerDataView[0]!==this.ONE_TEXTURE_INPUT_ID)throw this.notifyError(this.UNSUPPORTED_LAYOUT_ERROR),new Error(this.UNSUPPORTED_LAYOUT_ERROR)}return Object.defineProperty(e.prototype,"oneTextureLayoutId",{get:function(){return this.headerDataView[0]},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"version",{get:function(){return this.headerDataView[1]},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"frameRowOffset",{get:function(){return this.headerDataView[2]},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"frameFormat",{get:function(){return this.headerDataView[3]},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"frameWidth",{get:function(){return this.headerDataView[4]},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"frameHeight",{get:function(){return this.headerDataView[5]},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"multiStreamHeaderRowOffset",{get:function(){return this.headerDataView[6]},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"multiStreamCount",{get:function(){return this.headerDataView[7]},enumerable:!1,configurable:!0}),e}(),tr=function(){function e(e,t){this.metadataMap=new Map,this.AUDIO_INFERENCE_RESULT_STREAM_ID=828664161;for(var n=new Uint32Array(e),r=0,i=0;r<t;r++){var o=n[i++],a=n[i++],s=n[i++],u=new Uint8Array(e,a,s);this.metadataMap.set(o,u)}}return Object.defineProperty(e.prototype,"audioInferenceResult",{get:function(){return this.metadataMap.get(this.AUDIO_INFERENCE_RESULT_STREAM_ID)},enumerable:!1,configurable:!0}),e}(),nr=function(e,t){var n=this;this.notifyError=e,this.videoFrameHandler=t,this.shouldDiscardAudioInferenceResult=!1,this.transform=function(e,t){return Kn(n,void 0,void 0,(function(){var n,r,i,o,a,s,u,c;return Wn(this,(function(l){switch(l.label){case 0:if(null===(n=e.timestamp))return[3,6];l.label=1;case 1:return l.trys.push([1,4,,5]),[4,this.extractVideoFrameAndMetadata(e)];case 2:return r=l.sent(),i=r.videoFrame,o=r.metadata,a=(void 0===o?{}:o).audioInferenceResult,[4,this.videoFrameHandler({videoFrame:i,audioInferenceResult:a})];case 3:return s=l.sent(),u=new VideoFrame(s,{timestamp:n}),t.enqueue(u),i.close(),e.close(),s.close(),[3,5];case 4:return c=l.sent(),e.close(),this.notifyError(c),[3,5];case 5:return[3,7];case 6:this.notifyError(Hn.TimestampIsNull),l.label=7;case 7:return[2]}}))}))},this.extractVideoFrameAndMetadata=function(e){return Kn(n,void 0,void 0,(function(){var t,n,r,i,o,a;return Wn(this,(function(s){switch(s.label){case 0:if(De())throw z;if("NV12"!==e.format)throw this.notifyError(Hn.UnsupportedVideoFramePixelFormat),new Error(Hn.UnsupportedVideoFramePixelFormat);return t={x:0,y:0,width:e.codedWidth,height:2},n=new ArrayBuffer(t.width*t.height*3/2),[4,e.copyTo(n,{rect:t})];case 1:return s.sent(),r=new er(n,this.notifyError),i={x:0,y:r.multiStreamHeaderRowOffset,width:e.codedWidth,height:e.codedHeight-r.multiStreamHeaderRowOffset},o=new ArrayBuffer(i.width*i.height*3/2),[4,e.copyTo(o,{rect:i})];case 2:return s.sent(),a=new tr(o,r.multiStreamCount),[2,{videoFrame:new VideoFrame(e,{timestamp:e.timestamp,visibleRect:{x:0,y:r.frameRowOffset,width:r.frameWidth,height:r.frameHeight}}),metadata:{audioInferenceResult:this.shouldDiscardAudioInferenceResult?void 0:a.audioInferenceResult}}]}}))}))},Ve("video.mediaStream.audioInferenceDiscardStatusChange",(function(e){var t=e.discardAudioInferenceResult;n.shouldDiscardAudioInferenceResult=t}))};function rr(e,t){return function(n,r){null==t||t.reportApplyingVideoEffect(n||"",r),e(n,r).then((function(){null==t||t.reportVideoEffectChanged(n||"",r),ft("video.videoEffectReadiness",[!0,n,void 0,r])})).catch((function(e){var t=e in ir.EffectFailureReason?e:ir.EffectFailureReason.InitializationFailure;ft("video.videoEffectReadiness",[!1,n,t,r])}))}}var ir,or,ar,sr,ur,cr,lr,dr,hr=function(){return hr=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},hr.apply(this,arguments)},fr=function(e,t,n,r){function i(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,o){function a(e){try{u(r.next(e))}catch(e){o(e)}}function s(e){try{u(r.throw(e))}catch(e){o(e)}}function u(e){e.done?n(e.value):i(e.value).then(a,s)}u((r=r.apply(e,t||[])).next())}))},pr=function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(e){return function(t){return u([e,t])}}function u(s){if(n)throw new TypeError("Generator is already executing.");for(;o&&(o=0,s[0]&&(a=0)),a;)try{if(n=1,r&&(i=2&s[0]?r.return:s[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,s[1])).done)return i;switch(r=0,i&&(s=[2&s[0],i.value]),s[0]){case 0:case 1:i=s;break;case 4:return a.label++,{value:s[1],done:!1};case 5:a.label++,r=s[1],s=[0];continue;case 7:s=a.ops.pop(),a.trys.pop();continue;default:if(!((i=(i=a.trys).length>0&&i[i.length-1])||6!==s[0]&&2!==s[0])){a=0;continue}if(3===s[0]&&(!i||s[1]>i[0]&&s[1]<i[3])){a.label=s[1];break}if(6===s[0]&&a.label<i[1]){a.label=i[1],i=s;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(s);break}i[2]&&a.ops.pop(),a.trys.pop();continue}s=t.call(e,a)}catch(e){s=[6,e],r=0}finally{n=i=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}},vr=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};function gr(e,t){Ee.initialize(t).then((function(){e&&e()}))}function mr(){xe.enablePrintCapability()}function yr(){xe.print()}function br(e){Pe(),ft("getContext",(function(t){t.frameContext||(t.frameContext=w.frameContext),e(t)}))}function wr(e){Ee.registerOnThemeChangeHandler(e)}function Sr(e){We("fullScreenChange",e,[])}function kr(e){We("appButtonClick",e,[D.content])}function Cr(e){We("appButtonHoverEnter",e,[D.content])}function xr(e){We("appButtonHoverLeave",e,[D.content])}function Er(e){Te.backStack.registerBackButtonHandlerHelper(e)}function Tr(e){xe.registerOnLoadHandlerHelper(e)}function Ir(e){xe.registerBeforeUnloadHandlerHelper(e)}function Ar(e){We("focusEnter",e,[])}function Rr(e){We("changeSettings",e,[D.content])}function _r(e,t){Ne(de),Te.tabs.getTabInstances(t).then((function(t){e(t)}))}function Pr(e,t){Ne(de),Te.tabs.getMruTabInstances(t).then((function(t){e(t)}))}function Nr(e){Te.shareDeepLink({subPageId:e.subEntityId,subPageLabel:e.subEntityLabel,subPageWebUrl:e.subEntityWebUrl})}function Or(e,t){Ne(de,D.content,D.sidePanel,D.settings,D.task,D.stage,D.meetingStage),t=t||J(),Ee.openLink(e).then((function(){t(!0)})).catch((function(e){t(!1,e.message)}))}function Mr(e){Te.setCurrentFrame(e)}function Fr(e,t,n){Te.initializeWithFrameContext(e,t,n)}function Zr(e){Te.returnFocus(e)}function Dr(e,t){Ne(de),t=t||J(),Te.tabs.navigateToTab(e).then((function(){t(!0)})).catch((function(e){t(!1,e.message)}))}function Lr(e,t){Ne(de,D.content,D.sidePanel,D.settings,D.remove,D.task,D.stage,D.meetingStage),t=t||J(),Te.navigateCrossDomain(e).then((function(){t(!0)})).catch((function(e){t(!1,e.message)}))}function Br(e){Ne(de),e=e||J(),Te.backStack.navigateBack().then((function(){e(!0)})).catch((function(t){e(!1,t.message)}))}!function(e){var t=De()?void 0:new Gn(ft);function n(e){ft("video.videoFrameProcessed",[e])}function r(e){ft("video.notifyError",[e])}function i(){return Ne(de)&&!!de.supports.video&&(!!de.supports.video.mediaStream||!!de.supports.video.sharedFrame)}function o(e,n){var o=this;if(Ne(de,D.sidePanel),!i()||!c())throw z;Ve("video.startVideoExtensibilityVideoStream",(function(n){return fr(o,void 0,void 0,(function(){var i,o,s,u,c;return pr(this,(function(l){switch(l.label){case 0:return i=n.streamId,o=a(e,t),[4,Jn(i,o,r,t)];case 1:return s=l.sent(),!De()&&(null===(c=null===(u=window.chrome)||void 0===u?void 0:u.webview)||void 0===c||c.registerTextureStream(i,s)),[2]}}))}))}),!1),ft("video.mediaStream.registerForVideoFrame",[n])}function a(e,t){var n=this;return function(r){return fr(n,void 0,void 0,(function(){var n,i;return pr(this,(function(o){switch(o.label){case 0:return n=r.videoFrame,null==t||t.reportStartFrameProcessing(n.codedWidth,n.codedHeight),[4,e(r)];case 1:return i=o.sent(),null==t||t.reportFrameProcessed(),[2,i]}}))}))}}function s(e,o){if(Ne(de,D.sidePanel),!i()||!d())throw z;Ve("video.newVideoFrame",(function(i){if(i){var o=i.timestamp;null==t||t.reportStartFrameProcessing(i.width,i.height),e(u(i),(function(){null==t||t.reportFrameProcessed(),n(o)}),r)}}),!1),ft("video.registerForVideoFrame",[o])}function u(e){if("videoFrameBuffer"in e)return e;var t=e.data,n=vr(e,["data"]);return hr(hr({},n),{videoFrameBuffer:t})}function c(){var e;return Ne(de,D.sidePanel)&&l()&&!!(null===(e=de.supports.video)||void 0===e?void 0:e.mediaStream)}function l(){var e,t,n,r;return!De()&&!(!(null===(t=null===(e=window.chrome)||void 0===e?void 0:e.webview)||void 0===t?void 0:t.getTextureStream)||!(null===(r=null===(n=window.chrome)||void 0===n?void 0:n.webview)||void 0===r?void 0:r.registerTextureStream))}function d(){var e;return Ne(de,D.sidePanel)&&!!(null===(e=de.supports.video)||void 0===e?void 0:e.sharedFrame)}!function(e){e.NV12="NV12"}(e.VideoFrameFormat||(e.VideoFrameFormat={})),function(e){e.EffectChanged="EffectChanged",e.EffectDisabled="EffectDisabled"}(e.EffectChangeType||(e.EffectChangeType={})),function(e){e.InvalidEffectId="InvalidEffectId",e.InitializationFailure="InitializationFailure"}(e.EffectFailureReason||(e.EffectFailureReason={})),e.registerForVideoFrame=function(e){if(Ne(de,D.sidePanel),!i())throw z;if(!e.videoFrameHandler||!e.videoBufferHandler)throw new Error("Both videoFrameHandler and videoBufferHandler must be provided");if(Ve("video.setFrameProcessTimeLimit",(function(e){return null==t?void 0:t.setFrameProcessTimeLimit(e.timeLimit)}),!1),c())o(e.videoFrameHandler,e.config);else{if(!d())throw z;s(e.videoBufferHandler,e.config)}null==t||t.startMonitorSlowFrameProcessing()},e.notifySelectedVideoEffectChanged=function(e,t){if(Ne(de,D.sidePanel),!i())throw z;ft("video.videoEffectChanged",[e,t])},e.registerForVideoEffect=function(e){if(Ne(de,D.sidePanel),!i())throw z;Ve("video.effectParameterChange",rr(e,t),!1),ft("video.registerForVideoEffect")},e.isSupported=i}(ir||(ir={})),function(e){var t="search.queryChange",n="search.queryClose",r="search.queryExecute";function i(){return!(!Ne(de)||!de.supports.search)}e.registerHandlers=function(e,o,a){if(Ne(de,D.content),!i())throw z;Ve(n,e),Ve(r,o),a&&Ve(t,a)},e.unregisterHandlers=function(){if(Ne(de,D.content),!i())throw z;ft("search.unregister"),Ge(t),Ge(n),Ge(r)},e.isSupported=i,e.closeSearch=function(){return new Promise((function(e){if(Ne(de,D.content),!i())throw new Error("Not supported");e(ut("search.closeSearch"))}))}}(or||(or={})),function(e){function t(t){return new Promise((function(n){if(!o())throw z;n(lt(e.SharingAPIMessages.shareWebContent,t))}))}function n(e){if(!(e&&e.content&&e.content.length))throw{errorCode:O.INVALID_ARGUMENTS,message:"Shared content is missing"}}function r(e){if(e.content.some((function(e){return!e.type})))throw{errorCode:O.INVALID_ARGUMENTS,message:"Shared content type cannot be undefined"};if(e.content.some((function(t){return t.type!==e.content[0].type})))throw{errorCode:O.INVALID_ARGUMENTS,message:"Shared content must be of the same type"}}function i(e){if("URL"!==e.content[0].type)throw{errorCode:O.INVALID_ARGUMENTS,message:"Content type is unsupported"};if(e.content.some((function(e){return!e.url})))throw{errorCode:O.INVALID_ARGUMENTS,message:"URLs are required for URL content types"}}function o(){return!(!Ne(de)||!de.supports.sharing)}e.SharingAPIMessages={shareWebContent:"sharing.shareWebContent"},e.shareWebContent=function(e,o){try{n(e),r(e),i(e)}catch(e){return ee((function(){return Promise.reject(e)}),o)}return Ne(de,D.content,D.sidePanel,D.task,D.stage,D.meetingStage),ee(t,o,e)},e.isSupported=o}(ar||(ar={})),function(e){function t(){return!(!Ne(de)||!de.supports.stageView)}e.open=function(e){return new Promise((function(n){if(Ne(de,D.content),!t())throw z;if(!e)throw new Error("[stageView.open] Stage view params cannot be null");n(lt("stageView.open",e))}))},e.isSupported=t}(sr||(sr={})),function(e){function t(){return!(!Ne(de)||!de.supports.webStorage)}e.isWebStorageClearedOnUserLogOut=function(){return Ne(de),t()},e.isSupported=t}(ur||(ur={})),function(e){var t;function n(){return!(!Ne(de)||!de.supports.call)}!function(e){e.Unknown="unknown",e.Audio="audio",e.Video="video",e.VideoBasedScreenSharing="videoBasedScreenSharing",e.Data="data"}(t=e.CallModalities||(e.CallModalities={})),e.startCall=function(e){return new Promise((function(r){var i;if(Ne(de,D.content,D.task),!n())throw z;if(!de.isLegacyTeams)return ft("call.startCall",[e],r);r(st("executeDeepLink",un(e.targets,null===(i=e.requestedModalities)||void 0===i?void 0:i.includes(t.Video),e.source)).then((function(e){if(!e)throw new Error(b);return e})))}))},e.isSupported=n}(cr||(cr={})),function(e){e.Messages=Ee.Messages,e.FailedReason=Ee.FailedReason,e.ExpectedFailureReason=Ee.ExpectedFailureReason,e.notifyAppLoaded=function(){Ee.notifyAppLoaded()},e.notifySuccess=function(){Ee.notifySuccess()},e.notifyFailure=function(e){Ee.notifyFailure(e)},e.notifyExpectedFailure=function(e){Ee.notifyExpectedFailure(e)}}(lr||(lr={})),function(e){e.setValidityState=function(e){Te.config.setValidityState(e)},e.getSettings=function(e){Ne(de,D.content,D.settings,D.remove,D.sidePanel),Te.getConfig().then((function(t){e(t)}))},e.setSettings=function(e,t){Ne(de,D.content,D.settings,D.sidePanel),t=t||J(),Te.config.setConfig(e).then((function(){t(!0)})).catch((function(e){t(!1,e.message)}))},e.registerOnSaveHandler=function(e){Te.config.registerOnSaveHandlerHelper(e)},e.registerOnRemoveHandler=function(e){Te.config.registerOnRemoveHandlerHelper(e)}}(dr||(dr={}));var qr,jr,Ur=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};!function(e){function t(e){return{url:e.url,size:{height:e.height?e.height:H.Small,width:e.width?e.width:H.Small},title:e.title,fallbackUrl:e.fallbackUrl}}function n(e){return{url:e.url,size:{height:e.height?e.height:H.Small,width:e.width?e.width:H.Small},title:e.title,fallbackUrl:e.fallbackUrl,completionBotId:e.completionBotId}}function r(e){return e.height=e.height?e.height:H.Small,e.width=e.width?e.width:H.Small,e}e.startTask=function(e,r){var i=r?function(e){return r(e.err,e.result)}:void 0;return void 0===e.card&&void 0===e.url||e.card?(Ne(de,D.content,D.sidePanel,D.meetingStage),ft("tasks.startTask",[e],r)):void 0!==e.completionBotId?ke.url.bot.open(n(e),i):ke.url.open(t(e),i),new Pn},e.updateTask=function(e){(e=r(e)).width,e.height;var t=Ur(e,["width","height"]);if(Object.keys(t).length)throw new Error("resize requires a TaskInfo argument containing only width and height");ke.update.resize(e)},e.submitTask=function(e,t){ke.url.submit(e,t)},e.getDefaultSizeIfNotProvided=r}(qr||(qr={})),function(e){!function(e){e.guest="Guest",e.attendee="Attendee",e.presenter="Presenter",e.organizer="Organizer"}(e.UserMeetingRole||(e.UserMeetingRole={})),function(e){e.added="Added",e.alreadyExists="AlreadyExists",e.conflict="Conflict",e.notFound="NotFound"}(e.ContainerState||(e.ContainerState={})),e.isSupported=function(){return!(!Ne(de,D.meetingStage,D.sidePanel)||!de.supports.interactive)}}(jr||(jr={}));var Hr=function(){function e(){}return e.prototype.getFluidTenantInfo=function(){return zr(),new Promise((function(e){e(lt("interactive.getFluidTenantInfo"))}))},e.prototype.getFluidToken=function(e){return zr(),new Promise((function(t){t(lt("interactive.getFluidToken",e))}))},e.prototype.getFluidContainerId=function(){return zr(),new Promise((function(e){e(lt("interactive.getFluidContainerId"))}))},e.prototype.setFluidContainerId=function(e){return zr(),new Promise((function(t){t(lt("interactive.setFluidContainerId",e))}))},e.prototype.getNtpTime=function(){return zr(),new Promise((function(e){e(lt("interactive.getNtpTime"))}))},e.prototype.registerClientId=function(e){return zr(),new Promise((function(t){t(lt("interactive.registerClientId",e))}))},e.prototype.getClientRoles=function(e){return zr(),new Promise((function(t){t(lt("interactive.getClientRoles",e))}))},e.prototype.getClientInfo=function(e){return zr(),new Promise((function(t){t(lt("interactive.getClientInfo",e))}))},e.create=function(){return zr(),new e},e}();function zr(){if(!jr.isSupported())throw new Error("LiveShareHost Not supported")}var Vr=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i,Gr=function(e){return"string"==typeof e&&Vr.test(e)},Kr=function(){return Kr=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},Kr.apply(this,arguments)},Wr=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};function Jr(e){try{return e.cartItems=Qr(e.cartItems),e}catch(e){throw new Error("Error deserializing cart")}}function Qr(e){return e.map((function(e){if(e.imageURL){var t=new URL(e.imageURL);e.imageURL=t}return e.accessories&&(e.accessories=Qr(e.accessories)),e}))}var Yr=function e(t){try{return t.map((function(t){var n=t.imageURL,r=t.accessories,i=Wr(t,["imageURL","accessories"]),o=Kr({},i);return n&&(o.imageURL=n.href),r&&(o.accessories=e(r)),o}))}catch(t){throw new Error("Error serializing cart items")}};function Xr(e){if(!Array.isArray(e)||0===e.length)throw new Error("cartItems must be a non-empty array");for(var t=0,n=e;t<n.length;t++){var r=n[t];ei(r),$r(r.accessories)}}function $r(e){if(null!=e){if(!Array.isArray(e)||0===e.length)throw new Error("CartItem.accessories must be a non-empty array");for(var t=0,n=e;t<n.length;t++){var r=n[t];if(r.accessories)throw new Error("Item in CartItem.accessories cannot have accessories");ei(r)}}}function ei(e){if(!e.id)throw new Error("cartItem.id must not be empty");if(!e.name)throw new Error("cartItem.name must not be empty");ni(e.price),ri(e.quantity)}function ti(e){if(null!=e){if(!e)throw new Error("id must not be empty");if(!1===Gr(e))throw new Error("id must be a valid UUID")}}function ni(e){if("number"!=typeof e||e<0)throw new Error("price ".concat(e," must be a number not less than 0"));if(parseFloat(e.toFixed(3))!==e)throw new Error("price ".concat(e," must have at most 3 decimal places"))}function ri(e){if("number"!=typeof e||e<=0||parseInt(e.toString())!==e)throw new Error("quantity ".concat(e," must be an integer greater than 0"))}function ii(e){if(!Object.values(oi.CartStatus).includes(e))throw new Error("cartStatus ".concat(e," is not valid"))}var oi,ai,si,ui,ci,li,di,hi=function(){return hi=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},hi.apply(this,arguments)};!function(e){function t(){return!(!Ne(de)||!de.supports.marketplace)}e.cartVersion={majorVersion:1,minorVersion:1},function(e){e.TACAdminUser="TACAdminUser",e.TeamsAdminUser="TeamsAdminUser",e.TeamsEndUser="TeamsEndUser"}(e.Intent||(e.Intent={})),function(e){e.Open="Open",e.Processing="Processing",e.Processed="Processed",e.Closed="Closed",e.Error="Error"}(e.CartStatus||(e.CartStatus={})),e.getCart=function(){if(Ne(de,D.content,D.task),!t())throw z;return lt("marketplace.getCart",e.cartVersion).then(Jr)},e.addOrUpdateCartItems=function(n){if(Ne(de,D.content,D.task),!t())throw z;if(!n)throw new Error("addOrUpdateCartItemsParams must be provided");return ti(null==n?void 0:n.cartId),Xr(null==n?void 0:n.cartItems),lt("marketplace.addOrUpdateCartItems",hi(hi({},n),{cartItems:Yr(n.cartItems),cartVersion:e.cartVersion})).then(Jr)},e.removeCartItems=function(n){if(Ne(de,D.content,D.task),!t())throw z;if(!n)throw new Error("removeCartItemsParams must be provided");if(ti(null==n?void 0:n.cartId),!Array.isArray(null==n?void 0:n.cartItemIds)||0===(null==n?void 0:n.cartItemIds.length))throw new Error("cartItemIds must be a non-empty array");return lt("marketplace.removeCartItems",hi(hi({},n),{cartVersion:e.cartVersion})).then(Jr)},e.updateCartStatus=function(n){if(Ne(de,D.content,D.task),!t())throw z;if(!n)throw new Error("updateCartStatusParams must be provided");return ti(null==n?void 0:n.cartId),ii(null==n?void 0:n.cartStatus),lt("marketplace.updateCartStatus",hi(hi({},n),{cartVersion:e.cartVersion})).then(Jr)},e.isSupported=t}(oi||(oi={})),function(e){function t(e,t){return{errorCode:e,message:t}}!function(e){e.Dropbox="DROPBOX",e.Box="BOX",e.Sharefile="SHAREFILE",e.GoogleDrive="GOOGLEDRIVE",e.Egnyte="EGNYTE",e.SharePoint="SharePoint"}(e.CloudStorageProvider||(e.CloudStorageProvider={})),function(e){e[e.Sharepoint=0]="Sharepoint",e[e.WopiIntegration=1]="WopiIntegration",e[e.Google=2]="Google",e[e.OneDrive=3]="OneDrive",e[e.Recent=4]="Recent",e[e.Aggregate=5]="Aggregate",e[e.FileSystem=6]="FileSystem",e[e.Search=7]="Search",e[e.AllFiles=8]="AllFiles",e[e.SharedWithMe=9]="SharedWithMe"}(e.CloudStorageProviderType||(e.CloudStorageProviderType={})),function(e){e.ClassMaterials="classMaterials"}(e.SpecialDocumentLibraryType||(e.SpecialDocumentLibraryType={})),function(e){e.Readonly="readonly"}(e.DocumentLibraryAccessType||(e.DocumentLibraryAccessType={})),function(e){e.Downloaded="Downloaded",e.Downloading="Downloading",e.Failed="Failed"}(e.FileDownloadStatus||(e.FileDownloadStatus={})),function(e){e.Download="DOWNLOAD",e.Upload="UPLOAD",e.Delete="DELETE"}(e.CloudStorageProviderFileAction||(e.CloudStorageProviderFileAction={})),e.getCloudStorageFolders=function(e,t){if(Ne(de,D.content),!e||0===e.length)throw new Error("[files.getCloudStorageFolders] channelId name cannot be null or empty");if(!t)throw new Error("[files.getCloudStorageFolders] Callback cannot be null");ft("files.getCloudStorageFolders",[e],t)},e.addCloudStorageFolder=function(e,t){if(Ne(de,D.content),!e||0===e.length)throw new Error("[files.addCloudStorageFolder] channelId name cannot be null or empty");if(!t)throw new Error("[files.addCloudStorageFolder] Callback cannot be null");ft("files.addCloudStorageFolder",[e],t)},e.deleteCloudStorageFolder=function(e,t,n){if(Ne(de,D.content),!e)throw new Error("[files.deleteCloudStorageFolder] channelId name cannot be null or empty");if(!t)throw new Error("[files.deleteCloudStorageFolder] folderToDelete cannot be null or empty");if(!n)throw new Error("[files.deleteCloudStorageFolder] Callback cannot be null");ft("files.deleteCloudStorageFolder",[e,t],n)},e.getCloudStorageFolderContents=function(e,t,n){if(Ne(de,D.content),!e||!t)throw new Error("[files.getCloudStorageFolderContents] folder/providerCode name cannot be null or empty");if(!n)throw new Error("[files.getCloudStorageFolderContents] Callback cannot be null");if("isSubdirectory"in e&&!e.isSubdirectory)throw new Error("[files.getCloudStorageFolderContents] provided folder is not a subDirectory");ft("files.getCloudStorageFolderContents",[e,t],n)},e.openCloudStorageFile=function(e,t,n){if(Ne(de,D.content),!e||!t)throw new Error("[files.openCloudStorageFile] file/providerCode cannot be null or empty");if(e.isSubdirectory)throw new Error("[files.openCloudStorageFile] provided file is a subDirectory");ft("files.openCloudStorageFile",[e,t,n])},e.getExternalProviders=function(e,t){if(void 0===e&&(e=!1),Ne(de,D.content),!t)throw new Error("[files.getExternalProviders] Callback cannot be null");ft("files.getExternalProviders",[e],t)},e.copyMoveFiles=function(e,t,n,r,i,o){if(void 0===i&&(i=!1),Ne(de,D.content),!e||0===e.length)throw new Error("[files.copyMoveFiles] selectedFiles cannot be null or empty");if(!t)throw new Error("[files.copyMoveFiles] providerCode cannot be null or empty");if(!n)throw new Error("[files.copyMoveFiles] destinationFolder cannot be null or empty");if(!r)throw new Error("[files.copyMoveFiles] destinationProviderCode cannot be null or empty");if(!o)throw new Error("[files.copyMoveFiles] callback cannot be null");ft("files.copyMoveFiles",[e,t,n,r,i],o)},e.getFileDownloads=function(e){if(Ne(de,D.content),!e)throw new Error("[files.getFileDownloads] Callback cannot be null");ft("files.getFileDownloads",[],e)},e.openDownloadFolder=function(e,t){if(void 0===e&&(e=void 0),Ne(de,D.content),!t)throw new Error("[files.openDownloadFolder] Callback cannot be null");ft("files.openDownloadFolder",[e],t)},e.addCloudStorageProvider=function(e){if(Ne(de,D.content),!e)throw t(O.INVALID_ARGUMENTS,"[files.addCloudStorageProvider] callback cannot be null");ft("files.addCloudStorageProvider",[],e)},e.removeCloudStorageProvider=function(e,n){if(Ne(de,D.content),!n)throw t(O.INVALID_ARGUMENTS,"[files.removeCloudStorageProvider] callback cannot be null");if(!e||!e.content)throw t(O.INVALID_ARGUMENTS,"[files.removeCloudStorageProvider] 3P cloud storage provider request content is missing");ft("files.removeCloudStorageProvider",[e],n)},e.addCloudStorageProviderFile=function(e,n){if(Ne(de,D.content),!n)throw t(O.INVALID_ARGUMENTS,"[files.addCloudStorageProviderFile] callback cannot be null");if(!e||!e.content)throw t(O.INVALID_ARGUMENTS,"[files.addCloudStorageProviderFile] 3P cloud storage provider request content is missing");ft("files.addCloudStorageProviderFile",[e],n)},e.renameCloudStorageProviderFile=function(e,n){if(Ne(de,D.content),!n)throw t(O.INVALID_ARGUMENTS,"[files.renameCloudStorageProviderFile] callback cannot be null");if(!e||!e.content)throw t(O.INVALID_ARGUMENTS,"[files.renameCloudStorageProviderFile] 3P cloud storage provider request content is missing");ft("files.renameCloudStorageProviderFile",[e],n)},e.deleteCloudStorageProviderFile=function(e,n){if(Ne(de,D.content),!n)throw t(O.INVALID_ARGUMENTS,"[files.deleteCloudStorageProviderFile] callback cannot be null");if(!(e&&e.content&&e.content.itemList&&e.content.itemList.length>0))throw t(O.INVALID_ARGUMENTS,"[files.deleteCloudStorageProviderFile] 3P cloud storage provider request content details are missing");ft("files.deleteCloudStorageProviderFile",[e],n)},e.downloadCloudStorageProviderFile=function(e,n){if(Ne(de,D.content),!n)throw t(O.INVALID_ARGUMENTS,"[files.downloadCloudStorageProviderFile] callback cannot be null");if(!(e&&e.content&&e.content.itemList&&e.content.itemList.length>0))throw t(O.INVALID_ARGUMENTS,"[files.downloadCloudStorageProviderFile] 3P cloud storage provider request content details are missing");ft("files.downloadCloudStorageProviderFile",[e],n)},e.uploadCloudStorageProviderFile=function(e,n){if(Ne(de,D.content),!n)throw t(O.INVALID_ARGUMENTS,"[files.uploadCloudStorageProviderFile] callback cannot be null");if(!(e&&e.content&&e.content.itemList&&e.content.itemList.length>0))throw t(O.INVALID_ARGUMENTS,"[files.uploadCloudStorageProviderFile] 3P cloud storage provider request content details are missing");if(!e.content.destinationFolder)throw t(O.INVALID_ARGUMENTS,"[files.uploadCloudStorageProviderFile] Invalid destination folder details");ft("files.uploadCloudStorageProviderFile",[e],n)},e.registerCloudStorageProviderListChangeHandler=function(e){if(Ne(de),!e)throw new Error("[registerCloudStorageProviderListChangeHandler] Handler cannot be null");Ve("files.cloudStorageProviderListChange",e)},e.registerCloudStorageProviderContentChangeHandler=function(e){if(Ne(de),!e)throw new Error("[registerCloudStorageProviderContentChangeHandler] Handler cannot be null");Ve("files.cloudStorageProviderContentChange",e)}}(ai||(ai={})),function(e){function t(){return!(!Ne(de)||!de.supports.meetingRoom)}e.getPairedMeetingRoomInfo=function(){return new Promise((function(e){if(Ne(de),!t())throw z;e(lt("meetingRoom.getPairedMeetingRoomInfo"))}))},e.sendCommandToPairedMeetingRoom=function(e){return new Promise((function(n){if(!e||0==e.length)throw new Error("[meetingRoom.sendCommandToPairedMeetingRoom] Command name cannot be null or empty");if(Ne(de),!t())throw z;n(lt("meetingRoom.sendCommandToPairedMeetingRoom",e))}))},e.registerMeetingRoomCapabilitiesUpdateHandler=function(e){if(!e)throw new Error("[meetingRoom.registerMeetingRoomCapabilitiesUpdateHandler] Handler cannot be null");if(Ne(de),!t())throw z;Ve("meetingRoom.meetingRoomCapabilitiesUpdate",(function(t){Ne(de),e(t)}))},e.registerMeetingRoomStatesUpdateHandler=function(e){if(!e)throw new Error("[meetingRoom.registerMeetingRoomStatesUpdateHandler] Handler cannot be null");if(Ne(de),!t())throw z;Ve("meetingRoom.meetingRoomStatesUpdate",(function(t){Ne(de),e(t)}))},e.isSupported=t}(si||(si={})),function(e){function t(){return!(!Ne(de)||!de.supports.notifications)}e.showNotification=function(e){if(Ne(de,D.content),!t())throw z;ft("notifications.showNotification",[e])},e.isSupported=t}(ui||(ui={})),function(e){function t(){return!(!Ne(de)||!de.supports.remoteCamera)}!function(e){e.Reset="Reset",e.ZoomIn="ZoomIn",e.ZoomOut="ZoomOut",e.PanLeft="PanLeft",e.PanRight="PanRight",e.TiltUp="TiltUp",e.TiltDown="TiltDown"}(e.ControlCommand||(e.ControlCommand={})),function(e){e[e.CommandResetError=0]="CommandResetError",e[e.CommandZoomInError=1]="CommandZoomInError",e[e.CommandZoomOutError=2]="CommandZoomOutError",e[e.CommandPanLeftError=3]="CommandPanLeftError",e[e.CommandPanRightError=4]="CommandPanRightError",e[e.CommandTiltUpError=5]="CommandTiltUpError",e[e.CommandTiltDownError=6]="CommandTiltDownError",e[e.SendDataError=7]="SendDataError"}(e.ErrorReason||(e.ErrorReason={})),function(e){e[e.None=0]="None",e[e.ControlDenied=1]="ControlDenied",e[e.ControlNoResponse=2]="ControlNoResponse",e[e.ControlBusy=3]="ControlBusy",e[e.AckTimeout=4]="AckTimeout",e[e.ControlTerminated=5]="ControlTerminated",e[e.ControllerTerminated=6]="ControllerTerminated",e[e.DataChannelError=7]="DataChannelError",e[e.ControllerCancelled=8]="ControllerCancelled",e[e.ControlDisabled=9]="ControlDisabled",e[e.ControlTerminatedToAllowOtherController=10]="ControlTerminatedToAllowOtherController"}(e.SessionTerminatedReason||(e.SessionTerminatedReason={})),e.getCapableParticipants=function(e){if(!e)throw new Error("[remoteCamera.getCapableParticipants] Callback cannot be null");if(Ne(de,D.sidePanel),!t())throw z;ft("remoteCamera.getCapableParticipants",e)},e.requestControl=function(e,n){if(!e)throw new Error("[remoteCamera.requestControl] Participant cannot be null");if(!n)throw new Error("[remoteCamera.requestControl] Callback cannot be null");if(Ne(de,D.sidePanel),!t())throw z;ft("remoteCamera.requestControl",[e],n)},e.sendControlCommand=function(e,n){if(!e)throw new Error("[remoteCamera.sendControlCommand] ControlCommand cannot be null");if(!n)throw new Error("[remoteCamera.sendControlCommand] Callback cannot be null");if(Ne(de,D.sidePanel),!t())throw z;ft("remoteCamera.sendControlCommand",[e],n)},e.terminateSession=function(e){if(!e)throw new Error("[remoteCamera.terminateSession] Callback cannot be null");if(Ne(de,D.sidePanel),!t())throw z;ft("remoteCamera.terminateSession",e)},e.registerOnCapableParticipantsChangeHandler=function(e){if(!e)throw new Error("[remoteCamera.registerOnCapableParticipantsChangeHandler] Handler cannot be null");if(Ne(de,D.sidePanel),!t())throw z;Ve("remoteCamera.capableParticipantsChange",e)},e.registerOnErrorHandler=function(e){if(!e)throw new Error("[remoteCamera.registerOnErrorHandler] Handler cannot be null");if(Ne(de,D.sidePanel),!t())throw z;Ve("remoteCamera.handlerError",e)},e.registerOnDeviceStateChangeHandler=function(e){if(!e)throw new Error("[remoteCamera.registerOnDeviceStateChangeHandler] Handler cannot be null");if(Ne(de,D.sidePanel),!t())throw z;Ve("remoteCamera.deviceStateChange",e)},e.registerOnSessionStatusChangeHandler=function(e){if(!e)throw new Error("[remoteCamera.registerOnSessionStatusChangeHandler] Handler cannot be null");if(Ne(de,D.sidePanel),!t())throw z;Ve("remoteCamera.sessionStatusChange",e)},e.isSupported=t}(ci||(ci={})),function(e){function t(){return!(!Ne(de)||!de.supports.appEntity)}e.selectAppEntity=function(e,n,r,i){if(Ne(de,D.content),!t())throw z;if(!e||0==e.length)throw new Error("[appEntity.selectAppEntity] threadId name cannot be null or empty");if(!i)throw new Error("[appEntity.selectAppEntity] Callback cannot be null");ft("appEntity.selectAppEntity",[e,n,r],i)},e.isSupported=t}(li||(li={})),function(e){function t(){return!(!Ne(de)||!de.supports.teams)}!function(e){e[e.Regular=0]="Regular",e[e.Private=1]="Private",e[e.Shared=2]="Shared"}(e.ChannelType||(e.ChannelType={})),e.getTeamChannels=function(e,n){if(Ne(de,D.content),!t())throw z;if(!e)throw new Error("[teams.getTeamChannels] groupId cannot be null or empty");if(!n)throw new Error("[teams.getTeamChannels] Callback cannot be null");ft("teams.getTeamChannels",[e],n)},e.refreshSiteUrl=function(e,n){if(Ne(de),!t())throw z;if(!e)throw new Error("[teams.refreshSiteUrl] threadId cannot be null or empty");if(!n)throw new Error("[teams.refreshSiteUrl] Callback cannot be null");ft("teams.refreshSiteUrl",[e],n)},e.isSupported=t,function(e){function t(){return!(!Ne(de)||!de.supports.teams)&&!!de.supports.teams.fullTrust}!function(e){function t(){return!(!Ne(de)||!de.supports.teams)&&!!de.supports.teams.fullTrust&&!!de.supports.teams.fullTrust.joinedTeams}e.getUserJoinedTeams=function(e){return new Promise((function(n){if(Ne(de),!t())throw z;if((w.hostClientType===F.android||w.hostClientType===F.teamsRoomsAndroid||w.hostClientType===F.teamsPhones||w.hostClientType===F.teamsDisplays)&&!Oe(a)){var r={errorCode:O.OLD_PLATFORM};throw new Error(JSON.stringify(r))}n(st("getUserJoinedTeams",e))}))},e.isSupported=t}(e.joinedTeams||(e.joinedTeams={})),e.getConfigSetting=function(e){return new Promise((function(n){if(Ne(de),!t())throw z;n(st("getConfigSetting",e))}))},e.isSupported=t}(e.fullTrust||(e.fullTrust={}))}(di||(di={}));var fi,pi=function(e,t,n,r){function i(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,o){function a(e){try{u(r.next(e))}catch(e){o(e)}}function s(e){try{u(r.throw(e))}catch(e){o(e)}}function u(e){e.done?n(e.value):i(e.value).then(a,s)}u((r=r.apply(e,t||[])).next())}))},vi=function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(e){return function(t){return u([e,t])}}function u(s){if(n)throw new TypeError("Generator is already executing.");for(;o&&(o=0,s[0]&&(a=0)),a;)try{if(n=1,r&&(i=2&s[0]?r.return:s[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,s[1])).done)return i;switch(r=0,i&&(s=[2&s[0],i.value]),s[0]){case 0:case 1:i=s;break;case 4:return a.label++,{value:s[1],done:!1};case 5:a.label++,r=s[1],s=[0];continue;case 7:s=a.ops.pop(),a.trys.pop();continue;default:if(!((i=(i=a.trys).length>0&&i[i.length-1])||6!==s[0]&&2!==s[0])){a=0;continue}if(3===s[0]&&(!i||s[1]>i[0]&&s[1]<i[3])){a.label=s[1];break}if(6===s[0]&&a.label<i[1]){a.label=i[1],i=s;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(s);break}i[2]&&a.ops.pop(),a.trys.pop();continue}s=t.call(e,a)}catch(e){s=[6,e],r=0}finally{n=i=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}};!function(e){var t,n=De()?void 0:new Gn(ft);function r(e){return e.videoFrameBuffer=e.videoFrameBuffer||e.data,delete e.data,e}function i(){return Ne(de),ir.isSupported()}function o(e){ft("video.videoFrameProcessed",[e])}function a(e,n){void 0===n&&(n=t.Warn),ft("video.notifyError",[e,n])}!function(e){e.Fatal="fatal",e.Warn="warn"}(t=e.ErrorLevel||(e.ErrorLevel={})),e.registerForVideoFrame=function(e){var t,s,u=this;if(!i())throw z;if(!e.videoFrameHandler||!e.videoBufferHandler)throw new Error("Both videoFrameHandler and videoBufferHandler must be provided");if(Ne(de,D.sidePanel)){if(Ve("video.setFrameProcessTimeLimit",(function(e){return null==n?void 0:n.setFrameProcessTimeLimit(e)}),!1),null===(t=de.supports.video)||void 0===t?void 0:t.mediaStream)Ve("video.startVideoExtensibilityVideoStream",(function(t){return pi(u,void 0,void 0,(function(){var r,i,o,s,u;return vi(this,(function(c){switch(c.label){case 0:return r=t.streamId,t.metadataInTexture?[4,Qn(r,e.videoFrameHandler,a,n)]:[3,2];case 1:return o=c.sent(),[3,4];case 2:return[4,Jn(r,e.videoFrameHandler,a,n)];case 3:o=c.sent(),c.label=4;case 4:return i=o,!De()&&(null===(u=null===(s=window.chrome)||void 0===s?void 0:s.webview)||void 0===u||u.registerTextureStream(r,i)),[2]}}))}))}),!1),ft("video.mediaStream.registerForVideoFrame",[e.config]);else{if(!(null===(s=de.supports.video)||void 0===s?void 0:s.sharedFrame))throw z;Ve("video.newVideoFrame",(function(t){if(t){null==n||n.reportStartFrameProcessing(t.width,t.height);var i=t.timestamp;e.videoBufferHandler(r(t),(function(){null==n||n.reportFrameProcessed(),o(i)}),a)}}),!1),ft("video.registerForVideoFrame",[e.config])}null==n||n.startMonitorSlowFrameProcessing()}},e.notifySelectedVideoEffectChanged=function(e,t,n){if(Ne(de,D.sidePanel),!i())throw z;ft("video.videoEffectChanged",[e,t,n])},e.registerForVideoEffect=function(e){if(Ne(de,D.sidePanel),!i())throw z;Ve("video.effectParameterChange",rr(e,n),!1),ft("video.registerForVideoEffect")},e.updatePersonalizedEffects=function(e){if(Ne(de,D.sidePanel),!ir.isSupported())throw z;ft("video.personalizedEffectsChanged",[e])},e.isSupported=i,e.notifyFatalError=function(e){if(Ne(de),!ir.isSupported())throw z;a(e,t.Fatal)}}(fi||(fi={}))}(),i}()},67097:function(e,t,n){n(18218)},59504:function(e,t,n){"use strict";var r=n(97984),i=n(30825),o=n(44425),a=n(85200),s=n(81154),u=n(31935),c=n(74933),l=n(84474),d=n(27489),h=n(17722),f=n(95038);e.exports=function(e){return new Promise((function(t,n){var p,v=e.data,g=e.headers,m=e.responseType;function y(){e.cancelToken&&e.cancelToken.unsubscribe(p),e.signal&&e.signal.removeEventListener("abort",p)}r.isFormData(v)&&r.isStandardBrowserEnv()&&delete g["Content-Type"];var b=new XMLHttpRequest;if(e.auth){var w=e.auth.username||"",S=e.auth.password?unescape(encodeURIComponent(e.auth.password)):"";g.Authorization="Basic "+btoa(w+":"+S)}var k=s(e.baseURL,e.url);function C(){if(b){var r="getAllResponseHeaders"in b?u(b.getAllResponseHeaders()):null,o={data:m&&"text"!==m&&"json"!==m?b.response:b.responseText,status:b.status,statusText:b.statusText,headers:r,config:e,request:b};i((function(e){t(e),y()}),(function(e){n(e),y()}),o),b=null}}if(b.open(e.method.toUpperCase(),a(k,e.params,e.paramsSerializer),!0),b.timeout=e.timeout,"onloadend"in b?b.onloadend=C:b.onreadystatechange=function(){b&&4===b.readyState&&(0!==b.status||b.responseURL&&0===b.responseURL.indexOf("file:"))&&setTimeout(C)},b.onabort=function(){b&&(n(new d("Request aborted",d.ECONNABORTED,e,b)),b=null)},b.onerror=function(){n(new d("Network Error",d.ERR_NETWORK,e,b,b)),b=null},b.ontimeout=function(){var t=e.timeout?"timeout of "+e.timeout+"ms exceeded":"timeout exceeded",r=e.transitional||l;e.timeoutErrorMessage&&(t=e.timeoutErrorMessage),n(new d(t,r.clarifyTimeoutError?d.ETIMEDOUT:d.ECONNABORTED,e,b)),b=null},r.isStandardBrowserEnv()){var x=(e.withCredentials||c(k))&&e.xsrfCookieName?o.read(e.xsrfCookieName):void 0;x&&(g[e.xsrfHeaderName]=x)}"setRequestHeader"in b&&r.forEach(g,(function(e,t){"undefined"===typeof v&&"content-type"===t.toLowerCase()?delete g[t]:b.setRequestHeader(t,e)})),r.isUndefined(e.withCredentials)||(b.withCredentials=!!e.withCredentials),m&&"json"!==m&&(b.responseType=e.responseType),"function"===typeof e.onDownloadProgress&&b.addEventListener("progress",e.onDownloadProgress),"function"===typeof e.onUploadProgress&&b.upload&&b.upload.addEventListener("progress",e.onUploadProgress),(e.cancelToken||e.signal)&&(p=function(e){b&&(n(!e||e&&e.type?new h:e),b.abort(),b=null)},e.cancelToken&&e.cancelToken.subscribe(p),e.signal&&(e.signal.aborted?p():e.signal.addEventListener("abort",p))),v||(v=null);var E=f(k);E&&-1===["http","https","file"].indexOf(E)?n(new d("Unsupported protocol "+E+":",d.ERR_BAD_REQUEST,e)):b.send(v)}))}},18218:function(e,t,n){"use strict";var r=n(97984),i=n(64298),o=n(48600),a=n(95141);var s=function e(t){var n=new o(t),s=i(o.prototype.request,n);return r.extend(s,o.prototype,n),r.extend(s,n),s.create=function(n){return e(a(t,n))},s}(n(23756));s.Axios=o,s.CanceledError=n(17722),s.CancelToken=n(70537),s.isCancel=n(51951),s.VERSION=n(88221).version,s.toFormData=n(74539),s.AxiosError=n(27489),s.Cancel=s.CanceledError,s.all=function(e){return Promise.all(e)},s.spread=n(86135),s.isAxiosError=n(71018),e.exports=s,e.exports.default=s},70537:function(e,t,n){"use strict";var r=n(17722);function i(e){if("function"!==typeof e)throw new TypeError("executor must be a function.");var t;this.promise=new Promise((function(e){t=e}));var n=this;this.promise.then((function(e){if(n._listeners){var t,r=n._listeners.length;for(t=0;t<r;t++)n._listeners[t](e);n._listeners=null}})),this.promise.then=function(e){var t,r=new Promise((function(e){n.subscribe(e),t=e})).then(e);return r.cancel=function(){n.unsubscribe(t)},r},e((function(e){n.reason||(n.reason=new r(e),t(n.reason))}))}i.prototype.throwIfRequested=function(){if(this.reason)throw this.reason},i.prototype.subscribe=function(e){this.reason?e(this.reason):this._listeners?this._listeners.push(e):this._listeners=[e]},i.prototype.unsubscribe=function(e){if(this._listeners){var t=this._listeners.indexOf(e);-1!==t&&this._listeners.splice(t,1)}},i.source=function(){var e;return{token:new i((function(t){e=t})),cancel:e}},e.exports=i},17722:function(e,t,n){"use strict";var r=n(27489);function i(e){r.call(this,null==e?"canceled":e,r.ERR_CANCELED),this.name="CanceledError"}n(97984).inherits(i,r,{__CANCEL__:!0}),e.exports=i},51951:function(e){"use strict";e.exports=function(e){return!(!e||!e.__CANCEL__)}},48600:function(e,t,n){"use strict";var r=n(97984),i=n(85200),o=n(760),a=n(4287),s=n(95141),u=n(81154),c=n(44433),l=c.validators;function d(e){this.defaults=e,this.interceptors={request:new o,response:new o}}d.prototype.request=function(e,t){"string"===typeof e?(t=t||{}).url=e:t=e||{},(t=s(this.defaults,t)).method?t.method=t.method.toLowerCase():this.defaults.method?t.method=this.defaults.method.toLowerCase():t.method="get";var n=t.transitional;void 0!==n&&c.assertOptions(n,{silentJSONParsing:l.transitional(l.boolean),forcedJSONParsing:l.transitional(l.boolean),clarifyTimeoutError:l.transitional(l.boolean)},!1);var r=[],i=!0;this.interceptors.request.forEach((function(e){"function"===typeof e.runWhen&&!1===e.runWhen(t)||(i=i&&e.synchronous,r.unshift(e.fulfilled,e.rejected))}));var o,u=[];if(this.interceptors.response.forEach((function(e){u.push(e.fulfilled,e.rejected)})),!i){var d=[a,void 0];for(Array.prototype.unshift.apply(d,r),d=d.concat(u),o=Promise.resolve(t);d.length;)o=o.then(d.shift(),d.shift());return o}for(var h=t;r.length;){var f=r.shift(),p=r.shift();try{h=f(h)}catch(v){p(v);break}}try{o=a(h)}catch(v){return Promise.reject(v)}for(;u.length;)o=o.then(u.shift(),u.shift());return o},d.prototype.getUri=function(e){e=s(this.defaults,e);var t=u(e.baseURL,e.url);return i(t,e.params,e.paramsSerializer)},r.forEach(["delete","get","head","options"],(function(e){d.prototype[e]=function(t,n){return this.request(s(n||{},{method:e,url:t,data:(n||{}).data}))}})),r.forEach(["post","put","patch"],(function(e){function t(t){return function(n,r,i){return this.request(s(i||{},{method:e,headers:t?{"Content-Type":"multipart/form-data"}:{},url:n,data:r}))}}d.prototype[e]=t(),d.prototype[e+"Form"]=t(!0)})),e.exports=d},27489:function(e,t,n){"use strict";var r=n(97984);function i(e,t,n,r,i){Error.call(this),this.message=e,this.name="AxiosError",t&&(this.code=t),n&&(this.config=n),r&&(this.request=r),i&&(this.response=i)}r.inherits(i,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:this.config,code:this.code,status:this.response&&this.response.status?this.response.status:null}}});var o=i.prototype,a={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED"].forEach((function(e){a[e]={value:e}})),Object.defineProperties(i,a),Object.defineProperty(o,"isAxiosError",{value:!0}),i.from=function(e,t,n,a,s,u){var c=Object.create(o);return r.toFlatObject(e,c,(function(e){return e!==Error.prototype})),i.call(c,e.message,t,n,a,s),c.name=e.name,u&&Object.assign(c,u),c},e.exports=i},760:function(e,t,n){"use strict";var r=n(97984);function i(){this.handlers=[]}i.prototype.use=function(e,t,n){return this.handlers.push({fulfilled:e,rejected:t,synchronous:!!n&&n.synchronous,runWhen:n?n.runWhen:null}),this.handlers.length-1},i.prototype.eject=function(e){this.handlers[e]&&(this.handlers[e]=null)},i.prototype.forEach=function(e){r.forEach(this.handlers,(function(t){null!==t&&e(t)}))},e.exports=i},81154:function(e,t,n){"use strict";var r=n(57399),i=n(97951);e.exports=function(e,t){return e&&!r(t)?i(e,t):t}},4287:function(e,t,n){"use strict";var r=n(97984),i=n(73347),o=n(51951),a=n(23756),s=n(17722);function u(e){if(e.cancelToken&&e.cancelToken.throwIfRequested(),e.signal&&e.signal.aborted)throw new s}e.exports=function(e){return u(e),e.headers=e.headers||{},e.data=i.call(e,e.data,e.headers,e.transformRequest),e.headers=r.merge(e.headers.common||{},e.headers[e.method]||{},e.headers),r.forEach(["delete","get","head","post","put","patch","common"],(function(t){delete e.headers[t]})),(e.adapter||a.adapter)(e).then((function(t){return u(e),t.data=i.call(e,t.data,t.headers,e.transformResponse),t}),(function(t){return o(t)||(u(e),t&&t.response&&(t.response.data=i.call(e,t.response.data,t.response.headers,e.transformResponse))),Promise.reject(t)}))}},95141:function(e,t,n){"use strict";var r=n(97984);e.exports=function(e,t){t=t||{};var n={};function i(e,t){return r.isPlainObject(e)&&r.isPlainObject(t)?r.merge(e,t):r.isPlainObject(t)?r.merge({},t):r.isArray(t)?t.slice():t}function o(n){return r.isUndefined(t[n])?r.isUndefined(e[n])?void 0:i(void 0,e[n]):i(e[n],t[n])}function a(e){if(!r.isUndefined(t[e]))return i(void 0,t[e])}function s(n){return r.isUndefined(t[n])?r.isUndefined(e[n])?void 0:i(void 0,e[n]):i(void 0,t[n])}function u(n){return n in t?i(e[n],t[n]):n in e?i(void 0,e[n]):void 0}var c={url:a,method:a,data:a,baseURL:s,transformRequest:s,transformResponse:s,paramsSerializer:s,timeout:s,timeoutMessage:s,withCredentials:s,adapter:s,responseType:s,xsrfCookieName:s,xsrfHeaderName:s,onUploadProgress:s,onDownloadProgress:s,decompress:s,maxContentLength:s,maxBodyLength:s,beforeRedirect:s,transport:s,httpAgent:s,httpsAgent:s,cancelToken:s,socketPath:s,responseEncoding:s,validateStatus:u};return r.forEach(Object.keys(e).concat(Object.keys(t)),(function(e){var t=c[e]||o,i=t(e);r.isUndefined(i)&&t!==u||(n[e]=i)})),n}},30825:function(e,t,n){"use strict";var r=n(27489);e.exports=function(e,t,n){var i=n.config.validateStatus;n.status&&i&&!i(n.status)?t(new r("Request failed with status code "+n.status,[r.ERR_BAD_REQUEST,r.ERR_BAD_RESPONSE][Math.floor(n.status/100)-4],n.config,n.request,n)):e(n)}},73347:function(e,t,n){"use strict";var r=n(97984),i=n(23756);e.exports=function(e,t,n){var o=this||i;return r.forEach(n,(function(n){e=n.call(o,e,t)})),e}},23756:function(e,t,n){"use strict";var r=n(97984),i=n(56184),o=n(27489),a=n(84474),s=n(74539),u={"Content-Type":"application/x-www-form-urlencoded"};function c(e,t){!r.isUndefined(e)&&r.isUndefined(e["Content-Type"])&&(e["Content-Type"]=t)}var l={transitional:a,adapter:function(){var e;return("undefined"!==typeof XMLHttpRequest||"undefined"!==typeof process&&"[object process]"===Object.prototype.toString.call(process))&&(e=n(59504)),e}(),transformRequest:[function(e,t){if(i(t,"Accept"),i(t,"Content-Type"),r.isFormData(e)||r.isArrayBuffer(e)||r.isBuffer(e)||r.isStream(e)||r.isFile(e)||r.isBlob(e))return e;if(r.isArrayBufferView(e))return e.buffer;if(r.isURLSearchParams(e))return c(t,"application/x-www-form-urlencoded;charset=utf-8"),e.toString();var n,o=r.isObject(e),a=t&&t["Content-Type"];if((n=r.isFileList(e))||o&&"multipart/form-data"===a){var u=this.env&&this.env.FormData;return s(n?{"files[]":e}:e,u&&new u)}return o||"application/json"===a?(c(t,"application/json"),function(e,t,n){if(r.isString(e))try{return(t||JSON.parse)(e),r.trim(e)}catch(i){if("SyntaxError"!==i.name)throw i}return(n||JSON.stringify)(e)}(e)):e}],transformResponse:[function(e){var t=this.transitional||l.transitional,n=t&&t.silentJSONParsing,i=t&&t.forcedJSONParsing,a=!n&&"json"===this.responseType;if(a||i&&r.isString(e)&&e.length)try{return JSON.parse(e)}catch(s){if(a){if("SyntaxError"===s.name)throw o.from(s,o.ERR_BAD_RESPONSE,this,null,this.response);throw s}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:n(36916)},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*"}}};r.forEach(["delete","get","head"],(function(e){l.headers[e]={}})),r.forEach(["post","put","patch"],(function(e){l.headers[e]=r.merge(u)})),e.exports=l},84474:function(e){"use strict";e.exports={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1}},88221:function(e){e.exports={version:"0.27.2"}},64298:function(e){"use strict";e.exports=function(e,t){return function(){for(var n=new Array(arguments.length),r=0;r<n.length;r++)n[r]=arguments[r];return e.apply(t,n)}}},85200:function(e,t,n){"use strict";var r=n(97984);function i(e){return encodeURIComponent(e).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}e.exports=function(e,t,n){if(!t)return e;var o;if(n)o=n(t);else if(r.isURLSearchParams(t))o=t.toString();else{var a=[];r.forEach(t,(function(e,t){null!==e&&"undefined"!==typeof e&&(r.isArray(e)?t+="[]":e=[e],r.forEach(e,(function(e){r.isDate(e)?e=e.toISOString():r.isObject(e)&&(e=JSON.stringify(e)),a.push(i(t)+"="+i(e))})))})),o=a.join("&")}if(o){var s=e.indexOf("#");-1!==s&&(e=e.slice(0,s)),e+=(-1===e.indexOf("?")?"?":"&")+o}return e}},97951:function(e){"use strict";e.exports=function(e,t){return t?e.replace(/\/+$/,"")+"/"+t.replace(/^\/+/,""):e}},44425:function(e,t,n){"use strict";var r=n(97984);e.exports=r.isStandardBrowserEnv()?{write:function(e,t,n,i,o,a){var s=[];s.push(e+"="+encodeURIComponent(t)),r.isNumber(n)&&s.push("expires="+new Date(n).toGMTString()),r.isString(i)&&s.push("path="+i),r.isString(o)&&s.push("domain="+o),!0===a&&s.push("secure"),document.cookie=s.join("; ")},read:function(e){var t=document.cookie.match(new RegExp("(^|;\\s*)("+e+")=([^;]*)"));return t?decodeURIComponent(t[3]):null},remove:function(e){this.write(e,"",Date.now()-864e5)}}:{write:function(){},read:function(){return null},remove:function(){}}},57399:function(e){"use strict";e.exports=function(e){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(e)}},71018:function(e,t,n){"use strict";var r=n(97984);e.exports=function(e){return r.isObject(e)&&!0===e.isAxiosError}},74933:function(e,t,n){"use strict";var r=n(97984);e.exports=r.isStandardBrowserEnv()?function(){var e,t=/(msie|trident)/i.test(navigator.userAgent),n=document.createElement("a");function i(e){var r=e;return t&&(n.setAttribute("href",r),r=n.href),n.setAttribute("href",r),{href:n.href,protocol:n.protocol?n.protocol.replace(/:$/,""):"",host:n.host,search:n.search?n.search.replace(/^\?/,""):"",hash:n.hash?n.hash.replace(/^#/,""):"",hostname:n.hostname,port:n.port,pathname:"/"===n.pathname.charAt(0)?n.pathname:"/"+n.pathname}}return e=i(window.location.href),function(t){var n=r.isString(t)?i(t):t;return n.protocol===e.protocol&&n.host===e.host}}():function(){return!0}},56184:function(e,t,n){"use strict";var r=n(97984);e.exports=function(e,t){r.forEach(e,(function(n,r){r!==t&&r.toUpperCase()===t.toUpperCase()&&(e[t]=n,delete e[r])}))}},36916:function(e){e.exports=null},31935:function(e,t,n){"use strict";var r=n(97984),i=["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"];e.exports=function(e){var t,n,o,a={};return e?(r.forEach(e.split("\n"),(function(e){if(o=e.indexOf(":"),t=r.trim(e.substr(0,o)).toLowerCase(),n=r.trim(e.substr(o+1)),t){if(a[t]&&i.indexOf(t)>=0)return;a[t]="set-cookie"===t?(a[t]?a[t]:[]).concat([n]):a[t]?a[t]+", "+n:n}})),a):a}},95038:function(e){"use strict";e.exports=function(e){var t=/^([-+\w]{1,25})(:?\/\/|:)/.exec(e);return t&&t[1]||""}},86135:function(e){"use strict";e.exports=function(e){return function(t){return e.apply(null,t)}}},74539:function(e,t,n){"use strict";var r=n(97984);e.exports=function(e,t){t=t||new FormData;var n=[];function i(e){return null===e?"":r.isDate(e)?e.toISOString():r.isArrayBuffer(e)||r.isTypedArray(e)?"function"===typeof Blob?new Blob([e]):Buffer.from(e):e}return function e(o,a){if(r.isPlainObject(o)||r.isArray(o)){if(-1!==n.indexOf(o))throw Error("Circular reference detected in "+a);n.push(o),r.forEach(o,(function(n,o){if(!r.isUndefined(n)){var s,u=a?a+"."+o:o;if(n&&!a&&"object"===typeof n)if(r.endsWith(o,"{}"))n=JSON.stringify(n);else if(r.endsWith(o,"[]")&&(s=r.toArray(n)))return void s.forEach((function(e){!r.isUndefined(e)&&t.append(u,i(e))}));e(n,u)}})),n.pop()}else t.append(a,i(o))}(e),t}},44433:function(e,t,n){"use strict";var r=n(88221).version,i=n(27489),o={};["object","boolean","number","function","string","symbol"].forEach((function(e,t){o[e]=function(n){return typeof n===e||"a"+(t<1?"n ":" ")+e}}));var a={};o.transitional=function(e,t,n){function o(e,t){return"[Axios v"+r+"] Transitional option '"+e+"'"+t+(n?". "+n:"")}return function(n,r,s){if(!1===e)throw new i(o(r," has been removed"+(t?" in "+t:"")),i.ERR_DEPRECATED);return t&&!a[r]&&(a[r]=!0,console.warn(o(r," has been deprecated since v"+t+" and will be removed in the near future"))),!e||e(n,r,s)}},e.exports={assertOptions:function(e,t,n){if("object"!==typeof e)throw new i("options must be an object",i.ERR_BAD_OPTION_VALUE);for(var r=Object.keys(e),o=r.length;o-- >0;){var a=r[o],s=t[a];if(s){var u=e[a],c=void 0===u||s(u,a,e);if(!0!==c)throw new i("option "+a+" must be "+c,i.ERR_BAD_OPTION_VALUE)}else if(!0!==n)throw new i("Unknown option "+a,i.ERR_BAD_OPTION)}},validators:o}},97984:function(e,t,n){"use strict";var r,i=n(64298),o=Object.prototype.toString,a=(r=Object.create(null),function(e){var t=o.call(e);return r[t]||(r[t]=t.slice(8,-1).toLowerCase())});function s(e){return e=e.toLowerCase(),function(t){return a(t)===e}}function u(e){return Array.isArray(e)}function c(e){return"undefined"===typeof e}var l=s("ArrayBuffer");function d(e){return null!==e&&"object"===typeof e}function h(e){if("object"!==a(e))return!1;var t=Object.getPrototypeOf(e);return null===t||t===Object.prototype}var f=s("Date"),p=s("File"),v=s("Blob"),g=s("FileList");function m(e){return"[object Function]"===o.call(e)}var y=s("URLSearchParams");function b(e,t){if(null!==e&&"undefined"!==typeof e)if("object"!==typeof e&&(e=[e]),u(e))for(var n=0,r=e.length;n<r;n++)t.call(null,e[n],n,e);else for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.call(null,e[i],i,e)}var w,S=(w="undefined"!==typeof Uint8Array&&Object.getPrototypeOf(Uint8Array),function(e){return w&&e instanceof w});e.exports={isArray:u,isArrayBuffer:l,isBuffer:function(e){return null!==e&&!c(e)&&null!==e.constructor&&!c(e.constructor)&&"function"===typeof e.constructor.isBuffer&&e.constructor.isBuffer(e)},isFormData:function(e){var t="[object FormData]";return e&&("function"===typeof FormData&&e instanceof FormData||o.call(e)===t||m(e.toString)&&e.toString()===t)},isArrayBufferView:function(e){return"undefined"!==typeof ArrayBuffer&&ArrayBuffer.isView?ArrayBuffer.isView(e):e&&e.buffer&&l(e.buffer)},isString:function(e){return"string"===typeof e},isNumber:function(e){return"number"===typeof e},isObject:d,isPlainObject:h,isUndefined:c,isDate:f,isFile:p,isBlob:v,isFunction:m,isStream:function(e){return d(e)&&m(e.pipe)},isURLSearchParams:y,isStandardBrowserEnv:function(){return("undefined"===typeof navigator||"ReactNative"!==navigator.product&&"NativeScript"!==navigator.product&&"NS"!==navigator.product)&&("undefined"!==typeof window&&"undefined"!==typeof document)},forEach:b,merge:function e(){var t={};function n(n,r){h(t[r])&&h(n)?t[r]=e(t[r],n):h(n)?t[r]=e({},n):u(n)?t[r]=n.slice():t[r]=n}for(var r=0,i=arguments.length;r<i;r++)b(arguments[r],n);return t},extend:function(e,t,n){return b(t,(function(t,r){e[r]=n&&"function"===typeof t?i(t,n):t})),e},trim:function(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")},stripBOM:function(e){return 65279===e.charCodeAt(0)&&(e=e.slice(1)),e},inherits:function(e,t,n,r){e.prototype=Object.create(t.prototype,r),e.prototype.constructor=e,n&&Object.assign(e.prototype,n)},toFlatObject:function(e,t,n){var r,i,o,a={};t=t||{};do{for(i=(r=Object.getOwnPropertyNames(e)).length;i-- >0;)a[o=r[i]]||(t[o]=e[o],a[o]=!0);e=Object.getPrototypeOf(e)}while(e&&(!n||n(e,t))&&e!==Object.prototype);return t},kindOf:a,kindOfTest:s,endsWith:function(e,t,n){e=String(e),(void 0===n||n>e.length)&&(n=e.length),n-=t.length;var r=e.indexOf(t,n);return-1!==r&&r===n},toArray:function(e){if(!e)return null;var t=e.length;if(c(t))return null;for(var n=new Array(t);t-- >0;)n[t]=e[t];return n},isTypedArray:S,isFileList:g}},35935:function(e){"use strict";var t="undefined"!==typeof self?self:"undefined"!==typeof window?window:void 0,n=t.AbortController,r=t.AbortSignal;e.exports=n,e.exports.AbortSignal=r,e.exports.default=n},74569:function(e,t,n){e.exports=n(28036)},73381:function(e,t,n){"use strict";var r=n(33589),i=n(47297),o=n(29301),a=n(39774),s=n(81804),u=n(59145),c=n(95411),l=n(96467);e.exports=function(e){return new Promise((function(t,n){var d=e.data,h=e.headers,f=e.responseType;r.isFormData(d)&&delete h["Content-Type"];var p=new XMLHttpRequest;if(e.auth){var v=e.auth.username||"",g=e.auth.password?unescape(encodeURIComponent(e.auth.password)):"";h.Authorization="Basic "+btoa(v+":"+g)}var m=s(e.baseURL,e.url);function y(){if(p){var r="getAllResponseHeaders"in p?u(p.getAllResponseHeaders()):null,o={data:f&&"text"!==f&&"json"!==f?p.response:p.responseText,status:p.status,statusText:p.statusText,headers:r,config:e,request:p};i(t,n,o),p=null}}if(p.open(e.method.toUpperCase(),a(m,e.params,e.paramsSerializer),!0),p.timeout=e.timeout,"onloadend"in p?p.onloadend=y:p.onreadystatechange=function(){p&&4===p.readyState&&(0!==p.status||p.responseURL&&0===p.responseURL.indexOf("file:"))&&setTimeout(y)},p.onabort=function(){p&&(n(l("Request aborted",e,"ECONNABORTED",p)),p=null)},p.onerror=function(){n(l("Network Error",e,null,p)),p=null},p.ontimeout=function(){var t="timeout of "+e.timeout+"ms exceeded";e.timeoutErrorMessage&&(t=e.timeoutErrorMessage),n(l(t,e,e.transitional&&e.transitional.clarifyTimeoutError?"ETIMEDOUT":"ECONNABORTED",p)),p=null},r.isStandardBrowserEnv()){var b=(e.withCredentials||c(m))&&e.xsrfCookieName?o.read(e.xsrfCookieName):void 0;b&&(h[e.xsrfHeaderName]=b)}"setRequestHeader"in p&&r.forEach(h,(function(e,t){"undefined"===typeof d&&"content-type"===t.toLowerCase()?delete h[t]:p.setRequestHeader(t,e)})),r.isUndefined(e.withCredentials)||(p.withCredentials=!!e.withCredentials),f&&"json"!==f&&(p.responseType=e.responseType),"function"===typeof e.onDownloadProgress&&p.addEventListener("progress",e.onDownloadProgress),"function"===typeof e.onUploadProgress&&p.upload&&p.upload.addEventListener("progress",e.onUploadProgress),e.cancelToken&&e.cancelToken.promise.then((function(e){p&&(p.abort(),n(e),p=null)})),d||(d=null),p.send(d)}))}},28036:function(e,t,n){"use strict";var r=n(33589),i=n(44049),o=n(23773),a=n(40777);function s(e){var t=new o(e),n=i(o.prototype.request,t);return r.extend(n,o.prototype,t),r.extend(n,t),n}var u=s(n(50221));u.Axios=o,u.create=function(e){return s(a(u.defaults,e))},u.Cancel=n(9346),u.CancelToken=n(6857),u.isCancel=n(35517),u.all=function(e){return Promise.all(e)},u.spread=n(98089),u.isAxiosError=n(49580),e.exports=u,e.exports.default=u},9346:function(e){"use strict";function t(e){this.message=e}t.prototype.toString=function(){return"Cancel"+(this.message?": "+this.message:"")},t.prototype.__CANCEL__=!0,e.exports=t},6857:function(e,t,n){"use strict";var r=n(9346);function i(e){if("function"!==typeof e)throw new TypeError("executor must be a function.");var t;this.promise=new Promise((function(e){t=e}));var n=this;e((function(e){n.reason||(n.reason=new r(e),t(n.reason))}))}i.prototype.throwIfRequested=function(){if(this.reason)throw this.reason},i.source=function(){var e;return{token:new i((function(t){e=t})),cancel:e}},e.exports=i},35517:function(e){"use strict";e.exports=function(e){return!(!e||!e.__CANCEL__)}},23773:function(e,t,n){"use strict";var r=n(33589),i=n(39774),o=n(37470),a=n(72733),s=n(40777),u=n(47835),c=u.validators;function l(e){this.defaults=e,this.interceptors={request:new o,response:new o}}l.prototype.request=function(e){"string"===typeof e?(e=arguments[1]||{}).url=arguments[0]:e=e||{},(e=s(this.defaults,e)).method?e.method=e.method.toLowerCase():this.defaults.method?e.method=this.defaults.method.toLowerCase():e.method="get";var t=e.transitional;void 0!==t&&u.assertOptions(t,{silentJSONParsing:c.transitional(c.boolean,"1.0.0"),forcedJSONParsing:c.transitional(c.boolean,"1.0.0"),clarifyTimeoutError:c.transitional(c.boolean,"1.0.0")},!1);var n=[],r=!0;this.interceptors.request.forEach((function(t){"function"===typeof t.runWhen&&!1===t.runWhen(e)||(r=r&&t.synchronous,n.unshift(t.fulfilled,t.rejected))}));var i,o=[];if(this.interceptors.response.forEach((function(e){o.push(e.fulfilled,e.rejected)})),!r){var l=[a,void 0];for(Array.prototype.unshift.apply(l,n),l=l.concat(o),i=Promise.resolve(e);l.length;)i=i.then(l.shift(),l.shift());return i}for(var d=e;n.length;){var h=n.shift(),f=n.shift();try{d=h(d)}catch(p){f(p);break}}try{i=a(d)}catch(p){return Promise.reject(p)}for(;o.length;)i=i.then(o.shift(),o.shift());return i},l.prototype.getUri=function(e){return e=s(this.defaults,e),i(e.url,e.params,e.paramsSerializer).replace(/^\?/,"")},r.forEach(["delete","get","head","options"],(function(e){l.prototype[e]=function(t,n){return this.request(s(n||{},{method:e,url:t,data:(n||{}).data}))}})),r.forEach(["post","put","patch"],(function(e){l.prototype[e]=function(t,n,r){return this.request(s(r||{},{method:e,url:t,data:n}))}})),e.exports=l},37470:function(e,t,n){"use strict";var r=n(33589);function i(){this.handlers=[]}i.prototype.use=function(e,t,n){return this.handlers.push({fulfilled:e,rejected:t,synchronous:!!n&&n.synchronous,runWhen:n?n.runWhen:null}),this.handlers.length-1},i.prototype.eject=function(e){this.handlers[e]&&(this.handlers[e]=null)},i.prototype.forEach=function(e){r.forEach(this.handlers,(function(t){null!==t&&e(t)}))},e.exports=i},81804:function(e,t,n){"use strict";var r=n(84044),i=n(79549);e.exports=function(e,t){return e&&!r(t)?i(e,t):t}},96467:function(e,t,n){"use strict";var r=n(76460);e.exports=function(e,t,n,i,o){var a=new Error(e);return r(a,t,n,i,o)}},72733:function(e,t,n){"use strict";var r=n(33589),i=n(52693),o=n(35517),a=n(50221);function s(e){e.cancelToken&&e.cancelToken.throwIfRequested()}e.exports=function(e){return s(e),e.headers=e.headers||{},e.data=i.call(e,e.data,e.headers,e.transformRequest),e.headers=r.merge(e.headers.common||{},e.headers[e.method]||{},e.headers),r.forEach(["delete","get","head","post","put","patch","common"],(function(t){delete e.headers[t]})),(e.adapter||a.adapter)(e).then((function(t){return s(e),t.data=i.call(e,t.data,t.headers,e.transformResponse),t}),(function(t){return o(t)||(s(e),t&&t.response&&(t.response.data=i.call(e,t.response.data,t.response.headers,e.transformResponse))),Promise.reject(t)}))}},76460:function(e){"use strict";e.exports=function(e,t,n,r,i){return e.config=t,n&&(e.code=n),e.request=r,e.response=i,e.isAxiosError=!0,e.toJSON=function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:this.config,code:this.code}},e}},40777:function(e,t,n){"use strict";var r=n(33589);e.exports=function(e,t){t=t||{};var n={},i=["url","method","data"],o=["headers","auth","proxy","params"],a=["baseURL","transformRequest","transformResponse","paramsSerializer","timeout","timeoutMessage","withCredentials","adapter","responseType","xsrfCookieName","xsrfHeaderName","onUploadProgress","onDownloadProgress","decompress","maxContentLength","maxBodyLength","maxRedirects","transport","httpAgent","httpsAgent","cancelToken","socketPath","responseEncoding"],s=["validateStatus"];function u(e,t){return r.isPlainObject(e)&&r.isPlainObject(t)?r.merge(e,t):r.isPlainObject(t)?r.merge({},t):r.isArray(t)?t.slice():t}function c(i){r.isUndefined(t[i])?r.isUndefined(e[i])||(n[i]=u(void 0,e[i])):n[i]=u(e[i],t[i])}r.forEach(i,(function(e){r.isUndefined(t[e])||(n[e]=u(void 0,t[e]))})),r.forEach(o,c),r.forEach(a,(function(i){r.isUndefined(t[i])?r.isUndefined(e[i])||(n[i]=u(void 0,e[i])):n[i]=u(void 0,t[i])})),r.forEach(s,(function(r){r in t?n[r]=u(e[r],t[r]):r in e&&(n[r]=u(void 0,e[r]))}));var l=i.concat(o).concat(a).concat(s),d=Object.keys(e).concat(Object.keys(t)).filter((function(e){return-1===l.indexOf(e)}));return r.forEach(d,c),n}},47297:function(e,t,n){"use strict";var r=n(96467);e.exports=function(e,t,n){var i=n.config.validateStatus;n.status&&i&&!i(n.status)?t(r("Request failed with status code "+n.status,n.config,null,n.request,n)):e(n)}},52693:function(e,t,n){"use strict";var r=n(33589),i=n(50221);e.exports=function(e,t,n){var o=this||i;return r.forEach(n,(function(n){e=n.call(o,e,t)})),e}},50221:function(e,t,n){"use strict";var r=n(33589),i=n(64341),o=n(76460),a={"Content-Type":"application/x-www-form-urlencoded"};function s(e,t){!r.isUndefined(e)&&r.isUndefined(e["Content-Type"])&&(e["Content-Type"]=t)}var u={transitional:{silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},adapter:function(){var e;return("undefined"!==typeof XMLHttpRequest||"undefined"!==typeof process&&"[object process]"===Object.prototype.toString.call(process))&&(e=n(73381)),e}(),transformRequest:[function(e,t){return i(t,"Accept"),i(t,"Content-Type"),r.isFormData(e)||r.isArrayBuffer(e)||r.isBuffer(e)||r.isStream(e)||r.isFile(e)||r.isBlob(e)?e:r.isArrayBufferView(e)?e.buffer:r.isURLSearchParams(e)?(s(t,"application/x-www-form-urlencoded;charset=utf-8"),e.toString()):r.isObject(e)||t&&"application/json"===t["Content-Type"]?(s(t,"application/json"),function(e,t,n){if(r.isString(e))try{return(t||JSON.parse)(e),r.trim(e)}catch(i){if("SyntaxError"!==i.name)throw i}return(n||JSON.stringify)(e)}(e)):e}],transformResponse:[function(e){var t=this.transitional,n=t&&t.silentJSONParsing,i=t&&t.forcedJSONParsing,a=!n&&"json"===this.responseType;if(a||i&&r.isString(e)&&e.length)try{return JSON.parse(e)}catch(s){if(a){if("SyntaxError"===s.name)throw o(s,this,"E_JSON_PARSE");throw s}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*"}}};r.forEach(["delete","get","head"],(function(e){u.headers[e]={}})),r.forEach(["post","put","patch"],(function(e){u.headers[e]=r.merge(a)})),e.exports=u},44049:function(e){"use strict";e.exports=function(e,t){return function(){for(var n=new Array(arguments.length),r=0;r<n.length;r++)n[r]=arguments[r];return e.apply(t,n)}}},39774:function(e,t,n){"use strict";var r=n(33589);function i(e){return encodeURIComponent(e).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}e.exports=function(e,t,n){if(!t)return e;var o;if(n)o=n(t);else if(r.isURLSearchParams(t))o=t.toString();else{var a=[];r.forEach(t,(function(e,t){null!==e&&"undefined"!==typeof e&&(r.isArray(e)?t+="[]":e=[e],r.forEach(e,(function(e){r.isDate(e)?e=e.toISOString():r.isObject(e)&&(e=JSON.stringify(e)),a.push(i(t)+"="+i(e))})))})),o=a.join("&")}if(o){var s=e.indexOf("#");-1!==s&&(e=e.slice(0,s)),e+=(-1===e.indexOf("?")?"?":"&")+o}return e}},79549:function(e){"use strict";e.exports=function(e,t){return t?e.replace(/\/+$/,"")+"/"+t.replace(/^\/+/,""):e}},29301:function(e,t,n){"use strict";var r=n(33589);e.exports=r.isStandardBrowserEnv()?{write:function(e,t,n,i,o,a){var s=[];s.push(e+"="+encodeURIComponent(t)),r.isNumber(n)&&s.push("expires="+new Date(n).toGMTString()),r.isString(i)&&s.push("path="+i),r.isString(o)&&s.push("domain="+o),!0===a&&s.push("secure"),document.cookie=s.join("; ")},read:function(e){var t=document.cookie.match(new RegExp("(^|;\\s*)("+e+")=([^;]*)"));return t?decodeURIComponent(t[3]):null},remove:function(e){this.write(e,"",Date.now()-864e5)}}:{write:function(){},read:function(){return null},remove:function(){}}},84044:function(e){"use strict";e.exports=function(e){return/^([a-z][a-z\d\+\-\.]*:)?\/\//i.test(e)}},49580:function(e){"use strict";e.exports=function(e){return"object"===typeof e&&!0===e.isAxiosError}},95411:function(e,t,n){"use strict";var r=n(33589);e.exports=r.isStandardBrowserEnv()?function(){var e,t=/(msie|trident)/i.test(navigator.userAgent),n=document.createElement("a");function i(e){var r=e;return t&&(n.setAttribute("href",r),r=n.href),n.setAttribute("href",r),{href:n.href,protocol:n.protocol?n.protocol.replace(/:$/,""):"",host:n.host,search:n.search?n.search.replace(/^\?/,""):"",hash:n.hash?n.hash.replace(/^#/,""):"",hostname:n.hostname,port:n.port,pathname:"/"===n.pathname.charAt(0)?n.pathname:"/"+n.pathname}}return e=i(window.location.href),function(t){var n=r.isString(t)?i(t):t;return n.protocol===e.protocol&&n.host===e.host}}():function(){return!0}},64341:function(e,t,n){"use strict";var r=n(33589);e.exports=function(e,t){r.forEach(e,(function(n,r){r!==t&&r.toUpperCase()===t.toUpperCase()&&(e[t]=n,delete e[r])}))}},59145:function(e,t,n){"use strict";var r=n(33589),i=["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"];e.exports=function(e){var t,n,o,a={};return e?(r.forEach(e.split("\n"),(function(e){if(o=e.indexOf(":"),t=r.trim(e.substr(0,o)).toLowerCase(),n=r.trim(e.substr(o+1)),t){if(a[t]&&i.indexOf(t)>=0)return;a[t]="set-cookie"===t?(a[t]?a[t]:[]).concat([n]):a[t]?a[t]+", "+n:n}})),a):a}},98089:function(e){"use strict";e.exports=function(e){return function(t){return e.apply(null,t)}}},47835:function(e,t,n){"use strict";var r=n(88593),i={};["object","boolean","number","function","string","symbol"].forEach((function(e,t){i[e]=function(n){return typeof n===e||"a"+(t<1?"n ":" ")+e}}));var o={},a=r.version.split(".");function s(e,t){for(var n=t?t.split("."):a,r=e.split("."),i=0;i<3;i++){if(n[i]>r[i])return!0;if(n[i]<r[i])return!1}return!1}i.transitional=function(e,t,n){var i=t&&s(t);function a(e,t){return"[Axios v"+r.version+"] Transitional option '"+e+"'"+t+(n?". "+n:"")}return function(n,r,s){if(!1===e)throw new Error(a(r," has been removed in "+t));return i&&!o[r]&&(o[r]=!0,console.warn(a(r," has been deprecated since v"+t+" and will be removed in the near future"))),!e||e(n,r,s)}},e.exports={isOlderVersion:s,assertOptions:function(e,t,n){if("object"!==typeof e)throw new TypeError("options must be an object");for(var r=Object.keys(e),i=r.length;i-- >0;){var o=r[i],a=t[o];if(a){var s=e[o],u=void 0===s||a(s,o,e);if(!0!==u)throw new TypeError("option "+o+" must be "+u)}else if(!0!==n)throw Error("Unknown option "+o)}},validators:i}},33589:function(e,t,n){"use strict";var r=n(44049),i=Object.prototype.toString;function o(e){return"[object Array]"===i.call(e)}function a(e){return"undefined"===typeof e}function s(e){return null!==e&&"object"===typeof e}function u(e){if("[object Object]"!==i.call(e))return!1;var t=Object.getPrototypeOf(e);return null===t||t===Object.prototype}function c(e){return"[object Function]"===i.call(e)}function l(e,t){if(null!==e&&"undefined"!==typeof e)if("object"!==typeof e&&(e=[e]),o(e))for(var n=0,r=e.length;n<r;n++)t.call(null,e[n],n,e);else for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.call(null,e[i],i,e)}e.exports={isArray:o,isArrayBuffer:function(e){return"[object ArrayBuffer]"===i.call(e)},isBuffer:function(e){return null!==e&&!a(e)&&null!==e.constructor&&!a(e.constructor)&&"function"===typeof e.constructor.isBuffer&&e.constructor.isBuffer(e)},isFormData:function(e){return"undefined"!==typeof FormData&&e instanceof FormData},isArrayBufferView:function(e){return"undefined"!==typeof ArrayBuffer&&ArrayBuffer.isView?ArrayBuffer.isView(e):e&&e.buffer&&e.buffer instanceof ArrayBuffer},isString:function(e){return"string"===typeof e},isNumber:function(e){return"number"===typeof e},isObject:s,isPlainObject:u,isUndefined:a,isDate:function(e){return"[object Date]"===i.call(e)},isFile:function(e){return"[object File]"===i.call(e)},isBlob:function(e){return"[object Blob]"===i.call(e)},isFunction:c,isStream:function(e){return s(e)&&c(e.pipe)},isURLSearchParams:function(e){return"undefined"!==typeof URLSearchParams&&e instanceof URLSearchParams},isStandardBrowserEnv:function(){return("undefined"===typeof navigator||"ReactNative"!==navigator.product&&"NativeScript"!==navigator.product&&"NS"!==navigator.product)&&("undefined"!==typeof window&&"undefined"!==typeof document)},forEach:l,merge:function e(){var t={};function n(n,r){u(t[r])&&u(n)?t[r]=e(t[r],n):u(n)?t[r]=e({},n):o(n)?t[r]=n.slice():t[r]=n}for(var r=0,i=arguments.length;r<i;r++)l(arguments[r],n);return t},extend:function(e,t,n){return l(t,(function(t,i){e[i]=n&&"function"===typeof t?r(t,n):t})),e},trim:function(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")},stripBOM:function(e){return 65279===e.charCodeAt(0)&&(e=e.slice(1)),e}}},2009:function(e,t){"use strict";t.byteLength=function(e){var t=s(e),n=t[0],r=t[1];return 3*(n+r)/4-r},t.toByteArray=function(e){var t,n,o=s(e),a=o[0],u=o[1],c=new i(function(e,t,n){return 3*(t+n)/4-n}(0,a,u)),l=0,d=u>0?a-4:a;for(n=0;n<d;n+=4)t=r[e.charCodeAt(n)]<<18|r[e.charCodeAt(n+1)]<<12|r[e.charCodeAt(n+2)]<<6|r[e.charCodeAt(n+3)],c[l++]=t>>16&255,c[l++]=t>>8&255,c[l++]=255&t;2===u&&(t=r[e.charCodeAt(n)]<<2|r[e.charCodeAt(n+1)]>>4,c[l++]=255&t);1===u&&(t=r[e.charCodeAt(n)]<<10|r[e.charCodeAt(n+1)]<<4|r[e.charCodeAt(n+2)]>>2,c[l++]=t>>8&255,c[l++]=255&t);return c},t.fromByteArray=function(e){for(var t,r=e.length,i=r%3,o=[],a=16383,s=0,c=r-i;s<c;s+=a)o.push(u(e,s,s+a>c?c:s+a));1===i?(t=e[r-1],o.push(n[t>>2]+n[t<<4&63]+"==")):2===i&&(t=(e[r-2]<<8)+e[r-1],o.push(n[t>>10]+n[t>>4&63]+n[t<<2&63]+"="));return o.join("")};for(var n=[],r=[],i="undefined"!==typeof Uint8Array?Uint8Array:Array,o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",a=0;a<64;++a)n[a]=o[a],r[o.charCodeAt(a)]=a;function s(e){var t=e.length;if(t%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var n=e.indexOf("=");return-1===n&&(n=t),[n,n===t?0:4-n%4]}function u(e,t,r){for(var i,o,a=[],s=t;s<r;s+=3)i=(e[s]<<16&16711680)+(e[s+1]<<8&65280)+(255&e[s+2]),a.push(n[(o=i)>>18&63]+n[o>>12&63]+n[o>>6&63]+n[63&o]);return a.join("")}r["-".charCodeAt(0)]=62,r["_".charCodeAt(0)]=63},44037:function(e,t,n){"use strict";var r=n(52506),i=n(19722),o=i(r("String.prototype.indexOf"));e.exports=function(e,t){var n=r(e,!!t);return"function"===typeof n&&o(e,".prototype.")>-1?i(n):n}},19722:function(e,t,n){"use strict";var r=n(33350),i=n(52506),o=i("%Function.prototype.apply%"),a=i("%Function.prototype.call%"),s=i("%Reflect.apply%",!0)||r.call(a,o),u=i("%Object.getOwnPropertyDescriptor%",!0),c=i("%Object.defineProperty%",!0),l=i("%Math.max%");if(c)try{c({},"a",{value:1})}catch(h){c=null}e.exports=function(e){var t=s(r,a,arguments);u&&c&&(u(t,"length").configurable&&c(t,"length",{value:1+l(0,e.length-(arguments.length-1))}));return t};var d=function(){return s(r,o,arguments)};c?c(e.exports,"apply",{value:d}):e.exports.apply=d},84255:function(e,t){var n="undefined"!==typeof self?self:this,r=function(){function e(){this.fetch=!1,this.DOMException=n.DOMException}return e.prototype=n,new e}();!function(e){!function(t){var n="URLSearchParams"in e,r="Symbol"in e&&"iterator"in Symbol,i="FileReader"in e&&"Blob"in e&&function(){try{return new Blob,!0}catch(e){return!1}}(),o="FormData"in e,a="ArrayBuffer"in e;if(a)var s=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],u=ArrayBuffer.isView||function(e){return e&&s.indexOf(Object.prototype.toString.call(e))>-1};function c(e){if("string"!==typeof e&&(e=String(e)),/[^a-z0-9\-#$%&'*+.^_`|~]/i.test(e))throw new TypeError("Invalid character in header field name");return e.toLowerCase()}function l(e){return"string"!==typeof e&&(e=String(e)),e}function d(e){var t={next:function(){var t=e.shift();return{done:void 0===t,value:t}}};return r&&(t[Symbol.iterator]=function(){return t}),t}function h(e){this.map={},e instanceof h?e.forEach((function(e,t){this.append(t,e)}),this):Array.isArray(e)?e.forEach((function(e){this.append(e[0],e[1])}),this):e&&Object.getOwnPropertyNames(e).forEach((function(t){this.append(t,e[t])}),this)}function f(e){if(e.bodyUsed)return Promise.reject(new TypeError("Already read"));e.bodyUsed=!0}function p(e){return new Promise((function(t,n){e.onload=function(){t(e.result)},e.onerror=function(){n(e.error)}}))}function v(e){var t=new FileReader,n=p(t);return t.readAsArrayBuffer(e),n}function g(e){if(e.slice)return e.slice(0);var t=new Uint8Array(e.byteLength);return t.set(new Uint8Array(e)),t.buffer}function m(){return this.bodyUsed=!1,this._initBody=function(e){var t;this._bodyInit=e,e?"string"===typeof e?this._bodyText=e:i&&Blob.prototype.isPrototypeOf(e)?this._bodyBlob=e:o&&FormData.prototype.isPrototypeOf(e)?this._bodyFormData=e:n&&URLSearchParams.prototype.isPrototypeOf(e)?this._bodyText=e.toString():a&&i&&((t=e)&&DataView.prototype.isPrototypeOf(t))?(this._bodyArrayBuffer=g(e.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer])):a&&(ArrayBuffer.prototype.isPrototypeOf(e)||u(e))?this._bodyArrayBuffer=g(e):this._bodyText=e=Object.prototype.toString.call(e):this._bodyText="",this.headers.get("content-type")||("string"===typeof e?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):n&&URLSearchParams.prototype.isPrototypeOf(e)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},i&&(this.blob=function(){var e=f(this);if(e)return e;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))},this.arrayBuffer=function(){return this._bodyArrayBuffer?f(this)||Promise.resolve(this._bodyArrayBuffer):this.blob().then(v)}),this.text=function(){var e=f(this);if(e)return e;if(this._bodyBlob)return function(e){var t=new FileReader,n=p(t);return t.readAsText(e),n}(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(function(e){for(var t=new Uint8Array(e),n=new Array(t.length),r=0;r<t.length;r++)n[r]=String.fromCharCode(t[r]);return n.join("")}(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},o&&(this.formData=function(){return this.text().then(w)}),this.json=function(){return this.text().then(JSON.parse)},this}h.prototype.append=function(e,t){e=c(e),t=l(t);var n=this.map[e];this.map[e]=n?n+", "+t:t},h.prototype.delete=function(e){delete this.map[c(e)]},h.prototype.get=function(e){return e=c(e),this.has(e)?this.map[e]:null},h.prototype.has=function(e){return this.map.hasOwnProperty(c(e))},h.prototype.set=function(e,t){this.map[c(e)]=l(t)},h.prototype.forEach=function(e,t){for(var n in this.map)this.map.hasOwnProperty(n)&&e.call(t,this.map[n],n,this)},h.prototype.keys=function(){var e=[];return this.forEach((function(t,n){e.push(n)})),d(e)},h.prototype.values=function(){var e=[];return this.forEach((function(t){e.push(t)})),d(e)},h.prototype.entries=function(){var e=[];return this.forEach((function(t,n){e.push([n,t])})),d(e)},r&&(h.prototype[Symbol.iterator]=h.prototype.entries);var y=["DELETE","GET","HEAD","OPTIONS","POST","PUT"];function b(e,t){var n=(t=t||{}).body;if(e instanceof b){if(e.bodyUsed)throw new TypeError("Already read");this.url=e.url,this.credentials=e.credentials,t.headers||(this.headers=new h(e.headers)),this.method=e.method,this.mode=e.mode,this.signal=e.signal,n||null==e._bodyInit||(n=e._bodyInit,e.bodyUsed=!0)}else this.url=String(e);if(this.credentials=t.credentials||this.credentials||"same-origin",!t.headers&&this.headers||(this.headers=new h(t.headers)),this.method=function(e){var t=e.toUpperCase();return y.indexOf(t)>-1?t:e}(t.method||this.method||"GET"),this.mode=t.mode||this.mode||null,this.signal=t.signal||this.signal,this.referrer=null,("GET"===this.method||"HEAD"===this.method)&&n)throw new TypeError("Body not allowed for GET or HEAD requests");this._initBody(n)}function w(e){var t=new FormData;return e.trim().split("&").forEach((function(e){if(e){var n=e.split("="),r=n.shift().replace(/\+/g," "),i=n.join("=").replace(/\+/g," ");t.append(decodeURIComponent(r),decodeURIComponent(i))}})),t}function S(e){var t=new h;return e.replace(/\r?\n[\t ]+/g," ").split(/\r?\n/).forEach((function(e){var n=e.split(":"),r=n.shift().trim();if(r){var i=n.join(":").trim();t.append(r,i)}})),t}function k(e,t){t||(t={}),this.type="default",this.status=void 0===t.status?200:t.status,this.ok=this.status>=200&&this.status<300,this.statusText="statusText"in t?t.statusText:"OK",this.headers=new h(t.headers),this.url=t.url||"",this._initBody(e)}b.prototype.clone=function(){return new b(this,{body:this._bodyInit})},m.call(b.prototype),m.call(k.prototype),k.prototype.clone=function(){return new k(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new h(this.headers),url:this.url})},k.error=function(){var e=new k(null,{status:0,statusText:""});return e.type="error",e};var C=[301,302,303,307,308];k.redirect=function(e,t){if(-1===C.indexOf(t))throw new RangeError("Invalid status code");return new k(null,{status:t,headers:{location:e}})},t.DOMException=e.DOMException;try{new t.DOMException}catch(E){t.DOMException=function(e,t){this.message=e,this.name=t;var n=Error(e);this.stack=n.stack},t.DOMException.prototype=Object.create(Error.prototype),t.DOMException.prototype.constructor=t.DOMException}function x(e,n){return new Promise((function(r,o){var a=new b(e,n);if(a.signal&&a.signal.aborted)return o(new t.DOMException("Aborted","AbortError"));var s=new XMLHttpRequest;function u(){s.abort()}s.onload=function(){var e={status:s.status,statusText:s.statusText,headers:S(s.getAllResponseHeaders()||"")};e.url="responseURL"in s?s.responseURL:e.headers.get("X-Request-URL");var t="response"in s?s.response:s.responseText;r(new k(t,e))},s.onerror=function(){o(new TypeError("Network request failed"))},s.ontimeout=function(){o(new TypeError("Network request failed"))},s.onabort=function(){o(new t.DOMException("Aborted","AbortError"))},s.open(a.method,a.url,!0),"include"===a.credentials?s.withCredentials=!0:"omit"===a.credentials&&(s.withCredentials=!1),"responseType"in s&&i&&(s.responseType="blob"),a.headers.forEach((function(e,t){s.setRequestHeader(t,e)})),a.signal&&(a.signal.addEventListener("abort",u),s.onreadystatechange=function(){4===s.readyState&&a.signal.removeEventListener("abort",u)}),s.send("undefined"===typeof a._bodyInit?null:a._bodyInit)}))}x.polyfill=!0,e.fetch||(e.fetch=x,e.Headers=h,e.Request=b,e.Response=k),t.Headers=h,t.Request=b,t.Response=k,t.fetch=x,Object.defineProperty(t,"__esModule",{value:!0})}({})}(r),r.fetch.ponyfill=!0,delete r.fetch.polyfill;var i=r;(t=i.fetch).default=i.fetch,t.fetch=i.fetch,t.Headers=i.Headers,t.Request=i.Request,t.Response=i.Response,e.exports=t},18392:function(e,t,n){t.formatArgs=function(t){if(t[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+t[0]+(this.useColors?"%c ":" ")+"+"+e.exports.humanize(this.diff),!this.useColors)return;var n="color: "+this.color;t.splice(1,0,n,"color: inherit");var r=0,i=0;t[0].replace(/%[a-zA-Z%]/g,(function(e){"%%"!==e&&(r++,"%c"===e&&(i=r))})),t.splice(i,0,n)},t.save=function(e){try{e?t.storage.setItem("debug",e):t.storage.removeItem("debug")}catch(n){}},t.load=function(){var e;try{e=t.storage.getItem("debug")}catch(n){}!e&&"undefined"!==typeof process&&"env"in process&&(e={NODE_ENV:"production",PUBLIC_URL:".",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0,REACT_APP_CLIENT_ID:"69d2d73f-7402-4632-9876-6dd3a1891bde",REACT_APP_START_LOGIN_PAGE_URL:"https://m365tab111aef.z33.web.core.windows.net/auth-start.html"}.DEBUG);return e},t.useColors=function(){if("undefined"!==typeof window&&window.process&&("renderer"===window.process.type||window.process.__nwjs))return!0;if("undefined"!==typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;return"undefined"!==typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!==typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!==typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||"undefined"!==typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)},t.storage=function(){try{return localStorage}catch(e){}}(),t.destroy=function(){var e=!1;return function(){e||(e=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}}(),t.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],t.log=console.debug||console.log||function(){},e.exports=n(18472)(t),e.exports.formatters.j=function(e){try{return JSON.stringify(e)}catch(t){return"[UnexpectedJSONParseError]: "+t.message}}},18472:function(e,t,n){var r=n(861).default;e.exports=function(e){function t(e){var n,r,o,a=null;function s(){for(var e=arguments.length,r=new Array(e),i=0;i<e;i++)r[i]=arguments[i];if(s.enabled){var o=s,a=Number(new Date),u=a-(n||a);o.diff=u,o.prev=n,o.curr=a,n=a,r[0]=t.coerce(r[0]),"string"!==typeof r[0]&&r.unshift("%O");var c=0;r[0]=r[0].replace(/%([a-zA-Z%])/g,(function(e,n){if("%%"===e)return"%";c++;var i=t.formatters[n];if("function"===typeof i){var a=r[c];e=i.call(o,a),r.splice(c,1),c--}return e})),t.formatArgs.call(o,r),(o.log||t.log).apply(o,r)}}return s.namespace=e,s.useColors=t.useColors(),s.color=t.selectColor(e),s.extend=i,s.destroy=t.destroy,Object.defineProperty(s,"enabled",{enumerable:!0,configurable:!1,get:function(){return null!==a?a:(r!==t.namespaces&&(r=t.namespaces,o=t.enabled(e)),o)},set:function(e){a=e}}),"function"===typeof t.init&&t.init(s),s}function i(e,n){var r=t(this.namespace+("undefined"===typeof n?":":n)+e);return r.log=this.log,r}function o(e){return e.toString().substring(2,e.toString().length-2).replace(/\.\*\?$/,"*")}return t.debug=t,t.default=t,t.coerce=function(e){if(e instanceof Error)return e.stack||e.message;return e},t.disable=function(){var e=[].concat(r(t.names.map(o)),r(t.skips.map(o).map((function(e){return"-"+e})))).join(",");return t.enable(""),e},t.enable=function(e){var n;t.save(e),t.namespaces=e,t.names=[],t.skips=[];var r=("string"===typeof e?e:"").split(/[\s,]+/),i=r.length;for(n=0;n<i;n++)r[n]&&("-"===(e=r[n].replace(/\*/g,".*?"))[0]?t.skips.push(new RegExp("^"+e.slice(1)+"$")):t.names.push(new RegExp("^"+e+"$")))},t.enabled=function(e){if("*"===e[e.length-1])return!0;var n,r;for(n=0,r=t.skips.length;n<r;n++)if(t.skips[n].test(e))return!1;for(n=0,r=t.names.length;n<r;n++)if(t.names[n].test(e))return!0;return!1},t.humanize=n(78193),t.destroy=function(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")},Object.keys(e).forEach((function(n){t[n]=e[n]})),t.names=[],t.skips=[],t.formatters={},t.selectColor=function(e){for(var n=0,r=0;r<e.length;r++)n=(n<<5)-n+e.charCodeAt(r),n|=0;return t.colors[Math.abs(n)%t.colors.length]},t.enable(t.load()),t}},63133:function(e){"use strict";function t(e){if(this._capacity=r(e),this._length=0,this._front=0,n(e)){for(var t=e.length,i=0;i<t;++i)this[i]=e[i];this._length=t}}t.prototype.toArray=function(){for(var e=this._length,t=new Array(e),n=this._front,r=this._capacity,i=0;i<e;++i)t[i]=this[n+i&r-1];return t},t.prototype.push=function(e){var t=arguments.length,n=this._length;if(t>1){var r=this._capacity;if(n+t>r){for(var i=0;i<t;++i){this._checkCapacity(n+1),this[o=this._front+n&this._capacity-1]=arguments[i],n++,this._length=n}return n}for(var o=this._front,i=0;i<t;++i)this[o+n&r-1]=arguments[i],o++;return this._length=n+t,n+t}return 0===t?n:(this._checkCapacity(n+1),this[i=this._front+n&this._capacity-1]=e,this._length=n+1,n+1)},t.prototype.pop=function(){var e=this._length;if(0!==e){var t=this._front+e-1&this._capacity-1,n=this[t];return this[t]=void 0,this._length=e-1,n}},t.prototype.shift=function(){var e=this._length;if(0!==e){var t=this._front,n=this[t];return this[t]=void 0,this._front=t+1&this._capacity-1,this._length=e-1,n}},t.prototype.unshift=function(e){var t=this._length,n=arguments.length;if(n>1){if(t+n>(i=this._capacity)){for(var r=n-1;r>=0;r--){this._checkCapacity(t+1);var i=this._capacity;this[a=(this._front-1&i-1^i)-i]=arguments[r],t++,this._length=t,this._front=a}return t}var o=this._front;for(r=n-1;r>=0;r--){var a;this[a=(o-1&i-1^i)-i]=arguments[r],o=a}return this._front=o,this._length=t+n,t+n}if(0===n)return t;this._checkCapacity(t+1);i=this._capacity;return this[r=(this._front-1&i-1^i)-i]=e,this._length=t+1,this._front=r,t+1},t.prototype.peekBack=function(){var e=this._length;if(0!==e)return this[this._front+e-1&this._capacity-1]},t.prototype.peekFront=function(){if(0!==this._length)return this[this._front]},t.prototype.get=function(e){var t=e;if(t===(0|t)){var n=this._length;if(t<0&&(t+=n),!(t<0||t>=n))return this[this._front+t&this._capacity-1]}},t.prototype.isEmpty=function(){return 0===this._length},t.prototype.clear=function(){for(var e=this._length,t=this._front,n=this._capacity,r=0;r<e;++r)this[t+r&n-1]=void 0;this._length=0,this._front=0},t.prototype.toString=function(){return this.toArray().toString()},t.prototype.valueOf=t.prototype.toString,t.prototype.removeFront=t.prototype.shift,t.prototype.removeBack=t.prototype.pop,t.prototype.insertFront=t.prototype.unshift,t.prototype.insertBack=t.prototype.push,t.prototype.enqueue=t.prototype.push,t.prototype.dequeue=t.prototype.shift,t.prototype.toJSON=t.prototype.toArray,Object.defineProperty(t.prototype,"length",{get:function(){return this._length},set:function(){throw new RangeError("")}}),t.prototype._checkCapacity=function(e){this._capacity<e&&this._resizeTo(r(1.5*this._capacity+16))},t.prototype._resizeTo=function(e){var t=this._capacity;this._capacity=e;var n=this._front,r=this._length;n+r>t&&function(e,t,n,r,i){for(var o=0;o<i;++o)n[o+r]=e[o+t],e[o+t]=void 0}(this,0,this,t,n+r&t-1)};var n=Array.isArray;function r(e){if("number"!==typeof e){if(!n(e))return 16;e=e.length}return t=Math.min(Math.max(16,e),1073741824),t>>>=0,t-=1,t|=t>>1,t|=t>>2,t|=t>>4,t|=t>>8,1+(t|=t>>16);var t}e.exports=t},47465:function(e){"use strict";var t,n="object"===typeof Reflect?Reflect:null,r=n&&"function"===typeof n.apply?n.apply:function(e,t,n){return Function.prototype.apply.call(e,t,n)};t=n&&"function"===typeof n.ownKeys?n.ownKeys:Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.getOwnPropertyNames(e)};var i=Number.isNaN||function(e){return e!==e};function o(){o.init.call(this)}e.exports=o,e.exports.once=function(e,t){return new Promise((function(n,r){function i(n){e.removeListener(t,o),r(n)}function o(){"function"===typeof e.removeListener&&e.removeListener("error",i),n([].slice.call(arguments))}v(e,t,o,{once:!0}),"error"!==t&&function(e,t,n){"function"===typeof e.on&&v(e,"error",t,n)}(e,i,{once:!0})}))},o.EventEmitter=o,o.prototype._events=void 0,o.prototype._eventsCount=0,o.prototype._maxListeners=void 0;var a=10;function s(e){if("function"!==typeof e)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof e)}function u(e){return void 0===e._maxListeners?o.defaultMaxListeners:e._maxListeners}function c(e,t,n,r){var i,o,a,c;if(s(n),void 0===(o=e._events)?(o=e._events=Object.create(null),e._eventsCount=0):(void 0!==o.newListener&&(e.emit("newListener",t,n.listener?n.listener:n),o=e._events),a=o[t]),void 0===a)a=o[t]=n,++e._eventsCount;else if("function"===typeof a?a=o[t]=r?[n,a]:[a,n]:r?a.unshift(n):a.push(n),(i=u(e))>0&&a.length>i&&!a.warned){a.warned=!0;var l=new Error("Possible EventEmitter memory leak detected. "+a.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");l.name="MaxListenersExceededWarning",l.emitter=e,l.type=t,l.count=a.length,c=l,console&&console.warn&&console.warn(c)}return e}function l(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function d(e,t,n){var r={fired:!1,wrapFn:void 0,target:e,type:t,listener:n},i=l.bind(r);return i.listener=n,r.wrapFn=i,i}function h(e,t,n){var r=e._events;if(void 0===r)return[];var i=r[t];return void 0===i?[]:"function"===typeof i?n?[i.listener||i]:[i]:n?function(e){for(var t=new Array(e.length),n=0;n<t.length;++n)t[n]=e[n].listener||e[n];return t}(i):p(i,i.length)}function f(e){var t=this._events;if(void 0!==t){var n=t[e];if("function"===typeof n)return 1;if(void 0!==n)return n.length}return 0}function p(e,t){for(var n=new Array(t),r=0;r<t;++r)n[r]=e[r];return n}function v(e,t,n,r){if("function"===typeof e.on)r.once?e.once(t,n):e.on(t,n);else{if("function"!==typeof e.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof e);e.addEventListener(t,(function i(o){r.once&&e.removeEventListener(t,i),n(o)}))}}Object.defineProperty(o,"defaultMaxListeners",{enumerable:!0,get:function(){return a},set:function(e){if("number"!==typeof e||e<0||i(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");a=e}}),o.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},o.prototype.setMaxListeners=function(e){if("number"!==typeof e||e<0||i(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this},o.prototype.getMaxListeners=function(){return u(this)},o.prototype.emit=function(e){for(var t=[],n=1;n<arguments.length;n++)t.push(arguments[n]);var i="error"===e,o=this._events;if(void 0!==o)i=i&&void 0===o.error;else if(!i)return!1;if(i){var a;if(t.length>0&&(a=t[0]),a instanceof Error)throw a;var s=new Error("Unhandled error."+(a?" ("+a.message+")":""));throw s.context=a,s}var u=o[e];if(void 0===u)return!1;if("function"===typeof u)r(u,this,t);else{var c=u.length,l=p(u,c);for(n=0;n<c;++n)r(l[n],this,t)}return!0},o.prototype.addListener=function(e,t){return c(this,e,t,!1)},o.prototype.on=o.prototype.addListener,o.prototype.prependListener=function(e,t){return c(this,e,t,!0)},o.prototype.once=function(e,t){return s(t),this.on(e,d(this,e,t)),this},o.prototype.prependOnceListener=function(e,t){return s(t),this.prependListener(e,d(this,e,t)),this},o.prototype.removeListener=function(e,t){var n,r,i,o,a;if(s(t),void 0===(r=this._events))return this;if(void 0===(n=r[e]))return this;if(n===t||n.listener===t)0===--this._eventsCount?this._events=Object.create(null):(delete r[e],r.removeListener&&this.emit("removeListener",e,n.listener||t));else if("function"!==typeof n){for(i=-1,o=n.length-1;o>=0;o--)if(n[o]===t||n[o].listener===t){a=n[o].listener,i=o;break}if(i<0)return this;0===i?n.shift():function(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}(n,i),1===n.length&&(r[e]=n[0]),void 0!==r.removeListener&&this.emit("removeListener",e,a||t)}return this},o.prototype.off=o.prototype.removeListener,o.prototype.removeAllListeners=function(e){var t,n,r;if(void 0===(n=this._events))return this;if(void 0===n.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==n[e]&&(0===--this._eventsCount?this._events=Object.create(null):delete n[e]),this;if(0===arguments.length){var i,o=Object.keys(n);for(r=0;r<o.length;++r)"removeListener"!==(i=o[r])&&this.removeAllListeners(i);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"===typeof(t=n[e]))this.removeListener(e,t);else if(void 0!==t)for(r=t.length-1;r>=0;r--)this.removeListener(e,t[r]);return this},o.prototype.listeners=function(e){return h(this,e,!0)},o.prototype.rawListeners=function(e){return h(this,e,!1)},o.listenerCount=function(e,t){return"function"===typeof e.listenerCount?e.listenerCount(t):f.call(e,t)},o.prototype.listenerCount=f,o.prototype.eventNames=function(){return this._eventsCount>0?t(this._events):[]}},33226:function(e,t,n){"use strict";n.r(t),n.d(t,{AttachState:function(){return r.mB},ConnectionState:function(){return o.e},ContainerErrorType:function(){return i.u},DOProviderContainerRuntimeFactory:function(){return u.Y},DirectoryFactory:function(){return d.y},DriverErrorType:function(){return a.C},FluidContainer:function(){return s.G},Interval:function(){return fe},IntervalCollection:function(){return Ae},IntervalCollectionIterator:function(){return Ie},IntervalType:function(){return se},LocalValueMaker:function(){return h.oU},MapFactory:function(){return l.c},PaddingSegment:function(){return mn},RootDataObject:function(){return u.i},RunSegment:function(){return yn},SequenceDeltaEvent:function(){return tn},SequenceEvent:function(){return en},SequenceInterval:function(){return pe},SequenceMaintenanceEvent:function(){return nn},ServiceAudience:function(){return c.c},SharedDirectory:function(){return d.u},SharedIntervalCollection:function(){return Pn},SharedIntervalCollectionFactory:function(){return _n},SharedMap:function(){return l.G},SharedNumberSequence:function(){return dn},SharedNumberSequenceFactory:function(){return vn},SharedObjectSequence:function(){return hn},SharedObjectSequenceFactory:function(){return pn},SharedSegmentSequence:function(){return sn},SharedSequence:function(){return ln},SharedString:function(){return gn},SharedStringFactory:function(){return fn},SparseMatrix:function(){return In},SparseMatrixFactory:function(){return An},SubSequence:function(){return cn},maxCellPosition:function(){return Cn},maxCol:function(){return bn},maxCols:function(){return wn},maxRow:function(){return Sn},maxRows:function(){return kn},positionToRowCol:function(){return En},rowColToPosition:function(){return xn}});var r=n(57115),i=n(90142),o=n(13093),a=n(84871),s=n(99039),u=n(80124),c=n(11071),l=n(2517),d=n(24615),h=n(57994),f=n(37762),p=n(60136),v=n(29388),g=n(15671),m=n(43144),y=n(4942);function b(e,t){if(!e)throw new Error("number"===typeof t?"0x".concat(t.toString(16).padStart(3,"0")):t)}var w,S=n(97326),k=n(11752),C=n(61120),x=function(e){(0,p.Z)(n,e);var t=(0,v.Z)(n);function n(){var e,r,i,o,a,s,u,c;return(0,g.Z)(this,n),(c=t.call(this)).addListener=(0,k.Z)((e=(0,S.Z)(c),(0,C.Z)(n.prototype)),"addListener",e).bind((0,S.Z)(c)),c.on=(0,k.Z)((r=(0,S.Z)(c),(0,C.Z)(n.prototype)),"on",r).bind((0,S.Z)(c)),c.once=(0,k.Z)((i=(0,S.Z)(c),(0,C.Z)(n.prototype)),"once",i).bind((0,S.Z)(c)),c.prependListener=(0,k.Z)((o=(0,S.Z)(c),(0,C.Z)(n.prototype)),"prependListener",o).bind((0,S.Z)(c)),c.prependOnceListener=(0,k.Z)((a=(0,S.Z)(c),(0,C.Z)(n.prototype)),"prependOnceListener",a).bind((0,S.Z)(c)),c.removeListener=(0,k.Z)((s=(0,S.Z)(c),(0,C.Z)(n.prototype)),"removeListener",s).bind((0,S.Z)(c)),c.off=(0,k.Z)((u=(0,S.Z)(c),(0,C.Z)(n.prototype)),"off",u).bind((0,S.Z)(c)),c}return(0,m.Z)(n)}(n(47465).EventEmitter),E=n(10357);!function(e){e[e.Simple=0]="Simple",e[e.Tile=1]="Tile",e[e.NestBegin=2]="NestBegin",e[e.NestEnd=4]="NestEnd",e[e.RangeBegin=16]="RangeBegin",e[e.RangeEnd=32]="RangeEnd",e[e.SlideOnRemove=64]="SlideOnRemove",e[e.StayOnRemove=128]="StayOnRemove",e[e.Transient=256]="Transient"}(w||(w={}));var T={INSERT:0,REMOVE:1,ANNOTATE:2,GROUP:3},I="referenceRangeLabels";function A(e,t){return 0!==(("number"===typeof e?e:e.refType)&t)}var R=function(e){return A(e,w.Tile)&&e.properties?e.properties.referenceTileLabels:void 0},_=function(e){return A(e,w.NestBegin|w.NestEnd)&&e.properties?e.properties[I]:void 0};function P(e,t){var n=R(e);if(n){var r,i=(0,f.Z)(n);try{for(i.s();!(r=i.n()).done;){if(t===r.value)return!0}}catch(o){i.e(o)}finally{i.f()}}return!1}function N(e,t){var n=_(e);if(n){var r,i=(0,f.Z)(n);try{for(i.s();!(r=i.n()).done;){if(t===r.value)return!0}}catch(o){i.e(o)}finally{i.f()}}return!1}function O(e){return void 0!==R(e)}function M(e){return void 0!==_(e)}function F(e,t){var n=e.getSegment(),r=t.getSegment();return n===r?e.getOffset()-t.getOffset():void 0===n||void 0!==r&&n.ordinal<r.ordinal?-1:1}function Z(e,t){if(!e)throw new Error("number"===typeof t?"0x".concat(t.toString(16).padStart(3,"0")):t)}var D=-1,L=-2,B=-1,q=-2;function j(e,t,n,r){var i=t;switch(void 0===i&&(i=e.defaultValue),e.name){case"incr":i+=n,e.minValue&&i<e.minValue&&(i=e.minValue);break;case"consensus":if(void 0===i){i={value:n,seq:r}}else{var o=i;-1===o.seq&&(o.seq=r)}}return i}function U(e,t){if(e){if(!t)return!1;for(var n in e){if(void 0===t[n])return!1;if("object"===typeof t[n]){if(!U(e[n],t[n]))return!1}else if(t[n]!==e[n])return!1}for(var r in t)if(void 0===e[r])return!1}else if(t)return!1;return!0}function H(e,t,n,r){if(void 0!==t)for(var i in t){var o=t[i];null===o?delete e[i]:n&&"rewrite"!==n.name?e[i]=j(n,e[i],o,r):e[i]=o}return e}function z(e,t,n,r){var i=e;return(!i||n&&"rewrite"===n.name)&&(i=V()),H(i,t,n,r),i}function V(){return Object.create(null)}var G=function(){function e(){(0,g.Z)(this,e),this.pendingRewriteCount=0}return(0,m.Z)(e,[{key:"ackPendingProperties",value:function(e){var t,n;e.combiningOp&&"rewrite"===e.combiningOp.name&&this.pendingRewriteCount--;for(var r=0,i=Object.keys(e.props);r<i.length;r++){var o=i[r];void 0!==(null===(t=this.pendingKeyUpdateCount)||void 0===t?void 0:t[o])&&(Z(this.pendingKeyUpdateCount[o]>0,92),this.pendingKeyUpdateCount[o]--,0===(null===(n=this.pendingKeyUpdateCount)||void 0===n?void 0:n[o])&&delete this.pendingKeyUpdateCount[o])}}},{key:"addProperties",value:function(e,t,n,r){var i,o=this,a=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(this.pendingKeyUpdateCount||(this.pendingKeyUpdateCount=V()),!(this.pendingRewriteCount>0&&r!==D&&a)){var s=n&&"rewrite"===n.name,u=s?void 0:n||void 0,c=function(e){var t;return!(r!==D&&void 0!==(null===(t=o.pendingKeyUpdateCount)||void 0===t?void 0:t[e])&&!u)},l={};if(s){a&&r===D&&this.pendingRewriteCount++;for(var d=0,h=Object.keys(e);d<h.length;d++){var f=h[d];!t[f]&&c(f)&&(l[f]=e[f],delete e[f])}}for(var p=0,v=Object.keys(t);p<v.length;p++){var g=v[p];if(a)if(r===D)void 0===(null===(i=this.pendingKeyUpdateCount)||void 0===i?void 0:i[g])&&(this.pendingKeyUpdateCount[g]=0),this.pendingKeyUpdateCount[g]++;else if(!c(g))continue;var m=e[g];l[g]=void 0===m?null:m;var y=void 0;null===(y=u?j(u,m,y,r):t[g])?delete e[g]:e[g]=y}return l}}},{key:"copyTo",value:function(e,t,n){if(e){if(t||(t=V()),!n)throw new Error("Must provide new PropertyManager");for(var r=0,i=Object.keys(e);r<i.length;r++){var o=i[r];t[o]=e[o]}n.pendingRewriteCount=this.pendingRewriteCount,n.pendingKeyUpdateCount=V();for(var a=0,s=Object.keys(this.pendingKeyUpdateCount);a<s.length;a++){var u=s[a];n.pendingKeyUpdateCount[u]=this.pendingKeyUpdateCount[u]}}return t}},{key:"hasPendingProperties",value:function(){return this.pendingRewriteCount>0||Object.keys(this.pendingKeyUpdateCount).length>0}}]),e}(),K=n(93433),W=function(){function e(){(0,g.Z)(this,e),this.items=[]}return(0,m.Z)(e,[{key:"push",value:function(e){this.items.push(e)}},{key:"empty",value:function(){return 0===this.items.length}},{key:"top",value:function(){return this.items[this.items.length-1]}},{key:"pop",value:function(){return this.items.pop()}}]),e}();function J(e){if(void 0!==e&&!e.isHead)return e.next.prev=e.prev,e.prev.next=e.next,e}function Q(e){return new X(!1,e)}function Y(){return new X(!0,void 0)}var X=function(e){function t(e,n){(0,g.Z)(this,t),this.isHead=e,this.data=n,this.prev=this,this.next=this}return(0,m.Z)(t,[{key:"clear",value:function(){this.isHead&&(this.prev=this,this.next=this)}},{key:"add",value:function(e){var t=Q(e);return this.prev.next=t,t.next=this,t.prev=this.prev,this.prev=t,t}},{key:"dequeue",value:function(){if(!this.empty())return J(this.next).data}},{key:"enqueue",value:function(e){return this.add(e)}},{key:"walk",value:function(e){for(var t=this.next;!t.isHead;t=t.next)e(t.data,t)}},{key:"some",value:function(e,t){for(var n=[],r=t?this.prev:this.next;!r.isHead;r=t?r.prev:r.next){var i=r.data;e(i,r)&&(t?n.unshift(i):n.push(i))}return n}},{key:"count",value:function(){var e,t;for(e=this.next,t=0;!e.isHead;t++)e=e.next;return t}},{key:"first",value:function(){if(!this.empty())return this.next.data}},{key:"last",value:function(){if(!this.empty())return this.prev.data}},{key:"empty",value:function(){return this.next===this}},{key:"push",value:function(e){this.unshift(e)}},{key:"unshift",value:function(e){var t=Q(e);t.data=e,t.isHead=!1,t.next=this.next,t.prev=this,this.next=t,t.next.prev=t}},{key:e,value:function(){var e=this;return(0,y.Z)({next:function(){for(;e&&!1===e.next.isHead;)if(void 0!==(e=e.next).data)return{value:e.data,done:!1};return{value:void 0,done:!0}}},Symbol.iterator,(function(){return this}))}}]),t}(Symbol.iterator),$=function(){function e(t,n){(0,g.Z)(this,e),this.comp=n,this.L=[n.min];for(var r=0,i=t.length;r<i;r++)this.add(t[r])}return(0,m.Z)(e,[{key:"count",value:function(){return this.L.length-1}},{key:"peek",value:function(){return this.L[1]}},{key:"get",value:function(){var e=this.L[1];return this.L[1]=this.L[this.count()],this.L.pop(),this.fixDown(1),e}},{key:"add",value:function(e){this.L.push(e),this.fixup(this.count())}},{key:"fixup",value:function(e){for(var t=e;t>1&&this.comp.compare(this.L[t>>1],this.L[t])>0;){var n=this.L[t>>1];this.L[t>>1]=this.L[t],this.L[t]=n,t>>=1}}},{key:"fixDown",value:function(e){for(var t=e;t<<1<=this.count();){var n=t<<1;if(n<this.count()&&this.comp.compare(this.L[n],this.L[n+1])>0&&n++,this.comp.compare(this.L[t],this.L[n])<=0)break;var r=this.L[t];this.L[t]=this.L[n],this.L[n]=r,t=n}}}]),e}(),ee=0,te=1,ne=function(){function e(t,n){(0,g.Z)(this,e),this.compareKeys=t,this.aug=n}return(0,m.Z)(e,[{key:"makeNode",value:function(e,t,n,r){return{key:e,data:t,color:n,size:r}}},{key:"isRed",value:function(e){return!!e&&e.color===ee}},{key:"nodeSize",value:function(e){return e?e.size:0}},{key:"size",value:function(){return this.nodeSize(this.root)}},{key:"isEmpty",value:function(){return!this.root}},{key:"get",value:function(e){if(void 0!==e)return this.nodeGet(this.root,e)}},{key:"nodeGet",value:function(e,t){for(var n=e;n;){var r=this.compareKeys(t,n.key);if(r<0)n=n.left;else{if(!(r>0))return n;n=n.right}}}},{key:"contains",value:function(e){return this.get(e)}},{key:"gather",value:function(e,t){var n=[];return void 0!==e&&this.nodeGather(this.root,n,e,t),n}},{key:"nodeGather",value:function(e,t,n,r){e&&(r.continueSubtree(e.left,n)&&this.nodeGather(e.left,t,n,r),r.matchNode(e,n)&&t.push(e),r.continueSubtree(e.right,n)&&this.nodeGather(e.right,t,n,r))}},{key:"walkExactMatchesForward",value:function(e,t,n,r){this.nodeWalkExactMatchesForward(this.root,e,t,n,r)}},{key:"nodeWalkExactMatchesForward",value:function(e,t,n,r,i){if(e){var o=t(e);r(o)&&this.nodeWalkExactMatchesForward(e.left,t,n,r,i),0===o&&n(e),i(o)&&this.nodeWalkExactMatchesForward(e.right,t,n,r,i)}}},{key:"walkExactMatchesBackward",value:function(e,t,n,r){this.nodeWalkExactMatchesBackward(this.root,e,t,n,r)}},{key:"nodeWalkExactMatchesBackward",value:function(e,t,n,r,i){if(e){var o=t(e);i(o)&&this.nodeWalkExactMatchesBackward(e.right,t,n,r,i),0===o&&n(e),r(o)&&this.nodeWalkExactMatchesBackward(e.left,t,n,r,i)}}},{key:"put",value:function(e,t,n){void 0!==e&&(void 0===t?this.remove(e):(this.root=this.nodePut(this.root,e,t,n),this.root.color=te))}},{key:"nodePut",value:function(e,t,n,r){var i=e;if(i){var o=this.compareKeys(t,i.key);if(o<0)i.left=this.nodePut(i.left,t,n,r);else if(o>0)i.right=this.nodePut(i.right,t,n,r);else if(r){var a=r(t,i.key,n,i.data);a.key&&(i.key=a.key),a.data?i.data=a.data:i.data=n}else i.data=n;return this.isRed(i.right)&&!this.isRed(i.left)&&(i=this.rotateLeft(i)),this.isRed(i.left)&&this.isRed(i.left.left)&&(i=this.rotateRight(i)),this.isRed(i.left)&&this.isRed(i.right)&&this.flipColors(i),i.size=this.nodeSize(i.left)+this.nodeSize(i.right)+1,this.aug&&this.updateLocal(i),i}return this.makeNode(t,n,ee,1)}},{key:"updateLocal",value:function(e){this.aug&&(this.isRed(e.left)&&this.aug.update(e.left),this.isRed(e.right)&&this.aug.update(e.right),this.aug.update(e))}},{key:"nodeRemoveMin",value:function(e){var t=e;if(t.left)return this.isRed(t.left)||this.isRed(t.left.left)||(t=this.moveRedLeft(t)),t.left=this.nodeRemoveMin(t.left),this.balance(t)}},{key:"remove",value:function(e){if(void 0!==e){if(!this.contains(e))return;this.removeExisting(e)}}},{key:"removeExisting",value:function(e){this.isRed(this.root.left)||this.isRed(this.root.right)||(this.root.color=ee),this.root=this.nodeRemove(this.root,e)}},{key:"nodeRemove",value:function(e,t){var n=e;if(this.compareKeys(t,n.key)<0)this.isRed(n.left)||this.isRed(n.left.left)||(n=this.moveRedLeft(n)),n.left=this.nodeRemove(n.left,t);else{if(this.isRed(n.left)&&(n=this.rotateRight(n)),0===this.compareKeys(t,n.key)&&!n.right)return;if(this.isRed(n.right)||this.isRed(n.right.left)||(n=this.moveRedRight(n)),0===this.compareKeys(t,n.key)){var r=this.nodeMin(n.right);n.key=r.key,n.data=r.data,n.right=this.nodeRemoveMin(n.right)}else n.right=this.nodeRemove(n.right,t)}return this.balance(n)}},{key:"floor",value:function(e){if(!this.isEmpty())return this.nodeFloor(this.root,e)}},{key:"nodeFloor",value:function(e,t){if(e){var n=this.compareKeys(t,e.key);if(0===n)return e;if(n<0)return this.nodeFloor(e.left,t);var r=this.nodeFloor(e.right,t);return r||e}}},{key:"ceil",value:function(e){if(!this.isEmpty())return this.nodeCeil(this.root,e)}},{key:"nodeCeil",value:function(e,t){if(e){var n=this.compareKeys(t,e.key);if(0===n)return e;if(n>0)return this.nodeCeil(e.right,t);var r=this.nodeCeil(e.left,t);return r||e}}},{key:"min",value:function(){if(this.root)return this.nodeMin(this.root)}},{key:"nodeMin",value:function(e){return e.left?this.nodeMin(e.left):e}},{key:"max",value:function(){if(this.root)return this.nodeMax(this.root)}},{key:"nodeMax",value:function(e){return e.right?this.nodeMax(e.right):e}},{key:"rotateRight",value:function(e){var t=e.left;return e.left=t.right,t.right=e,t.color=t.right.color,t.right.color=ee,t.size=e.size,e.size=this.nodeSize(e.left)+this.nodeSize(e.right)+1,this.aug&&(this.updateLocal(e),this.updateLocal(t)),t}},{key:"rotateLeft",value:function(e){var t=e.right;return e.right=t.left,t.left=e,t.color=t.left.color,t.left.color=ee,t.size=e.size,e.size=this.nodeSize(e.left)+this.nodeSize(e.right)+1,this.aug&&(this.updateLocal(e),this.updateLocal(t)),t}},{key:"oppositeColor",value:function(e){return e===te?ee:te}},{key:"flipColors",value:function(e){e.color=this.oppositeColor(e.color),e.left.color=this.oppositeColor(e.left.color),e.right.color=this.oppositeColor(e.right.color)}},{key:"moveRedLeft",value:function(e){var t=e;return this.flipColors(t),this.isRed(t.right.left)&&(t.right=this.rotateRight(t.right),t=this.rotateLeft(t),this.flipColors(t)),t}},{key:"moveRedRight",value:function(e){var t=e;return this.flipColors(t),this.isRed(t.left.left)&&(t=this.rotateRight(t),this.flipColors(t)),t}},{key:"balance",value:function(e){var t=e;return this.isRed(t.right)&&(t=this.rotateLeft(t)),this.isRed(t.left)&&this.isRed(t.left.left)&&(t=this.rotateRight(t)),this.isRed(t.left)&&this.isRed(t.right)&&this.flipColors(t),t.size=this.nodeSize(t.left)+this.nodeSize(t.right)+1,this.aug&&this.aug.update(t),t}},{key:"mapRange",value:function(e,t,n,r){this.nodeMap(this.root,e,n,r)}},{key:"map",value:function(e,t){this.nodeMap(this.root,e,t)}},{key:"keys",value:function(){var e=[],t={showStructure:!0,infix:function(t){return e.push(t.key),!0}};return this.walk(t),e}},{key:"walk",value:function(e){this.nodeWalk(this.root,e)}},{key:"walkBackward",value:function(e){this.nodeWalkBackward(this.root,e)}},{key:"nodeWalk",value:function(e,t){var n=!0;return e&&(t.pre&&(t.showStructure||e.color===te)&&(n=t.pre(e)),e.left&&(n=this.nodeWalk(e.left,t)),n&&t.infix&&(t.showStructure||e.color===te)&&(n=t.infix(e)),n&&(n=this.nodeWalk(e.right,t)),n&&t.post&&(t.showStructure||e.color===te)&&(n=t.post(e))),n}},{key:"nodeWalkBackward",value:function(e,t){var n=!0;return e&&(t.pre&&(t.showStructure||e.color===te)&&(n=t.pre(e)),e.right&&(n=this.nodeWalkBackward(e.right,t)),n&&t.infix&&(t.showStructure||e.color===te)&&(n=t.infix(e)),n&&(n=this.nodeWalkBackward(e.left,t)),n&&t.post&&(t.showStructure||e.color===te)&&(n=t.post(e))),n}},{key:"nodeMap",value:function(e,t,n,r,i){var o=r,a=i;if(!e)return!0;void 0===o&&(o=this.nodeMin(e).key),void 0===a&&(a=this.nodeMax(e).key);var s=this.compareKeys(o,e.key),u=this.compareKeys(a,e.key),c=!0;return s<0&&(c=this.nodeMap(e.left,t,n,o,a)),c&&s<=0&&u>=0&&(c=t(e,n)),c&&u>0&&(c=this.nodeMap(e.right,t,n,o,a)),c}}]),e}(),re=function(e,t){return e.compare(t)},ie=function(){function e(){(0,g.Z)(this,e),this.intervals=new ne(re,this)}return(0,m.Z)(e,[{key:"remove",value:function(e){this.intervals.remove(e)}},{key:"removeExisting",value:function(e){this.intervals.removeExisting(e)}},{key:"put",value:function(e,t){var n;t&&(n=function(e,n){return{key:t(e,n)}}),this.intervals.put(e,{minmax:e.clone()},n)}},{key:"map",value:function(e){var t={infix:function(t){return e(t.key),!0},showStructure:!0};this.intervals.walk(t)}},{key:"mapUntil",value:function(e){var t={infix:function(t){return e(t.key)},showStructure:!0};this.intervals.walk(t)}},{key:"mapBackward",value:function(e){var t={infix:function(t){return e(t.key),!0},showStructure:!0};this.intervals.walkBackward(t)}},{key:"match",value:function(e){return this.intervals.gather(e,this)}},{key:"matchNode",value:function(e,t){return!!e&&e.key.overlaps(t)}},{key:"continueSubtree",value:function(e,t){return!!e&&e.data.minmax.overlaps(t)}},{key:"update",value:function(e){e.left&&e.right?e.data.minmax=e.key.union(e.left.data.minmax.union(e.right.data.minmax)):e.left?e.data.minmax=e.key.union(e.left.data.minmax):e.right?e.data.minmax=e.key.union(e.right.data.minmax):e.data.minmax=e.key.clone()}}]),e}();var oe=function(){function e(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:w.Simple,o=arguments.length>4?arguments[4]:void 0;(0,g.Z)(this,e),this.client=t,this.offset=r,this.refType=i,function(e){var t=0;if(A(e,w.Transient)&&++t,A(e,w.SlideOnRemove)&&++t,A(e,w.StayOnRemove)&&++t,t>1)throw new E.Oi("Reference types can only be one of Transient, SlideOnRemove, and StayOnRemove")}(i),this.segment=n,this.properties=o}return(0,m.Z)(e,[{key:"min",value:function(e){return function(e,t){return F(e,t)<0?e:t}(this,e)}},{key:"max",value:function(e){return function(e,t){return F(e,t)>0?e:t}(this,e)}},{key:"compare",value:function(e){return F(this,e)}},{key:"toPosition",value:function(){return this.getClient().localReferencePositionToPosition(this)}},{key:"hasTileLabels",value:function(){return O(this)}},{key:"hasRangeLabels",value:function(){return M(this)}},{key:"hasTileLabel",value:function(e){return P(this,e)}},{key:"hasRangeLabel",value:function(e){return N(this,e)}},{key:"getTileLabels",value:function(){return R(this)}},{key:"getRangeLabels",value:function(){return _(this)}},{key:"isLeaf",value:function(){return!1}},{key:"addProperties",value:function(e,t){this.properties=z(this.properties,e,t)}},{key:"getClient",value:function(){return this.client}},{key:"getSegment",value:function(){return this.segment}},{key:"getOffset",value:function(){return this.offset}},{key:"getProperties",value:function(){return this.properties}}]),e}();function ae(e){Z(e instanceof oe,736)}oe.DetachedPosition=-1;var se,ue=function(e){function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Array(e.cachedLength);(0,g.Z)(this,t),this.segment=e,this.hierRefCount=0,this.refCount=0,this.refsByOffset=n}return(0,m.Z)(t,[{key:e,value:function(){var e,t=[],n=(0,f.Z)(this.refsByOffset);try{for(n.s();!(e=n.n()).done;){var r=e.value;r&&(r.before&&t.push(r.before[Symbol.iterator]()),r.at&&t.push(r.at[Symbol.iterator]()),r.after&&t.push(r.after[Symbol.iterator]()))}}catch(i){n.e(i)}finally{n.f()}return(0,y.Z)({next:function(){for(;t.length>0;){var e=t[0].next();if(!0!==e.done)return e;t.shift()}return{value:void 0,done:!0}}},Symbol.iterator,(function(){return this}))}},{key:"clear",value:function(){var e=this;this.refCount=0,this.hierRefCount=0;for(var t=function(t){if(t){var n,r=(0,f.Z)(t);try{for(r.s();!(n=r.n()).done;){var i=n.value;i.segment===e.segment&&(i.segment=void 0)}}catch(o){r.e(o)}finally{r.f()}}},n=0;n<this.refsByOffset.length;n++){var r=this.refsByOffset[n];r&&(t(r.before),t(r.at),t(r.before),this.refsByOffset[n]=void 0)}}},{key:"empty",get:function(){return 0===this.refCount}},{key:"createLocalRef",value:function(e,t,n,r){var i=new oe(r,this.segment,e,t,n);return A(i,w.Transient)||this.addLocalRef(i),i}},{key:"addLocalRef",value:function(e){var t,n;Z(!A(e,w.Transient),735),ae(e);var r=this.refsByOffset[e.offset]=null!==(t=this.refsByOffset[e.offset])&&void 0!==t?t:{at:Y()};(r.at=null!==(n=r.at)&&void 0!==n?n:Y()).enqueue(e),(M(e)||O(e))&&this.hierRefCount++,this.refCount++}},{key:"removeLocalRef",value:function(e){var t=this;ae(e);var n=function(n){if(n){var r=n;do{if((r=r.next).data===e)return J(r),(M(e)||O(e))&&t.hierRefCount--,t.refCount--,e}while(!r.isHead)}},r=this.refsByOffset[e.offset];if(void 0!==r){var i=n(r.before);if(i)return i;if(i=n(r.at))return i;if(i=n(r.after))return i}}},{key:"append",value:function(e){var t;if(e&&!e.empty){this.hierRefCount+=e.hierRefCount,this.refCount+=e.refCount,e.hierRefCount=0;var n,r=(0,f.Z)(e);try{for(r.s();!(n=r.n()).done;){var i=n.value;i.segment=this.segment,i.offset+=this.refsByOffset.length}}catch(o){r.e(o)}finally{r.f()}(t=this.refsByOffset).push.apply(t,(0,K.Z)(e.refsByOffset))}}},{key:"split",value:function(e,n){if(this.empty)this.refsByOffset.length=e;else{var r=new t(n,this.refsByOffset.splice(e,this.refsByOffset.length-e));n.localRefs=r;var i,o=(0,f.Z)(r);try{for(o.s();!(i=o.n()).done;){var a=i.value;a.segment=n,a.offset-=e,(M(a)||O(a))&&(this.hierRefCount--,r.hierRefCount++),this.refCount--,r.refCount++}}catch(s){o.e(s)}finally{o.f()}}}},{key:"addBeforeTombstones",value:function(){for(var e,t,n,r,i,o=null!==(t=null===(e=this.refsByOffset[0])||void 0===e?void 0:e.before)&&void 0!==t?t:Y(),a=arguments.length,s=new Array(a),u=0;u<a;u++)s[u]=arguments[u];for(var c=0,l=s;c<l.length;c++){var d,h=l[c],p=(0,f.Z)(h);try{for(p.s();!(d=p.n()).done;){var v=d.value;ae(v),A(v,w.SlideOnRemove)?(o.push(v),v.segment=this.segment,v.offset=0,(M(v)||O(v))&&this.hierRefCount++,this.refCount++):v.segment=void 0}}catch(m){p.e(m)}finally{p.f()}}if(!o.empty()&&void 0===(null===(n=this.refsByOffset[0])||void 0===n?void 0:n.before)){var g=this.refsByOffset[0]=null!==(r=this.refsByOffset[0])&&void 0!==r?r:{before:o};g.before=null!==(i=g.before)&&void 0!==i?i:o}}},{key:"addAfterTombstones",value:function(){for(var e,t,n,r,i,o=this.refsByOffset.length-1,a=null!==(t=null===(e=this.refsByOffset[o])||void 0===e?void 0:e.after)&&void 0!==t?t:Y(),s=arguments.length,u=new Array(s),c=0;c<s;c++)u[c]=arguments[c];for(var l=0,d=u;l<d.length;l++){var h,p=d[l],v=(0,f.Z)(p);try{for(v.s();!(h=v.n()).done;){var g=h.value;ae(g),A(g,w.SlideOnRemove)?(a.push(g),g.segment=this.segment,g.offset=this.segment.cachedLength-1,(M(g)||O(g))&&this.hierRefCount++,this.refCount++):g.segment=void 0}}catch(y){v.e(y)}finally{v.f()}}if(!a.empty()&&void 0===(null===(n=this.refsByOffset[o])||void 0===n?void 0:n.after)){var m=this.refsByOffset[o]=null!==(r=this.refsByOffset[o])&&void 0!==r?r:{after:a};m.after=null!==(i=m.after)&&void 0!==i?i:a}}}],[{key:"append",value:function(e,n){n.localRefs&&!n.localRefs.empty?(e.localRefs||(e.localRefs=new t(e)),Z(e.localRefs.refsByOffset.length===e.cachedLength,702),e.localRefs.append(n.localRefs)):e.localRefs&&(e.localRefs.refsByOffset.length+=n.cachedLength)}}]),t}(Symbol.iterator),ce=n(65059),le=n(39575),de=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"===typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n},he="intervalId";!function(e){e[e.Simple=0]="Simple",e[e.Nest=1]="Nest",e[e.SlideOnRemove=2]="SlideOnRemove",e[e.Transient=4]="Transient"}(se||(se={}));var fe=function(){function e(t,n,r){(0,g.Z)(this,e),this.start=t,this.end=n,this.propertyManager=new G,this.properties={},r&&this.addProperties(r)}return(0,m.Z)(e,[{key:"getIntervalId",value:function(){var e,t=null===(e=this.properties)||void 0===e?void 0:e[he];if(void 0!==t)return"".concat(t)}},{key:"getAdditionalPropertySets",value:function(){return this.auxProps}},{key:"addPropertySet",value:function(e){void 0===this.auxProps&&(this.auxProps=[]),this.auxProps.push(e)}},{key:"serialize",value:function(e){var t=0;e&&(t=e.getCurrentSeq());var n={end:this.end,intervalType:0,sequenceNumber:t,start:this.start};return this.properties&&(n.properties=this.properties),n}},{key:"clone",value:function(){return new e(this.start,this.end,this.properties)}},{key:"compare",value:function(e){var t=this.compareStart(e);if(0===t){var n=this.compareEnd(e);if(0===n){var r=this.getIntervalId();if(r){var i=e.getIntervalId();return i?r>i?1:r<i?-1:0:0}return 0}return n}return t}},{key:"compareStart",value:function(e){return this.start-e.start}},{key:"compareEnd",value:function(e){return this.end-e.end}},{key:"overlaps",value:function(e){return this.start<=e.end&&this.end>=e.start}},{key:"union",value:function(t){return new e(Math.min(this.start,t.start),Math.max(this.end,t.end),this.properties)}},{key:"getProperties",value:function(){return this.properties}},{key:"addProperties",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0;if(e)return this.initializeProperties(),this.propertyManager.addProperties(this.properties,e,r,n,t)}},{key:"modify",value:function(t,n,r,i){var o=null!==n&&void 0!==n?n:this.start,a=null!==r&&void 0!==r?r:this.end;if(this.start!==o||this.end!==a){var s=new e(o,a);return this.properties&&(s.initializeProperties(),this.propertyManager.copyTo(this.properties,s.properties,s.propertyManager)),s}}},{key:"initializeProperties",value:function(){this.propertyManager||(this.propertyManager=new G),this.properties||(this.properties=V())}}]),e}(),pe=function(){function e(t,n,r,i){(0,g.Z)(this,e),this.start=t,this.end=n,this.intervalType=r,this.propertyManager=new G,this.properties={},i&&this.addProperties(i)}return(0,m.Z)(e,[{key:"addPositionChangeListeners",value:function(e,t){var n,r,i,o;if(void 0===this.callbacks){this.callbacks={beforePositionChange:e,afterPositionChange:t};var a=null!==(n=(i=this.start).callbacks)&&void 0!==n?n:i.callbacks={},s=null!==(r=(o=this.end).callbacks)&&void 0!==r?r:o.callbacks={};a.beforeSlide=s.beforeSlide=e,a.afterSlide=s.afterSlide=t}}},{key:"removePositionChangeListeners",value:function(){this.callbacks&&(this.callbacks=void 0,this.start.callbacks=void 0,this.end.callbacks=void 0)}},{key:"serialize",value:function(e){var t=this.start.toPosition(),n={end:this.end.toPosition(),intervalType:this.intervalType,sequenceNumber:e.getCurrentSeq(),start:t};return this.properties&&(n.properties=this.properties),n}},{key:"clone",value:function(){return new e(this.start,this.end,this.intervalType,this.properties)}},{key:"compare",value:function(e){var t=this.compareStart(e);if(0===t){var n=this.compareEnd(e);if(0===n){var r=this.getIntervalId();if(r){var i=e.getIntervalId();return i?r>i?1:r<i?-1:0:0}return 0}return n}return t}},{key:"compareStart",value:function(e){return this.start.compare(e.start)}},{key:"compareEnd",value:function(e){return this.end.compare(e.end)}},{key:"overlaps",value:function(e){return this.start.compare(e.end)<=0&&this.end.compare(e.start)>=0}},{key:"getIntervalId",value:function(){var e,t=null===(e=this.properties)||void 0===e?void 0:e[he];if(void 0!==t)return"".concat(t)}},{key:"union",value:function(t){return new e(this.start.min(t.start),this.end.max(t.end),this.intervalType)}},{key:"addProperties",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0;return this.initializeProperties(),this.propertyManager.addProperties(this.properties,e,r,n,t)}},{key:"overlapsPos",value:function(e,t){var n=this.start.toPosition();return this.start.toPosition()>e&&n<t}},{key:"modify",value:function(t,n,r,i){var o=function(e){var t=e;return void 0===i&&(t&=~w.SlideOnRemove,t|=w.StayOnRemove),t},a=this.start;void 0!==n&&(a=ge(this.start.getClient(),n,o(this.start.refType),i)).addProperties(this.start.properties);var s=this.end;void 0!==r&&(s=ge(this.end.getClient(),r,o(this.end.refType),i)).addProperties(this.end.properties),a.pairedRef=s,s.pairedRef=a;var u=new e(a,s,this.intervalType);return this.properties&&(u.initializeProperties(),this.propertyManager.copyTo(this.properties,u.properties,u.propertyManager)),u}},{key:"initializeProperties",value:function(){this.propertyManager||(this.propertyManager=new G),this.properties||(this.properties=V())}}]),e}();function ve(e,t,n,r){if(t.segment)return e.createLocalReferencePosition(t.segment,t.offset,n,void 0);if(!r&&!A(n,w.Transient))throw new E.Oi("Non-transient references need segment");return new oe(e,void 0,0,n)}function ge(e,t,n,r){var i;return r?(b(0!==(n&w.SlideOnRemove),757),i=e.getContainingSegment(t,r),i=e.getSlideToSegment(i)):(b(0===(n&w.SlideOnRemove),758),i=e.getContainingSegment(t)),ve(e,i,n,r)}function me(e,t,n,r,i,o){var a=w.RangeBegin,s=w.RangeEnd;i===se.Transient?(a=w.Transient,s=w.Transient):(i===se.Nest&&(a=w.NestBegin,s=w.NestEnd),o?(a|=w.SlideOnRemove,s|=w.SlideOnRemove):(a|=w.StayOnRemove,s|=w.StayOnRemove));var u=ge(r,t,a,o),c=ge(r,n,s,o);u.pairedRef=c,c.pairedRef=u;var l=(0,y.Z)({},I,[e]);return u.addProperties(l),c.addProperties(l),new pe(u,c,i,l)}var ye=function(){function e(t,n,r,i){(0,g.Z)(this,e),this.client=t,this.label=n,this.helpers=r,this.onPositionChange=i,this.intervalTree=new ie,this.intervalIdMap=new Map,this.endIntervalTree=new ne(r.compareEnds)}return(0,m.Z)(e,[{key:"addConflictResolver",value:function(e){this.conflictResolver=e,this.endConflictResolver=function(t,n){var r=e(t,n);return{data:r,key:r}}}},{key:"map",value:function(e){this.intervalTree.map(e)}},{key:"createLegacyId",value:function(t,n){return"".concat(e.legacyIdPrefix).concat(t,"-").concat(n)}},{key:"ensureSerializedId",value:function(e){var t,n=null===(t=e.properties)||void 0===t?void 0:t[he];if(void 0===n){n=this.createLegacyId(e.start,e.end);var r=(0,y.Z)({},he,n);e.properties=z(e.properties,r)}return Object.defineProperty(e.properties,he,{configurable:!1,enumerable:!0,writable:!1}),n}},{key:"mapUntil",value:function(e){this.intervalTree.mapUntil(e)}},{key:"gatherIterationResults",value:function(e,t,n,r){if(!this.intervalTree.intervals.isEmpty())if(void 0===n&&void 0===r)t?this.intervalTree.map((function(t){e.push(t)})):this.intervalTree.mapBackward((function(t){e.push(t)}));else{var i=this.helpers.create("transient",n,r,this.client,se.Transient);if(void 0===n)t?this.intervalTree.map((function(t){0===i.compareEnd(t)&&e.push(t)})):this.intervalTree.mapBackward((function(t){0===i.compareEnd(t)&&e.push(t)}));else{var o=void 0===r?function(e){return i.compareStart(e.key)}:function(e){return i.compare(e.key)},a=function(e){return e<=0},s=function(e){return e>=0},u=function(t){e.push(t.key)};t?this.intervalTree.intervals.walkExactMatchesForward(o,u,a,s):this.intervalTree.intervals.walkExactMatchesBackward(o,u,a,s)}}}},{key:"findOverlappingIntervals",value:function(e,t){if(t<e||this.intervalTree.intervals.isEmpty())return[];var n=this.helpers.create("transient",e,t,this.client,se.Transient);return this.intervalTree.match(n).map((function(e){return e.key}))}},{key:"previousInterval",value:function(e){var t=this.helpers.create("transient",e,e,this.client,se.Transient),n=this.endIntervalTree.floor(t);if(n)return n.data}},{key:"nextInterval",value:function(e){var t=this.helpers.create("transient",e,e,this.client,se.Transient),n=this.endIntervalTree.ceil(t);if(n)return n.data}},{key:"removeInterval",value:function(e,t){var n=this.helpers.create("transient",e,t,this.client,se.Transient);return this.intervalTree.remove(n),this.endIntervalTree.remove(n),n}},{key:"removeIntervalFromIndex",value:function(e){this.intervalTree.removeExisting(e),this.endIntervalTree.remove(e);var t=e.getIntervalId();b(void 0!==t,785),this.intervalIdMap.delete(t)}},{key:"removeExistingInterval",value:function(e){this.removeIntervalFromIndex(e),this.removeIntervalListeners(e)}},{key:"createInterval",value:function(e,t,n,r){return this.helpers.create(this.label,e,t,this.client,n,r)}},{key:"addInterval",value:function(e,t,n,r,i){var o=this.createInterval(e,t,n,i);return o&&(o.properties||(o.properties=V()),r&&o.addProperties(r),void 0===o.properties[he]&&(o.properties[he]=(0,le.Z)()),this.add(o)),o}},{key:"addIntervalToIndex",value:function(e){var t=e.getIntervalId();b(void 0!==t,704),Object.defineProperty(e.properties,he,{configurable:!1,enumerable:!0,writable:!1}),this.intervalTree.put(e,this.conflictResolver),this.endIntervalTree.put(e,e,this.endConflictResolver),this.intervalIdMap.set(t,e)}},{key:"add",value:function(e){this.addIntervalToIndex(e),this.addIntervalListeners(e)}},{key:"getIntervalById",value:function(e){return this.intervalIdMap.get(e)}},{key:"changeInterval",value:function(e,t,n,r){var i=e.modify(this.label,t,n,r);return i&&(this.removeExistingInterval(e),this.add(i)),i}},{key:"serialize",value:function(){var e=this.client,t=this.intervalTree.intervals.keys();return{label:this.label,intervals:t.map((function(t){return function(e){var t=e.start,n=e.end,r=e.sequenceNumber,i=e.intervalType,o=e.properties;return[t,n,r,i,Object.assign(Object.assign({},o),(0,y.Z)({},I,void 0))]}(t.serialize(e))})),version:2}}},{key:"addIntervalListeners",value:function(e){var t=this;e instanceof pe&&e.addPositionChangeListeners((function(){return t.removeIntervalFromIndex(e)}),(function(){var n;t.addIntervalToIndex(e),null===(n=t.onPositionChange)||void 0===n||n.call(t,e)}))}},{key:"removeIntervalListeners",value:function(e){e instanceof pe&&e.removePositionChangeListeners()}}]),e}();ye.legacyIdPrefix="legacy";var be=function(e,t){return e.end.compare(t.end)},we=function(){function e(){(0,g.Z)(this,e)}return(0,m.Z)(e,[{key:"load",value:function(e){return new Ae({compareEnds:be,create:me},!0,e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:[])}},{key:"store",value:function(e){return e.serializeInternal()}}]),e}(),Se=function(){function e(){(0,g.Z)(this,e)}return(0,m.Z)(e,[{key:"name",get:function(){return e.Name}},{key:"factory",get:function(){return e._factory}},{key:"ops",get:function(){return e._ops}}]),e}();Se.Name="sharedStringIntervalCollection",Se._factory=new we,Se._ops=Te();var ke=function(e,t){return e.end-t.end};function Ce(e,t,n,r){var i={};return e&&e.length>0&&(i[I]=[e]),new fe(t,n,i)}var xe=function(){function e(){(0,g.Z)(this,e)}return(0,m.Z)(e,[{key:"load",value:function(e){var t=new Ae({compareEnds:ke,create:Ce},!1,e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:[]);return t.attachGraph(void 0,""),t}},{key:"store",value:function(e){return e.serializeInternal()}}]),e}(),Ee=function(){function e(){(0,g.Z)(this,e)}return(0,m.Z)(e,[{key:"name",get:function(){return e.Name}},{key:"factory",get:function(){return e._factory}},{key:"ops",get:function(){return e._ops}}]),e}();function Te(){var e=function(e,t,n){var r=n.localSeq,i=e.rebaseLocalInterval(t.opName,t.value,r);return{rebasedOp:Object.assign(Object.assign({},t),{value:i}),rebasedLocalOpMetadata:n}};return new Map([["add",{process:function(e,t,n,r){e.ackAdd(t,n,r)},rebase:e}],["delete",{process:function(e,t,n,r){e.ackDelete(t,n,r)},rebase:function(e,t,n){return{rebasedOp:t,rebasedLocalOpMetadata:n}}}],["change",{process:function(e,t,n,r){e.ackChange(t,n,r)},rebase:e}]])}Ee.Name="sharedIntervalCollection",Ee._factory=new xe,Ee._ops=Te();var Ie=function(){function e(t){var n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=arguments.length>2?arguments[2]:void 0,i=arguments.length>3?arguments[3]:void 0;(0,g.Z)(this,e),this.results=[],this.index=0,t.gatherIterationResults(this.results,n,r,i)}return(0,m.Z)(e,[{key:"next",value:function(){var e,t=!0;return this.index<this.results.length&&(e=this.results[this.index++],t=!1),{value:e,done:t}}}]),e}(),Ae=function(e,t){(0,p.Z)(r,e);var n=(0,v.Z)(r);function r(e,t,i,o){var a;return(0,g.Z)(this,r),(a=n.call(this)).helpers=e,a.requiresClient=t,a.emitter=i,a.pendingChangesStart=new Map,a.pendingChangesEnd=new Map,Array.isArray(o)?a.savedSerializedIntervals=o:a.savedSerializedIntervals=o.intervals.map((function(e){return t=e,n=o.label,{start:t[0],end:t[1],sequenceNumber:t[2],intervalType:t[3],properties:Object.assign(Object.assign({},t[4]),(0,y.Z)({},I,n))};var t,n})),a}return(0,m.Z)(r,[{key:"attached",get:function(){return!!this.localCollection}},{key:"attachGraph",value:function(e,t){var n=this;if(this.attached)throw new ce.j4("Only supports one Sequence attach");if(void 0===e&&this.requiresClient)throw new ce.j4("Client required for this collection");if(this.client=e,this.localCollection=new ye(e,t,this.helpers,(function(e){return n.emit("changeInterval",e,!0,void 0)})),this.savedSerializedIntervals){var r,i=(0,f.Z)(this.savedSerializedIntervals);try{for(i.s();!(r=i.n()).done;){var o=r.value;this.localCollection.ensureSerializedId(o),this.localCollection.addInterval(o.start,o.end,o.intervalType,o.properties)}}catch(a){i.e(a)}finally{i.f()}}this.savedSerializedIntervals=void 0}},{key:"getNextLocalSeq",value:function(){return++this.client.getCollabWindow().localSeq}},{key:"getIntervalById",value:function(e){if(!this.attached)throw new ce.j4("attach must be called before accessing intervals");return this.localCollection.getIntervalById(e)}},{key:"add",value:function(e,t,n,r){var i,o;if(!this.attached)throw new ce.j4("attach must be called prior to adding intervals");if(n&se.Transient)throw new ce.j4("Can not add transient intervals");var a=this.localCollection.addInterval(e,t,n,r);if(a){var s={end:t,intervalType:n,properties:a.properties,sequenceNumber:null!==(o=null===(i=this.client)||void 0===i?void 0:i.getCurrentSeq())&&void 0!==o?o:0,start:e};this.emitter.emit("add",void 0,s,{localSeq:this.getNextLocalSeq()})}return this.emit("addInterval",a,!0,void 0),a}},{key:"deleteExistingInterval",value:function(e,t,n){this.localCollection.removeExistingInterval(e),e&&(t?this.emitter.emit("delete",void 0,e.serialize(this.client),{localSeq:this.getNextLocalSeq()}):this.onDeserialize&&this.onDeserialize(e)),this.emit("deleteInterval",e,t,n)}},{key:"removeIntervalById",value:function(e){var t=this.localCollection.getIntervalById(e);return t&&this.deleteExistingInterval(t,!0,void 0),t}},{key:"changeProperties",value:function(e,t){if(!this.attached)throw new ce.j4("Attach must be called before accessing intervals");if("string"!==typeof e)throw new ce.j4("Change API requires an ID that is a string");if(!t)throw new ce.j4("changeProperties should be called with a property set");var n=this.getIntervalById(e);if(n){var r=n.addProperties(t,!0,D),i=n.serialize(this.client);i.start=void 0,i.end=void 0,i.properties=t,i.properties[he]=n.getIntervalId(),this.emitter.emit("change",void 0,i,{localSeq:this.getNextLocalSeq()}),this.emit("propertyChanged",n,r)}this.emit("changeInterval",n,!0,void 0)}},{key:"change",value:function(e,t,n){if(!this.attached)throw new ce.j4("Attach must be called before accessing intervals");if("string"!==typeof e)throw new ce.j4("Change API requires an ID that is a string");var r=this.getIntervalById(e);if(r){var i=this.localCollection.changeInterval(r,t,n),o=r.serialize(this.client);return o.start=t,o.end=n,o.properties=(0,y.Z)({},he,r.getIntervalId()),this.emitter.emit("change",void 0,o,{localSeq:this.getNextLocalSeq()}),this.addPendingChange(e,o),this.emit("changeInterval",i,!0,void 0),i}}},{key:"addPendingChange",value:function(e,t){void 0!==t.start&&this.addPendingChangeHelper(e,this.pendingChangesStart,t),void 0!==t.end&&this.addPendingChangeHelper(e,this.pendingChangesEnd,t)}},{key:"addPendingChangeHelper",value:function(e,t,n){var r=t.get(e);r||(r=[],t.set(e,r)),r.push(n)}},{key:"removePendingChange",value:function(e){var t,n=null===(t=e.properties)||void 0===t?void 0:t[he];void 0!==e.start&&this.removePendingChangeHelper(n,this.pendingChangesStart,e),void 0!==e.end&&this.removePendingChangeHelper(n,this.pendingChangesEnd,e)}},{key:"removePendingChangeHelper",value:function(e,t,n){var r=t.get(e);if(r){var i=r.shift();if(0===r.length&&t.delete(e),(null===i||void 0===i?void 0:i.start)!==n.start||(null===i||void 0===i?void 0:i.end)!==n.end)throw new ce.j4("Mismatch in pending changes")}}},{key:"hasPendingChangeStart",value:function(e){var t=this.pendingChangesStart.get(e);return t&&0!==t.length}},{key:"hasPendingChangeEnd",value:function(e){var t=this.pendingChangesEnd.get(e);return t&&0!==t.length}},{key:"changeInterval",value:function(e,t,n){return this.ackChange(e,t,n)}},{key:"ackChange",value:function(e,t,n){var r,i,o,a,s;if(!this.attached)throw new ce.j4("Attach must be called before accessing intervals");if(t){this.removePendingChange(e);var u=null===(r=e.properties)||void 0===r?void 0:r[he];(s=this.getIntervalById(u))&&(null===(i=s.propertyManager)||void 0===i||i.ackPendingProperties({type:T.ANNOTATE,props:null!==(o=e.properties)&&void 0!==o?o:{}}),this.ackInterval(s,n))}else{var c=e.properties,l=he,d=c[l],h=de(c,[l+""]);if(s=this.getIntervalById(d)){var f,p;this.hasPendingChangeStart(d)||(f=e.start),this.hasPendingChangeEnd(d)||(p=e.end),void 0===f&&void 0===p||(s=null!==(a=this.localCollection.changeInterval(s,f,p,n))&&void 0!==a?a:s);var v=s.addProperties(h,!0,n.sequenceNumber);this.onDeserialize&&this.onDeserialize(s),this.emit("propertyChanged",s,v)}}s&&this.emit("changeInterval",s,t,n)}},{key:"addConflictResolver",value:function(e){if(!this.attached)throw new ce.j4("attachSequence must be called");this.localCollection.addConflictResolver(e)}},{key:"attachDeserializer",value:function(e){e&&(this.onDeserialize=e,this.localCollection.map((function(t){e(t)})))}},{key:"rebaseLocalInterval",value:function(e,t,n){var r,i;if(!this.attached)throw new ce.j4("attachSequence must be called");var o=t.start,a=t.end,s=t.intervalType,u=t.properties,c=t.sequenceNumber,l=void 0===o?void 0:this.client.rebasePosition(o,c,n),d=void 0===a?void 0:this.client.rebasePosition(a,c,n),h=null===u||void 0===u?void 0:u[he],f={start:l,end:d,intervalType:s,sequenceNumber:null!==(i=null===(r=this.client)||void 0===r?void 0:r.getCurrentSeq())&&void 0!==i?i:0,properties:u};return"change"===e&&(this.hasPendingChangeStart(h)||this.hasPendingChangeEnd(h))&&(this.removePendingChange(t),this.addPendingChange(h,f)),f}},{key:"getSlideToSegment",value:function(e){var t={segment:e.segment,offset:e.offset},n=this.client.getSlideToSegment(t);return t.segment===n.segment&&t.offset===n.offset?void 0:n}},{key:"setSlideOnRemove",value:function(e){var t=e.refType;t&=~w.StayOnRemove,t|=w.SlideOnRemove,e.refType=t}},{key:"ackInterval",value:function(e,t){if(e instanceof pe&&(A(e.start,w.StayOnRemove)||A(e.end,w.StayOnRemove))){var n=this.getSlideToSegment(e.start),r=this.getSlideToSegment(e.end),i=e.properties[he],o=this.hasPendingChangeStart(i),a=this.hasPendingChangeEnd(i);o||this.setSlideOnRemove(e.start),a||this.setSlideOnRemove(e.end);var s=void 0!==n&&!o,u=void 0!==r&&!a;if(s||u){if(this.localCollection.removeExistingInterval(e),s){var c=e.start.properties;this.client.removeLocalReferencePosition(e.start),e.start=ve(this.client,n,e.start.refType,t),c&&e.start.addProperties(c)}if(u){var l=e.end.properties;this.client.removeLocalReferencePosition(e.end),e.end=ve(this.client,r,e.end.refType,t),l&&e.end.addProperties(l)}this.localCollection.add(e)}}}},{key:"addInternal",value:function(e,t,n){return this.ackAdd(e,t,n)}},{key:"ackAdd",value:function(e,t,n){var r;if(!t){if(!this.attached)throw new ce.j4("attachSequence must be called");this.localCollection.ensureSerializedId(e);var i=this.localCollection.addInterval(e.start,e.end,e.intervalType,e.properties,n);return i&&this.onDeserialize&&this.onDeserialize(i),this.emit("addInterval",i,t,n),i}var o=null===(r=e.properties)||void 0===r?void 0:r[he],a=this.getIntervalById(o);a&&this.ackInterval(a,n)}},{key:"deleteInterval",value:function(e,t,n){return this.ackDelete(e,t,n)}},{key:"ackDelete",value:function(e,t,n){if(!t){if(!this.attached)throw new ce.j4("attach must be called prior to deleting intervals");var r=this.localCollection.ensureSerializedId(e),i=this.localCollection.getIntervalById(r);i&&this.deleteExistingInterval(i,t,n)}}},{key:"serializeInternal",value:function(){if(!this.attached)throw new ce.j4("attachSequence must be called");return this.localCollection.serialize()}},{key:t,value:function(){return new Ie(this)}},{key:"CreateForwardIteratorWithStartPosition",value:function(e){return new Ie(this,!0,e)}},{key:"CreateBackwardIteratorWithStartPosition",value:function(e){return new Ie(this,!1,e)}},{key:"CreateForwardIteratorWithEndPosition",value:function(e){return new Ie(this,!0,void 0,e)}},{key:"CreateBackwardIteratorWithEndPosition",value:function(e){return new Ie(this,!1,void 0,e)}},{key:"gatherIterationResults",value:function(e,t,n,r){this.attached&&this.localCollection.gatherIterationResults(e,t,n,r)}},{key:"findOverlappingIntervals",value:function(e,t){if(!this.attached)throw new ce.j4("attachSequence must be called");return this.localCollection.findOverlappingIntervals(e,t)}},{key:"map",value:function(e){if(!this.attached)throw new ce.j4("attachSequence must be called");this.localCollection.map(e)}},{key:"previousInterval",value:function(e){if(!this.attached)throw new ce.j4("attachSequence must be called");return this.localCollection.previousInterval(e)}},{key:"nextInterval",value:function(e){if(!this.attached)throw new ce.j4("attachSequence must be called");return this.localCollection.nextInterval(e)}}]),r}(x,Symbol.iterator),Re=-1,_e=-2,Pe=-3,Ne=-4,Oe=function(){function e(t){(0,g.Z)(this,e),this.segment=t,this.trackingGroups=new Set}return(0,m.Z)(e,[{key:"link",value:function(e){e&&(this.trackingGroups.has(e)||this.trackingGroups.add(e),e.has(this.segment)||e.link(this.segment))}},{key:"unlink",value:function(e){e.has(this.segment)&&e.unlink(this.segment),this.trackingGroups.delete(e)}},{key:"copyTo",value:function(e){this.trackingGroups.forEach((function(t){return e.trackingCollection.link(t)}))}},{key:"empty",get:function(){return 0===this.trackingGroups.size}},{key:"matches",value:function(e){if(!e||this.trackingGroups.size!==e.trackingGroups.size)return!1;var t,n=(0,f.Z)(this.trackingGroups.values());try{for(n.s();!(t=n.n()).done;){var r=t.value;if(!e.trackingGroups.has(r))return!1}}catch(i){n.e(i)}finally{n.f()}return!0}}]),e}();function Me(e,t){for(var n=-1,r=0,i=e.length-1;r<=i;){var o=r+Math.floor((i-r)/2);e[o].seq<=t?((n<0||e[n].seq<e[o].seq)&&(n=o),r=o+1):i=o-1}return n}var Fe=function(){function e(t){(0,g.Z)(this,e),this.minSeq=t,this.minLength=0,this.segmentCount=0,this.partialLengths=[],this.clientSeqNumbers=[]}return(0,m.Z)(e,[{key:"update",value:function(t,n,r,i,o){for(var a=0,s=0,u=0;u<n.childCount;u++){var c=n.children[u];if(c.isLeaf()){var l=c,d=De(l);l.seq===r?(null===d||void 0===d?void 0:d.removedSeq)!==r&&(a+=l.cachedLength):(null===d||void 0===d?void 0:d.removedSeq)===r&&(a-=l.cachedLength),s++}else{var h=c.partialLengths,f=h.partialLengths,p=Me(f,r);if(p>=0){var v=f[p];v.seq===r&&(a+=v.seglen)}s+=h.segmentCount}}this.segmentCount=s,e.addSeq(this.partialLengths,r,a,i),void 0===this.clientSeqNumbers[i]&&(this.clientSeqNumbers[i]=[]),e.addSeq(this.clientSeqNumbers[i],r,a),e.options.zamboni&&this.zamboni(o),e.options.verify&&this.verify()}},{key:"getPartialLength",value:function(e,t){var n=this.minLength,r=Me(this.partialLengths,e),i=this.cliLatest(t),o=this.clientSeqNumbers[t];if(r>=0){if(n+=this.partialLengths[r].len,i>=0){var a=o[i];if(a.seq>e){n+=a.len;var s=this.cliLatestLEQ(t,e);s>=0&&(n-=o[s].len)}}}else i>=0&&(n+=o[i].len);return n}},{key:"toString",value:function(e){var t,n="",r=(0,f.Z)(this.partialLengths);try{for(r.s();!(t=r.n()).done;){var i=t.value;n+="(".concat(i.seq,",").concat(i.len,") ")}}catch(c){r.e(c)}finally{r.f()}for(var o in this.clientSeqNumbers)if(this.clientSeqNumbers[o].length>0){n+="Client ",n+="".concat(e?e(+o):o),n+="[";var a,s=(0,f.Z)(this.clientSeqNumbers[o]);try{for(s.s();!(a=s.n()).done;){var u=a.value;n+="(".concat(u.seq,",").concat(u.len,")")}}catch(c){s.e(c)}finally{s.f()}n+="]"}return n="min(seq ".concat(this.minSeq,"): ").concat(this.minLength,"; sc: ").concat(this.segmentCount,";").concat(n)}},{key:"zamboni",value:function(e){function t(t){var n=Me(t,e.minSeq),r=0;if(n>=0){r=t[n].len;var i=t.length;if(n<=i-1){for(var o=i-n-1,a=0;a<o;a++)t[a]=t[a+n+1],t[a].len-=r;t.length=o}}return r}for(var n in this.minLength+=t(this.partialLengths),this.clientSeqNumbers){var r=this.clientSeqNumbers[n];r&&t(r)}}},{key:"addClientSeqNumber",value:function(e,t,n){void 0===this.clientSeqNumbers[e]&&(this.clientSeqNumbers[e]=[]);var r=this.clientSeqNumbers[e],i=n;r.length>0&&(i+=r[r.length-1].len),r.push({seq:t,len:i,seglen:n})}},{key:"addClientSeqNumberFromPartial",value:function(e){var t=this;this.addClientSeqNumber(e.clientId,e.seq,e.seglen),e.overlapRemoveClients&&e.overlapRemoveClients.map((function(n){return t.addClientSeqNumber(n.data.clientId,e.seq,n.data.seglen),!0}))}},{key:"cliLatestLEQ",value:function(e,t){var n=this.clientSeqNumbers[e];return n?Me(n,t):-1}},{key:"cliLatest",value:function(e){var t=this.clientSeqNumbers[e];return t&&t.length>0?t.length-1:-1}},{key:"verifyPartialLengths",value:function(e,t){if(0===e.length)return 0;var n,r=0,i=0,o=0,a=(0,f.Z)(e);try{for(a.s();!(n=a.n()).done;){var s=n.value;o++,Z(this.minSeq<=s.seq,84),Z(r<s.seq,85),r=s.seq,(i+=s.seglen)!==s.len&&Z(!1,86),t||this.minLength+s.len<0&&Z(!1,87),s.overlapRemoveClients&&(Z(!t,88),o+=s.overlapRemoveClients.size())}}catch(u){a.e(u)}finally{a.f()}return o}},{key:"verify",value:function(){if(this.clientSeqNumbers){var e,t=0,n=(0,f.Z)(this.clientSeqNumbers);try{for(n.s();!(e=n.n()).done;){var r=e.value;r&&(t+=this.verifyPartialLengths(r,!0))}}catch(i){n.e(i)}finally{n.f()}Z(!!this.partialLengths,89),Z(this.verifyPartialLengths(this.partialLengths,!1)===t,90)}else Z(!this.partialLengths,91)}}],[{key:"combine",value:function(t,n,r){var i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return e.combineBranch(t,n,r,i)}},{key:"combineBranch",value:function(t,n,r){var i,o=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=new e(r.minSeq);function s(e){if(e){var t=new ne(Xe);return e.map((function(e){return t.put(e.data.clientId,Object.assign({},e.data)),!0})),t}}function u(e){var t=e.seq,n=0;if(i){if(i.seq===e.seq)return i.seglen+=e.seglen,i.len+=e.seglen,void function(e,t){var n=e.overlapRemoveClients;n?t.overlapRemoveClients&&t.overlapRemoveClients.map((function(e){var t=n.get(e.key);return t?t.data.seglen+=e.data.seglen:n.put(e.data.clientId,Object.assign({},e.data)),!0})):e.overlapRemoveClients=s(t.overlapRemoveClients)}(i,e);n=i.len,a.addClientSeqNumberFromPartial(i)}i={clientId:e.clientId,len:n+e.seglen,overlapRemoveClients:s(e.overlapRemoveClients),seglen:e.seglen,seq:t},a.partialLengths.push(i)}e.fromLeaves(a,n,r);for(var c=[],l=0;l<n.childCount;l++){var d=n.children[l];if(!d.isLeaf()){var h=d;o&&(h.partialLengths=e.combine(t,h,r,!0)),c.push(h.partialLengths)}}var f=c.length;if(0!==f){a.partialLengths.length>0&&(c.push(a),f++,a=new e(r.minSeq));for(var p=new Array(f),v=new Array(f),g=0;g<f;g++)p[g]=0,v[g]=c[g].partialLengths.length,a.minLength+=c[g].minLength,a.segmentCount+=c[g].segmentCount;for(var m,y=0;y>=0;){y=-1;for(var b=0;b<f;b++)if(p[b]<v[b]){var w=c[b].partialLengths[p[b]];(y<0||w.seq<m.seq)&&(y=b,m=w)}y>=0&&(u(m),p[y]++)}i&&a.addClientSeqNumberFromPartial(i)}return e.options.zamboni&&a.zamboni(r),e.options.verify&&a.verify(),a}},{key:"fromLeaves",value:function(t,n,r){function i(e,t){return void 0!==e&&e!==D&&e<=t}t.minLength=0,t.segmentCount=n.childCount;for(var o=0;o<n.childCount;o++){var a=n.children[o];if(a.isLeaf()){var s=a;i(s.seq,r.minSeq)?t.minLength+=s.cachedLength:s.seq!==D&&e.insertSegment(t,s);var u=De(s);i(null===u||void 0===u?void 0:u.removedSeq,r.minSeq)?t.minLength-=s.cachedLength:void 0!==u&&u.removedSeq!==D&&e.insertSegment(t,s,u)}}for(var c=t.partialLengths,l=c.length,d=0,h=0;h<l;h++)c[h].len=d+c[h].seglen,d=c[h].len,t.addClientSeqNumberFromPartial(c[h]);e.options.verify&&t.verify()}},{key:"getOverlapClients",value:function(e,t){var n,r=new ne(Xe),i=(0,f.Z)(e);try{for(i.s();!(n=i.n()).done;){var o=n.value;r.put(o,{clientId:o,seglen:t})}}catch(a){i.e(a)}finally{i.f()}return r}},{key:"accumulateRemoveClientOverlap",value:function(t,n,r){if(t.overlapRemoveClients){var i,o=(0,f.Z)(n);try{for(o.s();!(i=o.n()).done;){var a=i.value,s=t.overlapRemoveClients.get(a);s?s.data.seglen+=r:t.overlapRemoveClients.put(a,{clientId:a,seglen:r})}}catch(u){o.e(u)}finally{o.f()}}else t.overlapRemoveClients=e.getOverlapClients(n,r)}},{key:"insertSegment",value:function(t,n,r){var i,o=n.seq,a=n.cachedLength,s=n.clientId;r&&(o=r.removedSeq,a=-a,s=r.removedClientIds[0],i=r.removedClientIds.length>1?r.removedClientIds.slice(1):void 0);for(var u=t.partialLengths,c=u.length,l=0;l<c&&!(u[l].seq>=o);l++);if(l<c&&u[l].seq===o)u[l].seglen+=a,i&&e.accumulateRemoveClientOverlap(u[l],i,a);else{var d;if(i)d={seq:o,clientId:s,len:0,seglen:a,overlapRemoveClients:e.getOverlapClients(i,a)};else d={seq:o,clientId:s,len:0,seglen:a};if(l<c){for(var h=c;h>l;h--)u[h]=u[h-1];u[l]=d}else u.push(d)}}},{key:"addSeq",value:function(e,t,n,r){var i,o,a=Me(e,t);if(a>=0){var s=e[a];s.seq===t?(i=s,(a=Me(e,t-1))>=0&&(o=e[a])):o=s}void 0===i?(i={clientId:r,seglen:n,seq:t},e.push(i)):i.seglen=n,i.len=void 0!==o?i.seglen+o.len:i.seglen}}]),e}();Fe.options={verify:!1,zamboni:!0};var Ze=function(){function e(t){(0,g.Z)(this,e),this.segment=t,this.segmentGroups=Y()}return(0,m.Z)(e,[{key:"size",get:function(){return this.segmentGroups.count()}},{key:"empty",get:function(){return this.segmentGroups.empty()}},{key:"enqueue",value:function(e){this.segmentGroups.enqueue(e),e.segments.push(this.segment)}},{key:"dequeue",value:function(){return this.segmentGroups.dequeue()}},{key:"clear",value:function(){this.segmentGroups.clear()}},{key:"copyTo",value:function(e){this.segmentGroups.walk((function(t){return e.segmentGroups.enqueue(t)}))}}]),e}();function De(e){if(void 0!==(null===e||void 0===e?void 0:e.removedClientIds)&&void 0!==(null===e||void 0===e?void 0:e.removedSeq))return e;Z(void 0===(null===e||void 0===e?void 0:e.removedClientIds)&&void 0===(null===e||void 0===e?void 0:e.removedSeq),703)}function Le(e){var t=De(e);return void 0!==t&&t.removedSeq!==D}var Be=function(){function e(){(0,g.Z)(this,e),this.index=0,this.ordinal="",this.cachedLength=0}return(0,m.Z)(e,[{key:"isLeaf",value:function(){return!1}}]),e}();function qe(e,t){var n=R(e);if(n){var r,i=(0,f.Z)(n);try{for(i.s();!(r=i.n()).done;){t[r.value]=e}}catch(o){i.e(o)}finally{i.f()}}}function je(e,t){var n=R(e);if(n){var r,i=(0,f.Z)(n);try{for(i.s();!(r=i.n()).done;){var o=r.value;void 0===t[o]&&(t[o]=e)}}catch(a){i.e(a)}finally{i.f()}}}function Ue(e,t){for(var n in t){var r=t[n];if(!r.empty()){var i=e[n];void 0===i&&(i=new W,e[n]=i);var o,a=(0,f.Z)(r.items);try{for(a.s();!(o=a.n()).done;){He(i,o.value)}}catch(s){a.e(s)}finally{a.f()}}}}function He(e,t){if(A(t,w.NestBegin))return e.push(t),!0;var n=e.top();return n&&A(n,w.NestBegin)?e.pop():e.push(t),!1}var ze=function(e){(0,p.Z)(n,e);var t=(0,v.Z)(n);function n(e){var r;return(0,g.Z)(this,n),(r=t.call(this)).childCount=e,r.children=new Array(8),r}return(0,m.Z)(n,[{key:"hierBlock",value:function(){}},{key:"setOrdinal",value:function(e,t){var n,r=this.childCount;8===r&&(r=7),Z(r>=1&&r<=7,64);var i=1<<8-(r+1);if(0===t)n=i-1;else{var o=this.children[t-1].ordinal;n=o.charCodeAt(o.length-1)+i}e.ordinal=this.ordinal+String.fromCharCode(n),Z(e.ordinal.length===this.ordinal.length+1,65),t>0&&Z(e.ordinal>this.children[t-1].ordinal,66)}},{key:"assignChild",value:function(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];e.parent=this,e.index=t,n&&this.setOrdinal(e,t),this.children[t]=e}}]),n}(Be),Ve=function(e){(0,p.Z)(n,e);var t=(0,v.Z)(n);function n(e){var r;return(0,g.Z)(this,n),(r=t.call(this,e)).rightmostTiles=V(),r.leftmostTiles=V(),r.rangeStacks=V(),r}return(0,m.Z)(n,[{key:"addNodeReferences",value:function(e,t){!function(e,t,n,r,i){var o;function a(e,t){var n=i[e];void 0===n&&(n=new W,i[e]=n),He(n,t)}if(t.isLeaf()){var s=t;if((null!==(o=e.localNetLength(s))&&void 0!==o?o:0)>0)if(Je.is(s)){var u=s.getId();if(u&&e.mapIdToSegment(u,s),A(s,w.Tile)&&(qe(s,n),je(s,r)),s.refType&(w.NestBegin|w.NestEnd)){var c=_(s);if(c){var l,d=(0,f.Z)(c);try{for(d.s();!(l=d.n()).done;)a(l.value,s)}catch(S){d.e(S)}finally{d.f()}}}}else{var h=t;if(h.localRefs&&void 0!==h.localRefs.hierRefCount&&h.localRefs.hierRefCount>0){var p,v=(0,f.Z)(h.localRefs);try{for(v.s();!(p=v.n()).done;){var g=p.value;if(A(g,w.Tile)&&(qe(g,n),je(g,r)),g.refType&(w.NestBegin|w.NestEnd)){var m,y=(0,f.Z)(_(g));try{for(y.s();!(m=y.n()).done;)a(m.value,g)}catch(S){y.e(S)}finally{y.f()}}}}catch(S){v.e(S)}finally{v.f()}}}}else{var b=t;Ue(i,b.rangeStacks),H(n,b.rightmostTiles),function(e,t){if(void 0!==t)for(var n in t)void 0===e[n]&&(e[n]=t[n])}(r,b.leftmostTiles)}}(e,t,this.rightmostTiles,this.leftmostTiles,this.rangeStacks)}},{key:"hierBlock",value:function(){return this}},{key:"hierToString",value:function(e){var t="";for(var n in this.rangeStacks){var r=this.rangeStacks[n];t+=tt(e),t+="".concat(n,": ");var i,o=(0,f.Z)(r.items);try{for(o.s();!(i=o.n()).done;){var a=i.value;t+="".concat(a.toString()," ")}}catch(s){o.e(s)}finally{o.f()}t+="\n"}return t}}]),n}(ze);var Ge,Ke=function(e){(0,p.Z)(n,e);var t=(0,v.Z)(n);function n(){var e;return(0,g.Z)(this,n),(e=t.apply(this,arguments)).clientId=B,e.seq=0,e.segmentGroups=new Ze((0,S.Z)(e)),e.trackingCollection=new Oe((0,S.Z)(e)),e}return(0,m.Z)(n,[{key:"addProperties",value:function(e,t,n,r){return this.propertyManager||(this.propertyManager=new G),this.properties||(this.properties=V()),this.propertyManager.addProperties(this.properties,e,t,n,r&&r.collaborating)}},{key:"hasProperty",value:function(e){return!!this.properties&&void 0!==this.properties[e]}},{key:"isLeaf",value:function(){return!0}},{key:"cloneInto",value:function(e){var t;e.clientId=this.clientId,e.properties=function(e){if(void 0!==e){var t=V();for(var n in e){var r=e[n];null!==r&&(t[n]=r)}return t}}(this.properties),e.removedClientIds=null===(t=this.removedClientIds)||void 0===t?void 0:t.slice(),e.removedSeq=this.removedSeq,e.seq=this.seq}},{key:"canAppend",value:function(e){return!1}},{key:"addSerializedProps",value:function(e){this.properties&&(e.props=this.properties)}},{key:"ack",value:function(e,t,n){switch(Z(this.segmentGroups.dequeue()===e,67),t.op.type){case T.ANNOTATE:return Z(!!this.propertyManager,68),this.propertyManager.ackPendingProperties(t.op),!0;case T.INSERT:return Z(this.seq===D,69),this.seq=t.sequencedMessage.sequenceNumber,this.localSeq=void 0,!0;case T.REMOVE:var r=De(this);return Z(void 0!==r,70),this.localRemovedSeq=void 0,r.removedSeq===D&&(r.removedSeq=t.sequencedMessage.sequenceNumber,!0);default:throw new Error("".concat(t.op.type," is in unrecognized operation type"))}}},{key:"splitAt",value:function(e){var t;if(e>0){var n=this.createSplitSegmentAt(e);return n&&(this.copyPropertiesTo(n),n.parent=this.parent,n.ordinal=this.ordinal+String.fromCharCode(0),n.removedClientIds=null===(t=this.removedClientIds)||void 0===t?void 0:t.slice(),n.removedSeq=this.removedSeq,n.localRemovedSeq=this.localRemovedSeq,n.seq=this.seq,n.localSeq=this.localSeq,n.clientId=this.clientId,this.segmentGroups.copyTo(n),this.trackingCollection.copyTo(n),this.localRefs&&this.localRefs.split(e,n)),n}}},{key:"copyPropertiesTo",value:function(e){this.propertyManager&&this.properties&&(e.propertyManager=new G,e.properties=this.propertyManager.copyTo(this.properties,e.properties,e.propertyManager))}}]),n}(Be),We="markerId",Je=function(e){(0,p.Z)(n,e);var t=(0,v.Z)(n);function n(e){var r;return(0,g.Z)(this,n),(r=t.call(this)).refType=e,r.type=n.type,r.cachedLength=1,r}return(0,m.Z)(n,[{key:"toJSONObject",value:function(){var e={marker:{refType:this.refType}};return(0,k.Z)((0,C.Z)(n.prototype),"addSerializedProps",this).call(this,e),e}},{key:"clone",value:function(){var e=n.make(this.refType,this.properties);return this.cloneInto(e),e}},{key:"getSegment",value:function(){return this}},{key:"getOffset",value:function(){return 0}},{key:"hasSimpleType",value:function(e){return!!this.properties&&this.properties.markerSimpleType===e}},{key:"getProperties",value:function(){return this.properties}},{key:"getId",value:function(){if(this.properties&&this.properties[We])return this.properties[We]}},{key:"hasTileLabels",value:function(){return O(this)}},{key:"hasRangeLabels",value:function(){return M(this)}},{key:"hasTileLabel",value:function(e){return P(this,e)}},{key:"hasRangeLabel",value:function(e){return N(this,e)}},{key:"getTileLabels",value:function(){return R(this)}},{key:"getRangeLabels",value:function(){return _(this)}},{key:"toString",value:function(){var e="";A(this,w.Tile)&&(e+="Tile"),A(this,w.NestBegin)&&(e.length>0&&(e+="; "),e+="RangeBegin"),A(this,w.NestEnd)&&(e.length>0&&(e+="; "),e+="RangeEnd");var t="",n=this.getId();n&&(e+=" (".concat(n,") "));var r=R(this);if(r){t+="tile -- ";for(var i=0,o=r.length;i<o;i++){i>0&&(t+="; "),t+=r[i]}}var a=_(this);if(a){var s="begin";A(this,w.NestEnd)&&(s="end"),r&&(t+=" "),t+="range ".concat(s," -- ");for(var u=a,c=0,l=u.length;c<l;c++){c>0&&(t+="; "),t+=u[c]}}var d="";return this.properties&&(d+=JSON.stringify(this.properties,(function(e,t){var n=!!t&&t.IFluidHandle;return n?"#Handle(".concat(n.routeContext.path,"/").concat(n.path,")"):t}))),"M ".concat(e,": ").concat(t," ").concat(d)}},{key:"createSplitSegmentAt",value:function(e){}},{key:"canAppend",value:function(e){return!1}},{key:"append",value:function(){throw new Error("Can not append to marker")}}],[{key:"is",value:function(e){return e.type===n.type}},{key:"make",value:function(e,t){var r=new n(e);return t&&r.addProperties(t),r}},{key:"fromJSONObject",value:function(e){if(e&&"object"===typeof e&&"marker"in e)return n.make(e.marker.refType,e.props)}}]),n}(Ke);Je.type="Marker",function(e){e[e.Go=0]="Go",e[e.Stop=1]="Stop",e[e.Yield=2]="Yield"}(Ge||(Ge={}));var Qe=(0,m.Z)((function e(t,n,r,i,o,a,s,u){var c=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0;(0,g.Z)(this,e),this.block=t,this.actions=n,this.pos=r,this.refSeq=i,this.clientId=o,this.context=a,this.start=s,this.end=u,this.childIndex=c,this.op=Ge.Go})),Ye=function(){function e(){(0,g.Z)(this,e),this.clientId=B,this.collaborating=!1,this.minSeq=0,this.currentSeq=0,this.localSeq=0}return(0,m.Z)(e,[{key:"loadFrom",value:function(e){this.clientId=e.clientId,this.collaborating=e.collaborating,this.minSeq=e.minSeq,this.currentSeq=e.currentSeq}}]),e}(),Xe=function(e,t){return e-t},$e=function(e,t){return e.localeCompare(t)},et=[""," ","  "];function tt(e){if(void 0===et[e]){et[e]="";for(var t=0;t<e;t++)et[e]+=" "}return et[e]}var nt={min:{maxSeq:-2},compare:function(e,t){return e.maxSeq-t.maxSeq}};function rt(e,t){var n,r=(0,f.Z)(t.rangeLabels);try{for(r.s();!(n=r.n()).done;){var i=n.value;if(N(e,i)){var o=t.stacks[i];void 0===o&&(o=new W,t.stacks[i]=o),He(o,e)}}}catch(a){r.e(a)}finally{r.f()}}function it(e,t,n,r,i,o,a){return Je.is(e)&&e.refType&(w.NestBegin|w.NestEnd)&&rt(e,a),!1}function ot(e,t,n,r,i,o,a){var s;if(e.isLeaf()){var u=e;(null!==(s=a.mergeTree.localNetLength(u))&&void 0!==s?s:0)>0&&Je.is(u)&&u.refType&(w.NestBegin|w.NestEnd)&&rt(u,a)}else{var c=e;Ue(a.stacks,c.rangeStacks)}return!0}function at(e,t,n,r,i,o,a){return Je.is(e)&&P(e,a.tileLabel)&&(a.tile=e),!1}function st(e,t,n,r,i,o,a){if(e.isLeaf()){var s=e;a.mergeTree.localNetLength(s)>0&&Je.is(s)&&P(s,a.tileLabel)&&(a.tile=s)}else{var u,c=e;void 0!==(u=a.posPrecedesTile?c.rightmostTiles[a.tileLabel]:c.leftmostTiles[a.tileLabel])&&(a.tile=u)}return!0}var ut={min:{minRequired:Number.MIN_VALUE,onMinGE:function(){Z(!1,72)}},compare:function(e,t){return e.minRequired-t.minRequired}},ct=function(){function e(t){var n=this;(0,g.Z)(this,e),this.options=t,this.blockUpdateActions=e.initBlockUpdateActions,this.collabWindow=new Ye,this.idToSegment=new Map,this.splitLeafSegment=function(e,t){if(!(t>0&&e))return{};var r=e.splitAt(t);return n.mergeTreeMaintenanceCallback&&n.mergeTreeMaintenanceCallback({operation:_e,deltaSegments:[{segment:e},{segment:r}]},void 0),{next:r}},this.root=this.makeBlock(0)}return(0,m.Z)(e,[{key:"makeBlock",value:function(e){var t=new Ve(e);return t.ordinal="",t}},{key:"clone",value:function(){var t=new e(this.options);t.root=t.blockClone(this.root)}},{key:"blockClone",value:function(e,t){for(var n=this.makeBlock(e.childCount),r=0;r<e.childCount;r++){var i=e.children[r];if(i.isLeaf()){var o=this.segmentClone(i);n.assignChild(o,r),t&&t.push(o)}else n.assignChild(this.blockClone(i,t),r)}return this.nodeUpdateLengthNewStructure(n),this.nodeUpdateOrdinals(n),n}},{key:"segmentClone",value:function(e){return e.clone()}},{key:"localNetLength",value:function(e){return void 0!==De(e)?0:e.cachedLength}},{key:"mapIdToSegment",value:function(e,t){this.idToSegment.set(e,t)}},{key:"addNode",value:function(e,t){var n=e.childCount++;return e.assignChild(t,n,!1),n}},{key:"reloadFromSegments",value:function(e){var t=this;Z(!this.collabWindow.collaborating,73);e.length>0?(this.root=function e(n){for(var r=Math.ceil(n.length/7),i=new Array(r),o=0,a=0;a<r;a++){for(var s=i[a]=t.makeBlock(0),u=0;u<7&&o<n.length;u++,o++)t.addNode(s,n[o]);t.blockUpdate(s)}return 1===i.length?i[0]:e(i)}(e),this.nodeUpdateOrdinals(this.root)):this.root=this.makeBlock(0)}},{key:"startCollaboration",value:function(e,t,n){this.collabWindow.clientId=e,this.collabWindow.minSeq=t,this.collabWindow.collaborating=!0,this.collabWindow.currentSeq=n,this.segmentsToScour=new $([],nt),this.pendingSegments=Y(),this.nodeUpdateLengthNewStructure(this.root,!0)}},{key:"addToLRUSet",value:function(e,t){!0!==e.parent.needsScour&&t>this.collabWindow.currentSeq&&(e.parent.needsScour=!0,this.segmentsToScour.add({segment:e,maxSeq:t}))}},{key:"underflow",value:function(e){return e.childCount<4}},{key:"scourNode",value:function(e,t){for(var n,r=this,i=function(){var i=e.children[o];if(i.isLeaf()){var a=i;if(a.segmentGroups.empty)if(void 0!==a.removedSeq)a.removedSeq>r.collabWindow.minSeq?t.push(a):a.trackingCollection.empty?(r.mergeTreeMaintenanceCallback&&r.mergeTreeMaintenanceCallback({operation:Pe,deltaSegments:[{segment:a}]},void 0),a.parent=void 0):t.push(a),n=void 0;else if(a.seq<=r.collabWindow.minSeq)n&&n.canAppend(a)&&U(n.properties,a.properties)&&n.trackingCollection.matches(a.trackingCollection)&&r.localNetLength(a)>0?(n.append(a),r.mergeTreeMaintenanceCallback&&r.mergeTreeMaintenanceCallback({operation:Re,deltaSegments:[{segment:n},{segment:a}]},void 0),a.parent=void 0,a.trackingCollection.trackingGroups.forEach((function(e){return e.unlink(a)}))):(t.push(a),n=r.localNetLength(a)>0?a:void 0);else t.push(a),n=void 0;else t.push(a),n=void 0}else t.push(i),n=void 0},o=0;o<e.childCount;o++)i()}},{key:"packParent",value:function(e){var t,n,r=e.children,i=[];for(t=0;t<e.childCount;t++)n=r[t],this.scourNode(n,i),n.parent=void 0;var o=i.length,a=Math.min(7,Math.floor(o/4));a<1&&(a=1);for(var s=Math.floor(o/a),u=o%a,c=new Array(8),l=0,d=0;d<a;d++){var h=s;u>0&&(h++,u--);for(var f=this.makeBlock(h),p=0;p<h;p++){var v=i[l++];f.assignChild(v,p,!1)}f.parent=e,c[d]=f,this.nodeUpdateLengthNewStructure(f)}e.children=c;for(var g=0;g<a;g++)e.assignChild(c[g],g,!1);e.childCount=a,this.underflow(e)&&e.parent?this.packParent(e.parent):(this.nodeUpdateOrdinals(e),this.blockUpdatePathLengths(e,D,-1,!0))}},{key:"zamboniSegments",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:e.zamboniSegmentsMaxCount;if(this.collabWindow.collaborating)for(var n=0;n<t;n++){var r=this.segmentsToScour.peek();if(!r||r.maxSeq>this.collabWindow.minSeq)break;if((r=this.segmentsToScour.get()).segment.parent&&!1!==r.segment.parent.needsScour){var i=r.segment.parent,o=[];this.scourNode(i,o),i.needsScour=!1;var a=o.length;if(a<i.childCount){i.childCount=a,i.children=o;for(var s=0;s<a;s++)i.assignChild(o[s],s,!1);this.underflow(i)&&i.parent?this.packParent(i.parent):(this.nodeUpdateOrdinals(i),this.blockUpdatePathLengths(i,D,-1,!0))}}}}},{key:"getCollabWindow",value:function(){return this.collabWindow}},{key:"getStats",value:function(){var e=function e(t){for(var n={maxHeight:0,nodeCount:0,leafCount:0,removedLeafCount:0,liveCount:0,histo:[]},r=0;r<8;r++)n.histo[r]=0;for(var i=0;i<t.childCount;i++){var o=t.children[i],a=1;if(o.isLeaf()){n.leafCount++,void 0!==o.removedSeq&&n.removedLeafCount++}else{var s=e(o);a=1+s.maxHeight,n.nodeCount+=s.nodeCount,n.leafCount+=s.leafCount,n.removedLeafCount+=s.removedLeafCount,n.liveCount+=s.liveCount;for(var u=0;u<8;u++)n.histo[u]+=s.histo[u]}a>n.maxHeight&&(n.maxHeight=a)}return n.histo[t.childCount]++,n.nodeCount++,n.liveCount+=t.childCount,n}(this.root);return e}},{key:"getLength",value:function(e,t){return this.blockLength(this.root,e,t)}},{key:"length",get:function(){return this.root.cachedLength}},{key:"getPosition",value:function(e,t,n){for(var r,i,o=0,a=e.parent;a;){for(var s=a.children,u=0;u<a.childCount;u++){var c=s[u];if(i&&c===i||c===e)break;o+=null!==(r=this.nodeLength(c,t,n))&&void 0!==r?r:0}i=a,a=a.parent}return o}},{key:"getContainingSegment",value:function(e,t,n){var r,i;return this.searchBlock(this.root,e,0,t,n,{leaf:function(e,t,n,o,a){return r=e,i=a,!1}},void 0),{segment:r,offset:i}}},{key:"_getSlideToSegment",value:function(e){if(!e.segment||!Le(e.segment))return e;var t,n=function(e){return!(e.seq!==D&&!Le(e))||(t=e,!1)};return this.rightExcursion(e.segment,n),t?{segment:t,offset:0}:(this.leftExcursion(e.segment,n),t?{segment:t,offset:t.cachedLength-1}:{segment:void 0,offset:0})}},{key:"slideReferences",value:function(e,t){var n,r,i,o,a;Z(Le(e),753),Z(!!e.localRefs,754);var s=this._getSlideToSegment({segment:e,offset:0}),u=s.segment;u&&!u.localRefs&&(u.localRefs=new ue(u));var c,l=(0,f.Z)(t);try{for(l.s();!(c=l.n()).done;){var d=c.value;null===(r=null===(n=d.callbacks)||void 0===n?void 0:n.beforeSlide)||void 0===r||r.call(n),Z(d===e.localRefs.removeLocalRef(d),755),u?(d.segment=u,d.offset=null!==(i=s.offset)&&void 0!==i?i:0,Z(!!u.localRefs,756),u.localRefs.addLocalRef(d)):(d.segment=void 0,d.offset=0),null===(a=null===(o=d.callbacks)||void 0===o?void 0:o.afterSlide)||void 0===a||a.call(o)}}catch(h){l.e(h)}finally{l.f()}u&&this.blockUpdatePathLengths(u.parent,L,B)}},{key:"updateSegmentRefsAfterMarkRemoved",value:function(e,t){if(e.localRefs&&!e.localRefs.empty){var n,r=[],i=[],o=(0,f.Z)(e.localRefs);try{for(o.s();!(n=o.n()).done;){var a=n.value;A(a,w.StayOnRemove)?i.push(a):A(a,w.SlideOnRemove)&&(t?i.push(a):r.push(a))}}catch(l){o.e(l)}finally{o.f()}t||this.slideReferences(e,r),e.localRefs.clear();for(var s=0,u=i;s<u.length;s++){var c=u[s];c.segment=e,e.localRefs.addLocalRef(c)}}}},{key:"blockLength",value:function(e,t,n){return this.collabWindow.collaborating&&n!==this.collabWindow.clientId?e.partialLengths.getPartialLength(t,n):e.cachedLength}},{key:"nodeLength",value:function(e,t,n){if(this.collabWindow.collaborating&&this.collabWindow.clientId!==n){if(e.isLeaf()){var r=e,i=De(r);if(void 0!==i&&i.removedSeq!==D&&i.removedSeq<=t)return;if(r.clientId===n||r.seq!==D&&r.seq<=t)return void 0!==i&&i.removedClientIds.includes(n)?0:r.cachedLength;if(void 0!==i&&i.removedSeq!==D)return;return 0}return e.partialLengths.getPartialLength(t,n)}return e.isLeaf()?this.localNetLength(e):e.cachedLength}},{key:"addMinSeqListener",value:function(e,t){this.minSeqListeners||(this.minSeqListeners=new $([],ut)),this.minSeqListeners.add({minRequired:e,onMinGE:t})}},{key:"notifyMinSeqListeners",value:function(){if(this.minSeqListeners)for(;this.minSeqListeners.count()>0&&this.minSeqListeners.peek().minRequired<=this.collabWindow.minSeq;){this.minSeqListeners.get().onMinGE(this.collabWindow.minSeq)}}},{key:"setMinSeq",value:function(t){Z(t<=this.collabWindow.currentSeq,78),Z(this.collabWindow.minSeq<=t,79),t>this.collabWindow.minSeq&&(this.collabWindow.minSeq=t,e.options.zamboniSegments&&this.zamboniSegments(),this.notifyMinSeqListeners())}},{key:"referencePositionToLocalPosition",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.collabWindow.currentSeq,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.collabWindow.clientId,r=e.getSegment();return r&&r.parent?(r.removedSeq?0:e.getOffset())+this.getPosition(r,t,n):oe.DetachedPosition}},{key:"getStackContext",value:function(e,t,n){var r={mergeTree:this,stacks:V(),rangeLabels:n};return this.search(e,0,t,{leaf:it,shift:ot},r),r.stacks}},{key:"findTile",value:function(e,t,n){var r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],i={mergeTree:this,posPrecedesTile:r,tileLabel:n};if(r?this.search(e,0,t,{leaf:at,shift:st},i):this.backwardSearch(e,0,t,{leaf:at,shift:st},i),i.tile){var o;if(i.tile.isLeaf()){var a=i.tile;o=this.getPosition(a,0,t)}else{o=i.tile.toPosition()}return{tile:i.tile,pos:o}}}},{key:"search",value:function(e,t,n,r,i){return this.searchBlock(this.root,e,0,t,n,r,i)}},{key:"searchBlock",value:function(e,t,n,r,i,o,a){var s,u=t,c=n,l=e.children;o&&o.pre&&o.pre(e,c,r,i,void 0,void 0,a);for(var d=o&&o.contains,h=0;h<e.childCount;h++){var f=l[h],p=null!==(s=this.nodeLength(f,r,i))&&void 0!==s?s:0;if(!d&&u<p||d&&d(f,u,r,i,void 0,void 0,a))return f.isLeaf()?(o&&o.leaf&&o.leaf(f,c,r,i,u,-1,a),f):this.searchBlock(f,u,c,r,i,o,a);o&&o.shift&&o.shift(f,c,r,i,u,void 0,a),u-=p,c+=p}o&&o.post&&o.post(e,c,r,i,void 0,void 0,a)}},{key:"backwardSearch",value:function(e,t,n,r,i){var o=this.getLength(t,n);if(!(e>o))return this.backwardSearchBlock(this.root,e,o,t,n,r,i)}},{key:"backwardSearchBlock",value:function(e,t,n,r,i,o,a){var s,u=n,c=e.children;o&&o.pre&&o.pre(e,u,r,i,void 0,void 0,a);for(var l=o&&o.contains,d=e.childCount-1;d>=0;d--){var h=c[d],f=u-(null!==(s=this.nodeLength(h,r,i))&&void 0!==s?s:0);if(!l&&t>=f||l&&l(h,t,r,i,void 0,void 0,a))return h.isLeaf()?(o&&o.leaf&&o.leaf(h,f,r,i,t,-1,a),h):this.backwardSearchBlock(h,t,u,r,i,o,a);o&&o.shift&&o.shift(h,f,r,i,t,void 0,a),u=f}o&&o.post&&o.post(e,u,r,i,void 0,void 0,a)}},{key:"updateRoot",value:function(e){if(void 0!==e){var t=this.makeBlock(2);t.assignChild(this.root,0,!1),t.assignChild(e,1,!1),this.root=t,this.nodeUpdateOrdinals(this.root),this.nodeUpdateLengthNewStructure(this.root)}}},{key:"ackPendingSegment",value:function(t){var n=this,r=t.sequencedMessage.sequenceNumber,i=this.pendingSegments.dequeue(),o=[],a=!1;if(void 0!==i){var s=[];i.segments.map((function(u){var c=!u.ack(i,t,n);a=c||a,c||t.op.type!==T.REMOVE||n.updateSegmentRefsAfterMarkRemoved(u,!1),e.options.zamboniSegments&&n.addToLRUSet(u,r),o.includes(u.parent)||o.push(u.parent),s.push({segment:u})})),this.mergeTreeMaintenanceCallback&&this.mergeTreeMaintenanceCallback({deltaSegments:s,operation:Ne},t);var u,c=this.collabWindow.clientId,l=(0,f.Z)(o);try{for(l.s();!(u=l.n()).done;){var d=u.value;this.blockUpdatePathLengths(d,r,c,a)}}catch(h){l.e(h)}finally{l.f()}}e.options.zamboniSegments&&this.zamboniSegments()}},{key:"addToPendingList",value:function(e,t,n){var r=t;return void 0===r&&(r={segments:[],localSeq:n},this.pendingSegments.enqueue(r)),e.segmentGroups.enqueue(r),r}},{key:"getMarkerFromId",value:function(e){return this.idToSegment.get(e)}},{key:"posFromRelativePos",value:function(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.collabWindow.currentSeq,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.collabWindow.clientId,i=-1;return e.id&&(t=this.getMarkerFromId(e.id)),t&&(i=this.getPosition(t,n,r),e.before?void 0!==e.offset&&(i-=e.offset):(i+=t.cachedLength,void 0!==e.offset&&(i+=e.offset))),i}},{key:"insertSegments",value:function(t,n,r,i,o,a){this.ensureIntervalBoundary(t,r,i);var s=o===D?++this.collabWindow.localSeq:void 0;this.blockInsert(t,r,i,o,s,n),this.mergeTreeDeltaCallback&&void 0!==a&&this.mergeTreeDeltaCallback(a,{operation:T.INSERT,deltaSegments:n.map((function(e){return{segment:e}}))}),this.collabWindow.collaborating&&e.options.zamboniSegments&&o!==D&&this.zamboniSegments()}},{key:"insertAtReferencePosition",value:function(e,t,n){var r=this;if(0!==t.cachedLength){if(t.parent||t.removedSeq||0!==t.seq)throw new Error("Cannot insert segment that has already been inserted.");var i=function(e){for(var t=e.parent,n=t;void 0!==t;){if(t.childCount>=8){var i=r.split(t);t===r.root?(r.updateRoot(i),n=void 0):(r.insertChildNode(t.parent,i,t.index+1),n=i.parent,r.blockUpdateLength(t.parent,D,o))}else r.blockUpdateLength(t,D,o);t=t.parent}n&&r.nodeUpdateOrdinals(n)},o=this.collabWindow.clientId,a=e.getSegment(),s=e.getOffset(),u=this.nodeLength(a,this.collabWindow.currentSeq,o),c=a;if(0!==s&&void 0!==u&&0!==u){var l=this.splitLeafSegment(a,s);Z(!!l.next,80),this.insertChildNode(a.parent,l.next,a.index+1),i(l.next),c=l.next}if(this.leftExcursion(c,(function(e){if(!e.isLeaf())return!0;var t=r.nodeLength(e,r.collabWindow.currentSeq,o);return void 0===t||0===t&&(r.breakTie(0,e,D)&&(c=e),!0)})),this.collabWindow.collaborating?(t.localSeq=++this.collabWindow.localSeq,t.seq=D):t.seq=0,t.clientId=o,Je.is(t)){var d=t.getId();d&&this.mapIdToSegment(d,t)}this.insertChildNode(c.parent,t,c.index),i(t),this.mergeTreeDeltaCallback&&this.mergeTreeDeltaCallback(n,{deltaSegments:[{segment:t}],operation:T.INSERT}),this.collabWindow.collaborating&&this.addToPendingList(t,void 0,t.localSeq)}}},{key:"resolveRemoteClientPosition",value:function(e,t,n){if(!(t<this.collabWindow.minSeq)){var r=this.getContainingSegment(e,t,n),i=this.getCollabWindow();return r&&r.segment?this.getPosition(r.segment,i.currentSeq,i.clientId)+r.offset:e===this.getLength(t,n)?this.getLength(i.currentSeq,i.clientId):void 0}}},{key:"insertChildNode",value:function(e,t,n){Z(e.childCount<8,81);for(var r=e.childCount;r>n;r--)e.children[r]=e.children[r-1],e.children[r].index=r;e.childCount++,e.assignChild(t,n,!1)}},{key:"blockInsert",value:function(t,n,r,i,o,a){var s,u,c,l=this,d=!1,h=function(e){return e.seq===D&&(d=!0),!1},p=function(e){return d=!1,l.rightExcursion(e,h),d},v=function(e,t,n){var r={};return e?(r.replaceCurrent=n.candidateSegment,r.next=e):r.next=n.candidateSegment,r},g=t,m=(0,f.Z)(a);try{for(m.s();!(u=m.n()).done;){var y=u.value;if(d=!1,y.cachedLength>0){if(y.seq=i,y.localSeq=o,y.clientId=r,Je.is(y)){var b=y.getId();b&&this.mapIdToSegment(b,y)}var w=this.insertingWalk(this.root,g,n,r,i,{leaf:v,candidateSegment:y,continuePredicate:p});if(void 0===y.parent)throw new Error("MergeTree insert failed: ".concat(JSON.stringify({currentSeq:this.collabWindow.currentSeq,minSeq:this.collabWindow.minSeq,segSeq:y.seq})));this.updateRoot(w),c=y,l.collabWindow.collaborating&&(c.seq===D&&r===l.collabWindow.clientId?s=l.addToPendingList(c,s,o):c.seq>l.collabWindow.minSeq&&e.options.zamboniSegments&&l.addToLRUSet(c,c.seq)),g+=y.cachedLength}}}catch(S){m.e(S)}finally{m.f()}}},{key:"ensureIntervalBoundary",value:function(e,t,n){var r=this.insertingWalk(this.root,e,t,n,L,{leaf:this.splitLeafSegment});this.updateRoot(r)}},{key:"breakTie",value:function(e,t,n){var r;return!t.isLeaf()||0===e&&(n===D?Number.MAX_SAFE_INTEGER:n)>(t.seq===D?Number.MAX_SAFE_INTEGER-1:null!==(r=t.seq)&&void 0!==r?r:0)}},{key:"leftExcursion",value:function(e,t){for(var n=!0,r=e,i=r.parent;i;){var o=i.children,a=void 0,s=void 0,u=!1;for(a=i.childCount-1;a>=0;a--)if(s=o[a],u){if(s.isLeaf())n=t(s,0,0,this.collabWindow.clientId,0,0,void 0);else{var c=s;n=this.nodeMapReverse(c,t,0,0,this.collabWindow.clientId)}if(!n)return}else u=r===s;r=i,i=i.parent}}},{key:"rightExcursion",value:function(e,t){for(var n=!0,r=e,i=r.parent;i;){var o=i.children,a=void 0,s=void 0,u=!1;for(a=0;a<i.childCount;a++)if(s=o[a],u){if(s.isLeaf())n=t(s);else{var c=s;n=this.walkAllSegments(c,t)}if(!n)return}else u=r===s;r=i,i=i.parent}}},{key:"insertingWalk",value:function(t,n,r,i,o,a){var s,u,c,l,d=n,h=t.children;for(s=0;s<t.childCount;s++){u=h[s];var f=this.nodeLength(u,r,i);if(void 0!==f){if(d<f||d===f&&this.breakTie(d,u,o)){if(u.isLeaf()){var p=u,v=a.leaf(p,d,a);if(v.replaceCurrent&&(t.assignChild(v.replaceCurrent,s,!1),v.replaceCurrent.ordinal=u.ordinal),!v.next)return void(a.structureChange&&this.nodeUpdateLengthNewStructure(t));c=v.next,s++}else{var g=u,m=this.insertingWalk(g,d,r,i,o,a);if(void 0===m)return void(a.structureChange?this.nodeUpdateLengthNewStructure(t):this.blockUpdateLength(t,o,i));if(m===e.theUnfinishedNode){d-=f;continue}c=m,l=m,s++}break}d-=f}}if(!c&&0===d){if(o!==D&&a.continuePredicate&&a.continuePredicate(t))return e.theUnfinishedNode;c=a.leaf(void 0,d,a).next}if(c){for(var y=t.childCount;y>s;y--)t.children[y]=t.children[y-1],t.children[y].index=y;return t.assignChild(c,s,!1),t.childCount++,t.setOrdinal(c,s),t.childCount<8?(l&&this.nodeUpdateOrdinals(l),void(a.structureChange?this.nodeUpdateLengthNewStructure(t):this.blockUpdateLength(t,o,i))):this.split(t)}}},{key:"split",value:function(e){var t=this.makeBlock(4);e.childCount=4,this.nodeUpdateOrdinals(e);for(var n=0;n<4;n++)t.assignChild(e.children[4+n],n,!1),e.children[4+n]=void 0;return this.nodeUpdateLengthNewStructure(e),this.nodeUpdateLengthNewStructure(t),t}},{key:"nodeUpdateOrdinals",value:function(e){for(var t=0;t<e.childCount;t++){var n=e.children[t];e.setOrdinal(n,t),n.isLeaf()||this.nodeUpdateOrdinals(n)}}},{key:"annotateRange",value:function(t,n,r,i,o,a,s,u){var c=this;this.ensureIntervalBoundary(t,o,a),this.ensureIntervalBoundary(n,o,a);var l,d=[],h=s===D?++this.collabWindow.localSeq:void 0;this.mapRange({leaf:function(t){var n=t.addProperties(r,i,s,c.collabWindow);return d.push({segment:t,propertyDeltas:n}),c.collabWindow.collaborating&&(s===D?l=c.addToPendingList(t,l,h):e.options.zamboniSegments&&c.addToLRUSet(t,s)),!0}},o,a,void 0,t,n),this.mergeTreeDeltaCallback&&d.length>0&&this.mergeTreeDeltaCallback(u,{operation:T.ANNOTATE,deltaSegments:d}),this.collabWindow.collaborating&&s!==D&&e.options.zamboniSegments&&this.zamboniSegments()}},{key:"markRangeRemoved",value:function(t,n,r,i,o){var a,s=this,u=arguments.length>6?arguments[6]:void 0,c=arguments.length>5&&void 0!==arguments[5]&&arguments[5];this.ensureIntervalBoundary(t,r,i),this.ensureIntervalBoundary(n,r,i);var l=[],d=[],h=o===D?++this.collabWindow.localSeq:void 0;this.mapRange({leaf:function(t,n,r,u){var f=De(t);return void 0!==f?(c=!0,f.removedSeq===D?(f.removedClientIds.unshift(i),f.removedSeq=o,t.localRemovedSeq=void 0):f.removedClientIds.push(i)):(t.removedClientIds=[i],t.removedSeq=o,t.localRemovedSeq=h,l.push({segment:t})),t.localRefs&&!t.localRefs.empty&&d.push(t),s.collabWindow.collaborating&&(t.removedSeq===D&&i===s.collabWindow.clientId?a=s.addToPendingList(t,a,h):e.options.zamboniSegments&&s.addToLRUSet(t,o)),!0},post:function(e,t,n,r){return c?s.nodeUpdateLengthNewStructure(e):s.blockUpdateLength(e,o,i),!0}},r,i,void 0,t,n);for(var f=this.collabWindow.collaborating&&i===this.collabWindow.clientId,p=0,v=d;p<v.length;p++){var g=v[p];this.updateSegmentRefsAfterMarkRemoved(g,f)}this.mergeTreeDeltaCallback&&l.length>0&&this.mergeTreeDeltaCallback(u,{operation:T.REMOVE,deltaSegments:l}),this.collabWindow.collaborating&&o!==D&&e.options.zamboniSegments&&this.zamboniSegments()}},{key:"nodeUpdateLengthNewStructure",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.blockUpdate(e),this.collabWindow.collaborating&&(e.partialLengths=Fe.combine(this,e,this.collabWindow,t))}},{key:"removeLocalReferencePosition",value:function(e){var t,n=e.getSegment();if(n){var r=null===(t=null===n||void 0===n?void 0:n.localRefs)||void 0===t?void 0:t.removeLocalRef(e);return void 0!==r&&this.blockUpdatePathLengths(n.parent,L,B),r}}},{key:"createLocalReferencePosition",value:function(e,t,n,r,i){var o;if(function(e){return void 0!==De(e)}(e)&&!A(n,w.SlideOnRemove|w.Transient))throw new E.Oi("Can only create SlideOnRemove or Transient local reference position on a removed segment");var a=null!==(o=e.localRefs)&&void 0!==o?o:new ue(e);e.localRefs=a;var s=a.createLocalRef(t,n,r,i);return this.blockUpdatePathLengths(e.parent,L,B),s}},{key:"removeLocalReference",value:function(e,t){e.localRefs&&(e.localRefs.removeLocalRef(t)&&this.blockUpdatePathLengths(e.parent,L,B))}},{key:"addLocalReference",value:function(e){var t=e.segment,n=t.localRefs;n||(n=new ue(t),t.localRefs=n),n.addLocalRef(e),this.blockUpdatePathLengths(t.parent,L,B)}},{key:"blockUpdate",value:function(e){var t,n,r,i=0,o=e.hierBlock();o&&(o.rightmostTiles=V(),o.leftmostTiles=V(),o.rangeStacks={});for(var a=0;a<e.childCount;a++){var s=e.children[a];i+=null!==(n=this,t=(r=s).isLeaf()?n.localNetLength(r):r.cachedLength)&&void 0!==t?t:0,o&&o.addNodeReferences(this,s),this.blockUpdateActions&&this.blockUpdateActions.child(e,a)}e.cachedLength=i}},{key:"blockUpdatePathLengths",value:function(e,t,n){for(var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=e;void 0!==i;)r?this.nodeUpdateLengthNewStructure(i):this.blockUpdateLength(i,t,n),i=i.parent}},{key:"blockUpdateLength",value:function(t,n,r){this.blockUpdate(t),this.collabWindow.collaborating&&n!==D&&n!==L&&(void 0!==t.partialLengths&&e.options.incrementalUpdate&&r!==q?t.partialLengths.update(this,t,n,r,this.collabWindow):t.partialLengths=Fe.combine(this,t,this.collabWindow))}},{key:"map",value:function(e,t,n,r){this.nodeMap(this.root,e,0,t,n,r)}},{key:"mapRange",value:function(e,t,n,r,i,o){arguments.length>6&&void 0!==arguments[6]&&arguments[6]&&(i&&this.ensureIntervalBoundary(i,t,n),o&&this.ensureIntervalBoundary(o,t,n)),this.nodeMap(this.root,e,0,t,n,r,i,o)}},{key:"incrementalBlockMap",value:function(e){for(var t;!e.empty();){var n=e.top();if(n.op!==Ge.Go)return;if(0===n.childIndex&&(void 0===n.start&&(n.start=0),void 0===n.end&&(n.end=this.blockLength(n.block,n.refSeq,n.clientId)),n.actions.pre&&n.actions.pre(n)),n.op===Ge.Go&&n.childIndex<n.block.childCount){var r=n.block.children[n.childIndex],i=null!==(t=this.nodeLength(r,n.refSeq,n.clientId))&&void 0!==t?t:0;if(i>0&&n.start<i&&n.end>0)if(r.isLeaf())n.actions.leaf(r,n);else{var o=new Qe(r,n.actions,n.pos,n.refSeq,n.clientId,n.context,n.start,n.end,0);e.push(o)}n.pos+=i,n.start-=i,n.end-=i,n.childIndex++}else n.childIndex===n.block.childCount&&(n.op===Ge.Go&&n.actions.post&&n.actions.post(n),e.pop())}}},{key:"nodeMap",value:function(e,t,n,r,i,o,a,s){var u,c=a,l=s,d=n;void 0===c&&(c=0),void 0===l&&(l=this.blockLength(e,r,i));var h=!0;if(t.pre&&!(h=t.pre(e,d,r,i,c,l,o)))return!0;for(var f=e.children,p=0;p<e.childCount;p++){var v=f[p],g=null!==(u=this.nodeLength(v,r,i))&&void 0!==u?u:0;if(h&&l>0&&g>0&&c<g&&(v.isLeaf()?t.leaf&&(h=t.leaf(v,d,r,i,c,l,o)):h&&(h=this.nodeMap(v,t,d,r,i,o,c,l))),!h)break;t.shift&&t.shift(v,d,r,i,c,l,o),d+=g,c-=g,l-=g}return h&&t.post&&(h=t.post(e,d,r,i,c,l,o)),h}},{key:"walkAllSegments",value:function(e,t,n){for(var r=!0,i=e.children,o=0;r&&o<e.childCount;o++){var a=i[o];r=a.isLeaf()?t(a,n):this.walkAllSegments(a,t,n)}return r}},{key:"nodeMapReverse",value:function(e,t,n,r,i){for(var o=!0,a=e.children,s=e.childCount-1;s>=0;s--){var u=a[s];if(o&&(u.isLeaf()?o=t(u,n,r,i,0,0,void 0):o&&(o=this.nodeMapReverse(u,t,n,r,i))),!o)break}return o}}]),e}();ct.zamboniSegmentsMaxCount=2,ct.options={incrementalUpdate:!0,insertAfterRemovedSegs:!0,zamboniSegments:!0},ct.theUnfinishedNode={childCount:-1};var lt=function(e){(0,p.Z)(n,e);var t=(0,v.Z)(n);function n(e){var r;return(0,g.Z)(this,n),(r=t.call(this)).text=e,r.type=n.type,r.cachedLength=e.length,r}return(0,m.Z)(n,[{key:"toJSONObject",value:function(){return this.properties?{text:this.text,props:this.properties}:this.text}},{key:"clone",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1?arguments[1]:void 0,r=this.text.substring(e,t),i=n.make(r,this.properties);return this.cloneInto(i),i}},{key:"canAppend",value:function(e){return!this.text.endsWith("\n")&&n.is(e)&&(this.cachedLength<=256||e.cachedLength<=256)}},{key:"toString",value:function(){return this.text}},{key:"append",value:function(e){if(!n.is(e))throw new Error("can only append text segment");ue.append(this,e),this.text+=e.text,this.cachedLength=this.text.length}},{key:"removeRange",value:function(e,t){var n="",r=this.text.length;return e>0&&(n+=this.text.substring(0,e)),t<r&&(n+=this.text.substring(t)),this.text=n,this.cachedLength=n.length,0===n.length}},{key:"createSplitSegmentAt",value:function(e){if(e>0){var t=this.text.substring(e);return this.text=this.text.substring(0,e),this.cachedLength=this.text.length,new n(t)}}}],[{key:"is",value:function(e){return e.type===n.type}},{key:"make",value:function(e,t){var r=new n(e);return t&&r.addProperties(t),r}},{key:"fromJSONObject",value:function(e){if("string"===typeof e)return new n(e);if(e&&"object"===typeof e&&"text"in e){var t=e;return n.make(t.text,t.props)}}}]),n}(Ke);function dt(e){return!0===e.parallelArrays}lt.type="TextSegment";var ht=function(){function e(t){(0,g.Z)(this,e),this.mergeTree=t,this.gatherText=function(e,t,n,r,i,o,a){var s,u,c=i;if(lt.is(e)){var l="",d="";if(dt(a)){var h=[],p=[];(null===(s=e.properties)||void 0===s?void 0:s["font-weight"])&&h.push("b"),(null===(u=e.properties)||void 0===u?void 0:u["text-decoration"])&&h.push("u");var v=[];if(h.length>0){var g,m=(0,f.Z)(h);try{for(m.s();!(g=m.n()).done;){var y=g.value;a.tagsInProgress.includes(y)||(l+="<".concat(y,">"),p.push(y))}}catch(F){m.e(F)}finally{m.f()}var b,w=(0,f.Z)(a.tagsInProgress);try{for(w.s();!(b=w.n()).done;){var S=b.value;h.includes(S)||(d+="</".concat(S,">"),v.push(S))}}catch(F){w.e(F)}finally{w.f()}var k,C=(0,f.Z)(p.reverse());try{for(C.s();!(k=C.n()).done;){var x=k.value;a.tagsInProgress.push(x)}}catch(F){C.e(F)}finally{C.f()}}else{var E,T=(0,f.Z)(a.tagsInProgress);try{for(T.s();!(E=T.n()).done;){var I=E.value;d+="</".concat(I,">"),v.push(I)}}catch(F){T.e(F)}finally{T.f()}}for(var A=0,R=v;A<R.length;A++){var _=R[A],P=a.tagsInProgress.indexOf(_);P>=0&&a.tagsInProgress.splice(P,1)}}a.textSegment.text+=d,a.textSegment.text+=l,c<=0&&o>=e.text.length?a.textSegment.text+=e.text:(c<0&&(c=0),o>=e.text.length?a.textSegment.text+=e.text.substring(c):a.textSegment.text+=e.text.substring(c,o))}else if(a.placeholder&&a.placeholder.length>0)if("*"===a.placeholder){var N=e;a.textSegment.text+="\n".concat(N.toString())}else for(var O=0;O<e.cachedLength;O++)a.textSegment.text+=a.placeholder;else if(dt(a)){var M=e;M.hasTileLabel(a.parallelMarkerLabel)&&(a.parallelMarkers.push(M),a.parallelText.push(a.textSegment.text),a.textSegment.text="")}return!0}}return(0,m.Z)(e,[{key:"getTextAndMarkers",value:function(e,t,n,r,i){var o=this.getValidRange(r,i,e,t),a={parallelArrays:!0,parallelMarkerLabel:n,parallelMarkers:[],parallelText:[],tagsInProgress:[],textSegment:new lt("")};return this.mergeTree.mapRange({leaf:this.gatherText},e,t,a,o.start,o.end),{parallelText:a.parallelText,parallelMarkers:a.parallelMarkers}}},{key:"getText",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",r=arguments.length>3?arguments[3]:void 0,i=arguments.length>4?arguments[4]:void 0,o=this.getValidRange(r,i,e,t),a={textSegment:new lt(""),placeholder:n};return this.mergeTree.mapRange({leaf:this.gatherText},e,t,a,o.start,o.end),a.textSegment.text}},{key:"getValidRange",value:function(e,t,n,r){return{end:null!==t&&void 0!==t?t:this.mergeTree.getLength(n,r),start:null!==e&&void 0!==e?e:0}}}]),e}(),ft=n(29439),pt=n(74165),vt=n(15861),gt=function(){function e(){var t=this;(0,g.Z)(this,e),this.completed=!1,this.p=new Promise((function(e,n){t.res=e,t.rej=n}))}return(0,m.Z)(e,[{key:"isCompleted",get:function(){return this.completed}},{key:"promise",get:function(){return this.p}},{key:"resolve",value:function(e){void 0!==this.res&&(this.completed=!0,this.res(e))}},{key:"reject",value:function(e){void 0!==this.rej&&(this.completed=!0,this.rej(e))}}]),e}(),mt=(Symbol.toStringTag,n(28664)),yt=n(2009);var bt=function(e,t){return Et.from(e).toString(t)};function wt(e){var t=e;return e instanceof ArrayBuffer||"object"===typeof t&&null!==t&&"number"===typeof t.byteLength&&"function"===typeof t.slice&&void 0===t.byteOffset&&void 0===t.buffer}var St,kt,Ct,xt,Et=function(e){(0,p.Z)(n,e);var t=(0,v.Z)(n);function n(){return(0,g.Z)(this,n),t.apply(this,arguments)}return(0,m.Z)(n,[{key:"toString",value:function(e){return function(e,t){switch(t){case"base64":return yt.fromByteArray(e);case"utf8":case"utf-8":case void 0:return(new TextDecoder).decode(e);default:throw new Error("invalid/unsupported encoding")}}(this,e)}}],[{key:"from",value:function(e,t,r){if("string"===typeof e)return n.fromString(e,t);if(null!==e&&"object"===typeof e&&wt(e.buffer))return b(0===e.byteOffset,0),b(e.byteLength===e.buffer.byteLength,1),n.fromArrayBuffer(e.buffer,t,r);if(wt(e))return n.fromArrayBuffer(e,t,r);throw new TypeError}},{key:"fromArrayBuffer",value:function(e,t,r){var i=null!==t&&void 0!==t?t:0,o=null!==r&&void 0!==r?r:e.byteLength-i;if(i<0||i>e.byteLength||o<0||o+i>e.byteLength)throw new RangeError;return new n(e,i,o)}},{key:"fromString",value:function(e,t){switch(t){case"base64":var r=this.sanitizeBase64(e);return new n(yt.toByteArray(r).buffer);case"utf8":case"utf-8":case void 0:return new n((new TextEncoder).encode(e).buffer);default:throw new Error("invalid/unsupported encoding")}}},{key:"isBuffer",value:function(e){throw new Error("unimplemented")}},{key:"sanitizeBase64",value:function(e){var t=e;if((t=(t=t.split("=")[0]).replace(/[^\w+-/]/g,"")).length%4!==0){t+=["","===","==","="][t.length%4]}return t}}]),n}((0,mt.Z)(Uint8Array)),Tt=n(98895);!function(e){e.NoOp="noop",e.ClientJoin="join",e.ClientLeave="leave",e.Propose="propose",e.Reject="reject",e.Summarize="summarize",e.SummaryAck="summaryAck",e.SummaryNack="summaryNack",e.Operation="op",e.RemoteHelp="remoteHelp",e.NoClient="noClient",e.RoundTrip="tripComplete",e.Control="control"}(St||(St={})),function(e){e.ThrottlingError="ThrottlingError",e.InvalidScopeError="InvalidScopeError",e.BadRequestError="BadRequestError",e.LimitExceededError="LimitExceededError"}(kt||(kt={})),function(e){e.NoOp="noop",e.ClientJoin="join",e.ClientLeave="leave",e.Propose="propose",e.Reject="reject",e.Summarize="summarize",e.SummaryAck="summaryAck",e.SummaryNack="summaryNack",e.Operation="op",e.RemoteHelp="remoteHelp",e.NoClient="noClient",e.RoundTrip="tripComplete",e.Control="control"}(Ct||(Ct={})),function(e){e.ThrottlingError="ThrottlingError",e.InvalidScopeError="InvalidScopeError",e.BadRequestError="BadRequestError",e.LimitExceededError="LimitExceededError"}(xt||(xt={}));var It=window.performance,At=function(){function e(t){(0,g.Z)(this,e),this.startTick=t,this.lastTick=t}return(0,m.Z)(e,[{key:"trace",value:function(){var e=It.now(),t={totalTimeElapsed:e-this.startTick,duration:e-this.lastTick,tick:e};return this.lastTick=e,t}}],[{key:"start",value:function(){return new e(It.now())}}]),e}();function Rt(e,t,n,r){return{combiningOp:r,pos1:e,pos2:t,props:n,type:T.ANNOTATE}}function _t(e,t){return{pos1:e,pos2:t,type:T.REMOVE}}function Pt(e,t){return Nt(e,t.toJSONObject())}function Nt(e,t){return{pos1:e,seg:t,type:T.INSERT}}function Ot(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return{ops:t,type:T.GROUP}}var Mt=n(91869);function Ft(e,t,n,r,i,o){var a;switch(void 0!==t.version&&n.send({eventName:"MergeTreeChunk:serializeAsMinSupportedVersion",category:"generic",fromChunkVersion:t.version,toChunkVersion:void 0}),t.version){case void 0:(a=t).headerMetadata=Lt(e,a,r);break;case"1":var s=t,u=e===Bt.header?s.headerMetadata:void 0;a={version:void 0,chunkStartSegmentIndex:s.startIndex,chunkLengthChars:s.length,chunkSegmentCount:s.segmentCount,segmentTexts:s.segments,totalLengthChars:null===u||void 0===u?void 0:u.totalLength,totalSegmentCount:null===u||void 0===u?void 0:u.totalSegmentCount,chunkSequenceNumber:null===u||void 0===u?void 0:u.sequenceNumber,chunkMinSequenceNumber:null===u||void 0===u?void 0:u.minSequenceNumber,headerMetadata:u};break;default:throw new Error("Unsupported chunk path: ".concat(e," version: ").concat(t.version))}return i.stringify(a,o)}function Zt(e,t,n,r,i,o){var a=Dt(e,t,n,r);return i.stringify(a,o)}function Dt(e,t,n,r){switch(t.version){case void 0:var i=t;return{version:"1",length:i.chunkLengthChars,segmentCount:i.chunkSegmentCount,headerMetadata:Lt(e,i,r),segments:i.segmentTexts,startIndex:i.chunkStartSegmentIndex};case"1":return t;default:throw new Error("Unsupported chunk path: ".concat(e," version: ").concat(t.version))}}function Lt(e,t,n){if(e===Bt.header){if(void 0!==t.headerMetadata)return t.headerMetadata;var r=[{id:Bt.header}];return t.chunkLengthChars<t.totalLengthChars&&r.push({id:Bt.body}),{orderedChunkMetadata:r,minSequenceNumber:t.chunkMinSequenceNumber,sequenceNumber:t.chunkSequenceNumber,totalLength:t.totalLengthChars,totalSegmentCount:t.totalSegmentCount}}}var Bt=function(){function e(t,n,r,i){var o,a;(0,g.Z)(this,e),this.mergeTree=t,this.filename=r,this.onCompletion=i,this.logger=Tt.G2.create(n,"Snapshot"),this.chunkSize=null!==(a=null===(o=null===t||void 0===t?void 0:t.options)||void 0===o?void 0:o.mergeTreeSnapshotChunkSize)&&void 0!==a?a:e.sizeOfFirstChunk}return(0,m.Z)(e,[{key:"getSeqLengthSegs",value:function(e,t,n){for(var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,i=[],o=0,a=0;o<n&&r+a<e.length;){var s=e[r+a];i.push(s),o+=t[r+a],a++}return{version:void 0,chunkStartSegmentIndex:r,chunkSegmentCount:a,chunkLengthChars:o,totalLengthChars:this.header.segmentsTotalLength,totalSegmentCount:e.length,chunkSequenceNumber:this.header.seq,segmentTexts:i}}},{key:"emit",value:function(t,n,r){var i,o,a=this.getSeqLengthSegs(this.segments,this.segmentLengths,this.chunkSize),s=a.chunkLengthChars,u=a.chunkSegmentCount,c=new Mt.x1;if(c.addBlob(e.header,Ft(e.header,a,this.logger,this.mergeTree.options,n,r)),a.chunkSegmentCount<a.totalSegmentCount){var l=this.getSeqLengthSegs(this.segments,this.segmentLengths,this.header.segmentsTotalLength,a.chunkSegmentCount);s+=l.chunkLengthChars,u+=l.chunkSegmentCount,c.addBlob(e.body,Ft(e.body,l,this.logger,this.mergeTree.options,n,r))}return Z(s===this.header.segmentsTotalLength,93),Z(u===a.totalSegmentCount,94),void 0!==t&&t.length>0&&c.addBlob(null!==(o=null===(i=this.mergeTree.options)||void 0===i?void 0:i.catchUpBlobName)&&void 0!==o?o:e.catchupOps,n?n.stringify(t,r):JSON.stringify(t)),c.getSummaryTree()}},{key:"extractSync",value:function(){var e=this,t=this.mergeTree.getCollabWindow();this.seq=t.minSeq,this.header={segmentsTotalLength:this.mergeTree.getLength(this.mergeTree.collabWindow.minSeq,q),seq:this.mergeTree.collabWindow.minSeq};var n,r=[];this.mergeTree.map({leaf:function(t,i,o,a,s,u){return t.seq!==D&&t.seq<=e.seq&&(void 0===t.removedSeq||t.removedSeq===D||t.removedSeq>e.seq)&&((null===n||void 0===n?void 0:n.canAppend(t))&&U(n.properties,t.properties)?(n=n.clone()).append(t.clone()):(n&&r.push(n),n=t)),!0}},this.seq,q,void 0),n&&r.push(n),this.segments=[],this.segmentLengths=[];var i=0;return r.map((function(t){i+=t.cachedLength,e.segments.push(t.toJSONObject()),e.segmentLengths.push(t.cachedLength)})),this.header.segmentsTotalLength!==i&&(this.logger.sendErrorEvent({eventName:"SegmentsTotalLengthMismatch",totalLength:i,segmentsTotalLength:this.header.segmentsTotalLength}),this.header.segmentsTotalLength=i),this.segments}}]),e}();Bt.header="header",Bt.body="body",Bt.catchupOps="catchupOps",Bt.sizeOfFirstChunk=1e4;var qt=function(e,t){return Ut.from(e).toString(t)};function jt(e){var t=e;return e instanceof ArrayBuffer||"object"===typeof t&&null!==t&&"number"===typeof t.byteLength&&"function"===typeof t.slice&&void 0===t.byteOffset&&void 0===t.buffer}var Ut=function(e){(0,p.Z)(n,e);var t=(0,v.Z)(n);function n(){return(0,g.Z)(this,n),t.apply(this,arguments)}return(0,m.Z)(n,[{key:"toString",value:function(e){return function(e,t){switch(t){case"base64":return yt.fromByteArray(e);case"utf8":case"utf-8":case void 0:return(new TextDecoder).decode(e);default:throw new Error("invalid/unsupported encoding")}}(this,e)}}],[{key:"from",value:function(e,t,r){if("string"===typeof e)return n.fromString(e,t);if(null!==e&&"object"===typeof e&&jt(e.buffer))return Z(0===e.byteOffset,0),Z(e.byteLength===e.buffer.byteLength,1),n.fromArrayBuffer(e.buffer,t,r);if(jt(e))return n.fromArrayBuffer(e,t,r);throw new TypeError}},{key:"fromArrayBuffer",value:function(e,t,r){var i=null!==t&&void 0!==t?t:0,o=null!==r&&void 0!==r?r:e.byteLength-i;if(i<0||i>e.byteLength||o<0||o+i>e.byteLength)throw new RangeError;return new n(e,i,o)}},{key:"fromString",value:function(e,t){switch(t){case"base64":var r=this.sanitizeBase64(e);return new n(yt.toByteArray(r).buffer);case"utf8":case"utf-8":case void 0:return new n((new TextEncoder).encode(e).buffer);default:throw new Error("invalid/unsupported encoding")}}},{key:"isBuffer",value:function(e){throw new Error("unimplemented")}},{key:"sanitizeBase64",value:function(e){var t=e;if((t=(t=t.split("=")[0]).replace(/[^\w+-/]/g,"")).length%4!==0){t+=["","===","==","="][t.length%4]}return t}}]),n}((0,mt.Z)(Uint8Array)),Ht=function(){function e(t,n,r,i,o){var a,s;(0,g.Z)(this,e),this.mergeTree=t,this.getLongClientId=r,this.filename=i,this.onCompletion=o,this.logger=Tt.G2.create(n,"Snapshot"),this.chunkSize=null!==(s=null===(a=null===t||void 0===t?void 0:t.options)||void 0===a?void 0:a.mergeTreeSnapshotChunkSize)&&void 0!==s?s:e.chunkSize;var u=t.getCollabWindow(),c=u.currentSeq,l=u.minSeq;this.header={minSequenceNumber:l,sequenceNumber:c,orderedChunkMetadata:[],totalLength:0,totalSegmentCount:0},this.segments=[],this.segmentLengths=[]}return(0,m.Z)(e,[{key:"getSeqLengthSegs",value:function(e,t,n){for(var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,i=[],o=0,a=0;o<n&&r+a<e.length;){var s=e[r+a];i.push(s),o+=t[r+a],a++}return{version:"1",segmentCount:a,length:o,segments:i,startIndex:r,headerMetadata:void 0}}},{key:"emit",value:function(e,t){var n=this,r=[];this.header.totalSegmentCount=0,this.header.totalLength=0;do{var i=this.getSeqLengthSegs(this.segments,this.segmentLengths,this.chunkSize,this.header.totalSegmentCount);r.push(i),this.header.totalSegmentCount+=i.segmentCount,this.header.totalLength+=i.length}while(this.header.totalSegmentCount<this.segments.length);var o=r.shift();o.headerMetadata=this.header,o.headerMetadata.orderedChunkMetadata=[{id:Bt.header}];var a=[];r.forEach((function(r,i){var o="".concat(Bt.body,"_").concat(i);n.header.orderedChunkMetadata.push({id:o}),a.push([o,Zt(o,r,n.logger,n.mergeTree.options,e,t)])}));var s=new Mt.x1;return s.addBlob(Bt.header,Zt(Bt.header,o,this.logger,this.mergeTree.options,e,t)),a.forEach((function(e){s.addBlob(e[0],e[1])})),s.getSummaryTree()}},{key:"extractSync",value:function(){var e,t=this,n=this.mergeTree,r=this.header.minSequenceNumber,i=function(e,n){t.segments.push(e),t.segmentLengths.push(n)},o=function(e){e&&i(e.toJSONObject(),e.cachedLength)};return n.walkAllSegments(n.root,(function(n){var a;if(n.seq===D||n.removedSeq<=r)return!0;if(n.seq<=r&&(void 0===n.removedSeq||n.removedSeq===D))e?e.canAppend(n)&&U(e.properties,n.properties)?(e=e.clone()).append(n.clone()):(o(e),e=n):e=n;else{o(e),e=void 0;var s={json:n.toJSONObject()};n.seq>r&&(s.seq=n.seq,s.client=t.getLongClientId(n.clientId)),void 0!==n.removedSeq&&(Z(n.removedSeq!==D&&n.removedSeq>r,101),s.removedSeq=n.removedSeq,s.removedClient=void 0!==n.removedClientIds?t.getLongClientId(n.removedClientIds[0]):void 0,s.removedClientIds=null===(a=n.removedClientIds)||void 0===a?void 0:a.map((function(e){return t.getLongClientId(e)}))),Z(void 0!==s.seq&&void 0!==s.client||void 0!==s.removedSeq&&void 0!==s.removedClient,102),i(s,n.cachedLength)}return!0}),this),o(e),this.segments}}],[{key:"loadChunk",value:function(){var t=(0,vt.Z)((0,pt.Z)().mark((function t(n,r,i,o,a){var s,u;return(0,pt.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,n.readBlob(r);case 2:return s=t.sent,u=qt(s,"utf8"),t.abrupt("return",e.processChunk(r,u,i,o,a));case 5:case"end":return t.stop()}}),t)})));return function(e,n,r,i,o){return t.apply(this,arguments)}}()},{key:"processChunk",value:function(e,t,n,r,i){return Dt(e,i?i.parse(t):JSON.parse(t),0,r)}}]),e}();Ht.chunkSize=1e4;var zt=function(){function e(t,n,r,i,o){var a=this;(0,g.Z)(this,e),this.runtime=t,this.client=n,this.mergeTree=r,this.serializer=o,this.specToSegment=function(e){var t,n;return!function(e){return!!e&&"object"===typeof e&&"json"in e}(e)?((n=a.client.specToSegment(e)).seq=0,n.clientId=q):((n=a.client.specToSegment(e.json)).clientId=void 0!==e.client?a.client.getOrAddShortClientId(e.client):q,n.seq=void 0!==e.seq?e.seq:0,void 0!==e.removedSeq&&(n.removedSeq=e.removedSeq),void 0!==e.removedClient&&(n.removedClientIds=[a.client.getOrAddShortClientId(e.removedClient)]),void 0!==e.removedClientIds&&(n.removedClientIds=null===(t=e.removedClientIds)||void 0===t?void 0:t.map((function(e){return a.client.getOrAddShortClientId(e)})))),n},this.logger=Tt.G2.create(i,"SnapshotLoader")}return(0,m.Z)(e,[{key:"initialize",value:function(){var e=(0,vt.Z)((0,pt.Z)().mark((function e(t){var n,r,i=this;return(0,pt.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.readBlob(Bt.header).then((function(e){return Z(!!e,95),i.loadHeader(qt(e,"utf8"))})),(r=this.loadBodyAndCatchupOps(n,t)).catch((function(e){return i.logger.sendErrorEvent({eventName:"CatchupOpsLoadFailure"},e)})),e.next=5,n;case 5:return e.abrupt("return",{catchupOpsP:r});case 6:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"loadBodyAndCatchupOps",value:function(){var e=(0,vt.Z)((0,pt.Z)().mark((function e(t,n){var r,i,o;return(0,pt.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=n.list(""),e.next=3,t;case 3:return i=e.sent,e.next=6,this.loadBody(i,n);case 6:return e.next=8,r;case 8:if((o=e.sent).length!==i.headerMetadata.orderedChunkMetadata.length+1){e.next=15;break}return i.headerMetadata.orderedChunkMetadata.forEach((function(e){return o.splice(o.indexOf(e.id),1)})),Z(1===o.length,96),e.abrupt("return",this.loadCatchupOps(n.readBlob(o[0])));case 15:if(o.length===i.headerMetadata.orderedChunkMetadata.length){e.next=17;break}throw new Error("Unexpected blobs in snapshot");case 17:return e.abrupt("return",[]);case 18:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"loadHeader",value:function(e){var t,n=Ht.processChunk(Bt.header,e,this.logger,this.mergeTree.options,this.serializer),i=n.segments.map(this.specToSegment);if(this.mergeTree.reloadFromSegments(i),void 0===n.headerMetadata)throw new Error("header metadata not available");return this.runtime.attachState!==r.mB.Detached&&this.client.startOrUpdateCollaboration(null!==(t=this.runtime.clientId)&&void 0!==t?t:"snapshot",void 0!==n.headerMetadata.minSequenceNumber?n.headerMetadata.minSequenceNumber:n.headerMetadata.sequenceNumber,n.headerMetadata.sequenceNumber),n}},{key:"loadBody",value:function(){var e=(0,vt.Z)((0,pt.Z)().mark((function e(t,n){var r,i,o,a,s,u,c,l,d,h,f,p,v;return(0,pt.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(Z(t.length<=t.headerMetadata.totalLength,97),Z(t.segmentCount<=t.headerMetadata.totalSegmentCount,98),t.segmentCount!==t.headerMetadata.totalSegmentCount){e.next=4;break}return e.abrupt("return");case 4:r=[],i=t.length,o=1;case 7:if(!(o<t.headerMetadata.orderedChunkMetadata.length)){e.next=16;break}return e.next=10,Ht.loadChunk(n,t.headerMetadata.orderedChunkMetadata[o].id,this.logger,this.mergeTree.options,this.serializer);case 10:a=e.sent,i+=a.length,r.push.apply(r,(0,K.Z)(a.segments.map(this.specToSegment)));case 13:o++,e.next=7;break;case 16:for(Z(i===t.headerMetadata.totalLength,99),Z(t.segmentCount+r.length===t.headerMetadata.totalSegmentCount,100),s=this.mergeTree,u=function(e,t,n){s.insertSegments(s.root.cachedLength,e,0,t,n,void 0)},c=[],l=function(){c.length>0&&u(c,q,0)},d=0,h=r;d<h.length;d++)f=h[d],p=f.clientId,v=f.seq,p===q&&0===v?c.push(f):(l(),u([f],p,v));l();case 24:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"loadCatchupOps",value:function(){var e=(0,vt.Z)((0,pt.Z)().mark((function e(t){return(0,pt.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=JSON,e.t1=qt,e.next=4,t;case 4:return e.t2=e.sent,e.t3=(0,e.t1)(e.t2,"utf8"),e.abrupt("return",e.t0.parse.call(e.t0,e.t3));case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()}]),e}();function Vt(e){return 1e3*e.trace().duration}var Gt=function(){function e(t,n,r){(0,g.Z)(this,e),this.specToSegment=t,this.logger=n,this.measureOps=!1,this.accumTime=0,this.localTime=0,this.localOps=0,this.accumWindowTime=0,this.accumWindow=0,this.accumOps=0,this.maxWindowTime=0,this.clientNameToIds=new ne($e),this.shortClientIdMap=[],this.pendingConsensus=new Map,this.mergeTree=new ct(r)}return(0,m.Z)(e,[{key:"mergeTreeDeltaCallback",get:function(){return this.mergeTree.mergeTreeDeltaCallback},set:function(e){this.mergeTree.mergeTreeDeltaCallback=e}},{key:"mergeTreeMaintenanceCallback",get:function(){return this.mergeTree.mergeTreeMaintenanceCallback},set:function(e){this.mergeTree.mergeTreeMaintenanceCallback=e}},{key:"peekPendingSegmentGroups",value:function(){var e,t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;if(1===n)return null===(e=this.mergeTree.pendingSegments)||void 0===e?void 0:e.last();var r=0;return null===(t=this.mergeTree.pendingSegments)||void 0===t?void 0:t.some((function(){return r<n&&(r++,!0)}),!0)}},{key:"annotateMarkerNotifyConsensus",value:function(e,t,n){var r=this.annotateMarker(e,t,{name:"consensus"});if(r){var i={callback:n,marker:e};return this.pendingConsensus.set(e.getId(),i),r}}},{key:"annotateMarker",value:function(e,t,n){var r=function(e,t,n){var r=e.getId();if(r)return{combiningOp:n,props:t,relativePos1:{id:r,before:!0},relativePos2:{id:r},type:T.ANNOTATE}}(e,t,n);return this.applyAnnotateRangeOp({op:r})?r:void 0}},{key:"annotateRangeLocal",value:function(e,t,n,r){var i=Rt(e,t,n,r);if(this.applyAnnotateRangeOp({op:i}))return i}},{key:"removeRangeLocal",value:function(e,t){var n=_t(e,t);if(this.applyRemoveRangeOp({op:n}))return n}},{key:"insertSegmentLocal",value:function(e,t){if(!(t.cachedLength<=0)){var n=Pt(e,t);return this.applyInsertOp({op:n})?n:void 0}}},{key:"insertAtReferencePositionLocal",value:function(e,t){var n=this.mergeTree.referencePositionToLocalPosition(e,this.getCurrentSeq(),this.getClientId());if(n!==oe.DetachedPosition){var r,i=Pt(n,t),o={op:i};return this.measureOps&&(r=At.start()),this.mergeTree.insertAtReferencePosition(e,t,o),this.completeAndLogOp(o,this.getClientSequenceArgs(o),{start:i.pos1},r),i}}},{key:"walkSegments",value:function(e,t,n,r){var i=arguments.length>4&&void 0!==arguments[4]&&arguments[4];this.mergeTree.mapRange({leaf:e},this.getCurrentSeq(),this.getClientId(),r,t,n,i)}},{key:"serializeGCData",value:function(e,t){this.mergeTree.walkAllSegments(this.mergeTree.root,(function(n){return void 0===n.removedSeq&&t.stringify(n.clone().toJSONObject(),e),!0}))}},{key:"getCollabWindow",value:function(){return this.mergeTree.getCollabWindow()}},{key:"getPosition",value:function(e){return void 0===(null===e||void 0===e?void 0:e.parent)?-1:this.mergeTree.getPosition(e,this.getCurrentSeq(),this.getClientId())}},{key:"addLocalReference",value:function(e){return this.mergeTree.addLocalReference(e)}},{key:"removeLocalReference",value:function(e){return this.removeLocalReferencePosition(e)}},{key:"createLocalReferencePosition",value:function(e,t,n,r){return this.mergeTree.createLocalReferencePosition(e,t,n,r,this)}},{key:"removeLocalReferencePosition",value:function(e){return this.mergeTree.removeLocalReferencePosition(e)}},{key:"localReferencePositionToPosition",value:function(e){return this.mergeTree.referencePositionToLocalPosition(e)}},{key:"posFromRelativePos",value:function(e){return this.mergeTree.posFromRelativePos(e)}},{key:"getMarkerFromId",value:function(e){return this.mergeTree.getMarkerFromId(e)}},{key:"applyRemoveRangeOp",value:function(e){Z(e.op.type===T.REMOVE,45);var t,n=e.op,r=this.getClientSequenceArgs(e),i=this.getValidOpRange(n,r);return!!i&&(this.measureOps&&(t=At.start()),this.mergeTree.markRangeRemoved(i.start,i.end,r.referenceSequenceNumber,r.clientId,r.sequenceNumber,!1,e),this.completeAndLogOp(e,r,i,t),!0)}},{key:"applyAnnotateRangeOp",value:function(e){Z(e.op.type===T.ANNOTATE,46);var t,n=e.op,r=this.getClientSequenceArgs(e),i=this.getValidOpRange(n,r);return!!i&&(this.measureOps&&(t=At.start()),this.mergeTree.annotateRange(i.start,i.end,n.props,n.combiningOp,r.referenceSequenceNumber,r.clientId,r.sequenceNumber,e),this.completeAndLogOp(e,r,i,t),!0)}},{key:"applyInsertOp",value:function(e){Z(e.op.type===T.INSERT,47);var t,n,r=e.op,i=this.getClientSequenceArgs(e),o=this.getValidOpRange(r,i);return!!o&&(r.seg&&(t=[this.specToSegment(r.seg)]),!(!t||0===t.length)&&(this.measureOps&&(n=At.start()),this.mergeTree.insertSegments(o.start,t,i.referenceSequenceNumber,i.clientId,i.sequenceNumber,e),this.completeAndLogOp(e,i,o,n),!0))}},{key:"completeAndLogOp",value:function(e,t,n,r){e.sequencedMessage?(Z(this.mergeTree.getCollabWindow().currentSeq<t.sequenceNumber,48),Z(this.mergeTree.getCollabWindow().minSeq<=e.sequencedMessage.minimumSequenceNumber,49),r&&(this.accumTime+=Vt(r),this.accumOps++,this.accumWindow+=this.getCurrentSeq()-this.getCollabWindow().minSeq)):r&&(this.localTime+=Vt(r),this.localOps++)}},{key:"getValidOpRange",value:function(e,t){var n=e.pos1;void 0===n&&e.relativePos1&&(n=this.mergeTree.posFromRelativePos(e.relativePos1,t.referenceSequenceNumber,t.clientId));var r=e.pos2;if(void 0===r&&e.relativePos2&&(r=this.mergeTree.posFromRelativePos(e.relativePos2,t.referenceSequenceNumber,t.clientId)),t.clientId===this.getClientId()){var i=this.getLength(),o=[];if((void 0===n||n<0||n>i||n===i&&e.type!==T.INSERT)&&o.push("start"),e.type===T.INSERT&&void 0===r||(void 0===r||r<=n)&&o.push("end"),o.length>0)throw new ce.j4("RangeOutOfBounds",{usageError:!0,end:r,invalidPositions:o.toString(),length:i,opPos1:e.pos1,opPos1Relative:void 0!==e.relativePos1,opPos2:e.pos2,opPos2Relative:void 0!==e.relativePos2,opType:e.type,start:n})}return{start:n,end:r}}},{key:"getClientSequenceArgsForMessage",value:function(e){if(e)return{clientId:this.getOrAddShortClientId(e.clientId),referenceSequenceNumber:e.referenceSequenceNumber,sequenceNumber:e.sequenceNumber};var t=this.getCollabWindow();return{clientId:t.clientId,referenceSequenceNumber:t.currentSeq,sequenceNumber:this.getLocalSequenceNumber()}}},{key:"getClientSequenceArgs",value:function(e){return this.getClientSequenceArgsForMessage(e.sequencedMessage)}},{key:"ackPendingSegment",value:function(e){var t=this,n=function(e){var n;t.measureOps&&(n=At.start()),t.mergeTree.ackPendingSegment(e),e.op.type===T.ANNOTATE&&e.op.combiningOp&&"consensus"===e.op.combiningOp.name&&t.updateConsensusProperty(e.op,e.sequencedMessage),n&&(t.accumTime+=Vt(n),t.accumOps++,t.accumWindow+=t.getCurrentSeq()-t.getCollabWindow().minSeq)};if(e.op.type===T.GROUP){var r,i=(0,f.Z)(e.op.ops);try{for(i.s();!(r=i.n()).done;){var o=r.value;n({groupOp:e.op,op:o,sequencedMessage:e.sequencedMessage})}}catch(a){i.e(a)}finally{i.f()}}else n(e)}},{key:"cloneFromSegments",value:function(){var t=new e(this.specToSegment,this.logger,this.mergeTree.options),n=this.mergeTree.blockClone(this.mergeTree.root,[]);return t.mergeTree.root=n,t}},{key:"getOrAddShortClientId",value:function(e){return this.clientNameToIds.get(e)||this.addLongClientId(e),this.getShortClientId(e)}},{key:"getShortClientId",value:function(e){return this.clientNameToIds.get(e).data}},{key:"getLongClientId",value:function(e){return e>=0?this.shortClientIdMap[e]:"original"}},{key:"addLongClientId",value:function(e){this.clientNameToIds.put(e,this.shortClientIdMap.length),this.shortClientIdMap.push(e)}},{key:"findReconnectionPosition",value:function(e,t){Z(t<=this.mergeTree.collabWindow.localSeq,50);var n=0;return this.mergeTree.walkAllSegments(this.mergeTree.root,(function(r){return r!==e&&((void 0===r.localSeq||r.localSeq<=t)&&(void 0===r.removedSeq||r.localRemovedSeq>t)&&(n+=r.cachedLength),!0)})),n}},{key:"rebasePosition",value:function(e,t,n){var r;Z(n<=this.mergeTree.collabWindow.localSeq,768);var i=0,o=e;this.mergeTree.walkAllSegments(this.mergeTree.root,(function(a){return Z(void 0!==a.seq||void 0!==a.localSeq,769),r=a,function(e){return void 0!==e.seq&&e.seq!==D&&e.seq<=t||void 0!==e.localSeq&&e.localSeq<=n}(a)&&!function(e){var r=e.removedSeq,i=e.localRemovedSeq;return void 0!==r&&r!==D&&r<=t||void 0!==i&&i<=n}(a)&&(i+=a.cachedLength,o>=a.cachedLength&&(o-=a.cachedLength)),i<=e})),Z(void 0!==r,770);var a=this.getCollabWindow().currentSeq;return(void 0!==r.removedSeq&&r.removedSeq!==D&&r.removedSeq<=a||void 0!==r.localRemovedSeq&&r.localRemovedSeq<=n)&&(o=0),Z(0<=o&&o<r.cachedLength,771),this.findReconnectionPosition(r,n)+o}},{key:"resetPendingDeltaToOps",value:function(e,t){var n,r;Z(!!t,51),Z(t===(null===(n=this.mergeTree.pendingSegments)||void 0===n?void 0:n.dequeue()),52);var i,o=[],a=(0,f.Z)(t.segments.sort((function(e,t){return e.ordinal<t.ordinal?-1:1})));try{for(a.s();!(i=a.n()).done;){var s=i.value;Z(t===s.segmentGroups.dequeue(),53);var u=this.findReconnectionPosition(s,t.localSeq),c=void 0;switch(e.type){case T.ANNOTATE:Z(!0===(null===(r=s.propertyManager)||void 0===r?void 0:r.hasPendingProperties()),54),void 0!==s.removedSeq&&void 0===s.localRemovedSeq||(c=Rt(u,u+s.cachedLength,e.props,e.combiningOp));break;case T.INSERT:Z(s.seq===D,55);var l=s;"object"===typeof e.seg&&void 0!==e.seg.props&&((l=s.clone()).properties=e.seg.props),c=Pt(u,l);break;case T.REMOVE:void 0!==s.localRemovedSeq&&(c=_t(u,u+s.cachedLength));break;default:throw new Error("Invalid op type")}if(c){var d={segments:[],localSeq:t.localSeq};s.segmentGroups.enqueue(d),this.mergeTree.pendingSegments.enqueue(d),o.push(c)}}}catch(h){a.e(h)}finally{a.f()}return o}},{key:"applyRemoteOp",value:function(e){var t=e.op,n=e.sequencedMessage;switch(this.getOrAddShortClientId(n.clientId),t.type){case T.INSERT:this.applyInsertOp(e);break;case T.REMOVE:this.applyRemoveRangeOp(e);break;case T.ANNOTATE:this.applyAnnotateRangeOp(e);break;case T.GROUP:var r,i=(0,f.Z)(t.ops);try{for(i.s();!(r=i.n()).done;){var o=r.value;this.applyRemoteOp({op:o,groupOp:t,sequencedMessage:n})}}catch(a){i.e(a)}finally{i.f()}}}},{key:"applyStashedOp",value:function(e){var t,n=this;switch(e.type){case T.INSERT:this.applyInsertOp({op:e}),t=this.peekPendingSegmentGroups();break;case T.REMOVE:this.applyRemoveRangeOp({op:e}),t=this.peekPendingSegmentGroups();break;case T.ANNOTATE:this.applyAnnotateRangeOp({op:e}),t=this.peekPendingSegmentGroups();break;case T.GROUP:return e.ops.map((function(e){return n.applyStashedOp(e)}));default:!function(e){throw new Error(arguments.length>1&&void 0!==arguments[1]?arguments[1]:"Unreachable Case")}(e,"unrecognized op type")}return Z(!!t,731),t}},{key:"applyMsg",value:function(e){var t,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this.getOrAddShortClientId(e.clientId),e.type===Ct.Operation){var r={op:e.contents,sequencedMessage:e};(null===(t=r.sequencedMessage)||void 0===t?void 0:t.clientId)===this.longClientId||n?this.ackPendingSegment(r):this.applyRemoteOp(r)}this.updateSeqNumbers(e.minimumSequenceNumber,e.sequenceNumber)}},{key:"updateSeqNumbers",value:function(e,t){var n=this.mergeTree.getCollabWindow();Z(n.currentSeq<=t,56),n.currentSeq=t,Z(e<=t,57),this.updateMinSeq(e)}},{key:"resolveRemoteClientPosition",value:function(e,t,n){var r=this.getOrAddShortClientId(n);return this.mergeTree.resolveRemoteClientPosition(e,t,r)}},{key:"regeneratePendingOp",value:function(e,t){var n=[];if(e.type===T.GROUP)if(Array.isArray(t)){Z(e.ops.length===t.length,58);for(var r=0;r<e.ops.length;r++)n.push.apply(n,(0,K.Z)(this.resetPendingDeltaToOps(e.ops[r],t[r])))}else Z(1===e.ops.length,59),n.push.apply(n,(0,K.Z)(this.resetPendingDeltaToOps(e.ops[0],t)));else Z(e.type!==T.GROUP,60),Z(!Array.isArray(t),61),n.push.apply(n,(0,K.Z)(this.resetPendingDeltaToOps(e,t)));return 1===n.length?n[0]:Ot.apply(void 0,n)}},{key:"createTextHelper",value:function(){return new ht(this.mergeTree)}},{key:"summarize",value:function(e,t,n,r){var i,o=this,a=e.deltaManager,s=a.minimumSequenceNumber;if(this.updateSeqNumbers(s,a.lastSequenceNumber),Z(this.getCollabWindow().minSeq===s,62),!0===(null===(i=this.mergeTree.options)||void 0===i?void 0:i.newMergeTreeSnapshotFormat)){Z(void 0===r||0===r.length,63);var u=new Ht(this.mergeTree,this.logger,(function(e){return o.getLongClientId(e)}));return u.extractSync(),u.emit(n,t)}var c=new Bt(this.mergeTree,this.logger);return c.extractSync(),c.emit(r,n,t)}},{key:"load",value:function(){var e=(0,vt.Z)((0,pt.Z)().mark((function e(t,n,r){var i;return(0,pt.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=new zt(t,this,this.mergeTree,this.logger,r),e.abrupt("return",i.initialize(n));case 2:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"getStackContext",value:function(e,t){return this.mergeTree.getStackContext(e,this.getCollabWindow().clientId,t)}},{key:"getLocalSequenceNumber",value:function(){return this.getCollabWindow().collaborating?D:0}},{key:"localTransaction",value:function(e){var t,n=(0,f.Z)(e.ops);try{for(n.s();!(t=n.n()).done;){var r=t.value,i={op:r,groupOp:e};switch(r.type){case T.INSERT:this.applyInsertOp(i);break;case T.ANNOTATE:this.applyAnnotateRangeOp(i);break;case T.REMOVE:this.applyRemoveRangeOp(i)}}}catch(o){n.e(o)}finally{n.f()}}},{key:"updateConsensusProperty",value:function(e,t){var n=e.relativePos1.id,r=this.pendingConsensus.get(n);r&&r.marker.addProperties(e.props,e.combiningOp,t.sequenceNumber),this.mergeTree.addMinSeqListener(t.sequenceNumber,(function(){return r.callback(r.marker)}))}},{key:"updateMinSeq",value:function(e){var t;if(this.measureOps&&(t=At.start()),this.mergeTree.setMinSeq(e),t){var n=Vt(t);this.accumWindowTime+=n,n>this.maxWindowTime&&(this.maxWindowTime=n)}}},{key:"getContainingSegment",value:function(e,t){var n=this.getClientSequenceArgsForMessage(t);return this.mergeTree.getContainingSegment(e,n.referenceSequenceNumber,n.clientId)}},{key:"getSlideToSegment",value:function(e){return this.mergeTree._getSlideToSegment(e)}},{key:"getPropertiesAtPosition",value:function(e){var t,n=this.getContainingSegment(e).segment;return n&&(t=n.properties),t}},{key:"getRangeExtentsOfPosition",value:function(e){var t,n,r=this.getContainingSegment(e).segment;return r&&(n=(t=this.getPosition(r))+r.cachedLength),{posStart:t,posAfterEnd:n}}},{key:"getCurrentSeq",value:function(){return this.getCollabWindow().currentSeq}},{key:"getClientId",value:function(){return this.getCollabWindow().clientId}},{key:"getLength",value:function(){return this.mergeTree.length}},{key:"startOrUpdateCollaboration",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;if(void 0!==e)if(void 0===this.longClientId)this.longClientId=e,this.addLongClientId(this.longClientId),this.mergeTree.startCollaboration(this.getShortClientId(this.longClientId),t,n);else{var r=this.longClientId,i=this.clientNameToIds.get(r).data;this.longClientId=e,this.clientNameToIds.put(e,i),this.shortClientIdMap[i]=e}}},{key:"findTile",value:function(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],r=this.getClientId();return this.mergeTree.findTile(e,r,t,n)}}]),e}(),Kt=n(62311),Wt=n(38697),Jt=n(97468),Qt=n(25006);var Yt=function(){function e(t,n){(0,g.Z)(this,e),this.value=t,this.valueType=n}return(0,m.Z)(e,[{key:"type",get:function(){return this.valueType.name}},{key:"makeSerialized",value:function(e,t){var n=this.valueType.factory.store(this.value),r=(0,Wt.Yv)(n,e,t);return{type:this.type,value:r}}},{key:"getOpHandler",value:function(e){var t=this.valueType.ops.get(e);if(!t)throw new Error("Unknown type message");return t}}]),e}(),Xt=function(e){function t(e,n,r,i){var o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new x;(0,g.Z)(this,t),this.serializer=e,this.handle=n,this.submitMessage=r,this.type=i,this.eventEmitter=o,this.messageHandlers=new Map,this.data=new Map,this.messageHandlers=this.getMessageHandlers()}return(0,m.Z)(t,[{key:"size",get:function(){return this.data.size}},{key:"keys",value:function(){return this.data.keys()}},{key:"entries",value:function(){var e=this.data.entries();return(0,y.Z)({next:function(){var t=e.next();return t.done?{value:void 0,done:!0}:{value:[t.value[0],t.value[1].value],done:!1}}},Symbol.iterator,(function(){return this}))}},{key:"values",value:function(){var e=this.data.values();return(0,y.Z)({next:function(){var t=e.next();return t.done?{value:void 0,done:!0}:{value:t.value.value,done:!1}}},Symbol.iterator,(function(){return this}))}},{key:e,value:function(){return this.entries()}},{key:"forEach",value:function(e){this.data.forEach((function(t,n,r){e(t.value,n,r)}))}},{key:"get",value:function(e){var t;return(null!==(t=this.data.get(e))&&void 0!==t?t:this.createCore(e,!0)).value}},{key:"has",value:function(e){return this.data.has(e)}},{key:"getSerializedStorage",value:function(e){var t=this,n={};return this.data.forEach((function(r,i){n[i]=r.makeSerialized(e,t.handle)})),n}},{key:"getSerializableStorage",value:function(e){var t=this,n={};return this.data.forEach((function(r,i){n[i]=function(e,t,n){var r=e.makeSerialized(t,n);return{type:r.type,value:r.value&&JSON.parse(r.value)}}(r,e,t.handle)})),n}},{key:"serialize",value:function(e){return JSON.stringify(this.getSerializableStorage(e))}},{key:"populateFromSerializable",value:function(e){for(var t=0,n=Object.entries(e);t<n.length;t++){var r=(0,ft.Z)(n[t],2),i=r[0],o=r[1];if(o.type!==Qt.G[Qt.G.Plain]&&o.type!==Qt.G[Qt.G.Shared]){var a={key:i.startsWith("intervalCollections/")?i.substring(20):i,value:this.makeLocal(i,o)};this.data.set(a.key,a.value)}}}},{key:"populate",value:function(e){this.populateFromSerializable(JSON.parse(e))}},{key:"tryResubmitMessage",value:function(e,t){var n=e.type,r=this.messageHandlers.get(n);return void 0!==r&&(r.resubmit(e,t),!0)}},{key:"tryGetStashedOpLocalMetadata",value:function(e){var t=e.type;if(this.messageHandlers.has(t))return this.messageHandlers.get(t).getStashedOpLocalMetadata(e);throw new Error("no apply stashed op handler")}},{key:"tryProcessMessage",value:function(e,t,n,r){var i=this.messageHandlers.get(e.type);return void 0!==i&&(i.process(e,t,n,r),!0)}},{key:"createCore",value:function(e,t){var n=new Yt(this.type.factory.load(this.makeMapValueOpEmitter(e),void 0),this.type),r=this.data.get(e);this.data.set(e,n);var i={key:e,previousValue:r};return this.eventEmitter.emit("create",i,t,this.eventEmitter),n}},{key:"makeLocal",value:function(e,t){b(t.type!==Qt.G[Qt.G.Plain]&&t.type!==Qt.G[Qt.G.Shared],737),t.value=(0,Wt.lB)(t.value,this.serializer);var n=this.type.factory.load(this.makeMapValueOpEmitter(e),t.value);return new Yt(n,this.type)}},{key:"getMessageHandlers",value:function(){var e=this,t=new Map;return t.set("act",{process:function(t,n,r,i){var o,a=null!==(o=e.data.get(t.key))&&void 0!==o?o:e.createCore(t.key,n),s=a.getOpHandler(t.value.opName),u=a.value,c=(0,Wt.lB)(t.value.value,e.serializer);s.process(u,c,n,r,i);var l={key:t.key,previousValue:u};e.eventEmitter.emit("valueChanged",l,n,r,e.eventEmitter)},submit:function(t,n){e.submitMessage(t,n)},resubmit:function(t,n){var r=e.data.get(t.key),i=r.getOpHandler(t.value.opName).rebase(r.value,t.value,n),o=i.rebasedOp,a=i.rebasedLocalOpMetadata;e.submitMessage(Object.assign(Object.assign({},t),{value:o}),a)},getStashedOpLocalMetadata:function(e){b(!1,22)}}),t}},{key:"makeMapValueOpEmitter",value:function(e){var t=this;return{emit:function(n,r,i,o){var a=(0,Wt.i8)(i,t.serializer,t.handle),s={key:e,type:"act",value:{opName:n,value:a}};t.submitMessage(s,o);var u={key:e,previousValue:r};t.eventEmitter.emit("valueChanged",u,!0,null,t.eventEmitter)}}}}]),t}(Symbol.iterator),$t=function(){function e(){(0,g.Z)(this,e),this.ordinalSortedItems=[]}return(0,m.Z)(e,[{key:"size",get:function(){return this.ordinalSortedItems.length}},{key:"items",get:function(){return this.ordinalSortedItems}},{key:"addOrUpdate",value:function(e,t){var n=this.findOrdinalPosition(this.getOrdinal(e));n.exists?t&&t(this.ordinalSortedItems[n.index],e):this.ordinalSortedItems.splice(n.index,0,e)}},{key:"remove",value:function(e){var t=this.findOrdinalPosition(this.getOrdinal(e));return!!t.exists&&(this.ordinalSortedItems.splice(t.index,1),!0)}},{key:"has",value:function(e){return this.findOrdinalPosition(this.getOrdinal(e)).exists}},{key:"getOrdinal",value:function(e){var t=e;return(null===t||void 0===t?void 0:t.segment)?t.segment.ordinal:e.ordinal}},{key:"findOrdinalPosition",value:function(e,t,n){if(0===this.ordinalSortedItems.length)return{exists:!1,index:0};if(void 0===t||void 0===n)return this.findOrdinalPosition(e,0,this.ordinalSortedItems.length-1);var r=t+Math.floor((n-t)/2);return this.getOrdinal(this.ordinalSortedItems[r])>e?t===r?{exists:!1,index:r}:this.findOrdinalPosition(e,t,r-1):this.getOrdinal(this.ordinalSortedItems[r])<e?r===n?{exists:!1,index:r+1}:this.findOrdinalPosition(e,r+1,n):{exists:!0,index:r}}}]),e}(),en=function(){function e(t,n){var r=this;(0,g.Z)(this,e),this.deltaArgs=t,this.mergeTreeClient=n,b(t.deltaSegments.length>0,728),this.isEmpty=!1,this.deltaOperation=t.operation,this.sortedRanges=new rn((function(){var e=new $t;return r.deltaArgs.deltaSegments.forEach((function(t){var n={operation:r.deltaArgs.operation,position:r.mergeTreeClient.getPosition(t.segment),propertyDeltas:t.propertyDeltas,segment:t.segment};e.addOrUpdate(n)})),e})),this.pFirst=new rn((function(){return r.sortedRanges.value.items[0]})),this.pLast=new rn((function(){return r.sortedRanges.value.items[r.sortedRanges.value.size-1]}))}return(0,m.Z)(e,[{key:"ranges",get:function(){return this.sortedRanges.value.items}},{key:"clientId",get:function(){return this.mergeTreeClient.longClientId}},{key:"first",get:function(){return this.pFirst.value}},{key:"last",get:function(){return this.pLast.value}}]),e}(),tn=function(e){(0,p.Z)(n,e);var t=(0,v.Z)(n);function n(e,r,i){var o;return(0,g.Z)(this,n),(o=t.call(this,r,i)).opArgs=e,o.isLocal=void 0===e.sequencedMessage,o}return(0,m.Z)(n)}(en),nn=function(e){(0,p.Z)(n,e);var t=(0,v.Z)(n);function n(e,r,i){var o;return(0,g.Z)(this,n),(o=t.call(this,r,i)).opArgs=e,o}return(0,m.Z)(n)}(en),rn=function(){function e(t){(0,g.Z)(this,e),this.valueGenerator=t,this.pEvaluated=!1}return(0,m.Z)(e,[{key:"evaluated",get:function(){return this.pEvaluated}},{key:"value",get:function(){return this.pEvaluated||(this.pEvaluated=!0,this.pValue=this.valueGenerator()),this.pValue}}]),e}(),on="header",an="content",sn=function(e){(0,p.Z)(n,e);var t=(0,v.Z)(n);function n(e,r,i,o){var a,s,u,c,l;return(0,g.Z)(this,n),(l=t.call(this,r,e,i,"fluid_sequence_")).dataStoreRuntime=e,l.id=r,l.segmentFromSpec=o,l.loadedDeferred=new gt,l.loadedDeferredOutgoingOps=[],l.deferIncomingOps=!0,l.loadedDeferredIncomingOps=[],l.messagesSinceMSNChange=[],l.loadedDeferred.promise.catch((function(e){l.logger.sendErrorEvent({eventName:"SequenceLoadFailed"},e)})),l.client=new Gt(o,Tt.G2.create(l.logger,"SharedSegmentSequence.MergeTreeClient"),e.options),(0,k.Z)((a=(0,S.Z)(l),(0,C.Z)(n.prototype)),"on",a).call(a,"newListener",(function(e){switch(e){case"sequenceDelta":l.client.mergeTreeDeltaCallback||(l.client.mergeTreeDeltaCallback=function(e,t){l.emit("sequenceDelta",new tn(e,t,l.client),(0,S.Z)(l))});break;case"maintenance":l.client.mergeTreeMaintenanceCallback||(l.client.mergeTreeMaintenanceCallback=function(e,t){l.emit("maintenance",new nn(t,e,l.client),(0,S.Z)(l))})}})),(0,k.Z)((s=(0,S.Z)(l),(0,C.Z)(n.prototype)),"on",s).call(s,"removeListener",(function(e){switch(e){case"sequenceDelta":0===(0,k.Z)((u=(0,S.Z)(l),(0,C.Z)(n.prototype)),"listenerCount",u).call(u,e)&&(l.client.mergeTreeDeltaCallback=void 0);break;case"maintenance":0===(0,k.Z)((c=(0,S.Z)(l),(0,C.Z)(n.prototype)),"listenerCount",c).call(c,e)&&(l.client.mergeTreeMaintenanceCallback=void 0)}})),l.intervalCollections=new Xt(l.serializer,l.handle,(function(e,t){return l.submitLocalMessage(e,t)}),new Se),l}return(0,m.Z)(n,[{key:"loaded",get:function(){return this.loadedDeferred.promise}},{key:"removeRange",value:function(e,t){var n=this.client.removeRangeLocal(e,t);return n&&this.submitSequenceMessage(n),n}},{key:"groupOperation",value:function(e){this.client.localTransaction(e),this.submitSequenceMessage(e)}},{key:"getContainingSegment",value:function(e){return this.client.getContainingSegment(e)}},{key:"getLength",value:function(){return this.client.getLength()}},{key:"getPosition",value:function(e){return this.client.getPosition(e)}},{key:"annotateRange",value:function(e,t,n,r){var i=this.client.annotateRangeLocal(e,t,n,r);i&&this.submitSequenceMessage(i)}},{key:"getPropertiesAtPosition",value:function(e){return this.client.getPropertiesAtPosition(e)}},{key:"getRangeExtentsOfPosition",value:function(e){return this.client.getRangeExtentsOfPosition(e)}},{key:"createPositionReference",value:function(e,t,n){var r=new oe(this.client,e,t,n);return n!==w.Transient&&this.addLocalReference(r),r}},{key:"createLocalReferencePosition",value:function(e,t,n,r){return this.client.createLocalReferencePosition(e,t,n,r)}},{key:"localRefToPos",value:function(e){return this.client.localReferencePositionToPosition(e)}},{key:"localReferencePositionToPosition",value:function(e){return this.client.localReferencePositionToPosition(e)}},{key:"resolveRemoteClientPosition",value:function(e,t,n){return this.client.resolveRemoteClientPosition(e,t,n)}},{key:"submitSequenceMessage",value:function(e){if(this.isAttached()){var t=(0,Wt.i8)(e,this.serializer,this.handle),n=this.client.peekPendingSegmentGroups(e.type===T.GROUP?e.ops.length:1);this.loadedDeferred.isCompleted?this.submitLocalMessage(t,n):this.loadedDeferredOutgoingOps.push([t,n])}}},{key:"addLocalReference",value:function(e){return this.client.addLocalReference(e)}},{key:"removeLocalReference",value:function(e){return this.client.removeLocalReferencePosition(e)}},{key:"removeLocalReferencePosition",value:function(e){return this.client.removeLocalReferencePosition(e)}},{key:"posFromRelativePos",value:function(e){return this.client.posFromRelativePos(e)}},{key:"walkSegments",value:function(e,t,n,r){var i=arguments.length>4&&void 0!==arguments[4]&&arguments[4];return this.client.walkSegments(e,t,n,r,i)}},{key:"getStackContext",value:function(e,t){return this.client.getStackContext(e,t)}},{key:"getCurrentSeq",value:function(){return this.client.getCurrentSeq()}},{key:"insertAtReferencePosition",value:function(e,t){var n=this.client.insertAtReferencePositionLocal(e,t);n&&this.submitSequenceMessage(n)}},{key:"waitIntervalCollection",value:function(){var e=(0,vt.Z)((0,pt.Z)().mark((function e(t){return(0,pt.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.intervalCollections.get(t));case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getIntervalCollection",value:function(e){return this.intervalCollections.get(e)}},{key:"getIntervalCollectionLabels",value:function(){return this.intervalCollections.keys()}},{key:"summarizeCore",value:function(e,t){var n=new Mt.x1;return this.intervalCollections.size>0&&n.addBlob(on,this.intervalCollections.serialize(e)),n.addWithStats(an,this.summarizeMergeTree(e)),n.getSummaryTree()}},{key:"processGCDataCore",value:function(e){this.intervalCollections.size>0&&this.intervalCollections.serialize(e),this.client.serializeGCData(this.handle,e)}},{key:"replaceRange",value:function(e,t,n){var r=Math.max(e,t),i=this.client.insertSegmentLocal(r,n);if(i)if(e<t){var o=this.client.removeRangeLocal(e,t);this.submitSequenceMessage(Ot(i,o))}else this.submitSequenceMessage(i)}},{key:"onConnect",value:function(){this.client.startOrUpdateCollaboration(this.runtime.clientId)}},{key:"onDisconnect",value:function(){}},{key:"reSubmitCore",value:function(e,t){this.intervalCollections.tryResubmitMessage(e,t)||this.submitSequenceMessage(this.client.regeneratePendingOp(e,t))}},{key:"loadCore",value:function(){var e=(0,vt.Z)((0,pt.Z)().mark((function e(t){var n,r,i,o,a,s,u=this;return(0,pt.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.contains(on);case 2:if(!e.sent){e.next=8;break}return e.next=5,t.readBlob(on);case 5:r=e.sent,i=bt(r,"utf8"),this.intervalCollections.populate(i);case 8:return e.prev=8,e.next=11,this.client.load(this.runtime,new Kt.M(t,an),this.serializer);case 11:if(o=e.sent,a=o.catchupOpsP,s=a.then((function(e){e.forEach((function(e){var t=u.client.getCollabWindow();if(e.minimumSequenceNumber<t.minSeq||e.referenceSequenceNumber<t.minSeq||e.sequenceNumber<=t.minSeq||e.sequenceNumber<=t.currentSeq)throw new Error("Invalid catchup operations in snapshot: ".concat(JSON.stringify({op:{seq:e.sequenceNumber,minSeq:e.minimumSequenceNumber,refSeq:e.referenceSequenceNumber},collabWindow:{seq:t.currentSeq,minSeq:t.minSeq}})));u.processMergeTreeMsg(e)})),u.loadFinished()})).catch((function(e){u.loadFinished(e)})),!0===(null===(n=this.dataStoreRuntime.options)||void 0===n?void 0:n.sequenceInitializeFromHeaderOnly)){e.next=17;break}return e.next=17,s;case 17:e.next=22;break;case 19:e.prev=19,e.t0=e.catch(8),this.loadFinished(e.t0);case 22:case"end":return e.stop()}}),e,this,[[8,19]])})));return function(t){return e.apply(this,arguments)}}()},{key:"processCore",value:function(e,t,n){this.deferIncomingOps?(b(!t,114),this.loadedDeferredIncomingOps.push(e)):(b(e.type===St.Operation,115),this.intervalCollections.tryProcessMessage(e.contents,t,e,n)||this.processMergeTreeMsg(e,t))}},{key:"didAttach",value:function(){var e;this.isAttached()&&this.client.startOrUpdateCollaboration(null!==(e=this.runtime.clientId)&&void 0!==e?e:"attached")}},{key:"initializeLocalCore",value:function(){(0,k.Z)((0,C.Z)(n.prototype),"initializeLocalCore",this).call(this),this.loadFinished()}},{key:"applyStashedOp",value:function(e){return this.client.applyStashedOp(e)}},{key:"summarizeMergeTree",value:function(e){b(this.loadedDeferred.isCompleted,116);var t=this.runtime.deltaManager.minimumSequenceNumber;return this.processMinSequenceNumberChanged(t),this.messagesSinceMSNChange.forEach((function(e){e.minimumSequenceNumber=t})),this.client.summarize(this.runtime,this.handle,e,this.messagesSinceMSNChange)}},{key:"processMergeTreeMsg",value:function(e,t){var r,i,o=(0,Wt.lB)(e,this.serializer),a=[];function s(e){a.push.apply(a,(0,K.Z)(n.createOpsFromDelta(e)))}var u=o.referenceSequenceNumber!==o.sequenceNumber-1,c=o;!0!==(null===(r=this.runtime.options)||void 0===r?void 0:r.newMergeTreeSnapshotFormat)&&u&&this.on("sequenceDelta",s),this.client.applyMsg(o,t),!0!==(null===(i=this.runtime.options)||void 0===i?void 0:i.newMergeTreeSnapshotFormat)&&(u&&(this.removeListener("sequenceDelta",s),c=Object.assign(Object.assign({},o),{referenceSequenceNumber:c.sequenceNumber-1,contents:1!==a.length?Ot.apply(void 0,a):a[0]})),this.messagesSinceMSNChange.push(c),this.messagesSinceMSNChange.length>20&&this.messagesSinceMSNChange[20].sequenceNumber<o.minimumSequenceNumber&&this.processMinSequenceNumberChanged(o.minimumSequenceNumber))}},{key:"processMinSequenceNumberChanged",value:function(e){for(var t=0;t<this.messagesSinceMSNChange.length&&!(this.messagesSinceMSNChange[t].sequenceNumber>e);t++);0!==t&&(this.messagesSinceMSNChange=this.messagesSinceMSNChange.slice(t))}},{key:"loadFinished",value:function(e){if(!this.loadedDeferred.isCompleted){if(this.initializeIntervalCollections(),e)throw this.loadedDeferred.reject(e),e;this.deferIncomingOps=!1;var t,n=(0,f.Z)(this.loadedDeferredIncomingOps);try{for(n.s();!(t=n.n()).done;){var r=t.value;this.processCore(r,!1,void 0)}}catch(c){n.e(c)}finally{n.f()}this.loadedDeferredIncomingOps.length=0,this.loadedDeferred.resolve();var i,o=(0,f.Z)(this.loadedDeferredOutgoingOps);try{for(o.s();!(i=o.n()).done;){var a=(0,ft.Z)(i.value,2),s=a[0],u=a[1];this.reSubmitCore(s,u)}}catch(c){o.e(c)}finally{o.f()}this.loadedDeferredOutgoingOps.length=0}}},{key:"initializeIntervalCollections",value:function(){var e=this;this.intervalCollections.eventEmitter.on("create",(function(t,n){var r=t.key,i=t.previousValue,o=e.intervalCollections.get(r);o.attached||o.attachGraph(e.client,r),b(void 0===i,705),e.emit("createIntervalCollection",r,n,e)}));var t,n=(0,f.Z)(this.intervalCollections.keys());try{for(n.s();!(t=n.n()).done;){var r=t.value;this.intervalCollections.get(r).attachGraph(this.client,r)}}catch(i){n.e(i)}finally{n.f()}}}],[{key:"createOpsFromDelta",value:function(e){var t,n,r,i=[],o=(0,f.Z)(e.ranges);try{for(o.s();!(r=o.n()).done;){var a=r.value;switch(e.deltaOperation){case T.ANNOTATE:for(var s=i[i.length-1],u={},c=0,l=Object.keys(a.propertyDeltas);c<l.length;c++){var d=l[c];u[d]=null!==(n=null===(t=a.segment.properties)||void 0===t?void 0:t[d])&&void 0!==n?n:null}s&&s.pos2===a.position&&U(s.props,u)?s.pos2+=a.segment.cachedLength:i.push(Rt(a.position,a.position+a.segment.cachedLength,u,void 0));break;case T.INSERT:i.push(Nt(a.position,a.segment.clone().toJSONObject()));break;case T.REMOVE:var h=i[i.length-1];(null===h||void 0===h?void 0:h.pos1)===a.position?h.pos2+=a.segment.cachedLength:i.push(_t(a.position,a.position+a.segment.cachedLength))}}}catch(p){o.e(p)}finally{o.f()}return i}}]),n}(Jt.h),un="1.3.6",cn=function(e){(0,p.Z)(n,e);var t=(0,v.Z)(n);function n(e){var r;return(0,g.Z)(this,n),(r=t.call(this)).items=e,r.type=n.typeString,r.cachedLength=e.length,r}return(0,m.Z)(n,[{key:"toJSONObject",value:function(){var e={items:this.items};return(0,k.Z)((0,C.Z)(n.prototype),"addSerializedProps",this).call(this,e),e}},{key:"clone",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1?arguments[1]:void 0,r=new n(this.items.slice(e,t));return this.cloneInto(r),r}},{key:"canAppend",value:function(e){return n.is(e)&&(this.cachedLength<=128||e.cachedLength<=128)}},{key:"toString",value:function(){return this.items.toString()}},{key:"append",value:function(e){if(!n.is(e))throw new Error("can only append another run segment");ue.append(this,e),this.items=this.items.concat(e.items),this.cachedLength=this.items.length}},{key:"removeRange",value:function(e,t){var n=[],r=this.items.length;return e>0&&(n=n.concat(this.items.slice(0,e))),t<r&&(n=n.concat(this.items.slice(t))),this.items=n,this.cachedLength=this.items.length,0===this.items.length}},{key:"createSplitSegmentAt",value:function(e){if(e>0){var t=this.items.slice(e);return this.items=this.items.slice(0,e),this.cachedLength=this.items.length,new n(t)}}}],[{key:"is",value:function(e){return e.type===n.typeString}},{key:"fromJSONObject",value:function(e){if(e&&"object"===typeof e&&"items"in e){var t=new n(e.items);return e.props&&t.addProperties(e.props),t}}}]),n}(Ke);cn.typeString="SubSequence";var ln=function(e){(0,p.Z)(n,e);var t=(0,v.Z)(n);function n(e,r,i,o){var a;return(0,g.Z)(this,n),(a=t.call(this,e,r,i,o)).id=r,a}return(0,m.Z)(n,[{key:"insert",value:function(e,t,n){var r=new cn(t);n&&r.addProperties(n);var i=this.client.insertSegmentLocal(e,r);i&&this.submitSequenceMessage(i)}},{key:"remove",value:function(e,t){this.removeRange(e,t)}},{key:"getItemCount",value:function(){return this.getLength()}},{key:"getItems",value:function(e,t){var n,r=[];return void 0!==t&&t<=e||(this.walkSegments((function(e){return cn.is(e)&&(void 0===n&&(n=e),r.push.apply(r,(0,K.Z)(e.items))),!0}),e,t),void 0!==n&&r.splice(0,e-this.getPosition(n)),void 0!==t&&r.splice(t-e)),r}}]),n}(sn),dn=function(e){(0,p.Z)(n,e);var t=(0,v.Z)(n);function n(e,r,i){var o;return(0,g.Z)(this,n),(o=t.call(this,e,r,i,vn.segmentFromSpec)).id=r,o}return(0,m.Z)(n,[{key:"getRange",value:function(e,t){return this.getItems(e,t)}}],[{key:"create",value:function(e,t){return e.createChannel(t,vn.Type)}},{key:"getFactory",value:function(){return new vn}}]),n}(ln),hn=function(e){(0,p.Z)(n,e);var t=(0,v.Z)(n);function n(e,r,i){var o;return(0,g.Z)(this,n),(o=t.call(this,e,r,i,pn.segmentFromSpec)).id=r,o}return(0,m.Z)(n,[{key:"getRange",value:function(e,t){return this.getItems(e,t)}}],[{key:"create",value:function(e,t){return e.createChannel(t,pn.Type)}},{key:"getFactory",value:function(){return new pn}}]),n}(ln),fn=function(){function e(){(0,g.Z)(this,e)}return(0,m.Z)(e,[{key:"type",get:function(){return e.Type}},{key:"attributes",get:function(){return e.Attributes}},{key:"load",value:function(){var e=(0,vt.Z)((0,pt.Z)().mark((function e(t,n,r,i){var o;return(0,pt.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=new gn(t,n,i),e.next=3,o.load(r);case 3:return e.abrupt("return",o);case 4:case"end":return e.stop()}}),e)})));return function(t,n,r,i){return e.apply(this,arguments)}}()},{key:"create",value:function(e,t){var n=new gn(e,t,this.attributes);return n.initializeLocal(),n}}],[{key:"segmentFromSpec",value:function(e){var t=lt.fromJSONObject(e);if(t)return t;var n=Je.fromJSONObject(e);return n||void 0}}]),e}();fn.Type="https://graph.microsoft.com/types/mergeTree",fn.Attributes={type:fn.Type,snapshotFormatVersion:"0.1",packageVersion:un};var pn=function(){function e(){(0,g.Z)(this,e)}return(0,m.Z)(e,[{key:"type",get:function(){return e.Type}},{key:"attributes",get:function(){return e.Attributes}},{key:"load",value:function(){var e=(0,vt.Z)((0,pt.Z)().mark((function e(t,n,r,i){var o;return(0,pt.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=new hn(t,n,i),e.next=3,o.load(r);case 3:return e.abrupt("return",o);case 4:case"end":return e.stop()}}),e)})));return function(t,n,r,i){return e.apply(this,arguments)}}()},{key:"create",value:function(e,t){var n=new hn(e,t,this.attributes);return n.initializeLocal(),n}}],[{key:"segmentFromSpec",value:function(e){var t=e;if(t.items){var n=new cn(t.items);return t.props&&n.addProperties(t.props),n}}}]),e}();pn.Type="https://graph.microsoft.com/types/mergeTree/object-sequence",pn.Attributes={type:pn.Type,snapshotFormatVersion:"0.1",packageVersion:un};var vn=function(){function e(){(0,g.Z)(this,e)}return(0,m.Z)(e,[{key:"type",get:function(){return e.Type}},{key:"attributes",get:function(){return e.Attributes}},{key:"load",value:function(){var e=(0,vt.Z)((0,pt.Z)().mark((function e(t,n,r,i){var o;return(0,pt.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=new dn(t,n,i),e.next=3,o.load(r);case 3:return e.abrupt("return",o);case 4:case"end":return e.stop()}}),e)})));return function(t,n,r,i){return e.apply(this,arguments)}}()},{key:"create",value:function(e,t){var n=new dn(e,t,this.attributes);return n.initializeLocal(),n}}],[{key:"segmentFromSpec",value:function(e){var t=e;if(t.items){var n=new cn(t.items);return t.props&&n.addProperties(t.props),n}}}]),e}();vn.Type="https://graph.microsoft.com/types/mergeTree/number-sequence",vn.Attributes={type:vn.Type,snapshotFormatVersion:"0.1",packageVersion:un};var gn=function(e){(0,p.Z)(n,e);var t=(0,v.Z)(n);function n(e,r,i){var o;return(0,g.Z)(this,n),(o=t.call(this,e,r,i,fn.segmentFromSpec)).id=r,o.mergeTreeTextHelper=o.client.createTextHelper(),o}return(0,m.Z)(n,[{key:"ISharedString",get:function(){return this}},{key:"insertMarkerRelative",value:function(e,t,n){var r=new Je(t);n&&r.addProperties(n);var i=this.posFromRelativePos(e),o=this.client.insertSegmentLocal(i,r);o&&this.submitSequenceMessage(o)}},{key:"insertMarker",value:function(e,t,n){var r=new Je(t);n&&r.addProperties(n);var i=this.client.insertSegmentLocal(e,r);return i&&this.submitSequenceMessage(i),i}},{key:"insertTextRelative",value:function(e,t,n){var r=new lt(t);n&&r.addProperties(n);var i=this.posFromRelativePos(e),o=this.client.insertSegmentLocal(i,r);o&&this.submitSequenceMessage(o)}},{key:"insertText",value:function(e,t,n){var r=new lt(t);n&&r.addProperties(n);var i=this.client.insertSegmentLocal(e,r);i&&this.submitSequenceMessage(i)}},{key:"replaceText",value:function(e,t,n,r){this.replaceRange(e,t,lt.make(n,r))}},{key:"removeText",value:function(e,t){return this.removeRange(e,t)}},{key:"annotateMarkerNotifyConsensus",value:function(e,t,n){var r=this.client.annotateMarkerNotifyConsensus(e,t,n);r&&this.submitSequenceMessage(r)}},{key:"annotateMarker",value:function(e,t,n){var r=this.client.annotateMarker(e,t,n);r&&this.submitSequenceMessage(r)}},{key:"findTile",value:function(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return this.client.findTile(e,t,n)}},{key:"getTextAndMarkers",value:function(e){var t=this.client.getCollabWindow();return this.mergeTreeTextHelper.getTextAndMarkers(t.currentSeq,t.clientId,e)}},{key:"getText",value:function(e,t){var n=this.client.getCollabWindow();return this.mergeTreeTextHelper.getText(n.currentSeq,n.clientId,"",e,t)}},{key:"getTextWithPlaceholders",value:function(){var e=this.client.getCollabWindow();return this.mergeTreeTextHelper.getText(e.currentSeq,e.clientId," ")}},{key:"getTextRangeWithPlaceholders",value:function(e,t){var n=this.client.getCollabWindow();return this.mergeTreeTextHelper.getText(n.currentSeq,n.clientId," ",e,t)}},{key:"getTextRangeWithMarkers",value:function(e,t){var n=this.client.getCollabWindow();return this.mergeTreeTextHelper.getText(n.currentSeq,n.clientId,"*",e,t)}},{key:"getMarkerFromId",value:function(e){return this.client.getMarkerFromId(e)}}],[{key:"create",value:function(e,t){return e.createChannel(t,fn.Type)}},{key:"getFactory",value:function(){return new fn}}]),n}(sn),mn=function(e){(0,p.Z)(n,e);var t=(0,v.Z)(n);function n(e){var r;return(0,g.Z)(this,n),(r=t.call(this)).type=n.typeString,r.cachedLength=e,r}return(0,m.Z)(n,[{key:"toJSONObject",value:function(){return{pad:this.cachedLength,props:this.properties}}},{key:"clone",value:function(){var e=new n(this.cachedLength);return this.cloneInto(e),e}},{key:"canAppend",value:function(e){return n.is(e)}},{key:"toString",value:function(){return"[padding: ".concat(this.cachedLength,"]")}},{key:"append",value:function(e){if(!n.is(e))throw new Error("can only append padding segment");ue.append(this,e),this.cachedLength+=e.cachedLength}},{key:"removeRange",value:function(e,t){return this.cachedLength-=t-e,0===this.cachedLength}},{key:"createSplitSegmentAt",value:function(e){var t=e,r=this.cachedLength-e;return this.cachedLength=t,new n(r)}}],[{key:"is",value:function(e){return e.type===n.typeString}},{key:"fromJSONObject",value:function(e){if(e&&"object"===typeof e&&"pad"in e){var t=new n(e.pad);return e.props&&t.addProperties(e.props),t}}}]),n}(Ke);mn.typeString="PaddingSegment";var yn=function(e){(0,p.Z)(n,e);var t=(0,v.Z)(n);function n(e){var r;return(0,g.Z)(this,n),(r=t.call(this,e)).items=e,r.type=n.typeString,r.tags=new Array(e.length).fill(void 0),r}return(0,m.Z)(n,[{key:"clone",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1?arguments[1]:void 0,r=new n(this.items.slice(e,t));return this.tags&&(r.tags=this.tags.slice(e,t)),this.cloneInto(r),r}},{key:"append",value:function(e){(0,k.Z)((0,C.Z)(n.prototype),"append",this).call(this,e);var t,r=e;r.tags&&(this.tags&&(t=this.tags).splice.apply(t,[this.items.length,0].concat((0,K.Z)(r.tags))));return this}},{key:"removeRange",value:function(e,t){return this.tags.splice(e,t-e),(0,k.Z)((0,C.Z)(n.prototype),"removeRange",this).call(this,e,t)}},{key:"getTag",value:function(e){return this.tags[e]}},{key:"setTag",value:function(e,t){this.tags[e]=t}},{key:"createSplitSegmentAt",value:function(e){if(e>0){var t=this.items.slice(e);this.items=this.items.slice(0,e),this.cachedLength=this.items.length;var r=new n(t);return r.tags=this.tags.slice(e),this.tags.length=e,r}}}],[{key:"is",value:function(e){return e.type===n.typeString}},{key:"fromJSONObject",value:function(e){if(e&&"object"===typeof e&&"items"in e){var t=new n(e.items);return e.props&&t.addProperties(e.props),t}}}]),n}(cn);yn.typeString="RunSegment";var bn=2097152,wn=bn+1,Sn=4294967295,kn=Sn+1,Cn=bn*Sn,xn=function(e,t){return e*wn+t};function En(e){var t=Math.floor(e/wn);return{row:t,col:e-t*wn}}var Tn,In=function(e){(0,p.Z)(n,e);var t=(0,v.Z)(n);function n(e,r,i){var o;return(0,g.Z)(this,n),(o=t.call(this,e,r,i,An.segmentFromSpec)).id=r,o}return(0,m.Z)(n,[{key:"numRows",get:function(){return En(this.getLength()).row}},{key:"setItems",value:function(e,t,n,r){var i=xn(e,t),o=i+n.length,a=new yn(n);r&&a.addProperties(r),this.replaceRange(i,o,a)}},{key:"getItem",value:function(e,t){var n=xn(e,t),r=this.getContainingSegment(n),i=r.segment,o=r.offset;if(i&&yn.is(i))return i.items[o];if(!i||!mn.is(i))throw new Error("Unrecognized Segment type")}},{key:"getTag",value:function(e,t){var n=this.getSegment(e,t),r=n.segment,i=n.offset;if(yn.is(r))return r.getTag(i)}},{key:"setTag",value:function(e,t,n){var r=this.getSegment(e,t),i=r.segment,o=r.offset;if(yn.is(i))i.setTag(o,n);else if(void 0!==n)throw new Error("Must not attempt to set tags on '".concat(i.constructor.name,"'."))}},{key:"insertRows",value:function(e,t){var n=xn(e,0),r=new mn(wn*t),i=this.client.insertSegmentLocal(n,r);i&&this.submitSequenceMessage(i)}},{key:"removeRows",value:function(e,t){var n=xn(e,0),r=wn*t;this.removeRange(n,n+r)}},{key:"insertCols",value:function(e,t){this.moveAsPadding(bn-t,e,t)}},{key:"removeCols",value:function(e,t){this.moveAsPadding(e,bn-t,t)}},{key:"annotatePosition",value:function(e,t,n){var r=xn(e,t);this.annotateRange(r,r+1,n)}},{key:"getPositionProperties",value:function(e,t){var n=xn(e,t);return this.getPropertiesAtPosition(n)}},{key:"moveAsPadding",value:function(e,t,n){for(var r=e,i=e+n,o=[],a=0,s=0;a<this.numRows;a++,s+=wn){o.push(this.client.removeRangeLocal(s+r,s+i));var u=s+t,c=new mn(n);o.push(this.client.insertSegmentLocal(u,c))}this.submitSequenceMessage(Ot.apply(void 0,o))}},{key:"getSegment",value:function(e,t){var n=xn(e,t);return this.getContainingSegment(n)}}],[{key:"create",value:function(e,t){return e.createChannel(t,An.Type)}},{key:"getFactory",value:function(){return new An}}]),n}(sn),An=function(){function e(){(0,g.Z)(this,e)}return(0,m.Z)(e,[{key:"type",get:function(){return e.Type}},{key:"attributes",get:function(){return e.Attributes}},{key:"load",value:function(){var e=(0,vt.Z)((0,pt.Z)().mark((function e(t,n,r,i){var o;return(0,pt.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=new In(t,n,i),e.next=3,o.load(r);case 3:return e.abrupt("return",o);case 4:case"end":return e.stop()}}),e)})));return function(t,n,r,i){return e.apply(this,arguments)}}()},{key:"create",value:function(e,t){var n=new In(e,t,this.attributes);return n.initializeLocal(),n}}],[{key:"segmentFromSpec",value:function(e){var t=mn.fromJSONObject(e);if(t)return t;var n=yn.fromJSONObject(e);if(n)return n;throw new Error("Unrecognized IJSONObject: '".concat(JSON.stringify(e),"'"))}}]),e}();An.Type="https://graph.microsoft.com/types/mergeTree/sparse-matrix",An.Attributes={type:An.Type,snapshotFormatVersion:"0.1",packageVersion:un};var Rn="header",_n=function(){function e(){(0,g.Z)(this,e)}return(0,m.Z)(e,[{key:"type",get:function(){return e.Type}},{key:"attributes",get:function(){return e.Attributes}},{key:"load",value:function(){var e=(0,vt.Z)((0,pt.Z)().mark((function e(t,n,r,i){var o;return(0,pt.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=new Pn(n,t,i),e.next=3,o.load(r);case 3:return e.abrupt("return",o);case 4:case"end":return e.stop()}}),e)})));return function(t,n,r,i){return e.apply(this,arguments)}}()},{key:"create",value:function(e,t){var n=new Pn(t,e,this.attributes);return n.initializeLocal(),n}}]),e}();_n.Type="https://graph.microsoft.com/types/sharedIntervalCollection",_n.Attributes={type:_n.Type,snapshotFormatVersion:"0.1",packageVersion:un};var Pn=function(e){(0,p.Z)(n,e);var t=(0,v.Z)(n);function n(e,r,i){var o;return(0,g.Z)(this,n),(o=t.call(this,e,r,i,"fluid_sharedIntervalCollection_"))[Tn]="SharedIntervalCollection",o.intervalCollections=new Xt(o.serializer,o.handle,(function(e,t){return o.submitLocalMessage(e,t)}),new Ee),o}return(0,m.Z)(n,[{key:"waitIntervalCollection",value:function(){var e=(0,vt.Z)((0,pt.Z)().mark((function e(t){return(0,pt.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.intervalCollections.get(this.getIntervalCollectionPath(t)));case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getIntervalCollection",value:function(e){var t=this.getIntervalCollectionPath(e);return this.intervalCollections.get(t)}},{key:"summarizeCore",value:function(e){return(0,Wt.Ho)(Rn,this.intervalCollections.serialize(e))}},{key:"reSubmitCore",value:function(e,t){this.intervalCollections.tryResubmitMessage(e,t)}},{key:"onDisconnect",value:function(){}},{key:"loadCore",value:function(){var e=(0,vt.Z)((0,pt.Z)().mark((function e(t){var n,r;return(0,pt.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.readBlob(Rn);case 2:n=e.sent,r=bt(n,"utf8"),this.intervalCollections.populate(r);case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"processCore",value:function(e,t,n){e.type===St.Operation&&this.intervalCollections.tryProcessMessage(e.contents,t,e,n)}},{key:"getIntervalCollectionPath",value:function(e){return e}},{key:"applyStashedOp",value:function(){throw new Error("not implemented")}}],[{key:"create",value:function(e,t){return e.createChannel(t,_n.Type)}},{key:"getFactory",value:function(){return new _n}}]),n}(Jt.h);Tn=Symbol.toStringTag},30222:function(e){"use strict";var t=Array.prototype.slice,n=Object.prototype.toString;e.exports=function(e){var r=this;if("function"!==typeof r||"[object Function]"!==n.call(r))throw new TypeError("Function.prototype.bind called on incompatible "+r);for(var i,o=t.call(arguments,1),a=Math.max(0,r.length-o.length),s=[],u=0;u<a;u++)s.push("$"+u);if(i=Function("binder","return function ("+s.join(",")+"){ return binder.apply(this,arguments); }")((function(){if(this instanceof i){var n=r.apply(this,o.concat(t.call(arguments)));return Object(n)===n?n:this}return r.apply(e,o.concat(t.call(arguments)))})),r.prototype){var c=function(){};c.prototype=r.prototype,i.prototype=new c,c.prototype=null}return i}},33350:function(e,t,n){"use strict";var r=n(30222);e.exports=Function.prototype.bind||r},52506:function(e,t,n){"use strict";var r,i=SyntaxError,o=Function,a=TypeError,s=function(e){try{return o('"use strict"; return ('+e+").constructor;")()}catch(t){}},u=Object.getOwnPropertyDescriptor;if(u)try{u({},"")}catch(_){u=null}var c=function(){throw new a},l=u?function(){try{return c}catch(e){try{return u(arguments,"callee").get}catch(t){return c}}}():c,d=n(80697)(),h=n(92203)(),f=Object.getPrototypeOf||(h?function(e){return e.__proto__}:null),p={},v="undefined"!==typeof Uint8Array&&f?f(Uint8Array):r,g={"%AggregateError%":"undefined"===typeof AggregateError?r:AggregateError,"%Array%":Array,"%ArrayBuffer%":"undefined"===typeof ArrayBuffer?r:ArrayBuffer,"%ArrayIteratorPrototype%":d&&f?f([][Symbol.iterator]()):r,"%AsyncFromSyncIteratorPrototype%":r,"%AsyncFunction%":p,"%AsyncGenerator%":p,"%AsyncGeneratorFunction%":p,"%AsyncIteratorPrototype%":p,"%Atomics%":"undefined"===typeof Atomics?r:Atomics,"%BigInt%":"undefined"===typeof BigInt?r:BigInt,"%BigInt64Array%":"undefined"===typeof BigInt64Array?r:BigInt64Array,"%BigUint64Array%":"undefined"===typeof BigUint64Array?r:BigUint64Array,"%Boolean%":Boolean,"%DataView%":"undefined"===typeof DataView?r:DataView,"%Date%":Date,"%decodeURI%":decodeURI,"%decodeURIComponent%":decodeURIComponent,"%encodeURI%":encodeURI,"%encodeURIComponent%":encodeURIComponent,"%Error%":Error,"%eval%":eval,"%EvalError%":EvalError,"%Float32Array%":"undefined"===typeof Float32Array?r:Float32Array,"%Float64Array%":"undefined"===typeof Float64Array?r:Float64Array,"%FinalizationRegistry%":"undefined"===typeof FinalizationRegistry?r:FinalizationRegistry,"%Function%":o,"%GeneratorFunction%":p,"%Int8Array%":"undefined"===typeof Int8Array?r:Int8Array,"%Int16Array%":"undefined"===typeof Int16Array?r:Int16Array,"%Int32Array%":"undefined"===typeof Int32Array?r:Int32Array,"%isFinite%":isFinite,"%isNaN%":isNaN,"%IteratorPrototype%":d&&f?f(f([][Symbol.iterator]())):r,"%JSON%":"object"===typeof JSON?JSON:r,"%Map%":"undefined"===typeof Map?r:Map,"%MapIteratorPrototype%":"undefined"!==typeof Map&&d&&f?f((new Map)[Symbol.iterator]()):r,"%Math%":Math,"%Number%":Number,"%Object%":Object,"%parseFloat%":parseFloat,"%parseInt%":parseInt,"%Promise%":"undefined"===typeof Promise?r:Promise,"%Proxy%":"undefined"===typeof Proxy?r:Proxy,"%RangeError%":RangeError,"%ReferenceError%":ReferenceError,"%Reflect%":"undefined"===typeof Reflect?r:Reflect,"%RegExp%":RegExp,"%Set%":"undefined"===typeof Set?r:Set,"%SetIteratorPrototype%":"undefined"!==typeof Set&&d&&f?f((new Set)[Symbol.iterator]()):r,"%SharedArrayBuffer%":"undefined"===typeof SharedArrayBuffer?r:SharedArrayBuffer,"%String%":String,"%StringIteratorPrototype%":d&&f?f(""[Symbol.iterator]()):r,"%Symbol%":d?Symbol:r,"%SyntaxError%":i,"%ThrowTypeError%":l,"%TypedArray%":v,"%TypeError%":a,"%Uint8Array%":"undefined"===typeof Uint8Array?r:Uint8Array,"%Uint8ClampedArray%":"undefined"===typeof Uint8ClampedArray?r:Uint8ClampedArray,"%Uint16Array%":"undefined"===typeof Uint16Array?r:Uint16Array,"%Uint32Array%":"undefined"===typeof Uint32Array?r:Uint32Array,"%URIError%":URIError,"%WeakMap%":"undefined"===typeof WeakMap?r:WeakMap,"%WeakRef%":"undefined"===typeof WeakRef?r:WeakRef,"%WeakSet%":"undefined"===typeof WeakSet?r:WeakSet};if(f)try{null.error}catch(_){var m=f(f(_));g["%Error.prototype%"]=m}var y=function e(t){var n;if("%AsyncFunction%"===t)n=s("async function () {}");else if("%GeneratorFunction%"===t)n=s("function* () {}");else if("%AsyncGeneratorFunction%"===t)n=s("async function* () {}");else if("%AsyncGenerator%"===t){var r=e("%AsyncGeneratorFunction%");r&&(n=r.prototype)}else if("%AsyncIteratorPrototype%"===t){var i=e("%AsyncGenerator%");i&&f&&(n=f(i.prototype))}return g[t]=n,n},b={"%ArrayBufferPrototype%":["ArrayBuffer","prototype"],"%ArrayPrototype%":["Array","prototype"],"%ArrayProto_entries%":["Array","prototype","entries"],"%ArrayProto_forEach%":["Array","prototype","forEach"],"%ArrayProto_keys%":["Array","prototype","keys"],"%ArrayProto_values%":["Array","prototype","values"],"%AsyncFunctionPrototype%":["AsyncFunction","prototype"],"%AsyncGenerator%":["AsyncGeneratorFunction","prototype"],"%AsyncGeneratorPrototype%":["AsyncGeneratorFunction","prototype","prototype"],"%BooleanPrototype%":["Boolean","prototype"],"%DataViewPrototype%":["DataView","prototype"],"%DatePrototype%":["Date","prototype"],"%ErrorPrototype%":["Error","prototype"],"%EvalErrorPrototype%":["EvalError","prototype"],"%Float32ArrayPrototype%":["Float32Array","prototype"],"%Float64ArrayPrototype%":["Float64Array","prototype"],"%FunctionPrototype%":["Function","prototype"],"%Generator%":["GeneratorFunction","prototype"],"%GeneratorPrototype%":["GeneratorFunction","prototype","prototype"],"%Int8ArrayPrototype%":["Int8Array","prototype"],"%Int16ArrayPrototype%":["Int16Array","prototype"],"%Int32ArrayPrototype%":["Int32Array","prototype"],"%JSONParse%":["JSON","parse"],"%JSONStringify%":["JSON","stringify"],"%MapPrototype%":["Map","prototype"],"%NumberPrototype%":["Number","prototype"],"%ObjectPrototype%":["Object","prototype"],"%ObjProto_toString%":["Object","prototype","toString"],"%ObjProto_valueOf%":["Object","prototype","valueOf"],"%PromisePrototype%":["Promise","prototype"],"%PromiseProto_then%":["Promise","prototype","then"],"%Promise_all%":["Promise","all"],"%Promise_reject%":["Promise","reject"],"%Promise_resolve%":["Promise","resolve"],"%RangeErrorPrototype%":["RangeError","prototype"],"%ReferenceErrorPrototype%":["ReferenceError","prototype"],"%RegExpPrototype%":["RegExp","prototype"],"%SetPrototype%":["Set","prototype"],"%SharedArrayBufferPrototype%":["SharedArrayBuffer","prototype"],"%StringPrototype%":["String","prototype"],"%SymbolPrototype%":["Symbol","prototype"],"%SyntaxErrorPrototype%":["SyntaxError","prototype"],"%TypedArrayPrototype%":["TypedArray","prototype"],"%TypeErrorPrototype%":["TypeError","prototype"],"%Uint8ArrayPrototype%":["Uint8Array","prototype"],"%Uint8ClampedArrayPrototype%":["Uint8ClampedArray","prototype"],"%Uint16ArrayPrototype%":["Uint16Array","prototype"],"%Uint32ArrayPrototype%":["Uint32Array","prototype"],"%URIErrorPrototype%":["URIError","prototype"],"%WeakMapPrototype%":["WeakMap","prototype"],"%WeakSetPrototype%":["WeakSet","prototype"]},w=n(33350),S=n(58316),k=w.call(Function.call,Array.prototype.concat),C=w.call(Function.apply,Array.prototype.splice),x=w.call(Function.call,String.prototype.replace),E=w.call(Function.call,String.prototype.slice),T=w.call(Function.call,RegExp.prototype.exec),I=/[^%.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|%$))/g,A=/\\(\\)?/g,R=function(e,t){var n,r=e;if(S(b,r)&&(r="%"+(n=b[r])[0]+"%"),S(g,r)){var o=g[r];if(o===p&&(o=y(r)),"undefined"===typeof o&&!t)throw new a("intrinsic "+e+" exists, but is not available. Please file an issue!");return{alias:n,name:r,value:o}}throw new i("intrinsic "+e+" does not exist!")};e.exports=function(e,t){if("string"!==typeof e||0===e.length)throw new a("intrinsic name must be a non-empty string");if(arguments.length>1&&"boolean"!==typeof t)throw new a('"allowMissing" argument must be a boolean');if(null===T(/^%?[^%]*%?$/,e))throw new i("`%` may not be present anywhere but at the beginning and end of the intrinsic name");var n=function(e){var t=E(e,0,1),n=E(e,-1);if("%"===t&&"%"!==n)throw new i("invalid intrinsic syntax, expected closing `%`");if("%"===n&&"%"!==t)throw new i("invalid intrinsic syntax, expected opening `%`");var r=[];return x(e,I,(function(e,t,n,i){r[r.length]=n?x(i,A,"$1"):t||e})),r}(e),r=n.length>0?n[0]:"",o=R("%"+r+"%",t),s=o.name,c=o.value,l=!1,d=o.alias;d&&(r=d[0],C(n,k([0,1],d)));for(var h=1,f=!0;h<n.length;h+=1){var p=n[h],v=E(p,0,1),m=E(p,-1);if(('"'===v||"'"===v||"`"===v||'"'===m||"'"===m||"`"===m)&&v!==m)throw new i("property names with quotes must have matching quotes");if("constructor"!==p&&f||(l=!0),S(g,s="%"+(r+="."+p)+"%"))c=g[s];else if(null!=c){if(!(p in c)){if(!t)throw new a("base intrinsic for "+e+" exists, but the property is not available.");return}if(u&&h+1>=n.length){var y=u(c,p);c=(f=!!y)&&"get"in y&&!("originalValue"in y.get)?y.get:c[p]}else f=S(c,p),c=c[p];f&&!l&&(g[s]=c)}}return c}},92203:function(e){"use strict";var t={foo:{}},n=Object;e.exports=function(){return{__proto__:t}.foo===t.foo&&!({__proto__:null}instanceof n)}},80697:function(e,t,n){"use strict";var r="undefined"!==typeof Symbol&&Symbol,i=n(63297);e.exports=function(){return"function"===typeof r&&("function"===typeof Symbol&&("symbol"===typeof r("foo")&&("symbol"===typeof Symbol("bar")&&i())))}},63297:function(e){"use strict";e.exports=function(){if("function"!==typeof Symbol||"function"!==typeof Object.getOwnPropertySymbols)return!1;if("symbol"===typeof Symbol.iterator)return!0;var e={},t=Symbol("test"),n=Object(t);if("string"===typeof t)return!1;if("[object Symbol]"!==Object.prototype.toString.call(t))return!1;if("[object Symbol]"!==Object.prototype.toString.call(n))return!1;for(t in e[t]=42,e)return!1;if("function"===typeof Object.keys&&0!==Object.keys(e).length)return!1;if("function"===typeof Object.getOwnPropertyNames&&0!==Object.getOwnPropertyNames(e).length)return!1;var r=Object.getOwnPropertySymbols(e);if(1!==r.length||r[0]!==t)return!1;if(!Object.prototype.propertyIsEnumerable.call(e,t))return!1;if("function"===typeof Object.getOwnPropertyDescriptor){var i=Object.getOwnPropertyDescriptor(e,t);if(42!==i.value||!0!==i.enumerable)return!1}return!0}},58316:function(e,t,n){"use strict";var r=n(33350);e.exports=r.call(Function.call,Object.prototype.hasOwnProperty)},72451:function(e,t){function n(e,t){var n=[],r=[];return null==t&&(t=function(e,t){return n[0]===t?"[Circular ~]":"[Circular ~."+r.slice(0,n.indexOf(t)).join(".")+"]"}),function(i,o){if(n.length>0){var a=n.indexOf(this);~a?n.splice(a+1):n.push(this),~a?r.splice(a,1/0,i):r.push(i),~n.indexOf(o)&&(o=t.call(this,i,o))}else n.push(o);return null==e?o:e.call(this,i,o)}}(e.exports=function(e,t,r,i){return JSON.stringify(e,n(t,i),r)}).getSerialize=n},6313:function(e,t){var n={userAgent:!1},r={},i=i||function(e,t){var n={},r=n.lib={},i=r.Base=function(){function e(){}return{extend:function(t){e.prototype=this;var n=new e;return t&&n.mixIn(t),n.hasOwnProperty("init")||(n.init=function(){n.$super.init.apply(this,arguments)}),n.init.prototype=n,n.$super=this,n},create:function(){var e=this.extend();return e.init.apply(e,arguments),e},init:function(){},mixIn:function(e){for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t]);e.hasOwnProperty("toString")&&(this.toString=e.toString)},clone:function(){return this.init.prototype.extend(this)}}}(),o=r.WordArray=i.extend({init:function(e,t){e=this.words=e||[],this.sigBytes=undefined!=t?t:4*e.length},toString:function(e){return(e||s).stringify(this)},concat:function(e){var t=this.words,n=e.words,r=this.sigBytes,i=e.sigBytes;if(this.clamp(),r%4)for(var o=0;o<i;o++){var a=n[o>>>2]>>>24-o%4*8&255;t[r+o>>>2]|=a<<24-(r+o)%4*8}else for(o=0;o<i;o+=4)t[r+o>>>2]=n[o>>>2];return this.sigBytes+=i,this},clamp:function(){var t=this.words,n=this.sigBytes;t[n>>>2]&=4294967295<<32-n%4*8,t.length=e.ceil(n/4)},clone:function(){var e=i.clone.call(this);return e.words=this.words.slice(0),e},random:function(t){for(var n=[],r=0;r<t;r+=4)n.push(4294967296*e.random()|0);return new o.init(n,t)}}),a=n.enc={},s=a.Hex={stringify:function(e){for(var t=e.words,n=e.sigBytes,r=[],i=0;i<n;i++){var o=t[i>>>2]>>>24-i%4*8&255;r.push((o>>>4).toString(16)),r.push((15&o).toString(16))}return r.join("")},parse:function(e){for(var t=e.length,n=[],r=0;r<t;r+=2)n[r>>>3]|=parseInt(e.substr(r,2),16)<<24-r%8*4;return new o.init(n,t/2)}},u=a.Latin1={stringify:function(e){for(var t=e.words,n=e.sigBytes,r=[],i=0;i<n;i++){var o=t[i>>>2]>>>24-i%4*8&255;r.push(String.fromCharCode(o))}return r.join("")},parse:function(e){for(var t=e.length,n=[],r=0;r<t;r++)n[r>>>2]|=(255&e.charCodeAt(r))<<24-r%4*8;return new o.init(n,t)}},c=a.Utf8={stringify:function(e){try{return decodeURIComponent(escape(u.stringify(e)))}catch(t){throw new Error("Malformed UTF-8 data")}},parse:function(e){return u.parse(unescape(encodeURIComponent(e)))}},l=r.BufferedBlockAlgorithm=i.extend({reset:function(){this._data=new o.init,this._nDataBytes=0},_append:function(e){"string"==typeof e&&(e=c.parse(e)),this._data.concat(e),this._nDataBytes+=e.sigBytes},_process:function(t){var n=this._data,r=n.words,i=n.sigBytes,a=this.blockSize,s=i/(4*a),u=(s=t?e.ceil(s):e.max((0|s)-this._minBufferSize,0))*a,c=e.min(4*u,i);if(u){for(var l=0;l<u;l+=a)this._doProcessBlock(r,l);var d=r.splice(0,u);n.sigBytes-=c}return new o.init(d,c)},clone:function(){var e=i.clone.call(this);return e._data=this._data.clone(),e},_minBufferSize:0}),d=(r.Hasher=l.extend({cfg:i.extend(),init:function(e){this.cfg=this.cfg.extend(e),this.reset()},reset:function(){l.reset.call(this),this._doReset()},update:function(e){return this._append(e),this._process(),this},finalize:function(e){return e&&this._append(e),this._doFinalize()},blockSize:16,_createHelper:function(e){return function(t,n){return new e.init(n).finalize(t)}},_createHmacHelper:function(e){return function(t,n){return new d.HMAC.init(e,n).finalize(t)}}}),n.algo={});return n}(Math);!function(e){var t,n=(t=i).lib,r=n.Base,o=n.WordArray;(t=t.x64={}).Word=r.extend({init:function(e,t){this.high=e,this.low=t}}),t.WordArray=r.extend({init:function(e,t){e=this.words=e||[],this.sigBytes=undefined!=t?t:8*e.length},toX32:function(){for(var e=this.words,t=e.length,n=[],r=0;r<t;r++){var i=e[r];n.push(i.high),n.push(i.low)}return o.create(n,this.sigBytes)},clone:function(){for(var e=r.clone.call(this),t=e.words=this.words.slice(0),n=t.length,i=0;i<n;i++)t[i]=t[i].clone();return e}})}(),i.lib.Cipher||function(e){var t=(p=i).lib,n=t.Base,r=t.WordArray,o=t.BufferedBlockAlgorithm,a=p.enc.Base64,s=p.algo.EvpKDF,u=t.Cipher=o.extend({cfg:n.extend(),createEncryptor:function(e,t){return this.create(this._ENC_XFORM_MODE,e,t)},createDecryptor:function(e,t){return this.create(this._DEC_XFORM_MODE,e,t)},init:function(e,t,n){this.cfg=this.cfg.extend(n),this._xformMode=e,this._key=t,this.reset()},reset:function(){o.reset.call(this),this._doReset()},process:function(e){return this._append(e),this._process()},finalize:function(e){return e&&this._append(e),this._doFinalize()},keySize:4,ivSize:4,_ENC_XFORM_MODE:1,_DEC_XFORM_MODE:2,_createHelper:function(e){return{encrypt:function(t,n,r){return("string"==typeof n?v:f).encrypt(e,t,n,r)},decrypt:function(t,n,r){return("string"==typeof n?v:f).decrypt(e,t,n,r)}}}});t.StreamCipher=u.extend({_doFinalize:function(){return this._process(!0)},blockSize:1});var c=p.mode={},l=function(e,t,n){var r=this._iv;r?this._iv=undefined:r=this._prevBlock;for(var i=0;i<n;i++)e[t+i]^=r[i]},d=(t.BlockCipherMode=n.extend({createEncryptor:function(e,t){return this.Encryptor.create(e,t)},createDecryptor:function(e,t){return this.Decryptor.create(e,t)},init:function(e,t){this._cipher=e,this._iv=t}})).extend();d.Encryptor=d.extend({processBlock:function(e,t){var n=this._cipher,r=n.blockSize;l.call(this,e,t,r),n.encryptBlock(e,t),this._prevBlock=e.slice(t,t+r)}}),d.Decryptor=d.extend({processBlock:function(e,t){var n=this._cipher,r=n.blockSize,i=e.slice(t,t+r);n.decryptBlock(e,t),l.call(this,e,t,r),this._prevBlock=i}}),c=c.CBC=d,d=(p.pad={}).Pkcs7={pad:function(e,t){for(var n,i=(n=(n=4*t)-e.sigBytes%n)<<24|n<<16|n<<8|n,o=[],a=0;a<n;a+=4)o.push(i);n=r.create(o,n),e.concat(n)},unpad:function(e){e.sigBytes-=255&e.words[e.sigBytes-1>>>2]}},t.BlockCipher=u.extend({cfg:u.cfg.extend({mode:c,padding:d}),reset:function(){u.reset.call(this);var e=(t=this.cfg).iv,t=t.mode;if(this._xformMode==this._ENC_XFORM_MODE)var n=t.createEncryptor;else n=t.createDecryptor,this._minBufferSize=1;this._mode=n.call(t,this,e&&e.words)},_doProcessBlock:function(e,t){this._mode.processBlock(e,t)},_doFinalize:function(){var e=this.cfg.padding;if(this._xformMode==this._ENC_XFORM_MODE){e.pad(this._data,this.blockSize);var t=this._process(!0)}else t=this._process(!0),e.unpad(t);return t},blockSize:4});var h=t.CipherParams=n.extend({init:function(e){this.mixIn(e)},toString:function(e){return(e||this.formatter).stringify(this)}}),f=(c=(p.format={}).OpenSSL={stringify:function(e){var t=e.ciphertext;return((e=e.salt)?r.create([1398893684,1701076831]).concat(e).concat(t):t).toString(a)},parse:function(e){var t=(e=a.parse(e)).words;if(1398893684==t[0]&&1701076831==t[1]){var n=r.create(t.slice(2,4));t.splice(0,4),e.sigBytes-=16}return h.create({ciphertext:e,salt:n})}},t.SerializableCipher=n.extend({cfg:n.extend({format:c}),encrypt:function(e,t,n,r){r=this.cfg.extend(r);var i=e.createEncryptor(n,r);return t=i.finalize(t),i=i.cfg,h.create({ciphertext:t,key:n,iv:i.iv,algorithm:e,mode:i.mode,padding:i.padding,blockSize:e.blockSize,formatter:r.format})},decrypt:function(e,t,n,r){return r=this.cfg.extend(r),t=this._parse(t,r.format),e.createDecryptor(n,r).finalize(t.ciphertext)},_parse:function(e,t){return"string"==typeof e?t.parse(e,this):e}})),p=(p.kdf={}).OpenSSL={execute:function(e,t,n,i){return i||(i=r.random(8)),e=s.create({keySize:t+n}).compute(e,i),n=r.create(e.words.slice(t),4*n),e.sigBytes=4*t,h.create({key:e,iv:n,salt:i})}},v=t.PasswordBasedCipher=f.extend({cfg:f.cfg.extend({kdf:p}),encrypt:function(e,t,n,r){return n=(r=this.cfg.extend(r)).kdf.execute(n,e.keySize,e.ivSize),r.iv=n.iv,(e=f.encrypt.call(this,e,t,n.key,r)).mixIn(n),e},decrypt:function(e,t,n,r){return r=this.cfg.extend(r),t=this._parse(t,r.format),n=r.kdf.execute(n,e.keySize,e.ivSize,t.salt),r.iv=n.iv,f.decrypt.call(this,e,t,n.key,r)}})}(),function(){for(var e=i,t=e.lib.BlockCipher,n=e.algo,r=[],o=[],a=[],s=[],u=[],c=[],l=[],d=[],h=[],f=[],p=[],v=0;256>v;v++)p[v]=128>v?v<<1:v<<1^283;var g=0,m=0;for(v=0;256>v;v++){var y=(y=m^m<<1^m<<2^m<<3^m<<4)>>>8^255&y^99;r[g]=y,o[y]=g;var b=p[g],w=p[b],S=p[w],k=257*p[y]^16843008*y;a[g]=k<<24|k>>>8,s[g]=k<<16|k>>>16,u[g]=k<<8|k>>>24,c[g]=k,k=16843009*S^65537*w^257*b^16843008*g,l[y]=k<<24|k>>>8,d[y]=k<<16|k>>>16,h[y]=k<<8|k>>>24,f[y]=k,g?(g=b^p[p[p[S^b]]],m^=p[p[m]]):g=m=1}var C=[0,1,2,4,8,16,32,64,128,27,54];n=n.AES=t.extend({_doReset:function(){for(var e=(n=this._key).words,t=n.sigBytes/4,n=4*((this._nRounds=t+6)+1),i=this._keySchedule=[],o=0;o<n;o++)if(o<t)i[o]=e[o];else{var a=i[o-1];o%t?6<t&&4==o%t&&(a=r[a>>>24]<<24|r[a>>>16&255]<<16|r[a>>>8&255]<<8|r[255&a]):(a=r[(a=a<<8|a>>>24)>>>24]<<24|r[a>>>16&255]<<16|r[a>>>8&255]<<8|r[255&a],a^=C[o/t|0]<<24),i[o]=i[o-t]^a}for(e=this._invKeySchedule=[],t=0;t<n;t++)o=n-t,a=t%4?i[o]:i[o-4],e[t]=4>t||4>=o?a:l[r[a>>>24]]^d[r[a>>>16&255]]^h[r[a>>>8&255]]^f[r[255&a]]},encryptBlock:function(e,t){this._doCryptBlock(e,t,this._keySchedule,a,s,u,c,r)},decryptBlock:function(e,t){var n=e[t+1];e[t+1]=e[t+3],e[t+3]=n,this._doCryptBlock(e,t,this._invKeySchedule,l,d,h,f,o),n=e[t+1],e[t+1]=e[t+3],e[t+3]=n},_doCryptBlock:function(e,t,n,r,i,o,a,s){for(var u=this._nRounds,c=e[t]^n[0],l=e[t+1]^n[1],d=e[t+2]^n[2],h=e[t+3]^n[3],f=4,p=1;p<u;p++){var v=r[c>>>24]^i[l>>>16&255]^o[d>>>8&255]^a[255&h]^n[f++],g=r[l>>>24]^i[d>>>16&255]^o[h>>>8&255]^a[255&c]^n[f++],m=r[d>>>24]^i[h>>>16&255]^o[c>>>8&255]^a[255&l]^n[f++];h=r[h>>>24]^i[c>>>16&255]^o[l>>>8&255]^a[255&d]^n[f++],c=v,l=g,d=m}v=(s[c>>>24]<<24|s[l>>>16&255]<<16|s[d>>>8&255]<<8|s[255&h])^n[f++],g=(s[l>>>24]<<24|s[d>>>16&255]<<16|s[h>>>8&255]<<8|s[255&c])^n[f++],m=(s[d>>>24]<<24|s[h>>>16&255]<<16|s[c>>>8&255]<<8|s[255&l])^n[f++],h=(s[h>>>24]<<24|s[c>>>16&255]<<16|s[l>>>8&255]<<8|s[255&d])^n[f++],e[t]=v,e[t+1]=g,e[t+2]=m,e[t+3]=h},keySize:8});e.AES=t._createHelper(n)}(),function(){function e(e,t){var n=(this._lBlock>>>e^this._rBlock)&t;this._rBlock^=n,this._lBlock^=n<<e}function t(e,t){var n=(this._rBlock>>>e^this._lBlock)&t;this._lBlock^=n,this._rBlock^=n<<e}var n=i,r=(o=n.lib).WordArray,o=o.BlockCipher,a=n.algo,s=[57,49,41,33,25,17,9,1,58,50,42,34,26,18,10,2,59,51,43,35,27,19,11,3,60,52,44,36,63,55,47,39,31,23,15,7,62,54,46,38,30,22,14,6,61,53,45,37,29,21,13,5,28,20,12,4],u=[14,17,11,24,1,5,3,28,15,6,21,10,23,19,12,4,26,8,16,7,27,20,13,2,41,52,31,37,47,55,30,40,51,45,33,48,44,49,39,56,34,53,46,42,50,36,29,32],c=[1,2,4,6,8,10,12,14,15,17,19,21,23,25,27,28],l=[{0:8421888,268435456:32768,536870912:8421378,805306368:2,1073741824:512,1342177280:8421890,1610612736:8389122,1879048192:8388608,2147483648:514,2415919104:8389120,2684354560:33280,2952790016:8421376,3221225472:32770,3489660928:8388610,3758096384:0,4026531840:33282,134217728:0,402653184:8421890,671088640:33282,939524096:32768,1207959552:8421888,1476395008:512,1744830464:8421378,2013265920:2,2281701376:8389120,2550136832:33280,2818572288:8421376,3087007744:8389122,3355443200:8388610,3623878656:32770,3892314112:514,4160749568:8388608,1:32768,268435457:2,536870913:8421888,805306369:8388608,1073741825:8421378,1342177281:33280,1610612737:512,1879048193:8389122,2147483649:8421890,2415919105:8421376,2684354561:8388610,2952790017:33282,3221225473:514,3489660929:8389120,3758096385:32770,4026531841:0,134217729:8421890,402653185:8421376,671088641:8388608,939524097:512,1207959553:32768,1476395009:8388610,1744830465:2,2013265921:33282,2281701377:32770,2550136833:8389122,2818572289:514,3087007745:8421888,3355443201:8389120,3623878657:0,3892314113:33280,4160749569:8421378},{0:1074282512,16777216:16384,33554432:524288,50331648:1074266128,67108864:1073741840,83886080:1074282496,100663296:1073758208,117440512:16,134217728:540672,150994944:1073758224,167772160:1073741824,184549376:540688,201326592:524304,218103808:0,234881024:16400,251658240:1074266112,8388608:1073758208,25165824:540688,41943040:16,58720256:1073758224,75497472:1074282512,92274688:1073741824,109051904:524288,125829120:1074266128,142606336:524304,159383552:0,176160768:16384,192937984:1074266112,209715200:1073741840,226492416:540672,243269632:1074282496,260046848:16400,268435456:0,285212672:1074266128,301989888:1073758224,318767104:1074282496,335544320:1074266112,352321536:16,369098752:540688,385875968:16384,402653184:16400,419430400:524288,436207616:524304,452984832:1073741840,469762048:540672,486539264:1073758208,503316480:1073741824,520093696:1074282512,276824064:540688,293601280:524288,310378496:1074266112,327155712:16384,343932928:1073758208,360710144:1074282512,377487360:16,394264576:1073741824,411041792:1074282496,427819008:1073741840,444596224:1073758224,461373440:524304,478150656:0,494927872:16400,511705088:1074266128,528482304:540672},{0:260,1048576:0,2097152:67109120,3145728:65796,4194304:65540,5242880:67108868,6291456:67174660,7340032:67174400,8388608:67108864,9437184:67174656,10485760:65792,11534336:67174404,12582912:67109124,13631488:65536,14680064:4,15728640:256,524288:67174656,1572864:67174404,2621440:0,3670016:67109120,4718592:67108868,5767168:65536,6815744:65540,7864320:260,8912896:4,9961472:256,11010048:67174400,12058624:65796,13107200:65792,14155776:67109124,15204352:67174660,16252928:67108864,16777216:67174656,17825792:65540,18874368:65536,19922944:67109120,20971520:256,22020096:67174660,23068672:67108868,24117248:0,25165824:67109124,26214400:67108864,27262976:4,28311552:65792,29360128:67174400,30408704:260,31457280:65796,32505856:67174404,17301504:67108864,18350080:260,19398656:67174656,20447232:0,21495808:65540,22544384:67109120,23592960:256,24641536:67174404,25690112:65536,26738688:67174660,27787264:65796,28835840:67108868,29884416:67109124,30932992:67174400,31981568:4,33030144:65792},{0:2151682048,65536:2147487808,131072:4198464,196608:2151677952,262144:0,327680:4198400,393216:2147483712,458752:4194368,524288:2147483648,589824:4194304,655360:64,720896:2147487744,786432:2151678016,851968:4160,917504:4096,983040:2151682112,32768:2147487808,98304:64,163840:2151678016,229376:2147487744,294912:4198400,360448:2151682112,425984:0,491520:2151677952,557056:4096,622592:2151682048,688128:4194304,753664:4160,819200:2147483648,884736:4194368,950272:4198464,1015808:2147483712,1048576:4194368,1114112:4198400,1179648:2147483712,1245184:0,1310720:4160,1376256:2151678016,1441792:2151682048,1507328:2147487808,1572864:2151682112,1638400:2147483648,1703936:2151677952,1769472:4198464,1835008:2147487744,1900544:4194304,1966080:64,2031616:4096,1081344:2151677952,1146880:2151682112,1212416:0,1277952:4198400,1343488:4194368,1409024:2147483648,1474560:2147487808,1540096:64,1605632:2147483712,1671168:4096,1736704:2147487744,1802240:2151678016,1867776:4160,1933312:2151682048,1998848:4194304,2064384:4198464},{0:128,4096:17039360,8192:262144,12288:536870912,16384:537133184,20480:16777344,24576:553648256,28672:262272,32768:16777216,36864:537133056,40960:536871040,45056:553910400,49152:553910272,53248:0,57344:17039488,61440:553648128,2048:17039488,6144:553648256,10240:128,14336:17039360,18432:262144,22528:537133184,26624:553910272,30720:536870912,34816:537133056,38912:0,43008:553910400,47104:16777344,51200:536871040,55296:553648128,59392:16777216,63488:262272,65536:262144,69632:128,73728:536870912,77824:553648256,81920:16777344,86016:553910272,90112:537133184,94208:16777216,98304:553910400,102400:553648128,106496:17039360,110592:537133056,114688:262272,118784:536871040,122880:0,126976:17039488,67584:553648256,71680:16777216,75776:17039360,79872:537133184,83968:536870912,88064:17039488,92160:128,96256:553910272,100352:262272,104448:553910400,108544:0,112640:553648128,116736:16777344,120832:262144,124928:537133056,129024:536871040},{0:268435464,256:8192,512:270532608,768:270540808,1024:268443648,1280:2097152,1536:2097160,1792:268435456,2048:0,2304:268443656,2560:2105344,2816:8,3072:270532616,3328:2105352,3584:8200,3840:270540800,128:270532608,384:270540808,640:8,896:2097152,1152:2105352,1408:268435464,1664:268443648,1920:8200,2176:2097160,2432:8192,2688:268443656,2944:270532616,3200:0,3456:270540800,3712:2105344,3968:268435456,4096:268443648,4352:270532616,4608:270540808,4864:8200,5120:2097152,5376:268435456,5632:268435464,5888:2105344,6144:2105352,6400:0,6656:8,6912:270532608,7168:8192,7424:268443656,7680:270540800,7936:2097160,4224:8,4480:2105344,4736:2097152,4992:268435464,5248:268443648,5504:8200,5760:270540808,6016:270532608,6272:270540800,6528:270532616,6784:8192,7040:2105352,7296:2097160,7552:0,7808:268435456,8064:268443656},{0:1048576,16:33555457,32:1024,48:1049601,64:34604033,80:0,96:1,112:34603009,128:33555456,144:1048577,160:33554433,176:34604032,192:34603008,208:1025,224:1049600,240:33554432,8:34603009,24:0,40:33555457,56:34604032,72:1048576,88:33554433,104:33554432,120:1025,136:1049601,152:33555456,168:34603008,184:1048577,200:1024,216:34604033,232:1,248:1049600,256:33554432,272:1048576,288:33555457,304:34603009,320:1048577,336:33555456,352:34604032,368:1049601,384:1025,400:34604033,416:1049600,432:1,448:0,464:34603008,480:33554433,496:1024,264:1049600,280:33555457,296:34603009,312:1,328:33554432,344:1048576,360:1025,376:34604032,392:33554433,408:34603008,424:0,440:34604033,456:1049601,472:1024,488:33555456,504:1048577},{0:134219808,1:131072,2:134217728,3:32,4:131104,5:134350880,6:134350848,7:2048,8:134348800,9:134219776,10:133120,11:134348832,12:2080,13:0,14:134217760,15:133152,2147483648:2048,2147483649:134350880,2147483650:134219808,2147483651:134217728,2147483652:134348800,2147483653:133120,2147483654:133152,2147483655:32,2147483656:134217760,2147483657:2080,2147483658:131104,2147483659:134350848,2147483660:0,2147483661:134348832,2147483662:134219776,2147483663:131072,16:133152,17:134350848,18:32,19:2048,20:134219776,21:134217760,22:134348832,23:131072,24:0,25:131104,26:134348800,27:134219808,28:134350880,29:133120,30:2080,31:134217728,2147483664:131072,2147483665:2048,2147483666:134348832,2147483667:133152,2147483668:32,2147483669:134348800,2147483670:134217728,2147483671:134219808,2147483672:134350880,2147483673:134217760,2147483674:134219776,2147483675:0,2147483676:133120,2147483677:2080,2147483678:131104,2147483679:134350848}],d=[4160749569,528482304,33030144,2064384,129024,8064,504,2147483679],h=a.DES=o.extend({_doReset:function(){for(var e=this._key.words,t=[],n=0;56>n;n++){var r=s[n]-1;t[n]=e[r>>>5]>>>31-r%32&1}for(e=this._subKeys=[],r=0;16>r;r++){var i=e[r]=[],o=c[r];for(n=0;24>n;n++)i[n/6|0]|=t[(u[n]-1+o)%28]<<31-n%6,i[4+(n/6|0)]|=t[28+(u[n+24]-1+o)%28]<<31-n%6;for(i[0]=i[0]<<1|i[0]>>>31,n=1;7>n;n++)i[n]>>>=4*(n-1)+3;i[7]=i[7]<<5|i[7]>>>27}for(t=this._invSubKeys=[],n=0;16>n;n++)t[n]=e[15-n]},encryptBlock:function(e,t){this._doCryptBlock(e,t,this._subKeys)},decryptBlock:function(e,t){this._doCryptBlock(e,t,this._invSubKeys)},_doCryptBlock:function(n,r,i){this._lBlock=n[r],this._rBlock=n[r+1],e.call(this,4,252645135),e.call(this,16,65535),t.call(this,2,858993459),t.call(this,8,16711935),e.call(this,1,1431655765);for(var o=0;16>o;o++){for(var a=i[o],s=this._lBlock,u=this._rBlock,c=0,h=0;8>h;h++)c|=l[h][((u^a[h])&d[h])>>>0];this._lBlock=u,this._rBlock=s^c}i=this._lBlock,this._lBlock=this._rBlock,this._rBlock=i,e.call(this,1,1431655765),t.call(this,8,16711935),t.call(this,2,858993459),e.call(this,16,65535),e.call(this,4,252645135),n[r]=this._lBlock,n[r+1]=this._rBlock},keySize:2,ivSize:2,blockSize:2});n.DES=o._createHelper(h),a=a.TripleDES=o.extend({_doReset:function(){var e=this._key.words;this._des1=h.createEncryptor(r.create(e.slice(0,2))),this._des2=h.createEncryptor(r.create(e.slice(2,4))),this._des3=h.createEncryptor(r.create(e.slice(4,6)))},encryptBlock:function(e,t){this._des1.encryptBlock(e,t),this._des2.decryptBlock(e,t),this._des3.encryptBlock(e,t)},decryptBlock:function(e,t){this._des3.decryptBlock(e,t),this._des2.encryptBlock(e,t),this._des1.decryptBlock(e,t)},keySize:6,ivSize:2,blockSize:2}),n.TripleDES=o._createHelper(a)}(),function(){var e=i,t=e.lib.WordArray;e.enc.Base64={stringify:function(e){var t=e.words,n=e.sigBytes,r=this._map;e.clamp(),e=[];for(var i=0;i<n;i+=3)for(var o=(t[i>>>2]>>>24-i%4*8&255)<<16|(t[i+1>>>2]>>>24-(i+1)%4*8&255)<<8|t[i+2>>>2]>>>24-(i+2)%4*8&255,a=0;4>a&&i+.75*a<n;a++)e.push(r.charAt(o>>>6*(3-a)&63));if(t=r.charAt(64))for(;e.length%4;)e.push(t);return e.join("")},parse:function(e){var n=e.length,r=this._map;(i=r.charAt(64))&&(-1!=(i=e.indexOf(i))&&(n=i));for(var i=[],o=0,a=0;a<n;a++)if(a%4){var s=r.indexOf(e.charAt(a-1))<<a%4*2,u=r.indexOf(e.charAt(a))>>>6-a%4*2;i[o>>>2]|=(s|u)<<24-o%4*8,o++}return t.create(i,o)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="}}(),function(e){function t(e,t,n,r,i,o,a){return((e=e+(t&n|~t&r)+i+a)<<o|e>>>32-o)+t}function n(e,t,n,r,i,o,a){return((e=e+(t&r|n&~r)+i+a)<<o|e>>>32-o)+t}function r(e,t,n,r,i,o,a){return((e=e+(t^n^r)+i+a)<<o|e>>>32-o)+t}function o(e,t,n,r,i,o,a){return((e=e+(n^(t|~r))+i+a)<<o|e>>>32-o)+t}for(var a=i,s=(c=a.lib).WordArray,u=c.Hasher,c=a.algo,l=[],d=0;64>d;d++)l[d]=4294967296*e.abs(e.sin(d+1))|0;c=c.MD5=u.extend({_doReset:function(){this._hash=new s.init([1732584193,4023233417,2562383102,271733878])},_doProcessBlock:function(e,i){for(var a=0;16>a;a++){var s=e[u=i+a];e[u]=16711935&(s<<8|s>>>24)|4278255360&(s<<24|s>>>8)}a=this._hash.words;var u=e[i+0],c=(s=e[i+1],e[i+2]),d=e[i+3],h=e[i+4],f=e[i+5],p=e[i+6],v=e[i+7],g=e[i+8],m=e[i+9],y=e[i+10],b=e[i+11],w=e[i+12],S=e[i+13],k=e[i+14],C=e[i+15],x=t(x=a[0],I=a[1],T=a[2],E=a[3],u,7,l[0]),E=t(E,x,I,T,s,12,l[1]),T=t(T,E,x,I,c,17,l[2]),I=t(I,T,E,x,d,22,l[3]);x=t(x,I,T,E,h,7,l[4]),E=t(E,x,I,T,f,12,l[5]),T=t(T,E,x,I,p,17,l[6]),I=t(I,T,E,x,v,22,l[7]),x=t(x,I,T,E,g,7,l[8]),E=t(E,x,I,T,m,12,l[9]),T=t(T,E,x,I,y,17,l[10]),I=t(I,T,E,x,b,22,l[11]),x=t(x,I,T,E,w,7,l[12]),E=t(E,x,I,T,S,12,l[13]),T=t(T,E,x,I,k,17,l[14]),x=n(x,I=t(I,T,E,x,C,22,l[15]),T,E,s,5,l[16]),E=n(E,x,I,T,p,9,l[17]),T=n(T,E,x,I,b,14,l[18]),I=n(I,T,E,x,u,20,l[19]),x=n(x,I,T,E,f,5,l[20]),E=n(E,x,I,T,y,9,l[21]),T=n(T,E,x,I,C,14,l[22]),I=n(I,T,E,x,h,20,l[23]),x=n(x,I,T,E,m,5,l[24]),E=n(E,x,I,T,k,9,l[25]),T=n(T,E,x,I,d,14,l[26]),I=n(I,T,E,x,g,20,l[27]),x=n(x,I,T,E,S,5,l[28]),E=n(E,x,I,T,c,9,l[29]),T=n(T,E,x,I,v,14,l[30]),x=r(x,I=n(I,T,E,x,w,20,l[31]),T,E,f,4,l[32]),E=r(E,x,I,T,g,11,l[33]),T=r(T,E,x,I,b,16,l[34]),I=r(I,T,E,x,k,23,l[35]),x=r(x,I,T,E,s,4,l[36]),E=r(E,x,I,T,h,11,l[37]),T=r(T,E,x,I,v,16,l[38]),I=r(I,T,E,x,y,23,l[39]),x=r(x,I,T,E,S,4,l[40]),E=r(E,x,I,T,u,11,l[41]),T=r(T,E,x,I,d,16,l[42]),I=r(I,T,E,x,p,23,l[43]),x=r(x,I,T,E,m,4,l[44]),E=r(E,x,I,T,w,11,l[45]),T=r(T,E,x,I,C,16,l[46]),x=o(x,I=r(I,T,E,x,c,23,l[47]),T,E,u,6,l[48]),E=o(E,x,I,T,v,10,l[49]),T=o(T,E,x,I,k,15,l[50]),I=o(I,T,E,x,f,21,l[51]),x=o(x,I,T,E,w,6,l[52]),E=o(E,x,I,T,d,10,l[53]),T=o(T,E,x,I,y,15,l[54]),I=o(I,T,E,x,s,21,l[55]),x=o(x,I,T,E,g,6,l[56]),E=o(E,x,I,T,C,10,l[57]),T=o(T,E,x,I,p,15,l[58]),I=o(I,T,E,x,S,21,l[59]),x=o(x,I,T,E,h,6,l[60]),E=o(E,x,I,T,b,10,l[61]),T=o(T,E,x,I,c,15,l[62]),I=o(I,T,E,x,m,21,l[63]);a[0]=a[0]+x|0,a[1]=a[1]+I|0,a[2]=a[2]+T|0,a[3]=a[3]+E|0},_doFinalize:function(){var t=this._data,n=t.words,r=8*this._nDataBytes,i=8*t.sigBytes;n[i>>>5]|=128<<24-i%32;var o=e.floor(r/4294967296);for(n[15+(i+64>>>9<<4)]=16711935&(o<<8|o>>>24)|4278255360&(o<<24|o>>>8),n[14+(i+64>>>9<<4)]=16711935&(r<<8|r>>>24)|4278255360&(r<<24|r>>>8),t.sigBytes=4*(n.length+1),this._process(),n=(t=this._hash).words,r=0;4>r;r++)i=n[r],n[r]=16711935&(i<<8|i>>>24)|4278255360&(i<<24|i>>>8);return t},clone:function(){var e=u.clone.call(this);return e._hash=this._hash.clone(),e}}),a.MD5=u._createHelper(c),a.HmacMD5=u._createHmacHelper(c)}(Math),function(){var e=i,t=(o=e.lib).WordArray,n=o.Hasher,r=[],o=e.algo.SHA1=n.extend({_doReset:function(){this._hash=new t.init([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(e,t){for(var n=this._hash.words,i=n[0],o=n[1],a=n[2],s=n[3],u=n[4],c=0;80>c;c++){if(16>c)r[c]=0|e[t+c];else{var l=r[c-3]^r[c-8]^r[c-14]^r[c-16];r[c]=l<<1|l>>>31}l=(i<<5|i>>>27)+u+r[c],l=20>c?l+(1518500249+(o&a|~o&s)):40>c?l+(1859775393+(o^a^s)):60>c?l+((o&a|o&s|a&s)-1894007588):l+((o^a^s)-899497514),u=s,s=a,a=o<<30|o>>>2,o=i,i=l}n[0]=n[0]+i|0,n[1]=n[1]+o|0,n[2]=n[2]+a|0,n[3]=n[3]+s|0,n[4]=n[4]+u|0},_doFinalize:function(){var e=this._data,t=e.words,n=8*this._nDataBytes,r=8*e.sigBytes;return t[r>>>5]|=128<<24-r%32,t[14+(r+64>>>9<<4)]=Math.floor(n/4294967296),t[15+(r+64>>>9<<4)]=n,e.sigBytes=4*t.length,this._process(),this._hash},clone:function(){var e=n.clone.call(this);return e._hash=this._hash.clone(),e}});e.SHA1=n._createHelper(o),e.HmacSHA1=n._createHmacHelper(o)}(),function(e){for(var t=i,n=(o=t.lib).WordArray,r=o.Hasher,o=t.algo,a=[],s=[],u=function(e){return 4294967296*(e-(0|e))|0},c=2,l=0;64>l;){var d;e:{d=c;for(var h=e.sqrt(d),f=2;f<=h;f++)if(!(d%f)){d=!1;break e}d=!0}d&&(8>l&&(a[l]=u(e.pow(c,.5))),s[l]=u(e.pow(c,1/3)),l++),c++}var p=[];o=o.SHA256=r.extend({_doReset:function(){this._hash=new n.init(a.slice(0))},_doProcessBlock:function(e,t){for(var n=this._hash.words,r=n[0],i=n[1],o=n[2],a=n[3],u=n[4],c=n[5],l=n[6],d=n[7],h=0;64>h;h++){if(16>h)p[h]=0|e[t+h];else{var f=p[h-15],v=p[h-2];p[h]=((f<<25|f>>>7)^(f<<14|f>>>18)^f>>>3)+p[h-7]+((v<<15|v>>>17)^(v<<13|v>>>19)^v>>>10)+p[h-16]}f=d+((u<<26|u>>>6)^(u<<21|u>>>11)^(u<<7|u>>>25))+(u&c^~u&l)+s[h]+p[h],v=((r<<30|r>>>2)^(r<<19|r>>>13)^(r<<10|r>>>22))+(r&i^r&o^i&o),d=l,l=c,c=u,u=a+f|0,a=o,o=i,i=r,r=f+v|0}n[0]=n[0]+r|0,n[1]=n[1]+i|0,n[2]=n[2]+o|0,n[3]=n[3]+a|0,n[4]=n[4]+u|0,n[5]=n[5]+c|0,n[6]=n[6]+l|0,n[7]=n[7]+d|0},_doFinalize:function(){var t=this._data,n=t.words,r=8*this._nDataBytes,i=8*t.sigBytes;return n[i>>>5]|=128<<24-i%32,n[14+(i+64>>>9<<4)]=e.floor(r/4294967296),n[15+(i+64>>>9<<4)]=r,t.sigBytes=4*n.length,this._process(),this._hash},clone:function(){var e=r.clone.call(this);return e._hash=this._hash.clone(),e}});t.SHA256=r._createHelper(o),t.HmacSHA256=r._createHmacHelper(o)}(Math),function(){var e=i,t=e.lib.WordArray,n=(r=e.algo).SHA256,r=r.SHA224=n.extend({_doReset:function(){this._hash=new t.init([3238371032,914150663,812702999,4144912697,4290775857,1750603025,1694076839,3204075428])},_doFinalize:function(){var e=n._doFinalize.call(this);return e.sigBytes-=4,e}});e.SHA224=n._createHelper(r),e.HmacSHA224=n._createHmacHelper(r)}(),function(){function e(){return r.create.apply(r,arguments)}for(var t=i,n=t.lib.Hasher,r=(a=t.x64).Word,o=a.WordArray,a=t.algo,s=[e(1116352408,3609767458),e(1899447441,602891725),e(3049323471,3964484399),e(3921009573,2173295548),e(961987163,4081628472),e(1508970993,3053834265),e(2453635748,2937671579),e(2870763221,3664609560),e(3624381080,2734883394),e(310598401,1164996542),e(607225278,1323610764),e(1426881987,3590304994),e(1925078388,4068182383),e(2162078206,991336113),e(2614888103,633803317),e(3248222580,3479774868),e(3835390401,2666613458),e(4022224774,944711139),e(264347078,2341262773),e(604807628,2007800933),e(770255983,1495990901),e(1249150122,1856431235),e(1555081692,3175218132),e(1996064986,2198950837),e(2554220882,3999719339),e(2821834349,766784016),e(2952996808,2566594879),e(3210313671,3203337956),e(3336571891,1034457026),e(3584528711,2466948901),e(113926993,3758326383),e(338241895,168717936),e(666307205,1188179964),e(773529912,1546045734),e(1294757372,1522805485),e(1396182291,2643833823),e(1695183700,2343527390),e(1986661051,1014477480),e(2177026350,1206759142),e(2456956037,344077627),e(2730485921,1290863460),e(2820302411,3158454273),e(3259730800,3505952657),e(3345764771,106217008),e(3516065817,3606008344),e(3600352804,1432725776),e(4094571909,1467031594),e(275423344,851169720),e(430227734,3100823752),e(506948616,1363258195),e(659060556,3750685593),e(883997877,3785050280),e(958139571,3318307427),e(1322822218,3812723403),e(1537002063,2003034995),e(1747873779,3602036899),e(1955562222,1575990012),e(2024104815,1125592928),e(2227730452,2716904306),e(2361852424,442776044),e(2428436474,593698344),e(2756734187,3733110249),e(3204031479,2999351573),e(3329325298,3815920427),e(3391569614,3928383900),e(3515267271,566280711),e(3940187606,3454069534),e(4118630271,4000239992),e(116418474,1914138554),e(174292421,2731055270),e(289380356,3203993006),e(460393269,320620315),e(685471733,587496836),e(852142971,1086792851),e(1017036298,365543100),e(1126000580,2618297676),e(1288033470,3409855158),e(1501505948,4234509866),e(1607167915,987167468),e(1816402316,1246189591)],u=[],c=0;80>c;c++)u[c]=e();a=a.SHA512=n.extend({_doReset:function(){this._hash=new o.init([new r.init(1779033703,4089235720),new r.init(3144134277,2227873595),new r.init(1013904242,4271175723),new r.init(2773480762,1595750129),new r.init(1359893119,2917565137),new r.init(2600822924,725511199),new r.init(528734635,4215389547),new r.init(1541459225,327033209)])},_doProcessBlock:function(e,t){for(var n=(d=this._hash.words)[0],r=d[1],i=d[2],o=d[3],a=d[4],c=d[5],l=d[6],d=d[7],h=n.high,f=n.low,p=r.high,v=r.low,g=i.high,m=i.low,y=o.high,b=o.low,w=a.high,S=a.low,k=c.high,C=c.low,x=l.high,E=l.low,T=d.high,I=d.low,A=h,R=f,_=p,P=v,N=g,O=m,M=y,F=b,Z=w,D=S,L=k,B=C,q=x,j=E,U=T,H=I,z=0;80>z;z++){var V=u[z];if(16>z)var G=V.high=0|e[t+2*z],K=V.low=0|e[t+2*z+1];else{G=((K=(G=u[z-15]).high)>>>1|(W=G.low)<<31)^(K>>>8|W<<24)^K>>>7;var W=(W>>>1|K<<31)^(W>>>8|K<<24)^(W>>>7|K<<25),J=((K=(J=u[z-2]).high)>>>19|(Q=J.low)<<13)^(K<<3|Q>>>29)^K>>>6,Q=(Q>>>19|K<<13)^(Q<<3|K>>>29)^(Q>>>6|K<<26),Y=(K=u[z-7]).high,X=($=u[z-16]).high,$=$.low;G=(G=(G=G+Y+((K=W+K.low)>>>0<W>>>0?1:0))+J+((K=K+Q)>>>0<Q>>>0?1:0))+X+((K=K+$)>>>0<$>>>0?1:0);V.high=G,V.low=K}Y=Z&L^~Z&q,$=D&B^~D&j,V=A&_^A&N^_&N;var ee=R&P^R&O^P&O,te=(W=(A>>>28|R<<4)^(A<<30|R>>>2)^(A<<25|R>>>7),J=(R>>>28|A<<4)^(R<<30|A>>>2)^(R<<25|A>>>7),(Q=s[z]).high),ne=Q.low;X=U+((Z>>>14|D<<18)^(Z>>>18|D<<14)^(Z<<23|D>>>9))+((Q=H+((D>>>14|Z<<18)^(D>>>18|Z<<14)^(D<<23|Z>>>9)))>>>0<H>>>0?1:0),U=q,H=j,q=L,j=B,L=Z,B=D,Z=M+(X=(X=(X=X+Y+((Q=Q+$)>>>0<$>>>0?1:0))+te+((Q=Q+ne)>>>0<ne>>>0?1:0))+G+((Q=Q+K)>>>0<K>>>0?1:0))+((D=F+Q|0)>>>0<F>>>0?1:0)|0,M=N,F=O,N=_,O=P,_=A,P=R,A=X+(V=W+V+((K=J+ee)>>>0<J>>>0?1:0))+((R=Q+K|0)>>>0<Q>>>0?1:0)|0}f=n.low=f+R,n.high=h+A+(f>>>0<R>>>0?1:0),v=r.low=v+P,r.high=p+_+(v>>>0<P>>>0?1:0),m=i.low=m+O,i.high=g+N+(m>>>0<O>>>0?1:0),b=o.low=b+F,o.high=y+M+(b>>>0<F>>>0?1:0),S=a.low=S+D,a.high=w+Z+(S>>>0<D>>>0?1:0),C=c.low=C+B,c.high=k+L+(C>>>0<B>>>0?1:0),E=l.low=E+j,l.high=x+q+(E>>>0<j>>>0?1:0),I=d.low=I+H,d.high=T+U+(I>>>0<H>>>0?1:0)},_doFinalize:function(){var e=this._data,t=e.words,n=8*this._nDataBytes,r=8*e.sigBytes;return t[r>>>5]|=128<<24-r%32,t[30+(r+128>>>10<<5)]=Math.floor(n/4294967296),t[31+(r+128>>>10<<5)]=n,e.sigBytes=4*t.length,this._process(),this._hash.toX32()},clone:function(){var e=n.clone.call(this);return e._hash=this._hash.clone(),e},blockSize:32}),t.SHA512=n._createHelper(a),t.HmacSHA512=n._createHmacHelper(a)}(),function(){var e=i,t=(o=e.x64).Word,n=o.WordArray,r=(o=e.algo).SHA512,o=o.SHA384=r.extend({_doReset:function(){this._hash=new n.init([new t.init(3418070365,3238371032),new t.init(1654270250,914150663),new t.init(2438529370,812702999),new t.init(355462360,4144912697),new t.init(1731405415,4290775857),new t.init(2394180231,1750603025),new t.init(3675008525,1694076839),new t.init(1203062813,3204075428)])},_doFinalize:function(){var e=r._doFinalize.call(this);return e.sigBytes-=16,e}});e.SHA384=r._createHelper(o),e.HmacSHA384=r._createHmacHelper(o)}(),function(){var e=i,t=(r=e.lib).WordArray,n=r.Hasher,r=e.algo,o=t.create([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,7,4,13,1,10,6,15,3,12,0,9,5,2,14,11,8,3,10,14,4,9,15,8,1,2,7,0,6,13,11,5,12,1,9,11,10,0,8,12,4,13,3,7,15,14,5,6,2,4,0,5,9,7,12,2,10,14,1,3,8,11,6,15,13]),a=t.create([5,14,7,0,9,2,11,4,13,6,15,8,1,10,3,12,6,11,3,7,0,13,5,10,14,15,8,12,4,9,1,2,15,5,1,3,7,14,6,9,11,8,12,2,10,0,4,13,8,6,4,1,3,11,15,0,5,12,2,13,9,7,10,14,12,15,10,4,1,5,8,7,6,2,13,14,0,3,9,11]),s=t.create([11,14,15,12,5,8,7,9,11,13,14,15,6,7,9,8,7,6,8,13,11,9,7,15,7,12,15,9,11,7,13,12,11,13,6,7,14,9,13,15,14,8,13,6,5,12,7,5,11,12,14,15,14,15,9,8,9,14,5,6,8,6,5,12,9,15,5,11,6,8,13,12,5,12,13,14,11,8,5,6]),u=t.create([8,9,9,11,13,15,15,5,7,7,8,11,14,14,12,6,9,13,15,7,12,8,9,11,7,7,12,7,6,15,13,11,9,7,15,11,8,6,6,14,12,13,5,14,13,13,7,5,15,5,8,11,14,14,6,14,6,9,12,9,12,5,15,8,8,5,12,9,12,5,14,6,8,13,6,5,15,13,11,11]),c=t.create([0,1518500249,1859775393,2400959708,2840853838]),l=t.create([1352829926,1548603684,1836072691,2053994217,0]);r=r.RIPEMD160=n.extend({_doReset:function(){this._hash=t.create([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(e,t){for(var n=0;16>n;n++){var r=e[w=t+n];e[w]=16711935&(r<<8|r>>>24)|4278255360&(r<<24|r>>>8)}var i,d,h,f,p,v,g,m,y,b,w=this._hash.words,S=(r=c.words,l.words),k=o.words,C=a.words,x=s.words,E=u.words;v=i=w[0],g=d=w[1],m=h=w[2],y=f=w[3],b=p=w[4];var T;for(n=0;80>n;n+=1)T=i+e[t+k[n]]|0,T=16>n?T+((d^h^f)+r[0]):32>n?T+((d&h|~d&f)+r[1]):48>n?T+(((d|~h)^f)+r[2]):64>n?T+((d&f|h&~f)+r[3]):T+((d^(h|~f))+r[4]),T=(T=(T|=0)<<x[n]|T>>>32-x[n])+p|0,i=p,p=f,f=h<<10|h>>>22,h=d,d=T,T=v+e[t+C[n]]|0,T=16>n?T+((g^(m|~y))+S[0]):32>n?T+((g&y|m&~y)+S[1]):48>n?T+(((g|~m)^y)+S[2]):64>n?T+((g&m|~g&y)+S[3]):T+((g^m^y)+S[4]),T=(T=(T|=0)<<E[n]|T>>>32-E[n])+b|0,v=b,b=y,y=m<<10|m>>>22,m=g,g=T;T=w[1]+h+y|0,w[1]=w[2]+f+b|0,w[2]=w[3]+p+v|0,w[3]=w[4]+i+g|0,w[4]=w[0]+d+m|0,w[0]=T},_doFinalize:function(){var e=this._data,t=e.words,n=8*this._nDataBytes,r=8*e.sigBytes;for(t[r>>>5]|=128<<24-r%32,t[14+(r+64>>>9<<4)]=16711935&(n<<8|n>>>24)|4278255360&(n<<24|n>>>8),e.sigBytes=4*(t.length+1),this._process(),t=(e=this._hash).words,n=0;5>n;n++)r=t[n],t[n]=16711935&(r<<8|r>>>24)|4278255360&(r<<24|r>>>8);return e},clone:function(){var e=n.clone.call(this);return e._hash=this._hash.clone(),e}});e.RIPEMD160=n._createHelper(r),e.HmacRIPEMD160=n._createHmacHelper(r)}(Math),function(){var e=i,t=e.enc.Utf8;e.algo.HMAC=e.lib.Base.extend({init:function(e,n){e=this._hasher=new e.init,"string"==typeof n&&(n=t.parse(n));var r=e.blockSize,i=4*r;n.sigBytes>i&&(n=e.finalize(n)),n.clamp();for(var o=this._oKey=n.clone(),a=this._iKey=n.clone(),s=o.words,u=a.words,c=0;c<r;c++)s[c]^=1549556828,u[c]^=909522486;o.sigBytes=a.sigBytes=i,this.reset()},reset:function(){var e=this._hasher;e.reset(),e.update(this._iKey)},update:function(e){return this._hasher.update(e),this},finalize:function(e){var t=this._hasher;return e=t.finalize(e),t.reset(),t.finalize(this._oKey.clone().concat(e))}})}(),function(){var e,t=i,n=(e=t.lib).Base,r=e.WordArray,o=(e=t.algo).HMAC,a=e.PBKDF2=n.extend({cfg:n.extend({keySize:4,hasher:e.SHA1,iterations:1}),init:function(e){this.cfg=this.cfg.extend(e)},compute:function(e,t){var n=this.cfg,i=o.create(n.hasher,e),a=r.create(),s=r.create([1]),u=a.words,c=s.words,l=n.keySize;for(n=n.iterations;u.length<l;){var d=i.update(t).finalize(s);i.reset();for(var h=d.words,f=h.length,p=d,v=1;v<n;v++){p=i.finalize(p),i.reset();for(var g=p.words,m=0;m<f;m++)h[m]^=g[m]}a.concat(d),c[0]++}return a.sigBytes=4*l,a}});t.PBKDF2=function(e,t,n){return a.create(n).compute(e,t)}}();var o,a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",s="=";function u(e){var t,n,r="";for(t=0;t+3<=e.length;t+=3)n=parseInt(e.substring(t,t+3),16),r+=a.charAt(n>>6)+a.charAt(63&n);if(t+1==e.length?(n=parseInt(e.substring(t,t+1),16),r+=a.charAt(n<<2)):t+2==e.length&&(n=parseInt(e.substring(t,t+2),16),r+=a.charAt(n>>2)+a.charAt((3&n)<<4)),s)for(;(3&r.length)>0;)r+=s;return r}function c(e){var t,n,r,i="",o=0;for(t=0;t<e.length&&e.charAt(t)!=s;++t)(r=a.indexOf(e.charAt(t)))<0||(0==o?(i+=m(r>>2),n=3&r,o=1):1==o?(i+=m(n<<2|r>>4),n=15&r,o=2):2==o?(i+=m(n),i+=m(r>>2),n=3&r,o=3):(i+=m(n<<2|r>>4),i+=m(15&r),o=0));return 1==o&&(i+=m(n<<2)),i}function l(e){var t,n=c(e),r=new Array;for(t=0;2*t<n.length;++t)r[t]=parseInt(n.substring(2*t,2*t+2),16);return r}function d(e,t,n){null!=e&&("number"==typeof e?this.fromNumber(e,t,n):null==t&&"string"!=typeof e?this.fromString(e,256):this.fromString(e,t))}function h(){return new d(null)}"Microsoft Internet Explorer"==n.appName?(d.prototype.am=function(e,t,n,r,i,o){for(var a=32767&t,s=t>>15;--o>=0;){var u=32767&this[e],c=this[e++]>>15,l=s*u+c*a;i=((u=a*u+((32767&l)<<15)+n[r]+(1073741823&i))>>>30)+(l>>>15)+s*c+(i>>>30),n[r++]=1073741823&u}return i},o=30):"Netscape"!=n.appName?(d.prototype.am=function(e,t,n,r,i,o){for(;--o>=0;){var a=t*this[e++]+n[r]+i;i=Math.floor(a/67108864),n[r++]=67108863&a}return i},o=26):(d.prototype.am=function(e,t,n,r,i,o){for(var a=16383&t,s=t>>14;--o>=0;){var u=16383&this[e],c=this[e++]>>14,l=s*u+c*a;i=((u=a*u+((16383&l)<<14)+n[r]+i)>>28)+(l>>14)+s*c,n[r++]=268435455&u}return i},o=28),d.prototype.DB=o,d.prototype.DM=(1<<o)-1,d.prototype.DV=1<<o;d.prototype.FV=Math.pow(2,52),d.prototype.F1=52-o,d.prototype.F2=2*o-52;var f,p,v="0123456789abcdefghijklmnopqrstuvwxyz",g=new Array;for(f="0".charCodeAt(0),p=0;p<=9;++p)g[f++]=p;for(f="a".charCodeAt(0),p=10;p<36;++p)g[f++]=p;for(f="A".charCodeAt(0),p=10;p<36;++p)g[f++]=p;function m(e){return v.charAt(e)}function y(e,t){var n=g[e.charCodeAt(t)];return null==n?-1:n}function b(e){var t=h();return t.fromInt(e),t}function w(e){var t,n=1;return 0!=(t=e>>>16)&&(e=t,n+=16),0!=(t=e>>8)&&(e=t,n+=8),0!=(t=e>>4)&&(e=t,n+=4),0!=(t=e>>2)&&(e=t,n+=2),0!=(t=e>>1)&&(e=t,n+=1),n}function S(e){this.m=e}function k(e){this.m=e,this.mp=e.invDigit(),this.mpl=32767&this.mp,this.mph=this.mp>>15,this.um=(1<<e.DB-15)-1,this.mt2=2*e.t}function C(e,t){return e&t}function x(e,t){return e|t}function E(e,t){return e^t}function T(e,t){return e&~t}function I(e){if(0==e)return-1;var t=0;return 0==(65535&e)&&(e>>=16,t+=16),0==(255&e)&&(e>>=8,t+=8),0==(15&e)&&(e>>=4,t+=4),0==(3&e)&&(e>>=2,t+=2),0==(1&e)&&++t,t}function A(e){for(var t=0;0!=e;)e&=e-1,++t;return t}function R(){}function _(e){return e}function P(e){this.r2=h(),this.q3=h(),d.ONE.dlShiftTo(2*e.t,this.r2),this.mu=this.r2.divide(e),this.m=e}S.prototype.convert=function(e){return e.s<0||e.compareTo(this.m)>=0?e.mod(this.m):e},S.prototype.revert=function(e){return e},S.prototype.reduce=function(e){e.divRemTo(this.m,null,e)},S.prototype.mulTo=function(e,t,n){e.multiplyTo(t,n),this.reduce(n)},S.prototype.sqrTo=function(e,t){e.squareTo(t),this.reduce(t)},k.prototype.convert=function(e){var t=h();return e.abs().dlShiftTo(this.m.t,t),t.divRemTo(this.m,null,t),e.s<0&&t.compareTo(d.ZERO)>0&&this.m.subTo(t,t),t},k.prototype.revert=function(e){var t=h();return e.copyTo(t),this.reduce(t),t},k.prototype.reduce=function(e){for(;e.t<=this.mt2;)e[e.t++]=0;for(var t=0;t<this.m.t;++t){var n=32767&e[t],r=n*this.mpl+((n*this.mph+(e[t]>>15)*this.mpl&this.um)<<15)&e.DM;for(e[n=t+this.m.t]+=this.m.am(0,r,e,t,0,this.m.t);e[n]>=e.DV;)e[n]-=e.DV,e[++n]++}e.clamp(),e.drShiftTo(this.m.t,e),e.compareTo(this.m)>=0&&e.subTo(this.m,e)},k.prototype.mulTo=function(e,t,n){e.multiplyTo(t,n),this.reduce(n)},k.prototype.sqrTo=function(e,t){e.squareTo(t),this.reduce(t)},d.prototype.copyTo=function(e){for(var t=this.t-1;t>=0;--t)e[t]=this[t];e.t=this.t,e.s=this.s},d.prototype.fromInt=function(e){this.t=1,this.s=e<0?-1:0,e>0?this[0]=e:e<-1?this[0]=e+this.DV:this.t=0},d.prototype.fromString=function(e,t){var n;if(16==t)n=4;else if(8==t)n=3;else if(256==t)n=8;else if(2==t)n=1;else if(32==t)n=5;else{if(4!=t)return void this.fromRadix(e,t);n=2}this.t=0,this.s=0;for(var r=e.length,i=!1,o=0;--r>=0;){var a=8==n?255&e[r]:y(e,r);a<0?"-"==e.charAt(r)&&(i=!0):(i=!1,0==o?this[this.t++]=a:o+n>this.DB?(this[this.t-1]|=(a&(1<<this.DB-o)-1)<<o,this[this.t++]=a>>this.DB-o):this[this.t-1]|=a<<o,(o+=n)>=this.DB&&(o-=this.DB))}8==n&&0!=(128&e[0])&&(this.s=-1,o>0&&(this[this.t-1]|=(1<<this.DB-o)-1<<o)),this.clamp(),i&&d.ZERO.subTo(this,this)},d.prototype.clamp=function(){for(var e=this.s&this.DM;this.t>0&&this[this.t-1]==e;)--this.t},d.prototype.dlShiftTo=function(e,t){var n;for(n=this.t-1;n>=0;--n)t[n+e]=this[n];for(n=e-1;n>=0;--n)t[n]=0;t.t=this.t+e,t.s=this.s},d.prototype.drShiftTo=function(e,t){for(var n=e;n<this.t;++n)t[n-e]=this[n];t.t=Math.max(this.t-e,0),t.s=this.s},d.prototype.lShiftTo=function(e,t){var n,r=e%this.DB,i=this.DB-r,o=(1<<i)-1,a=Math.floor(e/this.DB),s=this.s<<r&this.DM;for(n=this.t-1;n>=0;--n)t[n+a+1]=this[n]>>i|s,s=(this[n]&o)<<r;for(n=a-1;n>=0;--n)t[n]=0;t[a]=s,t.t=this.t+a+1,t.s=this.s,t.clamp()},d.prototype.rShiftTo=function(e,t){t.s=this.s;var n=Math.floor(e/this.DB);if(n>=this.t)t.t=0;else{var r=e%this.DB,i=this.DB-r,o=(1<<r)-1;t[0]=this[n]>>r;for(var a=n+1;a<this.t;++a)t[a-n-1]|=(this[a]&o)<<i,t[a-n]=this[a]>>r;r>0&&(t[this.t-n-1]|=(this.s&o)<<i),t.t=this.t-n,t.clamp()}},d.prototype.subTo=function(e,t){for(var n=0,r=0,i=Math.min(e.t,this.t);n<i;)r+=this[n]-e[n],t[n++]=r&this.DM,r>>=this.DB;if(e.t<this.t){for(r-=e.s;n<this.t;)r+=this[n],t[n++]=r&this.DM,r>>=this.DB;r+=this.s}else{for(r+=this.s;n<e.t;)r-=e[n],t[n++]=r&this.DM,r>>=this.DB;r-=e.s}t.s=r<0?-1:0,r<-1?t[n++]=this.DV+r:r>0&&(t[n++]=r),t.t=n,t.clamp()},d.prototype.multiplyTo=function(e,t){var n=this.abs(),r=e.abs(),i=n.t;for(t.t=i+r.t;--i>=0;)t[i]=0;for(i=0;i<r.t;++i)t[i+n.t]=n.am(0,r[i],t,i,0,n.t);t.s=0,t.clamp(),this.s!=e.s&&d.ZERO.subTo(t,t)},d.prototype.squareTo=function(e){for(var t=this.abs(),n=e.t=2*t.t;--n>=0;)e[n]=0;for(n=0;n<t.t-1;++n){var r=t.am(n,t[n],e,2*n,0,1);(e[n+t.t]+=t.am(n+1,2*t[n],e,2*n+1,r,t.t-n-1))>=t.DV&&(e[n+t.t]-=t.DV,e[n+t.t+1]=1)}e.t>0&&(e[e.t-1]+=t.am(n,t[n],e,2*n,0,1)),e.s=0,e.clamp()},d.prototype.divRemTo=function(e,t,n){var r=e.abs();if(!(r.t<=0)){var i=this.abs();if(i.t<r.t)return null!=t&&t.fromInt(0),void(null!=n&&this.copyTo(n));null==n&&(n=h());var o=h(),a=this.s,s=e.s,u=this.DB-w(r[r.t-1]);u>0?(r.lShiftTo(u,o),i.lShiftTo(u,n)):(r.copyTo(o),i.copyTo(n));var c=o.t,l=o[c-1];if(0!=l){var f=l*(1<<this.F1)+(c>1?o[c-2]>>this.F2:0),p=this.FV/f,v=(1<<this.F1)/f,g=1<<this.F2,m=n.t,y=m-c,b=null==t?h():t;for(o.dlShiftTo(y,b),n.compareTo(b)>=0&&(n[n.t++]=1,n.subTo(b,n)),d.ONE.dlShiftTo(c,b),b.subTo(o,o);o.t<c;)o[o.t++]=0;for(;--y>=0;){var S=n[--m]==l?this.DM:Math.floor(n[m]*p+(n[m-1]+g)*v);if((n[m]+=o.am(0,S,n,y,0,c))<S)for(o.dlShiftTo(y,b),n.subTo(b,n);n[m]<--S;)n.subTo(b,n)}null!=t&&(n.drShiftTo(c,t),a!=s&&d.ZERO.subTo(t,t)),n.t=c,n.clamp(),u>0&&n.rShiftTo(u,n),a<0&&d.ZERO.subTo(n,n)}}},d.prototype.invDigit=function(){if(this.t<1)return 0;var e=this[0];if(0==(1&e))return 0;var t=3&e;return(t=(t=(t=(t=t*(2-(15&e)*t)&15)*(2-(255&e)*t)&255)*(2-((65535&e)*t&65535))&65535)*(2-e*t%this.DV)%this.DV)>0?this.DV-t:-t},d.prototype.isEven=function(){return 0==(this.t>0?1&this[0]:this.s)},d.prototype.exp=function(e,t){if(e>4294967295||e<1)return d.ONE;var n=h(),r=h(),i=t.convert(this),o=w(e)-1;for(i.copyTo(n);--o>=0;)if(t.sqrTo(n,r),(e&1<<o)>0)t.mulTo(r,i,n);else{var a=n;n=r,r=a}return t.revert(n)},d.prototype.toString=function(e){if(this.s<0)return"-"+this.negate().toString(e);var t;if(16==e)t=4;else if(8==e)t=3;else if(2==e)t=1;else if(32==e)t=5;else{if(4!=e)return this.toRadix(e);t=2}var n,r=(1<<t)-1,i=!1,o="",a=this.t,s=this.DB-a*this.DB%t;if(a-- >0)for(s<this.DB&&(n=this[a]>>s)>0&&(i=!0,o=m(n));a>=0;)s<t?(n=(this[a]&(1<<s)-1)<<t-s,n|=this[--a]>>(s+=this.DB-t)):(n=this[a]>>(s-=t)&r,s<=0&&(s+=this.DB,--a)),n>0&&(i=!0),i&&(o+=m(n));return i?o:"0"},d.prototype.negate=function(){var e=h();return d.ZERO.subTo(this,e),e},d.prototype.abs=function(){return this.s<0?this.negate():this},d.prototype.compareTo=function(e){var t=this.s-e.s;if(0!=t)return t;var n=this.t;if(0!=(t=n-e.t))return this.s<0?-t:t;for(;--n>=0;)if(0!=(t=this[n]-e[n]))return t;return 0},d.prototype.bitLength=function(){return this.t<=0?0:this.DB*(this.t-1)+w(this[this.t-1]^this.s&this.DM)},d.prototype.mod=function(e){var t=h();return this.abs().divRemTo(e,null,t),this.s<0&&t.compareTo(d.ZERO)>0&&e.subTo(t,t),t},d.prototype.modPowInt=function(e,t){var n;return n=e<256||t.isEven()?new S(t):new k(t),this.exp(e,n)},d.ZERO=b(0),d.ONE=b(1),R.prototype.convert=_,R.prototype.revert=_,R.prototype.mulTo=function(e,t,n){e.multiplyTo(t,n)},R.prototype.sqrTo=function(e,t){e.squareTo(t)},P.prototype.convert=function(e){if(e.s<0||e.t>2*this.m.t)return e.mod(this.m);if(e.compareTo(this.m)<0)return e;var t=h();return e.copyTo(t),this.reduce(t),t},P.prototype.revert=function(e){return e},P.prototype.reduce=function(e){for(e.drShiftTo(this.m.t-1,this.r2),e.t>this.m.t+1&&(e.t=this.m.t+1,e.clamp()),this.mu.multiplyUpperTo(this.r2,this.m.t+1,this.q3),this.m.multiplyLowerTo(this.q3,this.m.t+1,this.r2);e.compareTo(this.r2)<0;)e.dAddOffset(1,this.m.t+1);for(e.subTo(this.r2,e);e.compareTo(this.m)>=0;)e.subTo(this.m,e)},P.prototype.mulTo=function(e,t,n){e.multiplyTo(t,n),this.reduce(n)},P.prototype.sqrTo=function(e,t){e.squareTo(t),this.reduce(t)};var N=[2,3,5,7,11,13,17,19,23,29,31,37,41,43,47,53,59,61,67,71,73,79,83,89,97,101,103,107,109,113,127,131,137,139,149,151,157,163,167,173,179,181,191,193,197,199,211,223,227,229,233,239,241,251,257,263,269,271,277,281,283,293,307,311,313,317,331,337,347,349,353,359,367,373,379,383,389,397,401,409,419,421,431,433,439,443,449,457,461,463,467,479,487,491,499,503,509,521,523,541,547,557,563,569,571,577,587,593,599,601,607,613,617,619,631,641,643,647,653,659,661,673,677,683,691,701,709,719,727,733,739,743,751,757,761,769,773,787,797,809,811,821,823,827,829,839,853,857,859,863,877,881,883,887,907,911,919,929,937,941,947,953,967,971,977,983,991,997],O=(1<<26)/N[N.length-1];function M(){this.i=0,this.j=0,this.S=new Array}d.prototype.chunkSize=function(e){return Math.floor(Math.LN2*this.DB/Math.log(e))},d.prototype.toRadix=function(e){if(null==e&&(e=10),0==this.signum()||e<2||e>36)return"0";var t=this.chunkSize(e),n=Math.pow(e,t),r=b(n),i=h(),o=h(),a="";for(this.divRemTo(r,i,o);i.signum()>0;)a=(n+o.intValue()).toString(e).substr(1)+a,i.divRemTo(r,i,o);return o.intValue().toString(e)+a},d.prototype.fromRadix=function(e,t){this.fromInt(0),null==t&&(t=10);for(var n=this.chunkSize(t),r=Math.pow(t,n),i=!1,o=0,a=0,s=0;s<e.length;++s){var u=y(e,s);u<0?"-"==e.charAt(s)&&0==this.signum()&&(i=!0):(a=t*a+u,++o>=n&&(this.dMultiply(r),this.dAddOffset(a,0),o=0,a=0))}o>0&&(this.dMultiply(Math.pow(t,o)),this.dAddOffset(a,0)),i&&d.ZERO.subTo(this,this)},d.prototype.fromNumber=function(e,t,n){if("number"==typeof t)if(e<2)this.fromInt(1);else for(this.fromNumber(e,n),this.testBit(e-1)||this.bitwiseTo(d.ONE.shiftLeft(e-1),x,this),this.isEven()&&this.dAddOffset(1,0);!this.isProbablePrime(t);)this.dAddOffset(2,0),this.bitLength()>e&&this.subTo(d.ONE.shiftLeft(e-1),this);else{var r=new Array,i=7&e;r.length=1+(e>>3),t.nextBytes(r),i>0?r[0]&=(1<<i)-1:r[0]=0,this.fromString(r,256)}},d.prototype.bitwiseTo=function(e,t,n){var r,i,o=Math.min(e.t,this.t);for(r=0;r<o;++r)n[r]=t(this[r],e[r]);if(e.t<this.t){for(i=e.s&this.DM,r=o;r<this.t;++r)n[r]=t(this[r],i);n.t=this.t}else{for(i=this.s&this.DM,r=o;r<e.t;++r)n[r]=t(i,e[r]);n.t=e.t}n.s=t(this.s,e.s),n.clamp()},d.prototype.changeBit=function(e,t){var n=d.ONE.shiftLeft(e);return this.bitwiseTo(n,t,n),n},d.prototype.addTo=function(e,t){for(var n=0,r=0,i=Math.min(e.t,this.t);n<i;)r+=this[n]+e[n],t[n++]=r&this.DM,r>>=this.DB;if(e.t<this.t){for(r+=e.s;n<this.t;)r+=this[n],t[n++]=r&this.DM,r>>=this.DB;r+=this.s}else{for(r+=this.s;n<e.t;)r+=e[n],t[n++]=r&this.DM,r>>=this.DB;r+=e.s}t.s=r<0?-1:0,r>0?t[n++]=r:r<-1&&(t[n++]=this.DV+r),t.t=n,t.clamp()},d.prototype.dMultiply=function(e){this[this.t]=this.am(0,e-1,this,0,0,this.t),++this.t,this.clamp()},d.prototype.dAddOffset=function(e,t){if(0!=e){for(;this.t<=t;)this[this.t++]=0;for(this[t]+=e;this[t]>=this.DV;)this[t]-=this.DV,++t>=this.t&&(this[this.t++]=0),++this[t]}},d.prototype.multiplyLowerTo=function(e,t,n){var r,i=Math.min(this.t+e.t,t);for(n.s=0,n.t=i;i>0;)n[--i]=0;for(r=n.t-this.t;i<r;++i)n[i+this.t]=this.am(0,e[i],n,i,0,this.t);for(r=Math.min(e.t,t);i<r;++i)this.am(0,e[i],n,i,0,t-i);n.clamp()},d.prototype.multiplyUpperTo=function(e,t,n){--t;var r=n.t=this.t+e.t-t;for(n.s=0;--r>=0;)n[r]=0;for(r=Math.max(t-this.t,0);r<e.t;++r)n[this.t+r-t]=this.am(t-r,e[r],n,0,0,this.t+r-t);n.clamp(),n.drShiftTo(1,n)},d.prototype.modInt=function(e){if(e<=0)return 0;var t=this.DV%e,n=this.s<0?e-1:0;if(this.t>0)if(0==t)n=this[0]%e;else for(var r=this.t-1;r>=0;--r)n=(t*n+this[r])%e;return n},d.prototype.millerRabin=function(e){var t=this.subtract(d.ONE),n=t.getLowestSetBit();if(n<=0)return!1;var r=t.shiftRight(n);(e=e+1>>1)>N.length&&(e=N.length);for(var i=h(),o=0;o<e;++o){i.fromInt(N[Math.floor(Math.random()*N.length)]);var a=i.modPow(r,this);if(0!=a.compareTo(d.ONE)&&0!=a.compareTo(t)){for(var s=1;s++<n&&0!=a.compareTo(t);)if(0==(a=a.modPowInt(2,this)).compareTo(d.ONE))return!1;if(0!=a.compareTo(t))return!1}}return!0},d.prototype.clone=function(){var e=h();return this.copyTo(e),e},d.prototype.intValue=function(){if(this.s<0){if(1==this.t)return this[0]-this.DV;if(0==this.t)return-1}else{if(1==this.t)return this[0];if(0==this.t)return 0}return(this[1]&(1<<32-this.DB)-1)<<this.DB|this[0]},d.prototype.byteValue=function(){return 0==this.t?this.s:this[0]<<24>>24},d.prototype.shortValue=function(){return 0==this.t?this.s:this[0]<<16>>16},d.prototype.signum=function(){return this.s<0?-1:this.t<=0||1==this.t&&this[0]<=0?0:1},d.prototype.toByteArray=function(){var e=this.t,t=new Array;t[0]=this.s;var n,r=this.DB-e*this.DB%8,i=0;if(e-- >0)for(r<this.DB&&(n=this[e]>>r)!=(this.s&this.DM)>>r&&(t[i++]=n|this.s<<this.DB-r);e>=0;)r<8?(n=(this[e]&(1<<r)-1)<<8-r,n|=this[--e]>>(r+=this.DB-8)):(n=this[e]>>(r-=8)&255,r<=0&&(r+=this.DB,--e)),0!=(128&n)&&(n|=-256),0==i&&(128&this.s)!=(128&n)&&++i,(i>0||n!=this.s)&&(t[i++]=n);return t},d.prototype.equals=function(e){return 0==this.compareTo(e)},d.prototype.min=function(e){return this.compareTo(e)<0?this:e},d.prototype.max=function(e){return this.compareTo(e)>0?this:e},d.prototype.and=function(e){var t=h();return this.bitwiseTo(e,C,t),t},d.prototype.or=function(e){var t=h();return this.bitwiseTo(e,x,t),t},d.prototype.xor=function(e){var t=h();return this.bitwiseTo(e,E,t),t},d.prototype.andNot=function(e){var t=h();return this.bitwiseTo(e,T,t),t},d.prototype.not=function(){for(var e=h(),t=0;t<this.t;++t)e[t]=this.DM&~this[t];return e.t=this.t,e.s=~this.s,e},d.prototype.shiftLeft=function(e){var t=h();return e<0?this.rShiftTo(-e,t):this.lShiftTo(e,t),t},d.prototype.shiftRight=function(e){var t=h();return e<0?this.lShiftTo(-e,t):this.rShiftTo(e,t),t},d.prototype.getLowestSetBit=function(){for(var e=0;e<this.t;++e)if(0!=this[e])return e*this.DB+I(this[e]);return this.s<0?this.t*this.DB:-1},d.prototype.bitCount=function(){for(var e=0,t=this.s&this.DM,n=0;n<this.t;++n)e+=A(this[n]^t);return e},d.prototype.testBit=function(e){var t=Math.floor(e/this.DB);return t>=this.t?0!=this.s:0!=(this[t]&1<<e%this.DB)},d.prototype.setBit=function(e){return this.changeBit(e,x)},d.prototype.clearBit=function(e){return this.changeBit(e,T)},d.prototype.flipBit=function(e){return this.changeBit(e,E)},d.prototype.add=function(e){var t=h();return this.addTo(e,t),t},d.prototype.subtract=function(e){var t=h();return this.subTo(e,t),t},d.prototype.multiply=function(e){var t=h();return this.multiplyTo(e,t),t},d.prototype.divide=function(e){var t=h();return this.divRemTo(e,t,null),t},d.prototype.remainder=function(e){var t=h();return this.divRemTo(e,null,t),t},d.prototype.divideAndRemainder=function(e){var t=h(),n=h();return this.divRemTo(e,t,n),new Array(t,n)},d.prototype.modPow=function(e,t){var n,r,i=e.bitLength(),o=b(1);if(i<=0)return o;n=i<18?1:i<48?3:i<144?4:i<768?5:6,r=i<8?new S(t):t.isEven()?new P(t):new k(t);var a=new Array,s=3,u=n-1,c=(1<<n)-1;if(a[1]=r.convert(this),n>1){var l=h();for(r.sqrTo(a[1],l);s<=c;)a[s]=h(),r.mulTo(l,a[s-2],a[s]),s+=2}var d,f,p=e.t-1,v=!0,g=h();for(i=w(e[p])-1;p>=0;){for(i>=u?d=e[p]>>i-u&c:(d=(e[p]&(1<<i+1)-1)<<u-i,p>0&&(d|=e[p-1]>>this.DB+i-u)),s=n;0==(1&d);)d>>=1,--s;if((i-=s)<0&&(i+=this.DB,--p),v)a[d].copyTo(o),v=!1;else{for(;s>1;)r.sqrTo(o,g),r.sqrTo(g,o),s-=2;s>0?r.sqrTo(o,g):(f=o,o=g,g=f),r.mulTo(g,a[d],o)}for(;p>=0&&0==(e[p]&1<<i);)r.sqrTo(o,g),f=o,o=g,g=f,--i<0&&(i=this.DB-1,--p)}return r.revert(o)},d.prototype.modInverse=function(e){var t=e.isEven();if(this.isEven()&&t||0==e.signum())return d.ZERO;for(var n=e.clone(),r=this.clone(),i=b(1),o=b(0),a=b(0),s=b(1);0!=n.signum();){for(;n.isEven();)n.rShiftTo(1,n),t?(i.isEven()&&o.isEven()||(i.addTo(this,i),o.subTo(e,o)),i.rShiftTo(1,i)):o.isEven()||o.subTo(e,o),o.rShiftTo(1,o);for(;r.isEven();)r.rShiftTo(1,r),t?(a.isEven()&&s.isEven()||(a.addTo(this,a),s.subTo(e,s)),a.rShiftTo(1,a)):s.isEven()||s.subTo(e,s),s.rShiftTo(1,s);n.compareTo(r)>=0?(n.subTo(r,n),t&&i.subTo(a,i),o.subTo(s,o)):(r.subTo(n,r),t&&a.subTo(i,a),s.subTo(o,s))}return 0!=r.compareTo(d.ONE)?d.ZERO:s.compareTo(e)>=0?s.subtract(e):s.signum()<0?(s.addTo(e,s),s.signum()<0?s.add(e):s):s},d.prototype.pow=function(e){return this.exp(e,new R)},d.prototype.gcd=function(e){var t=this.s<0?this.negate():this.clone(),n=e.s<0?e.negate():e.clone();if(t.compareTo(n)<0){var r=t;t=n,n=r}var i=t.getLowestSetBit(),o=n.getLowestSetBit();if(o<0)return t;for(i<o&&(o=i),o>0&&(t.rShiftTo(o,t),n.rShiftTo(o,n));t.signum()>0;)(i=t.getLowestSetBit())>0&&t.rShiftTo(i,t),(i=n.getLowestSetBit())>0&&n.rShiftTo(i,n),t.compareTo(n)>=0?(t.subTo(n,t),t.rShiftTo(1,t)):(n.subTo(t,n),n.rShiftTo(1,n));return o>0&&n.lShiftTo(o,n),n},d.prototype.isProbablePrime=function(e){var t,n=this.abs();if(1==n.t&&n[0]<=N[N.length-1]){for(t=0;t<N.length;++t)if(n[0]==N[t])return!0;return!1}if(n.isEven())return!1;for(t=1;t<N.length;){for(var r=N[t],i=t+1;i<N.length&&r<O;)r*=N[i++];for(r=n.modInt(r);t<i;)if(r%N[t++]==0)return!1}return n.millerRabin(e)},d.prototype.square=function(){var e=h();return this.squareTo(e),e},M.prototype.init=function(e){var t,n,r;for(t=0;t<256;++t)this.S[t]=t;for(n=0,t=0;t<256;++t)n=n+this.S[t]+e[t%e.length]&255,r=this.S[t],this.S[t]=this.S[n],this.S[n]=r;this.i=0,this.j=0},M.prototype.next=function(){var e;return this.i=this.i+1&255,this.j=this.j+this.S[this.i]&255,e=this.S[this.i],this.S[this.i]=this.S[this.j],this.S[this.j]=e,this.S[e+this.S[this.i]&255]};var F,Z,D,L=256;function B(){var e;e=(new Date).getTime(),Z[D++]^=255&e,Z[D++]^=e>>8&255,Z[D++]^=e>>16&255,Z[D++]^=e>>24&255,D>=L&&(D-=L)}if(null==Z){var q;if(Z=new Array,D=0,void 0!==r&&(void 0!==r.crypto||void 0!==r.msCrypto)){var j=r.crypto||r.msCrypto;if(j.getRandomValues){var U=new Uint8Array(32);for(j.getRandomValues(U),q=0;q<32;++q)Z[D++]=U[q]}else if("Netscape"==n.appName&&n.appVersion<"5"){var H=r.crypto.random(32);for(q=0;q<H.length;++q)Z[D++]=255&H.charCodeAt(q)}}for(;D<L;)q=Math.floor(65536*Math.random()),Z[D++]=q>>>8,Z[D++]=255&q;D=0,B()}function z(){if(null==F){for(B(),(F=new M).init(Z),D=0;D<Z.length;++D)Z[D]=0;D=0}return F.next()}function V(){}function G(e,t){return new d(e,t)}function K(e,t,n){for(var r="",i=0;r.length<t;)r+=n(String.fromCharCode.apply(String,e.concat([(4278190080&i)>>24,(16711680&i)>>16,(65280&i)>>8,255&i]))),i+=1;return r}function W(){this.n=null,this.e=0,this.d=null,this.p=null,this.q=null,this.dmp1=null,this.dmq1=null,this.coeff=null}function J(e,t,n){for(var r="",i=0;r.length<t;)r+=n(e+String.fromCharCode.apply(String,[(4278190080&i)>>24,(16711680&i)>>16,(65280&i)>>8,255&i])),i+=1;return r}function Q(e,t){this.x=t,this.q=e}function Y(e,t,n,r){this.curve=e,this.x=t,this.y=n,this.z=null==r?d.ONE:r,this.zinv=null}function X(e,t,n){this.q=e,this.a=this.fromBigInteger(t),this.b=this.fromBigInteger(n),this.infinity=new Y(this,null,null)}V.prototype.nextBytes=function(e){var t;for(t=0;t<e.length;++t)e[t]=z()},W.prototype.doPublic=function(e){return e.modPowInt(this.e,this.n)},W.prototype.setPublic=function(e,t){if(this.isPublic=!0,this.isPrivate=!1,"string"!==typeof e)this.n=e,this.e=t;else{if(!(null!=e&&null!=t&&e.length>0&&t.length>0))throw"Invalid RSA public key";this.n=G(e,16),this.e=parseInt(t,16)}},W.prototype.encrypt=function(e){var t=function(e,t){if(t<e.length+11)throw"Message too long for RSA";for(var n=new Array,r=e.length-1;r>=0&&t>0;){var i=e.charCodeAt(r--);i<128?n[--t]=i:i>127&&i<2048?(n[--t]=63&i|128,n[--t]=i>>6|192):(n[--t]=63&i|128,n[--t]=i>>6&63|128,n[--t]=i>>12|224)}n[--t]=0;for(var o=new V,a=new Array;t>2;){for(a[0]=0;0==a[0];)o.nextBytes(a);n[--t]=a[0]}return n[--t]=2,n[--t]=0,new d(n)}(e,this.n.bitLength()+7>>3);if(null==t)return null;var n=this.doPublic(t);if(null==n)return null;var r=n.toString(16);return 0==(1&r.length)?r:"0"+r},W.prototype.encryptOAEP=function(e,t,n){var r=this.n.bitLength()+7>>3,i=function(e,t,n,r){var i=ee.crypto.MessageDigest,o=ee.crypto.Util,a=null;if(n||(n="sha1"),"string"===typeof n&&(a=i.getCanonicalAlgName(n),r=i.getHashLength(a),n=function(e){return ve(o.hashHex(ge(e),a))}),e.length+2*r+2>t)throw"Message too long for RSA";var s,u="";for(s=0;s<t-e.length-2*r-2;s+=1)u+="\0";var c=n("")+u+"\x01"+e,l=new Array(r);(new V).nextBytes(l);var h=K(l,c.length,n),f=[];for(s=0;s<c.length;s+=1)f[s]=c.charCodeAt(s)^h.charCodeAt(s);var p=K(f,l.length,n),v=[0];for(s=0;s<l.length;s+=1)v[s+1]=l[s]^p.charCodeAt(s);return new d(v.concat(f))}(e,r,t,n);if(null==i)return null;var o=this.doPublic(i);if(null==o)return null;for(var a=o.toString(16);a.length<2*r;)a="0"+a;return a},W.prototype.type="RSA",W.prototype.doPrivate=function(e){if(null==this.p||null==this.q)return e.modPow(this.d,this.n);for(var t=e.mod(this.p).modPow(this.dmp1,this.p),n=e.mod(this.q).modPow(this.dmq1,this.q);t.compareTo(n)<0;)t=t.add(this.p);return t.subtract(n).multiply(this.coeff).mod(this.p).multiply(this.q).add(n)},W.prototype.setPrivate=function(e,t,n){if(this.isPrivate=!0,"string"!==typeof e)this.n=e,this.e=t,this.d=n;else{if(!(null!=e&&null!=t&&e.length>0&&t.length>0))throw"Invalid RSA private key";this.n=G(e,16),this.e=parseInt(t,16),this.d=G(n,16)}},W.prototype.setPrivateEx=function(e,t,n,r,i,o,a,s){if(this.isPrivate=!0,this.isPublic=!1,null==e)throw"RSASetPrivateEx N == null";if(null==t)throw"RSASetPrivateEx E == null";if(0==e.length)throw"RSASetPrivateEx N.length == 0";if(0==t.length)throw"RSASetPrivateEx E.length == 0";if(!(null!=e&&null!=t&&e.length>0&&t.length>0))throw"Invalid RSA private key in RSASetPrivateEx";this.n=G(e,16),this.e=parseInt(t,16),this.d=G(n,16),this.p=G(r,16),this.q=G(i,16),this.dmp1=G(o,16),this.dmq1=G(a,16),this.coeff=G(s,16)},W.prototype.generate=function(e,t){var n=new V,r=e>>1;this.e=parseInt(t,16);for(var i=new d(t,16),o=e/2-100,a=d.ONE.shiftLeft(o);;){for(;this.p=new d(e-r,1,n),0!=this.p.subtract(d.ONE).gcd(i).compareTo(d.ONE)||!this.p.isProbablePrime(10););for(;this.q=new d(r,1,n),0!=this.q.subtract(d.ONE).gcd(i).compareTo(d.ONE)||!this.q.isProbablePrime(10););if(this.p.compareTo(this.q)<=0){var s=this.p;this.p=this.q,this.q=s}var u=this.q.subtract(this.p).abs();if(!(u.bitLength()<o||u.compareTo(a)<=0)){var c=this.p.subtract(d.ONE),l=this.q.subtract(d.ONE),h=c.multiply(l);if(0==h.gcd(i).compareTo(d.ONE)&&(this.n=this.p.multiply(this.q),this.n.bitLength()==e)){this.d=i.modInverse(h),this.dmp1=this.d.mod(c),this.dmq1=this.d.mod(l),this.coeff=this.q.modInverse(this.p);break}}}this.isPrivate=!0},W.prototype.decrypt=function(e){if(e.length!=Math.ceil(this.n.bitLength()/4))throw new Error("wrong ctext length");var t=G(e,16),n=this.doPrivate(t);return null==n?null:function(e,t){for(var n=e.toByteArray(),r=0;r<n.length&&0==n[r];)++r;if(n.length-r!=t-1||2!=n[r])return null;for(++r;0!=n[r];)if(++r>=n.length)return null;for(var i="";++r<n.length;){var o=255&n[r];o<128?i+=String.fromCharCode(o):o>191&&o<224?(i+=String.fromCharCode((31&o)<<6|63&n[r+1]),++r):(i+=String.fromCharCode((15&o)<<12|(63&n[r+1])<<6|63&n[r+2]),r+=2)}return i}(n,this.n.bitLength()+7>>3)},W.prototype.decryptOAEP=function(e,t,n){if(e.length!=Math.ceil(this.n.bitLength()/4))throw new Error("wrong ctext length");var r=G(e,16),i=this.doPrivate(r);return null==i?null:function(e,t,n,r){var i=ee.crypto.MessageDigest,o=ee.crypto.Util,a=null;for(n||(n="sha1"),"string"===typeof n&&(a=i.getCanonicalAlgName(n),r=i.getHashLength(a),n=function(e){return ve(o.hashHex(ge(e),a))}),e=e.toByteArray(),s=0;s<e.length;s+=1)e[s]&=255;for(;e.length<t;)e.unshift(0);if((e=String.fromCharCode.apply(String,e)).length<2*r+2)throw"Cipher too short";var s,u=e.substr(1,r),c=e.substr(r+1),l=J(c,r,n),d=[];for(s=0;s<u.length;s+=1)d[s]=u.charCodeAt(s)^l.charCodeAt(s);var h=J(String.fromCharCode.apply(String,d),e.length-r,n),f=[];for(s=0;s<c.length;s+=1)f[s]=c.charCodeAt(s)^h.charCodeAt(s);if((f=String.fromCharCode.apply(String,f)).substr(0,r)!==n(""))throw"Hash mismatch";var p=(f=f.substr(r)).indexOf("\x01");if((-1!=p?f.substr(0,p).lastIndexOf("\0"):-1)+1!=p)throw"Malformed data";return f.substr(p+1)}(i,this.n.bitLength()+7>>3,t,n)},Q.prototype.equals=function(e){return e==this||this.q.equals(e.q)&&this.x.equals(e.x)},Q.prototype.toBigInteger=function(){return this.x},Q.prototype.negate=function(){return new Q(this.q,this.x.negate().mod(this.q))},Q.prototype.add=function(e){return new Q(this.q,this.x.add(e.toBigInteger()).mod(this.q))},Q.prototype.subtract=function(e){return new Q(this.q,this.x.subtract(e.toBigInteger()).mod(this.q))},Q.prototype.multiply=function(e){return new Q(this.q,this.x.multiply(e.toBigInteger()).mod(this.q))},Q.prototype.square=function(){return new Q(this.q,this.x.square().mod(this.q))},Q.prototype.divide=function(e){return new Q(this.q,this.x.multiply(e.toBigInteger().modInverse(this.q)).mod(this.q))},Q.prototype.sqrt=function(){return new Q(this.q,this.x.sqrt().mod(this.q))},Y.prototype.getX=function(){return null==this.zinv&&(this.zinv=this.z.modInverse(this.curve.q)),this.curve.fromBigInteger(this.x.toBigInteger().multiply(this.zinv).mod(this.curve.q))},Y.prototype.getY=function(){return null==this.zinv&&(this.zinv=this.z.modInverse(this.curve.q)),this.curve.fromBigInteger(this.y.toBigInteger().multiply(this.zinv).mod(this.curve.q))},Y.prototype.equals=function(e){return e==this||(this.isInfinity()?e.isInfinity():e.isInfinity()?this.isInfinity():!!e.y.toBigInteger().multiply(this.z).subtract(this.y.toBigInteger().multiply(e.z)).mod(this.curve.q).equals(d.ZERO)&&e.x.toBigInteger().multiply(this.z).subtract(this.x.toBigInteger().multiply(e.z)).mod(this.curve.q).equals(d.ZERO))},Y.prototype.isInfinity=function(){return null==this.x&&null==this.y||this.z.equals(d.ZERO)&&!this.y.toBigInteger().equals(d.ZERO)},Y.prototype.negate=function(){return new Y(this.curve,this.x,this.y.negate(),this.z)},Y.prototype.add=function(e){if(this.isInfinity())return e;if(e.isInfinity())return this;var t=e.y.toBigInteger().multiply(this.z).subtract(this.y.toBigInteger().multiply(e.z)).mod(this.curve.q),n=e.x.toBigInteger().multiply(this.z).subtract(this.x.toBigInteger().multiply(e.z)).mod(this.curve.q);if(d.ZERO.equals(n))return d.ZERO.equals(t)?this.twice():this.curve.getInfinity();var r=new d("3"),i=this.x.toBigInteger(),o=this.y.toBigInteger(),a=(e.x.toBigInteger(),e.y.toBigInteger(),n.square()),s=a.multiply(n),u=i.multiply(a),c=t.square().multiply(this.z),l=c.subtract(u.shiftLeft(1)).multiply(e.z).subtract(s).multiply(n).mod(this.curve.q),h=u.multiply(r).multiply(t).subtract(o.multiply(s)).subtract(c.multiply(t)).multiply(e.z).add(t.multiply(s)).mod(this.curve.q),f=s.multiply(this.z).multiply(e.z).mod(this.curve.q);return new Y(this.curve,this.curve.fromBigInteger(l),this.curve.fromBigInteger(h),f)},Y.prototype.twice=function(){if(this.isInfinity())return this;if(0==this.y.toBigInteger().signum())return this.curve.getInfinity();var e=new d("3"),t=this.x.toBigInteger(),n=this.y.toBigInteger(),r=n.multiply(this.z),i=r.multiply(n).mod(this.curve.q),o=this.curve.a.toBigInteger(),a=t.square().multiply(e);d.ZERO.equals(o)||(a=a.add(this.z.square().multiply(o)));var s=(a=a.mod(this.curve.q)).square().subtract(t.shiftLeft(3).multiply(i)).shiftLeft(1).multiply(r).mod(this.curve.q),u=a.multiply(e).multiply(t).subtract(i.shiftLeft(1)).shiftLeft(2).multiply(i).subtract(a.square().multiply(a)).mod(this.curve.q),c=r.square().multiply(r).shiftLeft(3).mod(this.curve.q);return new Y(this.curve,this.curve.fromBigInteger(s),this.curve.fromBigInteger(u),c)},Y.prototype.multiply=function(e){if(this.isInfinity())return this;if(0==e.signum())return this.curve.getInfinity();var t,n=e,r=n.multiply(new d("3")),i=this.negate(),o=this,a=this.curve.q.subtract(e),s=a.multiply(new d("3")),u=new Y(this.curve,this.x,this.y),c=u.negate();for(t=r.bitLength()-2;t>0;--t){o=o.twice();var l=r.testBit(t);l!=n.testBit(t)&&(o=o.add(l?this:i))}for(t=s.bitLength()-2;t>0;--t){u=u.twice();var h=s.testBit(t);h!=a.testBit(t)&&(u=u.add(h?u:c))}return o},Y.prototype.multiplyTwo=function(e,t,n){var r;r=e.bitLength()>n.bitLength()?e.bitLength()-1:n.bitLength()-1;for(var i=this.curve.getInfinity(),o=this.add(t);r>=0;)i=i.twice(),e.testBit(r)?i=n.testBit(r)?i.add(o):i.add(this):n.testBit(r)&&(i=i.add(t)),--r;return i},X.prototype.getQ=function(){return this.q},X.prototype.getA=function(){return this.a},X.prototype.getB=function(){return this.b},X.prototype.equals=function(e){return e==this||this.q.equals(e.q)&&this.a.equals(e.a)&&this.b.equals(e.b)},X.prototype.getInfinity=function(){return this.infinity},X.prototype.fromBigInteger=function(e){return new Q(this.q,e)},X.prototype.decodePointHex=function(e){switch(parseInt(e.substr(0,2),16)){case 0:return this.infinity;case 2:case 3:var t=e.substr(0,2),n=(e.substr(2),this.fromBigInteger(new d(s,16))),r=this.getA(),i=this.getB(),o=n.square().add(r).multiply(n).add(i).sqrt();return"03"==t&&(o=o.negate()),new Y(this,n,o);case 4:case 6:case 7:var a=(e.length-2)/2,s=e.substr(2,a),u=e.substr(a+2,a);return new Y(this,this.fromBigInteger(new d(s,16)),this.fromBigInteger(new d(u,16)));default:return null}},Q.prototype.getByteLength=function(){return Math.floor((this.toBigInteger().bitLength()+7)/8)},Y.prototype.getEncoded=function(e){var t=function(e,t){var n=e.toByteArrayUnsigned();if(t<n.length)n=n.slice(n.length-t);else for(;t>n.length;)n.unshift(0);return n},n=this.getX().toBigInteger(),r=this.getY().toBigInteger(),i=t(n,32);return e?r.isEven()?i.unshift(2):i.unshift(3):(i.unshift(4),i=i.concat(t(r,32))),i},Y.decodeFrom=function(e,t){t[0];var n=t.length-1,r=t.slice(1,1+n/2),i=t.slice(1+n/2,1+n);r.unshift(0),i.unshift(0);var o=new d(r),a=new d(i);return new Y(e,e.fromBigInteger(o),e.fromBigInteger(a))},Y.decodeFromHex=function(e,t){t.substr(0,2);var n=t.length-2,r=t.substr(2,n/2),i=t.substr(2+n/2,n/2),o=new d(r,16),a=new d(i,16);return new Y(e,e.fromBigInteger(o),e.fromBigInteger(a))},Y.prototype.add2D=function(e){if(this.isInfinity())return e;if(e.isInfinity())return this;if(this.x.equals(e.x))return this.y.equals(e.y)?this.twice():this.curve.getInfinity();var t=e.x.subtract(this.x),n=e.y.subtract(this.y).divide(t),r=n.square().subtract(this.x).subtract(e.x),i=n.multiply(this.x.subtract(r)).subtract(this.y);return new Y(this.curve,r,i)},Y.prototype.twice2D=function(){if(this.isInfinity())return this;if(0==this.y.toBigInteger().signum())return this.curve.getInfinity();var e=this.curve.fromBigInteger(d.valueOf(2)),t=this.curve.fromBigInteger(d.valueOf(3)),n=this.x.square().multiply(t).add(this.curve.a).divide(this.y.multiply(e)),r=n.square().subtract(this.x.multiply(e)),i=n.multiply(this.x.subtract(r)).subtract(this.y);return new Y(this.curve,r,i)},Y.prototype.multiply2D=function(e){if(this.isInfinity())return this;if(0==e.signum())return this.curve.getInfinity();var t,n=e,r=n.multiply(new d("3")),i=this.negate(),o=this;for(t=r.bitLength()-2;t>0;--t){o=o.twice();var a=r.testBit(t);a!=n.testBit(t)&&(o=o.add2D(a?this:i))}return o},Y.prototype.isOnCurve=function(){var e=this.getX().toBigInteger(),t=this.getY().toBigInteger(),n=this.curve.getA().toBigInteger(),r=this.curve.getB().toBigInteger(),i=this.curve.getQ(),o=t.multiply(t).mod(i),a=e.multiply(e).multiply(e).add(n.multiply(e)).add(r).mod(i);return o.equals(a)},Y.prototype.toString=function(){return"("+this.getX().toBigInteger().toString()+","+this.getY().toBigInteger().toString()+")"},Y.prototype.validate=function(){var e=this.curve.getQ();if(this.isInfinity())throw new Error("Point is at infinity.");var t=this.getX().toBigInteger(),n=this.getY().toBigInteger();if(t.compareTo(d.ONE)<0||t.compareTo(e.subtract(d.ONE))>0)throw new Error("x coordinate out of bounds");if(n.compareTo(d.ONE)<0||n.compareTo(e.subtract(d.ONE))>0)throw new Error("y coordinate out of bounds");if(!this.isOnCurve())throw new Error("Point is not on the curve.");if(this.multiply(e).isInfinity())throw new Error("Point is not a scalar multiple of G.");return!0};var $=function(){var e=new RegExp('(?:false|true|null|[\\{\\}\\[\\]]|(?:-?\\b(?:0|[1-9][0-9]*)(?:\\.[0-9]+)?(?:[eE][+-]?[0-9]+)?\\b)|(?:"(?:[^\\0-\\x08\\x0a-\\x1f"\\\\]|\\\\(?:["/\\\\bfnrt]|u[0-9A-Fa-f]{4}))*"))',"g"),t=new RegExp("\\\\(?:([^u])|u(.{4}))","g"),n={'"':'"',"/":"/","\\":"\\",b:"\b",f:"\f",n:"\n",r:"\r",t:"\t"};function r(e,t,r){return t?n[t]:String.fromCharCode(parseInt(r,16))}var i=new String(""),o=Object.hasOwnProperty;return function(n,a){var s,u,c=n.match(e),l=c[0],d=!1;"{"===l?s={}:"["===l?s=[]:(s=[],d=!0);for(var h=[s],f=1-d,p=c.length;f<p;++f){var v;switch((l=c[f]).charCodeAt(0)){default:(v=h[0])[u||v.length]=+l,u=void 0;break;case 34:if(-1!==(l=l.substring(1,l.length-1)).indexOf("\\")&&(l=l.replace(t,r)),v=h[0],!u){if(!(v instanceof Array)){u=l||i;break}u=v.length}v[u]=l,u=void 0;break;case 91:v=h[0],h.unshift(v[u||v.length]=[]),u=void 0;break;case 93:case 125:h.shift();break;case 102:(v=h[0])[u||v.length]=!1,u=void 0;break;case 110:(v=h[0])[u||v.length]=null,u=void 0;break;case 116:(v=h[0])[u||v.length]=!0,u=void 0;break;case 123:v=h[0],h.unshift(v[u||v.length]={}),u=void 0}}if(d){if(1!==h.length)throw new Error;s=s[0]}else if(h.length)throw new Error;if(a){s=function e(t,n){var r=t[n];if(r&&"object"===typeof r){var i=null;for(var s in r)if(o.call(r,s)&&r!==t){var u=e(r,s);void 0!==u?r[s]=u:(i||(i=[]),i.push(s))}if(i)for(var c=i.length;--c>=0;)delete r[i[c]]}return a.call(t,n,r)}({"":s},"")}return s}}();"undefined"!=typeof ee&&ee||(ee={}),"undefined"!=typeof ee.asn1&&ee.asn1||(ee.asn1={}),ee.asn1.ASN1Util=new function(){this.integerToByteHex=function(e){var t=e.toString(16);return t.length%2==1&&(t="0"+t),t},this.bigIntToMinTwosComplementsHex=function(e){var t=e.toString(16);if("-"!=t.substr(0,1))t.length%2==1?t="0"+t:t.match(/^[0-7]/)||(t="00"+t);else{var n=t.substr(1).length;n%2==1?n+=1:t.match(/^[0-7]/)||(n+=2);for(var r="",i=0;i<n;i++)r+="f";t=new d(r,16).xor(e).add(d.ONE).toString(16).replace(/^-/,"")}return t},this.getPEMStringFromHex=function(e,t){return we(e,t)},this.newObject=function(e){var t=ee.asn1,n=t.ASN1Object,r=t.DERBoolean,i=t.DERInteger,o=t.DERBitString,a=t.DEROctetString,s=t.DERNull,u=t.DERObjectIdentifier,c=t.DEREnumerated,l=t.DERUTF8String,d=t.DERNumericString,h=t.DERPrintableString,f=t.DERTeletexString,p=t.DERIA5String,v=t.DERUTCTime,g=t.DERGeneralizedTime,m=t.DERVisibleString,y=t.DERBMPString,b=t.DERSequence,w=t.DERSet,S=t.DERTaggedObject,k=t.ASN1Util.newObject;if(e instanceof t.ASN1Object)return e;var C=Object.keys(e);if(1!=C.length)throw new Error("key of param shall be only one.");var x=C[0];if(-1==":asn1:bool:int:bitstr:octstr:null:oid:enum:utf8str:numstr:prnstr:telstr:ia5str:utctime:gentime:visstr:bmpstr:seq:set:tag:".indexOf(":"+x+":"))throw new Error("undefined key: "+x);if("bool"==x)return new r(e[x]);if("int"==x)return new i(e[x]);if("bitstr"==x)return new o(e[x]);if("octstr"==x)return new a(e[x]);if("null"==x)return new s(e[x]);if("oid"==x)return new u(e[x]);if("enum"==x)return new c(e[x]);if("utf8str"==x)return new l(e[x]);if("numstr"==x)return new d(e[x]);if("prnstr"==x)return new h(e[x]);if("telstr"==x)return new f(e[x]);if("ia5str"==x)return new p(e[x]);if("utctime"==x)return new v(e[x]);if("gentime"==x)return new g(e[x]);if("visstr"==x)return new m(e[x]);if("bmpstr"==x)return new y(e[x]);if("asn1"==x)return new n(e[x]);if("seq"==x){for(var E=e[x],T=[],I=0;I<E.length;I++){var A=k(E[I]);T.push(A)}return new b({array:T})}if("set"==x){for(E=e[x],T=[],I=0;I<E.length;I++){A=k(E[I]);T.push(A)}return new w({array:T})}if("tag"==x){var R=e[x];if("[object Array]"===Object.prototype.toString.call(R)&&3==R.length){var _=k(R[2]);return new S({tag:R[0],explicit:R[1],obj:_})}return new S(R)}},this.jsonToASN1HEX=function(e){return this.newObject(e).tohex()}},ee.asn1.ASN1Util.oidHexToInt=function(e){for(var t="",n=parseInt(e.substr(0,2),16),r=(t=Math.floor(n/40)+"."+n%40,""),i=2;i<e.length;i+=2){var o=("00000000"+parseInt(e.substr(i,2),16).toString(2)).slice(-8);if(r+=o.substr(1,7),"0"==o.substr(0,1))t=t+"."+new d(r,2).toString(10),r=""}return t},ee.asn1.ASN1Util.oidIntToHex=function(e){var t=function(e){var t=e.toString(16);return 1==t.length&&(t="0"+t),t},n=function(e){var n="",r=new d(e,10).toString(2),i=7-r.length%7;7==i&&(i=0);for(var o="",a=0;a<i;a++)o+="0";r=o+r;for(a=0;a<r.length-1;a+=7){var s=r.substr(a,7);a!=r.length-7&&(s="1"+s),n+=t(parseInt(s,2))}return n};if(!e.match(/^[0-9.]+$/))throw"malformed oid string: "+e;var r="",i=e.split("."),o=40*parseInt(i[0])+parseInt(i[1]);r+=t(o),i.splice(0,2);for(var a=0;a<i.length;a++)r+=n(i[a]);return r},ee.asn1.ASN1Object=function(e){this.params=null,this.getLengthHexFromValue=function(){if("undefined"==typeof this.hV||null==this.hV)throw new Error("this.hV is null or undefined");if(this.hV.length%2==1)throw new Error("value hex must be even length: n=0,v="+this.hV);var e=this.hV.length/2,t=e.toString(16);if(t.length%2==1&&(t="0"+t),e<128)return t;var n=t.length/2;if(n>15)throw new Error("ASN.1 length too long to represent by 8x: n = "+e.toString(16));return(128+n).toString(16)+t},this.tohex=function(){return(null==this.hTLV||this.isModified)&&(this.hV=this.getFreshValueHex(),this.hL=this.getLengthHexFromValue(),this.hTLV=this.hT+this.hL+this.hV,this.isModified=!1),this.hTLV},this.getEncodedHex=function(){return this.tohex()},this.getValueHex=function(){return this.tohex(),this.hV},this.getFreshValueHex=function(){return""},this.setByParam=function(e){this.params=e},void 0!=e&&void 0!=e.tlv&&(this.hTLV=e.tlv,this.isModified=!1)},ee.asn1.DERAbstractString=function(e){ee.asn1.DERAbstractString.superclass.constructor.call(this);this.getString=function(){return this.s},this.setString=function(e){this.hTLV=null,this.isModified=!0,this.s=e,this.hV=he(this.s).toLowerCase()},this.setStringHex=function(e){this.hTLV=null,this.isModified=!0,this.s=null,this.hV=e},this.getFreshValueHex=function(){return this.hV},"undefined"!=typeof e&&("string"==typeof e?this.setString(e):"undefined"!=typeof e.str?this.setString(e.str):"undefined"!=typeof e.hex&&this.setStringHex(e.hex))},Ge(ee.asn1.DERAbstractString,ee.asn1.ASN1Object),ee.asn1.DERAbstractTime=function(e){ee.asn1.DERAbstractTime.superclass.constructor.call(this);this.localDateToUTC=function(e){var t=e.getTime()+6e4*e.getTimezoneOffset();return new Date(t)},this.formatDate=function(e,t,n){var r=this.zeroPadding,i=this.localDateToUTC(e),o=String(i.getFullYear());"utc"==t&&(o=o.substr(2,2));var a=o+r(String(i.getMonth()+1),2)+r(String(i.getDate()),2)+r(String(i.getHours()),2)+r(String(i.getMinutes()),2)+r(String(i.getSeconds()),2);if(!0===n){var s=i.getMilliseconds();if(0!=s){var u=r(String(s),3);a=a+"."+(u=u.replace(/[0]+$/,""))}}return a+"Z"},this.zeroPadding=function(e,t){return e.length>=t?e:new Array(t-e.length+1).join("0")+e},this.setByParam=function(e){this.hV=null,this.hTLV=null,this.params=e},this.getString=function(){},this.setString=function(e){this.hTLV=null,this.isModified=!0,void 0==this.params&&(this.params={}),this.params.str=e},this.setByDate=function(e){this.hTLV=null,this.isModified=!0,void 0==this.params&&(this.params={}),this.params.date=e},this.setByDateValue=function(e,t,n,r,i,o){var a=new Date(Date.UTC(e,t-1,n,r,i,o,0));this.setByDate(a)},this.getFreshValueHex=function(){return this.hV}},Ge(ee.asn1.DERAbstractTime,ee.asn1.ASN1Object),ee.asn1.DERAbstractStructured=function(e){ee.asn1.DERAbstractString.superclass.constructor.call(this);this.setByASN1ObjectArray=function(e){this.hTLV=null,this.isModified=!0,this.asn1Array=e},this.appendASN1Object=function(e){this.hTLV=null,this.isModified=!0,this.asn1Array.push(e)},this.asn1Array=new Array,"undefined"!=typeof e&&"undefined"!=typeof e.array&&(this.asn1Array=e.array)},Ge(ee.asn1.DERAbstractStructured,ee.asn1.ASN1Object),ee.asn1.DERBoolean=function(e){ee.asn1.DERBoolean.superclass.constructor.call(this),this.hT="01",this.hTLV=0==e?"010100":"0101ff"},Ge(ee.asn1.DERBoolean,ee.asn1.ASN1Object),ee.asn1.DERInteger=function(e){ee.asn1.DERInteger.superclass.constructor.call(this),this.hT="02",this.params=null;var t=ee.asn1.ASN1Util.bigIntToMinTwosComplementsHex;this.setByBigInteger=function(e){this.isModified=!0,this.params={bigint:e}},this.setByInteger=function(e){this.isModified=!0,this.params=e},this.setValueHex=function(e){this.isModified=!0,this.params={hex:e}},this.getFreshValueHex=function(){var e=this.params,n=null;if(null==e)throw new Error("value not set");if("object"==typeof e&&void 0!=e.hex)return this.hV=e.hex,this.hV;if("number"==typeof e)n=new d(String(e),10);else if(void 0!=e.int)n=new d(String(e.int),10);else{if(void 0==e.bigint)throw new Error("wrong parameter");n=e.bigint}return this.hV=t(n),this.hV},void 0!=e&&(this.params=e)},Ge(ee.asn1.DERInteger,ee.asn1.ASN1Object),ee.asn1.DERBitString=function(e){if(void 0!==e&&"undefined"!==typeof e.obj){var t=ee.asn1.ASN1Util.newObject(e.obj);e.hex="00"+t.tohex()}ee.asn1.DERBitString.superclass.constructor.call(this),this.hT="03",this.setHexValueIncludingUnusedBits=function(e){this.hTLV=null,this.isModified=!0,this.hV=e},this.setUnusedBitsAndHexValue=function(e,t){if(e<0||7<e)throw"unused bits shall be from 0 to 7: u = "+e;var n="0"+e;this.hTLV=null,this.isModified=!0,this.hV=n+t},this.setByBinaryString=function(e){var t=8-(e=e.replace(/0+$/,"")).length%8;8==t&&(t=0),e+="0000000".substr(0,t);for(var n="",r=0;r<e.length-1;r+=8){var i=e.substr(r,8),o=parseInt(i,2).toString(16);1==o.length&&(o="0"+o),n+=o}this.hTLV=null,this.isModified=!0,this.hV="0"+t+n},this.setByBooleanArray=function(e){for(var t="",n=0;n<e.length;n++)1==e[n]?t+="1":t+="0";this.setByBinaryString(t)},this.newFalseArray=function(e){for(var t=new Array(e),n=0;n<e;n++)t[n]=!1;return t},this.getFreshValueHex=function(){return this.hV},"undefined"!=typeof e&&("string"==typeof e&&e.toLowerCase().match(/^[0-9a-f]+$/)?this.setHexValueIncludingUnusedBits(e):"undefined"!=typeof e.hex?this.setHexValueIncludingUnusedBits(e.hex):"undefined"!=typeof e.bin?this.setByBinaryString(e.bin):"undefined"!=typeof e.array&&this.setByBooleanArray(e.array))},Ge(ee.asn1.DERBitString,ee.asn1.ASN1Object),ee.asn1.DEROctetString=function(e){if(void 0!==e&&"undefined"!==typeof e.obj){var t=ee.asn1.ASN1Util.newObject(e.obj);e.hex=t.tohex()}ee.asn1.DEROctetString.superclass.constructor.call(this,e),this.hT="04"},Ge(ee.asn1.DEROctetString,ee.asn1.DERAbstractString),ee.asn1.DERNull=function(){ee.asn1.DERNull.superclass.constructor.call(this),this.hT="05",this.hTLV="0500"},Ge(ee.asn1.DERNull,ee.asn1.ASN1Object),ee.asn1.DERObjectIdentifier=function(e){ee.asn1.DERObjectIdentifier.superclass.constructor.call(this),this.hT="06",this.setValueHex=function(e){this.hTLV=null,this.isModified=!0,this.s=null,this.hV=e},this.setValueOidString=function(e){var t=Le(e);if(null==t)throw new Error("malformed oid string: "+e);this.hTLV=null,this.isModified=!0,this.s=null,this.hV=t},this.setValueName=function(e){var t=ee.asn1.x509.OID.name2oid(e);if(""===t)throw new Error("DERObjectIdentifier oidName undefined: "+e);this.setValueOidString(t)},this.setValueNameOrOid=function(e){e.match(/^[0-2].[0-9.]+$/)?this.setValueOidString(e):this.setValueName(e)},this.getFreshValueHex=function(){return this.hV},this.setByParam=function(e){"string"===typeof e?this.setValueNameOrOid(e):void 0!==e.oid?this.setValueNameOrOid(e.oid):void 0!==e.name?this.setValueNameOrOid(e.name):void 0!==e.hex&&this.setValueHex(e.hex)},void 0!==e&&this.setByParam(e)},Ge(ee.asn1.DERObjectIdentifier,ee.asn1.ASN1Object),ee.asn1.DEREnumerated=function(e){ee.asn1.DEREnumerated.superclass.constructor.call(this),this.hT="0a",this.setByBigInteger=function(e){this.hTLV=null,this.isModified=!0,this.hV=ee.asn1.ASN1Util.bigIntToMinTwosComplementsHex(e)},this.setByInteger=function(e){var t=new d(String(e),10);this.setByBigInteger(t)},this.setValueHex=function(e){this.hV=e},this.getFreshValueHex=function(){return this.hV},"undefined"!=typeof e&&("undefined"!=typeof e.int?this.setByInteger(e.int):"number"==typeof e?this.setByInteger(e):"undefined"!=typeof e.hex&&this.setValueHex(e.hex))},Ge(ee.asn1.DEREnumerated,ee.asn1.ASN1Object),ee.asn1.DERUTF8String=function(e){ee.asn1.DERUTF8String.superclass.constructor.call(this,e),this.hT="0c"},Ge(ee.asn1.DERUTF8String,ee.asn1.DERAbstractString),ee.asn1.DERNumericString=function(e){ee.asn1.DERNumericString.superclass.constructor.call(this,e),this.hT="12"},Ge(ee.asn1.DERNumericString,ee.asn1.DERAbstractString),ee.asn1.DERPrintableString=function(e){ee.asn1.DERPrintableString.superclass.constructor.call(this,e),this.hT="13"},Ge(ee.asn1.DERPrintableString,ee.asn1.DERAbstractString),ee.asn1.DERTeletexString=function(e){ee.asn1.DERTeletexString.superclass.constructor.call(this,e),this.hT="14"},Ge(ee.asn1.DERTeletexString,ee.asn1.DERAbstractString),ee.asn1.DERIA5String=function(e){ee.asn1.DERIA5String.superclass.constructor.call(this,e),this.hT="16"},Ge(ee.asn1.DERIA5String,ee.asn1.DERAbstractString),ee.asn1.DERVisibleString=function(e){ee.asn1.DERIA5String.superclass.constructor.call(this,e),this.hT="1a"},Ge(ee.asn1.DERVisibleString,ee.asn1.DERAbstractString),ee.asn1.DERBMPString=function(e){ee.asn1.DERBMPString.superclass.constructor.call(this,e),this.hT="1e"},Ge(ee.asn1.DERBMPString,ee.asn1.DERAbstractString),ee.asn1.DERUTCTime=function(e){ee.asn1.DERUTCTime.superclass.constructor.call(this,e),this.hT="17",this.params=void 0,this.getFreshValueHex=function(){var e=this.params;if(void 0==this.params&&(e={date:new Date}),"string"==typeof e){if(!e.match(/^[0-9]{12}Z$/)&&!e.match(/^[0-9]{12}\.[0-9]+Z$/))throw new Error("malformed string for UTCTime: "+e);this.hV=se(e)}else if(void 0!=e.str)this.hV=se(e.str);else if(void 0==e.date&&1==e.millis){var t=new Date;this.hV=se(this.formatDate(t,"utc",!0))}else if(void 0!=e.date&&e.date instanceof Date){var n=!0===e.millis;this.hV=se(this.formatDate(e.date,"utc",n))}else e instanceof Date&&(this.hV=se(this.formatDate(e,"utc")));if(void 0==this.hV)throw new Error("parameter not specified properly for UTCTime");return this.hV},void 0!=e&&this.setByParam(e)},Ge(ee.asn1.DERUTCTime,ee.asn1.DERAbstractTime),ee.asn1.DERGeneralizedTime=function(e){ee.asn1.DERGeneralizedTime.superclass.constructor.call(this,e),this.hT="18",this.params=e,this.getFreshValueHex=function(){var e=this.params;if(void 0==this.params&&(e={date:new Date}),"string"==typeof e){if(!e.match(/^[0-9]{14}Z$/)&&!e.match(/^[0-9]{14}\.[0-9]+Z$/))throw new Error("malformed string for GeneralizedTime: "+e);this.hV=se(e)}else if(void 0!=e.str)this.hV=se(e.str);else if(void 0==e.date&&1==e.millis){var t=new Date;this.hV=se(this.formatDate(t,"gen",!0))}else if(void 0!=e.date&&e.date instanceof Date){var n=!0===e.millis;this.hV=se(this.formatDate(e.date,"gen",n))}else e instanceof Date&&(this.hV=se(this.formatDate(e,"gen")));if(void 0==this.hV)throw new Error("parameter not specified properly for GeneralizedTime");return this.hV},void 0!=e&&this.setByParam(e)},Ge(ee.asn1.DERGeneralizedTime,ee.asn1.DERAbstractTime),ee.asn1.DERSequence=function(e){ee.asn1.DERSequence.superclass.constructor.call(this,e),this.hT="30",this.getFreshValueHex=function(){for(var e="",t=0;t<this.asn1Array.length;t++){e+=this.asn1Array[t].tohex()}return this.hV=e,this.hV}},Ge(ee.asn1.DERSequence,ee.asn1.DERAbstractStructured),ee.asn1.DERSet=function(e){ee.asn1.DERSet.superclass.constructor.call(this,e),this.hT="31",this.sortFlag=!0,this.getFreshValueHex=function(){for(var e=new Array,t=0;t<this.asn1Array.length;t++){var n=this.asn1Array[t];e.push(n.tohex())}return 1==this.sortFlag&&e.sort(),this.hV=e.join(""),this.hV},"undefined"!=typeof e&&"undefined"!=typeof e.sortflag&&0==e.sortflag&&(this.sortFlag=!1)},Ge(ee.asn1.DERSet,ee.asn1.DERAbstractStructured),ee.asn1.DERTaggedObject=function(e){ee.asn1.DERTaggedObject.superclass.constructor.call(this);var t=ee.asn1,n=re,r=n.getV,i=(n.isASN1HEX,t.ASN1Util.newObject);this.hT="a0",this.hV="",this.isExplicit=!0,this.asn1Object=null,this.params={tag:"a0",explicit:!0},this.setASN1Object=function(e,t,n){this.params={tag:t,explicit:e,obj:n}},this.getFreshValueHex=function(){var e=this.params;if(void 0==e.explicit&&(e.explicit=!0),void 0!=e.tage&&(e.tag=e.tage,e.explicit=!0),void 0!=e.tagi&&(e.tag=e.tagi,e.explicit=!1),void 0!=e.str)this.hV=he(e.str);else if(void 0!=e.hex)this.hV=e.hex;else{if(void 0==e.obj)throw new Error("str, hex nor obj not specified");var n;e.obj instanceof t.ASN1Object?n=e.obj.tohex():"object"==typeof e.obj&&(n=i(e.obj).tohex()),e.explicit?this.hV=n:this.hV=r(n,0)}return void 0==e.tag&&(e.tag="a0"),this.hT=e.tag,this.hTLV=null,this.isModified=!0,this.hV},this.setByParam=function(e){this.params=e},void 0!==e&&this.setByParam(e)},Ge(ee.asn1.DERTaggedObject,ee.asn1.ASN1Object);var ee,te,ne,re=new function(){};function ie(e){for(var t=new Array,n=0;n<e.length;n++)t[n]=e.charCodeAt(n);return t}function oe(e){for(var t="",n=0;n<e.length;n++)t+=String.fromCharCode(e[n]);return t}function ae(e){for(var t="",n=0;n<e.length;n++){var r=e[n].toString(16);1==r.length&&(r="0"+r),t+=r}return t}function se(e){return ae(ie(e))}function ue(e){return e=(e=(e=e.replace(/\=/g,"")).replace(/\+/g,"-")).replace(/\//g,"_")}function ce(e){return e.length%4==2?e+="==":e.length%4==3&&(e+="="),e=(e=e.replace(/-/g,"+")).replace(/_/g,"/")}function le(e){return e.length%2==1&&(e="0"+e),ue(u(e))}function de(e){return c(ce(e))}function he(e){return Ee(Me(e)).toLowerCase()}function fe(e){try{return decodeURIComponent(Te(e))}catch(t){return null}}function pe(e){return fe(function(e){for(var t=e.match(/.{1,2}/g),n=[],r=0;r<t.length;r++){var i=parseInt(t[r],16);161<=i&&i<=191?(n.push("c2"),n.push(t[r])):192<=i&&i<=255?(n.push("c3"),n.push((i-64).toString(16))):n.push(t[r])}return n.join("")}(e))}function ve(e){for(var t="",n=0;n<e.length-1;n+=2)t+=String.fromCharCode(parseInt(e.substr(n,2),16));return t}function ge(e){for(var t="",n=0;n<e.length;n++)t+=("0"+e.charCodeAt(n).toString(16)).slice(-2);return t}function me(e){return u(e)}function ye(e,t){return e=(e=e.replace(new RegExp("(.{"+t+"})","g"),"$1\r\n")).replace(/\s+$/,"")}function be(e){return c(e.replace(/[^0-9A-Za-z\/+=]*/g,""))}function we(e,t){return"-----BEGIN "+t+"-----\r\n"+ye(me(e),64)+"\r\n-----END "+t+"-----\r\n"}function Se(e,t){if(-1==e.indexOf("-----BEGIN "))throw new Error("can't find PEM header");return be(e=void 0!==t?(e=e.replace(new RegExp("^[^]*-----BEGIN "+t+"-----"),"")).replace(new RegExp("-----END "+t+"-----[^]*$"),""):(e=e.replace(/^[^]*-----BEGIN [^-]+-----/,"")).replace(/-----END [^-]+-----[^]*$/,""))}function ke(e){var t,n,r,i,o,a,s,u,c,l;if(l=(e=xe(e)).match(/^(\d{4})(\d\d)(\d\d)(\d\d)(\d\d)(\d\d)(|\.\d+)Z$/))return t=parseInt(l[1]),n=parseInt(l[2])-1,r=parseInt(l[3]),i=parseInt(l[4]),o=parseInt(l[5]),a=parseInt(l[6]),s=0,""!==(u=l[7])&&(c=(u.substr(1)+"00").substr(0,3),s=parseInt(c)),Date.UTC(t,n,r,i,o,a,s);throw new Error("unsupported zulu format: "+e)}function Ce(e){return Math.round(ke(e)/1e3)}function xe(e){return e.match(/^[0-9]{12}Z$/)||e.match(/^[0-9]{12}[.][0-9]*Z$/)?e.match(/^[0-4]/)?"20"+e:"19"+e:e}function Ee(e){return e.replace(/%/g,"")}function Te(e){return e.replace(/(..)/g,"%$1")}function Ie(e){var t="malformed IPv6 address";if(!e.match(/^[0-9A-Fa-f:]+$/))throw t;var n=(e=e.toLowerCase()).split(":").length-1;if(n<2)throw t;var r=":".repeat(7-n+2),i=(e=e.replace("::",r)).split(":");if(8!=i.length)throw t;for(var o=0;o<8;o++)i[o]=("0000"+i[o]).slice(-4);return i.join("")}function Ae(e){if(!e.match(/^[0-9A-Fa-f]{32}$/))throw new Error("malformed IPv6 address: "+e);var t=(e=e.toLowerCase()).match(/.{1,4}/g),n=(e=":"+(t=(t=t.map((function(e){return e.replace(/^0+/,"")}))).map((function(e){return""==e?"0":e}))).join(":")+":").match(/:(0:){2,}/g);if(null==n)return e.slice(1,-1);var r=n.sort().slice(-1)[0];return"::"!=(e=e.replace(r.substr(0,r.length-1),":")).substr(0,2)&&(e=e.substr(1)),"::"!=e.substr(-2,2)&&(e=e.substr(0,e.length-1)),e}function Re(e){var t=new Error("malformed hex value");if(!e.match(/^([0-9A-Fa-f][0-9A-Fa-f]){1,}$/))throw t;if(8==e.length){try{return parseInt(e.substr(0,2),16)+"."+parseInt(e.substr(2,2),16)+"."+parseInt(e.substr(4,2),16)+"."+parseInt(e.substr(6,2),16)}catch(n){throw t}}else{if(16!=e.length){if(32==e.length)return Ae(e);if(64==e.length){try{return Ae(e.substr(0,32))+"/"+_e(e.substr(32))}catch(n){throw t}return}return e}try{return Re(e.substr(0,8))+"/"+_e(e.substr(8))}catch(n){throw t}}}function _e(e){var t,n=new Error("malformed mask");try{t=new d(e,16).toString(2)}catch(r){throw n}if(!t.match(/^1*0*$/))throw n;return t.replace(/0+$/,"").length}function Pe(e){var t=new Error("malformed IP address");if(!(e=e.toLowerCase(e)).match(/^[0-9a-f.:/]+$/))throw t;if(!e.match(/^[0-9.]+$/)){var n;if(e.match(/^[0-9.]+\/[0-9]+$/))return Pe((n=e.split("/"))[0])+Ne(parseInt(n[1]),32);if(e.match(/^[0-9a-f:]+$/)&&-1!==e.indexOf(":"))return Ie(e);if(e.match(/^[0-9a-f:]+\/[0-9]+$/)&&-1!==e.indexOf(":"))return Ie((n=e.split("/"))[0])+Ne(parseInt(n[1]),128);throw t}var r=e.split(".");if(4!==r.length)throw t;var i="";try{for(var o=0;o<4;o++){i+=("0"+parseInt(r[o]).toString(16)).slice(-2)}return i}catch(a){throw t}}function Ne(e,t){return 32==t&&0==e?"00000000":128==t&&0==e?"00000000000000000000000000000000":new d(Array(e+1).join("1")+Array(t-e+1).join("0"),2).toString(16)}function Oe(e){return e.match(/.{4}/g).map((function(e){var t=parseInt(e.substr(0,2),16),n=parseInt(e.substr(2),16);if(0==t&n<128)return String.fromCharCode(n);if(t<8){var r=128|63&n;return fe((192|(7&t)<<3|(192&n)>>6).toString(16)+r.toString(16))}r=128|(15&t)<<2|(192&n)>>6;var i=128|63&n;return fe((224|(240&t)>>4).toString(16)+r.toString(16)+i.toString(16))})).join("")}function Me(e){for(var t=encodeURIComponent(e),n="",r=0;r<t.length;r++)"%"==t[r]?(n+=t.substr(r,3),r+=2):n=n+"%"+se(t[r]);return n}function Fe(e){return!(e.length%2!=0||!e.match(/^[0-9a-f]+$/)&&!e.match(/^[0-9A-F]+$/))}function Ze(e){return!!e.match(/^[0-9A-Za-z-_.]+$/)}function De(e){return e.length%2==1?"0"+e:e.substr(0,1)>"7"?"00"+e:e}re.getLblen=function(e,t){if("8"!=e.substr(t+2,1))return 1;var n=parseInt(e.substr(t+3,1));return 0==n?-1:0<n&&n<10?n+1:-2},re.getL=function(e,t){var n=re.getLblen(e,t);return n<1?"":e.substr(t+2,2*n)},re.getVblen=function(e,t){var n;return""==(n=re.getL(e,t))?-1:("8"===n.substr(0,1)?new d(n.substr(2),16):new d(n,16)).intValue()},re.getVidx=function(e,t){var n=re.getLblen(e,t);return n<0?n:t+2*(n+1)},re.getV=function(e,t){var n=re.getVidx(e,t),r=re.getVblen(e,t);return e.substr(n,2*r)},re.getTLV=function(e,t){return e.substr(t,2)+re.getL(e,t)+re.getV(e,t)},re.getTLVblen=function(e,t){return 2+2*re.getLblen(e,t)+2*re.getVblen(e,t)},re.getNextSiblingIdx=function(e,t){return re.getVidx(e,t)+2*re.getVblen(e,t)},re.getChildIdx=function(e,t){var n,r,i,o=re,a=[];n=o.getVidx(e,t),r=2*o.getVblen(e,t),"03"==e.substr(t,2)&&(n+=2,r-=2),i=0;for(var s=n;i<=r;){var u=o.getTLVblen(e,s);if((i+=u)<=r&&a.push(s),s+=u,i>=r)break}return a},re.getNthChildIdx=function(e,t,n){return re.getChildIdx(e,t)[n]},re.getIdxbyList=function(e,t,n,r){var i,o,a=re;return 0==n.length?void 0!==r&&e.substr(t,2)!==r?-1:t:(i=n.shift())>=(o=a.getChildIdx(e,t)).length?-1:a.getIdxbyList(e,o[i],n,r)},re.getIdxbyListEx=function(e,t,n,r){var i,o,a=re;if(0==n.length)return void 0!==r&&e.substr(t,2)!==r?-1:t;i=n.shift(),o=a.getChildIdx(e,t);for(var s=0,u=0;u<o.length;u++){var c=e.substr(o[u],2);if("number"==typeof i&&!a.isContextTag(c)&&s==i||"string"==typeof i&&a.isContextTag(c,i))return a.getIdxbyListEx(e,o[u],n,r);a.isContextTag(c)||s++}return-1},re.getTLVbyList=function(e,t,n,r){var i=re,o=i.getIdxbyList(e,t,n,r);return-1==o||o>=e.length?null:i.getTLV(e,o)},re.getTLVbyListEx=function(e,t,n,r){var i=re,o=i.getIdxbyListEx(e,t,n,r);return-1==o?null:i.getTLV(e,o)},re.getVbyList=function(e,t,n,r,i){var o,a,s=re;return-1==(o=s.getIdxbyList(e,t,n,r))||o>=e.length?null:(a=s.getV(e,o),!0===i&&(a=a.substr(2)),a)},re.getVbyListEx=function(e,t,n,r,i){var o,a,s=re;return-1==(o=s.getIdxbyListEx(e,t,n,r))?null:(a=s.getV(e,o),"03"==e.substr(o,2)&&!1!==i&&(a=a.substr(2)),a)},re.getInt=function(e,t,n){void 0==n&&(n=-1);try{var r=e.substr(t,2);if("02"!=r&&"03"!=r)return n;var i=re.getV(e,t);return"02"==r?parseInt(i,16):je(i)}catch(o){return n}},re.getOID=function(e,t,n){void 0==n&&(n=null);try{return"06"!=e.substr(t,2)?n:Be(re.getV(e,t))}catch(r){return n}},re.getOIDName=function(e,t,n){void 0==n&&(n=null);try{var r=re.getOID(e,t,n);if(r==n)return n;var i=ee.asn1.x509.OID.oid2name(r);return""==i?r:i}catch(o){return n}},re.getString=function(e,t,n){void 0==n&&(n=null);try{return ve(re.getV(e,t))}catch(r){return n}},re.hextooidstr=function(e){var t=function(e,t){return e.length>=t?e:new Array(t-e.length+1).join("0")+e},n=[],r=e.substr(0,2),i=parseInt(r,16);n[0]=new String(Math.floor(i/40)),n[1]=new String(i%40);for(var o=e.substr(2),a=[],s=0;s<o.length/2;s++)a.push(parseInt(o.substr(2*s,2),16));var u=[],c="";for(s=0;s<a.length;s++)128&a[s]?c+=t((127&a[s]).toString(2),7):(c+=t((127&a[s]).toString(2),7),u.push(new String(parseInt(c,2))),c="");var l=n.join(".");return u.length>0&&(l=l+"."+u.join(".")),l},re.dump=function(e,t,n,r){var i=re,o=i.getV,a=i.dump,s=i.getChildIdx,u=e;e instanceof ee.asn1.ASN1Object&&(u=e.tohex());var c=function(e,t){return e.length<=2*t?e:e.substr(0,t)+"..(total "+e.length/2+"bytes).."+e.substr(e.length-t,t)};void 0===t&&(t={ommit_long_octet:32}),void 0===n&&(n=0),void 0===r&&(r="");var l,d=t.ommit_long_octet;if("01"==(l=u.substr(n,2)))return"00"==(h=o(u,n))?r+"BOOLEAN FALSE\n":r+"BOOLEAN TRUE\n";if("02"==l)return r+"INTEGER "+c(h=o(u,n),d)+"\n";if("03"==l){var h=o(u,n);if(i.isASN1HEX(h.substr(2))){var f=r+"BITSTRING, encapsulates\n";return f+=a(h.substr(2),t,0,r+"  ")}return r+"BITSTRING "+c(h,d)+"\n"}if("04"==l){h=o(u,n);if(i.isASN1HEX(h)){f=r+"OCTETSTRING, encapsulates\n";return f+=a(h,t,0,r+"  ")}return r+"OCTETSTRING "+c(h,d)+"\n"}if("05"==l)return r+"NULL\n";if("06"==l){var p=o(u,n),v=ee.asn1.ASN1Util.oidHexToInt(p),g=ee.asn1.x509.OID.oid2name(v),m=v.replace(/\./g," ");return""!=g?r+"ObjectIdentifier "+g+" ("+m+")\n":r+"ObjectIdentifier ("+m+")\n"}if("0a"==l)return r+"ENUMERATED "+parseInt(o(u,n))+"\n";if("0c"==l)return r+"UTF8String '"+fe(o(u,n))+"'\n";if("13"==l)return r+"PrintableString '"+fe(o(u,n))+"'\n";if("14"==l)return r+"TeletexString '"+fe(o(u,n))+"'\n";if("16"==l)return r+"IA5String '"+fe(o(u,n))+"'\n";if("17"==l)return r+"UTCTime "+fe(o(u,n))+"\n";if("18"==l)return r+"GeneralizedTime "+fe(o(u,n))+"\n";if("1a"==l)return r+"VisualString '"+fe(o(u,n))+"'\n";if("1e"==l)return r+"BMPString '"+Oe(o(u,n))+"'\n";if("30"==l){if("3000"==u.substr(n,4))return r+"SEQUENCE {}\n";f=r+"SEQUENCE\n";var y=t;if((2==(S=s(u,n)).length||3==S.length)&&"06"==u.substr(S[0],2)&&"04"==u.substr(S[S.length-1],2)){g=i.oidname(o(u,S[0]));var b=JSON.parse(JSON.stringify(t));b.x509ExtName=g,y=b}for(var w=0;w<S.length;w++)f+=a(u,y,S[w],r+"  ");return f}if("31"==l){f=r+"SET\n";var S=s(u,n);for(w=0;w<S.length;w++)f+=a(u,t,S[w],r+"  ");return f}if(0!=(128&(l=parseInt(l,16)))){var k=31&l;if(0!=(32&l)){for(f=r+"["+k+"]\n",S=s(u,n),w=0;w<S.length;w++)f+=a(u,t,S[w],r+"  ");return f}h=o(u,n);if(re.isASN1HEX(h)){var f=r+"["+k+"]\n";return f+=a(h,t,0,r+"  ")}return("68747470"==h.substr(0,8)||"subjectAltName"===t.x509ExtName&&2==k)&&(h=fe(h)),f=r+"["+k+"] "+h+"\n"}return r+"UNKNOWN("+l+") "+o(u,n)+"\n"},re.parse=function(e){var t=re,n=t.parse,r=t.isASN1HEX,i=t.getV,o=t.getTLV,a=t.getChildIdx,s=ee.asn1,u=s.ASN1Util.oidHexToInt,c=s.x509.OID.oid2name,l=fe,d=Oe,h=pe,f={"0c":"utf8str",12:"numstr",13:"prnstr",14:"telstr",16:"ia5str",17:"utctime",18:"gentime","1a":"visstr","1e":"bmpstr",30:"seq",31:"set"},p=e.substr(0,2),v={},g=i(e,0);if("01"==p)return"0101ff"==e?{bool:!0}:{bool:!1};if("02"==p)return{int:{hex:g}};if("03"==p)try{if("00"!=g.substr(0,2))throw"not encap";var m=g.substr(2);if(!r(m))throw"not encap";return{bitstr:{obj:n(m)}}}catch(H){var y=null;return g.length<=10&&(y=He(g)),null==y?{bitstr:{hex:g}}:{bitstr:{bin:y}}}else if("04"==p)try{if(!r(g))throw"not encap";return{octstr:{obj:n(g)}}}catch(H){return{octstr:{hex:g}}}else{if("05"==p)return{null:""};if("06"==p){var b=u(g),w=c(b);return""==w?{oid:b}:{oid:w}}if("0a"==p)return g.length>4?{enum:{hex:g}}:{enum:parseInt(g,16)};if("30"==p||"31"==p)return v[f[p]]=function(e){for(var t=[],r=a(e,0),i=0;i<r.length;i++){var s=r[i],u=o(e,s),c=n(u);t.push(c)}return t}(e),v;if("14"==p){var S=h(g);return v[f[p]]={str:S},v}if("1e"==p){S=d(g);return v[f[p]]={str:S},v}if(-1!=":0c:12:13:16:17:18:1a:".indexOf(p)){S=l(g);return v[f[p]]={str:S},v}if(p.match(/^8[0-9]$/))return null==(S=l(g))|""==S||null!=S.match(/[\x00-\x1F\x7F-\x9F]/)||null!=S.match(/[\u0000-\u001F\u0080\u2013\u009F]/)?{tag:{tag:p,explicit:!1,hex:g}}:{tag:{tag:p,explicit:!1,str:S}};if(!p.match(/^a[0-9]$/)){var k=new ee.asn1.ASN1Object;return k.hV=g,{asn1:{tlv:p+k.getLengthHexFromValue()+g}}}try{if(!r(g))throw new Error("not encap");return{tag:{tag:p,explicit:!0,obj:n(g)}}}catch(H){return{tag:{tag:p,explicit:!0,hex:g}}}}},re.isContextTag=function(e,t){var n,r;e=e.toLowerCase();try{n=parseInt(e,16)}catch(i){return-1}if(void 0===t)return 128==(192&n);try{return null!=t.match(/^\[[0-9]+\]$/)&&(!((r=parseInt(t.substr(1,t.length-1),10))>31)&&(128==(192&n)&&(31&n)==r))}catch(i){return!1}},re.isASN1HEX=function(e){var t=re;if(e.length%2==1)return!1;var n=t.getVblen(e,0),r=e.substr(0,2),i=t.getL(e,0);return e.length-r.length-i.length==2*n},re.checkStrictDER=function(e,t,n,r,i){var o=re;if(void 0===n){if("string"!=typeof e)throw new Error("not hex string");if(e=e.toLowerCase(),!ee.lang.String.isHex(e))throw new Error("not hex string");n=e.length,i=(r=e.length/2)<128?1:Math.ceil(r.toString(16))+1}if(o.getL(e,t).length>2*i)throw new Error("L of TLV too long: idx="+t);var a=o.getVblen(e,t);if(a>r)throw new Error("value of L too long than hex: idx="+t);var s=o.getTLV(e,t),u=s.length-2-o.getL(e,t).length;if(u!==2*a)throw new Error("V string length and L's value not the same:"+u+"/"+2*a);if(0===t&&e.length!=s.length)throw new Error("total length and TLV length unmatch:"+e.length+"!="+s.length);var c=e.substr(t,2);if("02"===c){var l=o.getVidx(e,t);if("00"==e.substr(l,2)&&e.charCodeAt(l+2)<56)throw new Error("not least zeros for DER INTEGER")}if(32&parseInt(c,16)){for(var d=o.getVblen(e,t),h=0,f=o.getChildIdx(e,t),p=0;p<f.length;p++){h+=o.getTLV(e,f[p]).length,o.checkStrictDER(e,f[p],n,r,i)}if(2*d!=h)throw new Error("sum of children's TLV length and L unmatch: "+2*d+"!="+h)}},re.oidname=function(e){var t=ee.asn1;ee.lang.String.isHex(e)&&(e=t.ASN1Util.oidHexToInt(e));var n=t.x509.OID.oid2name(e);return""===n&&(n=e),n},"undefined"!=typeof ee&&ee||(ee={}),"undefined"!=typeof ee.asn1&&ee.asn1||(ee.asn1={}),"undefined"!=typeof ee.asn1.x509&&ee.asn1.x509||(ee.asn1.x509={}),ee.asn1.x509.Certificate=function(e){ee.asn1.x509.Certificate.superclass.constructor.call(this);var t=ee.asn1,n=t.DERBitString,r=t.DERSequence,i=t.x509,o=i.TBSCertificate,a=i.AlgorithmIdentifier;this.params=void 0,this.setByParam=function(e){this.params=e},this.sign=function(){var e=this.params,t=e.sigalg;void 0!=e.sigalg.name&&(t=e.sigalg.name);var n=e.tbsobj.tohex(),r=new ee.crypto.Signature({alg:t});r.init(e.cakey),r.updateHex(n),e.sighex=r.sign()},this.getPEM=function(){return we(this.tohex(),"CERTIFICATE")},this.tohex=function(){var e=this.params;if(void 0!=e.tbsobj&&null!=e.tbsobj||(e.tbsobj=new o(e)),void 0==e.sighex&&void 0!=e.cakey&&this.sign(),void 0==e.sighex)throw new Error("sighex or cakey parameter not defined");var t=[];return t.push(e.tbsobj),t.push(new a({name:e.sigalg})),t.push(new n({hex:"00"+e.sighex})),new r({array:t}).tohex()},this.getEncodedHex=function(){return this.tohex()},void 0!=e&&(this.params=e)},Ge(ee.asn1.x509.Certificate,ee.asn1.ASN1Object),ee.asn1.x509.TBSCertificate=function(e){ee.asn1.x509.TBSCertificate.superclass.constructor.call(this);var t=ee.asn1,n=t.x509,r=t.DERTaggedObject,i=t.DERInteger,o=t.DERSequence,a=n.AlgorithmIdentifier,s=n.Time,u=n.X500Name,c=n.Extensions,l=n.SubjectPublicKeyInfo;this.params=null,this.setByParam=function(e){this.params=e},this.tohex=function(){var e=[],t=this.params;if(void 0!=t.version||1!=t.version){var n=2;void 0!=t.version&&(n=t.version-1);var d=new r({obj:new i({int:n})});e.push(d)}return e.push(new i(t.serial)),e.push(new a({name:t.sigalg})),e.push(new u(t.issuer)),e.push(new o({array:[new s(t.notbefore),new s(t.notafter)]})),e.push(new u(t.subject)),e.push(new l(Ke.getKey(t.sbjpubkey))),void 0!==t.ext&&t.ext.length>0&&e.push(new r({tag:"a3",obj:new c(t.ext)})),new ee.asn1.DERSequence({array:e}).tohex()},this.getEncodedHex=function(){return this.tohex()},void 0!==e&&this.setByParam(e)},Ge(ee.asn1.x509.TBSCertificate,ee.asn1.ASN1Object),ee.asn1.x509.Extensions=function(e){ee.asn1.x509.Extensions.superclass.constructor.call(this);var t=ee.asn1,n=t.DERSequence,r=t.x509;this.aParam=[],this.setByParam=function(e){this.aParam=e},this.tohex=function(){for(var e=[],t=0;t<this.aParam.length;t++){var i=this.aParam[t],o=i.extname,a=null;if(void 0!=i.extn)a=new r.PrivateExtension(i);else if("subjectKeyIdentifier"==o)a=new r.SubjectKeyIdentifier(i);else if("keyUsage"==o)a=new r.KeyUsage(i);else if("subjectAltName"==o)a=new r.SubjectAltName(i);else if("issuerAltName"==o)a=new r.IssuerAltName(i);else if("basicConstraints"==o)a=new r.BasicConstraints(i);else if("nameConstraints"==o)a=new r.NameConstraints(i);else if("cRLDistributionPoints"==o)a=new r.CRLDistributionPoints(i);else if("certificatePolicies"==o)a=new r.CertificatePolicies(i);else if("policyMappings"==o)a=new r.PolicyMappings(i);else if("policyConstraints"==o)a=new r.PolicyConstraints(i);else if("inhibitAnyPolicy"==o)a=new r.InhibitAnyPolicy(i);else if("authorityKeyIdentifier"==o)a=new r.AuthorityKeyIdentifier(i);else if("extKeyUsage"==o)a=new r.ExtKeyUsage(i);else if("authorityInfoAccess"==o)a=new r.AuthorityInfoAccess(i);else if("cRLNumber"==o)a=new r.CRLNumber(i);else if("cRLReason"==o)a=new r.CRLReason(i);else if("ocspNonce"==o)a=new r.OCSPNonce(i);else if("ocspNoCheck"==o)a=new r.OCSPNoCheck(i);else if("adobeTimeStamp"==o)a=new r.AdobeTimeStamp(i);else{if("subjectDirectoryAttributes"!=o)throw new Error("extension not supported:"+JSON.stringify(i));a=new r.SubjectDirectoryAttributes(i)}null!=a&&e.push(a)}return new n({array:e}).tohex()},this.getEncodedHex=function(){return this.tohex()},void 0!=e&&this.setByParam(e)},Ge(ee.asn1.x509.Extensions,ee.asn1.ASN1Object),ee.asn1.x509.Extension=function(e){ee.asn1.x509.Extension.superclass.constructor.call(this);var t=ee.asn1,n=t.DERObjectIdentifier,r=t.DEROctetString,i=(t.DERBitString,t.DERBoolean),o=t.DERSequence;this.tohex=function(){var e=new n({oid:this.oid}),t=new r({hex:this.getExtnValueHex()}),a=new Array;return a.push(e),this.critical&&a.push(new i),a.push(t),new o({array:a}).tohex()},this.getEncodedHex=function(){return this.tohex()},this.critical=!1,void 0!==e&&void 0!==e.critical&&(this.critical=e.critical)},Ge(ee.asn1.x509.Extension,ee.asn1.ASN1Object),ee.asn1.x509.KeyUsage=function(e){ee.asn1.x509.KeyUsage.superclass.constructor.call(this,e);var t=Error,n={digitalSignature:0,nonRepudiation:1,keyEncipherment:2,dataEncipherment:3,keyAgreement:4,keyCertSign:5,cRLSign:6,encipherOnly:7,decipherOnly:8};this.getExtnValueHex=function(){var e=this.getBinValue();return this.asn1ExtnValue=new ee.asn1.DERBitString({bin:e}),this.asn1ExtnValue.tohex()},this.getBinValue=function(){var e=this.params;if("object"!=typeof e||"object"!=typeof e.names&&"string"!=typeof e.bin)throw new t("parameter not yet set");if(void 0!=e.names)return ze(e.names,n);if(void 0!=e.bin)return e.bin;throw new t("parameter not set properly")},this.oid="2.5.29.15",void 0!==e&&(this.params=e)},Ge(ee.asn1.x509.KeyUsage,ee.asn1.x509.Extension),ee.asn1.x509.BasicConstraints=function(e){ee.asn1.x509.BasicConstraints.superclass.constructor.call(this,e);var t=ee.asn1,n=t.DERBoolean,r=t.DERInteger,i=t.DERSequence;this.getExtnValueHex=function(){var e=new Array;this.cA&&e.push(new n),this.pathLen>-1&&e.push(new r({int:this.pathLen}));var t=new i({array:e});return this.asn1ExtnValue=t,this.asn1ExtnValue.tohex()},this.oid="2.5.29.19",this.cA=!1,this.pathLen=-1,void 0!==e&&(void 0!==e.cA&&(this.cA=e.cA),void 0!==e.pathLen&&(this.pathLen=e.pathLen))},Ge(ee.asn1.x509.BasicConstraints,ee.asn1.x509.Extension),ee.asn1.x509.CRLDistributionPoints=function(e){ee.asn1.x509.CRLDistributionPoints.superclass.constructor.call(this,e);var t=ee.asn1,n=t.x509;this.getExtnValueHex=function(){return this.asn1ExtnValue.tohex()},this.setByDPArray=function(e){for(var r=[],i=0;i<e.length;i++)if(e[i]instanceof ee.asn1.ASN1Object)r.push(e[i]);else{var o=new n.DistributionPoint(e[i]);r.push(o)}this.asn1ExtnValue=new t.DERSequence({array:r})},this.setByOneURI=function(e){var t=new n.DistributionPoint({fulluri:e});this.setByDPArray([t])},this.oid="2.5.29.31",void 0!==e&&(void 0!==e.array?this.setByDPArray(e.array):void 0!==e.uri&&this.setByOneURI(e.uri))},Ge(ee.asn1.x509.CRLDistributionPoints,ee.asn1.x509.Extension),ee.asn1.x509.DistributionPoint=function(e){ee.asn1.x509.DistributionPoint.superclass.constructor.call(this);var t=ee.asn1,n=t.x509.DistributionPointName;this.tohex=function(){var e=new t.DERSequence;if(null!=this.asn1DP){var n=new t.DERTaggedObject({explicit:!0,tag:"a0",obj:this.asn1DP});e.appendASN1Object(n)}return this.hTLV=e.tohex(),this.hTLV},this.getEncodedHex=function(){return this.tohex()},void 0!==e&&(void 0!==e.dpobj?this.asn1DP=e.dpobj:void 0!==e.dpname?this.asn1DP=new n(e.dpname):void 0!==e.fulluri&&(this.asn1DP=new n({full:[{uri:e.fulluri}]})))},Ge(ee.asn1.x509.DistributionPoint,ee.asn1.ASN1Object),ee.asn1.x509.DistributionPointName=function(e){ee.asn1.x509.DistributionPointName.superclass.constructor.call(this);var t=ee.asn1,n=t.DERTaggedObject;if(this.tohex=function(){if("full"!=this.type)throw new Error("currently type shall be 'full': "+this.type);return this.asn1Obj=new n({explicit:!1,tag:this.tag,obj:this.asn1V}),this.hTLV=this.asn1Obj.tohex(),this.hTLV},this.getEncodedHex=function(){return this.tohex()},void 0!==e)if(t.x509.GeneralNames.prototype.isPrototypeOf(e))this.type="full",this.tag="a0",this.asn1V=e;else{if(void 0===e.full)throw new Error("This class supports GeneralNames only as argument");this.type="full",this.tag="a0",this.asn1V=new t.x509.GeneralNames(e.full)}},Ge(ee.asn1.x509.DistributionPointName,ee.asn1.ASN1Object),ee.asn1.x509.CertificatePolicies=function(e){ee.asn1.x509.CertificatePolicies.superclass.constructor.call(this,e);var t=ee.asn1,n=t.x509,r=t.DERSequence,i=n.PolicyInformation;this.params=null,this.getExtnValueHex=function(){for(var e=[],t=0;t<this.params.array.length;t++)e.push(new i(this.params.array[t]));var n=new r({array:e});return this.asn1ExtnValue=n,this.asn1ExtnValue.tohex()},this.oid="2.5.29.32",void 0!==e&&(this.params=e)},Ge(ee.asn1.x509.CertificatePolicies,ee.asn1.x509.Extension),ee.asn1.x509.PolicyInformation=function(e){ee.asn1.x509.PolicyInformation.superclass.constructor.call(this,e);var t=ee.asn1,n=t.DERSequence,r=t.DERObjectIdentifier,i=t.x509.PolicyQualifierInfo;this.params=null,this.tohex=function(){if(void 0===this.params.policyoid&&void 0===this.params.array)throw new Error("parameter oid and array missing");var e=[new r(this.params.policyoid)];if(void 0!==this.params.array){for(var t=[],o=0;o<this.params.array.length;o++)t.push(new i(this.params.array[o]));t.length>0&&e.push(new n({array:t}))}return new n({array:e}).tohex()},this.getEncodedHex=function(){return this.tohex()},void 0!==e&&(this.params=e)},Ge(ee.asn1.x509.PolicyInformation,ee.asn1.ASN1Object),ee.asn1.x509.PolicyQualifierInfo=function(e){ee.asn1.x509.PolicyQualifierInfo.superclass.constructor.call(this,e);var t=ee.asn1,n=t.DERSequence,r=t.DERIA5String,i=t.DERObjectIdentifier,o=t.x509.UserNotice;this.params=null,this.tohex=function(){return void 0!==this.params.cps?new n({array:[new i({oid:"1.3.6.1.5.5.7.2.1"}),new r({str:this.params.cps})]}).tohex():void 0!=this.params.unotice?new n({array:[new i({oid:"1.3.6.1.5.5.7.2.2"}),new o(this.params.unotice)]}).tohex():void 0},this.getEncodedHex=function(){return this.tohex()},void 0!==e&&(this.params=e)},Ge(ee.asn1.x509.PolicyQualifierInfo,ee.asn1.ASN1Object),ee.asn1.x509.UserNotice=function(e){ee.asn1.x509.UserNotice.superclass.constructor.call(this,e);var t=ee.asn1.DERSequence,n=(ee.asn1.DERInteger,ee.asn1.x509.DisplayText),r=ee.asn1.x509.NoticeReference;this.params=null,this.tohex=function(){var e=[];return void 0!==this.params.noticeref&&e.push(new r(this.params.noticeref)),void 0!==this.params.exptext&&e.push(new n(this.params.exptext)),new t({array:e}).tohex()},this.getEncodedHex=function(){return this.tohex()},void 0!==e&&(this.params=e)},Ge(ee.asn1.x509.UserNotice,ee.asn1.ASN1Object),ee.asn1.x509.NoticeReference=function(e){ee.asn1.x509.NoticeReference.superclass.constructor.call(this,e);var t=ee.asn1.DERSequence,n=ee.asn1.DERInteger,r=ee.asn1.x509.DisplayText;this.params=null,this.tohex=function(){var e=[];if(void 0!==this.params.org&&e.push(new r(this.params.org)),void 0!==this.params.noticenum){for(var i=[],o=this.params.noticenum,a=0;a<o.length;a++)i.push(new n(o[a]));e.push(new t({array:i}))}if(0==e.length)throw new Error("parameter is empty");return new t({array:e}).tohex()},this.getEncodedHex=function(){return this.tohex()},void 0!==e&&(this.params=e)},Ge(ee.asn1.x509.NoticeReference,ee.asn1.ASN1Object),ee.asn1.x509.DisplayText=function(e){ee.asn1.x509.DisplayText.superclass.constructor.call(this,e),this.hT="0c",void 0!==e&&("ia5"===e.type?this.hT="16":"vis"===e.type?this.hT="1a":"bmp"===e.type&&(this.hT="1e"))},Ge(ee.asn1.x509.DisplayText,ee.asn1.DERAbstractString),ee.asn1.x509.PolicyMappings=function(e){ee.asn1.x509.PolicyMappings.superclass.constructor.call(this,e);var t=ee.asn1,n=(t.x509,t.ASN1Util.newObject);this.params=null,this.getExtnValueHex=function(){for(var e=this.params,t=[],r=0;r<e.array.length;r++){var i=e.array[r];t.push({seq:[{oid:i[0]},{oid:i[1]}]})}return this.asn1ExtnValue=n({seq:t}),this.asn1ExtnValue.tohex()},this.oid="2.5.29.33",void 0!==e&&(this.params=e)},Ge(ee.asn1.x509.PolicyMappings,ee.asn1.x509.Extension),ee.asn1.x509.PolicyConstraints=function(e){ee.asn1.x509.PolicyConstraints.superclass.constructor.call(this,e);var t=ee.asn1,n=(t.x509,t.ASN1Util.newObject);this.params=null,this.getExtnValueHex=function(){var e=this.params,t=[];return void 0!=e.reqexp&&t.push({tag:{tagi:"80",obj:{int:e.reqexp}}}),void 0!=e.inhibit&&t.push({tag:{tagi:"81",obj:{int:e.inhibit}}}),this.asn1ExtnValue=n({seq:t}),this.asn1ExtnValue.tohex()},this.oid="2.5.29.36",void 0!==e&&(this.params=e)},Ge(ee.asn1.x509.PolicyConstraints,ee.asn1.x509.Extension),ee.asn1.x509.InhibitAnyPolicy=function(e){ee.asn1.x509.InhibitAnyPolicy.superclass.constructor.call(this,e);var t=ee.asn1,n=(t.x509,t.ASN1Util.newObject);this.params=null,this.getExtnValueHex=function(){return this.asn1ExtnValue=n({int:this.params.skip}),this.asn1ExtnValue.tohex()},this.oid="2.5.29.54",void 0!==e&&(this.params=e)},Ge(ee.asn1.x509.InhibitAnyPolicy,ee.asn1.x509.Extension),ee.asn1.x509.NameConstraints=function(e){ee.asn1.x509.NameConstraints.superclass.constructor.call(this,e);var t=ee.asn1,n=t.x509,r=t.ASN1Util.newObject,i=n.GeneralSubtree;this.params=null,this.getExtnValueHex=function(){var e=this.params,t=[];if(void 0!=e.permit&&void 0!=e.permit.length){for(var n=[],o=0;o<e.permit.length;o++)n.push(new i(e.permit[o]));t.push({tag:{tagi:"a0",obj:{seq:n}}})}if(void 0!=e.exclude&&void 0!=e.exclude.length){var a=[];for(o=0;o<e.exclude.length;o++)a.push(new i(e.exclude[o]));t.push({tag:{tagi:"a1",obj:{seq:a}}})}return this.asn1ExtnValue=r({seq:t}),this.asn1ExtnValue.tohex()},this.oid="2.5.29.30",void 0!==e&&(this.params=e)},Ge(ee.asn1.x509.NameConstraints,ee.asn1.x509.Extension),ee.asn1.x509.GeneralSubtree=function(e){ee.asn1.x509.GeneralSubtree.superclass.constructor.call(this);var t=ee.asn1,n=t.x509.GeneralName,r=t.ASN1Util.newObject;this.params=null,this.setByParam=function(e){this.params=e},this.tohex=function(){var e=this.params,t=[new n(e)];return void 0!=e.min&&t.push({tag:{tagi:"80",obj:{int:e.min}}}),void 0!=e.max&&t.push({tag:{tagi:"81",obj:{int:e.max}}}),r({seq:t}).tohex()},this.getEncodedHex=function(){return this.tohex()},void 0!==e&&this.setByParam(e)},Ge(ee.asn1.x509.GeneralSubtree,ee.asn1.ASN1Object),ee.asn1.x509.ExtKeyUsage=function(e){ee.asn1.x509.ExtKeyUsage.superclass.constructor.call(this,e);var t=ee.asn1;this.setPurposeArray=function(e){this.asn1ExtnValue=new t.DERSequence;for(var n=0;n<e.length;n++){var r=new t.DERObjectIdentifier(e[n]);this.asn1ExtnValue.appendASN1Object(r)}},this.getExtnValueHex=function(){return this.asn1ExtnValue.tohex()},this.oid="2.5.29.37",void 0!==e&&void 0!==e.array&&this.setPurposeArray(e.array)},Ge(ee.asn1.x509.ExtKeyUsage,ee.asn1.x509.Extension),ee.asn1.x509.AuthorityKeyIdentifier=function(e){ee.asn1.x509.AuthorityKeyIdentifier.superclass.constructor.call(this,e);var t=ee,n=t.asn1,r=n.DERTaggedObject,i=n.x509.GeneralNames;t.crypto.Util.isKey;this.asn1KID=null,this.asn1CertIssuer=null,this.asn1CertSN=null,this.getExtnValueHex=function(){var e=new Array;this.asn1KID&&e.push(new r({explicit:!1,tag:"80",obj:this.asn1KID})),this.asn1CertIssuer&&e.push(new r({explicit:!1,tag:"a1",obj:new i([{dn:this.asn1CertIssuer}])})),this.asn1CertSN&&e.push(new r({explicit:!1,tag:"82",obj:this.asn1CertSN}));var t=new n.DERSequence({array:e});return this.asn1ExtnValue=t,this.asn1ExtnValue.tohex()},this.setKIDByParam=function(e){if(void 0!==e.str||void 0!==e.hex)this.asn1KID=new ee.asn1.DEROctetString(e);else if("object"===typeof e&&ee.crypto.Util.isKey(e)||"string"===typeof e&&-1!=e.indexOf("BEGIN ")){var t=e;"string"===typeof e&&(t=Ke.getKey(e));var n=Ke.getKeyID(t);this.asn1KID=new ee.asn1.DEROctetString({hex:n})}},this.setCertIssuerByParam=function(e){void 0!==e.str||void 0!==e.ldapstr||void 0!==e.hex||void 0!==e.certsubject||void 0!==e.certissuer?this.asn1CertIssuer=new ee.asn1.x509.X500Name(e):"string"===typeof e&&-1!=e.indexOf("BEGIN ")&&-1!=e.indexOf("CERTIFICATE")&&(this.asn1CertIssuer=new ee.asn1.x509.X500Name({certissuer:e}))},this.setCertSNByParam=function(e){if(void 0!==e.str||void 0!==e.bigint||void 0!==e.hex)this.asn1CertSN=new ee.asn1.DERInteger(e);else if("string"===typeof e&&-1!=e.indexOf("BEGIN ")&&e.indexOf("CERTIFICATE")){var t=new Ye;t.readCertPEM(e);var n=t.getSerialNumberHex();this.asn1CertSN=new ee.asn1.DERInteger({hex:n})}},this.oid="2.5.29.35",void 0!==e&&(void 0!==e.kid&&this.setKIDByParam(e.kid),void 0!==e.issuer&&this.setCertIssuerByParam(e.issuer),void 0!==e.sn&&this.setCertSNByParam(e.sn),void 0!==e.issuersn&&"string"===typeof e.issuersn&&-1!=e.issuersn.indexOf("BEGIN ")&&e.issuersn.indexOf("CERTIFICATE")&&(this.setCertSNByParam(e.issuersn),this.setCertIssuerByParam(e.issuersn)))},Ge(ee.asn1.x509.AuthorityKeyIdentifier,ee.asn1.x509.Extension),ee.asn1.x509.SubjectKeyIdentifier=function(e){ee.asn1.x509.SubjectKeyIdentifier.superclass.constructor.call(this,e);var t=ee.asn1.DEROctetString;this.asn1KID=null,this.getExtnValueHex=function(){return this.asn1ExtnValue=this.asn1KID,this.asn1ExtnValue.tohex()},this.setKIDByParam=function(e){if(void 0!==e.str||void 0!==e.hex)this.asn1KID=new t(e);else if("object"===typeof e&&ee.crypto.Util.isKey(e)||"string"===typeof e&&-1!=e.indexOf("BEGIN")){var n=e;"string"===typeof e&&(n=Ke.getKey(e));var r=Ke.getKeyID(n);this.asn1KID=new ee.asn1.DEROctetString({hex:r})}},this.oid="2.5.29.14",void 0!==e&&void 0!==e.kid&&this.setKIDByParam(e.kid)},Ge(ee.asn1.x509.SubjectKeyIdentifier,ee.asn1.x509.Extension),ee.asn1.x509.AuthorityInfoAccess=function(e){ee.asn1.x509.AuthorityInfoAccess.superclass.constructor.call(this,e),this.setAccessDescriptionArray=function(e){for(var t=new Array,n=ee.asn1,r=n.DERSequence,i=n.DERObjectIdentifier,o=n.x509.GeneralName,a=0;a<e.length;a++){var s,u=e[a];if(void 0!==u.ocsp)s=new r({array:[new i({oid:"1.3.6.1.5.5.7.48.1"}),new o({uri:u.ocsp})]});else{if(void 0===u.caissuer)throw new Error("unknown AccessMethod parameter: "+JSON.stringify(u));s=new r({array:[new i({oid:"1.3.6.1.5.5.7.48.2"}),new o({uri:u.caissuer})]})}t.push(s)}this.asn1ExtnValue=new r({array:t})},this.getExtnValueHex=function(){return this.asn1ExtnValue.tohex()},this.oid="1.3.6.1.5.5.7.1.1",void 0!==e&&void 0!==e.array&&this.setAccessDescriptionArray(e.array)},Ge(ee.asn1.x509.AuthorityInfoAccess,ee.asn1.x509.Extension),ee.asn1.x509.SubjectAltName=function(e){ee.asn1.x509.SubjectAltName.superclass.constructor.call(this,e),this.setNameArray=function(e){this.asn1ExtnValue=new ee.asn1.x509.GeneralNames(e)},this.getExtnValueHex=function(){return this.asn1ExtnValue.tohex()},this.oid="2.5.29.17",void 0!==e&&void 0!==e.array&&this.setNameArray(e.array)},Ge(ee.asn1.x509.SubjectAltName,ee.asn1.x509.Extension),ee.asn1.x509.IssuerAltName=function(e){ee.asn1.x509.IssuerAltName.superclass.constructor.call(this,e),this.setNameArray=function(e){this.asn1ExtnValue=new ee.asn1.x509.GeneralNames(e)},this.getExtnValueHex=function(){return this.asn1ExtnValue.tohex()},this.oid="2.5.29.18",void 0!==e&&void 0!==e.array&&this.setNameArray(e.array)},Ge(ee.asn1.x509.IssuerAltName,ee.asn1.x509.Extension),ee.asn1.x509.SubjectDirectoryAttributes=function(e){ee.asn1.x509.SubjectDirectoryAttributes.superclass.constructor.call(this,e);var t=ee.asn1,n=t.DERSequence,r=t.ASN1Util.newObject,i=t.x509.OID.name2oid;this.params=null,this.getExtnValueHex=function(){for(var e=[],t=0;t<this.params.array.length;t++){var o=this.params.array[t];if(void 0==o.attr||void 0==o.array){var a={seq:[{oid:"1.2.3.4"},{set:[{utf8str:"DE"}]}]};if("dateOfBirth"==o.attr)a.seq[0].oid=i(o.attr),a.seq[1].set[0]={gentime:o.str};else if("placeOfBirth"==o.attr)a.seq[0].oid=i(o.attr),a.seq[1].set[0]={utf8str:o.str};else if("gender"==o.attr)a.seq[0].oid=i(o.attr),a.seq[1].set[0]={prnstr:o.str};else if("countryOfCitizenship"==o.attr)a.seq[0].oid=i(o.attr),a.seq[1].set[0]={prnstr:o.str};else{if("countryOfResidence"!=o.attr)throw new Error("unsupported attribute: "+o.attr);a.seq[0].oid=i(o.attr),a.seq[1].set[0]={prnstr:o.str}}e.push(new r(a))}else{var s={seq:[{oid:o.attr},{set:o.array}]};e.push(r(s))}}var u=new n({array:e});return this.asn1ExtnValue=u,this.asn1ExtnValue.tohex()},this.oid="2.5.29.9",void 0!==e&&(this.params=e)},Ge(ee.asn1.x509.SubjectDirectoryAttributes,ee.asn1.x509.Extension),ee.asn1.x509.PrivateExtension=function(e){ee.asn1.x509.PrivateExtension.superclass.constructor.call(this,e);var t=ee,n=t.lang.String.isHex,r=t.asn1,i=r.x509.OID.name2oid,o=r.ASN1Util.newObject;this.params=null,this.setByParam=function(e){this.oid=i(e.extname),this.params=e},this.getExtnValueHex=function(){if(void 0==this.params.extname||void 0==this.params.extn)throw new Error("extname or extnhex not specified");var e=this.params.extn;if("string"==typeof e&&n(e))return e;if("object"==typeof e)try{return o(e).tohex()}catch(t){}throw new Error("unsupported extn value")},void 0!=e&&this.setByParam(e)},Ge(ee.asn1.x509.PrivateExtension,ee.asn1.x509.Extension),ee.asn1.x509.CRL=function(e){ee.asn1.x509.CRL.superclass.constructor.call(this);var t=ee.asn1,n=t.DERSequence,r=t.DERBitString,i=t.x509,o=i.AlgorithmIdentifier,a=i.TBSCertList;this.params=void 0,this.setByParam=function(e){this.params=e},this.sign=function(){var e=new a(this.params).tohex(),t=new ee.crypto.Signature({alg:this.params.sigalg});t.init(this.params.cakey),t.updateHex(e);var n=t.sign();this.params.sighex=n},this.getPEM=function(){return we(this.tohex(),"X509 CRL")},this.tohex=function(){var e=this.params;if(void 0==e.tbsobj&&(e.tbsobj=new a(e)),void 0==e.sighex&&void 0!=e.cakey&&this.sign(),void 0==e.sighex)throw new Error("sighex or cakey parameter not defined");var t=[];return t.push(e.tbsobj),t.push(new o({name:e.sigalg})),t.push(new r({hex:"00"+e.sighex})),new n({array:t}).tohex()},this.getEncodedHex=function(){return this.tohex()},void 0!=e&&(this.params=e)},Ge(ee.asn1.x509.CRL,ee.asn1.ASN1Object),ee.asn1.x509.TBSCertList=function(e){ee.asn1.x509.TBSCertList.superclass.constructor.call(this);var t=ee.asn1,n=t.DERInteger,r=t.DERSequence,i=t.DERTaggedObject,o=(t.DERObjectIdentifier,t.x509),a=o.AlgorithmIdentifier,s=o.Time,u=o.Extensions,c=o.X500Name;this.params=null,this.setByParam=function(e){this.params=e},this.getRevCertSequence=function(){for(var e=[],t=this.params.revcert,i=0;i<t.length;i++){var o=[new n(t[i].sn),new s(t[i].date)];void 0!=t[i].ext&&o.push(new u(t[i].ext)),e.push(new r({array:o}))}return new r({array:e})},this.tohex=function(){var e=[],t=this.params;if(void 0!=t.version){var o=t.version-1,l=new n({int:o});e.push(l)}if(e.push(new a({name:t.sigalg})),e.push(new c(t.issuer)),e.push(new s(t.thisupdate)),void 0!=t.nextupdate&&e.push(new s(t.nextupdate)),void 0!=t.revcert&&e.push(this.getRevCertSequence()),void 0!=t.ext){var d=new u(t.ext);e.push(new i({tag:"a0",explicit:!0,obj:d}))}return new r({array:e}).tohex()},this.getEncodedHex=function(){return this.tohex()},void 0!==e&&this.setByParam(e)},Ge(ee.asn1.x509.TBSCertList,ee.asn1.ASN1Object),ee.asn1.x509.CRLEntry=function(e){ee.asn1.x509.CRLEntry.superclass.constructor.call(this);var t=ee.asn1;this.setCertSerial=function(e){this.sn=new t.DERInteger(e)},this.setRevocationDate=function(e){this.time=new t.x509.Time(e)},this.tohex=function(){var e=new t.DERSequence({array:[this.sn,this.time]});return this.TLV=e.tohex(),this.TLV},this.getEncodedHex=function(){return this.tohex()},void 0!==e&&(void 0!==e.time&&this.setRevocationDate(e.time),void 0!==e.sn&&this.setCertSerial(e.sn))},Ge(ee.asn1.x509.CRLEntry,ee.asn1.ASN1Object),ee.asn1.x509.CRLNumber=function(e){ee.asn1.x509.CRLNumber.superclass.constructor.call(this,e),this.params=void 0,this.getExtnValueHex=function(){return this.asn1ExtnValue=new ee.asn1.DERInteger(this.params.num),this.asn1ExtnValue.tohex()},this.oid="2.5.29.20",void 0!=e&&(this.params=e)},Ge(ee.asn1.x509.CRLNumber,ee.asn1.x509.Extension),ee.asn1.x509.CRLReason=function(e){ee.asn1.x509.CRLReason.superclass.constructor.call(this,e),this.params=void 0,this.getExtnValueHex=function(){return this.asn1ExtnValue=new ee.asn1.DEREnumerated(this.params.code),this.asn1ExtnValue.tohex()},this.oid="2.5.29.21",void 0!=e&&(this.params=e)},Ge(ee.asn1.x509.CRLReason,ee.asn1.x509.Extension),ee.asn1.x509.OCSPNonce=function(e){ee.asn1.x509.OCSPNonce.superclass.constructor.call(this,e),this.params=void 0,this.getExtnValueHex=function(){return this.asn1ExtnValue=new ee.asn1.DEROctetString(this.params),this.asn1ExtnValue.tohex()},this.oid="1.3.6.1.5.5.7.48.1.2",void 0!=e&&(this.params=e)},Ge(ee.asn1.x509.OCSPNonce,ee.asn1.x509.Extension),ee.asn1.x509.OCSPNoCheck=function(e){ee.asn1.x509.OCSPNoCheck.superclass.constructor.call(this,e),this.params=void 0,this.getExtnValueHex=function(){return this.asn1ExtnValue=new ee.asn1.DERNull,this.asn1ExtnValue.tohex()},this.oid="1.3.6.1.5.5.7.48.1.5",void 0!=e&&(this.params=e)},Ge(ee.asn1.x509.OCSPNoCheck,ee.asn1.x509.Extension),ee.asn1.x509.AdobeTimeStamp=function(e){ee.asn1.x509.AdobeTimeStamp.superclass.constructor.call(this,e);var t=ee.asn1,n=t.DERInteger,r=t.DERBoolean,i=t.DERSequence,o=t.x509.GeneralName;this.params=null,this.getExtnValueHex=function(){var e=this.params,t=[new n(1)];return t.push(new o({uri:e.uri})),void 0!=e.reqauth&&t.push(new r(e.reqauth)),this.asn1ExtnValue=new i({array:t}),this.asn1ExtnValue.tohex()},this.oid="1.2.840.113583.1.1.9.1",void 0!==e&&this.setByParam(e)},Ge(ee.asn1.x509.AdobeTimeStamp,ee.asn1.x509.Extension),ee.asn1.x509.X500Name=function(e){ee.asn1.x509.X500Name.superclass.constructor.call(this),this.asn1Array=[],this.paramArray=[],this.sRule="utf8";var t=ee.asn1,n=t.x509,r=n.RDN;this.setByString=function(e,t){void 0!==t&&(this.sRule=t);var n=e.split("/");n.shift();for(var i=[],o=0;o<n.length;o++)if(n[o].match(/^[^=]+=.+$/))i.push(n[o]);else{var a=i.length-1;i[a]=i[a]+"/"+n[o]}for(o=0;o<i.length;o++)this.asn1Array.push(new r({str:i[o],rule:this.sRule}))},this.setByLdapString=function(e,t){void 0!==t&&(this.sRule=t);var r=n.X500Name.ldapToCompat(e);this.setByString(r,t)},this.setByObject=function(e,t){for(var n in void 0!==t&&(this.sRule=t),e)if(e.hasOwnProperty(n)){var i=new r({str:n+"="+e[n],rule:this.sRule});this.asn1Array?this.asn1Array.push(i):this.asn1Array=[i]}},this.setByParam=function(e){var t;(void 0!==e.rule&&(this.sRule=e.rule),void 0!==e.array)?this.paramArray=e.array:void 0!==e.str?this.setByString(e.str):void 0!==e.ldapstr?this.setByLdapString(e.ldapstr):void 0!==e.hex?this.hTLV=e.hex:void 0!==e.certissuer?((t=new Ye).readCertPEM(e.certissuer),this.hTLV=t.getIssuerHex()):void 0!==e.certsubject?((t=new Ye).readCertPEM(e.certsubject),this.hTLV=t.getSubjectHex()):"object"===typeof e&&void 0===e.certsubject&&void 0===e.certissuer&&this.setByObject(e)},this.tohex=function(){if("string"==typeof this.hTLV)return this.hTLV;if(0==this.asn1Array.length&&this.paramArray.length>0)for(var e=0;e<this.paramArray.length;e++){var n={array:this.paramArray[e]};"utf8"!=this.sRule&&(n.rule=this.sRule);var i=new r(n);this.asn1Array.push(i)}var o=new t.DERSequence({array:this.asn1Array});return this.hTLV=o.tohex(),this.hTLV},this.getEncodedHex=function(){return this.tohex()},void 0!==e&&this.setByParam(e)},Ge(ee.asn1.x509.X500Name,ee.asn1.ASN1Object),ee.asn1.x509.X500Name.compatToLDAP=function(e){if("/"!==e.substr(0,1))throw"malformed input";var t=(e=e.substr(1)).split("/");return t.reverse(),(t=t.map((function(e){return e.replace(/,/,"\\,")}))).join(",")},ee.asn1.x509.X500Name.onelineToLDAP=function(e){return ee.asn1.x509.X500Name.compatToLDAP(e)},ee.asn1.x509.X500Name.ldapToCompat=function(e){for(var t=e.split(","),n=!1,r=[],i=0;t.length>0;i++){var o=t.shift();if(!0===n){var a=(r.pop()+","+o).replace(/\\,/g,",");r.push(a),n=!1}else r.push(o);"\\"===o.substr(-1,1)&&(n=!0)}return(r=r.map((function(e){return e.replace("/","\\/")}))).reverse(),"/"+r.join("/")},ee.asn1.x509.X500Name.ldapToOneline=function(e){return ee.asn1.x509.X500Name.ldapToCompat(e)},ee.asn1.x509.RDN=function(e){ee.asn1.x509.RDN.superclass.constructor.call(this),this.asn1Array=[],this.paramArray=[],this.sRule="utf8";var t=ee.asn1.x509.AttributeTypeAndValue;this.setByParam=function(e){void 0!==e.rule&&(this.sRule=e.rule),void 0!==e.str&&this.addByMultiValuedString(e.str),void 0!==e.array&&(this.paramArray=e.array)},this.addByString=function(e){this.asn1Array.push(new ee.asn1.x509.AttributeTypeAndValue({str:e,rule:this.sRule}))},this.addByMultiValuedString=function(e){for(var t=ee.asn1.x509.RDN.parseString(e),n=0;n<t.length;n++)this.addByString(t[n])},this.tohex=function(){if(0==this.asn1Array.length&&this.paramArray.length>0)for(var e=0;e<this.paramArray.length;e++){var n=this.paramArray[e];void 0!==n.rule&&"utf8"!=this.sRule&&(n.rule=this.sRule);var r=new t(n);this.asn1Array.push(r)}var i=new ee.asn1.DERSet({array:this.asn1Array});return this.TLV=i.tohex(),this.TLV},this.getEncodedHex=function(){return this.tohex()},void 0!==e&&this.setByParam(e)},Ge(ee.asn1.x509.RDN,ee.asn1.ASN1Object),ee.asn1.x509.RDN.parseString=function(e){for(var t=e.split(/\+/),n=!1,r=[],i=0;t.length>0;i++){var o=t.shift();if(!0===n){var a=(r.pop()+"+"+o).replace(/\\\+/g,"+");r.push(a),n=!1}else r.push(o);"\\"===o.substr(-1,1)&&(n=!0)}var s=!1,u=[];for(i=0;r.length>0;i++){o=r.shift();if(!0===s){var c=u.pop();if(o.match(/"$/)){a=(c+"+"+o).replace(/^([^=]+)="(.*)"$/,"$1=$2");u.push(a),s=!1}else u.push(c+"+"+o)}else u.push(o);o.match(/^[^=]+="/)&&(s=!0)}return u},ee.asn1.x509.AttributeTypeAndValue=function(e){ee.asn1.x509.AttributeTypeAndValue.superclass.constructor.call(this),this.sRule="utf8",this.sType=null,this.sValue=null,this.dsType=null;var t=ee,n=t.asn1,r=n.DERSequence,i=n.DERUTF8String,o=n.DERPrintableString,a=n.DERTeletexString,s=n.DERIA5String,u=n.DERVisibleString,c=n.DERBMPString,l=t.lang.String.isMail,d=t.lang.String.isPrintable;this.setByParam=function(e){if(void 0!==e.rule&&(this.sRule=e.rule),void 0!==e.ds&&(this.dsType=e.ds),void 0===e.value&&void 0!==e.str){var t=e.str.match(/^([^=]+)=(.+)$/);if(!t)throw new Error("malformed attrTypeAndValueStr: "+attrTypeAndValueStr);this.sType=t[1],this.sValue=t[2]}else this.sType=e.type,this.sValue=e.value},this.setByString=function(e,t){void 0!==t&&(this.sRule=t);var n=e.match(/^([^=]+)=(.+)$/);if(!n)throw new Error("malformed attrTypeAndValueStr: "+attrTypeAndValueStr);this.setByAttrTypeAndValueStr(n[1],n[2])},this._getDsType=function(){var e=this.sType,t=this.sValue,n=this.sRule;return"prn"===n?"CN"==e&&l(t)?"ia5":d(t)?"prn":"utf8":"utf8"===n?"CN"==e&&l(t)?"ia5":"C"==e?"prn":"utf8":"utf8"},this.setByAttrTypeAndValueStr=function(e,t,n){void 0!==n&&(this.sRule=n),this.sType=e,this.sValue=t},this.getValueObj=function(e,t){if("utf8"==e)return new i({str:t});if("prn"==e)return new o({str:t});if("tel"==e)return new a({str:t});if("ia5"==e)return new s({str:t});if("vis"==e)return new u({str:t});if("bmp"==e)return new c({str:t});throw new Error("unsupported directory string type: type="+e+" value="+t)},this.tohex=function(){null==this.dsType&&(this.dsType=this._getDsType());var e=ee.asn1.x509.OID.atype2obj(this.sType),t=this.getValueObj(this.dsType,this.sValue),n=new r({array:[e,t]});return this.TLV=n.tohex(),this.TLV},this.getEncodedHex=function(){return this.tohex()},void 0!==e&&this.setByParam(e)},Ge(ee.asn1.x509.AttributeTypeAndValue,ee.asn1.ASN1Object),ee.asn1.x509.SubjectPublicKeyInfo=function(e){ee.asn1.x509.SubjectPublicKeyInfo.superclass.constructor.call(this);var t=ee,n=t.asn1,r=n.DERInteger,i=n.DERBitString,o=n.DERObjectIdentifier,a=n.DERSequence,s=n.ASN1Util.newObject,u=n.x509.AlgorithmIdentifier,c=t.crypto;c.ECDSA,c.DSA;this.getASN1Object=function(){if(null==this.asn1AlgId||null==this.asn1SubjPKey)throw"algId and/or subjPubKey not set";return new a({array:[this.asn1AlgId,this.asn1SubjPKey]})},this.tohex=function(){var e=this.getASN1Object();return this.hTLV=e.tohex(),this.hTLV},this.getEncodedHex=function(){return this.tohex()},this.setPubKey=function(e){try{if(e instanceof W){var t=s({seq:[{int:{bigint:e.n}},{int:{int:e.e}}]}).tohex();this.asn1AlgId=new u({name:"rsaEncryption"}),this.asn1SubjPKey=new i({hex:"00"+t})}}catch(c){}try{if(e instanceof ee.crypto.ECDSA){var n=new o({name:e.curveName});this.asn1AlgId=new u({name:"ecPublicKey",asn1params:n}),this.asn1SubjPKey=new i({hex:"00"+e.pubKeyHex})}}catch(c){}try{if(e instanceof ee.crypto.DSA){n=new s({seq:[{int:{bigint:e.p}},{int:{bigint:e.q}},{int:{bigint:e.g}}]});this.asn1AlgId=new u({name:"dsa",asn1params:n});var a=new r({bigint:e.y});this.asn1SubjPKey=new i({hex:"00"+a.tohex()})}}catch(c){}},void 0!==e&&this.setPubKey(e)},Ge(ee.asn1.x509.SubjectPublicKeyInfo,ee.asn1.ASN1Object),ee.asn1.x509.Time=function(e){ee.asn1.x509.Time.superclass.constructor.call(this);var t=ee.asn1,n=t.DERUTCTime,r=t.DERGeneralizedTime;this.params=null,this.type=null,this.setTimeParams=function(e){this.timeParams=e},this.setByParam=function(e){this.params=e},this.getType=function(e){return e.match(/^[0-9]{12}Z$/)?"utc":e.match(/^[0-9]{14}Z$/)?"gen":e.match(/^[0-9]{12}\.[0-9]+Z$/)?"utc":e.match(/^[0-9]{14}\.[0-9]+Z$/)?"gen":null},this.tohex=function(){var e=this.params,t=null;if("string"==typeof e&&(e={str:e}),null==e||!e.str||null!=e.type&&void 0!=e.type||(e.type=this.getType(e.str)),null!=e&&e.str?("utc"==e.type&&(t=new n(e.str)),"gen"==e.type&&(t=new r(e.str))):t="gen"==this.type?new r:new n,null==t)throw new Error("wrong setting for Time");return this.TLV=t.tohex(),this.TLV},this.getEncodedHex=function(){return this.tohex()},void 0!=e&&this.setByParam(e)},ee.asn1.x509.Time_bak=function(e){ee.asn1.x509.Time_bak.superclass.constructor.call(this);var t=ee.asn1,n=t.DERUTCTime,r=t.DERGeneralizedTime;this.setTimeParams=function(e){this.timeParams=e},this.tohex=function(){var e=null;return e=null!=this.timeParams?"utc"==this.type?new n(this.timeParams):new r(this.timeParams):"utc"==this.type?new n:new r,this.TLV=e.tohex(),this.TLV},this.getEncodedHex=function(){return this.tohex()},this.type="utc",void 0!==e&&(void 0!==e.type?this.type=e.type:void 0!==e.str&&(e.str.match(/^[0-9]{12}Z$/)&&(this.type="utc"),e.str.match(/^[0-9]{14}Z$/)&&(this.type="gen")),this.timeParams=e)},Ge(ee.asn1.x509.Time,ee.asn1.ASN1Object),ee.asn1.x509.AlgorithmIdentifier=function(e){ee.asn1.x509.AlgorithmIdentifier.superclass.constructor.call(this),this.nameAlg=null,this.asn1Alg=null,this.asn1Params=null,this.paramEmpty=!1;var t=ee.asn1,n=t.x509.AlgorithmIdentifier.PSSNAME2ASN1TLV;if(this.tohex=function(){if(null===this.nameAlg&&null===this.asn1Alg)throw new Error("algorithm not specified");if(null!==this.nameAlg){var e=null;for(var r in n)r===this.nameAlg&&(e=n[r]);if(null!==e)return this.hTLV=e,this.hTLV}null!==this.nameAlg&&null===this.asn1Alg&&(this.asn1Alg=t.x509.OID.name2obj(this.nameAlg));var i=[this.asn1Alg];null!==this.asn1Params&&i.push(this.asn1Params);var o=new t.DERSequence({array:i});return this.hTLV=o.tohex(),this.hTLV},this.getEncodedHex=function(){return this.tohex()},void 0!==e&&(void 0!==e.name&&(this.nameAlg=e.name),void 0!==e.asn1params&&(this.asn1Params=e.asn1params),void 0!==e.paramempty&&(this.paramEmpty=e.paramempty)),null===this.asn1Params&&!1===this.paramEmpty&&null!==this.nameAlg){void 0!==this.nameAlg.name&&(this.nameAlg=this.nameAlg.name);var r=this.nameAlg.toLowerCase();"withdsa"!==r.substr(-7,7)&&"withecdsa"!==r.substr(-9,9)&&(this.asn1Params=new t.DERNull)}},Ge(ee.asn1.x509.AlgorithmIdentifier,ee.asn1.ASN1Object),ee.asn1.x509.AlgorithmIdentifier.PSSNAME2ASN1TLV={SHAwithRSAandMGF1:"300d06092a864886f70d01010a3000",SHA256withRSAandMGF1:"303d06092a864886f70d01010a3030a00d300b0609608648016503040201a11a301806092a864886f70d010108300b0609608648016503040201a203020120",SHA384withRSAandMGF1:"303d06092a864886f70d01010a3030a00d300b0609608648016503040202a11a301806092a864886f70d010108300b0609608648016503040202a203020130",SHA512withRSAandMGF1:"303d06092a864886f70d01010a3030a00d300b0609608648016503040203a11a301806092a864886f70d010108300b0609608648016503040203a203020140"},ee.asn1.x509.GeneralName=function(e){ee.asn1.x509.GeneralName.superclass.constructor.call(this);var t=ee.asn1,n=t.x509,r=n.X500Name,i=n.OtherName,o=t.DERIA5String,a=(t.DERPrintableString,t.DEROctetString),s=t.DERTaggedObject,u=t.ASN1Object,c=Error;this.params=null,this.setByParam=function(e){this.params=e},this.tohex=function(){var e,t,n=this.params,l=!1;if(void 0!==n.other)e="a0",t=new i(n.other);else if(void 0!==n.rfc822)e="81",t=new o({str:n.rfc822});else if(void 0!==n.dns)e="82",t=new o({str:n.dns});else if(void 0!==n.dn)e="a4",l=!0,t="string"===typeof n.dn?new r({str:n.dn}):n.dn instanceof ee.asn1.x509.X500Name?n.dn:new r(n.dn);else if(void 0!==n.ldapdn)e="a4",l=!0,t=new r({ldapstr:n.ldapdn});else if(void 0!==n.certissuer||void 0!==n.certsubj){var d,h;e="a4",l=!0;var f=null;if(void 0!==n.certsubj?(d=!1,h=n.certsubj):(d=!0,h=n.certissuer),h.match(/^[0-9A-Fa-f]+$/),-1!=h.indexOf("-----BEGIN ")&&(f=Se(h)),null==f)throw new Error("certsubj/certissuer not cert");var p,v=new Ye;v.hex=f,p=d?v.getIssuerHex():v.getSubjectHex(),(t=new u).hTLV=p}else if(void 0!==n.uri)e="86",t=new o({str:n.uri});else{if(void 0===n.ip)throw new c("improper params");var g;e="87";var m=n.ip;try{if(m.match(/^[0-9a-f]+$/)){var y=m.length;if(8!=y&&16!=y&&32!=y&&64!=y)throw"err";g=m}else g=Pe(m)}catch(b){throw new c("malformed IP address: "+n.ip+":"+b.message)}t=new a({hex:g})}return new s({tag:e,explicit:l,obj:t}).tohex()},this.getEncodedHex=function(){return this.tohex()},void 0!==e&&this.setByParam(e)},Ge(ee.asn1.x509.GeneralName,ee.asn1.ASN1Object),ee.asn1.x509.GeneralNames=function(e){ee.asn1.x509.GeneralNames.superclass.constructor.call(this);var t=ee.asn1;this.setByParamArray=function(e){for(var n=0;n<e.length;n++){var r=new t.x509.GeneralName(e[n]);this.asn1Array.push(r)}},this.tohex=function(){return new t.DERSequence({array:this.asn1Array}).tohex()},this.getEncodedHex=function(){return this.tohex()},this.asn1Array=new Array,"undefined"!=typeof e&&this.setByParamArray(e)},Ge(ee.asn1.x509.GeneralNames,ee.asn1.ASN1Object),ee.asn1.x509.OtherName=function(e){ee.asn1.x509.OtherName.superclass.constructor.call(this);var t=ee.asn1,n=t.DERObjectIdentifier,r=t.DERSequence,i=t.ASN1Util.newObject;this.params=null,this.setByParam=function(e){this.params=e},this.tohex=function(){var e=this.params;if(void 0==e.oid||void 0==e.value)throw new Error("oid or value not specified");var t=new n({oid:e.oid}),o=i({tag:{tag:"a0",explicit:!0,obj:e.value}});return new r({array:[t,o]}).tohex()},this.getEncodedHex=function(){return this.tohex()},void 0!==e&&this.setByParam(e)},Ge(ee.asn1.x509.OtherName,ee.asn1.ASN1Object),ee.asn1.x509.OID=new function(){var e=ee.asn1.DERObjectIdentifier;this.name2oidList={sha1:"1.3.14.3.2.26",sha256:"2.16.840.1.101.3.4.2.1",sha384:"2.16.840.1.101.3.4.2.2",sha512:"2.16.840.1.101.3.4.2.3",sha224:"2.16.840.1.101.3.4.2.4",md5:"1.2.840.113549.2.5",md2:"1.3.14.7.2.2.1",ripemd160:"1.3.36.3.2.1",MD2withRSA:"1.2.840.113549.1.1.2",MD4withRSA:"1.2.840.113549.1.1.3",MD5withRSA:"1.2.840.113549.1.1.4",SHA1withRSA:"1.2.840.113549.1.1.5","pkcs1-MGF":"1.2.840.113549.1.1.8",rsaPSS:"1.2.840.113549.1.1.10",SHA224withRSA:"1.2.840.113549.1.1.14",SHA256withRSA:"1.2.840.113549.1.1.11",SHA384withRSA:"1.2.840.113549.1.1.12",SHA512withRSA:"1.2.840.113549.1.1.13",SHA1withECDSA:"1.2.840.10045.4.1",SHA224withECDSA:"1.2.840.10045.4.3.1",SHA256withECDSA:"1.2.840.10045.4.3.2",SHA384withECDSA:"1.2.840.10045.4.3.3",SHA512withECDSA:"1.2.840.10045.4.3.4",dsa:"1.2.840.10040.4.1",SHA1withDSA:"1.2.840.10040.4.3",SHA224withDSA:"2.16.840.1.101.3.4.3.1",SHA256withDSA:"2.16.840.1.101.3.4.3.2",rsaEncryption:"1.2.840.113549.1.1.1",commonName:"2.5.4.3",countryName:"2.5.4.6",localityName:"2.5.4.7",stateOrProvinceName:"2.5.4.8",streetAddress:"2.5.4.9",organizationName:"2.5.4.10",organizationalUnitName:"2.5.4.11",domainComponent:"0.9.2342.19200300.100.1.25",userId:"0.9.2342.19200300.100.1.1",surname:"2.5.4.4",givenName:"2.5.4.42",title:"2.5.4.12",distinguishedName:"2.5.4.49",emailAddress:"1.2.840.113549.1.9.1",description:"2.5.4.13",businessCategory:"2.5.4.15",postalCode:"2.5.4.17",uniqueIdentifier:"2.5.4.45",organizationIdentifier:"2.5.4.97",jurisdictionOfIncorporationL:"1.3.6.1.4.1.311.60.2.1.1",jurisdictionOfIncorporationSP:"1.3.6.1.4.1.311.60.2.1.2",jurisdictionOfIncorporationC:"1.3.6.1.4.1.311.60.2.1.3",subjectDirectoryAttributes:"2.5.29.9",subjectKeyIdentifier:"2.5.29.14",keyUsage:"2.5.29.15",subjectAltName:"2.5.29.17",issuerAltName:"2.5.29.18",basicConstraints:"2.5.29.19",cRLNumber:"2.5.29.20",cRLReason:"2.5.29.21",nameConstraints:"2.5.29.30",cRLDistributionPoints:"2.5.29.31",certificatePolicies:"2.5.29.32",anyPolicy:"2.5.29.32.0",policyMappings:"2.5.29.33",authorityKeyIdentifier:"2.5.29.35",policyConstraints:"2.5.29.36",extKeyUsage:"2.5.29.37",inhibitAnyPolicy:"2.5.29.54",authorityInfoAccess:"1.3.6.1.5.5.7.1.1",ocsp:"1.3.6.1.5.5.7.48.1",ocspBasic:"1.3.6.1.5.5.7.48.1.1",ocspNonce:"1.3.6.1.5.5.7.48.1.2",ocspNoCheck:"1.3.6.1.5.5.7.48.1.5",caIssuers:"1.3.6.1.5.5.7.48.2",anyExtendedKeyUsage:"2.5.29.37.0",serverAuth:"1.3.6.1.5.5.7.3.1",clientAuth:"1.3.6.1.5.5.7.3.2",codeSigning:"1.3.6.1.5.5.7.3.3",emailProtection:"1.3.6.1.5.5.7.3.4",timeStamping:"1.3.6.1.5.5.7.3.8",ocspSigning:"1.3.6.1.5.5.7.3.9",smtpUTF8Mailbox:"1.3.6.1.5.5.7.8.9",dateOfBirth:"1.3.6.1.5.5.7.9.1",placeOfBirth:"1.3.6.1.5.5.7.9.2",gender:"1.3.6.1.5.5.7.9.3",countryOfCitizenship:"1.3.6.1.5.5.7.9.4",countryOfResidence:"1.3.6.1.5.5.7.9.5",ecPublicKey:"1.2.840.10045.2.1","P-256":"1.2.840.10045.3.1.7",secp256r1:"1.2.840.10045.3.1.7",secp256k1:"1.3.132.0.10",secp384r1:"1.3.132.0.34",secp521r1:"1.3.132.0.35",pkcs5PBES2:"1.2.840.113549.1.5.13",pkcs5PBKDF2:"1.2.840.113549.1.5.12","des-EDE3-CBC":"1.2.840.113549.3.7",data:"1.2.840.113549.1.7.1","signed-data":"1.2.840.113549.1.7.2","enveloped-data":"1.2.840.113549.1.7.3","digested-data":"1.2.840.113549.1.7.5","encrypted-data":"1.2.840.113549.1.7.6","authenticated-data":"1.2.840.113549.1.9.16.1.2",tstinfo:"1.2.840.113549.1.9.16.1.4",signingCertificate:"1.2.840.113549.1.9.16.2.12",timeStampToken:"1.2.840.113549.1.9.16.2.14",signaturePolicyIdentifier:"1.2.840.113549.1.9.16.2.15",etsArchiveTimeStamp:"1.2.840.113549.1.9.16.2.27",signingCertificateV2:"1.2.840.113549.1.9.16.2.47",etsArchiveTimeStampV2:"1.2.840.113549.1.9.16.2.48",extensionRequest:"1.2.840.113549.1.9.14",contentType:"1.2.840.113549.1.9.3",messageDigest:"1.2.840.113549.1.9.4",signingTime:"1.2.840.113549.1.9.5",counterSignature:"1.2.840.113549.1.9.6",archiveTimeStampV3:"0.4.0.1733.2.4",pdfRevocationInfoArchival:"1.2.840.113583.1.1.8",adobeTimeStamp:"1.2.840.113583.1.1.9.1",smimeMailboxLegacy:"2.23.140.1.5.1.1",smimeMailboxMulti:"2.23.140.1.5.1.2",smimeMailboxStrict:"2.23.140.1.5.1.3",smimeOrganizationLegacy:"2.23.140.1.5.2.1",smimeOrganizationMulti:"2.23.140.1.5.2.2",smimeOrganizationStrict:"2.23.140.1.5.2.3",smimeSponsorLegacy:"2.23.140.1.5.3.1",smimeSponsorMulti:"2.23.140.1.5.3.2",smimeSponsorStrict:"2.23.140.1.5.3.3",smimeIndividualLegacy:"2.23.140.1.5.4.1",smimeIndividualMulti:"2.23.140.1.5.4.2",smimeIndividualStrict:"2.23.140.1.5.4.3"},this.atype2oidList={CN:"2.5.4.3",L:"2.5.4.7",ST:"2.5.4.8",O:"2.5.4.10",OU:"2.5.4.11",C:"2.5.4.6",STREET:"2.5.4.9",DC:"0.9.2342.19200300.100.1.25",UID:"0.9.2342.19200300.100.1.1",SN:"2.5.4.4",T:"2.5.4.12",GN:"2.5.4.42",DN:"2.5.4.49",E:"1.2.840.113549.1.9.1",description:"2.5.4.13",businessCategory:"2.5.4.15",postalCode:"2.5.4.17",serialNumber:"2.5.4.5",uniqueIdentifier:"2.5.4.45",organizationIdentifier:"2.5.4.97",jurisdictionOfIncorporationL:"1.3.6.1.4.1.311.60.2.1.1",jurisdictionOfIncorporationSP:"1.3.6.1.4.1.311.60.2.1.2",jurisdictionOfIncorporationC:"1.3.6.1.4.1.311.60.2.1.3"},this.objCache={},this.name2obj=function(t){if("undefined"!=typeof this.objCache[t])return this.objCache[t];if("undefined"==typeof this.name2oidList[t])throw"Name of ObjectIdentifier not defined: "+t;var n=this.name2oidList[t],r=new e({oid:n});return this.objCache[t]=r,r},this.atype2obj=function(t){if(void 0!==this.objCache[t])return this.objCache[t];var n;if(t.match(/^\d+\.\d+\.[0-9.]+$/))n=t;else if(void 0!==this.atype2oidList[t])n=this.atype2oidList[t];else{if(void 0===this.name2oidList[t])throw new Error("AttributeType name undefined: "+t);n=this.name2oidList[t]}var r=new e({oid:n});return this.objCache[t]=r,r},this.registerOIDs=function(e){if(this.checkOIDs(e))for(var t in e)this.name2oidList[t]=e[t]},this.checkOIDs=function(e){try{var t=Object.keys(e);return 0!=t.length&&(t.map((function(e,t,n){if(!this[e].match(/^[0-2]\.[0-9.]+$/))throw new Error("value is not OID")}),e),!0)}catch(n){return!1}}},ee.asn1.x509.OID.oid2name=function(e){var t=ee.asn1.x509.OID.name2oidList;for(var n in t)if(t[n]==e)return n;return""},ee.asn1.x509.OID.oid2atype=function(e){var t=ee.asn1.x509.OID.atype2oidList;for(var n in t)if(t[n]==e)return n;return e},ee.asn1.x509.OID.name2oid=function(e){if(e.match(/^[0-9.]+$/))return e;var t=ee.asn1.x509.OID.name2oidList;return void 0===t[e]?"":t[e]},ee.asn1.x509.X509Util={},ee.asn1.x509.X509Util.newCertPEM=function(e){var t=ee.asn1.x509;t.TBSCertificate;return new(0,t.Certificate)(e).getPEM()},"undefined"!=typeof ee&&ee||(ee={}),"undefined"!=typeof ee.asn1&&ee.asn1||(ee.asn1={}),"undefined"!=typeof ee.asn1.cms&&ee.asn1.cms||(ee.asn1.cms={}),ee.asn1.cms.Attribute=function(e){var t=Error,n=ee.asn1,r=n.DERSequence,i=n.DERSet,o=n.DERObjectIdentifier;this.params=null,this.typeOid=null,this.setByParam=function(e){this.params=e},this.getValueArray=function(){throw new t("not yet implemented abstract")},this.tohex=function(){var e=new o({oid:this.typeOid}),t=new i({array:this.getValueArray()});return new r({array:[e,t]}).tohex()},this.getEncodedHex=function(){return this.tohex()}},Ge(ee.asn1.cms.Attribute,ee.asn1.ASN1Object),ee.asn1.cms.ContentType=function(e){var t=ee.asn1;t.cms.ContentType.superclass.constructor.call(this),this.typeOid="1.2.840.113549.1.9.3",this.getValueArray=function(){return[new t.DERObjectIdentifier(this.params.type)]},void 0!=e&&this.setByParam(e)},Ge(ee.asn1.cms.ContentType,ee.asn1.cms.Attribute),ee.asn1.cms.MessageDigest=function(e){var t=ee.asn1,n=t.DEROctetString;t.cms.MessageDigest.superclass.constructor.call(this),this.typeOid="1.2.840.113549.1.9.4",this.getValueArray=function(){return[new n(this.params)]},void 0!=e&&this.setByParam(e)},Ge(ee.asn1.cms.MessageDigest,ee.asn1.cms.Attribute),ee.asn1.cms.SigningTime=function(e){var t=ee.asn1;t.cms.SigningTime.superclass.constructor.call(this),this.typeOid="1.2.840.113549.1.9.5",this.getValueArray=function(){return[new t.x509.Time(this.params)]},void 0!=e&&this.setByParam(e)},Ge(ee.asn1.cms.SigningTime,ee.asn1.cms.Attribute),ee.asn1.cms.SigningCertificate=function(e){var t=Error,n=ee,r=n.asn1,i=r.DERSequence,o=r.cms,a=o.ESSCertID;n.crypto;o.SigningCertificate.superclass.constructor.call(this),this.typeOid="1.2.840.113549.1.9.16.2.12",this.getValueArray=function(){if(null==this.params||void 0==this.params||void 0==this.params.array)throw new t("parameter 'array' not specified");for(var n=this.params.array,r=[],o=0;o<n.length;o++){var s=n[o];0!=e.hasis||"string"!=typeof s||-1==s.indexOf("-----BEGIN")&&!re.isASN1HEX(s)||(s={cert:s}),0!=s.hasis&&0==e.hasis&&(s.hasis=!1),r.push(new a(s))}var u=new i({array:r});return[new i({array:[u]})]},void 0!=e&&this.setByParam(e)},Ge(ee.asn1.cms.SigningCertificate,ee.asn1.cms.Attribute),ee.asn1.cms.ESSCertID=function(e){ee.asn1.cms.ESSCertID.superclass.constructor.call(this);var t=Error,n=ee,r=n.asn1,i=r.DEROctetString,o=r.DERSequence,a=r.cms.IssuerSerial;this.params=null,this.getCertHash=function(e,r){if(void 0!=e.hash)return e.hash;if("string"==typeof e&&-1==e.indexOf("-----BEGIN")&&!re.isASN1HEX(e))return e;var i,o,a;if("string"==typeof e)i=e;else{if(void 0==e.cert)throw new t("hash nor cert unspecified");i=e.cert}if(o=-1!=i.indexOf("-----BEGIN")?Se(i):i,"string"==typeof e&&(-1!=e.indexOf("-----BEGIN")?o=Se(e):re.isASN1HEX(e)&&(o=e)),void 0!=e.alg)a=e.alg;else{if(void 0==r)throw new t("hash alg unspecified");a=r}return n.crypto.Util.hashHex(o,a)},this.tohex=function(){var e=this.params,t=this.getCertHash(e,"sha1"),n=[];return n.push(new i({hex:t})),("string"==typeof e&&-1!=e.indexOf("-----BEGIN")||void 0!=e.cert&&0!=e.hasis||void 0!=e.issuer&&void 0!=e.serial)&&n.push(new a(e)),new o({array:n}).tohex()},this.getEncodedHex=function(){return this.tohex()},void 0!=e&&this.setByParam(e)},Ge(ee.asn1.cms.ESSCertID,ee.asn1.ASN1Object),ee.asn1.cms.SigningCertificateV2=function(e){var t=Error,n=ee,r=n.asn1,i=r.DERSequence,o=(r.x509,r.cms),a=o.ESSCertIDv2;n.crypto;o.SigningCertificateV2.superclass.constructor.call(this),this.typeOid="1.2.840.113549.1.9.16.2.47",this.getValueArray=function(){if(null==this.params||void 0==this.params||void 0==this.params.array)throw new t("parameter 'array' not specified");for(var n=this.params.array,r=[],o=0;o<n.length;o++){var s=n[o];void 0==e.alg&&0!=e.hasis||"string"!=typeof s||-1==s.indexOf("-----BEGIN")&&!re.isASN1HEX(s)||(s={cert:s}),void 0==s.alg&&void 0!=e.alg&&(s.alg=e.alg),0!=s.hasis&&0==e.hasis&&(s.hasis=!1),r.push(new a(s))}var u=new i({array:r});return[new i({array:[u]})]},void 0!=e&&this.setByParam(e)},Ge(ee.asn1.cms.SigningCertificateV2,ee.asn1.cms.Attribute),ee.asn1.cms.ESSCertIDv2=function(e){ee.asn1.cms.ESSCertIDv2.superclass.constructor.call(this);Error;var t=ee.asn1,n=t.DEROctetString,r=t.DERSequence,i=t.cms.IssuerSerial,o=t.x509.AlgorithmIdentifier;this.params=null,this.tohex=function(){var e=this.params,t=this.getCertHash(e,"sha256"),a=[];return void 0!=e.alg&&"sha256"!=e.alg&&a.push(new o({name:e.alg})),a.push(new n({hex:t})),("string"==typeof e&&-1!=e.indexOf("-----BEGIN")||void 0!=e.cert&&0!=e.hasis||void 0!=e.issuer&&void 0!=e.serial)&&a.push(new i(e)),new r({array:a}).tohex()},this.getEncodedHex=function(){return this.tohex()},void 0!=e&&this.setByParam(e)},Ge(ee.asn1.cms.ESSCertIDv2,ee.asn1.cms.ESSCertID),ee.asn1.cms.IssuerSerial=function(e){var t=Error,n=ee.asn1,r=n.DERInteger,i=n.DERSequence,o=n.cms,a=n.x509.GeneralNames,s=Ye;o.IssuerSerial.superclass.constructor.call(this),this.setByParam=function(e){this.params=e},this.tohex=function(){var e,n,o=this.params;if("string"==typeof o&&-1!=o.indexOf("-----BEGIN")||void 0!=o.cert){var u;u=void 0!=o.cert?o.cert:o;var c=new s;c.readCertPEM(u),e=c.getIssuer(),n={hex:c.getSerialNumberHex()}}else{if(void 0==o.issuer||!o.serial)throw new t("cert or issuer and serial parameter not specified");e=o.issuer,n=o.serial}var l=new a([{dn:e}]),d=new r(n);return new i({array:[l,d]}).tohex()},this.getEncodedHex=function(){return this.tohex()},void 0!=e&&this.setByParam(e)},Ge(ee.asn1.cms.IssuerSerial,ee.asn1.ASN1Object),ee.asn1.cms.SignerIdentifier=function(e){var t=ee.asn1,n=(t.DERInteger,t.DERSequence,t.cms),r=n.IssuerAndSerialNumber,i=n.SubjectKeyIdentifier;t.x509.X500Name,Error;n.SignerIdentifier.superclass.constructor.call(this),this.params=null,this.tohex=function(){var e=this.params;if("isssn"==e.type)return new r(e).tohex();if("skid"==e.type)return new i(e).tohex();throw new Error("wrong property for isssn or skid")},this.getEncodedHex=function(){return this.tohex()},void 0!=e&&this.setByParam(e)},Ge(ee.asn1.cms.SignerIdentifier,ee.asn1.ASN1Object),ee.asn1.cms.IssuerAndSerialNumber=function(e){var t=ee.asn1,n=t.DERInteger,r=t.DERSequence,i=t.cms,o=t.x509.X500Name,a=Ye,s=Error;i.IssuerAndSerialNumber.superclass.constructor.call(this),this.params=null,this.tohex=function(){var e,t,i=this.params;if("string"==typeof i&&-1!=i.indexOf("-----BEGIN")||void 0!=i.cert){var u;u=void 0!=i.cert?i.cert:i;var c=new a;c.readCertPEM(u),e=c.getIssuer(),t={hex:c.getSerialNumberHex()}}else{if(void 0==i.issuer||!i.serial)throw new s("cert or issuer and serial parameter not specified");e=i.issuer,t=i.serial}var l=new o(e),d=new n(t);return new r({array:[l,d]}).tohex()},this.getEncodedHex=function(){return this.tohex()},this.setByParam=function(e){this.params=e},void 0!=e&&this.setByParam(e)},Ge(ee.asn1.cms.IssuerAndSerialNumber,ee.asn1.ASN1Object),ee.asn1.cms.SubjectKeyIdentifier=function(e){var t=ee.asn1,n=(t.DERInteger,t.DERSequence,t.ASN1Util.newObject),r=t.cms,i=(r.IssuerAndSerialName,r.SubjectKeyIdentifier,t.x509.X500Name,Ye),o=Error;r.SubjectKeyIdentifier.superclass.constructor.call(this),this.tohex=function(){var e,t=this.params;if(void 0==t.cert&&void 0==t.skid)throw new o("property cert nor skid undefined");void 0!=t.cert?e=new i(t.cert).getExtSubjectKeyIdentifier().kid.hex:void 0!=t.skid&&(e=t.skid);return n({tag:{tage:"a0",obj:{octstr:{hex:e}}}}).tohex()},this.getEncodedHex=function(){return this.tohex()},void 0!=e&&this.setByParam(e)},Ge(ee.asn1.cms.SubjectKeyIdentifier,ee.asn1.ASN1Object),ee.asn1.cms.AttributeList=function(e){var t=Error,n=ee.asn1,r=n.DERSet,i=n.cms;i.AttributeList.superclass.constructor.call(this),this.params=null,this.hTLV=null,this.setByParam=function(e){this.params=e},this.tohex=function(){var e=this.params;if(null!=this.hTLV)return this.hTLV;var n=!0;void 0!=e.sortflag&&(n=e.sortflag);for(var o=e.array,a=[],s=0;s<o.length;s++){var u=o[s],c=u.attr;if("contentType"==c)a.push(new i.ContentType(u));else if("messageDigest"==c)a.push(new i.MessageDigest(u));else if("signingTime"==c)a.push(new i.SigningTime(u));else if("signingCertificate"==c)a.push(new i.SigningCertificate(u));else if("signingCertificateV2"==c)a.push(new i.SigningCertificateV2(u));else if("signaturePolicyIdentifier"==c)a.push(new ee.asn1.cades.SignaturePolicyIdentifier(u));else{if("signatureTimeStamp"!=c&&"timeStampToken"!=c)throw new t("unknown attr: "+c);a.push(new ee.asn1.cades.SignatureTimeStamp(u))}}var l=new r({array:a,sortflag:n});return this.hTLV=l.tohex(),this.hTLV},this.getEncodedHex=function(){return this.tohex()},void 0!=e&&this.setByParam(e)},Ge(ee.asn1.cms.AttributeList,ee.asn1.ASN1Object),ee.asn1.cms.SignerInfo=function(e){var t=Error,n=ee,r=n.asn1,i=r.DERInteger,o=r.DEROctetString,a=r.DERSequence,s=r.DERTaggedObject,u=r.cms,c=u.SignerIdentifier,l=u.AttributeList,d=(u.ContentType,u.EncapsulatedContentInfo,u.MessageDigest,u.SignedData,r.x509.AlgorithmIdentifier),h=n.crypto,f=Ke;u.SignerInfo.superclass.constructor.call(this),this.params=null,this.sign=function(){var e=this.params,t=e.sigalg,n=new l(e.sattrs).tohex(),r=f.getKey(e.signkey),i=new h.Signature({alg:t});i.init(r),i.updateHex(n);var o=i.sign();e.sighex=o},this.tohex=function(){var e=this.params,n=[];if(n.push(new i({int:e.version})),n.push(new c(e.id)),n.push(new d({name:e.hashalg})),void 0!=e.sattrs){var r=new l(e.sattrs);try{n.push(new s({tag:"a0",explicit:!1,obj:r}))}catch(u){throw new t("si sattr error: "+u)}}if(void 0!=e.sigalgfield?n.push(new d({name:e.sigalgfield})):n.push(new d({name:e.sigalg})),void 0==e.sighex&&void 0!=e.signkey&&this.sign(),n.push(new o({hex:e.sighex})),void 0!=e.uattrs){r=new l(e.uattrs);try{n.push(new s({tag:"a1",explicit:!1,obj:r}))}catch(u){throw new t("si uattr error: "+u)}}return new a({array:n}).tohex()},this.getEncodedHex=function(){return this.tohex()},void 0!=e&&this.setByParam(e)},Ge(ee.asn1.cms.SignerInfo,ee.asn1.ASN1Object),ee.asn1.cms.EncapsulatedContentInfo=function(e){var t=ee.asn1,n=t.DERTaggedObject,r=t.DERSequence,i=t.DERObjectIdentifier,o=t.DEROctetString;t.cms.EncapsulatedContentInfo.superclass.constructor.call(this),this.params=null,this.tohex=function(){var e=this.params,t=[];if(t.push(new i(e.type)),void 0!=e.content&&(void 0!=e.content.hex||void 0!=e.content.str)&&1!=e.isDetached){var a=new o(e.content),s=new n({tag:"a0",explicit:!0,obj:a});t.push(s)}return new r({array:t}).tohex()},this.getEncodedHex=function(){return this.tohex()},this.setByParam=function(e){this.params=e},void 0!=e&&this.setByParam(e)},Ge(ee.asn1.cms.EncapsulatedContentInfo,ee.asn1.ASN1Object),ee.asn1.cms.ContentInfo=function(e){var t=ee.asn1,n=t.DERTaggedObject,r=t.DERSequence,i=t.DERObjectIdentifier;t.x509.OID.name2obj;ee.asn1.cms.ContentInfo.superclass.constructor.call(this),this.params=null,this.tohex=function(){var e=this.params,t=[];t.push(new i(e.type));var o=new n({tag:"a0",explicit:!0,obj:e.obj});return t.push(o),new r({array:t}).tohex()},this.getEncodedHex=function(){return this.tohex()},this.setByParam=function(e){this.params=e},void 0!=e&&this.setByParam(e)},Ge(ee.asn1.cms.ContentInfo,ee.asn1.ASN1Object),ee.asn1.cms.SignedData=function(e){Error;var t=ee.asn1,n=(t.ASN1Object,t.DERInteger),r=t.DERSet,i=t.DERSequence,o=(t.DERTaggedObject,t.cms),a=o.EncapsulatedContentInfo,s=o.SignerInfo,u=o.ContentInfo,c=o.CertificateSet,l=o.RevocationInfoChoices,d=t.x509.AlgorithmIdentifier;ee.asn1.cms.SignedData.superclass.constructor.call(this),this.params=null,this.checkAndFixParam=function(){var e=this.params;this._setDigestAlgs(e),this._setContentTypeByEContent(e),this._setMessageDigestByEContent(e),this._setSignerInfoVersion(e),this._setSignedDataVersion(e)},this._setDigestAlgs=function(e){for(var t={},n=e.sinfos,r=0;r<n.length;r++){t[n[r].hashalg]=1}e.hashalgs=Object.keys(t).sort()},this._setContentTypeByEContent=function(e){for(var t=e.econtent.type,n=e.sinfos,r=0;r<n.length;r++){var i=n[r];this._getAttrParamByName(i,"contentType").type=t}},this._setMessageDigestByEContent=function(e){var t=e.econtent,n=(e.econtent.type,t.content.hex);void 0==n&&"data"==t.type&&void 0!=t.content.str&&(n=ge(t.content.str));for(var r=e.sinfos,i=0;i<r.length;i++){var o=r[i],a=o.hashalg,s=this._getAttrParamByName(o,"messageDigest"),u=ee.crypto.Util.hashHex(n,a);s.hex=u}},this._getAttrParamByName=function(e,t){for(var n=e.sattrs.array,r=0;r<n.length;r++)if(n[r].attr==t)return n[r]},this._setSignerInfoVersion=function(e){for(var t=e.sinfos,n=0;n<t.length;n++){var r=t[n],i=1;"skid"==r.id.type&&(i=3),r.version=i}},this._setSignedDataVersion=function(e){var t=this._getSignedDataVersion(e);e.version=t},this._getSignedDataVersion=function(e){if(void 0!=e.revinfos)for(var t=e.revinfos,n=0;n<t.length;n++){if(void 0!=t[n].ocsp)return 5}var r=e.sinfos;for(n=0;n<r.length;n++){if(3==e.sinfos[n].version)return 3}return"data"!=e.econtent.type?3:1},this.tohex=function(){var e=this.params;void 0!=this.getEncodedHexPrepare&&this.getEncodedHexPrepare(),1!=e.fixed&&this.checkAndFixParam();var t=[];t.push(new n({int:e.version}));for(var o=[],u=0;u<e.hashalgs.length;u++){var h=e.hashalgs[u];o.push(new d({name:h}))}t.push(new r({array:o})),t.push(new a(e.econtent)),void 0!=e.certs&&t.push(new c(e.certs)),void 0!=e.revinfos&&t.push(new l(e.revinfos));var f=[];for(u=0;u<e.sinfos.length;u++){var p=e.sinfos[u];f.push(new s(p))}return t.push(new r({array:f})),new i({array:t}).tohex()},this.getEncodedHex=function(){return this.tohex()},this.getContentInfo=function(){return new u({type:"signed-data",obj:this})},this.getContentInfoEncodedHex=function(){return this.getContentInfo().tohex()},void 0!=e&&this.setByParam(e)},Ge(ee.asn1.cms.SignedData,ee.asn1.ASN1Object),ee.asn1.cms.CertificateSet=function(e){ee.asn1.cms.CertificateSet.superclass.constructor.call(this);var t=Error,n=ee.asn1,r=n.DERTaggedObject,i=n.DERSet,o=n.ASN1Object;this.params=null,this.tohex=function(){var e,n=this.params,a=[];if(n instanceof Array)e=n;else{if(void 0==n.array)throw new t("cert array not specified");e=n.array}for(var s=0;s<e.length;s++){var u=Se(e[s]),c=new o;c.hTLV=u,a.push(c)}var l={array:a};0==n.sortflag&&(l.sortflag=!1);var d=new i(l);return new r({tag:"a0",explicit:!1,obj:d}).tohex()},this.getEncodedHex=function(){return this.tohex()},void 0!=e&&this.setByParam(e)},Ge(ee.asn1.cms.CertificateSet,ee.asn1.ASN1Object),ee.asn1.cms.RevocationInfoChoices=function(e){ee.asn1.cms.RevocationInfoChoices.superclass.constructor.call(this),this.params=null,this.tohex=function(){var e=this.params;if(!e instanceof Array)throw new Error("params is not array");for(var t=[],n=0;n<e.length;n++)t.push(new ee.asn1.cms.RevocationInfoChoice(e[n]));return ee.asn1.ASN1Util.newObject({tag:{tagi:"a1",obj:{set:t}}}).tohex()},this.getEncodedHex=function(){return this.tohex()},void 0!=e&&this.setByParam(e)},Ge(ee.asn1.cms.RevocationInfoChoices,ee.asn1.ASN1Object),ee.asn1.cms.RevocationInfoChoice=function(e){ee.asn1.cms.RevocationInfoChoice.superclass.constructor.call(this),this.params=null,this.tohex=function(){var e=this.params;if(void 0!=e.crl&&"string"==typeof e.crl){var t=e.crl;return-1!=e.crl.indexOf("-----BEGIN")&&(t=Se(e.crl)),t}if(void 0!=e.ocsp)return ee.asn1.ASN1Util.newObject({tag:{tagi:"a1",obj:new ee.asn1.cms.OtherRevocationFormat(e)}}).tohex();throw new Error("property crl or ocsp undefined")},this.getEncodedHex=function(){return this.tohex()},void 0!=e&&this.setByParam(e)},Ge(ee.asn1.cms.RevocationInfoChoice,ee.asn1.ASN1Object),ee.asn1.cms.OtherRevocationFormat=function(e){ee.asn1.cms.OtherRevocationFormat.superclass.constructor.call(this);var t=Error,n=ee,r=n.asn1.ASN1Util.newObject,i=n.lang.String.isHex;this.params=null,this.tohex=function(){var e=this.params;if(void 0==e.ocsp)throw new t("property ocsp not specified");if(!i(e.ocsp)||!re.isASN1HEX(e.ocsp))throw new t("ocsp value not ASN.1 hex string");return r({seq:[{oid:"1.3.6.1.5.5.7.16.2"},{asn1:{tlv:e.ocsp}}]}).tohex()},this.getEncodedHex=function(){return this.tohex()},void 0!=e&&this.setByParam(e)},Ge(ee.asn1.cms.OtherRevocationFormat,ee.asn1.ASN1Object),ee.asn1.cms.CMSUtil=new function(){},ee.asn1.cms.CMSUtil.newSignedData=function(e){return new ee.asn1.cms.SignedData(e)},ee.asn1.cms.CMSUtil.verifySignedData=function(e){var t=ee,n=t.asn1,r=n.cms,i=(r.SignerInfo,r.SignedData,r.SigningTime,r.SigningCertificate,r.SigningCertificateV2,n.cades.SignaturePolicyIdentifier,t.lang.String.isHex),o=re,a=o.getVbyList,s=o.getTLVbyList,u=o.getIdxbyList,c=o.getChildIdx,l=o.getTLV,d=o.oidname,h=t.crypto.Util.hashHex;void 0===e.cms&&i(e.cms);var f=e.cms,p=function(e,t){var n=t.idx;t.signerid_issuer1=s(e,n,[1,0],"30"),t.signerid_serial1=a(e,n,[1,1],"02"),t.hashalg=d(a(e,n,[2,0],"06"));var r=u(e,n,[3],"a0");t.idxSignedAttrs=r,v(e,t,r);var i=c(e,n).length;if(i<6)throw"malformed SignerInfo";t.sigalg=d(a(e,n,[i-2,0],"06")),t.sigval=a(e,n,[i-1],"04")},v=function(e,t,n){var r=c(e,n);t.signedAttrIdxList=r;for(var i=0;i<r.length;i++){var o,s=r[i],u=a(e,s,[0],"06");"2a864886f70d010905"===u?(o=fe(a(e,s,[1,0])),t.saSigningTime=o):"2a864886f70d010904"===u&&(o=a(e,s,[1,0],"04"),t.saMessageDigest=o)}},g=function(e,t,n,r){n.verifyDetail={};var i=n.verifyDetail,o=t.parse.econtent,a=n.hashalg,s=n.saMessageDigest;i.validMessageDigest=!1,h(o,a)===s&&(i.validMessageDigest=!0),function(e,t,n,r){var i,o=t.parse.certsIdx;if(void 0===t.certs){i=[],t.certkeys=[];for(var a=c(e,o),s=0;s<a.length;s++){var u=l(e,a[s]),d=new Ye;d.readCertHex(u),i[s]=d,t.certkeys[s]=d.getPublicKey()}t.certs=i}else i=t.certs;for(t.cccc=i.length,t.cccci=a.length,s=0;s<i.length;s++){var h=d.getIssuerHex(),f=d.getSerialNumberHex();n.signerid_issuer1===h&&n.signerid_serial1===f&&(n.certkey_idx=s)}}(e,t,n),i.validSignatureValue=!1;var u=n.sigalg,d="31"+l(e,n.idxSignedAttrs).substr(2);n.signedattrshex=d;var f=t.certs[n.certkey_idx].getPublicKey(),p=new ee.crypto.Signature({alg:u});p.init(f),p.updateHex(d);var v=p.verify(n.sigval);i.validSignatureValue_isValid=v,!0===v&&(i.validSignatureValue=!0),n.isValid=!1,i.validMessageDigest&&i.validSignatureValue&&(n.isValid=!0)},m={isValid:!1,parse:{}};return function(e,t){if("2a864886f70d010702"!==a(e,0,[0],"06"))return t;t.cmsType="signedData",t.econtent=a(e,0,[1,0,2,1,0]),function(e,t){for(var n,r=3;r<6;r++)if(void 0!==(n=u(e,0,[1,0,r]))){var i=e.substr(n,2);"a0"===i&&(t.certsIdx=n),"a1"===i&&(t.revinfosIdx=n),"31"===i&&(t.signerinfosIdx=n)}}(e,t),t.signerInfos=[],function(e,t){var n=t.signerinfosIdx;if(void 0!==n){var r=c(e,n);t.signerInfoIdxList=r;for(var i=0;i<r.length;i++){var o={idx:r[i]};p(e,o),t.signerInfos.push(o)}}}(e,t)}(f,m.parse),function(e,t){for(var n=t.parse.signerInfos,r=n.length,i=!0,o=0;o<r;o++){var a=n[o];g(e,t,a,o),a.isValid||(i=!1)}t.isValid=i}(f,m),m},ee.asn1.cms.CMSParser=function(){var e=Error,t=Ye,n=new t,r=re,i=r.getV,o=r.getTLV,a=(r.getIdxbyList,r.getTLVbyList),s=r.getTLVbyListEx,u=r.getVbyList,c=r.getVbyListEx,l=r.getChildIdx;this.getCMSSignedData=function(e){var t=a(e,0,[1,0]);return this.getSignedData(t)},this.getSignedData=function(e){var t=l(e,0),n={},r=i(e,t[0]),a=parseInt(r,16);n.version=a;var u=o(e,t[1]);n.hashalgs=this.getHashAlgArray(u);var c=o(e,t[2]);n.econtent=this.getEContent(c);var d=s(e,0,["[0]"]);null!=d&&(n.certs=this.getCertificateSet(d));s(e,0,["[1]"]);var h=s(e,0,[3]);return n.sinfos=this.getSignerInfos(h),n},this.getHashAlgArray=function(e){for(var n=l(e,0),r=new t,i=[],a=0;a<n.length;a++){var s=o(e,n[a]),u=r.getAlgorithmIdentifierName(s);i.push(u)}return i},this.getEContent=function(e){var t={},n=u(e,0,[0]),r=u(e,0,[1,0]);return t.type=ee.asn1.x509.OID.oid2name(re.hextooidstr(n)),t.content={hex:r},t},this.getSignerInfos=function(e){for(var t=[],n=l(e,0),r=0;r<n.length;r++){var i=o(e,n[r]),a=this.getSignerInfo(i);t.push(a)}return t},this.getSignerInfo=function(e){var t={},i=l(e,0),a=r.getInt(e,i[0],-1);-1!=a&&(t.version=a);var u=o(e,i[1]),d=this.getIssuerAndSerialNumber(u);t.id=d;var h=o(e,i[2]),f=n.getAlgorithmIdentifierName(h);t.hashalg=f;var p=s(e,0,["[0]"]);if(null!=p){var v=this.getAttributeList(p);t.sattrs=v}var g=s(e,0,[3]),m=n.getAlgorithmIdentifierName(g);t.sigalg=m;var y=c(e,0,[4]);t.sighex=y;var b=s(e,0,["[1]"]);if(null!=b){var w=this.getAttributeList(b);t.uattrs=w}return t},this.getSignerIdentifier=function(e){if("30"==e.substr(0,2))return this.getIssuerAndSerialNumber(e);throw new Error("SKID of signerIdentifier not supported")},this.getIssuerAndSerialNumber=function(e){var t={type:"isssn"},r=l(e,0),a=o(e,r[0]);t.issuer=n.getX500Name(a);var s=i(e,r[1]);return t.serial={hex:s},t},this.getAttributeList=function(e){for(var t=[],n=l(e,0),r=0;r<n.length;r++){var i=o(e,n[r]),a=this.getAttribute(i);t.push(a)}return{array:t}},this.getAttribute=function(e){var t={},n=l(e,0),i=r.getOID(e,n[0]),a=ee.asn1.x509.OID.oid2name(i);t.attr=a;var s=o(e,n[1]),u=l(s,0);if(1==u.length)t.valhex=o(s,u[0]);else{for(var c=[],d=0;d<u.length;d++)c.push(o(s,u[d]));t.valhex=c}return"contentType"==a?this.setContentType(t):"messageDigest"==a?this.setMessageDigest(t):"signingTime"==a?this.setSigningTime(t):"signingCertificate"==a?this.setSigningCertificate(t):"signingCertificateV2"==a?this.setSigningCertificateV2(t):"signaturePolicyIdentifier"==a&&this.setSignaturePolicyIdentifier(t),t},this.setContentType=function(e){var t=r.getOIDName(e.valhex,0,null);null!=t&&(e.type=t,delete e.valhex)},this.setSigningTime=function(e){var t=fe(i(e.valhex,0));e.str=t,delete e.valhex},this.setMessageDigest=function(e){var t=i(e.valhex,0);e.hex=t,delete e.valhex},this.setSigningCertificate=function(e){var t=l(e.valhex,0);if(t.length>0){for(var n=o(e.valhex,t[0]),r=l(n,0),i=[],a=0;a<r.length;a++){var s=o(n,r[a]),u=this.getESSCertID(s);i.push(u)}e.array=i}if(t.length>1){var c=o(e.valhex,t[1]);e.polhex=c}delete e.valhex},this.setSignaturePolicyIdentifier=function(e){var n=l(e.valhex,0);if(n.length>0){var a=r.getOID(e.valhex,n[0]);e.oid=a}if(n.length>1){var s=new t,u=l(e.valhex,n[1]),c=o(e.valhex,u[0]),d=s.getAlgorithmIdentifierName(c);e.alg=d;var h=i(e.valhex,u[1]);e.hash=h}delete e.valhex},this.setSigningCertificateV2=function(e){var t=l(e.valhex,0);if(t.length>0){for(var n=o(e.valhex,t[0]),r=l(n,0),i=[],a=0;a<r.length;a++){var s=o(n,r[a]),u=this.getESSCertIDv2(s);i.push(u)}e.array=i}if(t.length>1){var c=o(e.valhex,t[1]);e.polhex=c}delete e.valhex},this.getESSCertID=function(e){var t={},n=l(e,0);if(n.length>0){var r=i(e,n[0]);t.hash=r}if(n.length>1){var a=o(e,n[1]),s=this.getIssuerSerial(a);void 0!=s.serial&&(t.serial=s.serial),void 0!=s.issuer&&(t.issuer=s.issuer)}return t},this.getESSCertIDv2=function(t){var r={},a=l(t,0);if(a.length<1||3<a.length)throw new e("wrong number of elements");var s=0;if("30"==t.substr(a[0],2)){var u=o(t,a[0]);r.alg=n.getAlgorithmIdentifierName(u),s++}else r.alg="sha256";var c=i(t,a[s]);if(r.hash=c,a.length>s+1){var d=o(t,a[s+1]),h=this.getIssuerSerial(d);r.issuer=h.issuer,r.serial=h.serial}return r},this.getIssuerSerial=function(e){var t={},r=l(e,0),a=o(e,r[0]),s=n.getGeneralNames(a)[0].dn;t.issuer=s;var u=i(e,r[1]);return t.serial={hex:u},t},this.getCertificateSet=function(e){for(var t=l(e,0),n=[],r=0;r<t.length;r++){var i=o(e,t[r]);if("30"==i.substr(0,2)){var a=we(i,"CERTIFICATE");n.push(a)}}return{array:n,sortflag:!1}}},"undefined"!=typeof ee&&ee||(ee={}),"undefined"!=typeof ee.asn1&&ee.asn1||(ee.asn1={}),"undefined"!=typeof ee.asn1.tsp&&ee.asn1.tsp||(ee.asn1.tsp={}),ee.asn1.tsp.TimeStampToken=function(e){var t=ee.asn1.tsp;t.TimeStampToken.superclass.constructor.call(this),this.params=null,this.getEncodedHexPrepare=function(){var e=new t.TSTInfo(this.params.econtent.content);this.params.econtent.content.hex=e.tohex()},void 0!=e&&this.setByParam(e)},Ge(ee.asn1.tsp.TimeStampToken,ee.asn1.cms.SignedData),ee.asn1.tsp.TSTInfo=function(e){Error;var t=ee.asn1,n=t.DERSequence,r=t.DERInteger,i=t.DERBoolean,o=t.DERGeneralizedTime,a=t.DERObjectIdentifier,s=t.DERTaggedObject,u=t.tsp,c=u.MessageImprint,l=u.Accuracy,d=(t.x509.X500Name,t.x509.GeneralName);if(u.TSTInfo.superclass.constructor.call(this),this.dVersion=new r({int:1}),this.dPolicy=null,this.dMessageImprint=null,this.dSerial=null,this.dGenTime=null,this.dAccuracy=null,this.dOrdering=null,this.dNonce=null,this.dTsa=null,this.tohex=function(){var e=[this.dVersion];if(null==this.dPolicy)throw new Error("policy shall be specified.");if(e.push(this.dPolicy),null==this.dMessageImprint)throw new Error("messageImprint shall be specified.");if(e.push(this.dMessageImprint),null==this.dSerial)throw new Error("serialNumber shall be specified.");if(e.push(this.dSerial),null==this.dGenTime)throw new Error("genTime shall be specified.");e.push(this.dGenTime),null!=this.dAccuracy&&e.push(this.dAccuracy),null!=this.dOrdering&&e.push(this.dOrdering),null!=this.dNonce&&e.push(this.dNonce),null!=this.dTsa&&e.push(this.dTsa);var t=new n({array:e});return this.hTLV=t.tohex(),this.hTLV},this.getEncodedHex=function(){return this.tohex()},void 0!==e){if("string"==typeof e.policy){if(!e.policy.match(/^[0-9.]+$/))throw"policy shall be oid like 0.1.4.134";this.dPolicy=new a({oid:e.policy})}void 0!==e.messageImprint&&(this.dMessageImprint=new c(e.messageImprint)),void 0!==e.serial&&(this.dSerial=new r(e.serial)),void 0!==e.genTime&&(this.dGenTime=new o(e.genTime)),void 0!==e.accuracy&&(this.dAccuracy=new l(e.accuracy)),void 0!==e.ordering&&1==e.ordering&&(this.dOrdering=new i),void 0!==e.nonce&&(this.dNonce=new r(e.nonce)),void 0!==e.tsa&&(this.dTsa=new s({tag:"a0",explicit:!0,obj:new d({dn:e.tsa})}))}},Ge(ee.asn1.tsp.TSTInfo,ee.asn1.ASN1Object),ee.asn1.tsp.Accuracy=function(e){var t=ee.asn1,n=t.ASN1Util.newObject;t.tsp.Accuracy.superclass.constructor.call(this),this.params=null,this.tohex=function(){var e=this.params,t=[];return void 0!=e.seconds&&"number"==typeof e.seconds&&t.push({int:e.seconds}),void 0!=e.millis&&"number"==typeof e.millis&&t.push({tag:{tagi:"80",obj:{int:e.millis}}}),void 0!=e.micros&&"number"==typeof e.micros&&t.push({tag:{tagi:"81",obj:{int:e.micros}}}),n({seq:t}).tohex()},this.getEncodedHex=function(){return this.tohex()},void 0!=e&&this.setByParam(e)},Ge(ee.asn1.tsp.Accuracy,ee.asn1.ASN1Object),ee.asn1.tsp.MessageImprint=function(e){var t=ee.asn1,n=t.DERSequence,r=t.DEROctetString,i=t.x509.AlgorithmIdentifier;t.tsp.MessageImprint.superclass.constructor.call(this),this.params=null,this.tohex=function(){var e=this.params,t=new i({name:e.alg}),o=new r({hex:e.hash});return new n({array:[t,o]}).tohex()},this.getEncodedHex=function(){return this.tohex()},void 0!==e&&this.setByParam(e)},Ge(ee.asn1.tsp.MessageImprint,ee.asn1.ASN1Object),ee.asn1.tsp.TimeStampReq=function(e){var t=ee.asn1,n=t.DERSequence,r=t.DERInteger,i=t.DERBoolean,o=(t.ASN1Object,t.DERObjectIdentifier),a=t.tsp,s=a.MessageImprint;a.TimeStampReq.superclass.constructor.call(this),this.params=null,this.tohex=function(){var e=this.params,t=[];return t.push(new r({int:1})),e.messageImprint instanceof ee.asn1.ASN1Object?t.push(e.messageImprint):t.push(new s(e.messageImprint)),void 0!=e.policy&&t.push(new o(e.policy)),void 0!=e.nonce&&t.push(new r(e.nonce)),1==e.certreq&&t.push(new i),new n({array:t}).tohex()},this.getEncodedHex=function(){return this.tohex()},void 0!=e&&this.setByParam(e)},Ge(ee.asn1.tsp.TimeStampReq,ee.asn1.ASN1Object),ee.asn1.tsp.TimeStampResp=function(e){var t=ee.asn1,n=t.DERSequence,r=(t.ASN1Object,t.tsp),i=r.PKIStatusInfo;r.TimeStampResp.superclass.constructor.call(this),this.params=null,this.tohex=function(){var e=this.params,o=[];if(void 0!=e.econtent||void 0!=e.tst)if(void 0!=e.statusinfo?o.push(new i(e.statusinfo)):o.push(new i("granted")),void 0!=e.econtent)o.push(new r.TimeStampToken(e).getContentInfo());else{if(!(e.tst instanceof t.ASN1Object))throw new Error("improper member tst value");o.push(e.tst)}else{if(void 0==e.statusinfo)throw new Error("parameter for token nor statusinfo not specified");o.push(new i(e.statusinfo))}return new n({array:o}).tohex()},this.getEncodedHex=function(){return this.tohex()},void 0!=e&&this.setByParam(e)},Ge(ee.asn1.tsp.TimeStampResp,ee.asn1.ASN1Object),ee.asn1.tsp.PKIStatusInfo=function(e){var t=Error,n=ee.asn1,r=n.DERSequence,i=n.tsp,o=i.PKIStatus,a=i.PKIFreeText,s=i.PKIFailureInfo;i.PKIStatusInfo.superclass.constructor.call(this),this.params=null,this.tohex=function(){var e=this.params,n=[];if("string"==typeof e)n.push(new o(e));else{if(void 0==e.status)throw new t("property 'status' unspecified");n.push(new o(e.status)),void 0!=e.statusstr&&n.push(new a(e.statusstr)),void 0!=e.failinfo&&n.push(new s(e.failinfo))}return new r({array:n}).tohex()},this.getEncodedHex=function(){return this.tohex()},void 0!=e&&this.setByParam(e)},Ge(ee.asn1.tsp.PKIStatusInfo,ee.asn1.ASN1Object),ee.asn1.tsp.PKIStatus=function(e){var t=Error,n=ee.asn1,r=n.DERInteger;n.tsp.PKIStatus.superclass.constructor.call(this);var i={granted:0,grantedWithMods:1,rejection:2,waiting:3,revocationWarning:4,revocationNotification:5};this.params=null,this.tohex=function(){var e,n=this.params;if("string"==typeof n)try{e=i[n]}catch(o){throw new t("undefined name: "+n)}else{if("number"!=typeof n)throw new t("unsupported params");e=n}return new r({int:e}).tohex()},this.getEncodedHex=function(){return this.tohex()},void 0!=e&&this.setByParam(e)},Ge(ee.asn1.tsp.PKIStatus,ee.asn1.ASN1Object),ee.asn1.tsp.PKIFreeText=function(e){var t=Error,n=ee.asn1,r=n.DERSequence,i=n.DERUTF8String;n.tsp.PKIFreeText.superclass.constructor.call(this),this.params=null,this.tohex=function(){var e=this.params;if(!e instanceof Array)throw new t("wrong params: not array");for(var n=[],o=0;o<e.length;o++)n.push(new i({str:e[o]}));return new r({array:n}).tohex()},this.getEncodedHex=function(){return this.tohex()},void 0!=e&&this.setByParam(e)},Ge(ee.asn1.tsp.PKIFreeText,ee.asn1.ASN1Object),ee.asn1.tsp.PKIFailureInfo=function(e){var t=Error,n=ee.asn1,r=n.DERBitString,i=n.tsp.PKIFailureInfo,o={badAlg:0,badRequest:2,badDataFormat:5,timeNotAvailable:14,unacceptedPolicy:15,unacceptedExtension:16,addInfoNotAvailable:17,systemFailure:25};i.superclass.constructor.call(this),this.params=null,this.getBinValue=function(){var e=this.params,n=0;if("number"==typeof e&&0<=e&&e<=25){for(var r=(n|=1<<e).toString(2),i="",a=r.length-1;a>=0;a--)i+=r[a];return i}if("string"==typeof e&&void 0!=o[e])return ze([e],o);if("object"==typeof e&&void 0!=e.length)return ze(e,o);throw new t("wrong params")},this.tohex=function(){this.params;var e=this.getBinValue();return new r({bin:e}).tohex()},this.getEncodedHex=function(){return this.tohex()},void 0!=e&&this.setByParam(e)},Ge(ee.asn1.tsp.PKIFailureInfo,ee.asn1.ASN1Object),ee.asn1.tsp.AbstractTSAAdapter=function(e){this.getTSTHex=function(e,t){throw"not implemented yet"}},ee.asn1.tsp.SimpleTSAAdapter=function(e){var t=ee,n=t.asn1.tsp,r=t.crypto.Util.hashHex;n.SimpleTSAAdapter.superclass.constructor.call(this),this.params=null,this.serial=0,this.getTSTHex=function(e,t){var i=r(e,t);this.params.econtent.content.messageImprint={alg:t,hash:i},this.params.econtent.content.serial={int:this.serial++};var o=Math.floor(1e9*Math.random());return this.params.econtent.content.nonce={int:o},new n.TimeStampToken(this.params).getContentInfoEncodedHex()},void 0!==e&&(this.params=e)},Ge(ee.asn1.tsp.SimpleTSAAdapter,ee.asn1.tsp.AbstractTSAAdapter),ee.asn1.tsp.FixedTSAAdapter=function(e){var t=ee,n=t.asn1.tsp,r=t.crypto.Util.hashHex;n.FixedTSAAdapter.superclass.constructor.call(this),this.params=null,this.getTSTHex=function(e,t){var i=r(e,t);return this.params.econtent.content.messageImprint={alg:t,hash:i},new n.TimeStampToken(this.params).getContentInfoEncodedHex()},void 0!==e&&(this.params=e)},Ge(ee.asn1.tsp.FixedTSAAdapter,ee.asn1.tsp.AbstractTSAAdapter),ee.asn1.tsp.TSPUtil=new function(){},ee.asn1.tsp.TSPUtil.newTimeStampToken=function(e){return new ee.asn1.tsp.TimeStampToken(e)},ee.asn1.tsp.TSPUtil.parseTimeStampReq=function(e){return(new ee.asn1.tsp.TSPParser).getTimeStampReq(e)},ee.asn1.tsp.TSPUtil.parseMessageImprint=function(e){return(new ee.asn1.tsp.TSPParser).getMessageImprint(e)},ee.asn1.tsp.TSPParser=function(){Error;var e=new Ye,t=re,n=t.getV,r=t.getTLV,i=t.getIdxbyList,o=(t.getTLVbyListEx,t.getChildIdx),a=["granted","grantedWithMods","rejection","waiting","revocationWarning","revocationNotification"],s={0:"badAlg",2:"badRequest",5:"badDataFormat",14:"timeNotAvailable",15:"unacceptedPolicy",16:"unacceptedExtension",17:"addInfoNotAvailable",25:"systemFailure"};this.getResponse=function(e){var t=o(e,0);if(1==t.length)return this.getPKIStatusInfo(r(e,t[0]));if(t.length>1){var n=this.getPKIStatusInfo(r(e,t[0])),i=r(e,t[1]),a=this.getToken(i);return a.statusinfo=n,a}},this.getToken=function(e){var t=(new ee.asn1.cms.CMSParser).getCMSSignedData(e);return this.setTSTInfo(t),t},this.setTSTInfo=function(e){var t=e.econtent;if("tstinfo"==t.type){var n=t.content.hex,r=this.getTSTInfo(n);t.content=r}},this.getTSTInfo=function(t){var i={},a=o(t,0),s=n(t,a[1]);i.policy=Be(s);var u=r(t,a[2]);i.messageImprint=this.getMessageImprint(u);var c=n(t,a[3]);i.serial={hex:c};var l=n(t,a[4]);i.genTime={str:fe(l)};var d=0;if(a.length>5&&"30"==t.substr(a[5],2)){var h=r(t,a[5]);i.accuracy=this.getAccuracy(h),d++}a.length>5+d&&"01"==t.substr(a[5+d],2)&&("ff"==n(t,a[5+d])&&(i.ordering=!0),d++);if(a.length>5+d&&"02"==t.substr(a[5+d],2)){var f=n(t,a[5+d]);i.nonce={hex:f},d++}if(a.length>5+d&&"a0"==t.substr(a[5+d],2)){var p=r(t,a[5+d]);p="30"+p.substr(2),pGeneralNames=e.getGeneralNames(p);var v=pGeneralNames[0].dn;i.tsa=v,d++}if(a.length>5+d&&"a1"==t.substr(a[5+d],2)){var g=r(t,a[5+d]);g="30"+g.substr(2);var m=e.getExtParamArray(g);i.ext=m,d++}return i},this.getAccuracy=function(e){for(var t={},r=o(e,0),i=0;i<r.length;i++){var a=e.substr(r[i],2),s=n(e,r[i]),u=parseInt(s,16);"02"==a?t.seconds=u:"80"==a?t.millis=u:"81"==a&&(t.micros=u)}return t},this.getMessageImprint=function(e){if("30"!=e.substr(0,2))throw new Error("head of messageImprint hex shall be x30");var r={},a=(o(e,0),i(e,0,[0,0])),s=n(e,a),u=t.hextooidstr(s),c=ee.asn1.x509.OID.oid2name(u);if(""==c)throw new Error("hashAlg name undefined: "+u);var l=c,d=i(e,0,[1]);return r.alg=l,r.hash=n(e,d),r},this.getPKIStatusInfo=function(e){var t={},i=o(e,0),s=0;try{var u=n(e,i[0]),c=parseInt(u,16);t.status=a[c]}catch(h){}if(i.length>1&&"30"==e.substr(i[1],2)){var l=r(e,i[1]);t.statusstr=this.getPKIFreeText(l),s++}if(i.length>s&&"03"==e.substr(i[1+s],2)){var d=r(e,i[1+s]);t.failinfo=this.getPKIFailureInfo(d)}return t},this.getPKIFreeText=function(e){for(var n=[],r=o(e,0),i=0;i<r.length;i++)n.push(t.getString(e,r[i]));return n},this.getPKIFailureInfo=function(e){var n=t.getInt(e,0);return void 0!=s[n]?s[n]:n},this.getTimeStampReq=function(e){var i={certreq:!1},a=o(e,0);if(a.length<2)throw new Error("TimeStampReq must have at least 2 items");var s=r(e,a[1]);i.messageImprint=ee.asn1.tsp.TSPUtil.parseMessageImprint(s);for(var u=2;u<a.length;u++){var c=a[u],l=e.substr(c,2);if("06"==l){var d=n(e,c);i.policy=t.hextooidstr(d)}"02"==l&&(i.nonce=n(e,c)),"01"==l&&(i.certreq=!0)}return i}},"undefined"!=typeof ee&&ee||(ee={}),"undefined"!=typeof ee.asn1&&ee.asn1||(ee.asn1={}),"undefined"!=typeof ee.asn1.cades&&ee.asn1.cades||(ee.asn1.cades={}),ee.asn1.cades.SignaturePolicyIdentifier=function(e){var t=ee.asn1.cades,n=t.SignaturePolicyId;t.SignaturePolicyIdentifier.superclass.constructor.call(this),this.typeOid="1.2.840.113549.1.9.16.2.15",this.params=null,this.getValueArray=function(){return[new n(this.params)]},this.setByParam=function(e){this.params=e},void 0!=e&&this.setByParam(e)},Ge(ee.asn1.cades.SignaturePolicyIdentifier,ee.asn1.cms.Attribute),ee.asn1.cades.SignaturePolicyId=function(e){var t=ee.asn1,n=t.DERSequence,r=t.DERObjectIdentifier,i=(t.x509.AlgorithmIdentifier,t.cades),o=i.SignaturePolicyId,a=i.OtherHashAlgAndValue;o.superclass.constructor.call(this),this.params=null,this.tohex=function(){var e=this.params,t=[];return t.push(new r(e.oid)),t.push(new a(e)),new n({array:t}).tohex()},this.getEncodedHex=function(){return this.tohex()},this.setByParam=function(e){this.params=e},void 0!=e&&this.setByParam(e)},Ge(ee.asn1.cades.SignaturePolicyId,ee.asn1.ASN1Object),ee.asn1.cades.OtherHashAlgAndValue=function(e){var t=Error,n=ee.asn1,r=n.DERSequence,i=n.DEROctetString,o=n.x509.AlgorithmIdentifier;n.cades.OtherHashAlgAndValue.superclass.constructor.call(this),this.params=null,this.tohex=function(){var e=this.params;if(void 0==e.alg)throw new t("property 'alg' not specified");if(void 0==e.hash&&void 0==e.cert)throw new t("property 'hash' nor 'cert' not specified");var n=null;if(void 0!=e.hash)n=e.hash;else if(void 0!=e.cert){if("string"!=typeof e.cert)throw new t("cert not string");var a=e.cert;-1!=e.cert.indexOf("-----BEGIN")&&(a=Se(e.cert)),n=ee.crypto.Util.hashHex(a,e.alg)}var s=[];return s.push(new o({name:e.alg})),s.push(new i({hex:n})),new r({array:s}).tohex()},this.getEncodedHex=function(){return this.tohex()},void 0!=e&&this.setByParam(e)},Ge(ee.asn1.cades.OtherHashAlgAndValue,ee.asn1.ASN1Object),ee.asn1.cades.OtherHashValue=function(e){ee.asn1.cades.OtherHashValue.superclass.constructor.call(this);var t=Error,n=ee,r=(n.lang.String.isHex,n.asn1.DEROctetString);n.crypto.Util.hashHex;this.params=null,this.tohex=function(){var e=this.params;if(void 0==e.hash&&void 0==e.cert)throw new t("hash or cert not specified");var n=null;if(void 0!=e.hash)n=e.hash;else if(void 0!=e.cert){if("string"!=typeof e.cert)throw new t("cert not string");var i=e.cert;-1!=e.cert.indexOf("-----BEGIN")&&(i=Se(e.cert)),n=ee.crypto.Util.hashHex(i,"sha1")}return new r({hex:n}).tohex()},this.getEncodedHex=function(){return this.tohex()},void 0!=e&&this.setByParam(e)},Ge(ee.asn1.cades.OtherHashValue,ee.asn1.ASN1Object),ee.asn1.cades.SignatureTimeStamp=function(e){var t=Error,n=ee,r=n.lang.String.isHex,i=n.asn1,o=i.ASN1Object;i.x509;i.cades.SignatureTimeStamp.superclass.constructor.call(this),this.typeOid="1.2.840.113549.1.9.16.2.14",this.params=null,this.getValueArray=function(){var e=this.params;if(void 0!=e.tst){if(r(e.tst))return(i=new o).hTLV=e.tst,[i];if(e.tst instanceof o)return[e.tst];throw new t("params.tst has wrong value")}if(void 0!=e.res){var n=e.res;if(n instanceof o&&(n=n.tohex()),"string"!=typeof n||!r(n))throw new t("params.res has wrong value");var i;re.getTLVbyList(n,0,[1]);return(i=new o).hTLV=e.tst,[i]}},null!=e&&this.setByParam(e)},Ge(ee.asn1.cades.SignatureTimeStamp,ee.asn1.cms.Attribute),ee.asn1.cades.CompleteCertificateRefs=function(e){var t=Error,n=ee,r=n.asn1,i=r.DERSequence,o=r.cades,a=o.OtherCertID,s=n.lang.String.isHex;o.CompleteCertificateRefs.superclass.constructor.call(this),this.typeOid="1.2.840.113549.1.9.16.2.21",this.params=null,this.getValueArray=function(){for(var e=this.params,n=[],r=0;r<e.array.length;r++){var o=e.array[r];if("string"==typeof o)if(-1!=o.indexOf("-----BEGIN"))o={cert:o};else{if(!s(o))throw new t("unsupported value: "+o);o={hash:o}}void 0!=e.alg&&void 0==o.alg&&(o.alg=e.alg),void 0!=e.hasis&&void 0==o.hasis&&(o.hasis=e.hasis);var u=new a(o);n.push(u)}return[new i({array:n})]},void 0!=e&&this.setByParam(e)},Ge(ee.asn1.cades.CompleteCertificateRefs,ee.asn1.cms.Attribute),ee.asn1.cades.OtherCertID=function(e){var t=ee.asn1,n=t.DERSequence,r=t.cms.IssuerSerial,i=t.cades,o=i.OtherHashValue,a=i.OtherHashAlgAndValue;i.OtherCertID.superclass.constructor.call(this),this.params=e,this.tohex=function(){var e=this.params;"string"==typeof e&&(-1!=e.indexOf("-----BEGIN")?e={cert:e}:_isHex(e)&&(e={hash:e}));var t=[],i=null;if(i=void 0!=e.alg?new a(e):new o(e),t.push(i),void 0!=e.cert&&1==e.hasis||void 0!=e.issuer&&void 0!=e.serial){var s=new r(e);t.push(s)}return new n({array:t}).tohex()},this.getEncodedHex=function(){return this.tohex()},void 0!=e&&this.setByParam(e)},Ge(ee.asn1.cades.OtherCertID,ee.asn1.ASN1Object),ee.asn1.cades.OtherHash=function(e){Error;var t=ee,n=t.asn1,r=(n.cms,n.cades),i=r.OtherHashAlgAndValue,o=r.OtherHashValue,a=(t.crypto.Util.hashHex,t.lang.String.isHex);r.OtherHash.superclass.constructor.call(this),this.params=null,this.tohex=function(){var e=this.params;"string"==typeof e&&(-1!=e.indexOf("-----BEGIN")?e={cert:e}:a(e)&&(e={hash:e}));return(void 0!=e.alg?new i(e):new o(e)).tohex()},this.getEncodedHex=function(){return this.tohex()},void 0!=e&&this.setByParam(e)},Ge(ee.asn1.cades.OtherHash,ee.asn1.ASN1Object),ee.asn1.cades.CAdESUtil=new function(){},ee.asn1.cades.CAdESUtil.parseSignedDataForAddingUnsigned=function(e){return(new ee.asn1.cms.CMSParser).getCMSSignedData(e)},ee.asn1.cades.CAdESUtil.parseSignerInfoForAddingUnsigned=function(e,t,n){var r=re,i=r.getChildIdx,o=r.getTLV,a=r.getV,s=ee.asn1,u=s.ASN1Object,c=s.cms,l=c.AttributeList,d=c.SignerInfo,h={},f=i(e,t);if(6!=f.length)throw"not supported items for SignerInfo (!=6)";var p=f.shift();h.version=o(e,p);var v=f.shift();h.si=o(e,v);var g=f.shift();h.digalg=o(e,g);var m=f.shift();h.sattrs=o(e,m);var y=f.shift();h.sigalg=o(e,y);var b=f.shift();h.sig=o(e,b),h.sigval=a(e,b);var w=null;return h.obj=new d,(w=new u).hTLV=h.version,h.obj.dCMSVersion=w,(w=new u).hTLV=h.si,h.obj.dSignerIdentifier=w,(w=new u).hTLV=h.digalg,h.obj.dDigestAlgorithm=w,(w=new u).hTLV=h.sattrs,h.obj.dSignedAttrs=w,(w=new u).hTLV=h.sigalg,h.obj.dSigAlg=w,(w=new u).hTLV=h.sig,h.obj.dSig=w,h.obj.dUnsignedAttrs=new l,h},"undefined"!=typeof ee.asn1.csr&&ee.asn1.csr||(ee.asn1.csr={}),ee.asn1.csr.CertificationRequest=function(e){var t=ee.asn1,n=t.DERBitString,r=t.DERSequence,i=t.csr,o=(t.x509,i.CertificationRequestInfo);i.CertificationRequest.superclass.constructor.call(this),this.setByParam=function(e){this.params=e},this.sign=function(){var e=new o(this.params).tohex(),t=new ee.crypto.Signature({alg:this.params.sigalg});t.init(this.params.sbjprvkey),t.updateHex(e);var n=t.sign();this.params.sighex=n},this.getPEM=function(){return we(this.tohex(),"CERTIFICATE REQUEST")},this.tohex=function(){var e=this.params,t=new ee.asn1.csr.CertificationRequestInfo(this.params),i=new ee.asn1.x509.AlgorithmIdentifier({name:e.sigalg});if(void 0==e.sighex&&void 0!=e.sbjprvkey&&this.sign(),void 0==e.sighex)throw new Error("sighex or sbjprvkey parameter not defined");var o=new n({hex:"00"+e.sighex});return new r({array:[t,i,o]}).tohex()},this.getEncodedHex=function(){return this.tohex()},void 0!==e&&this.setByParam(e)},Ge(ee.asn1.csr.CertificationRequest,ee.asn1.ASN1Object),ee.asn1.csr.CertificationRequestInfo=function(e){var t=ee.asn1,n=(t.DERBitString,t.DERSequence),r=t.DERInteger,i=t.DERUTF8String,o=t.DERTaggedObject,a=t.ASN1Util.newObject,s=t.csr,u=t.x509,c=u.X500Name,l=u.Extensions,d=u.SubjectPublicKeyInfo;s.AttributeList;s.CertificationRequestInfo.superclass.constructor.call(this),this.params=null,this.setByParam=function(e){void 0!=e&&(this.params=e)},this.tohex=function(){var e=this.params,t=[];if(t.push(new r({int:0})),t.push(new c(e.subject)),t.push(new d(Ke.getKey(e.sbjpubkey))),void 0!=e.attrs){var s=function(e){for(var t=Error,n=ee.asn1.x509.Extensions,r=[],i=0;i<e.length;i++){var o=e[i],a=o.attr;if("extensionRequest"==a){var s={seq:[{oid:"1.2.840.113549.1.9.14"},{set:[new n(o.ext)]}]};r.push(s)}else if("unstructuredName"==a){s={seq:[{oid:"1.2.840.113549.1.9.2"},{set:o.names}]};r.push(s)}else{if("challengePassword"!=a)throw new t("unknown CSR attribute");s={seq:[{oid:"1.2.840.113549.1.9.7"},{set:[{utf8str:o.password}]}]};r.push(s)}}return{set:r}}(e.attrs),u=a({tag:{tage:"a0",obj:s}});t.push(u)}else if(void 0!=e.extreq){var h=new l(e.extreq);u=a({tag:{tage:"a0",obj:{seq:[{oid:"1.2.840.113549.1.9.14"},{set:[h]}]}}});t.push(u)}else t.push(new o({tag:"a0",explicit:!1,obj:new i({str:""})}));return new n({array:t}).tohex()},this.getEncodedHex=function(){return this.tohex()},void 0!=e&&this.setByParam(e)},Ge(ee.asn1.csr.CertificationRequestInfo,ee.asn1.ASN1Object),ee.asn1.csr.AttributeList=function(e){},Ge(ee.asn1.csr.AttributeList,ee.asn1.ASN1Object),ee.asn1.csr.CSRUtil=new function(){},ee.asn1.csr.CSRUtil.newCSRPEM=function(e){return new ee.asn1.csr.CertificationRequest(e).getPEM()},ee.asn1.csr.CSRUtil.getParam=function(e,t){var n=re,r=n.getV,i=n.getIdxbyList,o=n.getTLVbyList,a=n.getTLVbyListEx,s=n.getVbyListEx,u={};if(-1==e.indexOf("-----BEGIN CERTIFICATE REQUEST"))throw new Error("argument is not PEM file");var c=Se(e,"CERTIFICATE REQUEST");t&&(u.tbs=o(c,0,[0]));try{var l=a(c,0,[0,1]);if("3000"==l)u.subject={};else{var d=new Ye;u.subject=d.getX500Name(l)}}catch(m){}var h=a(c,0,[0,2]),f=Ke.getKey(h,null,"pkcs8pub");u.sbjpubkey=Ke.getPEM(f,"PKCS8PUB");var p=function(e){var t=i(e,0,[0,3,0,0],"06");return"2a864886f70d01090e"!=r(e,t)?null:o(e,0,[0,3,0,1,0],"30")}(c);d=new Ye;null!=p&&(u.extreq=d.getExtParamArray(p));try{var v=a(c,0,[1],"30");d=new Ye;u.sigalg=d.getAlgorithmIdentifierName(v)}catch(m){}try{var g=s(c,0,[2]);u.sighex=g}catch(m){}return u},ee.asn1.csr.CSRUtil.verifySignature=function(e){try{var t=null;if("string"==typeof e&&-1!=e.indexOf("-----BEGIN CERTIFICATE REQUEST")?t=ee.asn1.csr.CSRUtil.getParam(e,!0):"object"==typeof e&&void 0!=e.sbjpubkey&&void 0!=e.sigalg&&void 0!=e.sighex&&void 0!=e.tbs&&(t=e),null==t)return!1;var n=new ee.crypto.Signature({alg:t.sigalg});return n.init(t.sbjpubkey),n.updateHex(t.tbs),n.verify(t.sighex)}catch(r){return alert(r),!1}},"undefined"!=typeof ee&&ee||(ee={}),"undefined"!=typeof ee.asn1&&ee.asn1||(ee.asn1={}),"undefined"!=typeof ee.asn1.ocsp&&ee.asn1.ocsp||(ee.asn1.ocsp={}),ee.asn1.ocsp.DEFAULT_HASH="sha1",ee.asn1.ocsp.OCSPResponse=function(e){ee.asn1.ocsp.OCSPResponse.superclass.constructor.call(this);ee.asn1.DEREnumerated;var t=ee.asn1.ASN1Util.newObject,n=ee.asn1.ocsp.ResponseBytes,r=["successful","malformedRequest","internalError","tryLater","_not_used_","sigRequired","unauthorized"];this.params=null,this._getStatusCode=function(){var e=this.params.resstatus;return"number"==typeof e?e:"string"!=typeof e?-1:r.indexOf(e)},this.setByParam=function(e){this.params=e},this.tohex=function(){var e=this.params,r=this._getStatusCode();if(-1==r)throw new Error("responseStatus not supported: "+e.resstatus);if(0!=r)return t({seq:[{enum:{int:r}}]}).tohex();var i=new n(e);return t({seq:[{enum:{int:0}},{tag:{tag:"a0",explicit:!0,obj:i}}]}).tohex()},this.getEncodedHex=function(){return this.tohex()},void 0!==e&&this.setByParam(e)},Ge(ee.asn1.ocsp.OCSPResponse,ee.asn1.ASN1Object),ee.asn1.ocsp.ResponseBytes=function(e){ee.asn1.ocsp.ResponseBytes.superclass.constructor.call(this);var t=ee.asn1,n=t.DERSequence,r=t.DERObjectIdentifier,i=t.DEROctetString,o=t.ocsp.BasicOCSPResponse;this.params=null,this.setByParam=function(e){this.params=e},this.tohex=function(){var e=this.params;if("ocspBasic"!=e.restype)throw new Error("not supported responseType: "+e.restype);var t=new o(e),a=[];return a.push(new r({name:"ocspBasic"})),a.push(new i({hex:t.tohex()})),new n({array:a}).tohex()},this.getEncodedHex=function(){return this.tohex()},void 0!==e&&this.setByParam(e)},Ge(ee.asn1.ocsp.ResponseBytes,ee.asn1.ASN1Object),ee.asn1.ocsp.BasicOCSPResponse=function(e){ee.asn1.ocsp.BasicOCSPResponse.superclass.constructor.call(this);var t=Error,n=ee.asn1,r=n.ASN1Object,i=n.DERSequence,o=(n.DERGeneralizedTime,n.DERTaggedObject),a=n.DERBitString,s=(n.x509.Extensions,n.x509.AlgorithmIdentifier),u=n.ocsp;u.ResponderID;_SingleResponseList=u.SingleResponseList,_ResponseData=u.ResponseData,this.params=null,this.setByParam=function(e){this.params=e},this.sign=function(){var e=this.params,t=e.tbsresp.tohex(),n=new ee.crypto.Signature({alg:e.sigalg});n.init(e.reskey),n.updateHex(t),e.sighex=n.sign()},this.tohex=function(){var e=this.params;void 0==e.tbsresp&&(e.tbsresp=new _ResponseData(e)),void 0==e.sighex&&void 0!=e.reskey&&this.sign();var n=[];if(n.push(e.tbsresp),n.push(new s({name:e.sigalg})),n.push(new a({hex:"00"+e.sighex})),void 0!=e.certs&&void 0!=e.certs.length){for(var u=[],c=0;c<e.certs.length;c++){var l=e.certs[c],d=null;if(re.isASN1HEX(l))d=l;else{if(!l.match(/-----BEGIN/))throw new t("certs["+c+"] not hex or PEM");d=Se(l)}u.push(new r({tlv:d}))}var h=new i({array:u});n.push(new o({tag:"a0",explicit:!0,obj:h}))}return new i({array:n}).tohex()},this.getEncodedHex=function(){return this.tohex()},void 0!==e&&this.setByParam(e)},Ge(ee.asn1.ocsp.BasicOCSPResponse,ee.asn1.ASN1Object),ee.asn1.ocsp.ResponseData=function(e){ee.asn1.ocsp.ResponseData.superclass.constructor.call(this);var t=Error,n=ee.asn1,r=n.DERSequence,i=n.DERGeneralizedTime,o=n.DERTaggedObject,a=n.x509.Extensions,s=n.ocsp,u=s.ResponderID;_SingleResponseList=s.SingleResponseList,this.params=null,this.tohex=function(){var e=this.params;void 0!=e.respid&&new t("respid not specified"),void 0!=e.prodat&&new t("prodat not specified"),void 0!=e.array&&new t("array not specified");var n=[];if(n.push(new u(e.respid)),n.push(new i(e.prodat)),n.push(new _SingleResponseList(e.array)),void 0!=e.ext){var s=new a(e.ext);n.push(new o({tag:"a1",explicit:!0,obj:s}))}return new r({array:n}).tohex()},this.getEncodedHex=function(){return this.tohex()},this.setByParam=function(e){this.params=e},void 0!==e&&this.setByParam(e)},Ge(ee.asn1.ocsp.ResponseData,ee.asn1.ASN1Object),ee.asn1.ocsp.ResponderID=function(e){ee.asn1.ocsp.ResponderID.superclass.constructor.call(this);var t=ee,n=t.asn1,r=n.ASN1Util.newObject,i=n.x509.X500Name,o=t.lang.String.isHex,a=Error;this.params=null,this.tohex=function(){var e=this.params;if(void 0!=e.key){var t,n=null;if("string"==typeof e.key){if(o(e.key)&&(n=e.key),e.key.match(/-----BEGIN CERTIFICATE/))null!=(t=new Ye(e.key).getExtSubjectKeyIdentifier())&&(n=t.kid.hex)}else if(e.key instanceof Ye)null!=(t=e.key.getExtSubjectKeyIdentifier())&&(n=t.kid.hex);if(null==n)throw new a("wrong key member value");return r({tag:{tag:"a2",explicit:!0,obj:{octstr:{hex:n}}}}).tohex()}if(void 0!=e.name){var s=null;if("string"==typeof e.name&&e.name.match(/-----BEGIN CERTIFICATE/))s=new Ye(e.name).getSubject();else e.name instanceof Ye?s=e.name.getSubject():"object"!=typeof e.name||void 0==e.name.array&&void 0==e.name.str||(s=e.name);if(null==s)throw new a("wrong name member value");return r({tag:{tag:"a1",explicit:!0,obj:new i(s)}}).tohex()}throw new a("key or name not specified")},this.getEncodedHex=function(){return this.tohex()},this.setByParam=function(e){this.params=e},void 0!==e&&this.setByParam(e)},Ge(ee.asn1.ocsp.ResponderID,ee.asn1.ASN1Object),ee.asn1.ocsp.SingleResponseList=function(e){ee.asn1.ocsp.SingleResponseList.superclass.constructor.call(this);var t=ee.asn1,n=t.DERSequence,r=t.ocsp.SingleResponse;this.params=null,this.tohex=function(){var e=this.params;if("object"!=typeof e||void 0==e.length)throw new Error("params not specified properly");for(var t=[],i=0;i<e.length;i++)t.push(new r(e[i]));return new n({array:t}).tohex()},this.getEncodedHex=function(){return this.tohex()},this.setByParam=function(e){this.params=e},void 0!==e&&this.setByParam(e)},Ge(ee.asn1.ocsp.SingleResponseList,ee.asn1.ASN1Object),ee.asn1.ocsp.SingleResponse=function(e){var t=Error,n=ee.asn1,r=n.DERSequence,i=n.DERGeneralizedTime,o=n.DERTaggedObject,a=n.ocsp,s=a.CertID,u=a.CertStatus,c=n.x509.Extensions;a.SingleResponse.superclass.constructor.call(this),this.params=null,this.tohex=function(){var e=this.params,n=[];if(void 0==e.certid)throw new t("certid unspecified");if(void 0==e.status)throw new t("status unspecified");if(void 0==e.thisupdate)throw new t("thisupdate unspecified");if(n.push(new s(e.certid)),n.push(new u(e.status)),n.push(new i(e.thisupdate)),void 0!=e.nextupdate){var a=new i(e.nextupdate);n.push(new o({tag:"a0",explicit:!0,obj:a}))}if(void 0!=e.ext){var l=new c(e.ext);n.push(new o({tag:"a1",explicit:!0,obj:l}))}return new r({array:n}).tohex()},this.getEncodedHex=function(){return this.tohex()},this.setByParam=function(e){this.params=e},void 0!==e&&this.setByParam(e)},Ge(ee.asn1.ocsp.SingleResponse,ee.asn1.ASN1Object),ee.asn1.ocsp.CertID=function(e){var t=ee,n=t.asn1,r=n.DEROctetString,i=n.DERInteger,o=n.DERSequence,a=n.x509.AlgorithmIdentifier,s=n.ocsp,u=(s.DEFAULT_HASH,t.crypto.Util.hashHex),c=Ye,l=re.getVbyList;s.CertID.superclass.constructor.call(this),this.DEFAULT_HASH="sha1",this.params=null,this.setByValue=function(e,t,n,r){void 0==r&&(r=this.DEFAULT_HASH),this.params={alg:r,issname:e,isskey:t,sbjsn:n}},this.setByCert=function(e,t,n){void 0==n&&(n=this.DEFAULT_HASH),this.params={alg:n,issuerCert:e,subjectCert:t}},this.getParamByCerts=function(e,t,n){void 0==n&&(n=this.DEFAULT_HASH);var r=new c(e),i=new c(t),o=u(r.getSubjectHex(),n),a=r.getPublicKeyHex();return{alg:n,issname:o,isskey:u(l(a,0,[1],"03",!0),n),sbjsn:i.getSerialNumberHex()}},this.tohex=function(){if("object"!=typeof this.params)throw new Error("params not set");var e,t,n,s,u=this.params;if(s=void 0==u.alg?this.DEFAULT_HASH:u.alg,void 0!=u.issuerCert&&void 0!=u.subjectCert){var c=this.getParamByCerts(u.issuerCert,u.subjectCert,s);e=c.issname,t=c.isskey,n=c.sbjsn}else{if(void 0==u.issname||void 0==u.isskey||void 0==u.sbjsn)throw new Error("required param members not defined");e=u.issname,t=u.isskey,n=u.sbjsn}var l=new a({name:s}),d=new r({hex:e}),h=new r({hex:t}),f=new i({hex:n}),p=new o({array:[l,d,h,f]});return this.hTLV=p.tohex(),this.hTLV},this.getEncodedHex=function(){return this.tohex()},void 0!==e&&this.setByParam(e)},Ge(ee.asn1.ocsp.CertID,ee.asn1.ASN1Object),ee.asn1.ocsp.CertStatus=function(e){ee.asn1.ocsp.CertStatus.superclass.constructor.call(this),this.params=null,this.tohex=function(){var e=this.params;if("good"==e.status)return"8000";if("unknown"==e.status)return"8200";if("revoked"==e.status){var t=[{gentime:{str:e.time}}];void 0!=e.reason&&t.push({tag:{tag:"a0",explicit:!0,obj:{enum:{int:e.reason}}}});var n={tag:"a1",explicit:!1,obj:{seq:t}};return ee.asn1.ASN1Util.newObject({tag:n}).tohex()}throw new Error("bad status")},this.getEncodedHex=function(){return this.tohex()},this.setByParam=function(e){this.params=e},void 0!==e&&this.setByParam(e)},Ge(ee.asn1.ocsp.CertStatus,ee.asn1.ASN1Object),ee.asn1.ocsp.Request=function(e){var t=ee.asn1,n=t.DERSequence,r=t.ocsp;if(r.Request.superclass.constructor.call(this),this.dReqCert=null,this.dExt=null,this.tohex=function(){var e=[];if(null===this.dReqCert)throw"reqCert not set";e.push(this.dReqCert);var t=new n({array:e});return this.hTLV=t.tohex(),this.hTLV},this.getEncodedHex=function(){return this.tohex()},"undefined"!==typeof e){var i=new r.CertID(e);this.dReqCert=i}},Ge(ee.asn1.ocsp.Request,ee.asn1.ASN1Object),ee.asn1.ocsp.TBSRequest=function(e){var t=ee.asn1,n=t.DERSequence,r=t.ocsp;r.TBSRequest.superclass.constructor.call(this),this.version=0,this.dRequestorName=null,this.dRequestList=[],this.dRequestExt=null,this.setRequestListByParam=function(e){for(var t=[],n=0;n<e.length;n++){var i=new r.Request(e[0]);t.push(i)}this.dRequestList=t},this.tohex=function(){var e=[];if(0!==this.version)throw"not supported version: "+this.version;if(null!==this.dRequestorName)throw"requestorName not supported";var t=new n({array:this.dRequestList});if(e.push(t),null!==this.dRequestExt)throw"requestExtensions not supported";var r=new n({array:e});return this.hTLV=r.tohex(),this.hTLV},this.getEncodedHex=function(){return this.tohex()},void 0!==e&&void 0!==e.reqList&&this.setRequestListByParam(e.reqList)},Ge(ee.asn1.ocsp.TBSRequest,ee.asn1.ASN1Object),ee.asn1.ocsp.OCSPRequest=function(e){var t=ee.asn1,n=t.DERSequence,r=t.ocsp;if(r.OCSPRequest.superclass.constructor.call(this),this.dTbsRequest=null,this.dOptionalSignature=null,this.tohex=function(){var e=[];if(null===this.dTbsRequest)throw"tbsRequest not set";if(e.push(this.dTbsRequest),null!==this.dOptionalSignature)throw"optionalSignature not supported";var t=new n({array:e});return this.hTLV=t.tohex(),this.hTLV},this.getEncodedHex=function(){return this.tohex()},void 0!==e&&void 0!==e.reqList){var i=new r.TBSRequest(e);this.dTbsRequest=i}},Ge(ee.asn1.ocsp.OCSPRequest,ee.asn1.ASN1Object),ee.asn1.ocsp.OCSPUtil={},ee.asn1.ocsp.OCSPUtil.getRequestHex=function(e,t,n){var r=ee.asn1.ocsp;void 0===n&&(n=r.DEFAULT_HASH);var i={alg:n,issuerCert:e,subjectCert:t};return new r.OCSPRequest({reqList:[i]}).tohex()},ee.asn1.ocsp.OCSPUtil.getOCSPResponseInfo=function(e){var t=re,n=t.getVbyList,r=t.getVbyListEx,i=t.getIdxbyList,o=(t.getIdxbyListEx,t.getV),a={};try{var s=r(e,0,[0],"0a");a.responseStatus=parseInt(s,16)}catch(d){}if(0!==a.responseStatus)return a;try{var u=i(e,0,[1,0,1,0,0,2,0,1]);"80"===e.substr(u,2)?a.certStatus="good":"a1"===e.substr(u,2)?(a.certStatus="revoked",a.revocationTime=fe(n(e,u,[0]))):"82"===e.substr(u,2)&&(a.certStatus="unknown")}catch(d){}try{var c=i(e,0,[1,0,1,0,0,2,0,2]);a.thisUpdate=fe(o(e,c))}catch(d){}try{var l=i(e,0,[1,0,1,0,0,2,0,3]);"a0"===e.substr(l,2)&&(a.nextUpdate=fe(n(e,l,[0])))}catch(d){}return a},ee.asn1.ocsp.OCSPParser=function(){var e=Error,t=Ye,n=new t,r=re,i=r.getV,o=r.getTLV,a=r.getIdxbyList,s=r.getVbyList,u=r.getTLVbyList,c=r.getVbyListEx,l=r.getTLVbyListEx,d=r.getChildIdx;this.getOCSPRequest=function(t){var n=d(t,0);if(1!=n.length&&2!=n.length)throw new e("wrong number elements: "+n.length);return this.getTBSRequest(o(t,n[0]))},this.getTBSRequest=function(e){var t={},r=l(e,0,[0],"30");t.array=this.getRequestList(r);var i=l(e,0,["[2]",0],"30");return null!=i&&(t.ext=n.getExtParamArray(i)),t},this.getRequestList=function(e){for(var t=[],n=d(e,0),r=0;r<n.length;r++){e=o(e,n[r]);t.push(this.getRequest(e))}return t},this.getRequest=function(t){var r=d(t,0);if(1!=r.length&&2!=r.length)throw new e("wrong number elements: "+r.length);var i=this.getCertID(o(t,r[0]));if(2==r.length){var s=a(t,0,[1,0]);i.ext=n.getExtParamArray(o(t,s))}return i},this.getCertID=function(n){var r=d(n,0);if(4!=r.length)throw new e("wrong number elements: "+r.length);var a=new t,s={};return s.alg=a.getAlgorithmIdentifierName(o(n,r[0])),s.issname=i(n,r[1]),s.isskey=i(n,r[2]),s.sbjsn=i(n,r[3]),s},this.getOCSPResponse=function(e){var t,n=d(e,0),r=i(e,n[0]),o=parseInt(r);if(1==n.length)return{resstatus:o};var a=u(e,0,[1,0]);return(t=this.getResponseBytes(a)).resstatus=o,t},this.getResponseBytes=function(e){var t,n=d(e,0),r=u(e,0,[1,0]);t=this.getBasicOCSPResponse(r);var o=i(e,n[0]);return t.restype=ee.asn1.x509.OID.oid2name(Be(o)),t},this.getBasicOCSPResponse=function(e){var t,n=d(e,0);t=this.getResponseData(o(e,n[0]));var r=new Ye;t.alg=r.getAlgorithmIdentifierName(o(e,n[1]));var a=i(e,n[2]);t.sighex=a.substr(2);var s=c(e,0,["[0]"]);if(null!=s){for(var u=d(s,0),l=[],h=0;h<u.length;h++){var f=o(s,u[h]);l.push(f)}t.certs=l}return t},this.getResponseData=function(e){var t=d(e,0),n=t.length,r={},a=0;"a0"==e.substr(t[0],2)&&a++,r.respid=this.getResponderID(o(e,t[a++]));var s=i(e,t[a++]);if(r.prodat=fe(s),r.array=this.getSingleResponseList(o(e,t[a++])),"a1"==e.substr(t[n-1],2)){var c=u(e,t[n-1],[0]),l=new Ye;r.ext=l.getExtParamArray(c)}return r},this.getResponderID=function(e){var t={};if("a2"==e.substr(0,2)){var n=s(e,0,[0]);t.key=n}if("a1"==e.substr(0,2)){var r=u(e,0,[0]),i=new Ye;t.name=i.getX500Name(r)}return t},this.getSingleResponseList=function(e){for(var t=d(e,0),n=[],r=0;r<t.length;r++){var i=this.getSingleResponse(o(e,t[r]));n.push(i)}return n},this.getSingleResponse=function(e){var t=d(e,0),n={},r=this.getCertID(o(e,t[0]));n.certid=r;var a=this.getCertStatus(o(e,t[1]));if(n.status=a,"18"==e.substr(t[2],2)){var c=i(e,t[2]);n.thisupdate=fe(c)}for(var l=3;l<t.length;l++){if("a0"==e.substr(t[l],2)){var h=s(e,t[l],[0],"18");n.nextupdate=fe(h)}if("a1"==e.substr(t[l],2)){var f=new Ye,p=u(e,0,[l,0]);n.ext=f.getExtParamArray(p)}}return n},this.getCertStatus=function(e){var t={};if("8000"==e)return{status:"good"};if("8200"==e)return{status:"unknown"};if("a1"==e.substr(0,2)){t.status="revoked";var n=fe(s(e,0,[0]));t.time=n}return t}},"undefined"!=typeof ee&&ee||(ee={}),"undefined"!=typeof ee.lang&&ee.lang||(ee.lang={}),ee.lang.String=function(){},"function"===typeof Buffer?(te=function(e){return ue(Buffer.from(e,"utf8").toString("base64"))},ne=function(e){return Buffer.from(ce(e),"base64").toString("utf8")}):(te=function(e){return le(Ee(Me(e)))},ne=function(e){return decodeURIComponent(Te(de(e)))}),ee.lang.String.isInteger=function(e){return!!e.match(/^[0-9]+$/)||!!e.match(/^-[0-9]+$/)},ee.lang.String.isHex=function(e){return Fe(e)},ee.lang.String.isBase64=function(e){return!(!(e=e.replace(/\s+/g,"")).match(/^[0-9A-Za-z+\/]+={0,3}$/)||e.length%4!=0)},ee.lang.String.isBase64URL=function(e){return!e.match(/[+/=]/)&&(e=ce(e),ee.lang.String.isBase64(e))},ee.lang.String.isIntegerArray=function(e){return!!(e=e.replace(/\s+/g,"")).match(/^\[[0-9,]+\]$/)},ee.lang.String.isPrintable=function(e){return null!==e.match(/^[0-9A-Za-z '()+,-./:=?]*$/)},ee.lang.String.isIA5=function(e){return null!==e.match(/^[\x20-\x21\x23-\x7f]*$/)},ee.lang.String.isMail=function(e){return null!==e.match(/^[A-Za-z0-9]{1}[A-Za-z0-9_.-]*@{1}[A-Za-z0-9_.-]{1,}\.[A-Za-z0-9]{1,}$/)};function Le(e){var t=function(e){var t=e.toString(16);return 1==t.length&&(t="0"+t),t},n=function(e){var n="",r=parseInt(e,10).toString(2),i=7-r.length%7;7==i&&(i=0);for(var o="",a=0;a<i;a++)o+="0";r=o+r;for(a=0;a<r.length-1;a+=7){var s=r.substr(a,7);a!=r.length-7&&(s="1"+s),n+=t(parseInt(s,2))}return n};try{if(!e.match(/^[0-9.]+$/))return null;var r="",i=e.split("."),o=40*parseInt(i[0],10)+parseInt(i[1],10);r+=t(o),i.splice(0,2);for(var a=0;a<i.length;a++)r+=n(i[a]);return r}catch(s){return null}}function Be(e){if(!Fe(e))return null;try{var t=[],n=e.substr(0,2),r=parseInt(n,16);t[0]=new String(Math.floor(r/40)),t[1]=new String(r%40);for(var i=e.substr(2),o=[],a=0;a<i.length/2;a++)o.push(parseInt(i.substr(2*a,2),16));var s=[],u="";for(a=0;a<o.length;a++)128&o[a]?u+=qe((127&o[a]).toString(2),7):(u+=qe((127&o[a]).toString(2),7),s.push(new String(parseInt(u,2))),u="");var c=t.join(".");return s.length>0&&(c=c+"."+s.join(".")),c}catch(l){return null}}var qe=function(e,t,n){return void 0==n&&(n="0"),e.length>=t?e:new Array(t-e.length+1).join(n)+e};function je(e){if(e.length%2!=0)return-1;if(null==(e=e.toLowerCase()).match(/^[0-9a-f]+$/))return-1;try{var t=e.substr(0,2);if("00"==t)return parseInt(e.substr(2),16);var n=parseInt(t,16);if(n>7)return-1;var r=e.substr(2),i=parseInt(r,16).toString(2);"0"==i&&(i="00000000"),i=i.slice(0,0-n);var o=parseInt(i,2);return NaN==o?-1:o}catch(a){return-1}}function Ue(e){if("number"!=typeof e)return null;if(e<0)return null;var t=Number(e).toString(2),n=8-t.length%8;8==n&&(n=0),t+=qe("",n,"0");var r=parseInt(t,2).toString(16);return r.length%2==1&&(r="0"+r),"0"+n+r}function He(e){if("string"!=typeof e)return null;if(e.length%2!=0)return null;if(!e.match(/^[0-9a-f]+$/))return null;try{var t=parseInt(e.substr(0,2),16);if(t<0||7<t)return null;for(var n=e.substr(2),r="",i=0;i<n.length;i+=2){var o=n.substr(i,2),a=parseInt(o,16).toString(2);r+=a=("0000000"+a).slice(-8)}return r.substr(0,r.length-t)}catch(s){return null}}function ze(e,t){for(var n=0,r=0;r<e.length;r++)n|=1<<t[e[r]];var i=n.toString(2),o="";for(r=i.length-1;r>=0;r--)o+=i[r];return o}function Ve(e,t,n){if("object"==typeof e){t=String(t).split(".");for(var r=0;r<t.length&&e;r++){var i=t[r];i.match(/^[0-9]+$/)&&(i=parseInt(i)),e=e[i]}return e||!1===e?e:n}}function Ge(e,t){var n=function(){};n.prototype=t.prototype,e.prototype=new n,e.prototype.constructor=e,e.superclass=t.prototype,t.prototype.constructor==Object.prototype.constructor&&(t.prototype.constructor=t)}"undefined"!=typeof ee&&ee||(ee={}),"undefined"!=typeof ee.crypto&&ee.crypto||(ee.crypto={}),ee.crypto.Util=new function(){this.DIGESTINFOHEAD={sha1:"3021300906052b0e03021a05000414",sha224:"302d300d06096086480165030402040500041c",sha256:"3031300d060960864801650304020105000420",sha384:"3041300d060960864801650304020205000430",sha512:"3051300d060960864801650304020305000440",md2:"3020300c06082a864886f70d020205000410",md5:"3020300c06082a864886f70d020505000410",ripemd160:"3021300906052b2403020105000414"},this.DEFAULTPROVIDER={md5:"cryptojs",sha1:"cryptojs",sha224:"cryptojs",sha256:"cryptojs",sha384:"cryptojs",sha512:"cryptojs",ripemd160:"cryptojs",hmacmd5:"cryptojs",hmacsha1:"cryptojs",hmacsha224:"cryptojs",hmacsha256:"cryptojs",hmacsha384:"cryptojs",hmacsha512:"cryptojs",hmacripemd160:"cryptojs",MD5withRSA:"cryptojs/jsrsa",SHA1withRSA:"cryptojs/jsrsa",SHA224withRSA:"cryptojs/jsrsa",SHA256withRSA:"cryptojs/jsrsa",SHA384withRSA:"cryptojs/jsrsa",SHA512withRSA:"cryptojs/jsrsa",RIPEMD160withRSA:"cryptojs/jsrsa",MD5withECDSA:"cryptojs/jsrsa",SHA1withECDSA:"cryptojs/jsrsa",SHA224withECDSA:"cryptojs/jsrsa",SHA256withECDSA:"cryptojs/jsrsa",SHA384withECDSA:"cryptojs/jsrsa",SHA512withECDSA:"cryptojs/jsrsa",RIPEMD160withECDSA:"cryptojs/jsrsa",SHA1withDSA:"cryptojs/jsrsa",SHA224withDSA:"cryptojs/jsrsa",SHA256withDSA:"cryptojs/jsrsa",MD5withRSAandMGF1:"cryptojs/jsrsa",SHAwithRSAandMGF1:"cryptojs/jsrsa",SHA1withRSAandMGF1:"cryptojs/jsrsa",SHA224withRSAandMGF1:"cryptojs/jsrsa",SHA256withRSAandMGF1:"cryptojs/jsrsa",SHA384withRSAandMGF1:"cryptojs/jsrsa",SHA512withRSAandMGF1:"cryptojs/jsrsa",RIPEMD160withRSAandMGF1:"cryptojs/jsrsa"},this.CRYPTOJSMESSAGEDIGESTNAME={md5:i.algo.MD5,sha1:i.algo.SHA1,sha224:i.algo.SHA224,sha256:i.algo.SHA256,sha384:i.algo.SHA384,sha512:i.algo.SHA512,ripemd160:i.algo.RIPEMD160},this.getDigestInfoHex=function(e,t){if("undefined"==typeof this.DIGESTINFOHEAD[t])throw"alg not supported in Util.DIGESTINFOHEAD: "+t;return this.DIGESTINFOHEAD[t]+e},this.getPaddedDigestInfoHex=function(e,t,n){var r=this.getDigestInfoHex(e,t),i=n/4;if(r.length+22>i)throw"key is too short for SigAlg: keylen="+n+","+t;for(var o="0001",a="00"+r,s="",u=i-4-a.length,c=0;c<u;c+=2)s+="ff";return o+s+a},this.hashString=function(e,t){return new ee.crypto.MessageDigest({alg:t}).digestString(e)},this.hashHex=function(e,t){return new ee.crypto.MessageDigest({alg:t}).digestHex(e)},this.sha1=function(e){return this.hashString(e,"sha1")},this.sha256=function(e){return this.hashString(e,"sha256")},this.sha256Hex=function(e){return this.hashHex(e,"sha256")},this.sha512=function(e){return this.hashString(e,"sha512")},this.sha512Hex=function(e){return this.hashHex(e,"sha512")},this.isKey=function(e){return e instanceof W||e instanceof ee.crypto.DSA||e instanceof ee.crypto.ECDSA}},ee.crypto.Util.md5=function(e){return new ee.crypto.MessageDigest({alg:"md5",prov:"cryptojs"}).digestString(e)},ee.crypto.Util.ripemd160=function(e){return new ee.crypto.MessageDigest({alg:"ripemd160",prov:"cryptojs"}).digestString(e)},ee.crypto.Util.SECURERANDOMGEN=new V,ee.crypto.Util.getRandomHexOfNbytes=function(e){var t=new Array(e);return ee.crypto.Util.SECURERANDOMGEN.nextBytes(t),ae(t)},ee.crypto.Util.getRandomBigIntegerOfNbytes=function(e){return new d(ee.crypto.Util.getRandomHexOfNbytes(e),16)},ee.crypto.Util.getRandomHexOfNbits=function(e){var t=e%8,n=new Array((e-t)/8+1);return ee.crypto.Util.SECURERANDOMGEN.nextBytes(n),n[0]=(255<<t&255^255)&n[0],ae(n)},ee.crypto.Util.getRandomBigIntegerOfNbits=function(e){return new d(ee.crypto.Util.getRandomHexOfNbits(e),16)},ee.crypto.Util.getRandomBigIntegerZeroToMax=function(e){for(var t=e.bitLength();;){var n=ee.crypto.Util.getRandomBigIntegerOfNbits(t);if(-1!=e.compareTo(n))return n}},ee.crypto.Util.getRandomBigIntegerMinToMax=function(e,t){var n=e.compareTo(t);if(1==n)throw"biMin is greater than biMax";if(0==n)return e;var r=t.subtract(e);return ee.crypto.Util.getRandomBigIntegerZeroToMax(r).add(e)},ee.crypto.MessageDigest=function(e){this.setAlgAndProvider=function(e,t){if(null!==(e=ee.crypto.MessageDigest.getCanonicalAlgName(e))&&void 0===t&&(t=ee.crypto.Util.DEFAULTPROVIDER[e]),-1!=":md5:sha1:sha224:sha256:sha384:sha512:ripemd160:".indexOf(e)&&"cryptojs"==t){try{this.md=ee.crypto.Util.CRYPTOJSMESSAGEDIGESTNAME[e].create()}catch(n){throw"setAlgAndProvider hash alg set fail alg="+e+"/"+n}this.updateString=function(e){this.md.update(e)},this.updateHex=function(e){var t=i.enc.Hex.parse(e);this.md.update(t)},this.digest=function(){return this.md.finalize().toString(i.enc.Hex)},this.digestString=function(e){return this.updateString(e),this.digest()},this.digestHex=function(e){return this.updateHex(e),this.digest()}}if(-1!=":sha256:".indexOf(e)&&"sjcl"==t){try{this.md=new sjcl.hash.sha256}catch(n){throw"setAlgAndProvider hash alg set fail alg="+e+"/"+n}this.updateString=function(e){this.md.update(e)},this.updateHex=function(e){var t=sjcl.codec.hex.toBits(e);this.md.update(t)},this.digest=function(){var e=this.md.finalize();return sjcl.codec.hex.fromBits(e)},this.digestString=function(e){return this.updateString(e),this.digest()},this.digestHex=function(e){return this.updateHex(e),this.digest()}}},this.updateString=function(e){throw"updateString(str) not supported for this alg/prov: "+this.algName+"/"+this.provName},this.updateHex=function(e){throw"updateHex(hex) not supported for this alg/prov: "+this.algName+"/"+this.provName},this.digest=function(){throw"digest() not supported for this alg/prov: "+this.algName+"/"+this.provName},this.digestString=function(e){throw"digestString(str) not supported for this alg/prov: "+this.algName+"/"+this.provName},this.digestHex=function(e){throw"digestHex(hex) not supported for this alg/prov: "+this.algName+"/"+this.provName},void 0!==e&&void 0!==e.alg&&(this.algName=e.alg,void 0===e.prov&&(this.provName=ee.crypto.Util.DEFAULTPROVIDER[this.algName]),this.setAlgAndProvider(this.algName,this.provName))},ee.crypto.MessageDigest.getCanonicalAlgName=function(e){return"string"===typeof e&&(e=(e=e.toLowerCase()).replace(/-/,"")),e},ee.crypto.MessageDigest.getHashLength=function(e){var t=ee.crypto.MessageDigest,n=t.getCanonicalAlgName(e);if(void 0===t.HASHLENGTH[n])throw"not supported algorithm: "+e;return t.HASHLENGTH[n]},ee.crypto.MessageDigest.HASHLENGTH={md5:16,sha1:20,sha224:28,sha256:32,sha384:48,sha512:64,ripemd160:20},ee.crypto.Mac=function(e){this.setAlgAndProvider=function(e,t){if(null==(e=e.toLowerCase())&&(e="hmacsha1"),"hmac"!=(e=e.toLowerCase()).substr(0,4))throw"setAlgAndProvider unsupported HMAC alg: "+e;void 0===t&&(t=ee.crypto.Util.DEFAULTPROVIDER[e]),this.algProv=e+"/"+t;var n=e.substr(4);if(-1!=":md5:sha1:sha224:sha256:sha384:sha512:ripemd160:".indexOf(n)&&"cryptojs"==t){try{var r=ee.crypto.Util.CRYPTOJSMESSAGEDIGESTNAME[n];this.mac=i.algo.HMAC.create(r,this.pass)}catch(o){throw"setAlgAndProvider hash alg set fail hashAlg="+n+"/"+o}this.updateString=function(e){this.mac.update(e)},this.updateHex=function(e){var t=i.enc.Hex.parse(e);this.mac.update(t)},this.doFinal=function(){return this.mac.finalize().toString(i.enc.Hex)},this.doFinalString=function(e){return this.updateString(e),this.doFinal()},this.doFinalHex=function(e){return this.updateHex(e),this.doFinal()}}},this.updateString=function(e){throw"updateString(str) not supported for this alg/prov: "+this.algProv},this.updateHex=function(e){throw"updateHex(hex) not supported for this alg/prov: "+this.algProv},this.doFinal=function(){throw"digest() not supported for this alg/prov: "+this.algProv},this.doFinalString=function(e){throw"digestString(str) not supported for this alg/prov: "+this.algProv},this.doFinalHex=function(e){throw"digestHex(hex) not supported for this alg/prov: "+this.algProv},this.setPassword=function(e){if("string"==typeof e){var t=e;return e.length%2!=1&&e.match(/^[0-9A-Fa-f]+$/)||(t=ge(e)),void(this.pass=i.enc.Hex.parse(t))}if("object"!=typeof e)throw"KJUR.crypto.Mac unsupported password type: "+e;t=null;if(void 0!==e.hex){if(e.hex.length%2!=0||!e.hex.match(/^[0-9A-Fa-f]+$/))throw"Mac: wrong hex password: "+e.hex;t=e.hex}if(void 0!==e.utf8&&(t=he(e.utf8)),void 0!==e.rstr&&(t=ge(e.rstr)),void 0!==e.b64&&(t=c(e.b64)),void 0!==e.b64u&&(t=de(e.b64u)),null==t)throw"KJUR.crypto.Mac unsupported password type: "+e;this.pass=i.enc.Hex.parse(t)},void 0!==e&&(void 0!==e.pass&&this.setPassword(e.pass),void 0!==e.alg&&(this.algName=e.alg,void 0===e.prov&&(this.provName=ee.crypto.Util.DEFAULTPROVIDER[this.algName]),this.setAlgAndProvider(this.algName,this.provName)))},ee.crypto.Signature=function(e){var t=null;if(this._setAlgNames=function(){var e=this.algName.match(/^(.+)with(.+)$/);e&&(this.mdAlgName=e[1].toLowerCase(),this.pubkeyAlgName=e[2].toLowerCase(),"rsaandmgf1"==this.pubkeyAlgName&&"sha"==this.mdAlgName&&(this.mdAlgName="sha1"))},this._zeroPaddingOfSignature=function(e,t){for(var n="",r=t/4-e.length,i=0;i<r;i++)n+="0";return n+e},this.setAlgAndProvider=function(e,t){if(this._setAlgNames(),"cryptojs/jsrsa"!=t)throw new Error("provider not supported: "+t);if(-1!=":md5:sha1:sha224:sha256:sha384:sha512:ripemd160:".indexOf(this.mdAlgName)){try{this.md=new ee.crypto.MessageDigest({alg:this.mdAlgName})}catch(n){throw new Error("setAlgAndProvider hash alg set fail alg="+this.mdAlgName+"/"+n)}this.init=function(e,t){var n=null;try{n=void 0===t?Ke.getKey(e):Ke.getKey(e,t)}catch(r){throw"init failed:"+r}if(!0===n.isPrivate)this.prvKey=n,this.state="SIGN";else{if(!0!==n.isPublic)throw"init failed.:"+n;this.pubKey=n,this.state="VERIFY"}},this.updateString=function(e){this.md.updateString(e)},this.updateHex=function(e){this.md.updateHex(e)},this.sign=function(){if(this.sHashHex=this.md.digest(),void 0===this.prvKey&&void 0!==this.ecprvhex&&void 0!==this.eccurvename&&void 0!==ee.crypto.ECDSA&&(this.prvKey=new ee.crypto.ECDSA({curve:this.eccurvename,prv:this.ecprvhex})),this.prvKey instanceof W&&"rsaandmgf1"===this.pubkeyAlgName)this.hSign=this.prvKey.signWithMessageHashPSS(this.sHashHex,this.mdAlgName,this.pssSaltLen);else if(this.prvKey instanceof W&&"rsa"===this.pubkeyAlgName)this.hSign=this.prvKey.signWithMessageHash(this.sHashHex,this.mdAlgName);else if(this.prvKey instanceof ee.crypto.ECDSA)this.hSign=this.prvKey.signWithMessageHash(this.sHashHex);else{if(!(this.prvKey instanceof ee.crypto.DSA))throw"Signature: unsupported private key alg: "+this.pubkeyAlgName;this.hSign=this.prvKey.signWithMessageHash(this.sHashHex)}return this.hSign},this.signString=function(e){return this.updateString(e),this.sign()},this.signHex=function(e){return this.updateHex(e),this.sign()},this.verify=function(e){if(this.sHashHex=this.md.digest(),void 0===this.pubKey&&void 0!==this.ecpubhex&&void 0!==this.eccurvename&&void 0!==ee.crypto.ECDSA&&(this.pubKey=new ee.crypto.ECDSA({curve:this.eccurvename,pub:this.ecpubhex})),this.pubKey instanceof W&&"rsaandmgf1"===this.pubkeyAlgName)return this.pubKey.verifyWithMessageHashPSS(this.sHashHex,e,this.mdAlgName,this.pssSaltLen);if(this.pubKey instanceof W&&"rsa"===this.pubkeyAlgName)return this.pubKey.verifyWithMessageHash(this.sHashHex,e);if(void 0!==ee.crypto.ECDSA&&this.pubKey instanceof ee.crypto.ECDSA)return this.pubKey.verifyWithMessageHash(this.sHashHex,e);if(void 0!==ee.crypto.DSA&&this.pubKey instanceof ee.crypto.DSA)return this.pubKey.verifyWithMessageHash(this.sHashHex,e);throw"Signature: unsupported public key alg: "+this.pubkeyAlgName}}},this.init=function(e,t){throw"init(key, pass) not supported for this alg:prov="+this.algProvName},this.updateString=function(e){throw"updateString(str) not supported for this alg:prov="+this.algProvName},this.updateHex=function(e){throw"updateHex(hex) not supported for this alg:prov="+this.algProvName},this.sign=function(){throw"sign() not supported for this alg:prov="+this.algProvName},this.signString=function(e){throw"digestString(str) not supported for this alg:prov="+this.algProvName},this.signHex=function(e){throw"digestHex(hex) not supported for this alg:prov="+this.algProvName},this.verify=function(e){throw"verify(hSigVal) not supported for this alg:prov="+this.algProvName},this.initParams=e,void 0!==e&&(void 0!==e.alg&&(this.algName=e.alg,void 0===e.prov?this.provName=ee.crypto.Util.DEFAULTPROVIDER[this.algName]:this.provName=e.prov,this.algProvName=this.algName+":"+this.provName,this.setAlgAndProvider(this.algName,this.provName),this._setAlgNames()),void 0!==e.psssaltlen&&(this.pssSaltLen=e.psssaltlen),void 0!==e.prvkeypem)){if(void 0!==e.prvkeypas)throw"both prvkeypem and prvkeypas parameters not supported";try{t=Ke.getKey(e.prvkeypem);this.init(t)}catch(n){throw"fatal error to load pem private key: "+n}}},ee.crypto.Cipher=function(e){},ee.crypto.Cipher.encrypt=function(e,t,n){if(t instanceof W&&t.isPublic){var r=ee.crypto.Cipher.getAlgByKeyAndName(t,n);if("RSA"===r)return t.encrypt(e);if("RSAOAEP"===r)return t.encryptOAEP(e,"sha1");var i=r.match(/^RSAOAEP(\d+)$/);if(null!==i)return t.encryptOAEP(e,"sha"+i[1]);throw"Cipher.encrypt: unsupported algorithm for RSAKey: "+n}throw"Cipher.encrypt: unsupported key or algorithm"},ee.crypto.Cipher.decrypt=function(e,t,n){if(t instanceof W&&t.isPrivate){var r=ee.crypto.Cipher.getAlgByKeyAndName(t,n);if("RSA"===r)return t.decrypt(e);if("RSAOAEP"===r)return t.decryptOAEP(e,"sha1");var i=r.match(/^RSAOAEP(\d+)$/);if(null!==i)return t.decryptOAEP(e,"sha"+i[1]);throw"Cipher.decrypt: unsupported algorithm for RSAKey: "+n}throw"Cipher.decrypt: unsupported key or algorithm"},ee.crypto.Cipher.getAlgByKeyAndName=function(e,t){if(e instanceof W){if(-1!=":RSA:RSAOAEP:RSAOAEP224:RSAOAEP256:RSAOAEP384:RSAOAEP512:".indexOf(t))return t;if(null===t||void 0===t)return"RSA";throw"getAlgByKeyAndName: not supported algorithm name for RSAKey: "+t}throw"getAlgByKeyAndName: not supported algorithm name: "+t},ee.crypto.OID=new function(){this.oidhex2name={"2a864886f70d010101":"rsaEncryption","2a8648ce3d0201":"ecPublicKey","2a8648ce380401":"dsa","2a8648ce3d030107":"secp256r1","2b8104001f":"secp192k1","2b81040021":"secp224r1","2b8104000a":"secp256k1","2b81040022":"secp384r1","2b81040023":"secp521r1","2a8648ce380403":"SHA1withDSA","608648016503040301":"SHA224withDSA","608648016503040302":"SHA256withDSA"}},"undefined"!=typeof ee&&ee||(ee={}),"undefined"!=typeof ee.crypto&&ee.crypto||(ee.crypto={}),ee.crypto.ECDSA=function(e){var t=Error,n=d,r=Y,i=ee.crypto.ECDSA,o=ee.crypto.ECParameterDB,a=i.getName,s=re,u=s.getVbyListEx,c=s.isASN1HEX,l=new V;this.type="EC",this.isPrivate=!1,this.isPublic=!1,this.getBigRandom=function(e){return new n(e.bitLength(),l).mod(e.subtract(n.ONE)).add(n.ONE)},this.setNamedCurve=function(e){this.ecparams=o.getByName(e),this.prvKeyHex=null,this.pubKeyHex=null,this.curveName=e},this.setPrivateKeyHex=function(e){this.isPrivate=!0,this.prvKeyHex=e},this.setPublicKeyHex=function(e){this.isPublic=!0,this.pubKeyHex=e},this.getPublicKeyXYHex=function(){var e=this.pubKeyHex;if("04"!==e.substr(0,2))throw"this method supports uncompressed format(04) only";var t=this.ecparams.keycharlen;if(e.length!==2+2*t)throw"malformed public key hex length";var n={};return n.x=e.substr(2,t),n.y=e.substr(2+t),n},this.getShortNISTPCurveName=function(){var e=this.curveName;return"secp256r1"===e||"NIST P-256"===e||"P-256"===e||"prime256v1"===e?"P-256":"secp384r1"===e||"NIST P-384"===e||"P-384"===e?"P-384":"secp521r1"===e||"NIST P-521"===e||"P-521"===e?"P-521":null},this.generateKeyPairHex=function(){var e=this.ecparams.n,t=this.getBigRandom(e),n=this.ecparams.keycharlen,r=("0000000000"+t.toString(16)).slice(-n);return this.setPrivateKeyHex(r),{ecprvhex:r,ecpubhex:this.generatePublicKeyHex()}},this.generatePublicKeyHex=function(){var e=new n(this.prvKeyHex,16),t=this.ecparams.G.multiply(e),r=t.getX().toBigInteger(),i=t.getY().toBigInteger(),o=this.ecparams.keycharlen,a="04"+("0000000000"+r.toString(16)).slice(-o)+("0000000000"+i.toString(16)).slice(-o);return this.setPublicKeyHex(a),a},this.signWithMessageHash=function(e){return this.signHex(e,this.prvKeyHex)},this.signHex=function(e,t){var r=new n(t,16),o=this.ecparams.n,a=new n(e.substring(0,this.ecparams.keycharlen),16);do{var s=this.getBigRandom(o),u=this.ecparams.G.multiply(s).getX().toBigInteger().mod(o)}while(u.compareTo(n.ZERO)<=0);var c=s.modInverse(o).multiply(a.add(r.multiply(u))).mod(o);return i.biRSSigToASN1Sig(u,c)},this.sign=function(e,t){var r=t,i=this.ecparams.n,o=n.fromByteArrayUnsigned(e);do{var a=this.getBigRandom(i),s=this.ecparams.G.multiply(a).getX().toBigInteger().mod(i)}while(s.compareTo(d.ZERO)<=0);var u=a.modInverse(i).multiply(o.add(r.multiply(s))).mod(i);return this.serializeSig(s,u)},this.verifyWithMessageHash=function(e,t){return this.verifyHex(e,t,this.pubKeyHex)},this.verifyHex=function(e,t,o){try{var a,s,u=i.parseSigHex(t);a=u.r,s=u.s;var c=r.decodeFromHex(this.ecparams.curve,o),l=new n(e.substring(0,this.ecparams.keycharlen),16);return this.verifyRaw(l,a,s,c)}catch(d){return!1}},this.verify=function(e,t,i){var o,a,s;if(Bitcoin.Util.isArray(t)){var u=this.parseSig(t);o=u.r,a=u.s}else{if("object"!==typeof t||!t.r||!t.s)throw"Invalid value for signature";o=t.r,a=t.s}if(i instanceof Y)s=i;else{if(!Bitcoin.Util.isArray(i))throw"Invalid format for pubkey value, must be byte array or ECPointFp";s=r.decodeFrom(this.ecparams.curve,i)}var c=n.fromByteArrayUnsigned(e);return this.verifyRaw(c,o,a,s)},this.verifyRaw=function(e,t,r,i){var o=this.ecparams.n,a=this.ecparams.G;if(t.compareTo(n.ONE)<0||t.compareTo(o)>=0)return!1;if(r.compareTo(n.ONE)<0||r.compareTo(o)>=0)return!1;var s=r.modInverse(o),u=e.multiply(s).mod(o),c=t.multiply(s).mod(o);return a.multiply(u).add(i.multiply(c)).getX().toBigInteger().mod(o).equals(t)},this.serializeSig=function(e,t){var n=e.toByteArraySigned(),r=t.toByteArraySigned(),i=[];return i.push(2),i.push(n.length),(i=i.concat(n)).push(2),i.push(r.length),(i=i.concat(r)).unshift(i.length),i.unshift(48),i},this.parseSig=function(e){var t;if(48!=e[0])throw new Error("Signature not a valid DERSequence");if(2!=e[t=2])throw new Error("First element in signature must be a DERInteger");var r=e.slice(t+2,t+2+e[t+1]);if(2!=e[t+=2+e[t+1]])throw new Error("Second element in signature must be a DERInteger");var i=e.slice(t+2,t+2+e[t+1]);return t+=2+e[t+1],{r:n.fromByteArrayUnsigned(r),s:n.fromByteArrayUnsigned(i)}},this.parseSigCompact=function(e){if(65!==e.length)throw"Signature has the wrong length";var t=e[0]-27;if(t<0||t>7)throw"Invalid signature type";var r=this.ecparams.n;return{r:n.fromByteArrayUnsigned(e.slice(1,33)).mod(r),s:n.fromByteArrayUnsigned(e.slice(33,65)).mod(r),i:t}},this.readPKCS5PrvKeyHex=function(e){if(!1===c(e))throw new Error("not ASN.1 hex string");var t,n,r;try{t=u(e,0,["[0]",0],"06"),n=u(e,0,[1],"04");try{r=u(e,0,["[1]",0],"03")}catch(i){}}catch(i){throw new Error("malformed PKCS#1/5 plain ECC private key")}if(this.curveName=a(t),void 0===this.curveName)throw"unsupported curve name";this.setNamedCurve(this.curveName),this.setPublicKeyHex(r),this.setPrivateKeyHex(n),this.isPublic=!1},this.readPKCS8PrvKeyHex=function(e){if(!1===c(e))throw new t("not ASN.1 hex string");var n,r,i;try{u(e,0,[1,0],"06"),n=u(e,0,[1,1],"06"),r=u(e,0,[2,0,1],"04");try{i=u(e,0,[2,0,"[1]",0],"03")}catch(o){}}catch(o){throw new t("malformed PKCS#8 plain ECC private key")}if(this.curveName=a(n),void 0===this.curveName)throw new t("unsupported curve name");this.setNamedCurve(this.curveName),this.setPublicKeyHex(i),this.setPrivateKeyHex(r),this.isPublic=!1},this.readPKCS8PubKeyHex=function(e){if(!1===c(e))throw new t("not ASN.1 hex string");var n,r;try{u(e,0,[0,0],"06"),n=u(e,0,[0,1],"06"),r=u(e,0,[1],"03")}catch(i){throw new t("malformed PKCS#8 ECC public key")}if(this.curveName=a(n),null===this.curveName)throw new t("unsupported curve name");this.setNamedCurve(this.curveName),this.setPublicKeyHex(r)},this.readCertPubKeyHex=function(e,n){if(!1===c(e))throw new t("not ASN.1 hex string");var r,i;try{r=u(e,0,[0,5,0,1],"06"),i=u(e,0,[0,5,1],"03")}catch(o){throw new t("malformed X.509 certificate ECC public key")}if(this.curveName=a(r),null===this.curveName)throw new t("unsupported curve name");this.setNamedCurve(this.curveName),this.setPublicKeyHex(i)},void 0!==e&&void 0!==e.curve&&(this.curveName=e.curve),void 0===this.curveName&&(this.curveName="secp256r1"),this.setNamedCurve(this.curveName),void 0!==e&&(void 0!==e.prv&&this.setPrivateKeyHex(e.prv),void 0!==e.pub&&this.setPublicKeyHex(e.pub))},ee.crypto.ECDSA.parseSigHex=function(e){var t=ee.crypto.ECDSA.parseSigHexInHexRS(e);return{r:new d(t.r,16),s:new d(t.s,16)}},ee.crypto.ECDSA.parseSigHexInHexRS=function(e){var t=re,n=t.getChildIdx,r=t.getV;if(t.checkStrictDER(e,0),"30"!=e.substr(0,2))throw new Error("signature is not a ASN.1 sequence");var i=n(e,0);if(2!=i.length)throw new Error("signature shall have two elements");var o=i[0],a=i[1];if("02"!=e.substr(o,2))throw new Error("1st item not ASN.1 integer");if("02"!=e.substr(a,2))throw new Error("2nd item not ASN.1 integer");return{r:r(e,o),s:r(e,a)}},ee.crypto.ECDSA.asn1SigToConcatSig=function(e){var t=ee.crypto.ECDSA.parseSigHexInHexRS(e),n=t.r,r=t.s;if(n.length>=130&&n.length<=134){if(n.length%2!=0)throw Error("unknown ECDSA sig r length error");if(r.length%2!=0)throw Error("unknown ECDSA sig s length error");"00"==n.substr(0,2)&&(n=n.substr(2)),"00"==r.substr(0,2)&&(r=r.substr(2));var i=Math.max(n.length,r.length);return(n=("000000"+n).slice(-i))+(r=("000000"+r).slice(-i))}if("00"==n.substr(0,2)&&n.length%32==2&&(n=n.substr(2)),"00"==r.substr(0,2)&&r.length%32==2&&(r=r.substr(2)),n.length%32==30&&(n="00"+n),r.length%32==30&&(r="00"+r),n.length%32!=0)throw Error("unknown ECDSA sig r length error");if(r.length%32!=0)throw Error("unknown ECDSA sig s length error");return n+r},ee.crypto.ECDSA.concatSigToASN1Sig=function(e){if(e.length%4!=0)throw Error("unknown ECDSA concatinated r-s sig length error");var t=e.substr(0,e.length/2),n=e.substr(e.length/2);return ee.crypto.ECDSA.hexRSSigToASN1Sig(t,n)},ee.crypto.ECDSA.hexRSSigToASN1Sig=function(e,t){var n=new d(e,16),r=new d(t,16);return ee.crypto.ECDSA.biRSSigToASN1Sig(n,r)},ee.crypto.ECDSA.biRSSigToASN1Sig=function(e,t){var n=ee.asn1,r=new n.DERInteger({bigint:e}),i=new n.DERInteger({bigint:t});return new n.DERSequence({array:[r,i]}).tohex()},ee.crypto.ECDSA.getName=function(e){return"2b8104001f"===e?"secp192k1":"2a8648ce3d030107"===e?"secp256r1":"2b8104000a"===e?"secp256k1":"2b81040021"===e?"secp224r1":"2b81040022"===e?"secp384r1":"2b81040023"===e?"secp521r1":-1!=="|secp256r1|NIST P-256|P-256|prime256v1|".indexOf(e)?"secp256r1":-1!=="|secp256k1|".indexOf(e)?"secp256k1":-1!=="|secp224r1|NIST P-224|P-224|".indexOf(e)?"secp224r1":-1!=="|secp384r1|NIST P-384|P-384|".indexOf(e)?"secp384r1":-1!=="|secp521r1|NIST P-521|P-521|".indexOf(e)?"secp521r1":null},"undefined"!=typeof ee&&ee||(ee={}),"undefined"!=typeof ee.crypto&&ee.crypto||(ee.crypto={}),ee.crypto.ECParameterDB=new function(){var e={},t={};function n(e){return new d(e,16)}this.getByName=function(n){var r=n;if("undefined"!=typeof t[r]&&(r=t[n]),"undefined"!=typeof e[r])return e[r];throw"unregistered EC curve name: "+r},this.regist=function(r,i,o,a,s,u,c,l,d,h,f,p){e[r]={};var v=n(o),g=n(a),m=n(s),y=n(u),b=n(c),w=new X(v,g,m),S=w.decodePointHex("04"+l+d);e[r].name=r,e[r].keylen=i,e[r].keycharlen=2*Math.ceil(i/8),e[r].curve=w,e[r].G=S,e[r].n=y,e[r].h=b,e[r].oid=f,e[r].info=p;for(var k=0;k<h.length;k++)t[h[k]]=r}},ee.crypto.ECParameterDB.regist("secp128r1",128,"FFFFFFFDFFFFFFFFFFFFFFFFFFFFFFFF","FFFFFFFDFFFFFFFFFFFFFFFFFFFFFFFC","E87579C11079F43DD824993C2CEE5ED3","FFFFFFFE0000000075A30D1B9038A115","1","161FF7528B899B2D0C28607CA52C5B86","CF5AC8395BAFEB13C02DA292DDED7A83",[],"","secp128r1 : SECG curve over a 128 bit prime field"),ee.crypto.ECParameterDB.regist("secp160k1",160,"FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEFFFFAC73","0","7","0100000000000000000001B8FA16DFAB9ACA16B6B3","1","3B4C382CE37AA192A4019E763036F4F5DD4D7EBB","938CF935318FDCED6BC28286531733C3F03C4FEE",[],"","secp160k1 : SECG curve over a 160 bit prime field"),ee.crypto.ECParameterDB.regist("secp160r1",160,"FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF7FFFFFFF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF7FFFFFFC","1C97BEFC54BD7A8B65ACF89F81D4D4ADC565FA45","0100000000000000000001F4C8F927AED3CA752257","1","4A96B5688EF573284664698968C38BB913CBFC82","23A628553168947D59DCC912042351377AC5FB32",[],"","secp160r1 : SECG curve over a 160 bit prime field"),ee.crypto.ECParameterDB.regist("secp192k1",192,"FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEFFFFEE37","0","3","FFFFFFFFFFFFFFFFFFFFFFFE26F2FC170F69466A74DEFD8D","1","DB4FF10EC057E9AE26B07D0280B7F4341DA5D1B1EAE06C7D","9B2F2F6D9C5628A7844163D015BE86344082AA88D95E2F9D",[]),ee.crypto.ECParameterDB.regist("secp192r1",192,"FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEFFFFFFFFFFFFFFFF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEFFFFFFFFFFFFFFFC","64210519E59C80E70FA7E9AB72243049FEB8DEECC146B9B1","FFFFFFFFFFFFFFFFFFFFFFFF99DEF836146BC9B1B4D22831","1","188DA80EB03090F67CBF20EB43A18800F4FF0AFD82FF1012","07192B95FFC8DA78631011ED6B24CDD573F977A11E794811",[]),ee.crypto.ECParameterDB.regist("secp224r1",224,"FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF000000000000000000000001","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEFFFFFFFFFFFFFFFFFFFFFFFE","B4050A850C04B3ABF54132565044B0B7D7BFD8BA270B39432355FFB4","FFFFFFFFFFFFFFFFFFFFFFFFFFFF16A2E0B8F03E13DD29455C5C2A3D","1","B70E0CBD6BB4BF7F321390B94A03C1D356C21122343280D6115C1D21","BD376388B5F723FB4C22DFE6CD4375A05A07476444D5819985007E34",[]),ee.crypto.ECParameterDB.regist("secp256k1",256,"FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEFFFFFC2F","0","7","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEBAAEDCE6AF48A03BBFD25E8CD0364141","1","79BE667EF9DCBBAC55A06295CE870B07029BFCDB2DCE28D959F2815B16F81798","483ADA7726A3C4655DA4FBFC0E1108A8FD17B448A68554199C47D08FFB10D4B8",[]),ee.crypto.ECParameterDB.regist("secp256r1",256,"FFFFFFFF00000001000000000000000000000000FFFFFFFFFFFFFFFFFFFFFFFF","FFFFFFFF00000001000000000000000000000000FFFFFFFFFFFFFFFFFFFFFFFC","5AC635D8AA3A93E7B3EBBD55769886BC651D06B0CC53B0F63BCE3C3E27D2604B","FFFFFFFF00000000FFFFFFFFFFFFFFFFBCE6FAADA7179E84F3B9CAC2FC632551","1","6B17D1F2E12C4247F8BCE6E563A440F277037D812DEB33A0F4A13945D898C296","4FE342E2FE1A7F9B8EE7EB4A7C0F9E162BCE33576B315ECECBB6406837BF51F5",["NIST P-256","P-256","prime256v1"]),ee.crypto.ECParameterDB.regist("secp384r1",384,"FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEFFFFFFFF0000000000000000FFFFFFFF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEFFFFFFFF0000000000000000FFFFFFFC","B3312FA7E23EE7E4988E056BE3F82D19181D9C6EFE8141120314088F5013875AC656398D8A2ED19D2A85C8EDD3EC2AEF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFC7634D81F4372DDF581A0DB248B0A77AECEC196ACCC52973","1","AA87CA22BE8B05378EB1C71EF320AD746E1D3B628BA79B9859F741E082542A385502F25DBF55296C3A545E3872760AB7","3617de4a96262c6f5d9e98bf9292dc29f8f41dbd289a147ce9da3113b5f0b8c00a60b1ce1d7e819d7a431d7c90ea0e5f",["NIST P-384","P-384"]),ee.crypto.ECParameterDB.regist("secp521r1",521,"1FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF","1FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFC","051953EB9618E1C9A1F929A21A0B68540EEA2DA725B99B315F3B8B489918EF109E156193951EC7E937B1652C0BD3BB1BF073573DF883D2C34F1EF451FD46B503F00","1FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFA51868783BF2F966B7FCC0148F709A5D03BB5C9B8899C47AEBB6FB71E91386409","1","00C6858E06B70404E9CD9E3ECB662395B4429C648139053FB521F828AF606B4D3DBAA14B5E77EFE75928FE1DC127A2FFA8DE3348B3C1856A429BF97E7E31C2E5BD66","011839296a789a3bc0045c8a5fb42c7d1bd998f54449579b446817afbd17273e662c97ee72995ef42640c550b9013fad0761353c7086a272c24088be94769fd16650",["NIST P-521","P-521"]),"undefined"!=typeof ee&&ee||(ee={}),"undefined"!=typeof ee.crypto&&ee.crypto||(ee.crypto={}),ee.crypto.DSA=function(){var e=re,t=(e.getVbyList,e.getVbyListEx),n=e.isASN1HEX,r=d;this.p=null,this.q=null,this.g=null,this.y=null,this.x=null,this.type="DSA",this.isPrivate=!1,this.isPublic=!1,this.setPrivate=function(e,t,n,r,i){this.isPrivate=!0,this.p=e,this.q=t,this.g=n,this.y=r,this.x=i},this.setPrivateHex=function(e,t,n,r,i){var o,a,s,u,c;o=new d(e,16),a=new d(t,16),s=new d(n,16),u="string"===typeof r&&r.length>1?new d(r,16):null,c=new d(i,16),this.setPrivate(o,a,s,u,c)},this.setPublic=function(e,t,n,r){this.isPublic=!0,this.p=e,this.q=t,this.g=n,this.y=r,this.x=null},this.setPublicHex=function(e,t,n,r){var i,o,a,s;i=new d(e,16),o=new d(t,16),a=new d(n,16),s=new d(r,16),this.setPublic(i,o,a,s)},this.signWithMessageHash=function(e){var t=this.p,n=this.q,r=this.g,i=(this.y,this.x),o=ee.crypto.Util.getRandomBigIntegerMinToMax(d.ONE.add(d.ONE),n.subtract(d.ONE)),a=new d(e.substr(0,n.bitLength()/4),16),s=r.modPow(o,t).mod(n),u=o.modInverse(n).multiply(a.add(i.multiply(s))).mod(n);return ee.asn1.ASN1Util.jsonToASN1HEX({seq:[{int:{bigint:s}},{int:{bigint:u}}]})},this.verifyWithMessageHash=function(e,t){var n=this.p,r=this.q,i=this.g,o=this.y,a=this.parseASN1Signature(t),s=a[0],u=a[1],c=new d(e.substr(0,r.bitLength()/4),16);if(d.ZERO.compareTo(s)>0||s.compareTo(r)>0)throw"invalid DSA signature";if(d.ZERO.compareTo(u)>=0||u.compareTo(r)>0)throw"invalid DSA signature";var l=u.modInverse(r),h=c.multiply(l).mod(r),f=s.multiply(l).mod(r);return 0==i.modPow(h,n).multiply(o.modPow(f,n)).mod(n).mod(r).compareTo(s)},this.parseASN1Signature=function(e){try{return[new r(t(e,0,[0],"02"),16),new r(t(e,0,[1],"02"),16)]}catch(n){throw new Error("malformed ASN.1 DSA signature")}},this.readPKCS5PrvKeyHex=function(e){var r,i,o,a,s;if(!1===n(e))throw new Error("not ASN.1 hex string");try{r=t(e,0,[1],"02"),i=t(e,0,[2],"02"),o=t(e,0,[3],"02"),a=t(e,0,[4],"02"),s=t(e,0,[5],"02")}catch(u){throw new Error("malformed PKCS#1/5 plain DSA private key")}this.setPrivateHex(r,i,o,a,s)},this.readPKCS8PrvKeyHex=function(e){var r,i,o,a;if(!1===n(e))throw new Error("not ASN.1 hex string");try{r=t(e,0,[1,1,0],"02"),i=t(e,0,[1,1,1],"02"),o=t(e,0,[1,1,2],"02"),a=t(e,0,[2,0],"02")}catch(s){throw new Error("malformed PKCS#8 plain DSA private key")}this.setPrivateHex(r,i,o,null,a)},this.readPKCS8PubKeyHex=function(e){var r,i,o,a;if(!1===n(e))throw new Error("not ASN.1 hex string");try{r=t(e,0,[0,1,0],"02"),i=t(e,0,[0,1,1],"02"),o=t(e,0,[0,1,2],"02"),a=t(e,0,[1,0],"02")}catch(s){throw new Error("malformed PKCS#8 DSA public key")}this.setPublicHex(r,i,o,a)},this.readCertPubKeyHex=function(e,r){var i,o,a,s;if(!1===n(e))throw new Error("not ASN.1 hex string");try{i=t(e,0,[0,5,0,1,0],"02"),o=t(e,0,[0,5,0,1,1],"02"),a=t(e,0,[0,5,0,1,2],"02"),s=t(e,0,[0,5,1,0],"02")}catch(u){throw new Error("malformed X.509 certificate DSA public key")}this.setPublicHex(i,o,a,s)}};var Ke=function(){var e=function(e,n,r){return t(i.AES,e,n,r)},t=function(e,t,n,r){var o=i.enc.Hex.parse(t),a=i.enc.Hex.parse(n),s=i.enc.Hex.parse(r),u={};u.key=a,u.iv=s,u.ciphertext=o;var c=e.decrypt(u,a,{iv:s});return i.enc.Hex.stringify(c)},n=function(e,t,n){return r(i.AES,e,t,n)},r=function(e,t,n,r){var o=i.enc.Hex.parse(t),a=i.enc.Hex.parse(n),s=i.enc.Hex.parse(r),u=e.encrypt(o,a,{iv:s}),c=i.enc.Hex.parse(u.toString());return i.enc.Base64.stringify(c)},o={"AES-256-CBC":{proc:e,eproc:n,keylen:32,ivlen:16},"AES-192-CBC":{proc:e,eproc:n,keylen:24,ivlen:16},"AES-128-CBC":{proc:e,eproc:n,keylen:16,ivlen:16},"DES-EDE3-CBC":{proc:function(e,n,r){return t(i.TripleDES,e,n,r)},eproc:function(e,t,n){return r(i.TripleDES,e,t,n)},keylen:24,ivlen:8},"DES-CBC":{proc:function(e,n,r){return t(i.DES,e,n,r)},eproc:function(e,t,n){return r(i.DES,e,t,n)},keylen:8,ivlen:8}},a=function(e){var t={},n=e.match(new RegExp("DEK-Info: ([^,]+),([0-9A-Fa-f]+)","m"));n&&(t.cipher=n[1],t.ivsalt=n[2]);var r=e.match(new RegExp("-----BEGIN ([A-Z]+) PRIVATE KEY-----"));r&&(t.type=r[1]);var i=-1,o=0;-1!=e.indexOf("\r\n\r\n")&&(i=e.indexOf("\r\n\r\n"),o=2),-1!=e.indexOf("\n\n")&&(i=e.indexOf("\n\n"),o=1);var a=e.indexOf("-----END");if(-1!=i&&-1!=a){var s=e.substring(i+2*o,a-o);s=s.replace(/\s+/g,""),t.data=s}return t},s=function(e,t,n){for(var r=n.substring(0,16),a=i.enc.Hex.parse(r),s=i.enc.Utf8.parse(t),u=o[e].keylen+o[e].ivlen,c="",l=null;;){var d=i.algo.MD5.create();if(null!=l&&d.update(l),d.update(s),d.update(a),l=d.finalize(),(c+=i.enc.Hex.stringify(l)).length>=2*u)break}var h={};return h.keyhex=c.substr(0,2*o[e].keylen),h.ivhex=c.substr(2*o[e].keylen,2*o[e].ivlen),h},u=function(e,t,n,r){var a=i.enc.Base64.parse(e),s=i.enc.Hex.stringify(a);return(0,o[t].proc)(s,n,r)};return{version:"1.0.0",parsePKCS5PEM:function(e){return a(e)},getKeyAndUnusedIvByPasscodeAndIvsalt:function(e,t,n){return s(e,t,n)},decryptKeyB64:function(e,t,n,r){return u(e,t,n,r)},getDecryptedKeyHex:function(e,t){var n=a(e),r=(n.type,n.cipher),i=n.ivsalt,o=n.data,c=s(r,t,i).keyhex;return u(o,r,c,i)},getEncryptedPKCS5PEMFromPrvKeyHex:function(e,t,n,r,a){var u="";if("undefined"!=typeof r&&null!=r||(r="AES-256-CBC"),"undefined"==typeof o[r])throw new Error("KEYUTIL unsupported algorithm: "+r);if("undefined"==typeof a||null==a){var c=function(e){var t=i.lib.WordArray.random(e);return i.enc.Hex.stringify(t)}(o[r].ivlen);a=c.toUpperCase()}var l=function(e,t,n,r){return(0,o[t].eproc)(e,n,r)}(t,r,s(r,n,a).keyhex,a);u="-----BEGIN "+e+" PRIVATE KEY-----\r\n";return u+="Proc-Type: 4,ENCRYPTED\r\n",u+="DEK-Info: "+r+","+a+"\r\n",u+="\r\n",u+=l.replace(/(.{64})/g,"$1\r\n"),u+="\r\n-----END "+e+" PRIVATE KEY-----\r\n"},parseHexOfEncryptedPKCS8:function(e){var t=re,n=t.getChildIdx,r=t.getV,i={},o=n(e,0);if(2!=o.length)throw new Error("malformed format: SEQUENCE(0).items != 2: "+o.length);i.ciphertext=r(e,o[1]);var a=n(e,o[0]);if(2!=a.length)throw new Error("malformed format: SEQUENCE(0.0).items != 2: "+a.length);if("2a864886f70d01050d"!=r(e,a[0]))throw new Error("this only supports pkcs5PBES2");var s=n(e,a[1]);if(2!=a.length)throw new Error("malformed format: SEQUENCE(0.0.1).items != 2: "+s.length);var u=n(e,s[1]);if(2!=u.length)throw new Error("malformed format: SEQUENCE(0.0.1.1).items != 2: "+u.length);if("2a864886f70d0307"!=r(e,u[0]))throw"this only supports TripleDES";i.encryptionSchemeAlg="TripleDES",i.encryptionSchemeIV=r(e,u[1]);var c=n(e,s[0]);if(2!=c.length)throw new Error("malformed format: SEQUENCE(0.0.1.0).items != 2: "+c.length);if("2a864886f70d01050c"!=r(e,c[0]))throw new Error("this only supports pkcs5PBKDF2");var l=n(e,c[1]);if(l.length<2)throw new Error("malformed format: SEQUENCE(0.0.1.0.1).items < 2: "+l.length);i.pbkdf2Salt=r(e,l[0]);var d=r(e,l[1]);try{i.pbkdf2Iter=parseInt(d,16)}catch(h){throw new Error("malformed format pbkdf2Iter: "+d)}return i},getPBKDF2KeyHexFromParam:function(e,t){var n=i.enc.Hex.parse(e.pbkdf2Salt),r=e.pbkdf2Iter,o=i.PBKDF2(t,n,{keySize:6,iterations:r});return i.enc.Hex.stringify(o)},_getPlainPKCS8HexFromEncryptedPKCS8PEM:function(e,t){var n=Se(e,"ENCRYPTED PRIVATE KEY"),r=this.parseHexOfEncryptedPKCS8(n),o=Ke.getPBKDF2KeyHexFromParam(r,t),a={};a.ciphertext=i.enc.Hex.parse(r.ciphertext);var s=i.enc.Hex.parse(o),u=i.enc.Hex.parse(r.encryptionSchemeIV),c=i.TripleDES.decrypt(a,s,{iv:u});return i.enc.Hex.stringify(c)},getKeyFromEncryptedPKCS8PEM:function(e,t){var n=this._getPlainPKCS8HexFromEncryptedPKCS8PEM(e,t);return this.getKeyFromPlainPrivatePKCS8Hex(n)},parsePlainPrivatePKCS8Hex:function(e){var t=re,n=t.getChildIdx,r=t.getV,i={algparam:null};if("30"!=e.substr(0,2))throw new Error("malformed plain PKCS8 private key(code:001)");var o=n(e,0);if(o.length<3)throw new Error("malformed plain PKCS8 private key(code:002)");if("30"!=e.substr(o[1],2))throw new Error("malformed PKCS8 private key(code:003)");var a=n(e,o[1]);if(2!=a.length)throw new Error("malformed PKCS8 private key(code:004)");if("06"!=e.substr(a[0],2))throw new Error("malformed PKCS8 private key(code:005)");if(i.algoid=r(e,a[0]),"06"==e.substr(a[1],2)&&(i.algparam=r(e,a[1])),"04"!=e.substr(o[2],2))throw new Error("malformed PKCS8 private key(code:006)");return i.keyidx=t.getVidx(e,o[2]),i},getKeyFromPlainPrivatePKCS8PEM:function(e){var t=Se(e,"PRIVATE KEY");return this.getKeyFromPlainPrivatePKCS8Hex(t)},getKeyFromPlainPrivatePKCS8Hex:function(e){var t,n=this.parsePlainPrivatePKCS8Hex(e);if("2a864886f70d010101"==n.algoid)t=new W;else if("2a8648ce380401"==n.algoid)t=new ee.crypto.DSA;else{if("2a8648ce3d0201"!=n.algoid)throw new Error("unsupported private key algorithm");t=new ee.crypto.ECDSA}return t.readPKCS8PrvKeyHex(e),t},_getKeyFromPublicPKCS8Hex:function(e){var t,n=re.getVbyList(e,0,[0,0],"06");if("2a864886f70d010101"===n)t=new W;else if("2a8648ce380401"===n)t=new ee.crypto.DSA;else{if("2a8648ce3d0201"!==n)throw new Error("unsupported PKCS#8 public key hex");t=new ee.crypto.ECDSA}return t.readPKCS8PubKeyHex(e),t},parsePublicRawRSAKeyHex:function(e){var t=re,n=t.getChildIdx,r=t.getV,i={};if("30"!=e.substr(0,2))throw new Error("malformed RSA key(code:001)");var o=n(e,0);if(2!=o.length)throw new Error("malformed RSA key(code:002)");if("02"!=e.substr(o[0],2))throw new Error("malformed RSA key(code:003)");if(i.n=r(e,o[0]),"02"!=e.substr(o[1],2))throw new Error("malformed RSA key(code:004)");return i.e=r(e,o[1]),i},parsePublicPKCS8Hex:function(e){var t=re,n=t.getChildIdx,r=t.getV,i={algparam:null},o=n(e,0);if(2!=o.length)throw new Error("outer DERSequence shall have 2 elements: "+o.length);var a=o[0];if("30"!=e.substr(a,2))throw new Error("malformed PKCS8 public key(code:001)");var s=n(e,a);if(2!=s.length)throw new Error("malformed PKCS8 public key(code:002)");if("06"!=e.substr(s[0],2))throw new Error("malformed PKCS8 public key(code:003)");if(i.algoid=r(e,s[0]),"06"==e.substr(s[1],2)?i.algparam=r(e,s[1]):"30"==e.substr(s[1],2)&&(i.algparam={},i.algparam.p=t.getVbyList(e,s[1],[0],"02"),i.algparam.q=t.getVbyList(e,s[1],[1],"02"),i.algparam.g=t.getVbyList(e,s[1],[2],"02")),"03"!=e.substr(o[1],2))throw new Error("malformed PKCS8 public key(code:004)");return i.key=r(e,o[1]).substr(2),i}}}();Ke.getKey=function(e,t,n){var r=(m=re).getChildIdx,i=(m.getV,m.getVbyList),o=ee.crypto,a=o.ECDSA,s=o.DSA,u=W,c=Se,l=Ke;if("undefined"!=typeof u&&e instanceof u)return e;if("undefined"!=typeof a&&e instanceof a)return e;if("undefined"!=typeof s&&e instanceof s)return e;if(void 0!==e.curve&&void 0!==e.xy&&void 0===e.d)return new a({pub:e.xy,curve:e.curve});if(void 0!==e.curve&&void 0!==e.d)return new a({prv:e.d,curve:e.curve});if(void 0===e.kty&&void 0!==e.n&&void 0!==e.e&&void 0===e.d)return(A=new u).setPublic(e.n,e.e),A;if(void 0===e.kty&&void 0!==e.n&&void 0!==e.e&&void 0!==e.d&&void 0!==e.p&&void 0!==e.q&&void 0!==e.dp&&void 0!==e.dq&&void 0!==e.co&&void 0===e.qi)return(A=new u).setPrivateEx(e.n,e.e,e.d,e.p,e.q,e.dp,e.dq,e.co),A;if(void 0===e.kty&&void 0!==e.n&&void 0!==e.e&&void 0!==e.d&&void 0===e.p)return(A=new u).setPrivate(e.n,e.e,e.d),A;if(void 0!==e.p&&void 0!==e.q&&void 0!==e.g&&void 0!==e.y&&void 0===e.x)return(A=new s).setPublic(e.p,e.q,e.g,e.y),A;if(void 0!==e.p&&void 0!==e.q&&void 0!==e.g&&void 0!==e.y&&void 0!==e.x)return(A=new s).setPrivate(e.p,e.q,e.g,e.y,e.x),A;if("RSA"===e.kty&&void 0!==e.n&&void 0!==e.e&&void 0===e.d)return(A=new u).setPublic(de(e.n),de(e.e)),A;if("RSA"===e.kty&&void 0!==e.n&&void 0!==e.e&&void 0!==e.d&&void 0!==e.p&&void 0!==e.q&&void 0!==e.dp&&void 0!==e.dq&&void 0!==e.qi)return(A=new u).setPrivateEx(de(e.n),de(e.e),de(e.d),de(e.p),de(e.q),de(e.dp),de(e.dq),de(e.qi)),A;if("RSA"===e.kty&&void 0!==e.n&&void 0!==e.e&&void 0!==e.d)return(A=new u).setPrivate(de(e.n),de(e.e),de(e.d)),A;if("EC"===e.kty&&void 0!==e.crv&&void 0!==e.x&&void 0!==e.y&&void 0===e.d){var h=(I=new a({curve:e.crv})).ecparams.keycharlen,f="04"+("0000000000"+de(e.x)).slice(-h)+("0000000000"+de(e.y)).slice(-h);return I.setPublicKeyHex(f),I}if("EC"===e.kty&&void 0!==e.crv&&void 0!==e.x&&void 0!==e.y&&void 0!==e.d){h=(I=new a({curve:e.crv})).ecparams.keycharlen,f="04"+("0000000000"+de(e.x)).slice(-h)+("0000000000"+de(e.y)).slice(-h);var p=("0000000000"+de(e.d)).slice(-h);return I.setPublicKeyHex(f),I.setPrivateKeyHex(p),I}if("pkcs5prv"===n){var v,g=e,m=re;if(9===(v=r(g,0)).length)(A=new u).readPKCS5PrvKeyHex(g);else if(6===v.length)(A=new s).readPKCS5PrvKeyHex(g);else{if(!(v.length>2&&"04"===g.substr(v[1],2)))throw new Error("unsupported PKCS#1/5 hexadecimal key");(A=new a).readPKCS5PrvKeyHex(g)}return A}if("pkcs8prv"===n)return A=l.getKeyFromPlainPrivatePKCS8Hex(e);if("pkcs8pub"===n)return l._getKeyFromPublicPKCS8Hex(e);if("x509pub"===n)return Ye.getPublicKeyFromCertHex(e);if(-1!=e.indexOf("-END CERTIFICATE-",0)||-1!=e.indexOf("-END X509 CERTIFICATE-",0)||-1!=e.indexOf("-END TRUSTED CERTIFICATE-",0))return Ye.getPublicKeyFromCertPEM(e);if(-1!=e.indexOf("-END PUBLIC KEY-")){var y=Se(e,"PUBLIC KEY");return l._getKeyFromPublicPKCS8Hex(y)}if(-1!=e.indexOf("-END RSA PRIVATE KEY-")&&-1==e.indexOf("4,ENCRYPTED")){var b=c(e,"RSA PRIVATE KEY");return l.getKey(b,null,"pkcs5prv")}if(-1!=e.indexOf("-END DSA PRIVATE KEY-")&&-1==e.indexOf("4,ENCRYPTED")){var w=i(P=c(e,"DSA PRIVATE KEY"),0,[1],"02"),S=i(P,0,[2],"02"),k=i(P,0,[3],"02"),C=i(P,0,[4],"02"),x=i(P,0,[5],"02");return(A=new s).setPrivate(new d(w,16),new d(S,16),new d(k,16),new d(C,16),new d(x,16)),A}if(-1!=e.indexOf("-END EC PRIVATE KEY-")&&-1==e.indexOf("4,ENCRYPTED")){b=c(e,"EC PRIVATE KEY");return l.getKey(b,null,"pkcs5prv")}if(-1!=e.indexOf("-END PRIVATE KEY-"))return l.getKeyFromPlainPrivatePKCS8PEM(e);if(-1!=e.indexOf("-END RSA PRIVATE KEY-")&&-1!=e.indexOf("4,ENCRYPTED")){var E=l.getDecryptedKeyHex(e,t),T=new W;return T.readPKCS5PrvKeyHex(E),T}if(-1!=e.indexOf("-END EC PRIVATE KEY-")&&-1!=e.indexOf("4,ENCRYPTED")){var I,A=i(P=l.getDecryptedKeyHex(e,t),0,[1],"04"),R=i(P,0,[2,0],"06"),_=i(P,0,[3,0],"03").substr(2);if(void 0===ee.crypto.OID.oidhex2name[R])throw new Error("undefined OID(hex) in KJUR.crypto.OID: "+R);return(I=new a({curve:ee.crypto.OID.oidhex2name[R]})).setPublicKeyHex(_),I.setPrivateKeyHex(A),I.isPublic=!1,I}if(-1!=e.indexOf("-END DSA PRIVATE KEY-")&&-1!=e.indexOf("4,ENCRYPTED")){var P;w=i(P=l.getDecryptedKeyHex(e,t),0,[1],"02"),S=i(P,0,[2],"02"),k=i(P,0,[3],"02"),C=i(P,0,[4],"02"),x=i(P,0,[5],"02");return(A=new s).setPrivate(new d(w,16),new d(S,16),new d(k,16),new d(C,16),new d(x,16)),A}if(-1!=e.indexOf("-END ENCRYPTED PRIVATE KEY-"))return l.getKeyFromEncryptedPKCS8PEM(e,t);throw new Error("not supported argument")},Ke.generateKeypair=function(e,t){if("RSA"==e){var n=t;(a=new W).generate(n,"10001"),a.isPrivate=!0,a.isPublic=!0;var r=new W,i=a.n.toString(16),o=a.e.toString(16);return r.setPublic(i,o),r.isPrivate=!1,r.isPublic=!0,(s={}).prvKeyObj=a,s.pubKeyObj=r,s}if("EC"==e){var a,s,u=t,c=new ee.crypto.ECDSA({curve:u}).generateKeyPairHex();return(a=new ee.crypto.ECDSA({curve:u})).setPublicKeyHex(c.ecpubhex),a.setPrivateKeyHex(c.ecprvhex),a.isPrivate=!0,a.isPublic=!1,(r=new ee.crypto.ECDSA({curve:u})).setPublicKeyHex(c.ecpubhex),r.isPrivate=!1,r.isPublic=!0,(s={}).prvKeyObj=a,s.pubKeyObj=r,s}throw new Error("unknown algorithm: "+e)},Ke.getPEM=function(e,t,n,r,o,a){var s=ee,u=s.asn1,c=u.DERObjectIdentifier,l=u.DERInteger,d=u.ASN1Util.newObject,h=u.x509.SubjectPublicKeyInfo,f=s.crypto,p=f.DSA,v=f.ECDSA,g=W;function m(e){return d({seq:[{int:0},{int:{bigint:e.n}},{int:e.e},{int:{bigint:e.d}},{int:{bigint:e.p}},{int:{bigint:e.q}},{int:{bigint:e.dmp1}},{int:{bigint:e.dmq1}},{int:{bigint:e.coeff}}]})}function y(e){return d({seq:[{int:1},{octstr:{hex:e.prvKeyHex}},{tag:["a0",!0,{oid:{name:e.curveName}}]},{tag:["a1",!0,{bitstr:{hex:"00"+e.pubKeyHex}}]}]})}function b(e){return d({seq:[{int:0},{int:{bigint:e.p}},{int:{bigint:e.q}},{int:{bigint:e.g}},{int:{bigint:e.y}},{int:{bigint:e.x}}]})}if((void 0!==g&&e instanceof g||void 0!==p&&e instanceof p||void 0!==v&&e instanceof v)&&1==e.isPublic&&(void 0===t||"PKCS8PUB"==t))return we(C=new h(e).tohex(),"PUBLIC KEY");if("PKCS1PRV"==t&&void 0!==g&&e instanceof g&&(void 0===n||null==n)&&1==e.isPrivate)return we(C=m(e).tohex(),"RSA PRIVATE KEY");if("PKCS1PRV"==t&&void 0!==v&&e instanceof v&&(void 0===n||null==n)&&1==e.isPrivate){var w=new c({name:e.curveName}).tohex(),S=y(e).tohex(),k="";return k+=we(w,"EC PARAMETERS"),k+=we(S,"EC PRIVATE KEY")}if("PKCS1PRV"==t&&void 0!==p&&e instanceof p&&(void 0===n||null==n)&&1==e.isPrivate)return we(C=b(e).tohex(),"DSA PRIVATE KEY");if("PKCS5PRV"==t&&void 0!==g&&e instanceof g&&void 0!==n&&null!=n&&1==e.isPrivate){var C=m(e).tohex();return void 0===r&&(r="DES-EDE3-CBC"),this.getEncryptedPKCS5PEMFromPrvKeyHex("RSA",C,n,r,a)}if("PKCS5PRV"==t&&void 0!==v&&e instanceof v&&void 0!==n&&null!=n&&1==e.isPrivate){C=y(e).tohex();return void 0===r&&(r="DES-EDE3-CBC"),this.getEncryptedPKCS5PEMFromPrvKeyHex("EC",C,n,r,a)}if("PKCS5PRV"==t&&void 0!==p&&e instanceof p&&void 0!==n&&null!=n&&1==e.isPrivate){C=b(e).tohex();return void 0===r&&(r="DES-EDE3-CBC"),this.getEncryptedPKCS5PEMFromPrvKeyHex("DSA",C,n,r,a)}var x=function(e,t){var n=E(e,t);return new d({seq:[{seq:[{oid:{name:"pkcs5PBES2"}},{seq:[{seq:[{oid:{name:"pkcs5PBKDF2"}},{seq:[{octstr:{hex:n.pbkdf2Salt}},{int:n.pbkdf2Iter}]}]},{seq:[{oid:{name:"des-EDE3-CBC"}},{octstr:{hex:n.encryptionSchemeIV}}]}]}]},{octstr:{hex:n.ciphertext}}]}).tohex()},E=function(e,t){var n=i.lib.WordArray.random(8),r=i.lib.WordArray.random(8),o=i.PBKDF2(t,n,{keySize:6,iterations:100}),a=i.enc.Hex.parse(e),s=i.TripleDES.encrypt(a,o,{iv:r})+"",u={};return u.ciphertext=s,u.pbkdf2Salt=i.enc.Hex.stringify(n),u.pbkdf2Iter=100,u.encryptionSchemeAlg="DES-EDE3-CBC",u.encryptionSchemeIV=i.enc.Hex.stringify(r),u};if("PKCS8PRV"==t&&void 0!=g&&e instanceof g&&1==e.isPrivate){var T=m(e).tohex();C=d({seq:[{int:0},{seq:[{oid:{name:"rsaEncryption"}},{null:!0}]},{octstr:{hex:T}}]}).tohex();return void 0===n||null==n?we(C,"PRIVATE KEY"):we(S=x(C,n),"ENCRYPTED PRIVATE KEY")}if("PKCS8PRV"==t&&void 0!==v&&e instanceof v&&1==e.isPrivate){var I={seq:[{int:1},{octstr:{hex:e.prvKeyHex}}]};"string"==typeof e.pubKeyHex&&I.seq.push({tag:["a1",!0,{bitstr:{hex:"00"+e.pubKeyHex}}]});T=new d(I).tohex(),C=d({seq:[{int:0},{seq:[{oid:{name:"ecPublicKey"}},{oid:{name:e.curveName}}]},{octstr:{hex:T}}]}).tohex();return void 0===n||null==n?we(C,"PRIVATE KEY"):we(S=x(C,n),"ENCRYPTED PRIVATE KEY")}if("PKCS8PRV"==t&&void 0!==p&&e instanceof p&&1==e.isPrivate){T=new l({bigint:e.x}).tohex(),C=d({seq:[{int:0},{seq:[{oid:{name:"dsa"}},{seq:[{int:{bigint:e.p}},{int:{bigint:e.q}},{int:{bigint:e.g}}]}]},{octstr:{hex:T}}]}).tohex();return void 0===n||null==n?we(C,"PRIVATE KEY"):we(S=x(C,n),"ENCRYPTED PRIVATE KEY")}throw new Error("unsupported object nor format")},Ke.getKeyFromCSRPEM=function(e){var t=Se(e,"CERTIFICATE REQUEST");return Ke.getKeyFromCSRHex(t)},Ke.getKeyFromCSRHex=function(e){var t=Ke.parseCSRHex(e);return Ke.getKey(t.p8pubkeyhex,null,"pkcs8pub")},Ke.parseCSRHex=function(e){var t=re,n=t.getChildIdx,r=t.getTLV,i={},o=e;if("30"!=o.substr(0,2))throw new Error("malformed CSR(code:001)");var a=n(o,0);if(a.length<1)throw new Error("malformed CSR(code:002)");if("30"!=o.substr(a[0],2))throw new Error("malformed CSR(code:003)");var s=n(o,a[0]);if(s.length<3)throw new Error("malformed CSR(code:004)");return i.p8pubkeyhex=r(o,s[2]),i},Ke.getKeyID=function(e){var t=Ke,n=re;"string"===typeof e&&-1!=e.indexOf("BEGIN ")&&(e=t.getKey(e));var r=Se(t.getPEM(e)),i=n.getIdxbyList(r,0,[1]),o=n.getV(r,i).substring(2);return ee.crypto.Util.hashHex(o,"sha1")},Ke.getJWK=function(e,t,n,r,i){var o,a,s={},c=ee.crypto.Util.hashHex;if("string"==typeof e)o=Ke.getKey(e),-1!=e.indexOf("CERTIFICATE")&&(a=Se(e));else{if("object"!=typeof e)throw new Error("unsupported keyinfo type");e instanceof Ye?(o=e.getPublicKey(),a=e.hex):o=e}if(o instanceof W&&o.isPrivate)s.kty="RSA",s.n=le(o.n.toString(16)),s.e=le(o.e.toString(16)),s.d=le(o.d.toString(16)),s.p=le(o.p.toString(16)),s.q=le(o.q.toString(16)),s.dp=le(o.dmp1.toString(16)),s.dq=le(o.dmq1.toString(16)),s.qi=le(o.coeff.toString(16));else if(o instanceof W&&o.isPublic)s.kty="RSA",s.n=le(o.n.toString(16)),s.e=le(o.e.toString(16));else if(o instanceof ee.crypto.ECDSA&&o.isPrivate){if("P-256"!==(d=o.getShortNISTPCurveName())&&"P-384"!==d&&"P-521"!==d)throw new Error("unsupported curve name for JWT: "+d);var l=o.getPublicKeyXYHex();s.kty="EC",s.crv=d,s.x=le(l.x),s.y=le(l.y),s.d=le(o.prvKeyHex)}else if(o instanceof ee.crypto.ECDSA&&o.isPublic){var d;if("P-256"!==(d=o.getShortNISTPCurveName())&&"P-384"!==d&&"P-521"!==d)throw new Error("unsupported curve name for JWT: "+d);l=o.getPublicKeyXYHex();s.kty="EC",s.crv=d,s.x=le(l.x),s.y=le(l.y)}if(void 0==s.kty)throw new Error("unsupported keyinfo");return o.isPrivate||1==t||(s.kid=ee.jws.JWS.getJWKthumbprint(s)),void 0!=a&&1!=n&&(s.x5c=[u(a)]),void 0!=a&&1!=r&&(s.x5t=ue(u(c(a,"sha1")))),void 0!=a&&1!=i&&(s["x5t#S256"]=ue(u(c(a,"sha256")))),s},Ke.getJWKFromKey=function(e){return Ke.getJWK(e,!0,!0,!0,!0)},W.getPosArrayOfChildrenFromHex=function(e){return re.getChildIdx(e,0)},W.getHexValueArrayOfChildrenFromHex=function(e){var t,n=re.getV,r=n(e,(t=W.getPosArrayOfChildrenFromHex(e))[0]),i=n(e,t[1]),o=n(e,t[2]),a=n(e,t[3]),s=n(e,t[4]),u=n(e,t[5]),c=n(e,t[6]),l=n(e,t[7]),d=n(e,t[8]);return(t=new Array).push(r,i,o,a,s,u,c,l,d),t},W.prototype.readPrivateKeyFromPEMString=function(e){var t=Se(e),n=W.getHexValueArrayOfChildrenFromHex(t);this.setPrivateEx(n[1],n[2],n[3],n[4],n[5],n[6],n[7],n[8])},W.prototype.readPKCS5PrvKeyHex=function(e){var t=W.getHexValueArrayOfChildrenFromHex(e);this.setPrivateEx(t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8])},W.prototype.readPKCS8PrvKeyHex=function(e){var t,n,r,i,o,a,s,u,c=re,l=c.getVbyListEx;if(!1===c.isASN1HEX(e))throw new Error("not ASN.1 hex string");try{t=l(e,0,[2,0,1],"02"),n=l(e,0,[2,0,2],"02"),r=l(e,0,[2,0,3],"02"),i=l(e,0,[2,0,4],"02"),o=l(e,0,[2,0,5],"02"),a=l(e,0,[2,0,6],"02"),s=l(e,0,[2,0,7],"02"),u=l(e,0,[2,0,8],"02")}catch(d){throw new Error("malformed PKCS#8 plain RSA private key")}this.setPrivateEx(t,n,r,i,o,a,s,u)},W.prototype.readPKCS5PubKeyHex=function(e){var t=re,n=t.getV;if(!1===t.isASN1HEX(e))throw new Error("keyHex is not ASN.1 hex string");var r=t.getChildIdx(e,0);if(2!==r.length||"02"!==e.substr(r[0],2)||"02"!==e.substr(r[1],2))throw new Error("wrong hex for PKCS#5 public key");var i=n(e,r[0]),o=n(e,r[1]);this.setPublic(i,o)},W.prototype.readPKCS8PubKeyHex=function(e){var t=re;if(!1===t.isASN1HEX(e))throw new Error("not ASN.1 hex string");if("06092a864886f70d010101"!==t.getTLVbyListEx(e,0,[0,0]))throw new Error("not PKCS8 RSA public key");var n=t.getTLVbyListEx(e,0,[1,0]);this.readPKCS5PubKeyHex(n)},W.prototype.readCertPubKeyHex=function(e,t){var n,r;(n=new Ye).readCertHex(e),r=n.getPublicKeyHex(),this.readPKCS8PubKeyHex(r)};function We(e,t){for(var n="",r=t/4-e.length,i=0;i<r;i++)n+="0";return n+e}function Je(e,t,n){for(var r="",i=0;r.length<t;)r+=ve(n(ge(e+String.fromCharCode.apply(String,[(4278190080&i)>>24,(16711680&i)>>16,(65280&i)>>8,255&i])))),i+=1;return r}function Qe(e){for(var t in ee.crypto.Util.DIGESTINFOHEAD){var n=ee.crypto.Util.DIGESTINFOHEAD[t],r=n.length;if(e.substring(0,r)==n)return[t,e.substring(r)]}return[]}function Ye(e){var t,n=re,r=n.getChildIdx,i=n.getV,o=(n.dump,n.parse),a=n.getTLV,s=n.getVbyList,u=n.getVbyListEx,c=n.getTLVbyList,l=n.getTLVbyListEx,d=n.getIdxbyList,h=n.getIdxbyListEx,f=n.getVidx,p=n.getInt,v=n.oidname,g=n.hextooidstr,m=Se,y=Error;try{t=ee.asn1.x509.AlgorithmIdentifier.PSSNAME2ASN1TLV}catch(q){}this.HEX2STAG={"0c":"utf8",13:"prn",16:"ia5","1a":"vis","1e":"bmp"},this.hex=null,this.version=0,this.foffset=0,this.aExtInfo=null,this.getVersion=function(){if(null===this.hex||0!==this.version)return this.version;var e=c(this.hex,0,[0,0]);if("a0"==e.substr(0,2)){var t=c(e,0,[0]),n=p(t,0);if(n<0||2<n)throw new Error("malformed version field");return this.version=n+1,this.version}return this.version=1,this.foffset=-1,1},this.getSerialNumberHex=function(){return u(this.hex,0,[0,0],"02")},this.getSignatureAlgorithmField=function(){var e=l(this.hex,0,[0,1]);return this.getAlgorithmIdentifierName(e)},this.getAlgorithmIdentifierName=function(e){for(var n in t)if(e===t[n])return n;return v(u(e,0,[0],"06"))},this.getIssuer=function(e,t){return this.getX500Name(this.getIssuerHex(),e,t)},this.getIssuerHex=function(){return c(this.hex,0,[0,3+this.foffset],"30")},this.getIssuerString=function(){return this.getIssuer().str},this.getSubject=function(e,t){return this.getX500Name(this.getSubjectHex(),e,t)},this.getSubjectHex=function(){return c(this.hex,0,[0,5+this.foffset],"30")},this.getSubjectString=function(){return this.getSubject().str},this.getNotBefore=function(){var e=s(this.hex,0,[0,4+this.foffset,0]);return e=e.replace(/(..)/g,"%$1"),e=decodeURIComponent(e)},this.getNotAfter=function(){var e=s(this.hex,0,[0,4+this.foffset,1]);return e=e.replace(/(..)/g,"%$1"),e=decodeURIComponent(e)},this.getPublicKeyHex=function(){return this.getSPKI()},this.getSPKI=function(){return c(this.hex,0,[0,6+this.foffset],"30")},this.getSPKIValue=function(){var e=this.getSPKI();return null==e?null:s(e,0,[1],"03",!0)},this.getPublicKeyIdx=function(){return d(this.hex,0,[0,6+this.foffset],"30")},this.getPublicKeyContentIdx=function(){var e=this.getPublicKeyIdx();return d(this.hex,e,[1,0],"30")},this.getPublicKey=function(){return Ke.getKey(this.getPublicKeyHex(),null,"pkcs8pub")},this.getSignatureAlgorithmName=function(){var e=c(this.hex,0,[1],"30");return this.getAlgorithmIdentifierName(e)},this.getSignatureValueHex=function(){return s(this.hex,0,[2],"03",!0)},this.verifySignature=function(e){var t=this.getSignatureAlgorithmField(),n=this.getSignatureValueHex(),r=c(this.hex,0,[0],"30"),i=new ee.crypto.Signature({alg:t});return i.init(e),i.updateHex(r),i.verify(n)},this.parseExt=function(e){var t,o,a;if(void 0===e){if(a=this.hex,3!==this.version)return-1;t=d(a,0,[0,7,0],"30"),o=r(a,t)}else{a=Se(e);var u=d(a,0,[0,3,0,0],"06");if("2a864886f70d01090e"!=i(a,u))return void(this.aExtInfo=new Array);t=d(a,0,[0,3,0,1,0],"30"),o=r(a,t),this.hex=a}this.aExtInfo=new Array;for(var c=0;c<o.length;c++){var l={critical:!1},h=0;3===r(a,o[c]).length&&(l.critical=!0,h=1),l.oid=n.hextooidstr(s(a,o[c],[0],"06"));var p=d(a,o[c],[1+h]);l.vidx=f(a,p),this.aExtInfo.push(l)}},this.getExtInfo=function(e){var t=this.aExtInfo,n=e;if(e.match(/^[0-9.]+$/)||(n=ee.asn1.x509.OID.name2oid(e)),""!==n)for(var r=0;r<t.length;r++)if(t[r].oid===n)return t[r]},this.getCriticalExtV=function(e,t,n){if(void 0!=t)return[t,n];var r=this.getExtInfo(e);return void 0==r?[null,null]:[a(this.hex,r.vidx),r.critical]},this.getExtBasicConstraints=function(e,t){if(void 0===e&&void 0===t){var n=this.getExtInfo("basicConstraints");if(void 0===n)return;e=a(this.hex,n.vidx),t=n.critical}var r={extname:"basicConstraints"};if(t&&(r.critical=!0),"3000"===e)return r;if("30030101ff"===e)return r.cA=!0,r;if("30060101ff02"===e.substr(0,12)){var o=i(e,10),s=parseInt(o,16);return r.cA=!0,r.pathLen=s,r}throw new Error("hExtV parse error: "+e)},this.getExtNameConstraints=function(e,t){var n=this.getCriticalExtV("nameConstraints",e,t);if(e=n[0],t=n[1],null!=e){var i={extname:"nameConstraints"};t&&(i.critical=!0);for(var o=r(e,0),s=0;s<o.length;s++){for(var u=[],c=r(e,o[s]),l=0;l<c.length;l++){var d=a(e,c[l]),h=this.getGeneralSubtree(d);u.push(h)}var f=e.substr(o[s],2);"a0"==f?i.permit=u:"a1"==f&&(i.exclude=u)}return i}},this.getGeneralSubtree=function(e){var t=r(e,0),n=t.length;if(n<1||2<n)throw new Error("wrong num elements");for(var o=this.getGeneralName(a(e,t[0])),s=1;s<n;s++){var u=e.substr(t[s],2),c=i(e,t[s]),l=parseInt(c,16);"80"==u&&(o.min=l),"81"==u&&(o.max=l)}return o},this.getExtKeyUsage=function(e,t){var n=this.getCriticalExtV("keyUsage",e,t);if(e=n[0],t=n[1],null!=e){var r={extname:"keyUsage"};return t&&(r.critical=!0),r.names=this.getExtKeyUsageString(e).split(","),r}},this.getExtKeyUsageBin=function(e){if(void 0===e){var t=this.getExtInfo("keyUsage");if(void 0===t)return"";e=a(this.hex,t.vidx)}if(8!=e.length&&10!=e.length)throw new Error("malformed key usage value: "+e);var n="000000000000000"+parseInt(e.substr(6),16).toString(2);return 8==e.length&&(n=n.slice(-8)),10==e.length&&(n=n.slice(-16)),""==(n=n.replace(/0+$/,""))&&(n="0"),n},this.getExtKeyUsageString=function(e){for(var t=this.getExtKeyUsageBin(e),n=new Array,r=0;r<t.length;r++)"1"==t.substr(r,1)&&n.push(Ye.KEYUSAGE_NAME[r]);return n.join(",")},this.getExtSubjectKeyIdentifier=function(e,t){if(void 0===e&&void 0===t){var n=this.getExtInfo("subjectKeyIdentifier");if(void 0===n)return;e=a(this.hex,n.vidx),t=n.critical}var r={extname:"subjectKeyIdentifier"};t&&(r.critical=!0);var o=i(e,0);return r.kid={hex:o},r},this.getExtAuthorityKeyIdentifier=function(e,t){if(void 0===e&&void 0===t){var n=this.getExtInfo("authorityKeyIdentifier");if(void 0===n)return;e=a(this.hex,n.vidx),t=n.critical}var o={extname:"authorityKeyIdentifier"};t&&(o.critical=!0);for(var s=r(e,0),u=0;u<s.length;u++){var c=e.substr(s[u],2);if("80"===c&&(o.kid={hex:i(e,s[u])}),"a1"===c){var l=a(e,s[u]),d=this.getGeneralNames(l);o.issuer=d[0].dn}"82"===c&&(o.sn={hex:i(e,s[u])})}return o},this.getExtExtKeyUsage=function(e,t){if(void 0===e&&void 0===t){var n=this.getExtInfo("extKeyUsage");if(void 0===n)return;e=a(this.hex,n.vidx),t=n.critical}var o={extname:"extKeyUsage",array:[]};t&&(o.critical=!0);for(var s=r(e,0),u=0;u<s.length;u++)o.array.push(v(i(e,s[u])));return o},this.getExtExtKeyUsageName=function(){var e=this.getExtInfo("extKeyUsage");if(void 0===e)return e;var t=new Array,n=a(this.hex,e.vidx);if(""===n)return t;for(var o=r(n,0),s=0;s<o.length;s++)t.push(v(i(n,o[s])));return t},this.getExtSubjectAltName=function(e,t){if(void 0===e&&void 0===t){var n=this.getExtInfo("subjectAltName");if(void 0===n)return;e=a(this.hex,n.vidx),t=n.critical}var r={extname:"subjectAltName",array:[]};return t&&(r.critical=!0),r.array=this.getGeneralNames(e),r},this.getExtIssuerAltName=function(e,t){if(void 0===e&&void 0===t){var n=this.getExtInfo("issuerAltName");if(void 0===n)return;e=a(this.hex,n.vidx),t=n.critical}var r={extname:"issuerAltName",array:[]};return t&&(r.critical=!0),r.array=this.getGeneralNames(e),r},this.getGeneralNames=function(e){for(var t=r(e,0),n=[],i=0;i<t.length;i++){var o=this.getGeneralName(a(e,t[i]));void 0!==o&&n.push(o)}return n},this.getGeneralName=function(e){var t=e.substr(0,2),n=i(e,0),r=ve(n);return"81"==t?{rfc822:r}:"82"==t?{dns:r}:"86"==t?{uri:r}:"87"==t?{ip:Re(n)}:"a4"==t?{dn:this.getX500Name(n)}:"a0"==t?{other:this.getOtherName(e)}:void 0},this.getExtSubjectAltName2=function(){var e,t,n,o=this.getExtInfo("subjectAltName");if(void 0===o)return o;for(var s=new Array,u=a(this.hex,o.vidx),c=r(u,0),l=0;l<c.length;l++)n=u.substr(c[l],2),e=i(u,c[l]),"81"===n&&(t=fe(e),s.push(["MAIL",t])),"82"===n&&(t=fe(e),s.push(["DNS",t])),"84"===n&&(t=Ye.hex2dn(e,0),s.push(["DN",t])),"86"===n&&(t=fe(e),s.push(["URI",t])),"87"===n&&(t=Re(e),s.push(["IP",t]));return s},this.getExtCRLDistributionPoints=function(e,t){if(void 0===e&&void 0===t){var n=this.getExtInfo("cRLDistributionPoints");if(void 0===n)return;e=a(this.hex,n.vidx),t=n.critical}var i={extname:"cRLDistributionPoints",array:[]};t&&(i.critical=!0);for(var o=r(e,0),s=0;s<o.length;s++){var u=a(e,o[s]);i.array.push(this.getDistributionPoint(u))}return i},this.getDistributionPoint=function(e){for(var t={},n=r(e,0),i=0;i<n.length;i++){var o=e.substr(n[i],2),s=a(e,n[i]);"a0"==o&&(t.dpname=this.getDistributionPointName(s))}return t},this.getDistributionPointName=function(e){for(var t={},n=r(e,0),i=0;i<n.length;i++){var o=e.substr(n[i],2),s=a(e,n[i]);"a0"==o&&(t.full=this.getGeneralNames(s))}return t},this.getExtCRLDistributionPointsURI=function(){var e=this.getExtCRLDistributionPoints();if(void 0==e)return e;for(var t=e.array,n=[],r=0;r<t.length;r++)try{void 0!=t[r].dpname.full[0].uri&&n.push(t[r].dpname.full[0].uri)}catch(i){}return n},this.getExtAIAInfo=function(){var e=this.getExtInfo("authorityInfoAccess");if(void 0===e)return e;for(var t={ocsp:[],caissuer:[]},n=r(this.hex,e.vidx),i=0;i<n.length;i++){var o=s(this.hex,n[i],[0],"06"),a=s(this.hex,n[i],[1],"86");"2b06010505073001"===o&&t.ocsp.push(fe(a)),"2b06010505073002"===o&&t.caissuer.push(fe(a))}return t},this.getExtAuthorityInfoAccess=function(e,t){if(void 0===e&&void 0===t){var n=this.getExtInfo("authorityInfoAccess");if(void 0===n)return;e=a(this.hex,n.vidx),t=n.critical}var i={extname:"authorityInfoAccess",array:[]};t&&(i.critical=!0);for(var o=r(e,0),c=0;c<o.length;c++){var l=u(e,o[c],[0],"06"),d=fe(s(e,o[c],[1],"86"));if("2b06010505073001"==l)i.array.push({ocsp:d});else{if("2b06010505073002"!=l)throw new Error("unknown method: "+l);i.array.push({caissuer:d})}}return i},this.getExtCertificatePolicies=function(e,t){if(void 0===e&&void 0===t){var n=this.getExtInfo("certificatePolicies");if(void 0===n)return;e=a(this.hex,n.vidx),t=n.critical}var i={extname:"certificatePolicies",array:[]};t&&(i.critical=!0);for(var o=r(e,0),s=0;s<o.length;s++){var u=a(e,o[s]),c=this.getPolicyInformation(u);i.array.push(c)}return i},this.getPolicyInformation=function(e){var t={},n=s(e,0,[0],"06");t.policyoid=v(n);var i=h(e,0,[1],"30");if(-1!=i){t.array=[];for(var o=r(e,i),u=0;u<o.length;u++){var c=a(e,o[u]),l=this.getPolicyQualifierInfo(c);t.array.push(l)}}return t},this.getOtherName=function(e){var t={},n=r(e,0),i=s(e,n[0],[],"06"),a=s(e,n[1],[]);return t.oid=v(i),t.value=o(a),t},this.getPolicyQualifierInfo=function(e){var t={},n=s(e,0,[0],"06");if("2b06010505070201"===n){var r=u(e,0,[1],"16");t.cps=ve(r)}else if("2b06010505070202"===n){var i=c(e,0,[1],"30");t.unotice=this.getUserNotice(i)}return t},this.getUserNotice=function(e){var t=null;try{return t=n.parse(e),this._asn1ToUnotice(t)}catch(r){return}},this._asn1ToUnotice=function(e){try{for(var t={},n=Ve(e,"seq"),r=0;r<n.length;r++){var i=this._asn1ToNoticeRef(n[r]);void 0!=i&&(t.noticeref=i);var o=this.asn1ToDisplayText(n[r]);void 0!=o&&(t.exptext=o)}return Object.keys(t).length>0?t:void 0}catch(a){return}},this._asn1ToNoticeRef=function(e){try{for(var t={},n=Ve(e,"seq"),r=0;r<n.length;r++){var i=this._asn1ToNoticeNum(n[r]);void 0!=i&&(t.noticenum=i);var o=this.asn1ToDisplayText(n[r]);void 0!=o&&(t.org=o)}return Object.keys(t).length>0?t:void 0}catch(a){return}},this._asn1ToNoticeNum=function(e){try{for(var t=Ve(e,"seq"),n=[],r=0;r<t.length;r++){var i=t[r];n.push(parseInt(Ve(i,"int.hex"),16))}return n}catch(o){return}},this.getDisplayText=function(e){var t={};return t.type={"0c":"utf8",16:"ia5","1a":"vis","1e":"bmp"}[e.substr(0,2)],t.str=ve(i(e,0)),t},this.asn1ToDisplayText=function(e){return void 0!=e.utf8str?{type:"utf8",str:e.utf8str.str}:void 0!=e.ia5str?{type:"ia5",str:e.ia5str.str}:void 0!=e.visstr?{type:"vis",str:e.visstr.str}:void 0!=e.bmpstr?{type:"bmp",str:e.bmpstr.str}:void 0!=e.prnstr?{type:"prn",str:e.prnstr.str}:void 0},this.getExtPolicyMappings=function(e,t){var n=this.getCriticalExtV("policyMappings",e,t);if(e=n[0],t=n[1],null!=e){var r={extname:"policyMappings"};t&&(r.critical=!0);try{for(var i=o(e).seq,a=[],s=0;s<i.length;s++){var u=i[s].seq;a.push([u[0].oid,u[1].oid])}r.array=a}catch(c){throw new y("malformed policyMappings")}return r}},this.getExtPolicyConstraints=function(e,t){var n=this.getCriticalExtV("policyConstraints",e,t);if(e=n[0],t=n[1],null!=e){var r={extname:"policyConstraints"};t&&(r.critical=!0);var i=o(e);try{for(var a=i.seq,s=0;s<a.length;s++){var u=a[s].tag;0==u.explicit&&("80"==u.tag&&(r.reqexp=parseInt(u.hex,16)),"81"==u.tag&&(r.inhibit=parseInt(u.hex,16)))}}catch(c){return new y("malformed policyConstraints value")}return r}},this.getExtInhibitAnyPolicy=function(e,t){var n=this.getCriticalExtV("inhibitAnyPolicy",e,t);if(e=n[0],t=n[1],null!=e){var r={extname:"inhibitAnyPolicy"};t&&(r.critical=!0);var i=p(e,0);return-1==i?new y("wrong value"):(r.skip=i,r)}},this.getExtCRLNumber=function(e,t){var n={extname:"cRLNumber"};if(t&&(n.critical=!0),"02"==e.substr(0,2))return n.num={hex:i(e,0)},n;throw new y("hExtV parse error: "+e)},this.getExtCRLReason=function(e,t){var n={extname:"cRLReason"};if(t&&(n.critical=!0),"0a"==e.substr(0,2))return n.code=parseInt(i(e,0),16),n;throw new Error("hExtV parse error: "+e)},this.getExtOcspNonce=function(e,t){var n={extname:"ocspNonce"};t&&(n.critical=!0);var r=i(e,0);return n.hex=r,n},this.getExtOcspNoCheck=function(e,t){var n={extname:"ocspNoCheck"};return t&&(n.critical=!0),n},this.getExtAdobeTimeStamp=function(e,t){if(void 0===e&&void 0===t){var n=this.getExtInfo("adobeTimeStamp");if(void 0===n)return;e=a(this.hex,n.vidx),t=n.critical}var i={extname:"adobeTimeStamp"};t&&(i.critical=!0);var o=r(e,0);if(o.length>1){var s=a(e,o[1]),u=this.getGeneralName(s);void 0!=u.uri&&(i.uri=u.uri)}if(o.length>2){var c=a(e,o[2]);"0101ff"==c&&(i.reqauth=!0),"010100"==c&&(i.reqauth=!1)}return i},this.getExtSubjectDirectoryAttributes=function(e,t){if(void 0===e&&void 0===t){var n=this.getExtInfo("subjectDirectoryAttributes");if(void 0===n)return;e=a(this.hex,n.vidx),t=n.critical}var r={extname:"subjectDirectoryAttributes"};t&&(r.critical=!0);try{for(var i=o(e),s=[],u=0;u<i.seq.length;u++){var c=i.seq[u],l=Ve(c,"seq.0.oid"),d=Ve(c,"seq.1.set");if(void 0==l||void 0==d)throw"error";s.push({attr:l,array:d})}return r.array=s,r}catch(h){throw new Error("malformed subjectDirectoryAttributes extension value")}};var b=function(e){var t={};try{var n=e.seq[0].oid,r=ee.asn1.x509.OID.name2oid(n);t.type=ee.asn1.x509.OID.oid2atype(r);var i=e.seq[1];if(void 0!=i.utf8str)t.ds="utf8",t.value=i.utf8str.str;else if(void 0!=i.numstr)t.ds="num",t.value=i.numstr.str;else if(void 0!=i.telstr)t.ds="tel",t.value=i.telstr.str;else if(void 0!=i.prnstr)t.ds="prn",t.value=i.prnstr.str;else if(void 0!=i.ia5str)t.ds="ia5",t.value=i.ia5str.str;else if(void 0!=i.visstr)t.ds="vis",t.value=i.visstr.str;else{if(void 0==i.bmpstr)throw"error";t.ds="bmp",t.value=i.bmpstr.str}return t}catch(o){throw new Erorr("improper ASN.1 parsed AttrTypeAndValue")}},w=function(e){try{return e.set.map((function(e){return b(e)}))}catch(H){throw new Error("improper ASN.1 parsed RDN: "+H)}};this.getX500NameRule=function(e){for(var t=null,n=[],r=0;r<e.length;r++)for(var i=e[r],o=0;o<i.length;o++)n.push(i[o]);for(r=0;r<n.length;r++){var a=n[r],s=a.ds,u=a.value,c=a.type;if(":"+s,"prn"!=s&&"utf8"!=s&&"ia5"!=s)return"mixed";if("ia5"==s){if("CN"!=c)return"mixed";if(ee.lang.String.isMail(u))continue;return"mixed"}if("C"==c){if("prn"==s)continue;return"mixed"}if(":"+s,null==t)t=s;else if(t!==s)return"mixed"}return null==t?"prn":t},this.getAttrTypeAndValue=function(e){var t=o(e);return b(t)},this.getRDN=function(e){var t=o(e);return w(t)},this.getX500NameArray=function(e){return function(t){try{return t.seq.map((function(e){return w(e)}))}catch(e){throw new Error("improper ASN.1 parsed X500Name: "+e)}}(o(e))},this.getX500Name=function(e,t,n){var r=this.getX500NameArray(e),i={str:this.dnarraytostr(r)};return i.array=r,1==n&&(i.hex=e),1==t&&(i.canon=this.c14nRDNArray(r)),i},this.readCertPEM=function(e){this.readCertHex(m(e))},this.readCertHex=function(e){this.hex=e,this.getVersion();try{d(this.hex,0,[0,7],"a3"),this.parseExt()}catch(t){}},this.getParam=function(e){var t={};return void 0==e&&(e={}),t.version=this.getVersion(),t.serial={hex:this.getSerialNumberHex()},t.sigalg=this.getSignatureAlgorithmField(),t.issuer=this.getIssuer(e.dncanon,e.dnhex),t.notbefore=this.getNotBefore(),t.notafter=this.getNotAfter(),t.subject=this.getSubject(e.dncanon,e.dnhex),t.sbjpubkey=we(this.getPublicKeyHex(),"PUBLIC KEY"),void 0!=this.aExtInfo&&this.aExtInfo.length>0&&(t.ext=this.getExtParamArray()),t.sighex=this.getSignatureValueHex(),1==e.tbshex&&(t.tbshex=c(this.hex,0,[0])),1==e.nodnarray&&(delete t.issuer.array,delete t.subject.array),t},this.getExtParamArray=function(e){void 0==e&&(-1!=h(this.hex,0,[0,"[3]"])&&(e=l(this.hex,0,[0,"[3]",0],"30")));for(var t=[],n=r(e,0),i=0;i<n.length;i++){var o=a(e,n[i]),s=this.getExtParam(o);null!=s&&t.push(s)}return t},this.getExtParam=function(e){var t=r(e,0).length;if(2!=t&&3!=t)throw new Error("wrong number elements in Extension: "+t+" "+e);var n=g(s(e,0,[0],"06")),i=!1;3==t&&"0101ff"==c(e,0,[1])&&(i=!0);var a=c(e,0,[t-1,0]),u=void 0;if("2.5.29.14"==n?u=this.getExtSubjectKeyIdentifier(a,i):"2.5.29.15"==n?u=this.getExtKeyUsage(a,i):"2.5.29.17"==n?u=this.getExtSubjectAltName(a,i):"2.5.29.18"==n?u=this.getExtIssuerAltName(a,i):"2.5.29.19"==n?u=this.getExtBasicConstraints(a,i):"2.5.29.30"==n?u=this.getExtNameConstraints(a,i):"2.5.29.31"==n?u=this.getExtCRLDistributionPoints(a,i):"2.5.29.32"==n?u=this.getExtCertificatePolicies(a,i):"2.5.29.33"==n?u=this.getExtPolicyMappings(a,i):"2.5.29.35"==n?u=this.getExtAuthorityKeyIdentifier(a,i):"2.5.29.36"==n?u=this.getExtPolicyConstraints(a,i):"2.5.29.37"==n?u=this.getExtExtKeyUsage(a,i):"2.5.29.54"==n?u=this.getExtInhibitAnyPolicy(a,i):"1.3.6.1.5.5.7.1.1"==n?u=this.getExtAuthorityInfoAccess(a,i):"2.5.29.20"==n?u=this.getExtCRLNumber(a,i):"2.5.29.21"==n?u=this.getExtCRLReason(a,i):"2.5.29.9"==n?u=this.getExtSubjectDirectoryAttributes(a,i):"1.3.6.1.5.5.7.48.1.2"==n?u=this.getExtOcspNonce(a,i):"1.3.6.1.5.5.7.48.1.5"==n?u=this.getExtOcspNoCheck(a,i):"1.2.840.113583.1.1.9.1"==n?u=this.getExtAdobeTimeStamp(a,i):void 0!=Ye.EXT_PARSER[n]&&(u=Ye.EXT_PARSER[n](n,i,a)),void 0!=u)return u;var l={extname:n,extn:a};try{l.extn=o(a)}catch(d){}return i&&(l.critical=!0),l},this.findExt=function(e,t){for(var n=0;n<e.length;n++)if(e[n].extname==t)return e[n];return null},this.updateExtCDPFullURI=function(e,t){var n=this.findExt(e,"cRLDistributionPoints");if(null!=n&&void 0!=n.array)for(var r=n.array,i=0;i<r.length;i++)if(void 0!=r[i].dpname&&void 0!=r[i].dpname.full)for(var o=r[i].dpname.full,a=0;a<o.length;a++){var s=o[i];void 0!=s.uri&&(s.uri=t)}},this.updateExtAIAOCSP=function(e,t){var n=this.findExt(e,"authorityInfoAccess");if(null!=n&&void 0!=n.array)for(var r=n.array,i=0;i<r.length;i++)void 0!=r[i].ocsp&&(r[i].ocsp=t)},this.updateExtAIACAIssuer=function(e,t){var n=this.findExt(e,"authorityInfoAccess");if(null!=n&&void 0!=n.array)for(var r=n.array,i=0;i<r.length;i++)void 0!=r[i].caissuer&&(r[i].caissuer=t)},this.dnarraytostr=function(e){return"/"+e.map((function(e){return function(e){return e.map((function(e){return function(e){return e.type+"="+e.value}(e).replace(/\+/,"\\+")})).join("+")}(e).replace(/\//,"\\/")})).join("/")},this.setCanonicalizedDN=function(e){var t;if(void 0!=e.str&&void 0==e.array){var n=new ee.asn1.x509.X500Name({str:e.str}).tohex();t=this.getX500NameArray(n)}else t=e.array;void 0==e.canon&&(e.canon=this.c14nRDNArray(t))},this.c14nRDNArray=function(e){for(var t=[],n=0;n<e.length;n++){for(var r=e[n],i=[],o=0;o<r.length;o++){var a=r[o],s=a.value;s=(s=(s=(s=s.replace(/^\s*/,"")).replace(/\s*$/,"")).replace(/\s+/g," ")).toLowerCase(),i.push(a.type.toLowerCase()+"="+s)}t.push(i.join("+"))}return"/"+t.join("/")},this.getInfo=function(){var e,t,n,r=function(e){for(var t="",n="    ",r="\n",i=e.array,o=0;o<i.length;o++){var a=i[o];if(void 0!=a.dn&&(t+=n+"dn: "+a.dn.str+r),void 0!=a.ip&&(t+=n+"ip: "+a.ip+r),void 0!=a.rfc822&&(t+=n+"rfc822: "+a.rfc822+r),void 0!=a.dns&&(t+=n+"dns: "+a.dns+r),void 0!=a.uri&&(t+=n+"uri: "+a.uri+r),void 0!=a.other)t+=n+"other: "+a.other.oid+"="+JSON.stringify(a.other.value).replace(/\"/g,"")+r}return t=t.replace(/\n$/,"")},i=function(e){for(var t="",n=e.array,r=0;r<n.length;r++){var i=n[r];if(t+="    policy oid: "+i.policyoid+"\n",void 0!==i.array)for(var o=0;o<i.array.length;o++){var a=i.array[o];void 0!==a.cps&&(t+="    cps: "+a.cps+"\n")}}return t},o=function(e){for(var t="",n=e.array,r=0;r<n.length;r++){var i=n[r];try{void 0!==i.dpname.full[0].uri&&(t+="    "+i.dpname.full[0].uri+"\n")}catch(o){}try{void 0!==i.dname.full[0].dn.hex&&(t+="    "+Ye.hex2dn(i.dpname.full[0].dn.hex)+"\n")}catch(o){}}return t},a=function(e){for(var t="",n=e.array,r=0;r<n.length;r++){var i=n[r];void 0!==i.caissuer&&(t+="    caissuer: "+i.caissuer+"\n"),void 0!==i.ocsp&&(t+="    ocsp: "+i.ocsp+"\n")}return t};if(e="Basic Fields\n",e+="  serial number: "+this.getSerialNumberHex()+"\n",e+="  signature algorithm: "+this.getSignatureAlgorithmField()+"\n",e+="  issuer: "+this.getIssuerString()+"\n",e+="  notBefore: "+this.getNotBefore()+"\n",e+="  notAfter: "+this.getNotAfter()+"\n",e+="  subject: "+this.getSubjectString()+"\n",e+="  subject public key info: \n",e+="    key algorithm: "+(t=this.getPublicKey()).type+"\n","RSA"===t.type&&(e+="    n="+De(t.n.toString(16)).substr(0,16)+"...\n",e+="    e="+De(t.e.toString(16))+"\n"),void 0!==(n=this.aExtInfo)&&null!==n){e+="X509v3 Extensions:\n";for(var s=0;s<n.length;s++){var u=n[s],c=ee.asn1.x509.OID.oid2name(u.oid);""===c&&(c=u.oid);var l="";if(!0===u.critical&&(l="CRITICAL"),e+="  "+c+" "+l+":\n","basicConstraints"===c){var d=this.getExtBasicConstraints();void 0===d.cA?e+="    {}\n":(e+="    cA=true",void 0!==d.pathLen&&(e+=", pathLen="+d.pathLen),e+="\n")}else{var h;if("policyMappings"==c)e+="    "+this.getExtPolicyMappings().array.map((function(e){var t=e;return t[0]+":"+t[1]})).join(", ")+"\n";else if("policyConstraints"==c)e+="    ",void 0!=(h=this.getExtPolicyConstraints()).reqexp&&(e+=" reqexp="+h.reqexp),void 0!=h.inhibit&&(e+=" inhibit="+h.inhibit),e+="\n";else if("inhibitAnyPolicy"==c)e+="    skip="+(h=this.getExtInhibitAnyPolicy()).skip+"\n";else if("keyUsage"==c)e+="    "+this.getExtKeyUsageString()+"\n";else if("subjectKeyIdentifier"==c)e+="    "+this.getExtSubjectKeyIdentifier().kid.hex+"\n";else if("authorityKeyIdentifier"==c){var f=this.getExtAuthorityKeyIdentifier();void 0!==f.kid&&(e+="    kid="+f.kid.hex+"\n")}else{if("extKeyUsage"==c)e+="    "+this.getExtExtKeyUsage().array.join(", ")+"\n";else if("subjectAltName"==c)e+=r(this.getExtSubjectAltName())+"\n";else if("cRLDistributionPoints"==c)e+=o(this.getExtCRLDistributionPoints());else if("authorityInfoAccess"==c)e+=a(this.getExtAuthorityInfoAccess());else"certificatePolicies"==c&&(e+=i(this.getExtCertificatePolicies()))}}}}return e+="signature algorithm: "+this.getSignatureAlgorithmName()+"\n",e+="signature: "+this.getSignatureValueHex().substr(0,16)+"...\n"},"string"==typeof e&&(-1!=e.indexOf("-----BEGIN")?this.readCertPEM(e):ee.lang.String.isHex(e)&&this.readCertHex(e))}W.prototype.sign=function(e,t){var n,r=(n=e,ee.crypto.Util.hashString(n,t));return this.signWithMessageHash(r,t)},W.prototype.signWithMessageHash=function(e,t){var n=G(ee.crypto.Util.getPaddedDigestInfoHex(e,t,this.n.bitLength()),16);return We(this.doPrivate(n).toString(16),this.n.bitLength())},W.prototype.signPSS=function(e,t,n){var r,i=(r=ge(e),ee.crypto.Util.hashHex(r,t));return void 0===n&&(n=-1),this.signWithMessageHashPSS(i,t,n)},W.prototype.signWithMessageHashPSS=function(e,t,n){var r,i=ve(e),o=i.length,a=this.n.bitLength()-1,s=Math.ceil(a/8),u=function(e){return ee.crypto.Util.hashHex(e,t)};if(-1===n||void 0===n)n=o;else if(-2===n)n=s-o-2;else if(n<-2)throw new Error("invalid salt length");if(s<o+n+2)throw new Error("data too long");var c="";n>0&&(c=new Array(n),(new V).nextBytes(c),c=String.fromCharCode.apply(String,c));var l=ve(u(ge("\0\0\0\0\0\0\0\0"+i+c))),h=[];for(r=0;r<s-n-o-2;r+=1)h[r]=0;var f=String.fromCharCode.apply(String,h)+"\x01"+c,p=Je(l,f.length,u),v=[];for(r=0;r<f.length;r+=1)v[r]=f.charCodeAt(r)^p.charCodeAt(r);var g=65280>>8*s-a&255;for(v[0]&=~g,r=0;r<o;r++)v.push(l.charCodeAt(r));return v.push(188),We(this.doPrivate(new d(v)).toString(16),this.n.bitLength())},W.prototype.verify=function(e,t){if(null==(t=t.toLowerCase()).match(/^[0-9a-f]+$/))return!1;var n=G(t,16),r=this.n.bitLength();if(n.bitLength()>r)return!1;var i=this.doPublic(n).toString(16);if(i.length+3!=r/4)return!1;var o=Qe(i.replace(/^1f+00/,""));if(0==o.length)return!1;var a,s=o[0];return o[1]==(a=e,ee.crypto.Util.hashString(a,s))},W.prototype.verifyWithMessageHash=function(e,t){if(t.length!=Math.ceil(this.n.bitLength()/4))return!1;var n=G(t,16);if(n.bitLength()>this.n.bitLength())return 0;var r=Qe(this.doPublic(n).toString(16).replace(/^1f+00/,""));if(0==r.length)return!1;r[0];return r[1]==e},W.prototype.verifyPSS=function(e,t,n,r){var i,o=(i=ge(e),ee.crypto.Util.hashHex(i,n));return void 0===r&&(r=-1),this.verifyWithMessageHashPSS(o,t,n,r)},W.prototype.verifyWithMessageHashPSS=function(e,t,n,r){if(t.length!=Math.ceil(this.n.bitLength()/4))return!1;var i,o=new d(t,16),a=function(e){return ee.crypto.Util.hashHex(e,n)},s=ve(e),u=s.length,c=this.n.bitLength()-1,l=Math.ceil(c/8);if(-1===r||void 0===r)r=u;else if(-2===r)r=l-u-2;else if(r<-2)throw new Error("invalid salt length");if(l<u+r+2)throw new Error("data too long");var h=this.doPublic(o).toByteArray();for(i=0;i<h.length;i+=1)h[i]&=255;for(;h.length<l;)h.unshift(0);if(188!==h[l-1])throw new Error("encoded message does not end in 0xbc");var f=(h=String.fromCharCode.apply(String,h)).substr(0,l-u-1),p=h.substr(f.length,u),v=65280>>8*l-c&255;if(0!==(f.charCodeAt(0)&v))throw new Error("bits beyond keysize not zero");var g=Je(p,f.length,a),m=[];for(i=0;i<f.length;i+=1)m[i]=f.charCodeAt(i)^g.charCodeAt(i);m[0]&=~v;var y=l-u-r-2;for(i=0;i<y;i+=1)if(0!==m[i])throw new Error("leftmost octets not zero");if(1!==m[y])throw new Error("0x01 marker not found");return p===ve(a(ge("\0\0\0\0\0\0\0\0"+s+String.fromCharCode.apply(String,m.slice(-r)))))},W.SALT_LEN_HLEN=-1,W.SALT_LEN_MAX=-2,W.SALT_LEN_RECOVER=-2,Ye.EXT_PARSER={},Ye.registExtParser=function(e,t){Ye.EXT_PARSER[e]=t},Ye.hex2dn=function(e,t){void 0===t&&(t=0);var n=new Ye;re.getTLV(e,t);return n.getX500Name(e).str},Ye.hex2rdn=function(e,t){if(void 0===t&&(t=0),"31"!==e.substr(t,2))throw new Error("malformed RDN");for(var n=new Array,r=re.getChildIdx(e,t),i=0;i<r.length;i++)n.push(Ye.hex2attrTypeValue(e,r[i]));return(n=n.map((function(e){return e.replace("+","\\+")}))).join("+")},Ye.hex2attrTypeValue=function(e,t){var n=re,r=n.getV;if(void 0===t&&(t=0),"30"!==e.substr(t,2))throw new Error("malformed attribute type and value");var i=n.getChildIdx(e,t);2!==i.length||e.substr(i[0],2);var o=r(e,i[0]),a=ee.asn1.ASN1Util.oidHexToInt(o);return ee.asn1.x509.OID.oid2atype(a)+"="+ve(r(e,i[1]))},Ye.getPublicKeyFromCertHex=function(e){var t=new Ye;return t.readCertHex(e),t.getPublicKey()},Ye.getPublicKeyFromCertPEM=function(e){var t=new Ye;return t.readCertPEM(e),t.getPublicKey()},Ye.getPublicKeyInfoPropOfCertPEM=function(e){var t,n,r=re.getVbyList,i={};return i.algparam=null,(t=new Ye).readCertPEM(e),n=t.getPublicKeyHex(),i.keyhex=r(n,0,[1],"03").substr(2),i.algoid=r(n,0,[0,0],"06"),"2a8648ce3d0201"===i.algoid&&(i.algparam=r(n,0,[0,1],"06")),i},Ye.KEYUSAGE_NAME=["digitalSignature","nonRepudiation","keyEncipherment","dataEncipherment","keyAgreement","keyCertSign","cRLSign","encipherOnly","decipherOnly"];"undefined"!=typeof ee&&ee||(ee={}),"undefined"!=typeof ee.jws&&ee.jws||(ee.jws={}),ee.jws.JWS=function(){var e=ee.jws.JWS.isSafeJSONString;this.parseJWS=function(t,n){if(void 0===this.parsedJWS||!n&&void 0===this.parsedJWS.sigvalH){var r=t.match(/^([^.]+)\.([^.]+)\.([^.]+)$/);if(null==r)throw"JWS signature is not a form of 'Head.Payload.SigValue'.";var i=r[1],o=r[2],a=r[3],s=i+"."+o;if(this.parsedJWS={},this.parsedJWS.headB64U=i,this.parsedJWS.payloadB64U=o,this.parsedJWS.sigvalB64U=a,this.parsedJWS.si=s,!n){var u=de(a),c=G(u,16);this.parsedJWS.sigvalH=u,this.parsedJWS.sigvalBI=c}var l=ne(i),d=ne(o);if(this.parsedJWS.headS=l,this.parsedJWS.payloadS=d,!e(l,this.parsedJWS,"headP"))throw"malformed JSON string for JWS Head: "+l}}},ee.jws.JWS.sign=function(e,t,n,r,i){var o,a,s,u=ee,c=u.jws.JWS,l=c.readSafeJSONString,d=c.isSafeJSONString,h=u.crypto,f=(h.ECDSA,h.Mac),p=h.Signature,v=JSON;if("string"!=typeof t&&"object"!=typeof t)throw"spHeader must be JSON string or object: "+t;if("object"==typeof t&&(a=t,o=v.stringify(a)),"string"==typeof t){if(!d(o=t))throw"JWS Head is not safe JSON string: "+o;a=l(o)}if(s=n,"object"==typeof n&&(s=v.stringify(n)),""!=e&&null!=e||void 0===a.alg||(e=a.alg),""!=e&&null!=e&&void 0===a.alg&&(a.alg=e,o=v.stringify(a)),e!==a.alg)throw"alg and sHeader.alg doesn't match: "+e+"!="+a.alg;var g=null;if(void 0===c.jwsalg2sigalg[e])throw"unsupported alg name: "+e;g=c.jwsalg2sigalg[e];var m=te(o)+"."+te(s),y="";if("Hmac"==g.substr(0,4)){if(void 0===r)throw"mac key shall be specified for HS* alg";var b=new f({alg:g,prov:"cryptojs",pass:r});b.updateString(m),y=b.doFinal()}else if(-1!=g.indexOf("withECDSA")){(S=new p({alg:g})).init(r,i),S.updateString(m);var w=S.sign();y=ee.crypto.ECDSA.asn1SigToConcatSig(w)}else{var S;if("none"!=g)(S=new p({alg:g})).init(r,i),S.updateString(m),y=S.sign()}return m+"."+le(y)},ee.jws.JWS.verify=function(e,t,n){var r,i=ee,o=i.jws.JWS,a=o.readSafeJSONString,s=i.crypto,u=s.ECDSA,c=s.Mac,l=s.Signature;if(r=W,!Ze(e))return!1;var d=e.split(".");if(3!==d.length)return!1;var h=d[0]+"."+d[1],f=de(d[2]),p=a(ne(d[0])),v=null,g=null;if(void 0===p.alg)throw"algorithm not specified in header";if((g=(v=p.alg).substr(0,2),null!=n&&"[object Array]"===Object.prototype.toString.call(n)&&n.length>0)&&-1==(":"+n.join(":")+":").indexOf(":"+v+":"))throw"algorithm '"+v+"' not accepted in the list";if("none"!=v&&null===t)throw"key shall be specified to verify.";if("string"==typeof t&&-1!=t.indexOf("-----BEGIN ")&&(t=Ke.getKey(t)),("RS"==g||"PS"==g)&&!(t instanceof r))throw"key shall be a RSAKey obj for RS* and PS* algs";if("ES"==g&&!(t instanceof u))throw"key shall be a ECDSA obj for ES* algs";var m=null;if(void 0===o.jwsalg2sigalg[p.alg])throw"unsupported alg name: "+v;if("none"==(m=o.jwsalg2sigalg[v]))throw"not supported";if("Hmac"==m.substr(0,4)){if(void 0===t)throw"hexadecimal key shall be specified for HMAC";var y=new c({alg:m,pass:t});return y.updateString(h),f==y.doFinal()}if(-1!=m.indexOf("withECDSA")){var b,w=null;try{w=u.concatSigToASN1Sig(f)}catch(S){return!1}return(b=new l({alg:m})).init(t),b.updateString(h),b.verify(w)}return(b=new l({alg:m})).init(t),b.updateString(h),b.verify(f)},ee.jws.JWS.parse=function(e){var t,n,r,i=e.split("."),o={};if(2!=i.length&&3!=i.length)throw"malformed sJWS: wrong number of '.' splitted elements";return t=i[0],n=i[1],3==i.length&&(r=i[2]),o.headerObj=ee.jws.JWS.readSafeJSONString(ne(t)),o.payloadObj=ee.jws.JWS.readSafeJSONString(ne(n)),o.headerPP=JSON.stringify(o.headerObj,null,"  "),null==o.payloadObj?o.payloadPP=ne(n):o.payloadPP=JSON.stringify(o.payloadObj,null,"  "),void 0!==r&&(o.sigHex=de(r)),o},ee.jws.JWS.verifyJWT=function(e,t,n){var r=ee.jws,i=r.JWS,o=i.readSafeJSONString,a=i.inArray,s=i.includedArray;if(!Ze(e))return!1;var u=e.split(".");if(3!=u.length)return!1;var c=u[0],l=u[1],d=(de(u[2]),o(ne(c))),h=o(ne(l));if(void 0===d.alg)return!1;if(void 0===n.alg)throw"acceptField.alg shall be specified";if(!a(d.alg,n.alg))return!1;if(void 0!==h.iss&&"object"===typeof n.iss&&!a(h.iss,n.iss))return!1;if(void 0!==h.sub&&"object"===typeof n.sub&&!a(h.sub,n.sub))return!1;if(void 0!==h.aud&&"object"===typeof n.aud)if("string"==typeof h.aud){if(!a(h.aud,n.aud))return!1}else if("object"==typeof h.aud&&!s(h.aud,n.aud))return!1;var f=r.IntDate.getNow();return void 0!==n.verifyAt&&"number"===typeof n.verifyAt&&(f=n.verifyAt),void 0!==n.gracePeriod&&"number"===typeof n.gracePeriod||(n.gracePeriod=0),!(void 0!==h.exp&&"number"==typeof h.exp&&h.exp+n.gracePeriod<f)&&(!(void 0!==h.nbf&&"number"==typeof h.nbf&&f<h.nbf-n.gracePeriod)&&(!(void 0!==h.iat&&"number"==typeof h.iat&&f<h.iat-n.gracePeriod)&&((void 0===h.jti||void 0===n.jti||h.jti===n.jti)&&!!i.verify(e,t,n.alg))))},ee.jws.JWS.includedArray=function(e,t){var n=ee.jws.JWS.inArray;if(null===e)return!1;if("object"!==typeof e)return!1;if("number"!==typeof e.length)return!1;for(var r=0;r<e.length;r++)if(!n(e[r],t))return!1;return!0},ee.jws.JWS.inArray=function(e,t){if(null===t)return!1;if("object"!==typeof t)return!1;if("number"!==typeof t.length)return!1;for(var n=0;n<t.length;n++)if(t[n]==e)return!0;return!1},ee.jws.JWS.jwsalg2sigalg={HS256:"HmacSHA256",HS384:"HmacSHA384",HS512:"HmacSHA512",RS256:"SHA256withRSA",RS384:"SHA384withRSA",RS512:"SHA512withRSA",ES256:"SHA256withECDSA",ES384:"SHA384withECDSA",ES512:"SHA512withECDSA",PS256:"SHA256withRSAandMGF1",PS384:"SHA384withRSAandMGF1",PS512:"SHA512withRSAandMGF1",none:"none"},ee.jws.JWS.isSafeJSONString=function(e,t,n){var r=null;try{return"object"!=typeof(r=$(e))||r.constructor===Array?0:(t&&(t[n]=r),1)}catch(i){return 0}},ee.jws.JWS.readSafeJSONString=function(e){var t=null;try{return"object"!=typeof(t=$(e))||t.constructor===Array?null:t}catch(n){return null}},ee.jws.JWS.getEncodedSignatureValueFromJWS=function(e){var t=e.match(/^[^.]+\.[^.]+\.([^.]+)$/);if(null==t)throw"JWS signature is not a form of 'Head.Payload.SigValue'.";return t[1]},ee.jws.JWS.getJWKthumbprint=function(e){if("RSA"!==e.kty&&"EC"!==e.kty&&"oct"!==e.kty)throw"unsupported algorithm for JWK Thumprint";var t="{";if("RSA"===e.kty){if("string"!=typeof e.n||"string"!=typeof e.e)throw"wrong n and e value for RSA key";t+='"e":"'+e.e+'",',t+='"kty":"'+e.kty+'",',t+='"n":"'+e.n+'"}'}else if("EC"===e.kty){if("string"!=typeof e.crv||"string"!=typeof e.x||"string"!=typeof e.y)throw"wrong crv, x and y value for EC key";t+='"crv":"'+e.crv+'",',t+='"kty":"'+e.kty+'",',t+='"x":"'+e.x+'",',t+='"y":"'+e.y+'"}'}else if("oct"===e.kty){if("string"!=typeof e.k)throw"wrong k value for oct(symmetric) key";t+='"kty":"'+e.kty+'",',t+='"k":"'+e.k+'"}'}var n=ge(t);return le(ee.crypto.Util.hashHex(n,"sha256"))},ee.jws.IntDate={},ee.jws.IntDate.get=function(e){var t=ee.jws.IntDate,n=t.getNow,r=t.getZulu;if("now"==e)return n();if("now + 1hour"==e)return n()+3600;if("now + 1day"==e)return n()+86400;if("now + 1month"==e)return n()+2592e3;if("now + 1year"==e)return n()+31536e3;if(e.match(/Z$/))return r(e);if(e.match(/^[0-9]+$/))return parseInt(e);throw"unsupported format: "+e},ee.jws.IntDate.getZulu=function(e){return Ce(e)},ee.jws.IntDate.getNow=function(){return~~(new Date/1e3)},ee.jws.IntDate.intDate2UTCString=function(e){return new Date(1e3*e).toUTCString()},ee.jws.IntDate.intDate2Zulu=function(e){var t=new Date(1e3*e);return("0000"+t.getUTCFullYear()).slice(-4)+("00"+(t.getUTCMonth()+1)).slice(-2)+("00"+t.getUTCDate()).slice(-2)+("00"+t.getUTCHours()).slice(-2)+("00"+t.getUTCMinutes()).slice(-2)+("00"+t.getUTCSeconds()).slice(-2)+"Z"},"undefined"!=typeof ee&&ee||(ee={}),"undefined"!=typeof ee.jws&&ee.jws||(ee.jws={}),ee.jws.JWSJS=function(){var e=ee.jws.JWS,t=e.readSafeJSONString;this.aHeader=[],this.sPayload="",this.aSignature=[],this.init=function(){this.aHeader=[],this.sPayload=void 0,this.aSignature=[]},this.initWithJWS=function(e){this.init();var t=e.split(".");if(3!=t.length)throw"malformed input JWS";this.aHeader.push(t[0]),this.sPayload=t[1],this.aSignature.push(t[2])},this.addSignature=function(e,t,n,r){if(void 0===this.sPayload||null===this.sPayload)throw"there's no JSON-JS signature to add.";var i=this.aHeader.length;if(this.aHeader.length!=this.aSignature.length)throw"aHeader.length != aSignature.length";try{var o=ee.jws.JWS.sign(e,t,this.sPayload,n,r).split(".");o[0],o[2];this.aHeader.push(o[0]),this.aSignature.push(o[2])}catch(a){throw this.aHeader.length>i&&this.aHeader.pop(),this.aSignature.length>i&&this.aSignature.pop(),"addSignature failed: "+a}},this.verifyAll=function(e){if(this.aHeader.length!==e.length||this.aSignature.length!==e.length)return!1;for(var t=0;t<e.length;t++){var n=e[t];if(2!==n.length)return!1;if(!1===this.verifyNth(t,n[0],n[1]))return!1}return!0},this.verifyNth=function(t,n,r){if(this.aHeader.length<=t||this.aSignature.length<=t)return!1;var i=this.aHeader[t],o=this.aSignature[t],a=i+"."+this.sPayload+"."+o,s=!1;try{s=e.verify(a,n,r)}catch(u){return!1}return s},this.readJWSJS=function(e){if("string"===typeof e){var n=t(e);if(null==n)throw"argument is not safe JSON object string";this.aHeader=n.headers,this.sPayload=n.payload,this.aSignature=n.signatures}else try{if(!(e.headers.length>0))throw"malformed header";if(this.aHeader=e.headers,"string"!==typeof e.payload)throw"malformed signatures";if(this.sPayload=e.payload,!(e.signatures.length>0))throw"malformed signatures";this.aSignature=e.signatures}catch(r){throw"malformed JWS-JS JSON object: "+r}},this.getJSON=function(){return{headers:this.aHeader,payload:this.sPayload,signatures:this.aSignature}},this.isEmpty=function(){return 0==this.aHeader.length?1:0}},t.SecureRandom=V,t.rng_seed_time=B,t.BigInteger=d,t.RSAKey=W,t.ECDSA=ee.crypto.ECDSA,t.DSA=ee.crypto.DSA,t.Signature=ee.crypto.Signature,t.MessageDigest=ee.crypto.MessageDigest,t.Mac=ee.crypto.Mac,t.Cipher=ee.crypto.Cipher,t.KEYUTIL=Ke,t.ASN1HEX=re,t.X509=Ye,t.X509CRL=function(e){var t=ee.lang.String.isHex,n=re,r=n.getV,i=n.getTLV,o=n.getVbyList,a=n.getTLVbyList,s=n.getTLVbyListEx,u=n.getIdxbyList,c=n.getIdxbyListEx,l=n.getChildIdx,d=new Ye;this.hex=null,this.posSigAlg=null,this.posRevCert=null,this.parsed=null,this._setPos=function(){var e=u(this.hex,0,[0,0]),t=this.hex.substr(e,2);if("02"==t)this.posSigAlg=1;else{if("30"!=t)throw new Error("malformed 1st item of TBSCertList: "+t);this.posSigAlg=0}var n,r=u(this.hex,0,[0,this.posSigAlg+3]),i=this.hex.substr(r,2);if("17"==i||"18"==i)n=u(this.hex,0,[0,this.posSigAlg+4]),this.posRevCert=null,-1!=n&&"30"==this.hex.substr(n,2)&&(this.posRevCert=this.posSigAlg+4);else if("30"==i)this.posRevCert=this.posSigAlg+3;else{if("a0"!=i)throw new Error("malformed nextUpdate or revCert tag: "+i);this.posRevCert=null}},this.getVersion=function(){return 0==this.posSigAlg?null:parseInt(o(this.hex,0,[0,0],"02"),16)+1},this.getSignatureAlgorithmField=function(){var e=a(this.hex,0,[0,this.posSigAlg],"30");return d.getAlgorithmIdentifierName(e)},this.getIssuer=function(){return d.getX500Name(this.getIssuerHex())},this.getIssuerHex=function(){return a(this.hex,0,[0,this.posSigAlg+1],"30")},this.getThisUpdate=function(){var e=o(this.hex,0,[0,this.posSigAlg+2]);return result=ve(e)},this.getNextUpdate=function(){var e=u(this.hex,0,[0,this.posSigAlg+3]),t=this.hex.substr(e,2);return"17"!=t&&"18"!=t?null:ve(r(this.hex,e))},this.getRevCertArray=function(){if(null==this.posRevCert)return null;for(var e=[],t=u(this.hex,0,[0,this.posRevCert]),n=l(this.hex,t),r=0;r<n.length;r++){var o=i(this.hex,n[r]);e.push(this.getRevCert(o))}return e},this.getRevCert=function(e){var t={},n=l(e,0);return t.sn={hex:o(e,0,[0],"02")},t.date=ve(o(e,0,[1])),3==n.length&&(t.ext=d.getExtParamArray(a(e,0,[2]))),t},this.findRevCert=function(e){var t=new Ye(e).getSerialNumberHex();return this.findRevCertBySN(t)},this.findRevCertBySN=function(e){if(null==this.parsed&&this.getParam(),null==this.parsed.revcert)return null;for(var t=this.parsed.revcert,n=0;n<t.length;n++)if(e==t[n].sn.hex)return t[n];return null},this.getSignatureValueHex=function(){return o(this.hex,0,[2],"03",!0)},this.verifySignature=function(e){var t=this.getSignatureAlgorithmField(),n=this.getSignatureValueHex(),r=a(this.hex,0,[0],"30"),i=new ee.crypto.Signature({alg:t});return i.init(e),i.updateHex(r),i.verify(n)},this.getParam=function(e){var t={},n=this.getVersion();null!=n&&(t.version=n),t.sigalg=this.getSignatureAlgorithmField(),t.issuer=this.getIssuer(),t.thisupdate=this.getThisUpdate();var r=this.getNextUpdate();null!=r&&(t.nextupdate=r);var i=this.getRevCertArray();if(null!=i&&(t.revcert=i),-1!=c(this.hex,0,[0,"[0]"])){var o=s(this.hex,0,[0,"[0]",0]);t.ext=d.getExtParamArray(o)}return t.sighex=this.getSignatureValueHex(),this.parsed=t,"object"==typeof e&&(1==e.tbshex&&(t.tbshex=a(this.hex,0,[0])),1==e.nodnarray&&delete t.issuer.array),t},"string"==typeof e&&(t(e)?this.hex=e:e.match(/-----BEGIN X509 CRL/)&&(this.hex=Se(e)),this._setPos())},t.CryptoJS=i,t.b64tohex=c,t.b64toBA=l,t.ECFieldElementFp=Q,t.ECPointFp=Y,t.ECCurveFp=X,t.stoBA=ie,t.BAtos=oe,t.BAtohex=ae,t.stohex=se,t.stob64=function(e){return u(se(e))},t.stob64u=function(e){return ue(u(se(e)))},t.b64utos=function(e){return oe(l(ce(e)))},t.b64tob64u=ue,t.b64utob64=ce,t.hex2b64=u,t.hextob64u=le,t.b64utohex=de,t.utf8tob64u=te,t.b64utoutf8=ne,t.utf8tob64=function(e){return u(Ee(Me(e)))},t.b64toutf8=function(e){return decodeURIComponent(Te(c(e)))},t.utf8tohex=he,t.hextoutf8=fe,t.hextorstr=ve,t.rstrtohex=ge,t.hextob64=me,t.hextob64nl=function(e){return ye(me(e),64)},t.b64nltohex=be,t.hextopem=we,t.pemtohex=Se,t.hextoArrayBuffer=function(e){if(e.length%2!=0)throw"input is not even length";if(null==e.match(/^[0-9A-Fa-f]+$/))throw"input is not hexadecimal";for(var t=new ArrayBuffer(e.length/2),n=new DataView(t),r=0;r<e.length/2;r++)n.setUint8(r,parseInt(e.substr(2*r,2),16));return t},t.ArrayBuffertohex=function(e){for(var t="",n=new DataView(e),r=0;r<e.byteLength;r++)t+=("00"+n.getUint8(r).toString(16)).slice(-2);return t},t.zulutomsec=ke,t.msectozulu=function(e){var t=new Date(e),n=("0000"+t.getUTCFullYear()).slice(-4),r=("00"+(t.getUTCMonth()+1)).slice(-2),i=("00"+t.getUTCDate()).slice(-2),o=("00"+t.getUTCHours()).slice(-2),a=("00"+t.getUTCMinutes()).slice(-2),s=("00"+t.getUTCSeconds()).slice(-2),u=("000"+t.getUTCMilliseconds()).slice(-3);return n+r+i+o+a+s+(u=""!=(u=u.replace(/0+$/,""))?"."+u:u)+"Z"},t.zulutosec=Ce,t.zulutodate=function(e){return new Date(ke(e))},t.datetozulu=function(e,t,n){var r,i=e.getUTCFullYear();if(t){if(i<1950||2049<i)throw"not proper year for UTCTime: "+i;r=(""+i).slice(-2)}else r=("000"+i).slice(-4);if(r+=("0"+(e.getUTCMonth()+1)).slice(-2),r+=("0"+e.getUTCDate()).slice(-2),r+=("0"+e.getUTCHours()).slice(-2),r+=("0"+e.getUTCMinutes()).slice(-2),r+=("0"+e.getUTCSeconds()).slice(-2),n){var o=e.getUTCMilliseconds();0!==o&&(r+="."+(o=(o=("00"+o).slice(-3)).replace(/0+$/g,"")))}return r+="Z"},t.uricmptohex=Ee,t.hextouricmp=Te,t.ipv6tohex=Ie,t.hextoipv6=Ae,t.hextoip=Re,t.iptohex=Pe,t.ucs2hextoutf8=Oe,t.encodeURIComponentAll=Me,t.newline_toUnix=function(e){return e=e.replace(/\r\n/gm,"\n")},t.newline_toDos=function(e){return e=(e=e.replace(/\r\n/gm,"\n")).replace(/\n/gm,"\r\n")},t.hextoposhex=De,t.intarystrtohex=function(e){e=(e=(e=e.replace(/^\s*\[\s*/,"")).replace(/\s*\]\s*$/,"")).replace(/\s*/g,"");try{return e.split(/,/).map((function(e,t,n){var r=parseInt(e);if(r<0||255<r)throw"integer not in range 0-255";return("00"+r.toString(16)).slice(-2)})).join("")}catch(t){throw"malformed integer array string: "+t}},t.strdiffidx=function(e,t){var n=e.length;e.length>t.length&&(n=t.length);for(var r=0;r<n;r++)if(e.charCodeAt(r)!=t.charCodeAt(r))return r;return e.length!=t.length?n:-1},t.oidtohex=Le,t.hextooid=Be,t.strpad=qe,t.bitstrtoint=je,t.inttobitstr=Ue,t.bitstrtobinstr=He,t.binstrtobitstr=function(e){if("string"!=typeof e)return null;if(null==e.match(/^[01]+$/))return null;try{return Ue(parseInt(e,2))}catch(t){return null}},t.isBase64URLDot=Ze,t.namearraytobinstr=ze,t.extendClass=Ge,t.foldnl=ye,t.b64topem=function(e,t){return"-----BEGIN "+t+"-----\r\n"+ye(e,64)+"\r\n-----END "+t+"-----\r\n"},t.pemtob64=function(e){return-1==e.indexOf("-----BEGIN ")||-1==e.indexOf("-----END ")?null:(e=(e=(e=e.replace(/^[\s\S]*?-----BEGIN [^-]+-----/m,"")).replace(/-----END [\s\S]+$/m,"")).replace(/\s+/g,"")).match(/^[0-9a-zA-Z+/=]+$/)?e:null},t.timeogen=xe,t.aryval=Ve,t.KJUR=ee,t.crypto=ee.crypto,t.asn1=ee.asn1,t.jws=ee.jws,t.lang=ee.lang,t.VERSION="10.8.6",t.VERSION_FULL="jsrsasign(all) 10.8.6 (2023-04-26) (c) 2010-2023 Kenji Urushima | kjur.github.io/jsrsasign/license"},50908:function(e,t,n){var r=n(68136)(n(97009),"DataView");e.exports=r},29676:function(e,t,n){var r=n(85403),i=n(62747),o=n(16037),a=n(94154),s=n(77728);function u(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}u.prototype.clear=r,u.prototype.delete=i,u.prototype.get=o,u.prototype.has=a,u.prototype.set=s,e.exports=u},38384:function(e,t,n){var r=n(43894),i=n(8699),o=n(64957),a=n(87184),s=n(87109);function u(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}u.prototype.clear=r,u.prototype.delete=i,u.prototype.get=o,u.prototype.has=a,u.prototype.set=s,e.exports=u},95797:function(e,t,n){var r=n(68136)(n(97009),"Map");e.exports=r},78059:function(e,t,n){var r=n(34086),i=n(9255),o=n(29186),a=n(13423),s=n(73739);function u(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}u.prototype.clear=r,u.prototype.delete=i,u.prototype.get=o,u.prototype.has=a,u.prototype.set=s,e.exports=u},78319:function(e,t,n){var r=n(68136)(n(97009),"Promise");e.exports=r},23924:function(e,t,n){var r=n(68136)(n(97009),"Set");e.exports=r},22854:function(e,t,n){var r=n(38384),i=n(20511),o=n(50835),a=n(90707),s=n(18832),u=n(35077);function c(e){var t=this.__data__=new r(e);this.size=t.size}c.prototype.clear=i,c.prototype.delete=o,c.prototype.get=a,c.prototype.has=s,c.prototype.set=u,e.exports=c},87197:function(e,t,n){var r=n(97009).Symbol;e.exports=r},46219:function(e,t,n){var r=n(97009).Uint8Array;e.exports=r},7091:function(e,t,n){var r=n(68136)(n(97009),"WeakMap");e.exports=r},13665:function(e){e.exports=function(e,t,n){switch(n.length){case 0:return e.call(t);case 1:return e.call(t,n[0]);case 2:return e.call(t,n[0],n[1]);case 3:return e.call(t,n[0],n[1],n[2])}return e.apply(t,n)}},4550:function(e){e.exports=function(e,t){for(var n=-1,r=null==e?0:e.length;++n<r&&!1!==t(e[n],n,e););return e}},84903:function(e){e.exports=function(e,t){for(var n=-1,r=null==e?0:e.length,i=0,o=[];++n<r;){var a=e[n];t(a,n,e)&&(o[i++]=a)}return o}},47538:function(e,t,n){var r=n(86478),i=n(34963),o=n(93629),a=n(5174),s=n(26800),u=n(19102),c=Object.prototype.hasOwnProperty;e.exports=function(e,t){var n=o(e),l=!n&&i(e),d=!n&&!l&&a(e),h=!n&&!l&&!d&&u(e),f=n||l||d||h,p=f?r(e.length,String):[],v=p.length;for(var g in e)!t&&!c.call(e,g)||f&&("length"==g||d&&("offset"==g||"parent"==g)||h&&("buffer"==g||"byteLength"==g||"byteOffset"==g)||s(g,v))||p.push(g);return p}},41705:function(e){e.exports=function(e,t){for(var n=-1,r=t.length,i=e.length;++n<r;)e[i+n]=t[n];return e}},28002:function(e,t,n){var r=n(32526),i=n(29231);e.exports=function(e,t,n){(void 0!==n&&!i(e[t],n)||void 0===n&&!(t in e))&&r(e,t,n)}},18463:function(e,t,n){var r=n(32526),i=n(29231),o=Object.prototype.hasOwnProperty;e.exports=function(e,t,n){var a=e[t];o.call(e,t)&&i(a,n)&&(void 0!==n||t in e)||r(e,t,n)}},27112:function(e,t,n){var r=n(29231);e.exports=function(e,t){for(var n=e.length;n--;)if(r(e[n][0],t))return n;return-1}},11855:function(e,t,n){var r=n(64503),i=n(12742);e.exports=function(e,t){return e&&r(t,i(t),e)}},95076:function(e,t,n){var r=n(64503),i=n(73961);e.exports=function(e,t){return e&&r(t,i(t),e)}},32526:function(e,t,n){var r=n(48528);e.exports=function(e,t,n){"__proto__"==t&&r?r(e,t,{configurable:!0,enumerable:!0,value:n,writable:!0}):e[t]=n}},31905:function(e,t,n){var r=n(22854),i=n(4550),o=n(18463),a=n(11855),s=n(95076),u=n(94523),c=n(10291),l=n(52455),d=n(57636),h=n(38248),f=n(55341),p=n(88383),v=n(39243),g=n(39759),m=n(40548),y=n(93629),b=n(5174),w=n(60103),S=n(8092),k=n(36995),C=n(12742),x=n(73961),E="[object Arguments]",T="[object Function]",I="[object Object]",A={};A[E]=A["[object Array]"]=A["[object ArrayBuffer]"]=A["[object DataView]"]=A["[object Boolean]"]=A["[object Date]"]=A["[object Float32Array]"]=A["[object Float64Array]"]=A["[object Int8Array]"]=A["[object Int16Array]"]=A["[object Int32Array]"]=A["[object Map]"]=A["[object Number]"]=A[I]=A["[object RegExp]"]=A["[object Set]"]=A["[object String]"]=A["[object Symbol]"]=A["[object Uint8Array]"]=A["[object Uint8ClampedArray]"]=A["[object Uint16Array]"]=A["[object Uint32Array]"]=!0,A["[object Error]"]=A[T]=A["[object WeakMap]"]=!1,e.exports=function e(t,n,R,_,P,N){var O,M=1&n,F=2&n,Z=4&n;if(R&&(O=P?R(t,_,P,N):R(t)),void 0!==O)return O;if(!S(t))return t;var D=y(t);if(D){if(O=v(t),!M)return c(t,O)}else{var L=p(t),B=L==T||"[object GeneratorFunction]"==L;if(b(t))return u(t,M);if(L==I||L==E||B&&!P){if(O=F||B?{}:m(t),!M)return F?d(t,s(O,t)):l(t,a(O,t))}else{if(!A[L])return P?t:{};O=g(t,L,M)}}N||(N=new r);var q=N.get(t);if(q)return q;N.set(t,O),k(t)?t.forEach((function(r){O.add(e(r,n,R,r,t,N))})):w(t)&&t.forEach((function(r,i){O.set(i,e(r,n,R,i,t,N))}));var j=D?void 0:(Z?F?f:h:F?x:C)(t);return i(j||t,(function(r,i){j&&(r=t[i=r]),o(O,i,e(r,n,R,i,t,N))})),O}},65763:function(e,t,n){var r=n(8092),i=Object.create,o=function(){function e(){}return function(t){if(!r(t))return{};if(i)return i(t);e.prototype=t;var n=new e;return e.prototype=void 0,n}}();e.exports=o},85099:function(e,t,n){var r=n(30372)();e.exports=r},61986:function(e,t,n){var r=n(41705),i=n(93629);e.exports=function(e,t,n){var o=t(e);return i(e)?o:r(o,n(e))}},39066:function(e,t,n){var r=n(87197),i=n(81587),o=n(43581),a=r?r.toStringTag:void 0;e.exports=function(e){return null==e?void 0===e?"[object Undefined]":"[object Null]":a&&a in Object(e)?i(e):o(e)}},4906:function(e,t,n){var r=n(39066),i=n(43141);e.exports=function(e){return i(e)&&"[object Arguments]"==r(e)}},53085:function(e,t,n){var r=n(88383),i=n(43141);e.exports=function(e){return i(e)&&"[object Map]"==r(e)}},26703:function(e,t,n){var r=n(74786),i=n(257),o=n(8092),a=n(27907),s=/^\[object .+?Constructor\]$/,u=Function.prototype,c=Object.prototype,l=u.toString,d=c.hasOwnProperty,h=RegExp("^"+l.call(d).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");e.exports=function(e){return!(!o(e)||i(e))&&(r(e)?h:s).test(a(e))}},48680:function(e,t,n){var r=n(88383),i=n(43141);e.exports=function(e){return i(e)&&"[object Set]"==r(e)}},68150:function(e,t,n){var r=n(39066),i=n(24635),o=n(43141),a={};a["[object Float32Array]"]=a["[object Float64Array]"]=a["[object Int8Array]"]=a["[object Int16Array]"]=a["[object Int32Array]"]=a["[object Uint8Array]"]=a["[object Uint8ClampedArray]"]=a["[object Uint16Array]"]=a["[object Uint32Array]"]=!0,a["[object Arguments]"]=a["[object Array]"]=a["[object ArrayBuffer]"]=a["[object Boolean]"]=a["[object DataView]"]=a["[object Date]"]=a["[object Error]"]=a["[object Function]"]=a["[object Map]"]=a["[object Number]"]=a["[object Object]"]=a["[object RegExp]"]=a["[object Set]"]=a["[object String]"]=a["[object WeakMap]"]=!1,e.exports=function(e){return o(e)&&i(e.length)&&!!a[r(e)]}},43654:function(e,t,n){var r=n(62936),i=n(75964),o=Object.prototype.hasOwnProperty;e.exports=function(e){if(!r(e))return i(e);var t=[];for(var n in Object(e))o.call(e,n)&&"constructor"!=n&&t.push(n);return t}},8664:function(e,t,n){var r=n(8092),i=n(62936),o=n(4221),a=Object.prototype.hasOwnProperty;e.exports=function(e){if(!r(e))return o(e);var t=i(e),n=[];for(var s in e)("constructor"!=s||!t&&a.call(e,s))&&n.push(s);return n}},64173:function(e,t,n){var r=n(22854),i=n(28002),o=n(85099),a=n(49216),s=n(8092),u=n(73961),c=n(85906);e.exports=function e(t,n,l,d,h){t!==n&&o(n,(function(o,u){if(h||(h=new r),s(o))a(t,n,u,l,e,d,h);else{var f=d?d(c(t,u),o,u+"",t,n,h):void 0;void 0===f&&(f=o),i(t,u,f)}}),u)}},49216:function(e,t,n){var r=n(28002),i=n(94523),o=n(40613),a=n(10291),s=n(40548),u=n(34963),c=n(93629),l=n(56279),d=n(5174),h=n(74786),f=n(8092),p=n(93977),v=n(19102),g=n(85906),m=n(6576);e.exports=function(e,t,n,y,b,w,S){var k=g(e,n),C=g(t,n),x=S.get(C);if(x)r(e,n,x);else{var E=w?w(k,C,n+"",e,t,S):void 0,T=void 0===E;if(T){var I=c(C),A=!I&&d(C),R=!I&&!A&&v(C);E=C,I||A||R?c(k)?E=k:l(k)?E=a(k):A?(T=!1,E=i(C,!0)):R?(T=!1,E=o(C,!0)):E=[]:p(C)||u(C)?(E=k,u(k)?E=m(k):f(k)&&!h(k)||(E=s(C))):T=!1}T&&(S.set(C,E),b(E,C,y,w,S),S.delete(C)),r(e,n,E)}}},58794:function(e,t,n){var r=n(2100),i=n(64262),o=n(79156);e.exports=function(e,t){return o(i(e,t,r),e+"")}},7532:function(e,t,n){var r=n(71547),i=n(48528),o=n(2100),a=i?function(e,t){return i(e,"toString",{configurable:!0,enumerable:!1,value:r(t),writable:!0})}:o;e.exports=a},86478:function(e){e.exports=function(e,t){for(var n=-1,r=Array(e);++n<e;)r[n]=t(n);return r}},16194:function(e){e.exports=function(e){return function(t){return e(t)}}},7010:function(e,t,n){var r=n(46219);e.exports=function(e){var t=new e.constructor(e.byteLength);return new r(t).set(new r(e)),t}},94523:function(e,t,n){e=n.nmd(e);var r=n(97009),i=t&&!t.nodeType&&t,o=i&&e&&!e.nodeType&&e,a=o&&o.exports===i?r.Buffer:void 0,s=a?a.allocUnsafe:void 0;e.exports=function(e,t){if(t)return e.slice();var n=e.length,r=s?s(n):new e.constructor(n);return e.copy(r),r}},61022:function(e,t,n){var r=n(7010);e.exports=function(e,t){var n=t?r(e.buffer):e.buffer;return new e.constructor(n,e.byteOffset,e.byteLength)}},18503:function(e){var t=/\w*$/;e.exports=function(e){var n=new e.constructor(e.source,t.exec(e));return n.lastIndex=e.lastIndex,n}},64720:function(e,t,n){var r=n(87197),i=r?r.prototype:void 0,o=i?i.valueOf:void 0;e.exports=function(e){return o?Object(o.call(e)):{}}},40613:function(e,t,n){var r=n(7010);e.exports=function(e,t){var n=t?r(e.buffer):e.buffer;return new e.constructor(n,e.byteOffset,e.length)}},10291:function(e){e.exports=function(e,t){var n=-1,r=e.length;for(t||(t=Array(r));++n<r;)t[n]=e[n];return t}},64503:function(e,t,n){var r=n(18463),i=n(32526);e.exports=function(e,t,n,o){var a=!n;n||(n={});for(var s=-1,u=t.length;++s<u;){var c=t[s],l=o?o(n[c],e[c],c,n,e):void 0;void 0===l&&(l=e[c]),a?i(n,c,l):r(n,c,l)}return n}},52455:function(e,t,n){var r=n(64503),i=n(65918);e.exports=function(e,t){return r(e,i(e),t)}},57636:function(e,t,n){var r=n(64503),i=n(38487);e.exports=function(e,t){return r(e,i(e),t)}},65525:function(e,t,n){var r=n(97009)["__core-js_shared__"];e.exports=r},39934:function(e,t,n){var r=n(58794),i=n(3195);e.exports=function(e){return r((function(t,n){var r=-1,o=n.length,a=o>1?n[o-1]:void 0,s=o>2?n[2]:void 0;for(a=e.length>3&&"function"==typeof a?(o--,a):void 0,s&&i(n[0],n[1],s)&&(a=o<3?void 0:a,o=1),t=Object(t);++r<o;){var u=n[r];u&&e(t,u,r,a)}return t}))}},30372:function(e){e.exports=function(e){return function(t,n,r){for(var i=-1,o=Object(t),a=r(t),s=a.length;s--;){var u=a[e?s:++i];if(!1===n(o[u],u,o))break}return t}}},48528:function(e,t,n){var r=n(68136),i=function(){try{var e=r(Object,"defineProperty");return e({},"",{}),e}catch(t){}}();e.exports=i},31032:function(e,t,n){var r="object"==typeof n.g&&n.g&&n.g.Object===Object&&n.g;e.exports=r},38248:function(e,t,n){var r=n(61986),i=n(65918),o=n(12742);e.exports=function(e){return r(e,o,i)}},55341:function(e,t,n){var r=n(61986),i=n(38487),o=n(73961);e.exports=function(e){return r(e,o,i)}},32799:function(e,t,n){var r=n(55964);e.exports=function(e,t){var n=e.__data__;return r(t)?n["string"==typeof t?"string":"hash"]:n.map}},68136:function(e,t,n){var r=n(26703),i=n(30040);e.exports=function(e,t){var n=i(e,t);return r(n)?n:void 0}},31137:function(e,t,n){var r=n(12709)(Object.getPrototypeOf,Object);e.exports=r},81587:function(e,t,n){var r=n(87197),i=Object.prototype,o=i.hasOwnProperty,a=i.toString,s=r?r.toStringTag:void 0;e.exports=function(e){var t=o.call(e,s),n=e[s];try{e[s]=void 0;var r=!0}catch(u){}var i=a.call(e);return r&&(t?e[s]=n:delete e[s]),i}},65918:function(e,t,n){var r=n(84903),i=n(68174),o=Object.prototype.propertyIsEnumerable,a=Object.getOwnPropertySymbols,s=a?function(e){return null==e?[]:(e=Object(e),r(a(e),(function(t){return o.call(e,t)})))}:i;e.exports=s},38487:function(e,t,n){var r=n(41705),i=n(31137),o=n(65918),a=n(68174),s=Object.getOwnPropertySymbols?function(e){for(var t=[];e;)r(t,o(e)),e=i(e);return t}:a;e.exports=s},88383:function(e,t,n){var r=n(50908),i=n(95797),o=n(78319),a=n(23924),s=n(7091),u=n(39066),c=n(27907),l="[object Map]",d="[object Promise]",h="[object Set]",f="[object WeakMap]",p="[object DataView]",v=c(r),g=c(i),m=c(o),y=c(a),b=c(s),w=u;(r&&w(new r(new ArrayBuffer(1)))!=p||i&&w(new i)!=l||o&&w(o.resolve())!=d||a&&w(new a)!=h||s&&w(new s)!=f)&&(w=function(e){var t=u(e),n="[object Object]"==t?e.constructor:void 0,r=n?c(n):"";if(r)switch(r){case v:return p;case g:return l;case m:return d;case y:return h;case b:return f}return t}),e.exports=w},30040:function(e){e.exports=function(e,t){return null==e?void 0:e[t]}},85403:function(e,t,n){var r=n(49620);e.exports=function(){this.__data__=r?r(null):{},this.size=0}},62747:function(e){e.exports=function(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t}},16037:function(e,t,n){var r=n(49620),i=Object.prototype.hasOwnProperty;e.exports=function(e){var t=this.__data__;if(r){var n=t[e];return"__lodash_hash_undefined__"===n?void 0:n}return i.call(t,e)?t[e]:void 0}},94154:function(e,t,n){var r=n(49620),i=Object.prototype.hasOwnProperty;e.exports=function(e){var t=this.__data__;return r?void 0!==t[e]:i.call(t,e)}},77728:function(e,t,n){var r=n(49620);e.exports=function(e,t){var n=this.__data__;return this.size+=this.has(e)?0:1,n[e]=r&&void 0===t?"__lodash_hash_undefined__":t,this}},39243:function(e){var t=Object.prototype.hasOwnProperty;e.exports=function(e){var n=e.length,r=new e.constructor(n);return n&&"string"==typeof e[0]&&t.call(e,"index")&&(r.index=e.index,r.input=e.input),r}},39759:function(e,t,n){var r=n(7010),i=n(61022),o=n(18503),a=n(64720),s=n(40613);e.exports=function(e,t,n){var u=e.constructor;switch(t){case"[object ArrayBuffer]":return r(e);case"[object Boolean]":case"[object Date]":return new u(+e);case"[object DataView]":return i(e,n);case"[object Float32Array]":case"[object Float64Array]":case"[object Int8Array]":case"[object Int16Array]":case"[object Int32Array]":case"[object Uint8Array]":case"[object Uint8ClampedArray]":case"[object Uint16Array]":case"[object Uint32Array]":return s(e,n);case"[object Map]":case"[object Set]":return new u;case"[object Number]":case"[object String]":return new u(e);case"[object RegExp]":return o(e);case"[object Symbol]":return a(e)}}},40548:function(e,t,n){var r=n(65763),i=n(31137),o=n(62936);e.exports=function(e){return"function"!=typeof e.constructor||o(e)?{}:r(i(e))}},26800:function(e){var t=/^(?:0|[1-9]\d*)$/;e.exports=function(e,n){var r=typeof e;return!!(n=null==n?9007199254740991:n)&&("number"==r||"symbol"!=r&&t.test(e))&&e>-1&&e%1==0&&e<n}},3195:function(e,t,n){var r=n(29231),i=n(21473),o=n(26800),a=n(8092);e.exports=function(e,t,n){if(!a(n))return!1;var s=typeof t;return!!("number"==s?i(n)&&o(t,n.length):"string"==s&&t in n)&&r(n[t],e)}},55964:function(e){e.exports=function(e){var t=typeof e;return"string"==t||"number"==t||"symbol"==t||"boolean"==t?"__proto__"!==e:null===e}},257:function(e,t,n){var r=n(65525),i=function(){var e=/[^.]+$/.exec(r&&r.keys&&r.keys.IE_PROTO||"");return e?"Symbol(src)_1."+e:""}();e.exports=function(e){return!!i&&i in e}},62936:function(e){var t=Object.prototype;e.exports=function(e){var n=e&&e.constructor;return e===("function"==typeof n&&n.prototype||t)}},43894:function(e){e.exports=function(){this.__data__=[],this.size=0}},8699:function(e,t,n){var r=n(27112),i=Array.prototype.splice;e.exports=function(e){var t=this.__data__,n=r(t,e);return!(n<0)&&(n==t.length-1?t.pop():i.call(t,n,1),--this.size,!0)}},64957:function(e,t,n){var r=n(27112);e.exports=function(e){var t=this.__data__,n=r(t,e);return n<0?void 0:t[n][1]}},87184:function(e,t,n){var r=n(27112);e.exports=function(e){return r(this.__data__,e)>-1}},87109:function(e,t,n){var r=n(27112);e.exports=function(e,t){var n=this.__data__,i=r(n,e);return i<0?(++this.size,n.push([e,t])):n[i][1]=t,this}},34086:function(e,t,n){var r=n(29676),i=n(38384),o=n(95797);e.exports=function(){this.size=0,this.__data__={hash:new r,map:new(o||i),string:new r}}},9255:function(e,t,n){var r=n(32799);e.exports=function(e){var t=r(this,e).delete(e);return this.size-=t?1:0,t}},29186:function(e,t,n){var r=n(32799);e.exports=function(e){return r(this,e).get(e)}},13423:function(e,t,n){var r=n(32799);e.exports=function(e){return r(this,e).has(e)}},73739:function(e,t,n){var r=n(32799);e.exports=function(e,t){var n=r(this,e),i=n.size;return n.set(e,t),this.size+=n.size==i?0:1,this}},49620:function(e,t,n){var r=n(68136)(Object,"create");e.exports=r},75964:function(e,t,n){var r=n(12709)(Object.keys,Object);e.exports=r},4221:function(e){e.exports=function(e){var t=[];if(null!=e)for(var n in Object(e))t.push(n);return t}},49494:function(e,t,n){e=n.nmd(e);var r=n(31032),i=t&&!t.nodeType&&t,o=i&&e&&!e.nodeType&&e,a=o&&o.exports===i&&r.process,s=function(){try{var e=o&&o.require&&o.require("util").types;return e||a&&a.binding&&a.binding("util")}catch(t){}}();e.exports=s},43581:function(e){var t=Object.prototype.toString;e.exports=function(e){return t.call(e)}},12709:function(e){e.exports=function(e,t){return function(n){return e(t(n))}}},64262:function(e,t,n){var r=n(13665),i=Math.max;e.exports=function(e,t,n){return t=i(void 0===t?e.length-1:t,0),function(){for(var o=arguments,a=-1,s=i(o.length-t,0),u=Array(s);++a<s;)u[a]=o[t+a];a=-1;for(var c=Array(t+1);++a<t;)c[a]=o[a];return c[t]=n(u),r(e,this,c)}}},97009:function(e,t,n){var r=n(31032),i="object"==typeof self&&self&&self.Object===Object&&self,o=r||i||Function("return this")();e.exports=o},85906:function(e){e.exports=function(e,t){if(("constructor"!==t||"function"!==typeof e[t])&&"__proto__"!=t)return e[t]}},79156:function(e,t,n){var r=n(7532),i=n(83197)(r);e.exports=i},83197:function(e){var t=Date.now;e.exports=function(e){var n=0,r=0;return function(){var i=t(),o=16-(i-r);if(r=i,o>0){if(++n>=800)return arguments[0]}else n=0;return e.apply(void 0,arguments)}}},20511:function(e,t,n){var r=n(38384);e.exports=function(){this.__data__=new r,this.size=0}},50835:function(e){e.exports=function(e){var t=this.__data__,n=t.delete(e);return this.size=t.size,n}},90707:function(e){e.exports=function(e){return this.__data__.get(e)}},18832:function(e){e.exports=function(e){return this.__data__.has(e)}},35077:function(e,t,n){var r=n(38384),i=n(95797),o=n(78059);e.exports=function(e,t){var n=this.__data__;if(n instanceof r){var a=n.__data__;if(!i||a.length<199)return a.push([e,t]),this.size=++n.size,this;n=this.__data__=new o(a)}return n.set(e,t),this.size=n.size,this}},27907:function(e){var t=Function.prototype.toString;e.exports=function(e){if(null!=e){try{return t.call(e)}catch(n){}try{return e+""}catch(n){}}return""}},58121:function(e,t,n){var r=n(31905);e.exports=function(e){return r(e,5)}},71547:function(e){e.exports=function(e){return function(){return e}}},29231:function(e){e.exports=function(e,t){return e===t||e!==e&&t!==t}},2100:function(e){e.exports=function(e){return e}},34963:function(e,t,n){var r=n(4906),i=n(43141),o=Object.prototype,a=o.hasOwnProperty,s=o.propertyIsEnumerable,u=r(function(){return arguments}())?r:function(e){return i(e)&&a.call(e,"callee")&&!s.call(e,"callee")};e.exports=u},93629:function(e){var t=Array.isArray;e.exports=t},21473:function(e,t,n){var r=n(74786),i=n(24635);e.exports=function(e){return null!=e&&i(e.length)&&!r(e)}},56279:function(e,t,n){var r=n(21473),i=n(43141);e.exports=function(e){return i(e)&&r(e)}},5174:function(e,t,n){e=n.nmd(e);var r=n(97009),i=n(49488),o=t&&!t.nodeType&&t,a=o&&e&&!e.nodeType&&e,s=a&&a.exports===o?r.Buffer:void 0,u=(s?s.isBuffer:void 0)||i;e.exports=u},74786:function(e,t,n){var r=n(39066),i=n(8092);e.exports=function(e){if(!i(e))return!1;var t=r(e);return"[object Function]"==t||"[object GeneratorFunction]"==t||"[object AsyncFunction]"==t||"[object Proxy]"==t}},24635:function(e){e.exports=function(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=9007199254740991}},60103:function(e,t,n){var r=n(53085),i=n(16194),o=n(49494),a=o&&o.isMap,s=a?i(a):r;e.exports=s},8092:function(e){e.exports=function(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)}},43141:function(e){e.exports=function(e){return null!=e&&"object"==typeof e}},93977:function(e,t,n){var r=n(39066),i=n(31137),o=n(43141),a=Function.prototype,s=Object.prototype,u=a.toString,c=s.hasOwnProperty,l=u.call(Object);e.exports=function(e){if(!o(e)||"[object Object]"!=r(e))return!1;var t=i(e);if(null===t)return!0;var n=c.call(t,"constructor")&&t.constructor;return"function"==typeof n&&n instanceof n&&u.call(n)==l}},36995:function(e,t,n){var r=n(48680),i=n(16194),o=n(49494),a=o&&o.isSet,s=a?i(a):r;e.exports=s},19102:function(e,t,n){var r=n(68150),i=n(16194),o=n(49494),a=o&&o.isTypedArray,s=a?i(a):r;e.exports=s},12742:function(e,t,n){var r=n(47538),i=n(43654),o=n(21473);e.exports=function(e){return o(e)?r(e):i(e)}},73961:function(e,t,n){var r=n(47538),i=n(8664),o=n(21473);e.exports=function(e){return o(e)?r(e,!0):i(e)}},79286:function(e,t,n){var r=n(64173),i=n(39934)((function(e,t,n){r(e,t,n)}));e.exports=i},68174:function(e){e.exports=function(){return[]}},49488:function(e){e.exports=function(){return!1}},6576:function(e,t,n){var r=n(64503),i=n(73961);e.exports=function(e){return r(e,i(e))}},78193:function(e){var t=1e3,n=60*t,r=60*n,i=24*r,o=7*i,a=365.25*i;function s(e,t,n,r){var i=t>=1.5*n;return Math.round(e/n)+" "+r+(i?"s":"")}e.exports=function(e,u){u=u||{};var c=typeof e;if("string"===c&&e.length>0)return function(e){if((e=String(e)).length>100)return;var s=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(e);if(!s)return;var u=parseFloat(s[1]);switch((s[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return u*a;case"weeks":case"week":case"w":return u*o;case"days":case"day":case"d":return u*i;case"hours":case"hour":case"hrs":case"hr":case"h":return u*r;case"minutes":case"minute":case"mins":case"min":case"m":return u*n;case"seconds":case"second":case"secs":case"sec":case"s":return u*t;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return u;default:return}}(e);if("number"===c&&isFinite(e))return u.long?function(e){var o=Math.abs(e);if(o>=i)return s(e,o,i,"day");if(o>=r)return s(e,o,r,"hour");if(o>=n)return s(e,o,n,"minute");if(o>=t)return s(e,o,t,"second");return e+" ms"}(e):function(e){var o=Math.abs(e);if(o>=i)return Math.round(e/i)+"d";if(o>=r)return Math.round(e/r)+"h";if(o>=n)return Math.round(e/n)+"m";if(o>=t)return Math.round(e/t)+"s";return e+"ms"}(e);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(e))}},42584:function(e,t,n){var r="function"===typeof Map&&Map.prototype,i=Object.getOwnPropertyDescriptor&&r?Object.getOwnPropertyDescriptor(Map.prototype,"size"):null,o=r&&i&&"function"===typeof i.get?i.get:null,a=r&&Map.prototype.forEach,s="function"===typeof Set&&Set.prototype,u=Object.getOwnPropertyDescriptor&&s?Object.getOwnPropertyDescriptor(Set.prototype,"size"):null,c=s&&u&&"function"===typeof u.get?u.get:null,l=s&&Set.prototype.forEach,d="function"===typeof WeakMap&&WeakMap.prototype?WeakMap.prototype.has:null,h="function"===typeof WeakSet&&WeakSet.prototype?WeakSet.prototype.has:null,f="function"===typeof WeakRef&&WeakRef.prototype?WeakRef.prototype.deref:null,p=Boolean.prototype.valueOf,v=Object.prototype.toString,g=Function.prototype.toString,m=String.prototype.match,y=String.prototype.slice,b=String.prototype.replace,w=String.prototype.toUpperCase,S=String.prototype.toLowerCase,k=RegExp.prototype.test,C=Array.prototype.concat,x=Array.prototype.join,E=Array.prototype.slice,T=Math.floor,I="function"===typeof BigInt?BigInt.prototype.valueOf:null,A=Object.getOwnPropertySymbols,R="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?Symbol.prototype.toString:null,_="function"===typeof Symbol&&"object"===typeof Symbol.iterator,P="function"===typeof Symbol&&Symbol.toStringTag&&(typeof Symbol.toStringTag===_||"symbol")?Symbol.toStringTag:null,N=Object.prototype.propertyIsEnumerable,O=("function"===typeof Reflect?Reflect.getPrototypeOf:Object.getPrototypeOf)||([].__proto__===Array.prototype?function(e){return e.__proto__}:null);function M(e,t){if(e===1/0||e===-1/0||e!==e||e&&e>-1e3&&e<1e3||k.call(/e/,t))return t;var n=/[0-9](?=(?:[0-9]{3})+(?![0-9]))/g;if("number"===typeof e){var r=e<0?-T(-e):T(e);if(r!==e){var i=String(r),o=y.call(t,i.length+1);return b.call(i,n,"$&_")+"."+b.call(b.call(o,/([0-9]{3})/g,"$&_"),/_$/,"")}}return b.call(t,n,"$&_")}var F=n(24654),Z=F.custom,D=U(Z)?Z:null;function L(e,t,n){var r="double"===(n.quoteStyle||t)?'"':"'";return r+e+r}function B(e){return b.call(String(e),/"/g,"&quot;")}function q(e){return"[object Array]"===V(e)&&(!P||!("object"===typeof e&&P in e))}function j(e){return"[object RegExp]"===V(e)&&(!P||!("object"===typeof e&&P in e))}function U(e){if(_)return e&&"object"===typeof e&&e instanceof Symbol;if("symbol"===typeof e)return!0;if(!e||"object"!==typeof e||!R)return!1;try{return R.call(e),!0}catch(t){}return!1}e.exports=function e(t,n,r,i){var s=n||{};if(z(s,"quoteStyle")&&"single"!==s.quoteStyle&&"double"!==s.quoteStyle)throw new TypeError('option "quoteStyle" must be "single" or "double"');if(z(s,"maxStringLength")&&("number"===typeof s.maxStringLength?s.maxStringLength<0&&s.maxStringLength!==1/0:null!==s.maxStringLength))throw new TypeError('option "maxStringLength", if provided, must be a positive integer, Infinity, or `null`');var u=!z(s,"customInspect")||s.customInspect;if("boolean"!==typeof u&&"symbol"!==u)throw new TypeError("option \"customInspect\", if provided, must be `true`, `false`, or `'symbol'`");if(z(s,"indent")&&null!==s.indent&&"\t"!==s.indent&&!(parseInt(s.indent,10)===s.indent&&s.indent>0))throw new TypeError('option "indent" must be "\\t", an integer > 0, or `null`');if(z(s,"numericSeparator")&&"boolean"!==typeof s.numericSeparator)throw new TypeError('option "numericSeparator", if provided, must be `true` or `false`');var v=s.numericSeparator;if("undefined"===typeof t)return"undefined";if(null===t)return"null";if("boolean"===typeof t)return t?"true":"false";if("string"===typeof t)return K(t,s);if("number"===typeof t){if(0===t)return 1/0/t>0?"0":"-0";var w=String(t);return v?M(t,w):w}if("bigint"===typeof t){var k=String(t)+"n";return v?M(t,k):k}var T="undefined"===typeof s.depth?5:s.depth;if("undefined"===typeof r&&(r=0),r>=T&&T>0&&"object"===typeof t)return q(t)?"[Array]":"[Object]";var A=function(e,t){var n;if("\t"===e.indent)n="\t";else{if(!("number"===typeof e.indent&&e.indent>0))return null;n=x.call(Array(e.indent+1)," ")}return{base:n,prev:x.call(Array(t+1),n)}}(s,r);if("undefined"===typeof i)i=[];else if(G(i,t)>=0)return"[Circular]";function Z(t,n,o){if(n&&(i=E.call(i)).push(n),o){var a={depth:s.depth};return z(s,"quoteStyle")&&(a.quoteStyle=s.quoteStyle),e(t,a,r+1,i)}return e(t,s,r+1,i)}if("function"===typeof t&&!j(t)){var H=function(e){if(e.name)return e.name;var t=m.call(g.call(e),/^function\s*([\w$]+)/);if(t)return t[1];return null}(t),W=$(t,Z);return"[Function"+(H?": "+H:" (anonymous)")+"]"+(W.length>0?" { "+x.call(W,", ")+" }":"")}if(U(t)){var ee=_?b.call(String(t),/^(Symbol\(.*\))_[^)]*$/,"$1"):R.call(t);return"object"!==typeof t||_?ee:J(ee)}if(function(e){if(!e||"object"!==typeof e)return!1;if("undefined"!==typeof HTMLElement&&e instanceof HTMLElement)return!0;return"string"===typeof e.nodeName&&"function"===typeof e.getAttribute}(t)){for(var te="<"+S.call(String(t.nodeName)),ne=t.attributes||[],re=0;re<ne.length;re++)te+=" "+ne[re].name+"="+L(B(ne[re].value),"double",s);return te+=">",t.childNodes&&t.childNodes.length&&(te+="..."),te+="</"+S.call(String(t.nodeName))+">"}if(q(t)){if(0===t.length)return"[]";var ie=$(t,Z);return A&&!function(e){for(var t=0;t<e.length;t++)if(G(e[t],"\n")>=0)return!1;return!0}(ie)?"["+X(ie,A)+"]":"[ "+x.call(ie,", ")+" ]"}if(function(e){return"[object Error]"===V(e)&&(!P||!("object"===typeof e&&P in e))}(t)){var oe=$(t,Z);return"cause"in Error.prototype||!("cause"in t)||N.call(t,"cause")?0===oe.length?"["+String(t)+"]":"{ ["+String(t)+"] "+x.call(oe,", ")+" }":"{ ["+String(t)+"] "+x.call(C.call("[cause]: "+Z(t.cause),oe),", ")+" }"}if("object"===typeof t&&u){if(D&&"function"===typeof t[D]&&F)return F(t,{depth:T-r});if("symbol"!==u&&"function"===typeof t.inspect)return t.inspect()}if(function(e){if(!o||!e||"object"!==typeof e)return!1;try{o.call(e);try{c.call(e)}catch(te){return!0}return e instanceof Map}catch(t){}return!1}(t)){var ae=[];return a&&a.call(t,(function(e,n){ae.push(Z(n,t,!0)+" => "+Z(e,t))})),Y("Map",o.call(t),ae,A)}if(function(e){if(!c||!e||"object"!==typeof e)return!1;try{c.call(e);try{o.call(e)}catch(t){return!0}return e instanceof Set}catch(n){}return!1}(t)){var se=[];return l&&l.call(t,(function(e){se.push(Z(e,t))})),Y("Set",c.call(t),se,A)}if(function(e){if(!d||!e||"object"!==typeof e)return!1;try{d.call(e,d);try{h.call(e,h)}catch(te){return!0}return e instanceof WeakMap}catch(t){}return!1}(t))return Q("WeakMap");if(function(e){if(!h||!e||"object"!==typeof e)return!1;try{h.call(e,h);try{d.call(e,d)}catch(te){return!0}return e instanceof WeakSet}catch(t){}return!1}(t))return Q("WeakSet");if(function(e){if(!f||!e||"object"!==typeof e)return!1;try{return f.call(e),!0}catch(t){}return!1}(t))return Q("WeakRef");if(function(e){return"[object Number]"===V(e)&&(!P||!("object"===typeof e&&P in e))}(t))return J(Z(Number(t)));if(function(e){if(!e||"object"!==typeof e||!I)return!1;try{return I.call(e),!0}catch(t){}return!1}(t))return J(Z(I.call(t)));if(function(e){return"[object Boolean]"===V(e)&&(!P||!("object"===typeof e&&P in e))}(t))return J(p.call(t));if(function(e){return"[object String]"===V(e)&&(!P||!("object"===typeof e&&P in e))}(t))return J(Z(String(t)));if(!function(e){return"[object Date]"===V(e)&&(!P||!("object"===typeof e&&P in e))}(t)&&!j(t)){var ue=$(t,Z),ce=O?O(t)===Object.prototype:t instanceof Object||t.constructor===Object,le=t instanceof Object?"":"null prototype",de=!ce&&P&&Object(t)===t&&P in t?y.call(V(t),8,-1):le?"Object":"",he=(ce||"function"!==typeof t.constructor?"":t.constructor.name?t.constructor.name+" ":"")+(de||le?"["+x.call(C.call([],de||[],le||[]),": ")+"] ":"");return 0===ue.length?he+"{}":A?he+"{"+X(ue,A)+"}":he+"{ "+x.call(ue,", ")+" }"}return String(t)};var H=Object.prototype.hasOwnProperty||function(e){return e in this};function z(e,t){return H.call(e,t)}function V(e){return v.call(e)}function G(e,t){if(e.indexOf)return e.indexOf(t);for(var n=0,r=e.length;n<r;n++)if(e[n]===t)return n;return-1}function K(e,t){if(e.length>t.maxStringLength){var n=e.length-t.maxStringLength,r="... "+n+" more character"+(n>1?"s":"");return K(y.call(e,0,t.maxStringLength),t)+r}return L(b.call(b.call(e,/(['\\])/g,"\\$1"),/[\x00-\x1f]/g,W),"single",t)}function W(e){var t=e.charCodeAt(0),n={8:"b",9:"t",10:"n",12:"f",13:"r"}[t];return n?"\\"+n:"\\x"+(t<16?"0":"")+w.call(t.toString(16))}function J(e){return"Object("+e+")"}function Q(e){return e+" { ? }"}function Y(e,t,n,r){return e+" ("+t+") {"+(r?X(n,r):x.call(n,", "))+"}"}function X(e,t){if(0===e.length)return"";var n="\n"+t.prev+t.base;return n+x.call(e,","+n)+"\n"+t.prev}function $(e,t){var n=q(e),r=[];if(n){r.length=e.length;for(var i=0;i<e.length;i++)r[i]=z(e,i)?t(e[i],e):""}var o,a="function"===typeof A?A(e):[];if(_){o={};for(var s=0;s<a.length;s++)o["$"+a[s]]=a[s]}for(var u in e)z(e,u)&&(n&&String(Number(u))===u&&u<e.length||_&&o["$"+u]instanceof Symbol||(k.call(/[^\w$]/,u)?r.push(t(u,e)+": "+t(e[u],e)):r.push(u+": "+t(e[u],e))));if("function"===typeof A)for(var c=0;c<a.length;c++)N.call(e,a[c])&&r.push("["+t(a[c])+"]: "+t(e[a[c]],e));return r}},5982:function(e){"use strict";function t(e){if("string"!==typeof e)throw new TypeError("Path must be a string. Received "+JSON.stringify(e))}function n(e,t){for(var n,r="",i=0,o=-1,a=0,s=0;s<=e.length;++s){if(s<e.length)n=e.charCodeAt(s);else{if(47===n)break;n=47}if(47===n){if(o===s-1||1===a);else if(o!==s-1&&2===a){if(r.length<2||2!==i||46!==r.charCodeAt(r.length-1)||46!==r.charCodeAt(r.length-2))if(r.length>2){var u=r.lastIndexOf("/");if(u!==r.length-1){-1===u?(r="",i=0):i=(r=r.slice(0,u)).length-1-r.lastIndexOf("/"),o=s,a=0;continue}}else if(2===r.length||1===r.length){r="",i=0,o=s,a=0;continue}t&&(r.length>0?r+="/..":r="..",i=2)}else r.length>0?r+="/"+e.slice(o+1,s):r=e.slice(o+1,s),i=s-o-1;o=s,a=0}else 46===n&&-1!==a?++a:a=-1}return r}var r={resolve:function(){for(var e,r="",i=!1,o=arguments.length-1;o>=-1&&!i;o--){var a;o>=0?a=arguments[o]:(void 0===e&&(e=process.cwd()),a=e),t(a),0!==a.length&&(r=a+"/"+r,i=47===a.charCodeAt(0))}return r=n(r,!i),i?r.length>0?"/"+r:"/":r.length>0?r:"."},normalize:function(e){if(t(e),0===e.length)return".";var r=47===e.charCodeAt(0),i=47===e.charCodeAt(e.length-1);return 0!==(e=n(e,!r)).length||r||(e="."),e.length>0&&i&&(e+="/"),r?"/"+e:e},isAbsolute:function(e){return t(e),e.length>0&&47===e.charCodeAt(0)},join:function(){if(0===arguments.length)return".";for(var e,n=0;n<arguments.length;++n){var i=arguments[n];t(i),i.length>0&&(void 0===e?e=i:e+="/"+i)}return void 0===e?".":r.normalize(e)},relative:function(e,n){if(t(e),t(n),e===n)return"";if((e=r.resolve(e))===(n=r.resolve(n)))return"";for(var i=1;i<e.length&&47===e.charCodeAt(i);++i);for(var o=e.length,a=o-i,s=1;s<n.length&&47===n.charCodeAt(s);++s);for(var u=n.length-s,c=a<u?a:u,l=-1,d=0;d<=c;++d){if(d===c){if(u>c){if(47===n.charCodeAt(s+d))return n.slice(s+d+1);if(0===d)return n.slice(s+d)}else a>c&&(47===e.charCodeAt(i+d)?l=d:0===d&&(l=0));break}var h=e.charCodeAt(i+d);if(h!==n.charCodeAt(s+d))break;47===h&&(l=d)}var f="";for(d=i+l+1;d<=o;++d)d!==o&&47!==e.charCodeAt(d)||(0===f.length?f+="..":f+="/..");return f.length>0?f+n.slice(s+l):(s+=l,47===n.charCodeAt(s)&&++s,n.slice(s))},_makeLong:function(e){return e},dirname:function(e){if(t(e),0===e.length)return".";for(var n=e.charCodeAt(0),r=47===n,i=-1,o=!0,a=e.length-1;a>=1;--a)if(47===(n=e.charCodeAt(a))){if(!o){i=a;break}}else o=!1;return-1===i?r?"/":".":r&&1===i?"//":e.slice(0,i)},basename:function(e,n){if(void 0!==n&&"string"!==typeof n)throw new TypeError('"ext" argument must be a string');t(e);var r,i=0,o=-1,a=!0;if(void 0!==n&&n.length>0&&n.length<=e.length){if(n.length===e.length&&n===e)return"";var s=n.length-1,u=-1;for(r=e.length-1;r>=0;--r){var c=e.charCodeAt(r);if(47===c){if(!a){i=r+1;break}}else-1===u&&(a=!1,u=r+1),s>=0&&(c===n.charCodeAt(s)?-1===--s&&(o=r):(s=-1,o=u))}return i===o?o=u:-1===o&&(o=e.length),e.slice(i,o)}for(r=e.length-1;r>=0;--r)if(47===e.charCodeAt(r)){if(!a){i=r+1;break}}else-1===o&&(a=!1,o=r+1);return-1===o?"":e.slice(i,o)},extname:function(e){t(e);for(var n=-1,r=0,i=-1,o=!0,a=0,s=e.length-1;s>=0;--s){var u=e.charCodeAt(s);if(47!==u)-1===i&&(o=!1,i=s+1),46===u?-1===n?n=s:1!==a&&(a=1):-1!==n&&(a=-1);else if(!o){r=s+1;break}}return-1===n||-1===i||0===a||1===a&&n===i-1&&n===r+1?"":e.slice(n,i)},format:function(e){if(null===e||"object"!==typeof e)throw new TypeError('The "pathObject" argument must be of type Object. Received type '+typeof e);return function(e,t){var n=t.dir||t.root,r=t.base||(t.name||"")+(t.ext||"");return n?n===t.root?n+r:n+e+r:r}("/",e)},parse:function(e){t(e);var n={root:"",dir:"",base:"",ext:"",name:""};if(0===e.length)return n;var r,i=e.charCodeAt(0),o=47===i;o?(n.root="/",r=1):r=0;for(var a=-1,s=0,u=-1,c=!0,l=e.length-1,d=0;l>=r;--l)if(47!==(i=e.charCodeAt(l)))-1===u&&(c=!1,u=l+1),46===i?-1===a?a=l:1!==d&&(d=1):-1!==a&&(d=-1);else if(!c){s=l+1;break}return-1===a||-1===u||0===d||1===d&&a===u-1&&a===s+1?-1!==u&&(n.base=n.name=0===s&&o?e.slice(1,u):e.slice(s,u)):(0===s&&o?(n.name=e.slice(1,a),n.base=e.slice(1,u)):(n.name=e.slice(s,a),n.base=e.slice(s,u)),n.ext=e.slice(a,u)),s>0?n.dir=e.slice(0,s-1):o&&(n.dir="/"),n},sep:"/",delimiter:":",win32:null,posix:null};r.posix=r,e.exports=r},59874:function(e){"use strict";var t=String.prototype.replace,n=/%20/g,r="RFC1738",i="RFC3986";e.exports={default:i,formatters:{RFC1738:function(e){return t.call(e,n,"+")},RFC3986:function(e){return String(e)}},RFC1738:r,RFC3986:i}},32808:function(e,t,n){"use strict";var r=n(22334),i=n(4360),o=n(59874);e.exports={formats:o,parse:i,stringify:r}},4360:function(e,t,n){"use strict";var r=n(64184),i=Object.prototype.hasOwnProperty,o=Array.isArray,a={allowDots:!1,allowPrototypes:!1,allowSparse:!1,arrayLimit:20,charset:"utf-8",charsetSentinel:!1,comma:!1,decoder:r.decode,delimiter:"&",depth:5,ignoreQueryPrefix:!1,interpretNumericEntities:!1,parameterLimit:1e3,parseArrays:!0,plainObjects:!1,strictNullHandling:!1},s=function(e){return e.replace(/&#(\d+);/g,(function(e,t){return String.fromCharCode(parseInt(t,10))}))},u=function(e,t){return e&&"string"===typeof e&&t.comma&&e.indexOf(",")>-1?e.split(","):e},c=function(e,t,n,r){if(e){var o=n.allowDots?e.replace(/\.([^.[]+)/g,"[$1]"):e,a=/(\[[^[\]]*])/g,s=n.depth>0&&/(\[[^[\]]*])/.exec(o),c=s?o.slice(0,s.index):o,l=[];if(c){if(!n.plainObjects&&i.call(Object.prototype,c)&&!n.allowPrototypes)return;l.push(c)}for(var d=0;n.depth>0&&null!==(s=a.exec(o))&&d<n.depth;){if(d+=1,!n.plainObjects&&i.call(Object.prototype,s[1].slice(1,-1))&&!n.allowPrototypes)return;l.push(s[1])}return s&&l.push("["+o.slice(s.index)+"]"),function(e,t,n,r){for(var i=r?t:u(t,n),o=e.length-1;o>=0;--o){var a,s=e[o];if("[]"===s&&n.parseArrays)a=[].concat(i);else{a=n.plainObjects?Object.create(null):{};var c="["===s.charAt(0)&&"]"===s.charAt(s.length-1)?s.slice(1,-1):s,l=parseInt(c,10);n.parseArrays||""!==c?!isNaN(l)&&s!==c&&String(l)===c&&l>=0&&n.parseArrays&&l<=n.arrayLimit?(a=[])[l]=i:"__proto__"!==c&&(a[c]=i):a={0:i}}i=a}return i}(l,t,n,r)}};e.exports=function(e,t){var n=function(e){if(!e)return a;if(null!==e.decoder&&void 0!==e.decoder&&"function"!==typeof e.decoder)throw new TypeError("Decoder has to be a function.");if("undefined"!==typeof e.charset&&"utf-8"!==e.charset&&"iso-8859-1"!==e.charset)throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");var t="undefined"===typeof e.charset?a.charset:e.charset;return{allowDots:"undefined"===typeof e.allowDots?a.allowDots:!!e.allowDots,allowPrototypes:"boolean"===typeof e.allowPrototypes?e.allowPrototypes:a.allowPrototypes,allowSparse:"boolean"===typeof e.allowSparse?e.allowSparse:a.allowSparse,arrayLimit:"number"===typeof e.arrayLimit?e.arrayLimit:a.arrayLimit,charset:t,charsetSentinel:"boolean"===typeof e.charsetSentinel?e.charsetSentinel:a.charsetSentinel,comma:"boolean"===typeof e.comma?e.comma:a.comma,decoder:"function"===typeof e.decoder?e.decoder:a.decoder,delimiter:"string"===typeof e.delimiter||r.isRegExp(e.delimiter)?e.delimiter:a.delimiter,depth:"number"===typeof e.depth||!1===e.depth?+e.depth:a.depth,ignoreQueryPrefix:!0===e.ignoreQueryPrefix,interpretNumericEntities:"boolean"===typeof e.interpretNumericEntities?e.interpretNumericEntities:a.interpretNumericEntities,parameterLimit:"number"===typeof e.parameterLimit?e.parameterLimit:a.parameterLimit,parseArrays:!1!==e.parseArrays,plainObjects:"boolean"===typeof e.plainObjects?e.plainObjects:a.plainObjects,strictNullHandling:"boolean"===typeof e.strictNullHandling?e.strictNullHandling:a.strictNullHandling}}(t);if(""===e||null===e||"undefined"===typeof e)return n.plainObjects?Object.create(null):{};for(var l="string"===typeof e?function(e,t){var n,c={__proto__:null},l=t.ignoreQueryPrefix?e.replace(/^\?/,""):e,d=t.parameterLimit===1/0?void 0:t.parameterLimit,h=l.split(t.delimiter,d),f=-1,p=t.charset;if(t.charsetSentinel)for(n=0;n<h.length;++n)0===h[n].indexOf("utf8=")&&("utf8=%E2%9C%93"===h[n]?p="utf-8":"utf8=%26%2310003%3B"===h[n]&&(p="iso-8859-1"),f=n,n=h.length);for(n=0;n<h.length;++n)if(n!==f){var v,g,m=h[n],y=m.indexOf("]="),b=-1===y?m.indexOf("="):y+1;-1===b?(v=t.decoder(m,a.decoder,p,"key"),g=t.strictNullHandling?null:""):(v=t.decoder(m.slice(0,b),a.decoder,p,"key"),g=r.maybeMap(u(m.slice(b+1),t),(function(e){return t.decoder(e,a.decoder,p,"value")}))),g&&t.interpretNumericEntities&&"iso-8859-1"===p&&(g=s(g)),m.indexOf("[]=")>-1&&(g=o(g)?[g]:g),i.call(c,v)?c[v]=r.combine(c[v],g):c[v]=g}return c}(e,n):e,d=n.plainObjects?Object.create(null):{},h=Object.keys(l),f=0;f<h.length;++f){var p=h[f],v=c(p,l[p],n,"string"===typeof e);d=r.merge(d,v,n)}return!0===n.allowSparse?d:r.compact(d)}},22334:function(e,t,n){"use strict";var r=n(40581),i=n(64184),o=n(59874),a=Object.prototype.hasOwnProperty,s={brackets:function(e){return e+"[]"},comma:"comma",indices:function(e,t){return e+"["+t+"]"},repeat:function(e){return e}},u=Array.isArray,c=Array.prototype.push,l=function(e,t){c.apply(e,u(t)?t:[t])},d=Date.prototype.toISOString,h=o.default,f={addQueryPrefix:!1,allowDots:!1,charset:"utf-8",charsetSentinel:!1,delimiter:"&",encode:!0,encoder:i.encode,encodeValuesOnly:!1,format:h,formatter:o.formatters[h],indices:!1,serializeDate:function(e){return d.call(e)},skipNulls:!1,strictNullHandling:!1},p={},v=function e(t,n,o,a,s,c,d,h,v,g,m,y,b,w,S,k){for(var C,x=t,E=k,T=0,I=!1;void 0!==(E=E.get(p))&&!I;){var A=E.get(t);if(T+=1,"undefined"!==typeof A){if(A===T)throw new RangeError("Cyclic object value");I=!0}"undefined"===typeof E.get(p)&&(T=0)}if("function"===typeof h?x=h(n,x):x instanceof Date?x=m(x):"comma"===o&&u(x)&&(x=i.maybeMap(x,(function(e){return e instanceof Date?m(e):e}))),null===x){if(s)return d&&!w?d(n,f.encoder,S,"key",y):n;x=""}if("string"===typeof(C=x)||"number"===typeof C||"boolean"===typeof C||"symbol"===typeof C||"bigint"===typeof C||i.isBuffer(x))return d?[b(w?n:d(n,f.encoder,S,"key",y))+"="+b(d(x,f.encoder,S,"value",y))]:[b(n)+"="+b(String(x))];var R,_=[];if("undefined"===typeof x)return _;if("comma"===o&&u(x))w&&d&&(x=i.maybeMap(x,d)),R=[{value:x.length>0?x.join(",")||null:void 0}];else if(u(h))R=h;else{var P=Object.keys(x);R=v?P.sort(v):P}for(var N=a&&u(x)&&1===x.length?n+"[]":n,O=0;O<R.length;++O){var M=R[O],F="object"===typeof M&&"undefined"!==typeof M.value?M.value:x[M];if(!c||null!==F){var Z=u(x)?"function"===typeof o?o(N,M):N:N+(g?"."+M:"["+M+"]");k.set(t,T);var D=r();D.set(p,k),l(_,e(F,Z,o,a,s,c,"comma"===o&&w&&u(x)?null:d,h,v,g,m,y,b,w,S,D))}}return _};e.exports=function(e,t){var n,i=e,c=function(e){if(!e)return f;if(null!==e.encoder&&"undefined"!==typeof e.encoder&&"function"!==typeof e.encoder)throw new TypeError("Encoder has to be a function.");var t=e.charset||f.charset;if("undefined"!==typeof e.charset&&"utf-8"!==e.charset&&"iso-8859-1"!==e.charset)throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");var n=o.default;if("undefined"!==typeof e.format){if(!a.call(o.formatters,e.format))throw new TypeError("Unknown format option provided.");n=e.format}var r=o.formatters[n],i=f.filter;return("function"===typeof e.filter||u(e.filter))&&(i=e.filter),{addQueryPrefix:"boolean"===typeof e.addQueryPrefix?e.addQueryPrefix:f.addQueryPrefix,allowDots:"undefined"===typeof e.allowDots?f.allowDots:!!e.allowDots,charset:t,charsetSentinel:"boolean"===typeof e.charsetSentinel?e.charsetSentinel:f.charsetSentinel,delimiter:"undefined"===typeof e.delimiter?f.delimiter:e.delimiter,encode:"boolean"===typeof e.encode?e.encode:f.encode,encoder:"function"===typeof e.encoder?e.encoder:f.encoder,encodeValuesOnly:"boolean"===typeof e.encodeValuesOnly?e.encodeValuesOnly:f.encodeValuesOnly,filter:i,format:n,formatter:r,serializeDate:"function"===typeof e.serializeDate?e.serializeDate:f.serializeDate,skipNulls:"boolean"===typeof e.skipNulls?e.skipNulls:f.skipNulls,sort:"function"===typeof e.sort?e.sort:null,strictNullHandling:"boolean"===typeof e.strictNullHandling?e.strictNullHandling:f.strictNullHandling}}(t);"function"===typeof c.filter?i=(0,c.filter)("",i):u(c.filter)&&(n=c.filter);var d,h=[];if("object"!==typeof i||null===i)return"";d=t&&t.arrayFormat in s?t.arrayFormat:t&&"indices"in t?t.indices?"indices":"repeat":"indices";var p=s[d];if(t&&"commaRoundTrip"in t&&"boolean"!==typeof t.commaRoundTrip)throw new TypeError("`commaRoundTrip` must be a boolean, or absent");var g="comma"===p&&t&&t.commaRoundTrip;n||(n=Object.keys(i)),c.sort&&n.sort(c.sort);for(var m=r(),y=0;y<n.length;++y){var b=n[y];c.skipNulls&&null===i[b]||l(h,v(i[b],b,p,g,c.strictNullHandling,c.skipNulls,c.encode?c.encoder:null,c.filter,c.sort,c.allowDots,c.serializeDate,c.format,c.formatter,c.encodeValuesOnly,c.charset,m))}var w=h.join(c.delimiter),S=!0===c.addQueryPrefix?"?":"";return c.charsetSentinel&&("iso-8859-1"===c.charset?S+="utf8=%26%2310003%3B&":S+="utf8=%E2%9C%93&"),w.length>0?S+w:""}},64184:function(e,t,n){"use strict";var r=n(59874),i=Object.prototype.hasOwnProperty,o=Array.isArray,a=function(){for(var e=[],t=0;t<256;++t)e.push("%"+((t<16?"0":"")+t.toString(16)).toUpperCase());return e}(),s=function(e,t){for(var n=t&&t.plainObjects?Object.create(null):{},r=0;r<e.length;++r)"undefined"!==typeof e[r]&&(n[r]=e[r]);return n};e.exports={arrayToObject:s,assign:function(e,t){return Object.keys(t).reduce((function(e,n){return e[n]=t[n],e}),e)},combine:function(e,t){return[].concat(e,t)},compact:function(e){for(var t=[{obj:{o:e},prop:"o"}],n=[],r=0;r<t.length;++r)for(var i=t[r],a=i.obj[i.prop],s=Object.keys(a),u=0;u<s.length;++u){var c=s[u],l=a[c];"object"===typeof l&&null!==l&&-1===n.indexOf(l)&&(t.push({obj:a,prop:c}),n.push(l))}return function(e){for(;e.length>1;){var t=e.pop(),n=t.obj[t.prop];if(o(n)){for(var r=[],i=0;i<n.length;++i)"undefined"!==typeof n[i]&&r.push(n[i]);t.obj[t.prop]=r}}}(t),e},decode:function(e,t,n){var r=e.replace(/\+/g," ");if("iso-8859-1"===n)return r.replace(/%[0-9a-f]{2}/gi,unescape);try{return decodeURIComponent(r)}catch(i){return r}},encode:function(e,t,n,i,o){if(0===e.length)return e;var s=e;if("symbol"===typeof e?s=Symbol.prototype.toString.call(e):"string"!==typeof e&&(s=String(e)),"iso-8859-1"===n)return escape(s).replace(/%u[0-9a-f]{4}/gi,(function(e){return"%26%23"+parseInt(e.slice(2),16)+"%3B"}));for(var u="",c=0;c<s.length;++c){var l=s.charCodeAt(c);45===l||46===l||95===l||126===l||l>=48&&l<=57||l>=65&&l<=90||l>=97&&l<=122||o===r.RFC1738&&(40===l||41===l)?u+=s.charAt(c):l<128?u+=a[l]:l<2048?u+=a[192|l>>6]+a[128|63&l]:l<55296||l>=57344?u+=a[224|l>>12]+a[128|l>>6&63]+a[128|63&l]:(c+=1,l=65536+((1023&l)<<10|1023&s.charCodeAt(c)),u+=a[240|l>>18]+a[128|l>>12&63]+a[128|l>>6&63]+a[128|63&l])}return u},isBuffer:function(e){return!(!e||"object"!==typeof e)&&!!(e.constructor&&e.constructor.isBuffer&&e.constructor.isBuffer(e))},isRegExp:function(e){return"[object RegExp]"===Object.prototype.toString.call(e)},maybeMap:function(e,t){if(o(e)){for(var n=[],r=0;r<e.length;r+=1)n.push(t(e[r]));return n}return t(e)},merge:function e(t,n,r){if(!n)return t;if("object"!==typeof n){if(o(t))t.push(n);else{if(!t||"object"!==typeof t)return[t,n];(r&&(r.plainObjects||r.allowPrototypes)||!i.call(Object.prototype,n))&&(t[n]=!0)}return t}if(!t||"object"!==typeof t)return[t].concat(n);var a=t;return o(t)&&!o(n)&&(a=s(t,r)),o(t)&&o(n)?(n.forEach((function(n,o){if(i.call(t,o)){var a=t[o];a&&"object"===typeof a&&n&&"object"===typeof n?t[o]=e(a,n,r):t.push(n)}else t[o]=n})),t):Object.keys(n).reduce((function(t,o){var a=n[o];return i.call(t,o)?t[o]=e(t[o],a,r):t[o]=a,t}),a)}}},97059:function(e){"use strict";function t(e,t){return Object.prototype.hasOwnProperty.call(e,t)}e.exports=function(e,n,r,i){n=n||"&",r=r||"=";var o={};if("string"!==typeof e||0===e.length)return o;var a=/\+/g;e=e.split(n);var s=1e3;i&&"number"===typeof i.maxKeys&&(s=i.maxKeys);var u=e.length;s>0&&u>s&&(u=s);for(var c=0;c<u;++c){var l,d,h,f,p=e[c].replace(a,"%20"),v=p.indexOf(r);v>=0?(l=p.substr(0,v),d=p.substr(v+1)):(l=p,d=""),h=decodeURIComponent(l),f=decodeURIComponent(d),t(o,h)?Array.isArray(o[h])?o[h].push(f):o[h]=[o[h],f]:o[h]=f}return o}},94297:function(e){"use strict";var t=function(e){switch(typeof e){case"string":return e;case"boolean":return e?"true":"false";case"number":return isFinite(e)?e:"";default:return""}};e.exports=function(e,n,r,i){return n=n||"&",r=r||"=",null===e&&(e=void 0),"object"===typeof e?Object.keys(e).map((function(i){var o=encodeURIComponent(t(i))+r;return Array.isArray(e[i])?e[i].map((function(e){return o+encodeURIComponent(t(e))})).join(n):o+encodeURIComponent(t(e[i]))})).filter(Boolean).join(n):i?encodeURIComponent(t(i))+r+encodeURIComponent(t(e)):""}},30863:function(e,t,n){"use strict";n(97059),t.stringify=n(94297)},96962:function(e,t){"use strict";var n=Object.prototype.hasOwnProperty;function r(e){try{return decodeURIComponent(e.replace(/\+/g," "))}catch(t){return null}}function i(e){try{return encodeURIComponent(e)}catch(t){return null}}t.stringify=function(e,t){t=t||"";var r,o,a=[];for(o in"string"!==typeof t&&(t="?"),e)if(n.call(e,o)){if((r=e[o])||null!==r&&undefined!==r&&!isNaN(r)||(r=""),o=i(o),r=i(r),null===o||null===r)continue;a.push(o+"="+r)}return a.length?t+a.join("&"):""},t.parse=function(e){for(var t,n=/([^=?#&]+)=?([^&]*)/g,i={};t=n.exec(e);){var o=r(t[1]),a=r(t[2]);null===o||null===a||o in i||(i[o]=a)}return i}},34463:function(e,t,n){"use strict";var r=n(72791),i=n(75585);function o(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,n=1;n<arguments.length;n++)t+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var a=new Set,s={};function u(e,t){c(e,t),c(e+"Capture",t)}function c(e,t){for(s[e]=t,e=0;e<t.length;e++)a.add(t[e])}var l=!("undefined"===typeof window||"undefined"===typeof window.document||"undefined"===typeof window.document.createElement),d=Object.prototype.hasOwnProperty,h=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,f={},p={};function v(e,t,n,r,i,o,a){this.acceptsBooleans=2===t||3===t||4===t,this.attributeName=r,this.attributeNamespace=i,this.mustUseProperty=n,this.propertyName=e,this.type=t,this.sanitizeURL=o,this.removeEmptyString=a}var g={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach((function(e){g[e]=new v(e,0,!1,e,null,!1,!1)})),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach((function(e){var t=e[0];g[t]=new v(t,1,!1,e[1],null,!1,!1)})),["contentEditable","draggable","spellCheck","value"].forEach((function(e){g[e]=new v(e,2,!1,e.toLowerCase(),null,!1,!1)})),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach((function(e){g[e]=new v(e,2,!1,e,null,!1,!1)})),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach((function(e){g[e]=new v(e,3,!1,e.toLowerCase(),null,!1,!1)})),["checked","multiple","muted","selected"].forEach((function(e){g[e]=new v(e,3,!0,e,null,!1,!1)})),["capture","download"].forEach((function(e){g[e]=new v(e,4,!1,e,null,!1,!1)})),["cols","rows","size","span"].forEach((function(e){g[e]=new v(e,6,!1,e,null,!1,!1)})),["rowSpan","start"].forEach((function(e){g[e]=new v(e,5,!1,e.toLowerCase(),null,!1,!1)}));var m=/[\-:]([a-z])/g;function y(e){return e[1].toUpperCase()}function b(e,t,n,r){var i=g.hasOwnProperty(t)?g[t]:null;(null!==i?0!==i.type:r||!(2<t.length)||"o"!==t[0]&&"O"!==t[0]||"n"!==t[1]&&"N"!==t[1])&&(function(e,t,n,r){if(null===t||"undefined"===typeof t||function(e,t,n,r){if(null!==n&&0===n.type)return!1;switch(typeof t){case"function":case"symbol":return!0;case"boolean":return!r&&(null!==n?!n.acceptsBooleans:"data-"!==(e=e.toLowerCase().slice(0,5))&&"aria-"!==e);default:return!1}}(e,t,n,r))return!0;if(r)return!1;if(null!==n)switch(n.type){case 3:return!t;case 4:return!1===t;case 5:return isNaN(t);case 6:return isNaN(t)||1>t}return!1}(t,n,i,r)&&(n=null),r||null===i?function(e){return!!d.call(p,e)||!d.call(f,e)&&(h.test(e)?p[e]=!0:(f[e]=!0,!1))}(t)&&(null===n?e.removeAttribute(t):e.setAttribute(t,""+n)):i.mustUseProperty?e[i.propertyName]=null===n?3!==i.type&&"":n:(t=i.attributeName,r=i.attributeNamespace,null===n?e.removeAttribute(t):(n=3===(i=i.type)||4===i&&!0===n?"":""+n,r?e.setAttributeNS(r,t,n):e.setAttribute(t,n))))}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach((function(e){var t=e.replace(m,y);g[t]=new v(t,1,!1,e,null,!1,!1)})),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach((function(e){var t=e.replace(m,y);g[t]=new v(t,1,!1,e,"http://www.w3.org/1999/xlink",!1,!1)})),["xml:base","xml:lang","xml:space"].forEach((function(e){var t=e.replace(m,y);g[t]=new v(t,1,!1,e,"http://www.w3.org/XML/1998/namespace",!1,!1)})),["tabIndex","crossOrigin"].forEach((function(e){g[e]=new v(e,1,!1,e.toLowerCase(),null,!1,!1)})),g.xlinkHref=new v("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach((function(e){g[e]=new v(e,1,!1,e.toLowerCase(),null,!0,!0)}));var w=r.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,S=Symbol.for("react.element"),k=Symbol.for("react.portal"),C=Symbol.for("react.fragment"),x=Symbol.for("react.strict_mode"),E=Symbol.for("react.profiler"),T=Symbol.for("react.provider"),I=Symbol.for("react.context"),A=Symbol.for("react.forward_ref"),R=Symbol.for("react.suspense"),_=Symbol.for("react.suspense_list"),P=Symbol.for("react.memo"),N=Symbol.for("react.lazy");Symbol.for("react.scope"),Symbol.for("react.debug_trace_mode");var O=Symbol.for("react.offscreen");Symbol.for("react.legacy_hidden"),Symbol.for("react.cache"),Symbol.for("react.tracing_marker");var M=Symbol.iterator;function F(e){return null===e||"object"!==typeof e?null:"function"===typeof(e=M&&e[M]||e["@@iterator"])?e:null}var Z,D=Object.assign;function L(e){if(void 0===Z)try{throw Error()}catch(n){var t=n.stack.trim().match(/\n( *(at )?)/);Z=t&&t[1]||""}return"\n"+Z+e}var B=!1;function q(e,t){if(!e||B)return"";B=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(t)if(t=function(){throw Error()},Object.defineProperty(t.prototype,"props",{set:function(){throw Error()}}),"object"===typeof Reflect&&Reflect.construct){try{Reflect.construct(t,[])}catch(c){var r=c}Reflect.construct(e,[],t)}else{try{t.call()}catch(c){r=c}e.call(t.prototype)}else{try{throw Error()}catch(c){r=c}e()}}catch(c){if(c&&r&&"string"===typeof c.stack){for(var i=c.stack.split("\n"),o=r.stack.split("\n"),a=i.length-1,s=o.length-1;1<=a&&0<=s&&i[a]!==o[s];)s--;for(;1<=a&&0<=s;a--,s--)if(i[a]!==o[s]){if(1!==a||1!==s)do{if(a--,0>--s||i[a]!==o[s]){var u="\n"+i[a].replace(" at new "," at ");return e.displayName&&u.includes("<anonymous>")&&(u=u.replace("<anonymous>",e.displayName)),u}}while(1<=a&&0<=s);break}}}finally{B=!1,Error.prepareStackTrace=n}return(e=e?e.displayName||e.name:"")?L(e):""}function j(e){switch(e.tag){case 5:return L(e.type);case 16:return L("Lazy");case 13:return L("Suspense");case 19:return L("SuspenseList");case 0:case 2:case 15:return e=q(e.type,!1);case 11:return e=q(e.type.render,!1);case 1:return e=q(e.type,!0);default:return""}}function U(e){if(null==e)return null;if("function"===typeof e)return e.displayName||e.name||null;if("string"===typeof e)return e;switch(e){case C:return"Fragment";case k:return"Portal";case E:return"Profiler";case x:return"StrictMode";case R:return"Suspense";case _:return"SuspenseList"}if("object"===typeof e)switch(e.$$typeof){case I:return(e.displayName||"Context")+".Consumer";case T:return(e._context.displayName||"Context")+".Provider";case A:var t=e.render;return(e=e.displayName)||(e=""!==(e=t.displayName||t.name||"")?"ForwardRef("+e+")":"ForwardRef"),e;case P:return null!==(t=e.displayName||null)?t:U(e.type)||"Memo";case N:t=e._payload,e=e._init;try{return U(e(t))}catch(n){}}return null}function H(e){var t=e.type;switch(e.tag){case 24:return"Cache";case 9:return(t.displayName||"Context")+".Consumer";case 10:return(t._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return e=(e=t.render).displayName||e.name||"",t.displayName||(""!==e?"ForwardRef("+e+")":"ForwardRef");case 7:return"Fragment";case 5:return t;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return U(t);case 8:return t===x?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if("function"===typeof t)return t.displayName||t.name||null;if("string"===typeof t)return t}return null}function z(e){switch(typeof e){case"boolean":case"number":case"string":case"undefined":case"object":return e;default:return""}}function V(e){var t=e.type;return(e=e.nodeName)&&"input"===e.toLowerCase()&&("checkbox"===t||"radio"===t)}function G(e){e._valueTracker||(e._valueTracker=function(e){var t=V(e)?"checked":"value",n=Object.getOwnPropertyDescriptor(e.constructor.prototype,t),r=""+e[t];if(!e.hasOwnProperty(t)&&"undefined"!==typeof n&&"function"===typeof n.get&&"function"===typeof n.set){var i=n.get,o=n.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return i.call(this)},set:function(e){r=""+e,o.call(this,e)}}),Object.defineProperty(e,t,{enumerable:n.enumerable}),{getValue:function(){return r},setValue:function(e){r=""+e},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}(e))}function K(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var n=t.getValue(),r="";return e&&(r=V(e)?e.checked?"true":"false":e.value),(e=r)!==n&&(t.setValue(e),!0)}function W(e){if("undefined"===typeof(e=e||("undefined"!==typeof document?document:void 0)))return null;try{return e.activeElement||e.body}catch(t){return e.body}}function J(e,t){var n=t.checked;return D({},t,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:null!=n?n:e._wrapperState.initialChecked})}function Q(e,t){var n=null==t.defaultValue?"":t.defaultValue,r=null!=t.checked?t.checked:t.defaultChecked;n=z(null!=t.value?t.value:n),e._wrapperState={initialChecked:r,initialValue:n,controlled:"checkbox"===t.type||"radio"===t.type?null!=t.checked:null!=t.value}}function Y(e,t){null!=(t=t.checked)&&b(e,"checked",t,!1)}function X(e,t){Y(e,t);var n=z(t.value),r=t.type;if(null!=n)"number"===r?(0===n&&""===e.value||e.value!=n)&&(e.value=""+n):e.value!==""+n&&(e.value=""+n);else if("submit"===r||"reset"===r)return void e.removeAttribute("value");t.hasOwnProperty("value")?ee(e,t.type,n):t.hasOwnProperty("defaultValue")&&ee(e,t.type,z(t.defaultValue)),null==t.checked&&null!=t.defaultChecked&&(e.defaultChecked=!!t.defaultChecked)}function $(e,t,n){if(t.hasOwnProperty("value")||t.hasOwnProperty("defaultValue")){var r=t.type;if(!("submit"!==r&&"reset"!==r||void 0!==t.value&&null!==t.value))return;t=""+e._wrapperState.initialValue,n||t===e.value||(e.value=t),e.defaultValue=t}""!==(n=e.name)&&(e.name=""),e.defaultChecked=!!e._wrapperState.initialChecked,""!==n&&(e.name=n)}function ee(e,t,n){"number"===t&&W(e.ownerDocument)===e||(null==n?e.defaultValue=""+e._wrapperState.initialValue:e.defaultValue!==""+n&&(e.defaultValue=""+n))}var te=Array.isArray;function ne(e,t,n,r){if(e=e.options,t){t={};for(var i=0;i<n.length;i++)t["$"+n[i]]=!0;for(n=0;n<e.length;n++)i=t.hasOwnProperty("$"+e[n].value),e[n].selected!==i&&(e[n].selected=i),i&&r&&(e[n].defaultSelected=!0)}else{for(n=""+z(n),t=null,i=0;i<e.length;i++){if(e[i].value===n)return e[i].selected=!0,void(r&&(e[i].defaultSelected=!0));null!==t||e[i].disabled||(t=e[i])}null!==t&&(t.selected=!0)}}function re(e,t){if(null!=t.dangerouslySetInnerHTML)throw Error(o(91));return D({},t,{value:void 0,defaultValue:void 0,children:""+e._wrapperState.initialValue})}function ie(e,t){var n=t.value;if(null==n){if(n=t.children,t=t.defaultValue,null!=n){if(null!=t)throw Error(o(92));if(te(n)){if(1<n.length)throw Error(o(93));n=n[0]}t=n}null==t&&(t=""),n=t}e._wrapperState={initialValue:z(n)}}function oe(e,t){var n=z(t.value),r=z(t.defaultValue);null!=n&&((n=""+n)!==e.value&&(e.value=n),null==t.defaultValue&&e.defaultValue!==n&&(e.defaultValue=n)),null!=r&&(e.defaultValue=""+r)}function ae(e){var t=e.textContent;t===e._wrapperState.initialValue&&""!==t&&null!==t&&(e.value=t)}function se(e){switch(e){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function ue(e,t){return null==e||"http://www.w3.org/1999/xhtml"===e?se(t):"http://www.w3.org/2000/svg"===e&&"foreignObject"===t?"http://www.w3.org/1999/xhtml":e}var ce,le,de=(le=function(e,t){if("http://www.w3.org/2000/svg"!==e.namespaceURI||"innerHTML"in e)e.innerHTML=t;else{for((ce=ce||document.createElement("div")).innerHTML="<svg>"+t.valueOf().toString()+"</svg>",t=ce.firstChild;e.firstChild;)e.removeChild(e.firstChild);for(;t.firstChild;)e.appendChild(t.firstChild)}},"undefined"!==typeof MSApp&&MSApp.execUnsafeLocalFunction?function(e,t,n,r){MSApp.execUnsafeLocalFunction((function(){return le(e,t)}))}:le);function he(e,t){if(t){var n=e.firstChild;if(n&&n===e.lastChild&&3===n.nodeType)return void(n.nodeValue=t)}e.textContent=t}var fe={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},pe=["Webkit","ms","Moz","O"];function ve(e,t,n){return null==t||"boolean"===typeof t||""===t?"":n||"number"!==typeof t||0===t||fe.hasOwnProperty(e)&&fe[e]?(""+t).trim():t+"px"}function ge(e,t){for(var n in e=e.style,t)if(t.hasOwnProperty(n)){var r=0===n.indexOf("--"),i=ve(n,t[n],r);"float"===n&&(n="cssFloat"),r?e.setProperty(n,i):e[n]=i}}Object.keys(fe).forEach((function(e){pe.forEach((function(t){t=t+e.charAt(0).toUpperCase()+e.substring(1),fe[t]=fe[e]}))}));var me=D({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function ye(e,t){if(t){if(me[e]&&(null!=t.children||null!=t.dangerouslySetInnerHTML))throw Error(o(137,e));if(null!=t.dangerouslySetInnerHTML){if(null!=t.children)throw Error(o(60));if("object"!==typeof t.dangerouslySetInnerHTML||!("__html"in t.dangerouslySetInnerHTML))throw Error(o(61))}if(null!=t.style&&"object"!==typeof t.style)throw Error(o(62))}}function be(e,t){if(-1===e.indexOf("-"))return"string"===typeof t.is;switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var we=null;function Se(e){return(e=e.target||e.srcElement||window).correspondingUseElement&&(e=e.correspondingUseElement),3===e.nodeType?e.parentNode:e}var ke=null,Ce=null,xe=null;function Ee(e){if(e=bi(e)){if("function"!==typeof ke)throw Error(o(280));var t=e.stateNode;t&&(t=Si(t),ke(e.stateNode,e.type,t))}}function Te(e){Ce?xe?xe.push(e):xe=[e]:Ce=e}function Ie(){if(Ce){var e=Ce,t=xe;if(xe=Ce=null,Ee(e),t)for(e=0;e<t.length;e++)Ee(t[e])}}function Ae(e,t){return e(t)}function Re(){}var _e=!1;function Pe(e,t,n){if(_e)return e(t,n);_e=!0;try{return Ae(e,t,n)}finally{_e=!1,(null!==Ce||null!==xe)&&(Re(),Ie())}}function Ne(e,t){var n=e.stateNode;if(null===n)return null;var r=Si(n);if(null===r)return null;n=r[t];e:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(r=!r.disabled)||(r=!("button"===(e=e.type)||"input"===e||"select"===e||"textarea"===e)),e=!r;break e;default:e=!1}if(e)return null;if(n&&"function"!==typeof n)throw Error(o(231,t,typeof n));return n}var Oe=!1;if(l)try{var Me={};Object.defineProperty(Me,"passive",{get:function(){Oe=!0}}),window.addEventListener("test",Me,Me),window.removeEventListener("test",Me,Me)}catch(le){Oe=!1}function Fe(e,t,n,r,i,o,a,s,u){var c=Array.prototype.slice.call(arguments,3);try{t.apply(n,c)}catch(l){this.onError(l)}}var Ze=!1,De=null,Le=!1,Be=null,qe={onError:function(e){Ze=!0,De=e}};function je(e,t,n,r,i,o,a,s,u){Ze=!1,De=null,Fe.apply(qe,arguments)}function Ue(e){var t=e,n=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do{0!==(4098&(t=e).flags)&&(n=t.return),e=t.return}while(e)}return 3===t.tag?n:null}function He(e){if(13===e.tag){var t=e.memoizedState;if(null===t&&(null!==(e=e.alternate)&&(t=e.memoizedState)),null!==t)return t.dehydrated}return null}function ze(e){if(Ue(e)!==e)throw Error(o(188))}function Ve(e){return null!==(e=function(e){var t=e.alternate;if(!t){if(null===(t=Ue(e)))throw Error(o(188));return t!==e?null:e}for(var n=e,r=t;;){var i=n.return;if(null===i)break;var a=i.alternate;if(null===a){if(null!==(r=i.return)){n=r;continue}break}if(i.child===a.child){for(a=i.child;a;){if(a===n)return ze(i),e;if(a===r)return ze(i),t;a=a.sibling}throw Error(o(188))}if(n.return!==r.return)n=i,r=a;else{for(var s=!1,u=i.child;u;){if(u===n){s=!0,n=i,r=a;break}if(u===r){s=!0,r=i,n=a;break}u=u.sibling}if(!s){for(u=a.child;u;){if(u===n){s=!0,n=a,r=i;break}if(u===r){s=!0,r=a,n=i;break}u=u.sibling}if(!s)throw Error(o(189))}}if(n.alternate!==r)throw Error(o(190))}if(3!==n.tag)throw Error(o(188));return n.stateNode.current===n?e:t}(e))?Ge(e):null}function Ge(e){if(5===e.tag||6===e.tag)return e;for(e=e.child;null!==e;){var t=Ge(e);if(null!==t)return t;e=e.sibling}return null}var Ke=i.unstable_scheduleCallback,We=i.unstable_cancelCallback,Je=i.unstable_shouldYield,Qe=i.unstable_requestPaint,Ye=i.unstable_now,Xe=i.unstable_getCurrentPriorityLevel,$e=i.unstable_ImmediatePriority,et=i.unstable_UserBlockingPriority,tt=i.unstable_NormalPriority,nt=i.unstable_LowPriority,rt=i.unstable_IdlePriority,it=null,ot=null;var at=Math.clz32?Math.clz32:function(e){return e>>>=0,0===e?32:31-(st(e)/ut|0)|0},st=Math.log,ut=Math.LN2;var ct=64,lt=4194304;function dt(e){switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return 4194240&e;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return 130023424&e;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return e}}function ht(e,t){var n=e.pendingLanes;if(0===n)return 0;var r=0,i=e.suspendedLanes,o=e.pingedLanes,a=268435455&n;if(0!==a){var s=a&~i;0!==s?r=dt(s):0!==(o&=a)&&(r=dt(o))}else 0!==(a=n&~i)?r=dt(a):0!==o&&(r=dt(o));if(0===r)return 0;if(0!==t&&t!==r&&0===(t&i)&&((i=r&-r)>=(o=t&-t)||16===i&&0!==(4194240&o)))return t;if(0!==(4&r)&&(r|=16&n),0!==(t=e.entangledLanes))for(e=e.entanglements,t&=r;0<t;)i=1<<(n=31-at(t)),r|=e[n],t&=~i;return r}function ft(e,t){switch(e){case 1:case 2:case 4:return t+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t+5e3;default:return-1}}function pt(e){return 0!==(e=-1073741825&e.pendingLanes)?e:1073741824&e?1073741824:0}function vt(){var e=ct;return 0===(4194240&(ct<<=1))&&(ct=64),e}function gt(e){for(var t=[],n=0;31>n;n++)t.push(e);return t}function mt(e,t,n){e.pendingLanes|=t,536870912!==t&&(e.suspendedLanes=0,e.pingedLanes=0),(e=e.eventTimes)[t=31-at(t)]=n}function yt(e,t){var n=e.entangledLanes|=t;for(e=e.entanglements;n;){var r=31-at(n),i=1<<r;i&t|e[r]&t&&(e[r]|=t),n&=~i}}var bt=0;function wt(e){return 1<(e&=-e)?4<e?0!==(268435455&e)?16:536870912:4:1}var St,kt,Ct,xt,Et,Tt=!1,It=[],At=null,Rt=null,_t=null,Pt=new Map,Nt=new Map,Ot=[],Mt="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Ft(e,t){switch(e){case"focusin":case"focusout":At=null;break;case"dragenter":case"dragleave":Rt=null;break;case"mouseover":case"mouseout":_t=null;break;case"pointerover":case"pointerout":Pt.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":Nt.delete(t.pointerId)}}function Zt(e,t,n,r,i,o){return null===e||e.nativeEvent!==o?(e={blockedOn:t,domEventName:n,eventSystemFlags:r,nativeEvent:o,targetContainers:[i]},null!==t&&(null!==(t=bi(t))&&kt(t)),e):(e.eventSystemFlags|=r,t=e.targetContainers,null!==i&&-1===t.indexOf(i)&&t.push(i),e)}function Dt(e){var t=yi(e.target);if(null!==t){var n=Ue(t);if(null!==n)if(13===(t=n.tag)){if(null!==(t=He(n)))return e.blockedOn=t,void Et(e.priority,(function(){Ct(n)}))}else if(3===t&&n.stateNode.current.memoizedState.isDehydrated)return void(e.blockedOn=3===n.tag?n.stateNode.containerInfo:null)}e.blockedOn=null}function Lt(e){if(null!==e.blockedOn)return!1;for(var t=e.targetContainers;0<t.length;){var n=Jt(e.domEventName,e.eventSystemFlags,t[0],e.nativeEvent);if(null!==n)return null!==(t=bi(n))&&kt(t),e.blockedOn=n,!1;var r=new(n=e.nativeEvent).constructor(n.type,n);we=r,n.target.dispatchEvent(r),we=null,t.shift()}return!0}function Bt(e,t,n){Lt(e)&&n.delete(t)}function qt(){Tt=!1,null!==At&&Lt(At)&&(At=null),null!==Rt&&Lt(Rt)&&(Rt=null),null!==_t&&Lt(_t)&&(_t=null),Pt.forEach(Bt),Nt.forEach(Bt)}function jt(e,t){e.blockedOn===t&&(e.blockedOn=null,Tt||(Tt=!0,i.unstable_scheduleCallback(i.unstable_NormalPriority,qt)))}function Ut(e){function t(t){return jt(t,e)}if(0<It.length){jt(It[0],e);for(var n=1;n<It.length;n++){var r=It[n];r.blockedOn===e&&(r.blockedOn=null)}}for(null!==At&&jt(At,e),null!==Rt&&jt(Rt,e),null!==_t&&jt(_t,e),Pt.forEach(t),Nt.forEach(t),n=0;n<Ot.length;n++)(r=Ot[n]).blockedOn===e&&(r.blockedOn=null);for(;0<Ot.length&&null===(n=Ot[0]).blockedOn;)Dt(n),null===n.blockedOn&&Ot.shift()}var Ht=w.ReactCurrentBatchConfig,zt=!0;function Vt(e,t,n,r){var i=bt,o=Ht.transition;Ht.transition=null;try{bt=1,Kt(e,t,n,r)}finally{bt=i,Ht.transition=o}}function Gt(e,t,n,r){var i=bt,o=Ht.transition;Ht.transition=null;try{bt=4,Kt(e,t,n,r)}finally{bt=i,Ht.transition=o}}function Kt(e,t,n,r){if(zt){var i=Jt(e,t,n,r);if(null===i)zr(e,t,r,Wt,n),Ft(e,r);else if(function(e,t,n,r,i){switch(t){case"focusin":return At=Zt(At,e,t,n,r,i),!0;case"dragenter":return Rt=Zt(Rt,e,t,n,r,i),!0;case"mouseover":return _t=Zt(_t,e,t,n,r,i),!0;case"pointerover":var o=i.pointerId;return Pt.set(o,Zt(Pt.get(o)||null,e,t,n,r,i)),!0;case"gotpointercapture":return o=i.pointerId,Nt.set(o,Zt(Nt.get(o)||null,e,t,n,r,i)),!0}return!1}(i,e,t,n,r))r.stopPropagation();else if(Ft(e,r),4&t&&-1<Mt.indexOf(e)){for(;null!==i;){var o=bi(i);if(null!==o&&St(o),null===(o=Jt(e,t,n,r))&&zr(e,t,r,Wt,n),o===i)break;i=o}null!==i&&r.stopPropagation()}else zr(e,t,r,null,n)}}var Wt=null;function Jt(e,t,n,r){if(Wt=null,null!==(e=yi(e=Se(r))))if(null===(t=Ue(e)))e=null;else if(13===(n=t.tag)){if(null!==(e=He(t)))return e;e=null}else if(3===n){if(t.stateNode.current.memoizedState.isDehydrated)return 3===t.tag?t.stateNode.containerInfo:null;e=null}else t!==e&&(e=null);return Wt=e,null}function Qt(e){switch(e){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(Xe()){case $e:return 1;case et:return 4;case tt:case nt:return 16;case rt:return 536870912;default:return 16}default:return 16}}var Yt=null,Xt=null,$t=null;function en(){if($t)return $t;var e,t,n=Xt,r=n.length,i="value"in Yt?Yt.value:Yt.textContent,o=i.length;for(e=0;e<r&&n[e]===i[e];e++);var a=r-e;for(t=1;t<=a&&n[r-t]===i[o-t];t++);return $t=i.slice(e,1<t?1-t:void 0)}function tn(e){var t=e.keyCode;return"charCode"in e?0===(e=e.charCode)&&13===t&&(e=13):e=t,10===e&&(e=13),32<=e||13===e?e:0}function nn(){return!0}function rn(){return!1}function on(e){function t(t,n,r,i,o){for(var a in this._reactName=t,this._targetInst=r,this.type=n,this.nativeEvent=i,this.target=o,this.currentTarget=null,e)e.hasOwnProperty(a)&&(t=e[a],this[a]=t?t(i):i[a]);return this.isDefaultPrevented=(null!=i.defaultPrevented?i.defaultPrevented:!1===i.returnValue)?nn:rn,this.isPropagationStopped=rn,this}return D(t.prototype,{preventDefault:function(){this.defaultPrevented=!0;var e=this.nativeEvent;e&&(e.preventDefault?e.preventDefault():"unknown"!==typeof e.returnValue&&(e.returnValue=!1),this.isDefaultPrevented=nn)},stopPropagation:function(){var e=this.nativeEvent;e&&(e.stopPropagation?e.stopPropagation():"unknown"!==typeof e.cancelBubble&&(e.cancelBubble=!0),this.isPropagationStopped=nn)},persist:function(){},isPersistent:nn}),t}var an,sn,un,cn={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},ln=on(cn),dn=D({},cn,{view:0,detail:0}),hn=on(dn),fn=D({},dn,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:En,button:0,buttons:0,relatedTarget:function(e){return void 0===e.relatedTarget?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==un&&(un&&"mousemove"===e.type?(an=e.screenX-un.screenX,sn=e.screenY-un.screenY):sn=an=0,un=e),an)},movementY:function(e){return"movementY"in e?e.movementY:sn}}),pn=on(fn),vn=on(D({},fn,{dataTransfer:0})),gn=on(D({},dn,{relatedTarget:0})),mn=on(D({},cn,{animationName:0,elapsedTime:0,pseudoElement:0})),yn=D({},cn,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),bn=on(yn),wn=on(D({},cn,{data:0})),Sn={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},kn={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Cn={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function xn(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):!!(e=Cn[e])&&!!t[e]}function En(){return xn}var Tn=D({},dn,{key:function(e){if(e.key){var t=Sn[e.key]||e.key;if("Unidentified"!==t)return t}return"keypress"===e.type?13===(e=tn(e))?"Enter":String.fromCharCode(e):"keydown"===e.type||"keyup"===e.type?kn[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:En,charCode:function(e){return"keypress"===e.type?tn(e):0},keyCode:function(e){return"keydown"===e.type||"keyup"===e.type?e.keyCode:0},which:function(e){return"keypress"===e.type?tn(e):"keydown"===e.type||"keyup"===e.type?e.keyCode:0}}),In=on(Tn),An=on(D({},fn,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0})),Rn=on(D({},dn,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:En})),_n=on(D({},cn,{propertyName:0,elapsedTime:0,pseudoElement:0})),Pn=D({},fn,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0}),Nn=on(Pn),On=[9,13,27,32],Mn=l&&"CompositionEvent"in window,Fn=null;l&&"documentMode"in document&&(Fn=document.documentMode);var Zn=l&&"TextEvent"in window&&!Fn,Dn=l&&(!Mn||Fn&&8<Fn&&11>=Fn),Ln=String.fromCharCode(32),Bn=!1;function qn(e,t){switch(e){case"keyup":return-1!==On.indexOf(t.keyCode);case"keydown":return 229!==t.keyCode;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function jn(e){return"object"===typeof(e=e.detail)&&"data"in e?e.data:null}var Un=!1;var Hn={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function zn(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return"input"===t?!!Hn[e.type]:"textarea"===t}function Vn(e,t,n,r){Te(r),0<(t=Gr(t,"onChange")).length&&(n=new ln("onChange","change",null,n,r),e.push({event:n,listeners:t}))}var Gn=null,Kn=null;function Wn(e){Lr(e,0)}function Jn(e){if(K(wi(e)))return e}function Qn(e,t){if("change"===e)return t}var Yn=!1;if(l){var Xn;if(l){var $n="oninput"in document;if(!$n){var er=document.createElement("div");er.setAttribute("oninput","return;"),$n="function"===typeof er.oninput}Xn=$n}else Xn=!1;Yn=Xn&&(!document.documentMode||9<document.documentMode)}function tr(){Gn&&(Gn.detachEvent("onpropertychange",nr),Kn=Gn=null)}function nr(e){if("value"===e.propertyName&&Jn(Kn)){var t=[];Vn(t,Kn,e,Se(e)),Pe(Wn,t)}}function rr(e,t,n){"focusin"===e?(tr(),Kn=n,(Gn=t).attachEvent("onpropertychange",nr)):"focusout"===e&&tr()}function ir(e){if("selectionchange"===e||"keyup"===e||"keydown"===e)return Jn(Kn)}function or(e,t){if("click"===e)return Jn(t)}function ar(e,t){if("input"===e||"change"===e)return Jn(t)}var sr="function"===typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e===1/t)||e!==e&&t!==t};function ur(e,t){if(sr(e,t))return!0;if("object"!==typeof e||null===e||"object"!==typeof t||null===t)return!1;var n=Object.keys(e),r=Object.keys(t);if(n.length!==r.length)return!1;for(r=0;r<n.length;r++){var i=n[r];if(!d.call(t,i)||!sr(e[i],t[i]))return!1}return!0}function cr(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function lr(e,t){var n,r=cr(e);for(e=0;r;){if(3===r.nodeType){if(n=e+r.textContent.length,e<=t&&n>=t)return{node:r,offset:t-e};e=n}e:{for(;r;){if(r.nextSibling){r=r.nextSibling;break e}r=r.parentNode}r=void 0}r=cr(r)}}function dr(e,t){return!(!e||!t)&&(e===t||(!e||3!==e.nodeType)&&(t&&3===t.nodeType?dr(e,t.parentNode):"contains"in e?e.contains(t):!!e.compareDocumentPosition&&!!(16&e.compareDocumentPosition(t))))}function hr(){for(var e=window,t=W();t instanceof e.HTMLIFrameElement;){try{var n="string"===typeof t.contentWindow.location.href}catch(r){n=!1}if(!n)break;t=W((e=t.contentWindow).document)}return t}function fr(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&("input"===t&&("text"===e.type||"search"===e.type||"tel"===e.type||"url"===e.type||"password"===e.type)||"textarea"===t||"true"===e.contentEditable)}function pr(e){var t=hr(),n=e.focusedElem,r=e.selectionRange;if(t!==n&&n&&n.ownerDocument&&dr(n.ownerDocument.documentElement,n)){if(null!==r&&fr(n))if(t=r.start,void 0===(e=r.end)&&(e=t),"selectionStart"in n)n.selectionStart=t,n.selectionEnd=Math.min(e,n.value.length);else if((e=(t=n.ownerDocument||document)&&t.defaultView||window).getSelection){e=e.getSelection();var i=n.textContent.length,o=Math.min(r.start,i);r=void 0===r.end?o:Math.min(r.end,i),!e.extend&&o>r&&(i=r,r=o,o=i),i=lr(n,o);var a=lr(n,r);i&&a&&(1!==e.rangeCount||e.anchorNode!==i.node||e.anchorOffset!==i.offset||e.focusNode!==a.node||e.focusOffset!==a.offset)&&((t=t.createRange()).setStart(i.node,i.offset),e.removeAllRanges(),o>r?(e.addRange(t),e.extend(a.node,a.offset)):(t.setEnd(a.node,a.offset),e.addRange(t)))}for(t=[],e=n;e=e.parentNode;)1===e.nodeType&&t.push({element:e,left:e.scrollLeft,top:e.scrollTop});for("function"===typeof n.focus&&n.focus(),n=0;n<t.length;n++)(e=t[n]).element.scrollLeft=e.left,e.element.scrollTop=e.top}}var vr=l&&"documentMode"in document&&11>=document.documentMode,gr=null,mr=null,yr=null,br=!1;function wr(e,t,n){var r=n.window===n?n.document:9===n.nodeType?n:n.ownerDocument;br||null==gr||gr!==W(r)||("selectionStart"in(r=gr)&&fr(r)?r={start:r.selectionStart,end:r.selectionEnd}:r={anchorNode:(r=(r.ownerDocument&&r.ownerDocument.defaultView||window).getSelection()).anchorNode,anchorOffset:r.anchorOffset,focusNode:r.focusNode,focusOffset:r.focusOffset},yr&&ur(yr,r)||(yr=r,0<(r=Gr(mr,"onSelect")).length&&(t=new ln("onSelect","select",null,t,n),e.push({event:t,listeners:r}),t.target=gr)))}function Sr(e,t){var n={};return n[e.toLowerCase()]=t.toLowerCase(),n["Webkit"+e]="webkit"+t,n["Moz"+e]="moz"+t,n}var kr={animationend:Sr("Animation","AnimationEnd"),animationiteration:Sr("Animation","AnimationIteration"),animationstart:Sr("Animation","AnimationStart"),transitionend:Sr("Transition","TransitionEnd")},Cr={},xr={};function Er(e){if(Cr[e])return Cr[e];if(!kr[e])return e;var t,n=kr[e];for(t in n)if(n.hasOwnProperty(t)&&t in xr)return Cr[e]=n[t];return e}l&&(xr=document.createElement("div").style,"AnimationEvent"in window||(delete kr.animationend.animation,delete kr.animationiteration.animation,delete kr.animationstart.animation),"TransitionEvent"in window||delete kr.transitionend.transition);var Tr=Er("animationend"),Ir=Er("animationiteration"),Ar=Er("animationstart"),Rr=Er("transitionend"),_r=new Map,Pr="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Nr(e,t){_r.set(e,t),u(t,[e])}for(var Or=0;Or<Pr.length;Or++){var Mr=Pr[Or];Nr(Mr.toLowerCase(),"on"+(Mr[0].toUpperCase()+Mr.slice(1)))}Nr(Tr,"onAnimationEnd"),Nr(Ir,"onAnimationIteration"),Nr(Ar,"onAnimationStart"),Nr("dblclick","onDoubleClick"),Nr("focusin","onFocus"),Nr("focusout","onBlur"),Nr(Rr,"onTransitionEnd"),c("onMouseEnter",["mouseout","mouseover"]),c("onMouseLeave",["mouseout","mouseover"]),c("onPointerEnter",["pointerout","pointerover"]),c("onPointerLeave",["pointerout","pointerover"]),u("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),u("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),u("onBeforeInput",["compositionend","keypress","textInput","paste"]),u("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),u("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),u("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Fr="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Zr=new Set("cancel close invalid load scroll toggle".split(" ").concat(Fr));function Dr(e,t,n){var r=e.type||"unknown-event";e.currentTarget=n,function(e,t,n,r,i,a,s,u,c){if(je.apply(this,arguments),Ze){if(!Ze)throw Error(o(198));var l=De;Ze=!1,De=null,Le||(Le=!0,Be=l)}}(r,t,void 0,e),e.currentTarget=null}function Lr(e,t){t=0!==(4&t);for(var n=0;n<e.length;n++){var r=e[n],i=r.event;r=r.listeners;e:{var o=void 0;if(t)for(var a=r.length-1;0<=a;a--){var s=r[a],u=s.instance,c=s.currentTarget;if(s=s.listener,u!==o&&i.isPropagationStopped())break e;Dr(i,s,c),o=u}else for(a=0;a<r.length;a++){if(u=(s=r[a]).instance,c=s.currentTarget,s=s.listener,u!==o&&i.isPropagationStopped())break e;Dr(i,s,c),o=u}}}if(Le)throw e=Be,Le=!1,Be=null,e}function Br(e,t){var n=t[vi];void 0===n&&(n=t[vi]=new Set);var r=e+"__bubble";n.has(r)||(Hr(t,e,2,!1),n.add(r))}function qr(e,t,n){var r=0;t&&(r|=4),Hr(n,e,r,t)}var jr="_reactListening"+Math.random().toString(36).slice(2);function Ur(e){if(!e[jr]){e[jr]=!0,a.forEach((function(t){"selectionchange"!==t&&(Zr.has(t)||qr(t,!1,e),qr(t,!0,e))}));var t=9===e.nodeType?e:e.ownerDocument;null===t||t[jr]||(t[jr]=!0,qr("selectionchange",!1,t))}}function Hr(e,t,n,r){switch(Qt(t)){case 1:var i=Vt;break;case 4:i=Gt;break;default:i=Kt}n=i.bind(null,t,n,e),i=void 0,!Oe||"touchstart"!==t&&"touchmove"!==t&&"wheel"!==t||(i=!0),r?void 0!==i?e.addEventListener(t,n,{capture:!0,passive:i}):e.addEventListener(t,n,!0):void 0!==i?e.addEventListener(t,n,{passive:i}):e.addEventListener(t,n,!1)}function zr(e,t,n,r,i){var o=r;if(0===(1&t)&&0===(2&t)&&null!==r)e:for(;;){if(null===r)return;var a=r.tag;if(3===a||4===a){var s=r.stateNode.containerInfo;if(s===i||8===s.nodeType&&s.parentNode===i)break;if(4===a)for(a=r.return;null!==a;){var u=a.tag;if((3===u||4===u)&&((u=a.stateNode.containerInfo)===i||8===u.nodeType&&u.parentNode===i))return;a=a.return}for(;null!==s;){if(null===(a=yi(s)))return;if(5===(u=a.tag)||6===u){r=o=a;continue e}s=s.parentNode}}r=r.return}Pe((function(){var r=o,i=Se(n),a=[];e:{var s=_r.get(e);if(void 0!==s){var u=ln,c=e;switch(e){case"keypress":if(0===tn(n))break e;case"keydown":case"keyup":u=In;break;case"focusin":c="focus",u=gn;break;case"focusout":c="blur",u=gn;break;case"beforeblur":case"afterblur":u=gn;break;case"click":if(2===n.button)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":u=pn;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":u=vn;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":u=Rn;break;case Tr:case Ir:case Ar:u=mn;break;case Rr:u=_n;break;case"scroll":u=hn;break;case"wheel":u=Nn;break;case"copy":case"cut":case"paste":u=bn;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":u=An}var l=0!==(4&t),d=!l&&"scroll"===e,h=l?null!==s?s+"Capture":null:s;l=[];for(var f,p=r;null!==p;){var v=(f=p).stateNode;if(5===f.tag&&null!==v&&(f=v,null!==h&&(null!=(v=Ne(p,h))&&l.push(Vr(p,v,f)))),d)break;p=p.return}0<l.length&&(s=new u(s,c,null,n,i),a.push({event:s,listeners:l}))}}if(0===(7&t)){if(u="mouseout"===e||"pointerout"===e,(!(s="mouseover"===e||"pointerover"===e)||n===we||!(c=n.relatedTarget||n.fromElement)||!yi(c)&&!c[pi])&&(u||s)&&(s=i.window===i?i:(s=i.ownerDocument)?s.defaultView||s.parentWindow:window,u?(u=r,null!==(c=(c=n.relatedTarget||n.toElement)?yi(c):null)&&(c!==(d=Ue(c))||5!==c.tag&&6!==c.tag)&&(c=null)):(u=null,c=r),u!==c)){if(l=pn,v="onMouseLeave",h="onMouseEnter",p="mouse","pointerout"!==e&&"pointerover"!==e||(l=An,v="onPointerLeave",h="onPointerEnter",p="pointer"),d=null==u?s:wi(u),f=null==c?s:wi(c),(s=new l(v,p+"leave",u,n,i)).target=d,s.relatedTarget=f,v=null,yi(i)===r&&((l=new l(h,p+"enter",c,n,i)).target=f,l.relatedTarget=d,v=l),d=v,u&&c)e:{for(h=c,p=0,f=l=u;f;f=Kr(f))p++;for(f=0,v=h;v;v=Kr(v))f++;for(;0<p-f;)l=Kr(l),p--;for(;0<f-p;)h=Kr(h),f--;for(;p--;){if(l===h||null!==h&&l===h.alternate)break e;l=Kr(l),h=Kr(h)}l=null}else l=null;null!==u&&Wr(a,s,u,l,!1),null!==c&&null!==d&&Wr(a,d,c,l,!0)}if("select"===(u=(s=r?wi(r):window).nodeName&&s.nodeName.toLowerCase())||"input"===u&&"file"===s.type)var g=Qn;else if(zn(s))if(Yn)g=ar;else{g=ir;var m=rr}else(u=s.nodeName)&&"input"===u.toLowerCase()&&("checkbox"===s.type||"radio"===s.type)&&(g=or);switch(g&&(g=g(e,r))?Vn(a,g,n,i):(m&&m(e,s,r),"focusout"===e&&(m=s._wrapperState)&&m.controlled&&"number"===s.type&&ee(s,"number",s.value)),m=r?wi(r):window,e){case"focusin":(zn(m)||"true"===m.contentEditable)&&(gr=m,mr=r,yr=null);break;case"focusout":yr=mr=gr=null;break;case"mousedown":br=!0;break;case"contextmenu":case"mouseup":case"dragend":br=!1,wr(a,n,i);break;case"selectionchange":if(vr)break;case"keydown":case"keyup":wr(a,n,i)}var y;if(Mn)e:{switch(e){case"compositionstart":var b="onCompositionStart";break e;case"compositionend":b="onCompositionEnd";break e;case"compositionupdate":b="onCompositionUpdate";break e}b=void 0}else Un?qn(e,n)&&(b="onCompositionEnd"):"keydown"===e&&229===n.keyCode&&(b="onCompositionStart");b&&(Dn&&"ko"!==n.locale&&(Un||"onCompositionStart"!==b?"onCompositionEnd"===b&&Un&&(y=en()):(Xt="value"in(Yt=i)?Yt.value:Yt.textContent,Un=!0)),0<(m=Gr(r,b)).length&&(b=new wn(b,e,null,n,i),a.push({event:b,listeners:m}),y?b.data=y:null!==(y=jn(n))&&(b.data=y))),(y=Zn?function(e,t){switch(e){case"compositionend":return jn(t);case"keypress":return 32!==t.which?null:(Bn=!0,Ln);case"textInput":return(e=t.data)===Ln&&Bn?null:e;default:return null}}(e,n):function(e,t){if(Un)return"compositionend"===e||!Mn&&qn(e,t)?(e=en(),$t=Xt=Yt=null,Un=!1,e):null;switch(e){case"paste":default:return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return Dn&&"ko"!==t.locale?null:t.data}}(e,n))&&(0<(r=Gr(r,"onBeforeInput")).length&&(i=new wn("onBeforeInput","beforeinput",null,n,i),a.push({event:i,listeners:r}),i.data=y))}Lr(a,t)}))}function Vr(e,t,n){return{instance:e,listener:t,currentTarget:n}}function Gr(e,t){for(var n=t+"Capture",r=[];null!==e;){var i=e,o=i.stateNode;5===i.tag&&null!==o&&(i=o,null!=(o=Ne(e,n))&&r.unshift(Vr(e,o,i)),null!=(o=Ne(e,t))&&r.push(Vr(e,o,i))),e=e.return}return r}function Kr(e){if(null===e)return null;do{e=e.return}while(e&&5!==e.tag);return e||null}function Wr(e,t,n,r,i){for(var o=t._reactName,a=[];null!==n&&n!==r;){var s=n,u=s.alternate,c=s.stateNode;if(null!==u&&u===r)break;5===s.tag&&null!==c&&(s=c,i?null!=(u=Ne(n,o))&&a.unshift(Vr(n,u,s)):i||null!=(u=Ne(n,o))&&a.push(Vr(n,u,s))),n=n.return}0!==a.length&&e.push({event:t,listeners:a})}var Jr=/\r\n?/g,Qr=/\u0000|\uFFFD/g;function Yr(e){return("string"===typeof e?e:""+e).replace(Jr,"\n").replace(Qr,"")}function Xr(e,t,n){if(t=Yr(t),Yr(e)!==t&&n)throw Error(o(425))}function $r(){}var ei=null,ti=null;function ni(e,t){return"textarea"===e||"noscript"===e||"string"===typeof t.children||"number"===typeof t.children||"object"===typeof t.dangerouslySetInnerHTML&&null!==t.dangerouslySetInnerHTML&&null!=t.dangerouslySetInnerHTML.__html}var ri="function"===typeof setTimeout?setTimeout:void 0,ii="function"===typeof clearTimeout?clearTimeout:void 0,oi="function"===typeof Promise?Promise:void 0,ai="function"===typeof queueMicrotask?queueMicrotask:"undefined"!==typeof oi?function(e){return oi.resolve(null).then(e).catch(si)}:ri;function si(e){setTimeout((function(){throw e}))}function ui(e,t){var n=t,r=0;do{var i=n.nextSibling;if(e.removeChild(n),i&&8===i.nodeType)if("/$"===(n=i.data)){if(0===r)return e.removeChild(i),void Ut(t);r--}else"$"!==n&&"$?"!==n&&"$!"!==n||r++;n=i}while(n);Ut(t)}function ci(e){for(;null!=e;e=e.nextSibling){var t=e.nodeType;if(1===t||3===t)break;if(8===t){if("$"===(t=e.data)||"$!"===t||"$?"===t)break;if("/$"===t)return null}}return e}function li(e){e=e.previousSibling;for(var t=0;e;){if(8===e.nodeType){var n=e.data;if("$"===n||"$!"===n||"$?"===n){if(0===t)return e;t--}else"/$"===n&&t++}e=e.previousSibling}return null}var di=Math.random().toString(36).slice(2),hi="__reactFiber$"+di,fi="__reactProps$"+di,pi="__reactContainer$"+di,vi="__reactEvents$"+di,gi="__reactListeners$"+di,mi="__reactHandles$"+di;function yi(e){var t=e[hi];if(t)return t;for(var n=e.parentNode;n;){if(t=n[pi]||n[hi]){if(n=t.alternate,null!==t.child||null!==n&&null!==n.child)for(e=li(e);null!==e;){if(n=e[hi])return n;e=li(e)}return t}n=(e=n).parentNode}return null}function bi(e){return!(e=e[hi]||e[pi])||5!==e.tag&&6!==e.tag&&13!==e.tag&&3!==e.tag?null:e}function wi(e){if(5===e.tag||6===e.tag)return e.stateNode;throw Error(o(33))}function Si(e){return e[fi]||null}var ki=[],Ci=-1;function xi(e){return{current:e}}function Ei(e){0>Ci||(e.current=ki[Ci],ki[Ci]=null,Ci--)}function Ti(e,t){Ci++,ki[Ci]=e.current,e.current=t}var Ii={},Ai=xi(Ii),Ri=xi(!1),_i=Ii;function Pi(e,t){var n=e.type.contextTypes;if(!n)return Ii;var r=e.stateNode;if(r&&r.__reactInternalMemoizedUnmaskedChildContext===t)return r.__reactInternalMemoizedMaskedChildContext;var i,o={};for(i in n)o[i]=t[i];return r&&((e=e.stateNode).__reactInternalMemoizedUnmaskedChildContext=t,e.__reactInternalMemoizedMaskedChildContext=o),o}function Ni(e){return null!==(e=e.childContextTypes)&&void 0!==e}function Oi(){Ei(Ri),Ei(Ai)}function Mi(e,t,n){if(Ai.current!==Ii)throw Error(o(168));Ti(Ai,t),Ti(Ri,n)}function Fi(e,t,n){var r=e.stateNode;if(t=t.childContextTypes,"function"!==typeof r.getChildContext)return n;for(var i in r=r.getChildContext())if(!(i in t))throw Error(o(108,H(e)||"Unknown",i));return D({},n,r)}function Zi(e){return e=(e=e.stateNode)&&e.__reactInternalMemoizedMergedChildContext||Ii,_i=Ai.current,Ti(Ai,e),Ti(Ri,Ri.current),!0}function Di(e,t,n){var r=e.stateNode;if(!r)throw Error(o(169));n?(e=Fi(e,t,_i),r.__reactInternalMemoizedMergedChildContext=e,Ei(Ri),Ei(Ai),Ti(Ai,e)):Ei(Ri),Ti(Ri,n)}var Li=null,Bi=!1,qi=!1;function ji(e){null===Li?Li=[e]:Li.push(e)}function Ui(){if(!qi&&null!==Li){qi=!0;var e=0,t=bt;try{var n=Li;for(bt=1;e<n.length;e++){var r=n[e];do{r=r(!0)}while(null!==r)}Li=null,Bi=!1}catch(i){throw null!==Li&&(Li=Li.slice(e+1)),Ke($e,Ui),i}finally{bt=t,qi=!1}}return null}var Hi=[],zi=0,Vi=null,Gi=0,Ki=[],Wi=0,Ji=null,Qi=1,Yi="";function Xi(e,t){Hi[zi++]=Gi,Hi[zi++]=Vi,Vi=e,Gi=t}function $i(e,t,n){Ki[Wi++]=Qi,Ki[Wi++]=Yi,Ki[Wi++]=Ji,Ji=e;var r=Qi;e=Yi;var i=32-at(r)-1;r&=~(1<<i),n+=1;var o=32-at(t)+i;if(30<o){var a=i-i%5;o=(r&(1<<a)-1).toString(32),r>>=a,i-=a,Qi=1<<32-at(t)+i|n<<i|r,Yi=o+e}else Qi=1<<o|n<<i|r,Yi=e}function eo(e){null!==e.return&&(Xi(e,1),$i(e,1,0))}function to(e){for(;e===Vi;)Vi=Hi[--zi],Hi[zi]=null,Gi=Hi[--zi],Hi[zi]=null;for(;e===Ji;)Ji=Ki[--Wi],Ki[Wi]=null,Yi=Ki[--Wi],Ki[Wi]=null,Qi=Ki[--Wi],Ki[Wi]=null}var no=null,ro=null,io=!1,oo=null;function ao(e,t){var n=Nc(5,null,null,0);n.elementType="DELETED",n.stateNode=t,n.return=e,null===(t=e.deletions)?(e.deletions=[n],e.flags|=16):t.push(n)}function so(e,t){switch(e.tag){case 5:var n=e.type;return null!==(t=1!==t.nodeType||n.toLowerCase()!==t.nodeName.toLowerCase()?null:t)&&(e.stateNode=t,no=e,ro=ci(t.firstChild),!0);case 6:return null!==(t=""===e.pendingProps||3!==t.nodeType?null:t)&&(e.stateNode=t,no=e,ro=null,!0);case 13:return null!==(t=8!==t.nodeType?null:t)&&(n=null!==Ji?{id:Qi,overflow:Yi}:null,e.memoizedState={dehydrated:t,treeContext:n,retryLane:1073741824},(n=Nc(18,null,null,0)).stateNode=t,n.return=e,e.child=n,no=e,ro=null,!0);default:return!1}}function uo(e){return 0!==(1&e.mode)&&0===(128&e.flags)}function co(e){if(io){var t=ro;if(t){var n=t;if(!so(e,t)){if(uo(e))throw Error(o(418));t=ci(n.nextSibling);var r=no;t&&so(e,t)?ao(r,n):(e.flags=-4097&e.flags|2,io=!1,no=e)}}else{if(uo(e))throw Error(o(418));e.flags=-4097&e.flags|2,io=!1,no=e}}}function lo(e){for(e=e.return;null!==e&&5!==e.tag&&3!==e.tag&&13!==e.tag;)e=e.return;no=e}function ho(e){if(e!==no)return!1;if(!io)return lo(e),io=!0,!1;var t;if((t=3!==e.tag)&&!(t=5!==e.tag)&&(t="head"!==(t=e.type)&&"body"!==t&&!ni(e.type,e.memoizedProps)),t&&(t=ro)){if(uo(e))throw fo(),Error(o(418));for(;t;)ao(e,t),t=ci(t.nextSibling)}if(lo(e),13===e.tag){if(!(e=null!==(e=e.memoizedState)?e.dehydrated:null))throw Error(o(317));e:{for(e=e.nextSibling,t=0;e;){if(8===e.nodeType){var n=e.data;if("/$"===n){if(0===t){ro=ci(e.nextSibling);break e}t--}else"$"!==n&&"$!"!==n&&"$?"!==n||t++}e=e.nextSibling}ro=null}}else ro=no?ci(e.stateNode.nextSibling):null;return!0}function fo(){for(var e=ro;e;)e=ci(e.nextSibling)}function po(){ro=no=null,io=!1}function vo(e){null===oo?oo=[e]:oo.push(e)}var go=w.ReactCurrentBatchConfig;function mo(e,t){if(e&&e.defaultProps){for(var n in t=D({},t),e=e.defaultProps)void 0===t[n]&&(t[n]=e[n]);return t}return t}var yo=xi(null),bo=null,wo=null,So=null;function ko(){So=wo=bo=null}function Co(e){var t=yo.current;Ei(yo),e._currentValue=t}function xo(e,t,n){for(;null!==e;){var r=e.alternate;if((e.childLanes&t)!==t?(e.childLanes|=t,null!==r&&(r.childLanes|=t)):null!==r&&(r.childLanes&t)!==t&&(r.childLanes|=t),e===n)break;e=e.return}}function Eo(e,t){bo=e,So=wo=null,null!==(e=e.dependencies)&&null!==e.firstContext&&(0!==(e.lanes&t)&&(ws=!0),e.firstContext=null)}function To(e){var t=e._currentValue;if(So!==e)if(e={context:e,memoizedValue:t,next:null},null===wo){if(null===bo)throw Error(o(308));wo=e,bo.dependencies={lanes:0,firstContext:e}}else wo=wo.next=e;return t}var Io=null;function Ao(e){null===Io?Io=[e]:Io.push(e)}function Ro(e,t,n,r){var i=t.interleaved;return null===i?(n.next=n,Ao(t)):(n.next=i.next,i.next=n),t.interleaved=n,_o(e,r)}function _o(e,t){e.lanes|=t;var n=e.alternate;for(null!==n&&(n.lanes|=t),n=e,e=e.return;null!==e;)e.childLanes|=t,null!==(n=e.alternate)&&(n.childLanes|=t),n=e,e=e.return;return 3===n.tag?n.stateNode:null}var Po=!1;function No(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function Oo(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,effects:e.effects})}function Mo(e,t){return{eventTime:e,lane:t,tag:0,payload:null,callback:null,next:null}}function Fo(e,t,n){var r=e.updateQueue;if(null===r)return null;if(r=r.shared,0!==(2&Ru)){var i=r.pending;return null===i?t.next=t:(t.next=i.next,i.next=t),r.pending=t,_o(e,n)}return null===(i=r.interleaved)?(t.next=t,Ao(r)):(t.next=i.next,i.next=t),r.interleaved=t,_o(e,n)}function Zo(e,t,n){if(null!==(t=t.updateQueue)&&(t=t.shared,0!==(4194240&n))){var r=t.lanes;n|=r&=e.pendingLanes,t.lanes=n,yt(e,n)}}function Do(e,t){var n=e.updateQueue,r=e.alternate;if(null!==r&&n===(r=r.updateQueue)){var i=null,o=null;if(null!==(n=n.firstBaseUpdate)){do{var a={eventTime:n.eventTime,lane:n.lane,tag:n.tag,payload:n.payload,callback:n.callback,next:null};null===o?i=o=a:o=o.next=a,n=n.next}while(null!==n);null===o?i=o=t:o=o.next=t}else i=o=t;return n={baseState:r.baseState,firstBaseUpdate:i,lastBaseUpdate:o,shared:r.shared,effects:r.effects},void(e.updateQueue=n)}null===(e=n.lastBaseUpdate)?n.firstBaseUpdate=t:e.next=t,n.lastBaseUpdate=t}function Lo(e,t,n,r){var i=e.updateQueue;Po=!1;var o=i.firstBaseUpdate,a=i.lastBaseUpdate,s=i.shared.pending;if(null!==s){i.shared.pending=null;var u=s,c=u.next;u.next=null,null===a?o=c:a.next=c,a=u;var l=e.alternate;null!==l&&((s=(l=l.updateQueue).lastBaseUpdate)!==a&&(null===s?l.firstBaseUpdate=c:s.next=c,l.lastBaseUpdate=u))}if(null!==o){var d=i.baseState;for(a=0,l=c=u=null,s=o;;){var h=s.lane,f=s.eventTime;if((r&h)===h){null!==l&&(l=l.next={eventTime:f,lane:0,tag:s.tag,payload:s.payload,callback:s.callback,next:null});e:{var p=e,v=s;switch(h=t,f=n,v.tag){case 1:if("function"===typeof(p=v.payload)){d=p.call(f,d,h);break e}d=p;break e;case 3:p.flags=-65537&p.flags|128;case 0:if(null===(h="function"===typeof(p=v.payload)?p.call(f,d,h):p)||void 0===h)break e;d=D({},d,h);break e;case 2:Po=!0}}null!==s.callback&&0!==s.lane&&(e.flags|=64,null===(h=i.effects)?i.effects=[s]:h.push(s))}else f={eventTime:f,lane:h,tag:s.tag,payload:s.payload,callback:s.callback,next:null},null===l?(c=l=f,u=d):l=l.next=f,a|=h;if(null===(s=s.next)){if(null===(s=i.shared.pending))break;s=(h=s).next,h.next=null,i.lastBaseUpdate=h,i.shared.pending=null}}if(null===l&&(u=d),i.baseState=u,i.firstBaseUpdate=c,i.lastBaseUpdate=l,null!==(t=i.shared.interleaved)){i=t;do{a|=i.lane,i=i.next}while(i!==t)}else null===o&&(i.shared.lanes=0);Du|=a,e.lanes=a,e.memoizedState=d}}function Bo(e,t,n){if(e=t.effects,t.effects=null,null!==e)for(t=0;t<e.length;t++){var r=e[t],i=r.callback;if(null!==i){if(r.callback=null,r=n,"function"!==typeof i)throw Error(o(191,i));i.call(r)}}}var qo=(new r.Component).refs;function jo(e,t,n,r){n=null===(n=n(r,t=e.memoizedState))||void 0===n?t:D({},t,n),e.memoizedState=n,0===e.lanes&&(e.updateQueue.baseState=n)}var Uo={isMounted:function(e){return!!(e=e._reactInternals)&&Ue(e)===e},enqueueSetState:function(e,t,n){e=e._reactInternals;var r=tc(),i=nc(e),o=Mo(r,i);o.payload=t,void 0!==n&&null!==n&&(o.callback=n),null!==(t=Fo(e,o,i))&&(rc(t,e,i,r),Zo(t,e,i))},enqueueReplaceState:function(e,t,n){e=e._reactInternals;var r=tc(),i=nc(e),o=Mo(r,i);o.tag=1,o.payload=t,void 0!==n&&null!==n&&(o.callback=n),null!==(t=Fo(e,o,i))&&(rc(t,e,i,r),Zo(t,e,i))},enqueueForceUpdate:function(e,t){e=e._reactInternals;var n=tc(),r=nc(e),i=Mo(n,r);i.tag=2,void 0!==t&&null!==t&&(i.callback=t),null!==(t=Fo(e,i,r))&&(rc(t,e,r,n),Zo(t,e,r))}};function Ho(e,t,n,r,i,o,a){return"function"===typeof(e=e.stateNode).shouldComponentUpdate?e.shouldComponentUpdate(r,o,a):!t.prototype||!t.prototype.isPureReactComponent||(!ur(n,r)||!ur(i,o))}function zo(e,t,n){var r=!1,i=Ii,o=t.contextType;return"object"===typeof o&&null!==o?o=To(o):(i=Ni(t)?_i:Ai.current,o=(r=null!==(r=t.contextTypes)&&void 0!==r)?Pi(e,i):Ii),t=new t(n,o),e.memoizedState=null!==t.state&&void 0!==t.state?t.state:null,t.updater=Uo,e.stateNode=t,t._reactInternals=e,r&&((e=e.stateNode).__reactInternalMemoizedUnmaskedChildContext=i,e.__reactInternalMemoizedMaskedChildContext=o),t}function Vo(e,t,n,r){e=t.state,"function"===typeof t.componentWillReceiveProps&&t.componentWillReceiveProps(n,r),"function"===typeof t.UNSAFE_componentWillReceiveProps&&t.UNSAFE_componentWillReceiveProps(n,r),t.state!==e&&Uo.enqueueReplaceState(t,t.state,null)}function Go(e,t,n,r){var i=e.stateNode;i.props=n,i.state=e.memoizedState,i.refs=qo,No(e);var o=t.contextType;"object"===typeof o&&null!==o?i.context=To(o):(o=Ni(t)?_i:Ai.current,i.context=Pi(e,o)),i.state=e.memoizedState,"function"===typeof(o=t.getDerivedStateFromProps)&&(jo(e,t,o,n),i.state=e.memoizedState),"function"===typeof t.getDerivedStateFromProps||"function"===typeof i.getSnapshotBeforeUpdate||"function"!==typeof i.UNSAFE_componentWillMount&&"function"!==typeof i.componentWillMount||(t=i.state,"function"===typeof i.componentWillMount&&i.componentWillMount(),"function"===typeof i.UNSAFE_componentWillMount&&i.UNSAFE_componentWillMount(),t!==i.state&&Uo.enqueueReplaceState(i,i.state,null),Lo(e,n,i,r),i.state=e.memoizedState),"function"===typeof i.componentDidMount&&(e.flags|=4194308)}function Ko(e,t,n){if(null!==(e=n.ref)&&"function"!==typeof e&&"object"!==typeof e){if(n._owner){if(n=n._owner){if(1!==n.tag)throw Error(o(309));var r=n.stateNode}if(!r)throw Error(o(147,e));var i=r,a=""+e;return null!==t&&null!==t.ref&&"function"===typeof t.ref&&t.ref._stringRef===a?t.ref:(t=function(e){var t=i.refs;t===qo&&(t=i.refs={}),null===e?delete t[a]:t[a]=e},t._stringRef=a,t)}if("string"!==typeof e)throw Error(o(284));if(!n._owner)throw Error(o(290,e))}return e}function Wo(e,t){throw e=Object.prototype.toString.call(t),Error(o(31,"[object Object]"===e?"object with keys {"+Object.keys(t).join(", ")+"}":e))}function Jo(e){return(0,e._init)(e._payload)}function Qo(e){function t(t,n){if(e){var r=t.deletions;null===r?(t.deletions=[n],t.flags|=16):r.push(n)}}function n(n,r){if(!e)return null;for(;null!==r;)t(n,r),r=r.sibling;return null}function r(e,t){for(e=new Map;null!==t;)null!==t.key?e.set(t.key,t):e.set(t.index,t),t=t.sibling;return e}function i(e,t){return(e=Mc(e,t)).index=0,e.sibling=null,e}function a(t,n,r){return t.index=r,e?null!==(r=t.alternate)?(r=r.index)<n?(t.flags|=2,n):r:(t.flags|=2,n):(t.flags|=1048576,n)}function s(t){return e&&null===t.alternate&&(t.flags|=2),t}function u(e,t,n,r){return null===t||6!==t.tag?((t=Lc(n,e.mode,r)).return=e,t):((t=i(t,n)).return=e,t)}function c(e,t,n,r){var o=n.type;return o===C?d(e,t,n.props.children,r,n.key):null!==t&&(t.elementType===o||"object"===typeof o&&null!==o&&o.$$typeof===N&&Jo(o)===t.type)?((r=i(t,n.props)).ref=Ko(e,t,n),r.return=e,r):((r=Fc(n.type,n.key,n.props,null,e.mode,r)).ref=Ko(e,t,n),r.return=e,r)}function l(e,t,n,r){return null===t||4!==t.tag||t.stateNode.containerInfo!==n.containerInfo||t.stateNode.implementation!==n.implementation?((t=Bc(n,e.mode,r)).return=e,t):((t=i(t,n.children||[])).return=e,t)}function d(e,t,n,r,o){return null===t||7!==t.tag?((t=Zc(n,e.mode,r,o)).return=e,t):((t=i(t,n)).return=e,t)}function h(e,t,n){if("string"===typeof t&&""!==t||"number"===typeof t)return(t=Lc(""+t,e.mode,n)).return=e,t;if("object"===typeof t&&null!==t){switch(t.$$typeof){case S:return(n=Fc(t.type,t.key,t.props,null,e.mode,n)).ref=Ko(e,null,t),n.return=e,n;case k:return(t=Bc(t,e.mode,n)).return=e,t;case N:return h(e,(0,t._init)(t._payload),n)}if(te(t)||F(t))return(t=Zc(t,e.mode,n,null)).return=e,t;Wo(e,t)}return null}function f(e,t,n,r){var i=null!==t?t.key:null;if("string"===typeof n&&""!==n||"number"===typeof n)return null!==i?null:u(e,t,""+n,r);if("object"===typeof n&&null!==n){switch(n.$$typeof){case S:return n.key===i?c(e,t,n,r):null;case k:return n.key===i?l(e,t,n,r):null;case N:return f(e,t,(i=n._init)(n._payload),r)}if(te(n)||F(n))return null!==i?null:d(e,t,n,r,null);Wo(e,n)}return null}function p(e,t,n,r,i){if("string"===typeof r&&""!==r||"number"===typeof r)return u(t,e=e.get(n)||null,""+r,i);if("object"===typeof r&&null!==r){switch(r.$$typeof){case S:return c(t,e=e.get(null===r.key?n:r.key)||null,r,i);case k:return l(t,e=e.get(null===r.key?n:r.key)||null,r,i);case N:return p(e,t,n,(0,r._init)(r._payload),i)}if(te(r)||F(r))return d(t,e=e.get(n)||null,r,i,null);Wo(t,r)}return null}function v(i,o,s,u){for(var c=null,l=null,d=o,v=o=0,g=null;null!==d&&v<s.length;v++){d.index>v?(g=d,d=null):g=d.sibling;var m=f(i,d,s[v],u);if(null===m){null===d&&(d=g);break}e&&d&&null===m.alternate&&t(i,d),o=a(m,o,v),null===l?c=m:l.sibling=m,l=m,d=g}if(v===s.length)return n(i,d),io&&Xi(i,v),c;if(null===d){for(;v<s.length;v++)null!==(d=h(i,s[v],u))&&(o=a(d,o,v),null===l?c=d:l.sibling=d,l=d);return io&&Xi(i,v),c}for(d=r(i,d);v<s.length;v++)null!==(g=p(d,i,v,s[v],u))&&(e&&null!==g.alternate&&d.delete(null===g.key?v:g.key),o=a(g,o,v),null===l?c=g:l.sibling=g,l=g);return e&&d.forEach((function(e){return t(i,e)})),io&&Xi(i,v),c}function g(i,s,u,c){var l=F(u);if("function"!==typeof l)throw Error(o(150));if(null==(u=l.call(u)))throw Error(o(151));for(var d=l=null,v=s,g=s=0,m=null,y=u.next();null!==v&&!y.done;g++,y=u.next()){v.index>g?(m=v,v=null):m=v.sibling;var b=f(i,v,y.value,c);if(null===b){null===v&&(v=m);break}e&&v&&null===b.alternate&&t(i,v),s=a(b,s,g),null===d?l=b:d.sibling=b,d=b,v=m}if(y.done)return n(i,v),io&&Xi(i,g),l;if(null===v){for(;!y.done;g++,y=u.next())null!==(y=h(i,y.value,c))&&(s=a(y,s,g),null===d?l=y:d.sibling=y,d=y);return io&&Xi(i,g),l}for(v=r(i,v);!y.done;g++,y=u.next())null!==(y=p(v,i,g,y.value,c))&&(e&&null!==y.alternate&&v.delete(null===y.key?g:y.key),s=a(y,s,g),null===d?l=y:d.sibling=y,d=y);return e&&v.forEach((function(e){return t(i,e)})),io&&Xi(i,g),l}return function e(r,o,a,u){if("object"===typeof a&&null!==a&&a.type===C&&null===a.key&&(a=a.props.children),"object"===typeof a&&null!==a){switch(a.$$typeof){case S:e:{for(var c=a.key,l=o;null!==l;){if(l.key===c){if((c=a.type)===C){if(7===l.tag){n(r,l.sibling),(o=i(l,a.props.children)).return=r,r=o;break e}}else if(l.elementType===c||"object"===typeof c&&null!==c&&c.$$typeof===N&&Jo(c)===l.type){n(r,l.sibling),(o=i(l,a.props)).ref=Ko(r,l,a),o.return=r,r=o;break e}n(r,l);break}t(r,l),l=l.sibling}a.type===C?((o=Zc(a.props.children,r.mode,u,a.key)).return=r,r=o):((u=Fc(a.type,a.key,a.props,null,r.mode,u)).ref=Ko(r,o,a),u.return=r,r=u)}return s(r);case k:e:{for(l=a.key;null!==o;){if(o.key===l){if(4===o.tag&&o.stateNode.containerInfo===a.containerInfo&&o.stateNode.implementation===a.implementation){n(r,o.sibling),(o=i(o,a.children||[])).return=r,r=o;break e}n(r,o);break}t(r,o),o=o.sibling}(o=Bc(a,r.mode,u)).return=r,r=o}return s(r);case N:return e(r,o,(l=a._init)(a._payload),u)}if(te(a))return v(r,o,a,u);if(F(a))return g(r,o,a,u);Wo(r,a)}return"string"===typeof a&&""!==a||"number"===typeof a?(a=""+a,null!==o&&6===o.tag?(n(r,o.sibling),(o=i(o,a)).return=r,r=o):(n(r,o),(o=Lc(a,r.mode,u)).return=r,r=o),s(r)):n(r,o)}}var Yo=Qo(!0),Xo=Qo(!1),$o={},ea=xi($o),ta=xi($o),na=xi($o);function ra(e){if(e===$o)throw Error(o(174));return e}function ia(e,t){switch(Ti(na,t),Ti(ta,e),Ti(ea,$o),e=t.nodeType){case 9:case 11:t=(t=t.documentElement)?t.namespaceURI:ue(null,"");break;default:t=ue(t=(e=8===e?t.parentNode:t).namespaceURI||null,e=e.tagName)}Ei(ea),Ti(ea,t)}function oa(){Ei(ea),Ei(ta),Ei(na)}function aa(e){ra(na.current);var t=ra(ea.current),n=ue(t,e.type);t!==n&&(Ti(ta,e),Ti(ea,n))}function sa(e){ta.current===e&&(Ei(ea),Ei(ta))}var ua=xi(0);function ca(e){for(var t=e;null!==t;){if(13===t.tag){var n=t.memoizedState;if(null!==n&&(null===(n=n.dehydrated)||"$?"===n.data||"$!"===n.data))return t}else if(19===t.tag&&void 0!==t.memoizedProps.revealOrder){if(0!==(128&t.flags))return t}else if(null!==t.child){t.child.return=t,t=t.child;continue}if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}var la=[];function da(){for(var e=0;e<la.length;e++)la[e]._workInProgressVersionPrimary=null;la.length=0}var ha=w.ReactCurrentDispatcher,fa=w.ReactCurrentBatchConfig,pa=0,va=null,ga=null,ma=null,ya=!1,ba=!1,wa=0,Sa=0;function ka(){throw Error(o(321))}function Ca(e,t){if(null===t)return!1;for(var n=0;n<t.length&&n<e.length;n++)if(!sr(e[n],t[n]))return!1;return!0}function xa(e,t,n,r,i,a){if(pa=a,va=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,ha.current=null===e||null===e.memoizedState?ss:us,e=n(r,i),ba){a=0;do{if(ba=!1,wa=0,25<=a)throw Error(o(301));a+=1,ma=ga=null,t.updateQueue=null,ha.current=cs,e=n(r,i)}while(ba)}if(ha.current=as,t=null!==ga&&null!==ga.next,pa=0,ma=ga=va=null,ya=!1,t)throw Error(o(300));return e}function Ea(){var e=0!==wa;return wa=0,e}function Ta(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return null===ma?va.memoizedState=ma=e:ma=ma.next=e,ma}function Ia(){if(null===ga){var e=va.alternate;e=null!==e?e.memoizedState:null}else e=ga.next;var t=null===ma?va.memoizedState:ma.next;if(null!==t)ma=t,ga=e;else{if(null===e)throw Error(o(310));e={memoizedState:(ga=e).memoizedState,baseState:ga.baseState,baseQueue:ga.baseQueue,queue:ga.queue,next:null},null===ma?va.memoizedState=ma=e:ma=ma.next=e}return ma}function Aa(e,t){return"function"===typeof t?t(e):t}function Ra(e){var t=Ia(),n=t.queue;if(null===n)throw Error(o(311));n.lastRenderedReducer=e;var r=ga,i=r.baseQueue,a=n.pending;if(null!==a){if(null!==i){var s=i.next;i.next=a.next,a.next=s}r.baseQueue=i=a,n.pending=null}if(null!==i){a=i.next,r=r.baseState;var u=s=null,c=null,l=a;do{var d=l.lane;if((pa&d)===d)null!==c&&(c=c.next={lane:0,action:l.action,hasEagerState:l.hasEagerState,eagerState:l.eagerState,next:null}),r=l.hasEagerState?l.eagerState:e(r,l.action);else{var h={lane:d,action:l.action,hasEagerState:l.hasEagerState,eagerState:l.eagerState,next:null};null===c?(u=c=h,s=r):c=c.next=h,va.lanes|=d,Du|=d}l=l.next}while(null!==l&&l!==a);null===c?s=r:c.next=u,sr(r,t.memoizedState)||(ws=!0),t.memoizedState=r,t.baseState=s,t.baseQueue=c,n.lastRenderedState=r}if(null!==(e=n.interleaved)){i=e;do{a=i.lane,va.lanes|=a,Du|=a,i=i.next}while(i!==e)}else null===i&&(n.lanes=0);return[t.memoizedState,n.dispatch]}function _a(e){var t=Ia(),n=t.queue;if(null===n)throw Error(o(311));n.lastRenderedReducer=e;var r=n.dispatch,i=n.pending,a=t.memoizedState;if(null!==i){n.pending=null;var s=i=i.next;do{a=e(a,s.action),s=s.next}while(s!==i);sr(a,t.memoizedState)||(ws=!0),t.memoizedState=a,null===t.baseQueue&&(t.baseState=a),n.lastRenderedState=a}return[a,r]}function Pa(){}function Na(e,t){var n=va,r=Ia(),i=t(),a=!sr(r.memoizedState,i);if(a&&(r.memoizedState=i,ws=!0),r=r.queue,za(Fa.bind(null,n,r,e),[e]),r.getSnapshot!==t||a||null!==ma&&1&ma.memoizedState.tag){if(n.flags|=2048,Ba(9,Ma.bind(null,n,r,i,t),void 0,null),null===_u)throw Error(o(349));0!==(30&pa)||Oa(n,t,i)}return i}function Oa(e,t,n){e.flags|=16384,e={getSnapshot:t,value:n},null===(t=va.updateQueue)?(t={lastEffect:null,stores:null},va.updateQueue=t,t.stores=[e]):null===(n=t.stores)?t.stores=[e]:n.push(e)}function Ma(e,t,n,r){t.value=n,t.getSnapshot=r,Za(t)&&Da(e)}function Fa(e,t,n){return n((function(){Za(t)&&Da(e)}))}function Za(e){var t=e.getSnapshot;e=e.value;try{var n=t();return!sr(e,n)}catch(r){return!0}}function Da(e){var t=_o(e,1);null!==t&&rc(t,e,1,-1)}function La(e){var t=Ta();return"function"===typeof e&&(e=e()),t.memoizedState=t.baseState=e,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Aa,lastRenderedState:e},t.queue=e,e=e.dispatch=ns.bind(null,va,e),[t.memoizedState,e]}function Ba(e,t,n,r){return e={tag:e,create:t,destroy:n,deps:r,next:null},null===(t=va.updateQueue)?(t={lastEffect:null,stores:null},va.updateQueue=t,t.lastEffect=e.next=e):null===(n=t.lastEffect)?t.lastEffect=e.next=e:(r=n.next,n.next=e,e.next=r,t.lastEffect=e),e}function qa(){return Ia().memoizedState}function ja(e,t,n,r){var i=Ta();va.flags|=e,i.memoizedState=Ba(1|t,n,void 0,void 0===r?null:r)}function Ua(e,t,n,r){var i=Ia();r=void 0===r?null:r;var o=void 0;if(null!==ga){var a=ga.memoizedState;if(o=a.destroy,null!==r&&Ca(r,a.deps))return void(i.memoizedState=Ba(t,n,o,r))}va.flags|=e,i.memoizedState=Ba(1|t,n,o,r)}function Ha(e,t){return ja(8390656,8,e,t)}function za(e,t){return Ua(2048,8,e,t)}function Va(e,t){return Ua(4,2,e,t)}function Ga(e,t){return Ua(4,4,e,t)}function Ka(e,t){return"function"===typeof t?(e=e(),t(e),function(){t(null)}):null!==t&&void 0!==t?(e=e(),t.current=e,function(){t.current=null}):void 0}function Wa(e,t,n){return n=null!==n&&void 0!==n?n.concat([e]):null,Ua(4,4,Ka.bind(null,t,e),n)}function Ja(){}function Qa(e,t){var n=Ia();t=void 0===t?null:t;var r=n.memoizedState;return null!==r&&null!==t&&Ca(t,r[1])?r[0]:(n.memoizedState=[e,t],e)}function Ya(e,t){var n=Ia();t=void 0===t?null:t;var r=n.memoizedState;return null!==r&&null!==t&&Ca(t,r[1])?r[0]:(e=e(),n.memoizedState=[e,t],e)}function Xa(e,t,n){return 0===(21&pa)?(e.baseState&&(e.baseState=!1,ws=!0),e.memoizedState=n):(sr(n,t)||(n=vt(),va.lanes|=n,Du|=n,e.baseState=!0),t)}function $a(e,t){var n=bt;bt=0!==n&&4>n?n:4,e(!0);var r=fa.transition;fa.transition={};try{e(!1),t()}finally{bt=n,fa.transition=r}}function es(){return Ia().memoizedState}function ts(e,t,n){var r=nc(e);if(n={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null},rs(e))is(t,n);else if(null!==(n=Ro(e,t,n,r))){rc(n,e,r,tc()),os(n,t,r)}}function ns(e,t,n){var r=nc(e),i={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null};if(rs(e))is(t,i);else{var o=e.alternate;if(0===e.lanes&&(null===o||0===o.lanes)&&null!==(o=t.lastRenderedReducer))try{var a=t.lastRenderedState,s=o(a,n);if(i.hasEagerState=!0,i.eagerState=s,sr(s,a)){var u=t.interleaved;return null===u?(i.next=i,Ao(t)):(i.next=u.next,u.next=i),void(t.interleaved=i)}}catch(c){}null!==(n=Ro(e,t,i,r))&&(rc(n,e,r,i=tc()),os(n,t,r))}}function rs(e){var t=e.alternate;return e===va||null!==t&&t===va}function is(e,t){ba=ya=!0;var n=e.pending;null===n?t.next=t:(t.next=n.next,n.next=t),e.pending=t}function os(e,t,n){if(0!==(4194240&n)){var r=t.lanes;n|=r&=e.pendingLanes,t.lanes=n,yt(e,n)}}var as={readContext:To,useCallback:ka,useContext:ka,useEffect:ka,useImperativeHandle:ka,useInsertionEffect:ka,useLayoutEffect:ka,useMemo:ka,useReducer:ka,useRef:ka,useState:ka,useDebugValue:ka,useDeferredValue:ka,useTransition:ka,useMutableSource:ka,useSyncExternalStore:ka,useId:ka,unstable_isNewReconciler:!1},ss={readContext:To,useCallback:function(e,t){return Ta().memoizedState=[e,void 0===t?null:t],e},useContext:To,useEffect:Ha,useImperativeHandle:function(e,t,n){return n=null!==n&&void 0!==n?n.concat([e]):null,ja(4194308,4,Ka.bind(null,t,e),n)},useLayoutEffect:function(e,t){return ja(4194308,4,e,t)},useInsertionEffect:function(e,t){return ja(4,2,e,t)},useMemo:function(e,t){var n=Ta();return t=void 0===t?null:t,e=e(),n.memoizedState=[e,t],e},useReducer:function(e,t,n){var r=Ta();return t=void 0!==n?n(t):t,r.memoizedState=r.baseState=t,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:t},r.queue=e,e=e.dispatch=ts.bind(null,va,e),[r.memoizedState,e]},useRef:function(e){return e={current:e},Ta().memoizedState=e},useState:La,useDebugValue:Ja,useDeferredValue:function(e){return Ta().memoizedState=e},useTransition:function(){var e=La(!1),t=e[0];return e=$a.bind(null,e[1]),Ta().memoizedState=e,[t,e]},useMutableSource:function(){},useSyncExternalStore:function(e,t,n){var r=va,i=Ta();if(io){if(void 0===n)throw Error(o(407));n=n()}else{if(n=t(),null===_u)throw Error(o(349));0!==(30&pa)||Oa(r,t,n)}i.memoizedState=n;var a={value:n,getSnapshot:t};return i.queue=a,Ha(Fa.bind(null,r,a,e),[e]),r.flags|=2048,Ba(9,Ma.bind(null,r,a,n,t),void 0,null),n},useId:function(){var e=Ta(),t=_u.identifierPrefix;if(io){var n=Yi;t=":"+t+"R"+(n=(Qi&~(1<<32-at(Qi)-1)).toString(32)+n),0<(n=wa++)&&(t+="H"+n.toString(32)),t+=":"}else t=":"+t+"r"+(n=Sa++).toString(32)+":";return e.memoizedState=t},unstable_isNewReconciler:!1},us={readContext:To,useCallback:Qa,useContext:To,useEffect:za,useImperativeHandle:Wa,useInsertionEffect:Va,useLayoutEffect:Ga,useMemo:Ya,useReducer:Ra,useRef:qa,useState:function(){return Ra(Aa)},useDebugValue:Ja,useDeferredValue:function(e){return Xa(Ia(),ga.memoizedState,e)},useTransition:function(){return[Ra(Aa)[0],Ia().memoizedState]},useMutableSource:Pa,useSyncExternalStore:Na,useId:es,unstable_isNewReconciler:!1},cs={readContext:To,useCallback:Qa,useContext:To,useEffect:za,useImperativeHandle:Wa,useInsertionEffect:Va,useLayoutEffect:Ga,useMemo:Ya,useReducer:_a,useRef:qa,useState:function(){return _a(Aa)},useDebugValue:Ja,useDeferredValue:function(e){var t=Ia();return null===ga?t.memoizedState=e:Xa(t,ga.memoizedState,e)},useTransition:function(){return[_a(Aa)[0],Ia().memoizedState]},useMutableSource:Pa,useSyncExternalStore:Na,useId:es,unstable_isNewReconciler:!1};function ls(e,t){try{var n="",r=t;do{n+=j(r),r=r.return}while(r);var i=n}catch(o){i="\nError generating stack: "+o.message+"\n"+o.stack}return{value:e,source:t,stack:i,digest:null}}function ds(e,t,n){return{value:e,source:null,stack:null!=n?n:null,digest:null!=t?t:null}}function hs(e,t){try{console.error(t.value)}catch(n){setTimeout((function(){throw n}))}}var fs="function"===typeof WeakMap?WeakMap:Map;function ps(e,t,n){(n=Mo(-1,n)).tag=3,n.payload={element:null};var r=t.value;return n.callback=function(){Vu||(Vu=!0,Gu=r),hs(0,t)},n}function vs(e,t,n){(n=Mo(-1,n)).tag=3;var r=e.type.getDerivedStateFromError;if("function"===typeof r){var i=t.value;n.payload=function(){return r(i)},n.callback=function(){hs(0,t)}}var o=e.stateNode;return null!==o&&"function"===typeof o.componentDidCatch&&(n.callback=function(){hs(0,t),"function"!==typeof r&&(null===Ku?Ku=new Set([this]):Ku.add(this));var e=t.stack;this.componentDidCatch(t.value,{componentStack:null!==e?e:""})}),n}function gs(e,t,n){var r=e.pingCache;if(null===r){r=e.pingCache=new fs;var i=new Set;r.set(t,i)}else void 0===(i=r.get(t))&&(i=new Set,r.set(t,i));i.has(n)||(i.add(n),e=Tc.bind(null,e,t,n),t.then(e,e))}function ms(e){do{var t;if((t=13===e.tag)&&(t=null===(t=e.memoizedState)||null!==t.dehydrated),t)return e;e=e.return}while(null!==e);return null}function ys(e,t,n,r,i){return 0===(1&e.mode)?(e===t?e.flags|=65536:(e.flags|=128,n.flags|=131072,n.flags&=-52805,1===n.tag&&(null===n.alternate?n.tag=17:((t=Mo(-1,1)).tag=2,Fo(n,t,1))),n.lanes|=1),e):(e.flags|=65536,e.lanes=i,e)}var bs=w.ReactCurrentOwner,ws=!1;function Ss(e,t,n,r){t.child=null===e?Xo(t,null,n,r):Yo(t,e.child,n,r)}function ks(e,t,n,r,i){n=n.render;var o=t.ref;return Eo(t,i),r=xa(e,t,n,r,o,i),n=Ea(),null===e||ws?(io&&n&&eo(t),t.flags|=1,Ss(e,t,r,i),t.child):(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~i,Vs(e,t,i))}function Cs(e,t,n,r,i){if(null===e){var o=n.type;return"function"!==typeof o||Oc(o)||void 0!==o.defaultProps||null!==n.compare||void 0!==n.defaultProps?((e=Fc(n.type,null,r,t,t.mode,i)).ref=t.ref,e.return=t,t.child=e):(t.tag=15,t.type=o,xs(e,t,o,r,i))}if(o=e.child,0===(e.lanes&i)){var a=o.memoizedProps;if((n=null!==(n=n.compare)?n:ur)(a,r)&&e.ref===t.ref)return Vs(e,t,i)}return t.flags|=1,(e=Mc(o,r)).ref=t.ref,e.return=t,t.child=e}function xs(e,t,n,r,i){if(null!==e){var o=e.memoizedProps;if(ur(o,r)&&e.ref===t.ref){if(ws=!1,t.pendingProps=r=o,0===(e.lanes&i))return t.lanes=e.lanes,Vs(e,t,i);0!==(131072&e.flags)&&(ws=!0)}}return Is(e,t,n,r,i)}function Es(e,t,n){var r=t.pendingProps,i=r.children,o=null!==e?e.memoizedState:null;if("hidden"===r.mode)if(0===(1&t.mode))t.memoizedState={baseLanes:0,cachePool:null,transitions:null},Ti(Mu,Ou),Ou|=n;else{if(0===(1073741824&n))return e=null!==o?o.baseLanes|n:n,t.lanes=t.childLanes=1073741824,t.memoizedState={baseLanes:e,cachePool:null,transitions:null},t.updateQueue=null,Ti(Mu,Ou),Ou|=e,null;t.memoizedState={baseLanes:0,cachePool:null,transitions:null},r=null!==o?o.baseLanes:n,Ti(Mu,Ou),Ou|=r}else null!==o?(r=o.baseLanes|n,t.memoizedState=null):r=n,Ti(Mu,Ou),Ou|=r;return Ss(e,t,i,n),t.child}function Ts(e,t){var n=t.ref;(null===e&&null!==n||null!==e&&e.ref!==n)&&(t.flags|=512,t.flags|=2097152)}function Is(e,t,n,r,i){var o=Ni(n)?_i:Ai.current;return o=Pi(t,o),Eo(t,i),n=xa(e,t,n,r,o,i),r=Ea(),null===e||ws?(io&&r&&eo(t),t.flags|=1,Ss(e,t,n,i),t.child):(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~i,Vs(e,t,i))}function As(e,t,n,r,i){if(Ni(n)){var o=!0;Zi(t)}else o=!1;if(Eo(t,i),null===t.stateNode)zs(e,t),zo(t,n,r),Go(t,n,r,i),r=!0;else if(null===e){var a=t.stateNode,s=t.memoizedProps;a.props=s;var u=a.context,c=n.contextType;"object"===typeof c&&null!==c?c=To(c):c=Pi(t,c=Ni(n)?_i:Ai.current);var l=n.getDerivedStateFromProps,d="function"===typeof l||"function"===typeof a.getSnapshotBeforeUpdate;d||"function"!==typeof a.UNSAFE_componentWillReceiveProps&&"function"!==typeof a.componentWillReceiveProps||(s!==r||u!==c)&&Vo(t,a,r,c),Po=!1;var h=t.memoizedState;a.state=h,Lo(t,r,a,i),u=t.memoizedState,s!==r||h!==u||Ri.current||Po?("function"===typeof l&&(jo(t,n,l,r),u=t.memoizedState),(s=Po||Ho(t,n,s,r,h,u,c))?(d||"function"!==typeof a.UNSAFE_componentWillMount&&"function"!==typeof a.componentWillMount||("function"===typeof a.componentWillMount&&a.componentWillMount(),"function"===typeof a.UNSAFE_componentWillMount&&a.UNSAFE_componentWillMount()),"function"===typeof a.componentDidMount&&(t.flags|=4194308)):("function"===typeof a.componentDidMount&&(t.flags|=4194308),t.memoizedProps=r,t.memoizedState=u),a.props=r,a.state=u,a.context=c,r=s):("function"===typeof a.componentDidMount&&(t.flags|=4194308),r=!1)}else{a=t.stateNode,Oo(e,t),s=t.memoizedProps,c=t.type===t.elementType?s:mo(t.type,s),a.props=c,d=t.pendingProps,h=a.context,"object"===typeof(u=n.contextType)&&null!==u?u=To(u):u=Pi(t,u=Ni(n)?_i:Ai.current);var f=n.getDerivedStateFromProps;(l="function"===typeof f||"function"===typeof a.getSnapshotBeforeUpdate)||"function"!==typeof a.UNSAFE_componentWillReceiveProps&&"function"!==typeof a.componentWillReceiveProps||(s!==d||h!==u)&&Vo(t,a,r,u),Po=!1,h=t.memoizedState,a.state=h,Lo(t,r,a,i);var p=t.memoizedState;s!==d||h!==p||Ri.current||Po?("function"===typeof f&&(jo(t,n,f,r),p=t.memoizedState),(c=Po||Ho(t,n,c,r,h,p,u)||!1)?(l||"function"!==typeof a.UNSAFE_componentWillUpdate&&"function"!==typeof a.componentWillUpdate||("function"===typeof a.componentWillUpdate&&a.componentWillUpdate(r,p,u),"function"===typeof a.UNSAFE_componentWillUpdate&&a.UNSAFE_componentWillUpdate(r,p,u)),"function"===typeof a.componentDidUpdate&&(t.flags|=4),"function"===typeof a.getSnapshotBeforeUpdate&&(t.flags|=1024)):("function"!==typeof a.componentDidUpdate||s===e.memoizedProps&&h===e.memoizedState||(t.flags|=4),"function"!==typeof a.getSnapshotBeforeUpdate||s===e.memoizedProps&&h===e.memoizedState||(t.flags|=1024),t.memoizedProps=r,t.memoizedState=p),a.props=r,a.state=p,a.context=u,r=c):("function"!==typeof a.componentDidUpdate||s===e.memoizedProps&&h===e.memoizedState||(t.flags|=4),"function"!==typeof a.getSnapshotBeforeUpdate||s===e.memoizedProps&&h===e.memoizedState||(t.flags|=1024),r=!1)}return Rs(e,t,n,r,o,i)}function Rs(e,t,n,r,i,o){Ts(e,t);var a=0!==(128&t.flags);if(!r&&!a)return i&&Di(t,n,!1),Vs(e,t,o);r=t.stateNode,bs.current=t;var s=a&&"function"!==typeof n.getDerivedStateFromError?null:r.render();return t.flags|=1,null!==e&&a?(t.child=Yo(t,e.child,null,o),t.child=Yo(t,null,s,o)):Ss(e,t,s,o),t.memoizedState=r.state,i&&Di(t,n,!0),t.child}function _s(e){var t=e.stateNode;t.pendingContext?Mi(0,t.pendingContext,t.pendingContext!==t.context):t.context&&Mi(0,t.context,!1),ia(e,t.containerInfo)}function Ps(e,t,n,r,i){return po(),vo(i),t.flags|=256,Ss(e,t,n,r),t.child}var Ns,Os,Ms,Fs,Zs={dehydrated:null,treeContext:null,retryLane:0};function Ds(e){return{baseLanes:e,cachePool:null,transitions:null}}function Ls(e,t,n){var r,i=t.pendingProps,a=ua.current,s=!1,u=0!==(128&t.flags);if((r=u)||(r=(null===e||null!==e.memoizedState)&&0!==(2&a)),r?(s=!0,t.flags&=-129):null!==e&&null===e.memoizedState||(a|=1),Ti(ua,1&a),null===e)return co(t),null!==(e=t.memoizedState)&&null!==(e=e.dehydrated)?(0===(1&t.mode)?t.lanes=1:"$!"===e.data?t.lanes=8:t.lanes=1073741824,null):(u=i.children,e=i.fallback,s?(i=t.mode,s=t.child,u={mode:"hidden",children:u},0===(1&i)&&null!==s?(s.childLanes=0,s.pendingProps=u):s=Dc(u,i,0,null),e=Zc(e,i,n,null),s.return=t,e.return=t,s.sibling=e,t.child=s,t.child.memoizedState=Ds(n),t.memoizedState=Zs,e):Bs(t,u));if(null!==(a=e.memoizedState)&&null!==(r=a.dehydrated))return function(e,t,n,r,i,a,s){if(n)return 256&t.flags?(t.flags&=-257,qs(e,t,s,r=ds(Error(o(422))))):null!==t.memoizedState?(t.child=e.child,t.flags|=128,null):(a=r.fallback,i=t.mode,r=Dc({mode:"visible",children:r.children},i,0,null),(a=Zc(a,i,s,null)).flags|=2,r.return=t,a.return=t,r.sibling=a,t.child=r,0!==(1&t.mode)&&Yo(t,e.child,null,s),t.child.memoizedState=Ds(s),t.memoizedState=Zs,a);if(0===(1&t.mode))return qs(e,t,s,null);if("$!"===i.data){if(r=i.nextSibling&&i.nextSibling.dataset)var u=r.dgst;return r=u,qs(e,t,s,r=ds(a=Error(o(419)),r,void 0))}if(u=0!==(s&e.childLanes),ws||u){if(null!==(r=_u)){switch(s&-s){case 4:i=2;break;case 16:i=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:i=32;break;case 536870912:i=268435456;break;default:i=0}0!==(i=0!==(i&(r.suspendedLanes|s))?0:i)&&i!==a.retryLane&&(a.retryLane=i,_o(e,i),rc(r,e,i,-1))}return gc(),qs(e,t,s,r=ds(Error(o(421))))}return"$?"===i.data?(t.flags|=128,t.child=e.child,t=Ac.bind(null,e),i._reactRetry=t,null):(e=a.treeContext,ro=ci(i.nextSibling),no=t,io=!0,oo=null,null!==e&&(Ki[Wi++]=Qi,Ki[Wi++]=Yi,Ki[Wi++]=Ji,Qi=e.id,Yi=e.overflow,Ji=t),t=Bs(t,r.children),t.flags|=4096,t)}(e,t,u,i,r,a,n);if(s){s=i.fallback,u=t.mode,r=(a=e.child).sibling;var c={mode:"hidden",children:i.children};return 0===(1&u)&&t.child!==a?((i=t.child).childLanes=0,i.pendingProps=c,t.deletions=null):(i=Mc(a,c)).subtreeFlags=14680064&a.subtreeFlags,null!==r?s=Mc(r,s):(s=Zc(s,u,n,null)).flags|=2,s.return=t,i.return=t,i.sibling=s,t.child=i,i=s,s=t.child,u=null===(u=e.child.memoizedState)?Ds(n):{baseLanes:u.baseLanes|n,cachePool:null,transitions:u.transitions},s.memoizedState=u,s.childLanes=e.childLanes&~n,t.memoizedState=Zs,i}return e=(s=e.child).sibling,i=Mc(s,{mode:"visible",children:i.children}),0===(1&t.mode)&&(i.lanes=n),i.return=t,i.sibling=null,null!==e&&(null===(n=t.deletions)?(t.deletions=[e],t.flags|=16):n.push(e)),t.child=i,t.memoizedState=null,i}function Bs(e,t){return(t=Dc({mode:"visible",children:t},e.mode,0,null)).return=e,e.child=t}function qs(e,t,n,r){return null!==r&&vo(r),Yo(t,e.child,null,n),(e=Bs(t,t.pendingProps.children)).flags|=2,t.memoizedState=null,e}function js(e,t,n){e.lanes|=t;var r=e.alternate;null!==r&&(r.lanes|=t),xo(e.return,t,n)}function Us(e,t,n,r,i){var o=e.memoizedState;null===o?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:r,tail:n,tailMode:i}:(o.isBackwards=t,o.rendering=null,o.renderingStartTime=0,o.last=r,o.tail=n,o.tailMode=i)}function Hs(e,t,n){var r=t.pendingProps,i=r.revealOrder,o=r.tail;if(Ss(e,t,r.children,n),0!==(2&(r=ua.current)))r=1&r|2,t.flags|=128;else{if(null!==e&&0!==(128&e.flags))e:for(e=t.child;null!==e;){if(13===e.tag)null!==e.memoizedState&&js(e,n,t);else if(19===e.tag)js(e,n,t);else if(null!==e.child){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;null===e.sibling;){if(null===e.return||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}r&=1}if(Ti(ua,r),0===(1&t.mode))t.memoizedState=null;else switch(i){case"forwards":for(n=t.child,i=null;null!==n;)null!==(e=n.alternate)&&null===ca(e)&&(i=n),n=n.sibling;null===(n=i)?(i=t.child,t.child=null):(i=n.sibling,n.sibling=null),Us(t,!1,i,n,o);break;case"backwards":for(n=null,i=t.child,t.child=null;null!==i;){if(null!==(e=i.alternate)&&null===ca(e)){t.child=i;break}e=i.sibling,i.sibling=n,n=i,i=e}Us(t,!0,n,null,o);break;case"together":Us(t,!1,null,null,void 0);break;default:t.memoizedState=null}return t.child}function zs(e,t){0===(1&t.mode)&&null!==e&&(e.alternate=null,t.alternate=null,t.flags|=2)}function Vs(e,t,n){if(null!==e&&(t.dependencies=e.dependencies),Du|=t.lanes,0===(n&t.childLanes))return null;if(null!==e&&t.child!==e.child)throw Error(o(153));if(null!==t.child){for(n=Mc(e=t.child,e.pendingProps),t.child=n,n.return=t;null!==e.sibling;)e=e.sibling,(n=n.sibling=Mc(e,e.pendingProps)).return=t;n.sibling=null}return t.child}function Gs(e,t){if(!io)switch(e.tailMode){case"hidden":t=e.tail;for(var n=null;null!==t;)null!==t.alternate&&(n=t),t=t.sibling;null===n?e.tail=null:n.sibling=null;break;case"collapsed":n=e.tail;for(var r=null;null!==n;)null!==n.alternate&&(r=n),n=n.sibling;null===r?t||null===e.tail?e.tail=null:e.tail.sibling=null:r.sibling=null}}function Ks(e){var t=null!==e.alternate&&e.alternate.child===e.child,n=0,r=0;if(t)for(var i=e.child;null!==i;)n|=i.lanes|i.childLanes,r|=14680064&i.subtreeFlags,r|=14680064&i.flags,i.return=e,i=i.sibling;else for(i=e.child;null!==i;)n|=i.lanes|i.childLanes,r|=i.subtreeFlags,r|=i.flags,i.return=e,i=i.sibling;return e.subtreeFlags|=r,e.childLanes=n,t}function Ws(e,t,n){var r=t.pendingProps;switch(to(t),t.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Ks(t),null;case 1:case 17:return Ni(t.type)&&Oi(),Ks(t),null;case 3:return r=t.stateNode,oa(),Ei(Ri),Ei(Ai),da(),r.pendingContext&&(r.context=r.pendingContext,r.pendingContext=null),null!==e&&null!==e.child||(ho(t)?t.flags|=4:null===e||e.memoizedState.isDehydrated&&0===(256&t.flags)||(t.flags|=1024,null!==oo&&(sc(oo),oo=null))),Os(e,t),Ks(t),null;case 5:sa(t);var i=ra(na.current);if(n=t.type,null!==e&&null!=t.stateNode)Ms(e,t,n,r,i),e.ref!==t.ref&&(t.flags|=512,t.flags|=2097152);else{if(!r){if(null===t.stateNode)throw Error(o(166));return Ks(t),null}if(e=ra(ea.current),ho(t)){r=t.stateNode,n=t.type;var a=t.memoizedProps;switch(r[hi]=t,r[fi]=a,e=0!==(1&t.mode),n){case"dialog":Br("cancel",r),Br("close",r);break;case"iframe":case"object":case"embed":Br("load",r);break;case"video":case"audio":for(i=0;i<Fr.length;i++)Br(Fr[i],r);break;case"source":Br("error",r);break;case"img":case"image":case"link":Br("error",r),Br("load",r);break;case"details":Br("toggle",r);break;case"input":Q(r,a),Br("invalid",r);break;case"select":r._wrapperState={wasMultiple:!!a.multiple},Br("invalid",r);break;case"textarea":ie(r,a),Br("invalid",r)}for(var u in ye(n,a),i=null,a)if(a.hasOwnProperty(u)){var c=a[u];"children"===u?"string"===typeof c?r.textContent!==c&&(!0!==a.suppressHydrationWarning&&Xr(r.textContent,c,e),i=["children",c]):"number"===typeof c&&r.textContent!==""+c&&(!0!==a.suppressHydrationWarning&&Xr(r.textContent,c,e),i=["children",""+c]):s.hasOwnProperty(u)&&null!=c&&"onScroll"===u&&Br("scroll",r)}switch(n){case"input":G(r),$(r,a,!0);break;case"textarea":G(r),ae(r);break;case"select":case"option":break;default:"function"===typeof a.onClick&&(r.onclick=$r)}r=i,t.updateQueue=r,null!==r&&(t.flags|=4)}else{u=9===i.nodeType?i:i.ownerDocument,"http://www.w3.org/1999/xhtml"===e&&(e=se(n)),"http://www.w3.org/1999/xhtml"===e?"script"===n?((e=u.createElement("div")).innerHTML="<script><\/script>",e=e.removeChild(e.firstChild)):"string"===typeof r.is?e=u.createElement(n,{is:r.is}):(e=u.createElement(n),"select"===n&&(u=e,r.multiple?u.multiple=!0:r.size&&(u.size=r.size))):e=u.createElementNS(e,n),e[hi]=t,e[fi]=r,Ns(e,t,!1,!1),t.stateNode=e;e:{switch(u=be(n,r),n){case"dialog":Br("cancel",e),Br("close",e),i=r;break;case"iframe":case"object":case"embed":Br("load",e),i=r;break;case"video":case"audio":for(i=0;i<Fr.length;i++)Br(Fr[i],e);i=r;break;case"source":Br("error",e),i=r;break;case"img":case"image":case"link":Br("error",e),Br("load",e),i=r;break;case"details":Br("toggle",e),i=r;break;case"input":Q(e,r),i=J(e,r),Br("invalid",e);break;case"option":default:i=r;break;case"select":e._wrapperState={wasMultiple:!!r.multiple},i=D({},r,{value:void 0}),Br("invalid",e);break;case"textarea":ie(e,r),i=re(e,r),Br("invalid",e)}for(a in ye(n,i),c=i)if(c.hasOwnProperty(a)){var l=c[a];"style"===a?ge(e,l):"dangerouslySetInnerHTML"===a?null!=(l=l?l.__html:void 0)&&de(e,l):"children"===a?"string"===typeof l?("textarea"!==n||""!==l)&&he(e,l):"number"===typeof l&&he(e,""+l):"suppressContentEditableWarning"!==a&&"suppressHydrationWarning"!==a&&"autoFocus"!==a&&(s.hasOwnProperty(a)?null!=l&&"onScroll"===a&&Br("scroll",e):null!=l&&b(e,a,l,u))}switch(n){case"input":G(e),$(e,r,!1);break;case"textarea":G(e),ae(e);break;case"option":null!=r.value&&e.setAttribute("value",""+z(r.value));break;case"select":e.multiple=!!r.multiple,null!=(a=r.value)?ne(e,!!r.multiple,a,!1):null!=r.defaultValue&&ne(e,!!r.multiple,r.defaultValue,!0);break;default:"function"===typeof i.onClick&&(e.onclick=$r)}switch(n){case"button":case"input":case"select":case"textarea":r=!!r.autoFocus;break e;case"img":r=!0;break e;default:r=!1}}r&&(t.flags|=4)}null!==t.ref&&(t.flags|=512,t.flags|=2097152)}return Ks(t),null;case 6:if(e&&null!=t.stateNode)Fs(e,t,e.memoizedProps,r);else{if("string"!==typeof r&&null===t.stateNode)throw Error(o(166));if(n=ra(na.current),ra(ea.current),ho(t)){if(r=t.stateNode,n=t.memoizedProps,r[hi]=t,(a=r.nodeValue!==n)&&null!==(e=no))switch(e.tag){case 3:Xr(r.nodeValue,n,0!==(1&e.mode));break;case 5:!0!==e.memoizedProps.suppressHydrationWarning&&Xr(r.nodeValue,n,0!==(1&e.mode))}a&&(t.flags|=4)}else(r=(9===n.nodeType?n:n.ownerDocument).createTextNode(r))[hi]=t,t.stateNode=r}return Ks(t),null;case 13:if(Ei(ua),r=t.memoizedState,null===e||null!==e.memoizedState&&null!==e.memoizedState.dehydrated){if(io&&null!==ro&&0!==(1&t.mode)&&0===(128&t.flags))fo(),po(),t.flags|=98560,a=!1;else if(a=ho(t),null!==r&&null!==r.dehydrated){if(null===e){if(!a)throw Error(o(318));if(!(a=null!==(a=t.memoizedState)?a.dehydrated:null))throw Error(o(317));a[hi]=t}else po(),0===(128&t.flags)&&(t.memoizedState=null),t.flags|=4;Ks(t),a=!1}else null!==oo&&(sc(oo),oo=null),a=!0;if(!a)return 65536&t.flags?t:null}return 0!==(128&t.flags)?(t.lanes=n,t):((r=null!==r)!==(null!==e&&null!==e.memoizedState)&&r&&(t.child.flags|=8192,0!==(1&t.mode)&&(null===e||0!==(1&ua.current)?0===Fu&&(Fu=3):gc())),null!==t.updateQueue&&(t.flags|=4),Ks(t),null);case 4:return oa(),Os(e,t),null===e&&Ur(t.stateNode.containerInfo),Ks(t),null;case 10:return Co(t.type._context),Ks(t),null;case 19:if(Ei(ua),null===(a=t.memoizedState))return Ks(t),null;if(r=0!==(128&t.flags),null===(u=a.rendering))if(r)Gs(a,!1);else{if(0!==Fu||null!==e&&0!==(128&e.flags))for(e=t.child;null!==e;){if(null!==(u=ca(e))){for(t.flags|=128,Gs(a,!1),null!==(r=u.updateQueue)&&(t.updateQueue=r,t.flags|=4),t.subtreeFlags=0,r=n,n=t.child;null!==n;)e=r,(a=n).flags&=14680066,null===(u=a.alternate)?(a.childLanes=0,a.lanes=e,a.child=null,a.subtreeFlags=0,a.memoizedProps=null,a.memoizedState=null,a.updateQueue=null,a.dependencies=null,a.stateNode=null):(a.childLanes=u.childLanes,a.lanes=u.lanes,a.child=u.child,a.subtreeFlags=0,a.deletions=null,a.memoizedProps=u.memoizedProps,a.memoizedState=u.memoizedState,a.updateQueue=u.updateQueue,a.type=u.type,e=u.dependencies,a.dependencies=null===e?null:{lanes:e.lanes,firstContext:e.firstContext}),n=n.sibling;return Ti(ua,1&ua.current|2),t.child}e=e.sibling}null!==a.tail&&Ye()>Hu&&(t.flags|=128,r=!0,Gs(a,!1),t.lanes=4194304)}else{if(!r)if(null!==(e=ca(u))){if(t.flags|=128,r=!0,null!==(n=e.updateQueue)&&(t.updateQueue=n,t.flags|=4),Gs(a,!0),null===a.tail&&"hidden"===a.tailMode&&!u.alternate&&!io)return Ks(t),null}else 2*Ye()-a.renderingStartTime>Hu&&1073741824!==n&&(t.flags|=128,r=!0,Gs(a,!1),t.lanes=4194304);a.isBackwards?(u.sibling=t.child,t.child=u):(null!==(n=a.last)?n.sibling=u:t.child=u,a.last=u)}return null!==a.tail?(t=a.tail,a.rendering=t,a.tail=t.sibling,a.renderingStartTime=Ye(),t.sibling=null,n=ua.current,Ti(ua,r?1&n|2:1&n),t):(Ks(t),null);case 22:case 23:return hc(),r=null!==t.memoizedState,null!==e&&null!==e.memoizedState!==r&&(t.flags|=8192),r&&0!==(1&t.mode)?0!==(1073741824&Ou)&&(Ks(t),6&t.subtreeFlags&&(t.flags|=8192)):Ks(t),null;case 24:case 25:return null}throw Error(o(156,t.tag))}function Js(e,t){switch(to(t),t.tag){case 1:return Ni(t.type)&&Oi(),65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 3:return oa(),Ei(Ri),Ei(Ai),da(),0!==(65536&(e=t.flags))&&0===(128&e)?(t.flags=-65537&e|128,t):null;case 5:return sa(t),null;case 13:if(Ei(ua),null!==(e=t.memoizedState)&&null!==e.dehydrated){if(null===t.alternate)throw Error(o(340));po()}return 65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 19:return Ei(ua),null;case 4:return oa(),null;case 10:return Co(t.type._context),null;case 22:case 23:return hc(),null;default:return null}}Ns=function(e,t){for(var n=t.child;null!==n;){if(5===n.tag||6===n.tag)e.appendChild(n.stateNode);else if(4!==n.tag&&null!==n.child){n.child.return=n,n=n.child;continue}if(n===t)break;for(;null===n.sibling;){if(null===n.return||n.return===t)return;n=n.return}n.sibling.return=n.return,n=n.sibling}},Os=function(){},Ms=function(e,t,n,r){var i=e.memoizedProps;if(i!==r){e=t.stateNode,ra(ea.current);var o,a=null;switch(n){case"input":i=J(e,i),r=J(e,r),a=[];break;case"select":i=D({},i,{value:void 0}),r=D({},r,{value:void 0}),a=[];break;case"textarea":i=re(e,i),r=re(e,r),a=[];break;default:"function"!==typeof i.onClick&&"function"===typeof r.onClick&&(e.onclick=$r)}for(l in ye(n,r),n=null,i)if(!r.hasOwnProperty(l)&&i.hasOwnProperty(l)&&null!=i[l])if("style"===l){var u=i[l];for(o in u)u.hasOwnProperty(o)&&(n||(n={}),n[o]="")}else"dangerouslySetInnerHTML"!==l&&"children"!==l&&"suppressContentEditableWarning"!==l&&"suppressHydrationWarning"!==l&&"autoFocus"!==l&&(s.hasOwnProperty(l)?a||(a=[]):(a=a||[]).push(l,null));for(l in r){var c=r[l];if(u=null!=i?i[l]:void 0,r.hasOwnProperty(l)&&c!==u&&(null!=c||null!=u))if("style"===l)if(u){for(o in u)!u.hasOwnProperty(o)||c&&c.hasOwnProperty(o)||(n||(n={}),n[o]="");for(o in c)c.hasOwnProperty(o)&&u[o]!==c[o]&&(n||(n={}),n[o]=c[o])}else n||(a||(a=[]),a.push(l,n)),n=c;else"dangerouslySetInnerHTML"===l?(c=c?c.__html:void 0,u=u?u.__html:void 0,null!=c&&u!==c&&(a=a||[]).push(l,c)):"children"===l?"string"!==typeof c&&"number"!==typeof c||(a=a||[]).push(l,""+c):"suppressContentEditableWarning"!==l&&"suppressHydrationWarning"!==l&&(s.hasOwnProperty(l)?(null!=c&&"onScroll"===l&&Br("scroll",e),a||u===c||(a=[])):(a=a||[]).push(l,c))}n&&(a=a||[]).push("style",n);var l=a;(t.updateQueue=l)&&(t.flags|=4)}},Fs=function(e,t,n,r){n!==r&&(t.flags|=4)};var Qs=!1,Ys=!1,Xs="function"===typeof WeakSet?WeakSet:Set,$s=null;function eu(e,t){var n=e.ref;if(null!==n)if("function"===typeof n)try{n(null)}catch(r){Ec(e,t,r)}else n.current=null}function tu(e,t,n){try{n()}catch(r){Ec(e,t,r)}}var nu=!1;function ru(e,t,n){var r=t.updateQueue;if(null!==(r=null!==r?r.lastEffect:null)){var i=r=r.next;do{if((i.tag&e)===e){var o=i.destroy;i.destroy=void 0,void 0!==o&&tu(t,n,o)}i=i.next}while(i!==r)}}function iu(e,t){if(null!==(t=null!==(t=t.updateQueue)?t.lastEffect:null)){var n=t=t.next;do{if((n.tag&e)===e){var r=n.create;n.destroy=r()}n=n.next}while(n!==t)}}function ou(e){var t=e.ref;if(null!==t){var n=e.stateNode;e.tag,e=n,"function"===typeof t?t(e):t.current=e}}function au(e){var t=e.alternate;null!==t&&(e.alternate=null,au(t)),e.child=null,e.deletions=null,e.sibling=null,5===e.tag&&(null!==(t=e.stateNode)&&(delete t[hi],delete t[fi],delete t[vi],delete t[gi],delete t[mi])),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}function su(e){return 5===e.tag||3===e.tag||4===e.tag}function uu(e){e:for(;;){for(;null===e.sibling;){if(null===e.return||su(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;5!==e.tag&&6!==e.tag&&18!==e.tag;){if(2&e.flags)continue e;if(null===e.child||4===e.tag)continue e;e.child.return=e,e=e.child}if(!(2&e.flags))return e.stateNode}}function cu(e,t,n){var r=e.tag;if(5===r||6===r)e=e.stateNode,t?8===n.nodeType?n.parentNode.insertBefore(e,t):n.insertBefore(e,t):(8===n.nodeType?(t=n.parentNode).insertBefore(e,n):(t=n).appendChild(e),null!==(n=n._reactRootContainer)&&void 0!==n||null!==t.onclick||(t.onclick=$r));else if(4!==r&&null!==(e=e.child))for(cu(e,t,n),e=e.sibling;null!==e;)cu(e,t,n),e=e.sibling}function lu(e,t,n){var r=e.tag;if(5===r||6===r)e=e.stateNode,t?n.insertBefore(e,t):n.appendChild(e);else if(4!==r&&null!==(e=e.child))for(lu(e,t,n),e=e.sibling;null!==e;)lu(e,t,n),e=e.sibling}var du=null,hu=!1;function fu(e,t,n){for(n=n.child;null!==n;)pu(e,t,n),n=n.sibling}function pu(e,t,n){if(ot&&"function"===typeof ot.onCommitFiberUnmount)try{ot.onCommitFiberUnmount(it,n)}catch(s){}switch(n.tag){case 5:Ys||eu(n,t);case 6:var r=du,i=hu;du=null,fu(e,t,n),hu=i,null!==(du=r)&&(hu?(e=du,n=n.stateNode,8===e.nodeType?e.parentNode.removeChild(n):e.removeChild(n)):du.removeChild(n.stateNode));break;case 18:null!==du&&(hu?(e=du,n=n.stateNode,8===e.nodeType?ui(e.parentNode,n):1===e.nodeType&&ui(e,n),Ut(e)):ui(du,n.stateNode));break;case 4:r=du,i=hu,du=n.stateNode.containerInfo,hu=!0,fu(e,t,n),du=r,hu=i;break;case 0:case 11:case 14:case 15:if(!Ys&&(null!==(r=n.updateQueue)&&null!==(r=r.lastEffect))){i=r=r.next;do{var o=i,a=o.destroy;o=o.tag,void 0!==a&&(0!==(2&o)||0!==(4&o))&&tu(n,t,a),i=i.next}while(i!==r)}fu(e,t,n);break;case 1:if(!Ys&&(eu(n,t),"function"===typeof(r=n.stateNode).componentWillUnmount))try{r.props=n.memoizedProps,r.state=n.memoizedState,r.componentWillUnmount()}catch(s){Ec(n,t,s)}fu(e,t,n);break;case 21:fu(e,t,n);break;case 22:1&n.mode?(Ys=(r=Ys)||null!==n.memoizedState,fu(e,t,n),Ys=r):fu(e,t,n);break;default:fu(e,t,n)}}function vu(e){var t=e.updateQueue;if(null!==t){e.updateQueue=null;var n=e.stateNode;null===n&&(n=e.stateNode=new Xs),t.forEach((function(t){var r=Rc.bind(null,e,t);n.has(t)||(n.add(t),t.then(r,r))}))}}function gu(e,t){var n=t.deletions;if(null!==n)for(var r=0;r<n.length;r++){var i=n[r];try{var a=e,s=t,u=s;e:for(;null!==u;){switch(u.tag){case 5:du=u.stateNode,hu=!1;break e;case 3:case 4:du=u.stateNode.containerInfo,hu=!0;break e}u=u.return}if(null===du)throw Error(o(160));pu(a,s,i),du=null,hu=!1;var c=i.alternate;null!==c&&(c.return=null),i.return=null}catch(l){Ec(i,t,l)}}if(12854&t.subtreeFlags)for(t=t.child;null!==t;)mu(t,e),t=t.sibling}function mu(e,t){var n=e.alternate,r=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:if(gu(t,e),yu(e),4&r){try{ru(3,e,e.return),iu(3,e)}catch(g){Ec(e,e.return,g)}try{ru(5,e,e.return)}catch(g){Ec(e,e.return,g)}}break;case 1:gu(t,e),yu(e),512&r&&null!==n&&eu(n,n.return);break;case 5:if(gu(t,e),yu(e),512&r&&null!==n&&eu(n,n.return),32&e.flags){var i=e.stateNode;try{he(i,"")}catch(g){Ec(e,e.return,g)}}if(4&r&&null!=(i=e.stateNode)){var a=e.memoizedProps,s=null!==n?n.memoizedProps:a,u=e.type,c=e.updateQueue;if(e.updateQueue=null,null!==c)try{"input"===u&&"radio"===a.type&&null!=a.name&&Y(i,a),be(u,s);var l=be(u,a);for(s=0;s<c.length;s+=2){var d=c[s],h=c[s+1];"style"===d?ge(i,h):"dangerouslySetInnerHTML"===d?de(i,h):"children"===d?he(i,h):b(i,d,h,l)}switch(u){case"input":X(i,a);break;case"textarea":oe(i,a);break;case"select":var f=i._wrapperState.wasMultiple;i._wrapperState.wasMultiple=!!a.multiple;var p=a.value;null!=p?ne(i,!!a.multiple,p,!1):f!==!!a.multiple&&(null!=a.defaultValue?ne(i,!!a.multiple,a.defaultValue,!0):ne(i,!!a.multiple,a.multiple?[]:"",!1))}i[fi]=a}catch(g){Ec(e,e.return,g)}}break;case 6:if(gu(t,e),yu(e),4&r){if(null===e.stateNode)throw Error(o(162));i=e.stateNode,a=e.memoizedProps;try{i.nodeValue=a}catch(g){Ec(e,e.return,g)}}break;case 3:if(gu(t,e),yu(e),4&r&&null!==n&&n.memoizedState.isDehydrated)try{Ut(t.containerInfo)}catch(g){Ec(e,e.return,g)}break;case 4:default:gu(t,e),yu(e);break;case 13:gu(t,e),yu(e),8192&(i=e.child).flags&&(a=null!==i.memoizedState,i.stateNode.isHidden=a,!a||null!==i.alternate&&null!==i.alternate.memoizedState||(Uu=Ye())),4&r&&vu(e);break;case 22:if(d=null!==n&&null!==n.memoizedState,1&e.mode?(Ys=(l=Ys)||d,gu(t,e),Ys=l):gu(t,e),yu(e),8192&r){if(l=null!==e.memoizedState,(e.stateNode.isHidden=l)&&!d&&0!==(1&e.mode))for($s=e,d=e.child;null!==d;){for(h=$s=d;null!==$s;){switch(p=(f=$s).child,f.tag){case 0:case 11:case 14:case 15:ru(4,f,f.return);break;case 1:eu(f,f.return);var v=f.stateNode;if("function"===typeof v.componentWillUnmount){r=f,n=f.return;try{t=r,v.props=t.memoizedProps,v.state=t.memoizedState,v.componentWillUnmount()}catch(g){Ec(r,n,g)}}break;case 5:eu(f,f.return);break;case 22:if(null!==f.memoizedState){ku(h);continue}}null!==p?(p.return=f,$s=p):ku(h)}d=d.sibling}e:for(d=null,h=e;;){if(5===h.tag){if(null===d){d=h;try{i=h.stateNode,l?"function"===typeof(a=i.style).setProperty?a.setProperty("display","none","important"):a.display="none":(u=h.stateNode,s=void 0!==(c=h.memoizedProps.style)&&null!==c&&c.hasOwnProperty("display")?c.display:null,u.style.display=ve("display",s))}catch(g){Ec(e,e.return,g)}}}else if(6===h.tag){if(null===d)try{h.stateNode.nodeValue=l?"":h.memoizedProps}catch(g){Ec(e,e.return,g)}}else if((22!==h.tag&&23!==h.tag||null===h.memoizedState||h===e)&&null!==h.child){h.child.return=h,h=h.child;continue}if(h===e)break e;for(;null===h.sibling;){if(null===h.return||h.return===e)break e;d===h&&(d=null),h=h.return}d===h&&(d=null),h.sibling.return=h.return,h=h.sibling}}break;case 19:gu(t,e),yu(e),4&r&&vu(e);case 21:}}function yu(e){var t=e.flags;if(2&t){try{e:{for(var n=e.return;null!==n;){if(su(n)){var r=n;break e}n=n.return}throw Error(o(160))}switch(r.tag){case 5:var i=r.stateNode;32&r.flags&&(he(i,""),r.flags&=-33),lu(e,uu(e),i);break;case 3:case 4:var a=r.stateNode.containerInfo;cu(e,uu(e),a);break;default:throw Error(o(161))}}catch(s){Ec(e,e.return,s)}e.flags&=-3}4096&t&&(e.flags&=-4097)}function bu(e,t,n){$s=e,wu(e,t,n)}function wu(e,t,n){for(var r=0!==(1&e.mode);null!==$s;){var i=$s,o=i.child;if(22===i.tag&&r){var a=null!==i.memoizedState||Qs;if(!a){var s=i.alternate,u=null!==s&&null!==s.memoizedState||Ys;s=Qs;var c=Ys;if(Qs=a,(Ys=u)&&!c)for($s=i;null!==$s;)u=(a=$s).child,22===a.tag&&null!==a.memoizedState?Cu(i):null!==u?(u.return=a,$s=u):Cu(i);for(;null!==o;)$s=o,wu(o,t,n),o=o.sibling;$s=i,Qs=s,Ys=c}Su(e)}else 0!==(8772&i.subtreeFlags)&&null!==o?(o.return=i,$s=o):Su(e)}}function Su(e){for(;null!==$s;){var t=$s;if(0!==(8772&t.flags)){var n=t.alternate;try{if(0!==(8772&t.flags))switch(t.tag){case 0:case 11:case 15:Ys||iu(5,t);break;case 1:var r=t.stateNode;if(4&t.flags&&!Ys)if(null===n)r.componentDidMount();else{var i=t.elementType===t.type?n.memoizedProps:mo(t.type,n.memoizedProps);r.componentDidUpdate(i,n.memoizedState,r.__reactInternalSnapshotBeforeUpdate)}var a=t.updateQueue;null!==a&&Bo(t,a,r);break;case 3:var s=t.updateQueue;if(null!==s){if(n=null,null!==t.child)switch(t.child.tag){case 5:case 1:n=t.child.stateNode}Bo(t,s,n)}break;case 5:var u=t.stateNode;if(null===n&&4&t.flags){n=u;var c=t.memoizedProps;switch(t.type){case"button":case"input":case"select":case"textarea":c.autoFocus&&n.focus();break;case"img":c.src&&(n.src=c.src)}}break;case 6:case 4:case 12:case 19:case 17:case 21:case 22:case 23:case 25:break;case 13:if(null===t.memoizedState){var l=t.alternate;if(null!==l){var d=l.memoizedState;if(null!==d){var h=d.dehydrated;null!==h&&Ut(h)}}}break;default:throw Error(o(163))}Ys||512&t.flags&&ou(t)}catch(f){Ec(t,t.return,f)}}if(t===e){$s=null;break}if(null!==(n=t.sibling)){n.return=t.return,$s=n;break}$s=t.return}}function ku(e){for(;null!==$s;){var t=$s;if(t===e){$s=null;break}var n=t.sibling;if(null!==n){n.return=t.return,$s=n;break}$s=t.return}}function Cu(e){for(;null!==$s;){var t=$s;try{switch(t.tag){case 0:case 11:case 15:var n=t.return;try{iu(4,t)}catch(u){Ec(t,n,u)}break;case 1:var r=t.stateNode;if("function"===typeof r.componentDidMount){var i=t.return;try{r.componentDidMount()}catch(u){Ec(t,i,u)}}var o=t.return;try{ou(t)}catch(u){Ec(t,o,u)}break;case 5:var a=t.return;try{ou(t)}catch(u){Ec(t,a,u)}}}catch(u){Ec(t,t.return,u)}if(t===e){$s=null;break}var s=t.sibling;if(null!==s){s.return=t.return,$s=s;break}$s=t.return}}var xu,Eu=Math.ceil,Tu=w.ReactCurrentDispatcher,Iu=w.ReactCurrentOwner,Au=w.ReactCurrentBatchConfig,Ru=0,_u=null,Pu=null,Nu=0,Ou=0,Mu=xi(0),Fu=0,Zu=null,Du=0,Lu=0,Bu=0,qu=null,ju=null,Uu=0,Hu=1/0,zu=null,Vu=!1,Gu=null,Ku=null,Wu=!1,Ju=null,Qu=0,Yu=0,Xu=null,$u=-1,ec=0;function tc(){return 0!==(6&Ru)?Ye():-1!==$u?$u:$u=Ye()}function nc(e){return 0===(1&e.mode)?1:0!==(2&Ru)&&0!==Nu?Nu&-Nu:null!==go.transition?(0===ec&&(ec=vt()),ec):0!==(e=bt)?e:e=void 0===(e=window.event)?16:Qt(e.type)}function rc(e,t,n,r){if(50<Yu)throw Yu=0,Xu=null,Error(o(185));mt(e,n,r),0!==(2&Ru)&&e===_u||(e===_u&&(0===(2&Ru)&&(Lu|=n),4===Fu&&uc(e,Nu)),ic(e,r),1===n&&0===Ru&&0===(1&t.mode)&&(Hu=Ye()+500,Bi&&Ui()))}function ic(e,t){var n=e.callbackNode;!function(e,t){for(var n=e.suspendedLanes,r=e.pingedLanes,i=e.expirationTimes,o=e.pendingLanes;0<o;){var a=31-at(o),s=1<<a,u=i[a];-1===u?0!==(s&n)&&0===(s&r)||(i[a]=ft(s,t)):u<=t&&(e.expiredLanes|=s),o&=~s}}(e,t);var r=ht(e,e===_u?Nu:0);if(0===r)null!==n&&We(n),e.callbackNode=null,e.callbackPriority=0;else if(t=r&-r,e.callbackPriority!==t){if(null!=n&&We(n),1===t)0===e.tag?function(e){Bi=!0,ji(e)}(cc.bind(null,e)):ji(cc.bind(null,e)),ai((function(){0===(6&Ru)&&Ui()})),n=null;else{switch(wt(r)){case 1:n=$e;break;case 4:n=et;break;case 16:default:n=tt;break;case 536870912:n=rt}n=_c(n,oc.bind(null,e))}e.callbackPriority=t,e.callbackNode=n}}function oc(e,t){if($u=-1,ec=0,0!==(6&Ru))throw Error(o(327));var n=e.callbackNode;if(Cc()&&e.callbackNode!==n)return null;var r=ht(e,e===_u?Nu:0);if(0===r)return null;if(0!==(30&r)||0!==(r&e.expiredLanes)||t)t=mc(e,r);else{t=r;var i=Ru;Ru|=2;var a=vc();for(_u===e&&Nu===t||(zu=null,Hu=Ye()+500,fc(e,t));;)try{bc();break}catch(u){pc(e,u)}ko(),Tu.current=a,Ru=i,null!==Pu?t=0:(_u=null,Nu=0,t=Fu)}if(0!==t){if(2===t&&(0!==(i=pt(e))&&(r=i,t=ac(e,i))),1===t)throw n=Zu,fc(e,0),uc(e,r),ic(e,Ye()),n;if(6===t)uc(e,r);else{if(i=e.current.alternate,0===(30&r)&&!function(e){for(var t=e;;){if(16384&t.flags){var n=t.updateQueue;if(null!==n&&null!==(n=n.stores))for(var r=0;r<n.length;r++){var i=n[r],o=i.getSnapshot;i=i.value;try{if(!sr(o(),i))return!1}catch(s){return!1}}}if(n=t.child,16384&t.subtreeFlags&&null!==n)n.return=t,t=n;else{if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return!0;t=t.return}t.sibling.return=t.return,t=t.sibling}}return!0}(i)&&(2===(t=mc(e,r))&&(0!==(a=pt(e))&&(r=a,t=ac(e,a))),1===t))throw n=Zu,fc(e,0),uc(e,r),ic(e,Ye()),n;switch(e.finishedWork=i,e.finishedLanes=r,t){case 0:case 1:throw Error(o(345));case 2:case 5:kc(e,ju,zu);break;case 3:if(uc(e,r),(130023424&r)===r&&10<(t=Uu+500-Ye())){if(0!==ht(e,0))break;if(((i=e.suspendedLanes)&r)!==r){tc(),e.pingedLanes|=e.suspendedLanes&i;break}e.timeoutHandle=ri(kc.bind(null,e,ju,zu),t);break}kc(e,ju,zu);break;case 4:if(uc(e,r),(4194240&r)===r)break;for(t=e.eventTimes,i=-1;0<r;){var s=31-at(r);a=1<<s,(s=t[s])>i&&(i=s),r&=~a}if(r=i,10<(r=(120>(r=Ye()-r)?120:480>r?480:1080>r?1080:1920>r?1920:3e3>r?3e3:4320>r?4320:1960*Eu(r/1960))-r)){e.timeoutHandle=ri(kc.bind(null,e,ju,zu),r);break}kc(e,ju,zu);break;default:throw Error(o(329))}}}return ic(e,Ye()),e.callbackNode===n?oc.bind(null,e):null}function ac(e,t){var n=qu;return e.current.memoizedState.isDehydrated&&(fc(e,t).flags|=256),2!==(e=mc(e,t))&&(t=ju,ju=n,null!==t&&sc(t)),e}function sc(e){null===ju?ju=e:ju.push.apply(ju,e)}function uc(e,t){for(t&=~Bu,t&=~Lu,e.suspendedLanes|=t,e.pingedLanes&=~t,e=e.expirationTimes;0<t;){var n=31-at(t),r=1<<n;e[n]=-1,t&=~r}}function cc(e){if(0!==(6&Ru))throw Error(o(327));Cc();var t=ht(e,0);if(0===(1&t))return ic(e,Ye()),null;var n=mc(e,t);if(0!==e.tag&&2===n){var r=pt(e);0!==r&&(t=r,n=ac(e,r))}if(1===n)throw n=Zu,fc(e,0),uc(e,t),ic(e,Ye()),n;if(6===n)throw Error(o(345));return e.finishedWork=e.current.alternate,e.finishedLanes=t,kc(e,ju,zu),ic(e,Ye()),null}function lc(e,t){var n=Ru;Ru|=1;try{return e(t)}finally{0===(Ru=n)&&(Hu=Ye()+500,Bi&&Ui())}}function dc(e){null!==Ju&&0===Ju.tag&&0===(6&Ru)&&Cc();var t=Ru;Ru|=1;var n=Au.transition,r=bt;try{if(Au.transition=null,bt=1,e)return e()}finally{bt=r,Au.transition=n,0===(6&(Ru=t))&&Ui()}}function hc(){Ou=Mu.current,Ei(Mu)}function fc(e,t){e.finishedWork=null,e.finishedLanes=0;var n=e.timeoutHandle;if(-1!==n&&(e.timeoutHandle=-1,ii(n)),null!==Pu)for(n=Pu.return;null!==n;){var r=n;switch(to(r),r.tag){case 1:null!==(r=r.type.childContextTypes)&&void 0!==r&&Oi();break;case 3:oa(),Ei(Ri),Ei(Ai),da();break;case 5:sa(r);break;case 4:oa();break;case 13:case 19:Ei(ua);break;case 10:Co(r.type._context);break;case 22:case 23:hc()}n=n.return}if(_u=e,Pu=e=Mc(e.current,null),Nu=Ou=t,Fu=0,Zu=null,Bu=Lu=Du=0,ju=qu=null,null!==Io){for(t=0;t<Io.length;t++)if(null!==(r=(n=Io[t]).interleaved)){n.interleaved=null;var i=r.next,o=n.pending;if(null!==o){var a=o.next;o.next=i,r.next=a}n.pending=r}Io=null}return e}function pc(e,t){for(;;){var n=Pu;try{if(ko(),ha.current=as,ya){for(var r=va.memoizedState;null!==r;){var i=r.queue;null!==i&&(i.pending=null),r=r.next}ya=!1}if(pa=0,ma=ga=va=null,ba=!1,wa=0,Iu.current=null,null===n||null===n.return){Fu=1,Zu=t,Pu=null;break}e:{var a=e,s=n.return,u=n,c=t;if(t=Nu,u.flags|=32768,null!==c&&"object"===typeof c&&"function"===typeof c.then){var l=c,d=u,h=d.tag;if(0===(1&d.mode)&&(0===h||11===h||15===h)){var f=d.alternate;f?(d.updateQueue=f.updateQueue,d.memoizedState=f.memoizedState,d.lanes=f.lanes):(d.updateQueue=null,d.memoizedState=null)}var p=ms(s);if(null!==p){p.flags&=-257,ys(p,s,u,0,t),1&p.mode&&gs(a,l,t),c=l;var v=(t=p).updateQueue;if(null===v){var g=new Set;g.add(c),t.updateQueue=g}else v.add(c);break e}if(0===(1&t)){gs(a,l,t),gc();break e}c=Error(o(426))}else if(io&&1&u.mode){var m=ms(s);if(null!==m){0===(65536&m.flags)&&(m.flags|=256),ys(m,s,u,0,t),vo(ls(c,u));break e}}a=c=ls(c,u),4!==Fu&&(Fu=2),null===qu?qu=[a]:qu.push(a),a=s;do{switch(a.tag){case 3:a.flags|=65536,t&=-t,a.lanes|=t,Do(a,ps(0,c,t));break e;case 1:u=c;var y=a.type,b=a.stateNode;if(0===(128&a.flags)&&("function"===typeof y.getDerivedStateFromError||null!==b&&"function"===typeof b.componentDidCatch&&(null===Ku||!Ku.has(b)))){a.flags|=65536,t&=-t,a.lanes|=t,Do(a,vs(a,u,t));break e}}a=a.return}while(null!==a)}Sc(n)}catch(w){t=w,Pu===n&&null!==n&&(Pu=n=n.return);continue}break}}function vc(){var e=Tu.current;return Tu.current=as,null===e?as:e}function gc(){0!==Fu&&3!==Fu&&2!==Fu||(Fu=4),null===_u||0===(268435455&Du)&&0===(268435455&Lu)||uc(_u,Nu)}function mc(e,t){var n=Ru;Ru|=2;var r=vc();for(_u===e&&Nu===t||(zu=null,fc(e,t));;)try{yc();break}catch(i){pc(e,i)}if(ko(),Ru=n,Tu.current=r,null!==Pu)throw Error(o(261));return _u=null,Nu=0,Fu}function yc(){for(;null!==Pu;)wc(Pu)}function bc(){for(;null!==Pu&&!Je();)wc(Pu)}function wc(e){var t=xu(e.alternate,e,Ou);e.memoizedProps=e.pendingProps,null===t?Sc(e):Pu=t,Iu.current=null}function Sc(e){var t=e;do{var n=t.alternate;if(e=t.return,0===(32768&t.flags)){if(null!==(n=Ws(n,t,Ou)))return void(Pu=n)}else{if(null!==(n=Js(n,t)))return n.flags&=32767,void(Pu=n);if(null===e)return Fu=6,void(Pu=null);e.flags|=32768,e.subtreeFlags=0,e.deletions=null}if(null!==(t=t.sibling))return void(Pu=t);Pu=t=e}while(null!==t);0===Fu&&(Fu=5)}function kc(e,t,n){var r=bt,i=Au.transition;try{Au.transition=null,bt=1,function(e,t,n,r){do{Cc()}while(null!==Ju);if(0!==(6&Ru))throw Error(o(327));n=e.finishedWork;var i=e.finishedLanes;if(null===n)return null;if(e.finishedWork=null,e.finishedLanes=0,n===e.current)throw Error(o(177));e.callbackNode=null,e.callbackPriority=0;var a=n.lanes|n.childLanes;if(function(e,t){var n=e.pendingLanes&~t;e.pendingLanes=t,e.suspendedLanes=0,e.pingedLanes=0,e.expiredLanes&=t,e.mutableReadLanes&=t,e.entangledLanes&=t,t=e.entanglements;var r=e.eventTimes;for(e=e.expirationTimes;0<n;){var i=31-at(n),o=1<<i;t[i]=0,r[i]=-1,e[i]=-1,n&=~o}}(e,a),e===_u&&(Pu=_u=null,Nu=0),0===(2064&n.subtreeFlags)&&0===(2064&n.flags)||Wu||(Wu=!0,_c(tt,(function(){return Cc(),null}))),a=0!==(15990&n.flags),0!==(15990&n.subtreeFlags)||a){a=Au.transition,Au.transition=null;var s=bt;bt=1;var u=Ru;Ru|=4,Iu.current=null,function(e,t){if(ei=zt,fr(e=hr())){if("selectionStart"in e)var n={start:e.selectionStart,end:e.selectionEnd};else e:{var r=(n=(n=e.ownerDocument)&&n.defaultView||window).getSelection&&n.getSelection();if(r&&0!==r.rangeCount){n=r.anchorNode;var i=r.anchorOffset,a=r.focusNode;r=r.focusOffset;try{n.nodeType,a.nodeType}catch(S){n=null;break e}var s=0,u=-1,c=-1,l=0,d=0,h=e,f=null;t:for(;;){for(var p;h!==n||0!==i&&3!==h.nodeType||(u=s+i),h!==a||0!==r&&3!==h.nodeType||(c=s+r),3===h.nodeType&&(s+=h.nodeValue.length),null!==(p=h.firstChild);)f=h,h=p;for(;;){if(h===e)break t;if(f===n&&++l===i&&(u=s),f===a&&++d===r&&(c=s),null!==(p=h.nextSibling))break;f=(h=f).parentNode}h=p}n=-1===u||-1===c?null:{start:u,end:c}}else n=null}n=n||{start:0,end:0}}else n=null;for(ti={focusedElem:e,selectionRange:n},zt=!1,$s=t;null!==$s;)if(e=(t=$s).child,0!==(1028&t.subtreeFlags)&&null!==e)e.return=t,$s=e;else for(;null!==$s;){t=$s;try{var v=t.alternate;if(0!==(1024&t.flags))switch(t.tag){case 0:case 11:case 15:case 5:case 6:case 4:case 17:break;case 1:if(null!==v){var g=v.memoizedProps,m=v.memoizedState,y=t.stateNode,b=y.getSnapshotBeforeUpdate(t.elementType===t.type?g:mo(t.type,g),m);y.__reactInternalSnapshotBeforeUpdate=b}break;case 3:var w=t.stateNode.containerInfo;1===w.nodeType?w.textContent="":9===w.nodeType&&w.documentElement&&w.removeChild(w.documentElement);break;default:throw Error(o(163))}}catch(S){Ec(t,t.return,S)}if(null!==(e=t.sibling)){e.return=t.return,$s=e;break}$s=t.return}v=nu,nu=!1}(e,n),mu(n,e),pr(ti),zt=!!ei,ti=ei=null,e.current=n,bu(n,e,i),Qe(),Ru=u,bt=s,Au.transition=a}else e.current=n;if(Wu&&(Wu=!1,Ju=e,Qu=i),a=e.pendingLanes,0===a&&(Ku=null),function(e){if(ot&&"function"===typeof ot.onCommitFiberRoot)try{ot.onCommitFiberRoot(it,e,void 0,128===(128&e.current.flags))}catch(t){}}(n.stateNode),ic(e,Ye()),null!==t)for(r=e.onRecoverableError,n=0;n<t.length;n++)i=t[n],r(i.value,{componentStack:i.stack,digest:i.digest});if(Vu)throw Vu=!1,e=Gu,Gu=null,e;0!==(1&Qu)&&0!==e.tag&&Cc(),a=e.pendingLanes,0!==(1&a)?e===Xu?Yu++:(Yu=0,Xu=e):Yu=0,Ui()}(e,t,n,r)}finally{Au.transition=i,bt=r}return null}function Cc(){if(null!==Ju){var e=wt(Qu),t=Au.transition,n=bt;try{if(Au.transition=null,bt=16>e?16:e,null===Ju)var r=!1;else{if(e=Ju,Ju=null,Qu=0,0!==(6&Ru))throw Error(o(331));var i=Ru;for(Ru|=4,$s=e.current;null!==$s;){var a=$s,s=a.child;if(0!==(16&$s.flags)){var u=a.deletions;if(null!==u){for(var c=0;c<u.length;c++){var l=u[c];for($s=l;null!==$s;){var d=$s;switch(d.tag){case 0:case 11:case 15:ru(8,d,a)}var h=d.child;if(null!==h)h.return=d,$s=h;else for(;null!==$s;){var f=(d=$s).sibling,p=d.return;if(au(d),d===l){$s=null;break}if(null!==f){f.return=p,$s=f;break}$s=p}}}var v=a.alternate;if(null!==v){var g=v.child;if(null!==g){v.child=null;do{var m=g.sibling;g.sibling=null,g=m}while(null!==g)}}$s=a}}if(0!==(2064&a.subtreeFlags)&&null!==s)s.return=a,$s=s;else e:for(;null!==$s;){if(0!==(2048&(a=$s).flags))switch(a.tag){case 0:case 11:case 15:ru(9,a,a.return)}var y=a.sibling;if(null!==y){y.return=a.return,$s=y;break e}$s=a.return}}var b=e.current;for($s=b;null!==$s;){var w=(s=$s).child;if(0!==(2064&s.subtreeFlags)&&null!==w)w.return=s,$s=w;else e:for(s=b;null!==$s;){if(0!==(2048&(u=$s).flags))try{switch(u.tag){case 0:case 11:case 15:iu(9,u)}}catch(k){Ec(u,u.return,k)}if(u===s){$s=null;break e}var S=u.sibling;if(null!==S){S.return=u.return,$s=S;break e}$s=u.return}}if(Ru=i,Ui(),ot&&"function"===typeof ot.onPostCommitFiberRoot)try{ot.onPostCommitFiberRoot(it,e)}catch(k){}r=!0}return r}finally{bt=n,Au.transition=t}}return!1}function xc(e,t,n){e=Fo(e,t=ps(0,t=ls(n,t),1),1),t=tc(),null!==e&&(mt(e,1,t),ic(e,t))}function Ec(e,t,n){if(3===e.tag)xc(e,e,n);else for(;null!==t;){if(3===t.tag){xc(t,e,n);break}if(1===t.tag){var r=t.stateNode;if("function"===typeof t.type.getDerivedStateFromError||"function"===typeof r.componentDidCatch&&(null===Ku||!Ku.has(r))){t=Fo(t,e=vs(t,e=ls(n,e),1),1),e=tc(),null!==t&&(mt(t,1,e),ic(t,e));break}}t=t.return}}function Tc(e,t,n){var r=e.pingCache;null!==r&&r.delete(t),t=tc(),e.pingedLanes|=e.suspendedLanes&n,_u===e&&(Nu&n)===n&&(4===Fu||3===Fu&&(130023424&Nu)===Nu&&500>Ye()-Uu?fc(e,0):Bu|=n),ic(e,t)}function Ic(e,t){0===t&&(0===(1&e.mode)?t=1:(t=lt,0===(130023424&(lt<<=1))&&(lt=4194304)));var n=tc();null!==(e=_o(e,t))&&(mt(e,t,n),ic(e,n))}function Ac(e){var t=e.memoizedState,n=0;null!==t&&(n=t.retryLane),Ic(e,n)}function Rc(e,t){var n=0;switch(e.tag){case 13:var r=e.stateNode,i=e.memoizedState;null!==i&&(n=i.retryLane);break;case 19:r=e.stateNode;break;default:throw Error(o(314))}null!==r&&r.delete(t),Ic(e,n)}function _c(e,t){return Ke(e,t)}function Pc(e,t,n,r){this.tag=e,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=r,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Nc(e,t,n,r){return new Pc(e,t,n,r)}function Oc(e){return!(!(e=e.prototype)||!e.isReactComponent)}function Mc(e,t){var n=e.alternate;return null===n?((n=Nc(e.tag,t,e.key,e.mode)).elementType=e.elementType,n.type=e.type,n.stateNode=e.stateNode,n.alternate=e,e.alternate=n):(n.pendingProps=t,n.type=e.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=14680064&e.flags,n.childLanes=e.childLanes,n.lanes=e.lanes,n.child=e.child,n.memoizedProps=e.memoizedProps,n.memoizedState=e.memoizedState,n.updateQueue=e.updateQueue,t=e.dependencies,n.dependencies=null===t?null:{lanes:t.lanes,firstContext:t.firstContext},n.sibling=e.sibling,n.index=e.index,n.ref=e.ref,n}function Fc(e,t,n,r,i,a){var s=2;if(r=e,"function"===typeof e)Oc(e)&&(s=1);else if("string"===typeof e)s=5;else e:switch(e){case C:return Zc(n.children,i,a,t);case x:s=8,i|=8;break;case E:return(e=Nc(12,n,t,2|i)).elementType=E,e.lanes=a,e;case R:return(e=Nc(13,n,t,i)).elementType=R,e.lanes=a,e;case _:return(e=Nc(19,n,t,i)).elementType=_,e.lanes=a,e;case O:return Dc(n,i,a,t);default:if("object"===typeof e&&null!==e)switch(e.$$typeof){case T:s=10;break e;case I:s=9;break e;case A:s=11;break e;case P:s=14;break e;case N:s=16,r=null;break e}throw Error(o(130,null==e?e:typeof e,""))}return(t=Nc(s,n,t,i)).elementType=e,t.type=r,t.lanes=a,t}function Zc(e,t,n,r){return(e=Nc(7,e,r,t)).lanes=n,e}function Dc(e,t,n,r){return(e=Nc(22,e,r,t)).elementType=O,e.lanes=n,e.stateNode={isHidden:!1},e}function Lc(e,t,n){return(e=Nc(6,e,null,t)).lanes=n,e}function Bc(e,t,n){return(t=Nc(4,null!==e.children?e.children:[],e.key,t)).lanes=n,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}function qc(e,t,n,r,i){this.tag=t,this.containerInfo=e,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=gt(0),this.expirationTimes=gt(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=gt(0),this.identifierPrefix=r,this.onRecoverableError=i,this.mutableSourceEagerHydrationData=null}function jc(e,t,n,r,i,o,a,s,u){return e=new qc(e,t,n,s,u),1===t?(t=1,!0===o&&(t|=8)):t=0,o=Nc(3,null,null,t),e.current=o,o.stateNode=e,o.memoizedState={element:r,isDehydrated:n,cache:null,transitions:null,pendingSuspenseBoundaries:null},No(o),e}function Uc(e){if(!e)return Ii;e:{if(Ue(e=e._reactInternals)!==e||1!==e.tag)throw Error(o(170));var t=e;do{switch(t.tag){case 3:t=t.stateNode.context;break e;case 1:if(Ni(t.type)){t=t.stateNode.__reactInternalMemoizedMergedChildContext;break e}}t=t.return}while(null!==t);throw Error(o(171))}if(1===e.tag){var n=e.type;if(Ni(n))return Fi(e,n,t)}return t}function Hc(e,t,n,r,i,o,a,s,u){return(e=jc(n,r,!0,e,0,o,0,s,u)).context=Uc(null),n=e.current,(o=Mo(r=tc(),i=nc(n))).callback=void 0!==t&&null!==t?t:null,Fo(n,o,i),e.current.lanes=i,mt(e,i,r),ic(e,r),e}function zc(e,t,n,r){var i=t.current,o=tc(),a=nc(i);return n=Uc(n),null===t.context?t.context=n:t.pendingContext=n,(t=Mo(o,a)).payload={element:e},null!==(r=void 0===r?null:r)&&(t.callback=r),null!==(e=Fo(i,t,a))&&(rc(e,i,a,o),Zo(e,i,a)),a}function Vc(e){return(e=e.current).child?(e.child.tag,e.child.stateNode):null}function Gc(e,t){if(null!==(e=e.memoizedState)&&null!==e.dehydrated){var n=e.retryLane;e.retryLane=0!==n&&n<t?n:t}}function Kc(e,t){Gc(e,t),(e=e.alternate)&&Gc(e,t)}xu=function(e,t,n){if(null!==e)if(e.memoizedProps!==t.pendingProps||Ri.current)ws=!0;else{if(0===(e.lanes&n)&&0===(128&t.flags))return ws=!1,function(e,t,n){switch(t.tag){case 3:_s(t),po();break;case 5:aa(t);break;case 1:Ni(t.type)&&Zi(t);break;case 4:ia(t,t.stateNode.containerInfo);break;case 10:var r=t.type._context,i=t.memoizedProps.value;Ti(yo,r._currentValue),r._currentValue=i;break;case 13:if(null!==(r=t.memoizedState))return null!==r.dehydrated?(Ti(ua,1&ua.current),t.flags|=128,null):0!==(n&t.child.childLanes)?Ls(e,t,n):(Ti(ua,1&ua.current),null!==(e=Vs(e,t,n))?e.sibling:null);Ti(ua,1&ua.current);break;case 19:if(r=0!==(n&t.childLanes),0!==(128&e.flags)){if(r)return Hs(e,t,n);t.flags|=128}if(null!==(i=t.memoizedState)&&(i.rendering=null,i.tail=null,i.lastEffect=null),Ti(ua,ua.current),r)break;return null;case 22:case 23:return t.lanes=0,Es(e,t,n)}return Vs(e,t,n)}(e,t,n);ws=0!==(131072&e.flags)}else ws=!1,io&&0!==(1048576&t.flags)&&$i(t,Gi,t.index);switch(t.lanes=0,t.tag){case 2:var r=t.type;zs(e,t),e=t.pendingProps;var i=Pi(t,Ai.current);Eo(t,n),i=xa(null,t,r,e,i,n);var a=Ea();return t.flags|=1,"object"===typeof i&&null!==i&&"function"===typeof i.render&&void 0===i.$$typeof?(t.tag=1,t.memoizedState=null,t.updateQueue=null,Ni(r)?(a=!0,Zi(t)):a=!1,t.memoizedState=null!==i.state&&void 0!==i.state?i.state:null,No(t),i.updater=Uo,t.stateNode=i,i._reactInternals=t,Go(t,r,e,n),t=Rs(null,t,r,!0,a,n)):(t.tag=0,io&&a&&eo(t),Ss(null,t,i,n),t=t.child),t;case 16:r=t.elementType;e:{switch(zs(e,t),e=t.pendingProps,r=(i=r._init)(r._payload),t.type=r,i=t.tag=function(e){if("function"===typeof e)return Oc(e)?1:0;if(void 0!==e&&null!==e){if((e=e.$$typeof)===A)return 11;if(e===P)return 14}return 2}(r),e=mo(r,e),i){case 0:t=Is(null,t,r,e,n);break e;case 1:t=As(null,t,r,e,n);break e;case 11:t=ks(null,t,r,e,n);break e;case 14:t=Cs(null,t,r,mo(r.type,e),n);break e}throw Error(o(306,r,""))}return t;case 0:return r=t.type,i=t.pendingProps,Is(e,t,r,i=t.elementType===r?i:mo(r,i),n);case 1:return r=t.type,i=t.pendingProps,As(e,t,r,i=t.elementType===r?i:mo(r,i),n);case 3:e:{if(_s(t),null===e)throw Error(o(387));r=t.pendingProps,i=(a=t.memoizedState).element,Oo(e,t),Lo(t,r,null,n);var s=t.memoizedState;if(r=s.element,a.isDehydrated){if(a={element:r,isDehydrated:!1,cache:s.cache,pendingSuspenseBoundaries:s.pendingSuspenseBoundaries,transitions:s.transitions},t.updateQueue.baseState=a,t.memoizedState=a,256&t.flags){t=Ps(e,t,r,n,i=ls(Error(o(423)),t));break e}if(r!==i){t=Ps(e,t,r,n,i=ls(Error(o(424)),t));break e}for(ro=ci(t.stateNode.containerInfo.firstChild),no=t,io=!0,oo=null,n=Xo(t,null,r,n),t.child=n;n;)n.flags=-3&n.flags|4096,n=n.sibling}else{if(po(),r===i){t=Vs(e,t,n);break e}Ss(e,t,r,n)}t=t.child}return t;case 5:return aa(t),null===e&&co(t),r=t.type,i=t.pendingProps,a=null!==e?e.memoizedProps:null,s=i.children,ni(r,i)?s=null:null!==a&&ni(r,a)&&(t.flags|=32),Ts(e,t),Ss(e,t,s,n),t.child;case 6:return null===e&&co(t),null;case 13:return Ls(e,t,n);case 4:return ia(t,t.stateNode.containerInfo),r=t.pendingProps,null===e?t.child=Yo(t,null,r,n):Ss(e,t,r,n),t.child;case 11:return r=t.type,i=t.pendingProps,ks(e,t,r,i=t.elementType===r?i:mo(r,i),n);case 7:return Ss(e,t,t.pendingProps,n),t.child;case 8:case 12:return Ss(e,t,t.pendingProps.children,n),t.child;case 10:e:{if(r=t.type._context,i=t.pendingProps,a=t.memoizedProps,s=i.value,Ti(yo,r._currentValue),r._currentValue=s,null!==a)if(sr(a.value,s)){if(a.children===i.children&&!Ri.current){t=Vs(e,t,n);break e}}else for(null!==(a=t.child)&&(a.return=t);null!==a;){var u=a.dependencies;if(null!==u){s=a.child;for(var c=u.firstContext;null!==c;){if(c.context===r){if(1===a.tag){(c=Mo(-1,n&-n)).tag=2;var l=a.updateQueue;if(null!==l){var d=(l=l.shared).pending;null===d?c.next=c:(c.next=d.next,d.next=c),l.pending=c}}a.lanes|=n,null!==(c=a.alternate)&&(c.lanes|=n),xo(a.return,n,t),u.lanes|=n;break}c=c.next}}else if(10===a.tag)s=a.type===t.type?null:a.child;else if(18===a.tag){if(null===(s=a.return))throw Error(o(341));s.lanes|=n,null!==(u=s.alternate)&&(u.lanes|=n),xo(s,n,t),s=a.sibling}else s=a.child;if(null!==s)s.return=a;else for(s=a;null!==s;){if(s===t){s=null;break}if(null!==(a=s.sibling)){a.return=s.return,s=a;break}s=s.return}a=s}Ss(e,t,i.children,n),t=t.child}return t;case 9:return i=t.type,r=t.pendingProps.children,Eo(t,n),r=r(i=To(i)),t.flags|=1,Ss(e,t,r,n),t.child;case 14:return i=mo(r=t.type,t.pendingProps),Cs(e,t,r,i=mo(r.type,i),n);case 15:return xs(e,t,t.type,t.pendingProps,n);case 17:return r=t.type,i=t.pendingProps,i=t.elementType===r?i:mo(r,i),zs(e,t),t.tag=1,Ni(r)?(e=!0,Zi(t)):e=!1,Eo(t,n),zo(t,r,i),Go(t,r,i,n),Rs(null,t,r,!0,e,n);case 19:return Hs(e,t,n);case 22:return Es(e,t,n)}throw Error(o(156,t.tag))};var Wc="function"===typeof reportError?reportError:function(e){console.error(e)};function Jc(e){this._internalRoot=e}function Qc(e){this._internalRoot=e}function Yc(e){return!(!e||1!==e.nodeType&&9!==e.nodeType&&11!==e.nodeType)}function Xc(e){return!(!e||1!==e.nodeType&&9!==e.nodeType&&11!==e.nodeType&&(8!==e.nodeType||" react-mount-point-unstable "!==e.nodeValue))}function $c(){}function el(e,t,n,r,i){var o=n._reactRootContainer;if(o){var a=o;if("function"===typeof i){var s=i;i=function(){var e=Vc(a);s.call(e)}}zc(t,a,e,i)}else a=function(e,t,n,r,i){if(i){if("function"===typeof r){var o=r;r=function(){var e=Vc(a);o.call(e)}}var a=Hc(t,r,e,0,null,!1,0,"",$c);return e._reactRootContainer=a,e[pi]=a.current,Ur(8===e.nodeType?e.parentNode:e),dc(),a}for(;i=e.lastChild;)e.removeChild(i);if("function"===typeof r){var s=r;r=function(){var e=Vc(u);s.call(e)}}var u=jc(e,0,!1,null,0,!1,0,"",$c);return e._reactRootContainer=u,e[pi]=u.current,Ur(8===e.nodeType?e.parentNode:e),dc((function(){zc(t,u,n,r)})),u}(n,t,e,i,r);return Vc(a)}Qc.prototype.render=Jc.prototype.render=function(e){var t=this._internalRoot;if(null===t)throw Error(o(409));zc(e,t,null,null)},Qc.prototype.unmount=Jc.prototype.unmount=function(){var e=this._internalRoot;if(null!==e){this._internalRoot=null;var t=e.containerInfo;dc((function(){zc(null,e,null,null)})),t[pi]=null}},Qc.prototype.unstable_scheduleHydration=function(e){if(e){var t=xt();e={blockedOn:null,target:e,priority:t};for(var n=0;n<Ot.length&&0!==t&&t<Ot[n].priority;n++);Ot.splice(n,0,e),0===n&&Dt(e)}},St=function(e){switch(e.tag){case 3:var t=e.stateNode;if(t.current.memoizedState.isDehydrated){var n=dt(t.pendingLanes);0!==n&&(yt(t,1|n),ic(t,Ye()),0===(6&Ru)&&(Hu=Ye()+500,Ui()))}break;case 13:dc((function(){var t=_o(e,1);if(null!==t){var n=tc();rc(t,e,1,n)}})),Kc(e,1)}},kt=function(e){if(13===e.tag){var t=_o(e,134217728);if(null!==t)rc(t,e,134217728,tc());Kc(e,134217728)}},Ct=function(e){if(13===e.tag){var t=nc(e),n=_o(e,t);if(null!==n)rc(n,e,t,tc());Kc(e,t)}},xt=function(){return bt},Et=function(e,t){var n=bt;try{return bt=e,t()}finally{bt=n}},ke=function(e,t,n){switch(t){case"input":if(X(e,n),t=n.name,"radio"===n.type&&null!=t){for(n=e;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll("input[name="+JSON.stringify(""+t)+'][type="radio"]'),t=0;t<n.length;t++){var r=n[t];if(r!==e&&r.form===e.form){var i=Si(r);if(!i)throw Error(o(90));K(r),X(r,i)}}}break;case"textarea":oe(e,n);break;case"select":null!=(t=n.value)&&ne(e,!!n.multiple,t,!1)}},Ae=lc,Re=dc;var tl={usingClientEntryPoint:!1,Events:[bi,wi,Si,Te,Ie,lc]},nl={findFiberByHostInstance:yi,bundleType:0,version:"18.2.0",rendererPackageName:"react-dom"},rl={bundleType:nl.bundleType,version:nl.version,rendererPackageName:nl.rendererPackageName,rendererConfig:nl.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:w.ReactCurrentDispatcher,findHostInstanceByFiber:function(e){return null===(e=Ve(e))?null:e.stateNode},findFiberByHostInstance:nl.findFiberByHostInstance||function(){return null},findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.2.0-next-9e3b772b8-20220608"};if("undefined"!==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__){var il=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!il.isDisabled&&il.supportsFiber)try{it=il.inject(rl),ot=il}catch(le){}}t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=tl,t.createPortal=function(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;if(!Yc(t))throw Error(o(200));return function(e,t,n){var r=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null;return{$$typeof:k,key:null==r?null:""+r,children:e,containerInfo:t,implementation:n}}(e,t,null,n)},t.createRoot=function(e,t){if(!Yc(e))throw Error(o(299));var n=!1,r="",i=Wc;return null!==t&&void 0!==t&&(!0===t.unstable_strictMode&&(n=!0),void 0!==t.identifierPrefix&&(r=t.identifierPrefix),void 0!==t.onRecoverableError&&(i=t.onRecoverableError)),t=jc(e,1,!1,null,0,n,0,r,i),e[pi]=t.current,Ur(8===e.nodeType?e.parentNode:e),new Jc(t)},t.findDOMNode=function(e){if(null==e)return null;if(1===e.nodeType)return e;var t=e._reactInternals;if(void 0===t){if("function"===typeof e.render)throw Error(o(188));throw e=Object.keys(e).join(","),Error(o(268,e))}return e=null===(e=Ve(t))?null:e.stateNode},t.flushSync=function(e){return dc(e)},t.hydrate=function(e,t,n){if(!Xc(t))throw Error(o(200));return el(null,e,t,!0,n)},t.hydrateRoot=function(e,t,n){if(!Yc(e))throw Error(o(405));var r=null!=n&&n.hydratedSources||null,i=!1,a="",s=Wc;if(null!==n&&void 0!==n&&(!0===n.unstable_strictMode&&(i=!0),void 0!==n.identifierPrefix&&(a=n.identifierPrefix),void 0!==n.onRecoverableError&&(s=n.onRecoverableError)),t=Hc(t,null,e,1,null!=n?n:null,i,0,a,s),e[pi]=t.current,Ur(e),r)for(e=0;e<r.length;e++)i=(i=(n=r[e])._getVersion)(n._source),null==t.mutableSourceEagerHydrationData?t.mutableSourceEagerHydrationData=[n,i]:t.mutableSourceEagerHydrationData.push(n,i);return new Qc(t)},t.render=function(e,t,n){if(!Xc(t))throw Error(o(200));return el(null,e,t,!1,n)},t.unmountComponentAtNode=function(e){if(!Xc(e))throw Error(o(40));return!!e._reactRootContainer&&(dc((function(){el(null,null,e,!1,(function(){e._reactRootContainer=null,e[pi]=null}))})),!0)},t.unstable_batchedUpdates=lc,t.unstable_renderSubtreeIntoContainer=function(e,t,n,r){if(!Xc(n))throw Error(o(200));if(null==e||void 0===e._reactInternals)throw Error(o(38));return el(e,t,n,!1,r)},t.version="18.2.0-next-9e3b772b8-20220608"},1250:function(e,t,n){"use strict";var r=n(54164);t.s=r.createRoot,r.hydrateRoot},54164:function(e,t,n){"use strict";!function e(){if("undefined"!==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__&&"function"===typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE)try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(e)}catch(t){console.error(t)}}(),e.exports=n(34463)},30067:function(e,t){"use strict";function n(e,t){var n=e.length;e.push(t);e:for(;0<n;){var r=n-1>>>1,i=e[r];if(!(0<o(i,t)))break e;e[r]=t,e[n]=i,n=r}}function r(e){return 0===e.length?null:e[0]}function i(e){if(0===e.length)return null;var t=e[0],n=e.pop();if(n!==t){e[0]=n;e:for(var r=0,i=e.length,a=i>>>1;r<a;){var s=2*(r+1)-1,u=e[s],c=s+1,l=e[c];if(0>o(u,n))c<i&&0>o(l,u)?(e[r]=l,e[c]=n,r=c):(e[r]=u,e[s]=n,r=s);else{if(!(c<i&&0>o(l,n)))break e;e[r]=l,e[c]=n,r=c}}}return t}function o(e,t){var n=e.sortIndex-t.sortIndex;return 0!==n?n:e.id-t.id}if("object"===typeof performance&&"function"===typeof performance.now){var a=performance;t.unstable_now=function(){return a.now()}}else{var s=Date,u=s.now();t.unstable_now=function(){return s.now()-u}}var c=[],l=[],d=1,h=null,f=3,p=!1,v=!1,g=!1,m="function"===typeof setTimeout?setTimeout:null,y="function"===typeof clearTimeout?clearTimeout:null,b="undefined"!==typeof setImmediate?setImmediate:null;function w(e){for(var t=r(l);null!==t;){if(null===t.callback)i(l);else{if(!(t.startTime<=e))break;i(l),t.sortIndex=t.expirationTime,n(c,t)}t=r(l)}}function S(e){if(g=!1,w(e),!v)if(null!==r(c))v=!0,O(k);else{var t=r(l);null!==t&&M(S,t.startTime-e)}}function k(e,n){v=!1,g&&(g=!1,y(T),T=-1),p=!0;var o=f;try{for(w(n),h=r(c);null!==h&&(!(h.expirationTime>n)||e&&!R());){var a=h.callback;if("function"===typeof a){h.callback=null,f=h.priorityLevel;var s=a(h.expirationTime<=n);n=t.unstable_now(),"function"===typeof s?h.callback=s:h===r(c)&&i(c),w(n)}else i(c);h=r(c)}if(null!==h)var u=!0;else{var d=r(l);null!==d&&M(S,d.startTime-n),u=!1}return u}finally{h=null,f=o,p=!1}}"undefined"!==typeof navigator&&void 0!==navigator.scheduling&&void 0!==navigator.scheduling.isInputPending&&navigator.scheduling.isInputPending.bind(navigator.scheduling);var C,x=!1,E=null,T=-1,I=5,A=-1;function R(){return!(t.unstable_now()-A<I)}function _(){if(null!==E){var e=t.unstable_now();A=e;var n=!0;try{n=E(!0,e)}finally{n?C():(x=!1,E=null)}}else x=!1}if("function"===typeof b)C=function(){b(_)};else if("undefined"!==typeof MessageChannel){var P=new MessageChannel,N=P.port2;P.port1.onmessage=_,C=function(){N.postMessage(null)}}else C=function(){m(_,0)};function O(e){E=e,x||(x=!0,C())}function M(e,n){T=m((function(){e(t.unstable_now())}),n)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(e){e.callback=null},t.unstable_continueExecution=function(){v||p||(v=!0,O(k))},t.unstable_forceFrameRate=function(e){0>e||125<e?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):I=0<e?Math.floor(1e3/e):5},t.unstable_getCurrentPriorityLevel=function(){return f},t.unstable_getFirstCallbackNode=function(){return r(c)},t.unstable_next=function(e){switch(f){case 1:case 2:case 3:var t=3;break;default:t=f}var n=f;f=t;try{return e()}finally{f=n}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(e,t){switch(e){case 1:case 2:case 3:case 4:case 5:break;default:e=3}var n=f;f=e;try{return t()}finally{f=n}},t.unstable_scheduleCallback=function(e,i,o){var a=t.unstable_now();switch("object"===typeof o&&null!==o?o="number"===typeof(o=o.delay)&&0<o?a+o:a:o=a,e){case 1:var s=-1;break;case 2:s=250;break;case 5:s=1073741823;break;case 4:s=1e4;break;default:s=5e3}return e={id:d++,callback:i,priorityLevel:e,startTime:o,expirationTime:s=o+s,sortIndex:-1},o>a?(e.sortIndex=o,n(l,e),null===r(c)&&e===r(l)&&(g?(y(T),T=-1):g=!0,M(S,o-a))):(e.sortIndex=s,n(c,e),v||p||(v=!0,O(k))),e},t.unstable_shouldYield=R,t.unstable_wrapCallback=function(e){var t=f;return function(){var n=f;f=t;try{return e.apply(this,arguments)}finally{f=n}}}},75585:function(e,t,n){"use strict";e.exports=n(30067)},27003:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Unity=void 0;var r=n(72791),i=n(72791),o=n(46445),a=n(48802),s=n(38604),u=n(96428),c=(0,i.forwardRef)((function(e,t){var n=(0,i.useRef)(null),c=(0,o.useUnityCanvasId)(),l=(0,s.useUnityArguments)(e),d=(0,u.useUnityLoader)(e.unityProvider.unityConfig);return(0,a.useUnityInstance)(d,n.current,l,e.unityProvider),(0,r.useImperativeHandle)(t,(function(){return n.current})),(0,r.createElement)("canvas",{ref:n,id:c,style:e.style,className:e.className,tabIndex:e.tabIndex})}));t.Unity=c},49774:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.errorMessages=void 0;t.errorMessages={genericNoUnityInstance:"No Unity Instance found.",requestFullscreenNoUnityInstance:"Unable to Set Fullscreen while Unity is not Instantiated.",requestPointerLockNoUnityInstanceOrCanvas:"Unable to Request Pointer Lock while Unity is not Instantiated or the Canvas is not found.",sendMessageNoUnityInstance:"Unable to Send Message while Unity is not Instantiated.",quitNoUnityInstance:"Unable to Quit Unity while Unity is not Instantiated.",screenshotNoUnityInstanceOrCanvas:"Unable to Take Screenshot while Unity is not Instantiated or Canvas is not available.",noEventListener:"Unable to find Event Listener in Event System for Event"}},47359:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isBrowserEnvironment=void 0,t.isBrowserEnvironment="undefined"!==typeof window&&"undefined"!==typeof document},17229:function(e,t){"use strict";var n;Object.defineProperty(t,"__esModule",{value:!0}),t.UnityLoaderStatus=void 0,function(e){e.Idle="Idle",e.Loading="Loading",e.Loaded="Loaded",e.Error="Error"}(n||(n={})),t.UnityLoaderStatus=n},25277:function(e,t,n){"use strict";t.JM=t.Y4=void 0;var r=n(27003);Object.defineProperty(t,"Y4",{enumerable:!0,get:function(){return r.Unity}});var i=n(37138);Object.defineProperty(t,"JM",{enumerable:!0,get:function(){return i.useUnityContext}})},94773:function(e,t,n){"use strict";var r=this&&this.__spreadArray||function(e,t,n){if(n||2===arguments.length)for(var r,i=0,o=t.length;i<o;i++)!r&&i in t||(r||(r=Array.prototype.slice.call(t,0,i)),r[i]=t[i]);return e.concat(r||Array.prototype.slice.call(t))};Object.defineProperty(t,"__esModule",{value:!0}),t.useEventSystem=void 0;var i=n(72791),o=n(49774),a=n(47359),s=[];!0===a.isBrowserEnvironment&&(window.dispatchReactUnityEvent=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];var i=void 0;return s.forEach((function(n){i=n.apply(void 0,r([e],t,!1))})),i});t.useEventSystem=function(){var e=(0,i.useRef)([]),t=(0,i.useCallback)((function(t,n){e.current=r(r([],e.current,!0),[{eventName:t,callback:n}],!1)}),[e]),n=(0,i.useCallback)((function(t,n){e.current=e.current.filter((function(e){return e.eventName!==t&&e.callback!==n}))}),[e]),a=(0,i.useCallback)((function(t){for(var n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];var i=e.current.find((function(e){return e.eventName===t}));if("undefined"!==typeof i)return i.callback.apply(i,n);console.warn(o.errorMessages.noEventListener,{eventName:t})}),[e]);return(0,i.useEffect)((function(){return s.push(a),function(){s.splice(s.indexOf(a),1)}}),[a]),{addEventListener:t,removeEventListener:n}}},19627:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.useNullableState=void 0;var r=n(72791);t.useNullableState=function(e){return(0,r.useState)(e||null)}},38604:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.useUnityArguments=void 0;var r=n(72791);t.useUnityArguments=function(e){return(0,r.useMemo)((function(){return{dataUrl:e.unityProvider.unityConfig.dataUrl,frameworkUrl:e.unityProvider.unityConfig.frameworkUrl,codeUrl:e.unityProvider.unityConfig.codeUrl,streamingAssetsUrl:e.unityProvider.unityConfig.streamingAssetsUrl,memoryUrl:e.unityProvider.unityConfig.memoryUrl,symbolsUrl:e.unityProvider.unityConfig.symbolsUrl,companyName:e.unityProvider.unityConfig.companyName,productName:e.unityProvider.unityConfig.productName,productVersion:e.unityProvider.unityConfig.productVersion,webglContextAttributes:e.unityProvider.unityConfig.webglContextAttributes||{},cacheControl:e.unityProvider.unityConfig.cacheControl||function(){return"must-revalidate"},devicePixelRatio:e.devicePixelRatio||1,matchWebGLToCanvasSize:"boolean"!==typeof e.matchWebGLToCanvasSize||e.matchWebGLToCanvasSize,disabledCanvasEvents:e.disabledCanvasEvents||["contextmenu","dragstart"],print:function(e){},printErr:function(e){}}}),[])}},46445:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.useUnityCanvasId=void 0;var r=n(72791),i=0,o="react-unity-webgl-canvas";t.useUnityCanvasId=function(){return(0,r.useMemo)((function(){return[o,++i].join("-")}),[])}},37138:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.useUnityContext=void 0;var r=n(72791),i=n(49774),o=n(94773),a=n(19627);t.useUnityContext=function(e){var t=(0,a.useNullableState)(),n=t[0],s=t[1],u=(0,r.useState)(0),c=u[0],l=u[1],d=(0,r.useState)(!1),h=d[0],f=d[1],p=(0,a.useNullableState)(),v=p[0],g=p[1],m=(0,o.useEventSystem)(),y=(0,r.useRef)({setLoadingProgression:l,setInitialisationError:g,setUnityInstance:s,setIsLoaded:f,unityConfig:e}),b=(0,r.useCallback)((function(e){null!==n?n.SetFullscreen(!0===e?1:0):console.warn(i.errorMessages.requestFullscreenNoUnityInstance)}),[n]),w=(0,r.useCallback)((function(){if(null!==n&&"undefined"!==typeof n.Module.canvas)return n.Module.canvas.requestPointerLock();console.warn(i.errorMessages.requestPointerLockNoUnityInstanceOrCanvas)}),[n]),S=(0,r.useCallback)((function(e,t,r){null!==n?n.SendMessage(e,t,r):console.warn(i.errorMessages.sendMessageNoUnityInstance)}),[n]),k=(0,r.useCallback)((function(e,t){if(null!==n&&"undefined"!==typeof n.Module.canvas)return n.Module.canvas.toDataURL(e,t);console.warn(i.errorMessages.screenshotNoUnityInstanceOrCanvas)}),[n]),C=(0,r.useCallback)((function(){return null===n?(console.warn(i.errorMessages.quitNoUnityInstance),Promise.reject()):n.Quit()}),[n]);return(0,r.useEffect)((function(){f(1===c)}),[c]),{unityProvider:y.current,loadingProgression:c,initialisationError:v,isLoaded:h,UNSAFE__unityInstance:n,requestFullscreen:b,requestPointerLock:w,sendMessage:S,unload:C,takeScreenshot:k,addEventListener:m.addEventListener,removeEventListener:m.removeEventListener}}},48802:function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{u(r.next(e))}catch(t){o(t)}}function s(e){try{u(r.throw(e))}catch(t){o(t)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}u((r=r.apply(e,t||[])).next())}))},i=this&&this.__generator||function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"===typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=(i=a.trys).length>0&&i[i.length-1])&&(6===o[0]||2===o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(s){o=[6,s],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.useUnityInstance=void 0;var o=n(72791),a=n(17229),s=n(47359);t.useUnityInstance=function(e,t,n,u){(0,o.useEffect)((function(){r(void 0,void 0,void 0,(function(){var r,o;return i(this,(function(i){switch(i.label){case 0:if(!1===s.isBrowserEnvironment)return[2];if(e!==a.UnityLoaderStatus.Loaded||null===t)return u.setUnityInstance(null),u.setInitialisationError(null),[2];i.label=1;case 1:return i.trys.push([1,3,,4]),[4,window.createUnityInstance(t,n,u.setLoadingProgression)];case 2:return r=i.sent(),u.setUnityInstance(r),u.setInitialisationError(null),[3,4];case 3:return o=i.sent(),u.setUnityInstance(null),u.setInitialisationError(o),[3,4];case 4:return[2]}}))}))}),[e,t,n,u])}},96428:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.useUnityLoader=void 0;var r=n(72791),i=n(47359),o=n(17229);t.useUnityLoader=function(e){var t=(0,r.useState)(o.UnityLoaderStatus.Loading),n=t[0],a=t[1];return(0,r.useEffect)((function(){if(!1!==i.isBrowserEnvironment){if(null!==e.loaderUrl){var t=window.document.querySelector('script[src="'.concat(e.loaderUrl,'"]'));null===t?((t=window.document.createElement("script")).type="text/javascript",t.src=e.loaderUrl,t.async=!0,t.setAttribute("data-status","loading"),window.document.body.appendChild(t),t.addEventListener("load",(function(){return null===t||void 0===t?void 0:t.setAttribute("data-status","loaded")})),t.addEventListener("error",(function(){return null===t||void 0===t?void 0:t.setAttribute("data-status","error")}))):a("loaded"===t.getAttribute("data-status")?o.UnityLoaderStatus.Loaded:o.UnityLoaderStatus.Error);var n=function(e){return a("load"===e.type?o.UnityLoaderStatus.Loaded:o.UnityLoaderStatus.Error)};return t.addEventListener("load",n),t.addEventListener("error",n),function(){null!==t&&(t.removeEventListener("load",n),t.removeEventListener("error",n),window.document.body.removeChild(t))}}a(o.UnityLoaderStatus.Idle)}}),[e.loaderUrl]),n}},66374:function(e,t,n){"use strict";var r=n(72791),i=Symbol.for("react.element"),o=Symbol.for("react.fragment"),a=Object.prototype.hasOwnProperty,s=r.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,u={key:!0,ref:!0,__self:!0,__source:!0};function c(e,t,n){var r,o={},c=null,l=null;for(r in void 0!==n&&(c=""+n),void 0!==t.key&&(c=""+t.key),void 0!==t.ref&&(l=t.ref),t)a.call(t,r)&&!u.hasOwnProperty(r)&&(o[r]=t[r]);if(e&&e.defaultProps)for(r in t=e.defaultProps)void 0===o[r]&&(o[r]=t[r]);return{$$typeof:i,type:e,key:c,ref:l,props:o,_owner:s.current}}t.jsx=c,t.jsxs=c},59117:function(e,t){"use strict";var n=Symbol.for("react.element"),r=Symbol.for("react.portal"),i=Symbol.for("react.fragment"),o=Symbol.for("react.strict_mode"),a=Symbol.for("react.profiler"),s=Symbol.for("react.provider"),u=Symbol.for("react.context"),c=Symbol.for("react.forward_ref"),l=Symbol.for("react.suspense"),d=Symbol.for("react.memo"),h=Symbol.for("react.lazy"),f=Symbol.iterator;var p={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},v=Object.assign,g={};function m(e,t,n){this.props=e,this.context=t,this.refs=g,this.updater=n||p}function y(){}function b(e,t,n){this.props=e,this.context=t,this.refs=g,this.updater=n||p}m.prototype.isReactComponent={},m.prototype.setState=function(e,t){if("object"!==typeof e&&"function"!==typeof e&&null!=e)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,t,"setState")},m.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")},y.prototype=m.prototype;var w=b.prototype=new y;w.constructor=b,v(w,m.prototype),w.isPureReactComponent=!0;var S=Array.isArray,k=Object.prototype.hasOwnProperty,C={current:null},x={key:!0,ref:!0,__self:!0,__source:!0};function E(e,t,r){var i,o={},a=null,s=null;if(null!=t)for(i in void 0!==t.ref&&(s=t.ref),void 0!==t.key&&(a=""+t.key),t)k.call(t,i)&&!x.hasOwnProperty(i)&&(o[i]=t[i]);var u=arguments.length-2;if(1===u)o.children=r;else if(1<u){for(var c=Array(u),l=0;l<u;l++)c[l]=arguments[l+2];o.children=c}if(e&&e.defaultProps)for(i in u=e.defaultProps)void 0===o[i]&&(o[i]=u[i]);return{$$typeof:n,type:e,key:a,ref:s,props:o,_owner:C.current}}function T(e){return"object"===typeof e&&null!==e&&e.$$typeof===n}var I=/\/+/g;function A(e,t){return"object"===typeof e&&null!==e&&null!=e.key?function(e){var t={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,(function(e){return t[e]}))}(""+e.key):t.toString(36)}function R(e,t,i,o,a){var s=typeof e;"undefined"!==s&&"boolean"!==s||(e=null);var u=!1;if(null===e)u=!0;else switch(s){case"string":case"number":u=!0;break;case"object":switch(e.$$typeof){case n:case r:u=!0}}if(u)return a=a(u=e),e=""===o?"."+A(u,0):o,S(a)?(i="",null!=e&&(i=e.replace(I,"$&/")+"/"),R(a,t,i,"",(function(e){return e}))):null!=a&&(T(a)&&(a=function(e,t){return{$$typeof:n,type:e.type,key:t,ref:e.ref,props:e.props,_owner:e._owner}}(a,i+(!a.key||u&&u.key===a.key?"":(""+a.key).replace(I,"$&/")+"/")+e)),t.push(a)),1;if(u=0,o=""===o?".":o+":",S(e))for(var c=0;c<e.length;c++){var l=o+A(s=e[c],c);u+=R(s,t,i,l,a)}else if(l=function(e){return null===e||"object"!==typeof e?null:"function"===typeof(e=f&&e[f]||e["@@iterator"])?e:null}(e),"function"===typeof l)for(e=l.call(e),c=0;!(s=e.next()).done;)u+=R(s=s.value,t,i,l=o+A(s,c++),a);else if("object"===s)throw t=String(e),Error("Objects are not valid as a React child (found: "+("[object Object]"===t?"object with keys {"+Object.keys(e).join(", ")+"}":t)+"). If you meant to render a collection of children, use an array instead.");return u}function _(e,t,n){if(null==e)return e;var r=[],i=0;return R(e,r,"","",(function(e){return t.call(n,e,i++)})),r}function P(e){if(-1===e._status){var t=e._result;(t=t()).then((function(t){0!==e._status&&-1!==e._status||(e._status=1,e._result=t)}),(function(t){0!==e._status&&-1!==e._status||(e._status=2,e._result=t)})),-1===e._status&&(e._status=0,e._result=t)}if(1===e._status)return e._result.default;throw e._result}var N={current:null},O={transition:null},M={ReactCurrentDispatcher:N,ReactCurrentBatchConfig:O,ReactCurrentOwner:C};t.Children={map:_,forEach:function(e,t,n){_(e,(function(){t.apply(this,arguments)}),n)},count:function(e){var t=0;return _(e,(function(){t++})),t},toArray:function(e){return _(e,(function(e){return e}))||[]},only:function(e){if(!T(e))throw Error("React.Children.only expected to receive a single React element child.");return e}},t.Component=m,t.Fragment=i,t.Profiler=a,t.PureComponent=b,t.StrictMode=o,t.Suspense=l,t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=M,t.cloneElement=function(e,t,r){if(null===e||void 0===e)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+e+".");var i=v({},e.props),o=e.key,a=e.ref,s=e._owner;if(null!=t){if(void 0!==t.ref&&(a=t.ref,s=C.current),void 0!==t.key&&(o=""+t.key),e.type&&e.type.defaultProps)var u=e.type.defaultProps;for(c in t)k.call(t,c)&&!x.hasOwnProperty(c)&&(i[c]=void 0===t[c]&&void 0!==u?u[c]:t[c])}var c=arguments.length-2;if(1===c)i.children=r;else if(1<c){u=Array(c);for(var l=0;l<c;l++)u[l]=arguments[l+2];i.children=u}return{$$typeof:n,type:e.type,key:o,ref:a,props:i,_owner:s}},t.createContext=function(e){return(e={$$typeof:u,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null}).Provider={$$typeof:s,_context:e},e.Consumer=e},t.createElement=E,t.createFactory=function(e){var t=E.bind(null,e);return t.type=e,t},t.createRef=function(){return{current:null}},t.forwardRef=function(e){return{$$typeof:c,render:e}},t.isValidElement=T,t.lazy=function(e){return{$$typeof:h,_payload:{_status:-1,_result:e},_init:P}},t.memo=function(e,t){return{$$typeof:d,type:e,compare:void 0===t?null:t}},t.startTransition=function(e){var t=O.transition;O.transition={};try{e()}finally{O.transition=t}},t.unstable_act=function(){throw Error("act(...) is not supported in production builds of React.")},t.useCallback=function(e,t){return N.current.useCallback(e,t)},t.useContext=function(e){return N.current.useContext(e)},t.useDebugValue=function(){},t.useDeferredValue=function(e){return N.current.useDeferredValue(e)},t.useEffect=function(e,t){return N.current.useEffect(e,t)},t.useId=function(){return N.current.useId()},t.useImperativeHandle=function(e,t,n){return N.current.useImperativeHandle(e,t,n)},t.useInsertionEffect=function(e,t){return N.current.useInsertionEffect(e,t)},t.useLayoutEffect=function(e,t){return N.current.useLayoutEffect(e,t)},t.useMemo=function(e,t){return N.current.useMemo(e,t)},t.useReducer=function(e,t,n){return N.current.useReducer(e,t,n)},t.useRef=function(e){return N.current.useRef(e)},t.useState=function(e){return N.current.useState(e)},t.useSyncExternalStore=function(e,t,n){return N.current.useSyncExternalStore(e,t,n)},t.useTransition=function(){return N.current.useTransition()},t.version="18.2.0"},72791:function(e,t,n){"use strict";e.exports=n(59117)},80184:function(e,t,n){"use strict";e.exports=n(66374)},43841:function(e){"use strict";e.exports=function(e,t){if(t=t.split(":")[0],!(e=+e))return!1;switch(t){case"http":case"ws":return 80!==e;case"https":case"wss":return 443!==e;case"ftp":return 21!==e;case"gopher":return 70!==e;case"file":return!1}return 0!==e}},40581:function(e,t,n){"use strict";var r=n(52506),i=n(44037),o=n(42584),a=r("%TypeError%"),s=r("%WeakMap%",!0),u=r("%Map%",!0),c=i("WeakMap.prototype.get",!0),l=i("WeakMap.prototype.set",!0),d=i("WeakMap.prototype.has",!0),h=i("Map.prototype.get",!0),f=i("Map.prototype.set",!0),p=i("Map.prototype.has",!0),v=function(e,t){for(var n,r=e;null!==(n=r.next);r=n)if(n.key===t)return r.next=n.next,n.next=e.next,e.next=n,n};e.exports=function(){var e,t,n,r={assert:function(e){if(!r.has(e))throw new a("Side channel does not contain "+o(e))},get:function(r){if(s&&r&&("object"===typeof r||"function"===typeof r)){if(e)return c(e,r)}else if(u){if(t)return h(t,r)}else if(n)return function(e,t){var n=v(e,t);return n&&n.value}(n,r)},has:function(r){if(s&&r&&("object"===typeof r||"function"===typeof r)){if(e)return d(e,r)}else if(u){if(t)return p(t,r)}else if(n)return function(e,t){return!!v(e,t)}(n,r);return!1},set:function(r,i){s&&r&&("object"===typeof r||"function"===typeof r)?(e||(e=new s),l(e,r,i)):u?(t||(t=new u),f(t,r,i)):(n||(n={key:{},next:null}),function(e,t,n){var r=v(e,t);r?r.value=n:e.next={key:t,next:e.next,value:n}}(n,r,i))}};return r}},21552:function(e){var t=["Black","White","Gray","Brown","Red","Pink","Crimson","Carnelian","Orange","Yellow","Ivory","Cream","Green","Viridian","Aquamarine","Cyan","Blue","Cerulean","Azure","Indigo","Navy","Violet","Purple","Lavender","Magenta","Rainbow","Iridescent","Spectrum","Prism","Bold","Vivid","Pale","Clear","Glass","Translucent","Misty","Dark","Light","Gold","Silver","Copper","Bronze","Steel","Iron","Brass","Mercury","Zinc","Chrome","Platinum","Titanium","Nickel","Lead","Pewter","Rust","Metal","Stone","Quartz","Granite","Marble","Alabaster","Agate","Jasper","Pebble","Pyrite","Crystal","Geode","Obsidian","Mica","Flint","Sand","Gravel","Boulder","Basalt","Ruby","Beryl","Scarlet","Citrine","Sulpher","Topaz","Amber","Emerald","Malachite","Jade","Abalone","Lapis","Sapphire","Diamond","Peridot","Gem","Jewel","Bevel","Coral","Jet","Ebony","Wood","Tree","Cherry","Maple","Cedar","Branch","Bramble","Rowan","Ash","Fir","Pine","Cactus","Alder","Grove","Forest","Jungle","Palm","Bush","Mulberry","Juniper","Vine","Ivy","Rose","Lily","Tulip","Daffodil","Honeysuckle","Fuschia","Hazel","Walnut","Almond","Lime","Lemon","Apple","Blossom","Bloom","Crocus","Rose","Buttercup","Dandelion","Iris","Carnation","Fern","Root","Branch","Leaf","Seed","Flower","Petal","Pollen","Orchid","Mangrove","Cypress","Sequoia","Sage","Heather","Snapdragon","Daisy","Mountain","Hill","Alpine","Chestnut","Valley","Glacier","Forest","Grove","Glen","Tree","Thorn","Stump","Desert","Canyon","Dune","Oasis","Mirage","Well","Spring","Meadow","Field","Prairie","Grass","Tundra","Island","Shore","Sand","Shell","Surf","Wave","Foam","Tide","Lake","River","Brook","Stream","Pool","Pond","Sun","Sprinkle","Shade","Shadow","Rain","Cloud","Storm","Hail","Snow","Sleet","Thunder","Lightning","Wind","Hurricane","Typhoon","Dawn","Sunrise","Morning","Noon","Twilight","Evening","Sunset","Midnight","Night","Sky","Star","Stellar","Comet","Nebula","Quasar","Solar","Lunar","Planet","Meteor","Sprout","Pear","Plum","Kiwi","Berry","Apricot","Peach","Mango","Pineapple","Coconut","Olive","Ginger","Root","Plain","Fancy","Stripe","Spot","Speckle","Spangle","Ring","Band","Blaze","Paint","Pinto","Shade","Tabby","Brindle","Patch","Calico","Checker","Dot","Pattern","Glitter","Glimmer","Shimmer","Dull","Dust","Dirt","Glaze","Scratch","Quick","Swift","Fast","Slow","Clever","Fire","Flicker","Flash","Spark","Ember","Coal","Flame","Chocolate","Vanilla","Sugar","Spice","Cake","Pie","Cookie","Candy","Caramel","Spiral","Round","Jelly","Square","Narrow","Long","Short","Small","Tiny","Big","Giant","Great","Atom","Peppermint","Mint","Butter","Fringe","Rag","Quilt","Truth","Lie","Holy","Curse","Noble","Sly","Brave","Shy","Lava","Foul","Leather","Fantasy","Keen","Luminous","Feather","Sticky","Gossamer","Cotton","Rattle","Silk","Satin","Cord","Denim","Flannel","Plaid","Wool","Linen","Silent","Flax","Weak","Valiant","Fierce","Gentle","Rhinestone","Splash","North","South","East","West","Summer","Winter","Autumn","Spring","Season","Equinox","Solstice","Paper","Motley","Torch","Ballistic","Rampant","Shag","Freckle","Wild","Free","Chain","Sheer","Crazy","Mad","Candle","Ribbon","Lace","Notch","Wax","Shine","Shallow","Deep","Bubble","Harvest","Fluff","Venom","Boom","Slash","Rune","Cold","Quill","Love","Hate","Garnet","Zircon","Power","Bone","Void","Horn","Glory","Cyber","Nova","Hot","Helix","Cosmic","Quark","Quiver","Holly","Clover","Polar","Regal","Ripple","Ebony","Wheat","Phantom","Dew","Chisel","Crack","Chatter","Laser","Foil","Tin","Clever","Treasure","Maze","Twisty","Curly","Fortune","Fate","Destiny","Cute","Slime","Ink","Disco","Plume","Time","Psychadelic","Relic","Fossil","Water","Savage","Ancient","Rapid","Road","Trail","Stitch","Button","Bow","Nimble","Zest","Sour","Bitter","Phase","Fan","Frill","Plump","Pickle","Mud","Puddle","Pond","River","Spring","Stream","Battle","Arrow","Plume","Roan","Pitch","Tar","Cat","Dog","Horse","Lizard","Bird","Fish","Saber","Scythe","Sharp","Soft","Razor","Neon","Dandy","Weed","Swamp","Marsh","Bog","Peat","Moor","Muck","Mire","Grave","Fair","Just","Brick","Puzzle","Skitter","Prong","Fork","Dent","Dour","Warp","Luck","Coffee","Split","Chip","Hollow","Heavy","Legend","Hickory","Mesquite","Nettle","Rogue","Charm","Prickle","Bead","Sponge","Whip","Bald","Frost","Fog","Oil","Veil","Cliff","Volcano","Rift","Maze","Proud","Dew","Mirror","Shard","Salt","Pepper","Honey","Thread","Bristle","Ripple","Glow","Zenith"],n=["head","crest","crown","tooth","fang","horn","frill","skull","bone","tongue","throat","voice","nose","snout","chin","eye","sight","seer","speaker","singer","song","chanter","howler","chatter","shrieker","shriek","jaw","bite","biter","neck","shoulder","fin","wing","arm","lifter","grasp","grabber","hand","paw","foot","finger","toe","thumb","talon","palm","touch","racer","runner","hoof","fly","flier","swoop","roar","hiss","hisser","snarl","dive","diver","rib","chest","back","ridge","leg","legs","tail","beak","walker","lasher","swisher","carver","kicker","roarer","crusher","spike","shaker","charger","hunter","weaver","crafter","binder","scribe","muse","snap","snapper","slayer","stalker","track","tracker","scar","scarer","fright","killer","death","doom","healer","saver","friend","foe","guardian","thunder","lightning","cloud","storm","forger","scale","hair","braid","nape","belly","thief","stealer","reaper","giver","taker","dancer","player","gambler","twister","turner","painter","dart","drifter","sting","stinger","venom","spur","ripper","swallow","devourer","knight","lady","lord","queen","king","master","mistress","prince","princess","duke","dutchess","samurai","ninja","knave","slave","servant","sage","wizard","witch","warlock","warrior","jester","paladin","bard","trader","sword","shield","knife","dagger","arrow","bow","fighter","bane","follower","leader","scourge","watcher","cat","panther","tiger","cougar","puma","jaguar","ocelot","lynx","lion","leopard","ferret","weasel","wolverine","bear","raccoon","dog","wolf","kitten","puppy","cub","fox","hound","terrier","coyote","hyena","jackal","pig","horse","donkey","stallion","mare","zebra","antelope","gazelle","deer","buffalo","bison","boar","elk","whale","dolphin","shark","fish","minnow","salmon","ray","fisher","otter","gull","duck","goose","crow","raven","bird","eagle","raptor","hawk","falcon","moose","heron","owl","stork","crane","sparrow","robin","parrot","cockatoo","carp","lizard","gecko","iguana","snake","python","viper","boa","condor","vulture","spider","fly","scorpion","heron","oriole","toucan","bee","wasp","hornet","rabbit","bunny","hare","brow","mustang","ox","piper","soarer","flasher","moth","mask","hide","hero","antler","chill","chiller","gem","ogre","myth","elf","fairy","pixie","dragon","griffin","unicorn","pegasus","sprite","fancier","chopper","slicer","skinner","butterfly","legend","wanderer","rover","raver","loon","lancer","glass","glazer","flame","crystal","lantern","lighter","cloak","bell","ringer","keeper","centaur","bolt","catcher","whimsey","quester","rat","mouse","serpent","wyrm","gargoyle","thorn","whip","rider","spirit","sentry","bat","beetle","burn","cowl","stone","gem","collar","mark","grin","scowl","spear","razor","edge","seeker","jay","ape","monkey","gorilla","koala","kangaroo","yak","sloth","ant","roach","weed","seed","eater","razor","shirt","face","goat","mind","shift","rider","face","mole","vole","pirate","llama","stag","bug","cap","boot","drop","hugger","sargent","snagglefoot","carpet","curtain"];function r(e){return e=e||Math.random,n[Math.floor(e()*n.length)]}function i(e){return e=e||Math.random,t[Math.floor(e()*t.length)]}e.exports=function(e){var t=r(e),n=r(e);return n=n.substr(0,1).toUpperCase()+n.substr(1),i(e)+t+" "+n},e.exports.randomNoun=r,e.exports.randomAdjective=i},65915:function(e,t,n){"use strict";var r=n(43841),i=n(96962),o=/^[\x00-\x20\u00a0\u1680\u2000-\u200a\u2028\u2029\u202f\u205f\u3000\ufeff]+/,a=/[\n\r\t]/g,s=/^[A-Za-z][A-Za-z0-9+-.]*:\/\//,u=/:\d+$/,c=/^([a-z][a-z0-9.+-]*:)?(\/\/)?([\\/]+)?([\S\s]*)/i,l=/^[a-zA-Z]:/;function d(e){return(e||"").toString().replace(o,"")}var h=[["#","hash"],["?","query"],function(e,t){return v(t.protocol)?e.replace(/\\/g,"/"):e},["/","pathname"],["@","auth",1],[NaN,"host",void 0,1,1],[/:(\d*)$/,"port",void 0,1],[NaN,"hostname",void 0,1,1]],f={hash:1,query:1};function p(e){var t,r=("undefined"!==typeof window?window:"undefined"!==typeof n.g?n.g:"undefined"!==typeof self?self:{}).location||{},i={},o=typeof(e=e||r);if("blob:"===e.protocol)i=new m(unescape(e.pathname),{});else if("string"===o)for(t in i=new m(e,{}),f)delete i[t];else if("object"===o){for(t in e)t in f||(i[t]=e[t]);void 0===i.slashes&&(i.slashes=s.test(e.href))}return i}function v(e){return"file:"===e||"ftp:"===e||"http:"===e||"https:"===e||"ws:"===e||"wss:"===e}function g(e,t){e=(e=d(e)).replace(a,""),t=t||{};var n,r=c.exec(e),i=r[1]?r[1].toLowerCase():"",o=!!r[2],s=!!r[3],u=0;return o?s?(n=r[2]+r[3]+r[4],u=r[2].length+r[3].length):(n=r[2]+r[4],u=r[2].length):s?(n=r[3]+r[4],u=r[3].length):n=r[4],"file:"===i?u>=2&&(n=n.slice(2)):v(i)?n=r[4]:i?o&&(n=n.slice(2)):u>=2&&v(t.protocol)&&(n=r[4]),{protocol:i,slashes:o||v(i),slashesCount:u,rest:n}}function m(e,t,n){if(e=(e=d(e)).replace(a,""),!(this instanceof m))return new m(e,t,n);var o,s,u,c,f,y,b=h.slice(),w=typeof t,S=this,k=0;for("object"!==w&&"string"!==w&&(n=t,t=null),n&&"function"!==typeof n&&(n=i.parse),o=!(s=g(e||"",t=p(t))).protocol&&!s.slashes,S.slashes=s.slashes||o&&t.slashes,S.protocol=s.protocol||t.protocol||"",e=s.rest,("file:"===s.protocol&&(2!==s.slashesCount||l.test(e))||!s.slashes&&(s.protocol||s.slashesCount<2||!v(S.protocol)))&&(b[3]=[/(.*)/,"pathname"]);k<b.length;k++)"function"!==typeof(c=b[k])?(u=c[0],y=c[1],u!==u?S[y]=e:"string"===typeof u?~(f="@"===u?e.lastIndexOf(u):e.indexOf(u))&&("number"===typeof c[2]?(S[y]=e.slice(0,f),e=e.slice(f+c[2])):(S[y]=e.slice(f),e=e.slice(0,f))):(f=u.exec(e))&&(S[y]=f[1],e=e.slice(0,f.index)),S[y]=S[y]||o&&c[3]&&t[y]||"",c[4]&&(S[y]=S[y].toLowerCase())):e=c(e,S);n&&(S.query=n(S.query)),o&&t.slashes&&"/"!==S.pathname.charAt(0)&&(""!==S.pathname||""!==t.pathname)&&(S.pathname=function(e,t){if(""===e)return t;for(var n=(t||"/").split("/").slice(0,-1).concat(e.split("/")),r=n.length,i=n[r-1],o=!1,a=0;r--;)"."===n[r]?n.splice(r,1):".."===n[r]?(n.splice(r,1),a++):a&&(0===r&&(o=!0),n.splice(r,1),a--);return o&&n.unshift(""),"."!==i&&".."!==i||n.push(""),n.join("/")}(S.pathname,t.pathname)),"/"!==S.pathname.charAt(0)&&v(S.protocol)&&(S.pathname="/"+S.pathname),r(S.port,S.protocol)||(S.host=S.hostname,S.port=""),S.username=S.password="",S.auth&&(~(f=S.auth.indexOf(":"))?(S.username=S.auth.slice(0,f),S.username=encodeURIComponent(decodeURIComponent(S.username)),S.password=S.auth.slice(f+1),S.password=encodeURIComponent(decodeURIComponent(S.password))):S.username=encodeURIComponent(decodeURIComponent(S.auth)),S.auth=S.password?S.username+":"+S.password:S.username),S.origin="file:"!==S.protocol&&v(S.protocol)&&S.host?S.protocol+"//"+S.host:"null",S.href=S.toString()}m.prototype={set:function(e,t,n){var o=this;switch(e){case"query":"string"===typeof t&&t.length&&(t=(n||i.parse)(t)),o[e]=t;break;case"port":o[e]=t,r(t,o.protocol)?t&&(o.host=o.hostname+":"+t):(o.host=o.hostname,o[e]="");break;case"hostname":o[e]=t,o.port&&(t+=":"+o.port),o.host=t;break;case"host":o[e]=t,u.test(t)?(t=t.split(":"),o.port=t.pop(),o.hostname=t.join(":")):(o.hostname=t,o.port="");break;case"protocol":o.protocol=t.toLowerCase(),o.slashes=!n;break;case"pathname":case"hash":if(t){var a="pathname"===e?"/":"#";o[e]=t.charAt(0)!==a?a+t:t}else o[e]=t;break;case"username":case"password":o[e]=encodeURIComponent(t);break;case"auth":var s=t.indexOf(":");~s?(o.username=t.slice(0,s),o.username=encodeURIComponent(decodeURIComponent(o.username)),o.password=t.slice(s+1),o.password=encodeURIComponent(decodeURIComponent(o.password))):o.username=encodeURIComponent(decodeURIComponent(t))}for(var c=0;c<h.length;c++){var l=h[c];l[4]&&(o[l[1]]=o[l[1]].toLowerCase())}return o.auth=o.password?o.username+":"+o.password:o.username,o.origin="file:"!==o.protocol&&v(o.protocol)&&o.host?o.protocol+"//"+o.host:"null",o.href=o.toString(),o},toString:function(e){e&&"function"===typeof e||(e=i.stringify);var t,n=this,r=n.host,o=n.protocol;o&&":"!==o.charAt(o.length-1)&&(o+=":");var a=o+(n.protocol&&n.slashes||v(n.protocol)?"//":"");return n.username?(a+=n.username,n.password&&(a+=":"+n.password),a+="@"):n.password?(a+=":"+n.password,a+="@"):"file:"!==n.protocol&&v(n.protocol)&&!r&&"/"!==n.pathname&&(a+="@"),(":"===r[r.length-1]||u.test(n.hostname)&&!n.port)&&(r+=":"),a+=r+n.pathname,(t="object"===typeof n.query?e(n.query):n.query)&&(a+="?"!==t.charAt(0)?"?"+t:t),n.hash&&(a+=n.hash),a}},m.extractProtocol=g,m.location=p,m.trimLeft=d,m.qs=i,e.exports=m},36369:function(e,t,n){var r;e=n.nmd(e),function(i){t&&t.nodeType,e&&e.nodeType;var o="object"==typeof n.g&&n.g;o.global!==o&&o.window!==o&&o.self;var a,s=2147483647,u=36,c=1,l=26,d=38,h=700,f=72,p=128,v="-",g=/^xn--/,m=/[^\x20-\x7E]/,y=/[\x2E\u3002\uFF0E\uFF61]/g,b={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},w=u-c,S=Math.floor,k=String.fromCharCode;function C(e){throw new RangeError(b[e])}function x(e,t){for(var n=e.length,r=[];n--;)r[n]=t(e[n]);return r}function E(e,t){var n=e.split("@"),r="";return n.length>1&&(r=n[0]+"@",e=n[1]),r+x((e=e.replace(y,".")).split("."),t).join(".")}function T(e){for(var t,n,r=[],i=0,o=e.length;i<o;)(t=e.charCodeAt(i++))>=55296&&t<=56319&&i<o?56320==(64512&(n=e.charCodeAt(i++)))?r.push(((1023&t)<<10)+(1023&n)+65536):(r.push(t),i--):r.push(t);return r}function I(e){return x(e,(function(e){var t="";return e>65535&&(t+=k((e-=65536)>>>10&1023|55296),e=56320|1023&e),t+=k(e)})).join("")}function A(e,t){return e+22+75*(e<26)-((0!=t)<<5)}function R(e,t,n){var r=0;for(e=n?S(e/h):e>>1,e+=S(e/t);e>w*l>>1;r+=u)e=S(e/w);return S(r+(w+1)*e/(e+d))}function _(e){var t,n,r,i,o,a,d,h,g,m,y,b=[],w=e.length,k=0,x=p,E=f;for((n=e.lastIndexOf(v))<0&&(n=0),r=0;r<n;++r)e.charCodeAt(r)>=128&&C("not-basic"),b.push(e.charCodeAt(r));for(i=n>0?n+1:0;i<w;){for(o=k,a=1,d=u;i>=w&&C("invalid-input"),((h=(y=e.charCodeAt(i++))-48<10?y-22:y-65<26?y-65:y-97<26?y-97:u)>=u||h>S((s-k)/a))&&C("overflow"),k+=h*a,!(h<(g=d<=E?c:d>=E+l?l:d-E));d+=u)a>S(s/(m=u-g))&&C("overflow"),a*=m;E=R(k-o,t=b.length+1,0==o),S(k/t)>s-x&&C("overflow"),x+=S(k/t),k%=t,b.splice(k++,0,x)}return I(b)}function P(e){var t,n,r,i,o,a,d,h,g,m,y,b,w,x,E,I=[];for(b=(e=T(e)).length,t=p,n=0,o=f,a=0;a<b;++a)(y=e[a])<128&&I.push(k(y));for(r=i=I.length,i&&I.push(v);r<b;){for(d=s,a=0;a<b;++a)(y=e[a])>=t&&y<d&&(d=y);for(d-t>S((s-n)/(w=r+1))&&C("overflow"),n+=(d-t)*w,t=d,a=0;a<b;++a)if((y=e[a])<t&&++n>s&&C("overflow"),y==t){for(h=n,g=u;!(h<(m=g<=o?c:g>=o+l?l:g-o));g+=u)E=h-m,x=u-m,I.push(k(A(m+E%x,0))),h=S(E/x);I.push(k(A(h,0))),o=R(n,w,r==i),n=0,++r}++n,++t}return I.join("")}a={version:"1.4.1",ucs2:{decode:T,encode:I},decode:_,encode:P,toASCII:function(e){return E(e,(function(e){return m.test(e)?"xn--"+P(e):e}))},toUnicode:function(e){return E(e,(function(e){return g.test(e)?_(e.slice(4).toLowerCase()):e}))}},void 0===(r=function(){return a}.call(t,n,t,e))||(e.exports=r)}()},12114:function(e,t,n){"use strict";var r=n(36369);function i(){this.protocol=null,this.slashes=null,this.auth=null,this.host=null,this.port=null,this.hostname=null,this.hash=null,this.search=null,this.query=null,this.pathname=null,this.path=null,this.href=null}var o=/^([a-z0-9.+-]+:)/i,a=/:[0-9]*$/,s=/^(\/\/?(?!\/)[^?\s]*)(\?[^\s]*)?$/,u=["{","}","|","\\","^","`"].concat(["<",">",'"',"`"," ","\r","\n","\t"]),c=["'"].concat(u),l=["%","/","?",";","#"].concat(c),d=["/","?","#"],h=/^[+a-z0-9A-Z_-]{0,63}$/,f=/^([+a-z0-9A-Z_-]{0,63})(.*)$/,p={javascript:!0,"javascript:":!0},v={javascript:!0,"javascript:":!0},g={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,"http:":!0,"https:":!0,"ftp:":!0,"gopher:":!0,"file:":!0},m=n(32808);function y(e,t,n){if(e&&"object"===typeof e&&e instanceof i)return e;var r=new i;return r.parse(e,t,n),r}i.prototype.parse=function(e,t,n){if("string"!==typeof e)throw new TypeError("Parameter 'url' must be a string, not "+typeof e);var i=e.indexOf("?"),a=-1!==i&&i<e.indexOf("#")?"?":"#",u=e.split(a);u[0]=u[0].replace(/\\/g,"/");var y=e=u.join(a);if(y=y.trim(),!n&&1===e.split("#").length){var b=s.exec(y);if(b)return this.path=y,this.href=y,this.pathname=b[1],b[2]?(this.search=b[2],this.query=t?m.parse(this.search.substr(1)):this.search.substr(1)):t&&(this.search="",this.query={}),this}var w=o.exec(y);if(w){var S=(w=w[0]).toLowerCase();this.protocol=S,y=y.substr(w.length)}if(n||w||y.match(/^\/\/[^@/]+@[^@/]+/)){var k="//"===y.substr(0,2);!k||w&&v[w]||(y=y.substr(2),this.slashes=!0)}if(!v[w]&&(k||w&&!g[w])){for(var C,x,E=-1,T=0;T<d.length;T++){-1!==(I=y.indexOf(d[T]))&&(-1===E||I<E)&&(E=I)}-1!==(x=-1===E?y.lastIndexOf("@"):y.lastIndexOf("@",E))&&(C=y.slice(0,x),y=y.slice(x+1),this.auth=decodeURIComponent(C)),E=-1;for(T=0;T<l.length;T++){var I;-1!==(I=y.indexOf(l[T]))&&(-1===E||I<E)&&(E=I)}-1===E&&(E=y.length),this.host=y.slice(0,E),y=y.slice(E),this.parseHost(),this.hostname=this.hostname||"";var A="["===this.hostname[0]&&"]"===this.hostname[this.hostname.length-1];if(!A)for(var R=this.hostname.split(/\./),_=(T=0,R.length);T<_;T++){var P=R[T];if(P&&!P.match(h)){for(var N="",O=0,M=P.length;O<M;O++)P.charCodeAt(O)>127?N+="x":N+=P[O];if(!N.match(h)){var F=R.slice(0,T),Z=R.slice(T+1),D=P.match(f);D&&(F.push(D[1]),Z.unshift(D[2])),Z.length&&(y="/"+Z.join(".")+y),this.hostname=F.join(".");break}}}this.hostname.length>255?this.hostname="":this.hostname=this.hostname.toLowerCase(),A||(this.hostname=r.toASCII(this.hostname));var L=this.port?":"+this.port:"",B=this.hostname||"";this.host=B+L,this.href+=this.host,A&&(this.hostname=this.hostname.substr(1,this.hostname.length-2),"/"!==y[0]&&(y="/"+y))}if(!p[S])for(T=0,_=c.length;T<_;T++){var q=c[T];if(-1!==y.indexOf(q)){var j=encodeURIComponent(q);j===q&&(j=escape(q)),y=y.split(q).join(j)}}var U=y.indexOf("#");-1!==U&&(this.hash=y.substr(U),y=y.slice(0,U));var H=y.indexOf("?");if(-1!==H?(this.search=y.substr(H),this.query=y.substr(H+1),t&&(this.query=m.parse(this.query)),y=y.slice(0,H)):t&&(this.search="",this.query={}),y&&(this.pathname=y),g[S]&&this.hostname&&!this.pathname&&(this.pathname="/"),this.pathname||this.search){L=this.pathname||"";var z=this.search||"";this.path=L+z}return this.href=this.format(),this},i.prototype.format=function(){var e=this.auth||"";e&&(e=(e=encodeURIComponent(e)).replace(/%3A/i,":"),e+="@");var t=this.protocol||"",n=this.pathname||"",r=this.hash||"",i=!1,o="";this.host?i=e+this.host:this.hostname&&(i=e+(-1===this.hostname.indexOf(":")?this.hostname:"["+this.hostname+"]"),this.port&&(i+=":"+this.port)),this.query&&"object"===typeof this.query&&Object.keys(this.query).length&&(o=m.stringify(this.query));var a=this.search||o&&"?"+o||"";return t&&":"!==t.substr(-1)&&(t+=":"),this.slashes||(!t||g[t])&&!1!==i?(i="//"+(i||""),n&&"/"!==n.charAt(0)&&(n="/"+n)):i||(i=""),r&&"#"!==r.charAt(0)&&(r="#"+r),a&&"?"!==a.charAt(0)&&(a="?"+a),t+i+(n=n.replace(/[?#]/g,(function(e){return encodeURIComponent(e)})))+(a=a.replace("#","%23"))+r},i.prototype.resolve=function(e){return this.resolveObject(y(e,!1,!0)).format()},i.prototype.resolveObject=function(e){if("string"===typeof e){var t=new i;t.parse(e,!1,!0),e=t}for(var n=new i,r=Object.keys(this),o=0;o<r.length;o++){var a=r[o];n[a]=this[a]}if(n.hash=e.hash,""===e.href)return n.href=n.format(),n;if(e.slashes&&!e.protocol){for(var s=Object.keys(e),u=0;u<s.length;u++){var c=s[u];"protocol"!==c&&(n[c]=e[c])}return g[n.protocol]&&n.hostname&&!n.pathname&&(n.pathname="/",n.path=n.pathname),n.href=n.format(),n}if(e.protocol&&e.protocol!==n.protocol){if(!g[e.protocol]){for(var l=Object.keys(e),d=0;d<l.length;d++){var h=l[d];n[h]=e[h]}return n.href=n.format(),n}if(n.protocol=e.protocol,e.host||v[e.protocol])n.pathname=e.pathname;else{for(var f=(e.pathname||"").split("/");f.length&&!(e.host=f.shift()););e.host||(e.host=""),e.hostname||(e.hostname=""),""!==f[0]&&f.unshift(""),f.length<2&&f.unshift(""),n.pathname=f.join("/")}if(n.search=e.search,n.query=e.query,n.host=e.host||"",n.auth=e.auth,n.hostname=e.hostname||e.host,n.port=e.port,n.pathname||n.search){var p=n.pathname||"",m=n.search||"";n.path=p+m}return n.slashes=n.slashes||e.slashes,n.href=n.format(),n}var y=n.pathname&&"/"===n.pathname.charAt(0),b=e.host||e.pathname&&"/"===e.pathname.charAt(0),w=b||y||n.host&&e.pathname,S=w,k=n.pathname&&n.pathname.split("/")||[],C=(f=e.pathname&&e.pathname.split("/")||[],n.protocol&&!g[n.protocol]);if(C&&(n.hostname="",n.port=null,n.host&&(""===k[0]?k[0]=n.host:k.unshift(n.host)),n.host="",e.protocol&&(e.hostname=null,e.port=null,e.host&&(""===f[0]?f[0]=e.host:f.unshift(e.host)),e.host=null),w=w&&(""===f[0]||""===k[0])),b)n.host=e.host||""===e.host?e.host:n.host,n.hostname=e.hostname||""===e.hostname?e.hostname:n.hostname,n.search=e.search,n.query=e.query,k=f;else if(f.length)k||(k=[]),k.pop(),k=k.concat(f),n.search=e.search,n.query=e.query;else if(null!=e.search){if(C)n.host=k.shift(),n.hostname=n.host,(A=!!(n.host&&n.host.indexOf("@")>0)&&n.host.split("@"))&&(n.auth=A.shift(),n.hostname=A.shift(),n.host=n.hostname);return n.search=e.search,n.query=e.query,null===n.pathname&&null===n.search||(n.path=(n.pathname?n.pathname:"")+(n.search?n.search:"")),n.href=n.format(),n}if(!k.length)return n.pathname=null,n.search?n.path="/"+n.search:n.path=null,n.href=n.format(),n;for(var x=k.slice(-1)[0],E=(n.host||e.host||k.length>1)&&("."===x||".."===x)||""===x,T=0,I=k.length;I>=0;I--)"."===(x=k[I])?k.splice(I,1):".."===x?(k.splice(I,1),T++):T&&(k.splice(I,1),T--);if(!w&&!S)for(;T--;T)k.unshift("..");!w||""===k[0]||k[0]&&"/"===k[0].charAt(0)||k.unshift(""),E&&"/"!==k.join("/").substr(-1)&&k.push("");var A,R=""===k[0]||k[0]&&"/"===k[0].charAt(0);C&&(n.hostname=R?"":k.length?k.shift():"",n.host=n.hostname,(A=!!(n.host&&n.host.indexOf("@")>0)&&n.host.split("@"))&&(n.auth=A.shift(),n.hostname=A.shift(),n.host=n.hostname));return(w=w||n.host&&k.length)&&!R&&k.unshift(""),k.length>0?n.pathname=k.join("/"):(n.pathname=null,n.path=null),null===n.pathname&&null===n.search||(n.path=(n.pathname?n.pathname:"")+(n.search?n.search:"")),n.auth=e.auth||n.auth,n.slashes=n.slashes||e.slashes,n.href=n.format(),n},i.prototype.parseHost=function(){var e=this.host,t=a.exec(e);t&&(":"!==(t=t[0])&&(this.port=t.substr(1)),e=e.substr(0,e.length-t.length)),e&&(this.hostname=e)},t.Qc=y},24659:function(e,t,n){"use strict";n.r(t),n.d(t,{NIL:function(){return E},parse:function(){return d},stringify:function(){return a.Z},v1:function(){return c},v3:function(){return w},v4:function(){return S.Z},v5:function(){return x},validate:function(){return l.Z},version:function(){return T}});var r,i,o=n(20457),a=n(54303),s=0,u=0;var c=function(e,t,n){var c=t&&n||0,l=t||new Array(16),d=(e=e||{}).node||r,h=void 0!==e.clockseq?e.clockseq:i;if(null==d||null==h){var f=e.random||(e.rng||o.Z)();null==d&&(d=r=[1|f[0],f[1],f[2],f[3],f[4],f[5]]),null==h&&(h=i=16383&(f[6]<<8|f[7]))}var p=void 0!==e.msecs?e.msecs:Date.now(),v=void 0!==e.nsecs?e.nsecs:u+1,g=p-s+(v-u)/1e4;if(g<0&&void 0===e.clockseq&&(h=h+1&16383),(g<0||p>s)&&void 0===e.nsecs&&(v=0),v>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");s=p,u=v,i=h;var m=(1e4*(268435455&(p+=122192928e5))+v)%4294967296;l[c++]=m>>>24&255,l[c++]=m>>>16&255,l[c++]=m>>>8&255,l[c++]=255&m;var y=p/4294967296*1e4&268435455;l[c++]=y>>>8&255,l[c++]=255&y,l[c++]=y>>>24&15|16,l[c++]=y>>>16&255,l[c++]=h>>>8|128,l[c++]=255&h;for(var b=0;b<6;++b)l[c+b]=d[b];return t||(0,a.Z)(l)},l=n(85283);var d=function(e){if(!(0,l.Z)(e))throw TypeError("Invalid UUID");var t,n=new Uint8Array(16);return n[0]=(t=parseInt(e.slice(0,8),16))>>>24,n[1]=t>>>16&255,n[2]=t>>>8&255,n[3]=255&t,n[4]=(t=parseInt(e.slice(9,13),16))>>>8,n[5]=255&t,n[6]=(t=parseInt(e.slice(14,18),16))>>>8,n[7]=255&t,n[8]=(t=parseInt(e.slice(19,23),16))>>>8,n[9]=255&t,n[10]=(t=parseInt(e.slice(24,36),16))/1099511627776&255,n[11]=t/4294967296&255,n[12]=t>>>24&255,n[13]=t>>>16&255,n[14]=t>>>8&255,n[15]=255&t,n};function h(e,t,n){function r(e,r,i,o){if("string"===typeof e&&(e=function(e){e=unescape(encodeURIComponent(e));for(var t=[],n=0;n<e.length;++n)t.push(e.charCodeAt(n));return t}(e)),"string"===typeof r&&(r=d(r)),16!==r.length)throw TypeError("Namespace must be array-like (16 iterable integer values, 0-255)");var s=new Uint8Array(16+e.length);if(s.set(r),s.set(e,r.length),(s=n(s))[6]=15&s[6]|t,s[8]=63&s[8]|128,i){o=o||0;for(var u=0;u<16;++u)i[o+u]=s[u];return i}return(0,a.Z)(s)}try{r.name=e}catch(i){}return r.DNS="6ba7b810-9dad-11d1-80b4-00c04fd430c8",r.URL="6ba7b811-9dad-11d1-80b4-00c04fd430c8",r}function f(e){return 14+(e+64>>>9<<4)+1}function p(e,t){var n=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(n>>16)<<16|65535&n}function v(e,t,n,r,i,o){return p((a=p(p(t,e),p(r,o)))<<(s=i)|a>>>32-s,n);var a,s}function g(e,t,n,r,i,o,a){return v(t&n|~t&r,e,t,i,o,a)}function m(e,t,n,r,i,o,a){return v(t&r|n&~r,e,t,i,o,a)}function y(e,t,n,r,i,o,a){return v(t^n^r,e,t,i,o,a)}function b(e,t,n,r,i,o,a){return v(n^(t|~r),e,t,i,o,a)}var w=h("v3",48,(function(e){if("string"===typeof e){var t=unescape(encodeURIComponent(e));e=new Uint8Array(t.length);for(var n=0;n<t.length;++n)e[n]=t.charCodeAt(n)}return function(e){for(var t=[],n=32*e.length,r="0123456789abcdef",i=0;i<n;i+=8){var o=e[i>>5]>>>i%32&255,a=parseInt(r.charAt(o>>>4&15)+r.charAt(15&o),16);t.push(a)}return t}(function(e,t){e[t>>5]|=128<<t%32,e[f(t)-1]=t;for(var n=1732584193,r=-271733879,i=-1732584194,o=271733878,a=0;a<e.length;a+=16){var s=n,u=r,c=i,l=o;n=g(n,r,i,o,e[a],7,-680876936),o=g(o,n,r,i,e[a+1],12,-389564586),i=g(i,o,n,r,e[a+2],17,606105819),r=g(r,i,o,n,e[a+3],22,-1044525330),n=g(n,r,i,o,e[a+4],7,-176418897),o=g(o,n,r,i,e[a+5],12,1200080426),i=g(i,o,n,r,e[a+6],17,-1473231341),r=g(r,i,o,n,e[a+7],22,-45705983),n=g(n,r,i,o,e[a+8],7,1770035416),o=g(o,n,r,i,e[a+9],12,-1958414417),i=g(i,o,n,r,e[a+10],17,-42063),r=g(r,i,o,n,e[a+11],22,-1990404162),n=g(n,r,i,o,e[a+12],7,1804603682),o=g(o,n,r,i,e[a+13],12,-40341101),i=g(i,o,n,r,e[a+14],17,-1502002290),n=m(n,r=g(r,i,o,n,e[a+15],22,1236535329),i,o,e[a+1],5,-165796510),o=m(o,n,r,i,e[a+6],9,-1069501632),i=m(i,o,n,r,e[a+11],14,643717713),r=m(r,i,o,n,e[a],20,-373897302),n=m(n,r,i,o,e[a+5],5,-701558691),o=m(o,n,r,i,e[a+10],9,38016083),i=m(i,o,n,r,e[a+15],14,-660478335),r=m(r,i,o,n,e[a+4],20,-405537848),n=m(n,r,i,o,e[a+9],5,568446438),o=m(o,n,r,i,e[a+14],9,-1019803690),i=m(i,o,n,r,e[a+3],14,-187363961),r=m(r,i,o,n,e[a+8],20,1163531501),n=m(n,r,i,o,e[a+13],5,-1444681467),o=m(o,n,r,i,e[a+2],9,-51403784),i=m(i,o,n,r,e[a+7],14,1735328473),n=y(n,r=m(r,i,o,n,e[a+12],20,-1926607734),i,o,e[a+5],4,-378558),o=y(o,n,r,i,e[a+8],11,-2022574463),i=y(i,o,n,r,e[a+11],16,1839030562),r=y(r,i,o,n,e[a+14],23,-35309556),n=y(n,r,i,o,e[a+1],4,-1530992060),o=y(o,n,r,i,e[a+4],11,1272893353),i=y(i,o,n,r,e[a+7],16,-155497632),r=y(r,i,o,n,e[a+10],23,-1094730640),n=y(n,r,i,o,e[a+13],4,681279174),o=y(o,n,r,i,e[a],11,-358537222),i=y(i,o,n,r,e[a+3],16,-722521979),r=y(r,i,o,n,e[a+6],23,76029189),n=y(n,r,i,o,e[a+9],4,-640364487),o=y(o,n,r,i,e[a+12],11,-421815835),i=y(i,o,n,r,e[a+15],16,530742520),n=b(n,r=y(r,i,o,n,e[a+2],23,-995338651),i,o,e[a],6,-198630844),o=b(o,n,r,i,e[a+7],10,1126891415),i=b(i,o,n,r,e[a+14],15,-1416354905),r=b(r,i,o,n,e[a+5],21,-57434055),n=b(n,r,i,o,e[a+12],6,1700485571),o=b(o,n,r,i,e[a+3],10,-1894986606),i=b(i,o,n,r,e[a+10],15,-1051523),r=b(r,i,o,n,e[a+1],21,-2054922799),n=b(n,r,i,o,e[a+8],6,1873313359),o=b(o,n,r,i,e[a+15],10,-30611744),i=b(i,o,n,r,e[a+6],15,-1560198380),r=b(r,i,o,n,e[a+13],21,1309151649),n=b(n,r,i,o,e[a+4],6,-145523070),o=b(o,n,r,i,e[a+11],10,-1120210379),i=b(i,o,n,r,e[a+2],15,718787259),r=b(r,i,o,n,e[a+9],21,-343485551),n=p(n,s),r=p(r,u),i=p(i,c),o=p(o,l)}return[n,r,i,o]}(function(e){if(0===e.length)return[];for(var t=8*e.length,n=new Uint32Array(f(t)),r=0;r<t;r+=8)n[r>>5]|=(255&e[r/8])<<r%32;return n}(e),8*e.length))})),S=n(39575);function k(e,t,n,r){switch(e){case 0:return t&n^~t&r;case 1:case 3:return t^n^r;case 2:return t&n^t&r^n&r}}function C(e,t){return e<<t|e>>>32-t}var x=h("v5",80,(function(e){var t=[1518500249,1859775393,2400959708,3395469782],n=[1732584193,4023233417,2562383102,271733878,3285377520];if("string"===typeof e){var r=unescape(encodeURIComponent(e));e=[];for(var i=0;i<r.length;++i)e.push(r.charCodeAt(i))}else Array.isArray(e)||(e=Array.prototype.slice.call(e));e.push(128);for(var o=e.length/4+2,a=Math.ceil(o/16),s=new Array(a),u=0;u<a;++u){for(var c=new Uint32Array(16),l=0;l<16;++l)c[l]=e[64*u+4*l]<<24|e[64*u+4*l+1]<<16|e[64*u+4*l+2]<<8|e[64*u+4*l+3];s[u]=c}s[a-1][14]=8*(e.length-1)/Math.pow(2,32),s[a-1][14]=Math.floor(s[a-1][14]),s[a-1][15]=8*(e.length-1)&4294967295;for(var d=0;d<a;++d){for(var h=new Uint32Array(80),f=0;f<16;++f)h[f]=s[d][f];for(var p=16;p<80;++p)h[p]=C(h[p-3]^h[p-8]^h[p-14]^h[p-16],1);for(var v=n[0],g=n[1],m=n[2],y=n[3],b=n[4],w=0;w<80;++w){var S=Math.floor(w/20),x=C(v,5)+k(S,g,m,y)+b+t[S]+h[w]>>>0;b=y,y=m,m=C(g,30)>>>0,g=v,v=x}n[0]=n[0]+v>>>0,n[1]=n[1]+g>>>0,n[2]=n[2]+m>>>0,n[3]=n[3]+y>>>0,n[4]=n[4]+b>>>0}return[n[0]>>24&255,n[0]>>16&255,n[0]>>8&255,255&n[0],n[1]>>24&255,n[1]>>16&255,n[1]>>8&255,255&n[1],n[2]>>24&255,n[2]>>16&255,n[2]>>8&255,255&n[2],n[3]>>24&255,n[3]>>16&255,n[3]>>8&255,255&n[3],n[4]>>24&255,n[4]>>16&255,n[4]>>8&255,255&n[4]]})),E="00000000-0000-0000-0000-000000000000";var T=function(e){if(!(0,l.Z)(e))throw TypeError("Invalid UUID");return parseInt(e.substr(14,1),16)}},20457:function(e,t,n){"use strict";var r;n.d(t,{Z:function(){return o}});var i=new Uint8Array(16);function o(){if(!r&&!(r="undefined"!==typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!==typeof msCrypto&&"function"===typeof msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto)))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return r(i)}},54303:function(e,t,n){"use strict";for(var r=n(85283),i=[],o=0;o<256;++o)i.push((o+256).toString(16).substr(1));t.Z=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=(i[e[t+0]]+i[e[t+1]]+i[e[t+2]]+i[e[t+3]]+"-"+i[e[t+4]]+i[e[t+5]]+"-"+i[e[t+6]]+i[e[t+7]]+"-"+i[e[t+8]]+i[e[t+9]]+"-"+i[e[t+10]]+i[e[t+11]]+i[e[t+12]]+i[e[t+13]]+i[e[t+14]]+i[e[t+15]]).toLowerCase();if(!(0,r.Z)(n))throw TypeError("Stringified UUID is invalid");return n}},39575:function(e,t,n){"use strict";var r=n(20457),i=n(54303);t.Z=function(e,t,n){var o=(e=e||{}).random||(e.rng||r.Z)();if(o[6]=15&o[6]|64,o[8]=63&o[8]|128,t){n=n||0;for(var a=0;a<16;++a)t[n+a]=o[a];return t}return(0,i.Z)(o)}},85283:function(e,t,n){"use strict";n.d(t,{Z:function(){return i}});var r=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;var i=function(e){return"string"===typeof e&&r.test(e)}},24654:function(){},73897:function(e){e.exports=function(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r},e.exports.__esModule=!0,e.exports.default=e.exports},85372:function(e){e.exports=function(e){if(Array.isArray(e))return e},e.exports.__esModule=!0,e.exports.default=e.exports},63405:function(e,t,n){var r=n(73897);e.exports=function(e){if(Array.isArray(e))return r(e)},e.exports.__esModule=!0,e.exports.default=e.exports},66115:function(e){e.exports=function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e},e.exports.__esModule=!0,e.exports.default=e.exports},17156:function(e){function t(e,t,n,r,i,o,a){try{var s=e[o](a),u=s.value}catch(c){return void n(c)}s.done?t(u):Promise.resolve(u).then(r,i)}e.exports=function(e){return function(){var n=this,r=arguments;return new Promise((function(i,o){var a=e.apply(n,r);function s(e){t(a,i,o,s,u,"next",e)}function u(e){t(a,i,o,s,u,"throw",e)}s(void 0)}))}},e.exports.__esModule=!0,e.exports.default=e.exports},56690:function(e){e.exports=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},e.exports.__esModule=!0,e.exports.default=e.exports},3515:function(e,t,n){var r=n(6015),i=n(69617);function o(t,n,a){return i()?(e.exports=o=Reflect.construct.bind(),e.exports.__esModule=!0,e.exports.default=e.exports):(e.exports=o=function(e,t,n){var i=[null];i.push.apply(i,t);var o=new(Function.bind.apply(e,i));return n&&r(o,n.prototype),o},e.exports.__esModule=!0,e.exports.default=e.exports),o.apply(null,arguments)}e.exports=o,e.exports.__esModule=!0,e.exports.default=e.exports},89728:function(e,t,n){var r=n(64062);function i(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,r(i.key),i)}}e.exports=function(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e},e.exports.__esModule=!0,e.exports.default=e.exports},74704:function(e,t,n){var r=n(86116);e.exports=function(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=r(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var i=0,o=function(){};return{s:o,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,s=!0,u=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){u=!0,a=e},f:function(){try{s||null==n.return||n.return()}finally{if(u)throw a}}}},e.exports.__esModule=!0,e.exports.default=e.exports},26389:function(e,t,n){var r=n(73808),i=n(69617),o=n(94993);e.exports=function(e){var t=i();return function(){var n,i=r(e);if(t){var a=r(this).constructor;n=Reflect.construct(i,arguments,a)}else n=i.apply(this,arguments);return o(this,n)}},e.exports.__esModule=!0,e.exports.default=e.exports},38416:function(e,t,n){var r=n(64062);e.exports=function(e,t,n){return(t=r(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e},e.exports.__esModule=!0,e.exports.default=e.exports},41588:function(e,t,n){var r=n(1753);function i(){return"undefined"!==typeof Reflect&&Reflect.get?(e.exports=i=Reflect.get.bind(),e.exports.__esModule=!0,e.exports.default=e.exports):(e.exports=i=function(e,t,n){var i=r(e,t);if(i){var o=Object.getOwnPropertyDescriptor(i,t);return o.get?o.get.call(arguments.length<3?e:n):o.value}},e.exports.__esModule=!0,e.exports.default=e.exports),i.apply(this,arguments)}e.exports=i,e.exports.__esModule=!0,e.exports.default=e.exports},73808:function(e){function t(n){return e.exports=t=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},e.exports.__esModule=!0,e.exports.default=e.exports,t(n)}e.exports=t,e.exports.__esModule=!0,e.exports.default=e.exports},61655:function(e,t,n){var r=n(6015);e.exports=function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&r(e,t)},e.exports.__esModule=!0,e.exports.default=e.exports},46035:function(e){e.exports=function(e){return-1!==Function.toString.call(e).indexOf("[native code]")},e.exports.__esModule=!0,e.exports.default=e.exports},69617:function(e){e.exports=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}},e.exports.__esModule=!0,e.exports.default=e.exports},79498:function(e){e.exports=function(e){if("undefined"!==typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)},e.exports.__esModule=!0,e.exports.default=e.exports},68872:function(e){e.exports=function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,i,o,a,s=[],u=!0,c=!1;try{if(o=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;u=!1}else for(;!(u=(r=o.call(n)).done)&&(s.push(r.value),s.length!==t);u=!0);}catch(e){c=!0,i=e}finally{try{if(!u&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(c)throw i}}return s}},e.exports.__esModule=!0,e.exports.default=e.exports},12218:function(e){e.exports=function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")},e.exports.__esModule=!0,e.exports.default=e.exports},42281:function(e){e.exports=function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")},e.exports.__esModule=!0,e.exports.default=e.exports},94993:function(e,t,n){var r=n(18698).default,i=n(66115);e.exports=function(e,t){if(t&&("object"===r(t)||"function"===typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return i(e)},e.exports.__esModule=!0,e.exports.default=e.exports},17061:function(e,t,n){var r=n(18698).default;function i(){"use strict";e.exports=i=function(){return n},e.exports.__esModule=!0,e.exports.default=e.exports;var t,n={},o=Object.prototype,a=o.hasOwnProperty,s=Object.defineProperty||function(e,t,n){e[t]=n.value},u="function"==typeof Symbol?Symbol:{},c=u.iterator||"@@iterator",l=u.asyncIterator||"@@asyncIterator",d=u.toStringTag||"@@toStringTag";function h(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{h({},"")}catch(t){h=function(e,t,n){return e[t]=n}}function f(e,t,n,r){var i=t&&t.prototype instanceof w?t:w,o=Object.create(i.prototype),a=new O(r||[]);return s(o,"_invoke",{value:R(e,n,a)}),o}function p(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}n.wrap=f;var v="suspendedStart",g="suspendedYield",m="executing",y="completed",b={};function w(){}function S(){}function k(){}var C={};h(C,c,(function(){return this}));var x=Object.getPrototypeOf,E=x&&x(x(M([])));E&&E!==o&&a.call(E,c)&&(C=E);var T=k.prototype=w.prototype=Object.create(C);function I(e){["next","throw","return"].forEach((function(t){h(e,t,(function(e){return this._invoke(t,e)}))}))}function A(e,t){function n(i,o,s,u){var c=p(e[i],e,o);if("throw"!==c.type){var l=c.arg,d=l.value;return d&&"object"==r(d)&&a.call(d,"__await")?t.resolve(d.__await).then((function(e){n("next",e,s,u)}),(function(e){n("throw",e,s,u)})):t.resolve(d).then((function(e){l.value=e,s(l)}),(function(e){return n("throw",e,s,u)}))}u(c.arg)}var i;s(this,"_invoke",{value:function(e,r){function o(){return new t((function(t,i){n(e,r,t,i)}))}return i=i?i.then(o,o):o()}})}function R(e,n,r){var i=v;return function(o,a){if(i===m)throw new Error("Generator is already running");if(i===y){if("throw"===o)throw a;return{value:t,done:!0}}for(r.method=o,r.arg=a;;){var s=r.delegate;if(s){var u=_(s,r);if(u){if(u===b)continue;return u}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if(i===v)throw i=y,r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);i=m;var c=p(e,n,r);if("normal"===c.type){if(i=r.done?y:g,c.arg===b)continue;return{value:c.arg,done:r.done}}"throw"===c.type&&(i=y,r.method="throw",r.arg=c.arg)}}}function _(e,n){var r=n.method,i=e.iterator[r];if(i===t)return n.delegate=null,"throw"===r&&e.iterator.return&&(n.method="return",n.arg=t,_(e,n),"throw"===n.method)||"return"!==r&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+r+"' method")),b;var o=p(i,e.iterator,n.arg);if("throw"===o.type)return n.method="throw",n.arg=o.arg,n.delegate=null,b;var a=o.arg;return a?a.done?(n[e.resultName]=a.value,n.next=e.nextLoc,"return"!==n.method&&(n.method="next",n.arg=t),n.delegate=null,b):a:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,b)}function P(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function N(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function O(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(P,this),this.reset(!0)}function M(e){if(e||""===e){var n=e[c];if(n)return n.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var i=-1,o=function n(){for(;++i<e.length;)if(a.call(e,i))return n.value=e[i],n.done=!1,n;return n.value=t,n.done=!0,n};return o.next=o}}throw new TypeError(r(e)+" is not iterable")}return S.prototype=k,s(T,"constructor",{value:k,configurable:!0}),s(k,"constructor",{value:S,configurable:!0}),S.displayName=h(k,d,"GeneratorFunction"),n.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===S||"GeneratorFunction"===(t.displayName||t.name))},n.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,k):(e.__proto__=k,h(e,d,"GeneratorFunction")),e.prototype=Object.create(T),e},n.awrap=function(e){return{__await:e}},I(A.prototype),h(A.prototype,l,(function(){return this})),n.AsyncIterator=A,n.async=function(e,t,r,i,o){void 0===o&&(o=Promise);var a=new A(f(e,t,r,i),o);return n.isGeneratorFunction(t)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},I(T),h(T,d,"Generator"),h(T,c,(function(){return this})),h(T,"toString",(function(){return"[object Generator]"})),n.keys=function(e){var t=Object(e),n=[];for(var r in t)n.push(r);return n.reverse(),function e(){for(;n.length;){var r=n.pop();if(r in t)return e.value=r,e.done=!1,e}return e.done=!0,e}},n.values=M,O.prototype={constructor:O,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(N),!e)for(var n in this)"t"===n.charAt(0)&&a.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=t)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var n=this;function r(r,i){return s.type="throw",s.arg=e,n.next=r,i&&(n.method="next",n.arg=t),!!i}for(var i=this.tryEntries.length-1;i>=0;--i){var o=this.tryEntries[i],s=o.completion;if("root"===o.tryLoc)return r("end");if(o.tryLoc<=this.prev){var u=a.call(o,"catchLoc"),c=a.call(o,"finallyLoc");if(u&&c){if(this.prev<o.catchLoc)return r(o.catchLoc,!0);if(this.prev<o.finallyLoc)return r(o.finallyLoc)}else if(u){if(this.prev<o.catchLoc)return r(o.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return r(o.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var r=this.tryEntries[n];if(r.tryLoc<=this.prev&&a.call(r,"finallyLoc")&&this.prev<r.finallyLoc){var i=r;break}}i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc&&(i=null);var o=i?i.completion:{};return o.type=e,o.arg=t,i?(this.method="next",this.next=i.finallyLoc,b):this.complete(o)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),b},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),N(n),b}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var i=r.arg;N(n)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(e,n,r){return this.delegate={iterator:M(e),resultName:n,nextLoc:r},"next"===this.method&&(this.arg=t),b}},n}e.exports=i,e.exports.__esModule=!0,e.exports.default=e.exports},6015:function(e){function t(n,r){return e.exports=t=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},e.exports.__esModule=!0,e.exports.default=e.exports,t(n,r)}e.exports=t,e.exports.__esModule=!0,e.exports.default=e.exports},27424:function(e,t,n){var r=n(85372),i=n(68872),o=n(86116),a=n(12218);e.exports=function(e,t){return r(e)||i(e,t)||o(e,t)||a()},e.exports.__esModule=!0,e.exports.default=e.exports},1753:function(e,t,n){var r=n(73808);e.exports=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=r(e)););return e},e.exports.__esModule=!0,e.exports.default=e.exports},861:function(e,t,n){var r=n(63405),i=n(79498),o=n(86116),a=n(42281);e.exports=function(e){return r(e)||i(e)||o(e)||a()},e.exports.__esModule=!0,e.exports.default=e.exports},95036:function(e,t,n){var r=n(18698).default;e.exports=function(e,t){if("object"!==r(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var i=n.call(e,t||"default");if("object"!==r(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)},e.exports.__esModule=!0,e.exports.default=e.exports},64062:function(e,t,n){var r=n(18698).default,i=n(95036);e.exports=function(e){var t=i(e,"string");return"symbol"===r(t)?t:String(t)},e.exports.__esModule=!0,e.exports.default=e.exports},18698:function(e){function t(n){return e.exports=t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e.exports.__esModule=!0,e.exports.default=e.exports,t(n)}e.exports=t,e.exports.__esModule=!0,e.exports.default=e.exports},86116:function(e,t,n){var r=n(73897);e.exports=function(e,t){if(e){if("string"===typeof e)return r(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?r(e,t):void 0}},e.exports.__esModule=!0,e.exports.default=e.exports},33496:function(e,t,n){var r=n(73808),i=n(6015),o=n(46035),a=n(3515);function s(t){var n="function"===typeof Map?new Map:void 0;return e.exports=s=function(e){if(null===e||!o(e))return e;if("function"!==typeof e)throw new TypeError("Super expression must either be null or a function");if("undefined"!==typeof n){if(n.has(e))return n.get(e);n.set(e,t)}function t(){return a(e,arguments,r(this).constructor)}return t.prototype=Object.create(e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),i(t,e)},e.exports.__esModule=!0,e.exports.default=e.exports,s(t)}e.exports=s,e.exports.__esModule=!0,e.exports.default=e.exports},30907:function(e,t,n){"use strict";function r(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}n.d(t,{Z:function(){return r}})},83878:function(e,t,n){"use strict";function r(e){if(Array.isArray(e))return e}n.d(t,{Z:function(){return r}})},97326:function(e,t,n){"use strict";function r(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}n.d(t,{Z:function(){return r}})},15861:function(e,t,n){"use strict";function r(e,t,n,r,i,o,a){try{var s=e[o](a),u=s.value}catch(c){return void n(c)}s.done?t(u):Promise.resolve(u).then(r,i)}function i(e){return function(){var t=this,n=arguments;return new Promise((function(i,o){var a=e.apply(t,n);function s(e){r(a,i,o,s,u,"next",e)}function u(e){r(a,i,o,s,u,"throw",e)}s(void 0)}))}}n.d(t,{Z:function(){return i}})},15671:function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}n.d(t,{Z:function(){return r}})},5647:function(e,t,n){"use strict";n.d(t,{Z:function(){return o}});var r=n(89611),i=n(78814);function o(e,t,n){return o=(0,i.Z)()?Reflect.construct.bind():function(e,t,n){var i=[null];i.push.apply(i,t);var o=new(Function.bind.apply(e,i));return n&&(0,r.Z)(o,n.prototype),o},o.apply(null,arguments)}},43144:function(e,t,n){"use strict";n.d(t,{Z:function(){return o}});var r=n(49142);function i(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,(0,r.Z)(i.key),i)}}function o(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}},37762:function(e,t,n){"use strict";n.d(t,{Z:function(){return i}});var r=n(40181);function i(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=(0,r.Z)(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var i=0,o=function(){};return{s:o,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,s=!0,u=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){u=!0,a=e},f:function(){try{s||null==n.return||n.return()}finally{if(u)throw a}}}}},29388:function(e,t,n){"use strict";n.d(t,{Z:function(){return a}});var r=n(61120),i=n(78814),o=n(82963);function a(e){var t=(0,i.Z)();return function(){var n,i=(0,r.Z)(e);if(t){var a=(0,r.Z)(this).constructor;n=Reflect.construct(i,arguments,a)}else n=i.apply(this,arguments);return(0,o.Z)(this,n)}}},4942:function(e,t,n){"use strict";n.d(t,{Z:function(){return i}});var r=n(49142);function i(e,t,n){return(t=(0,r.Z)(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}},11752:function(e,t,n){"use strict";n.d(t,{Z:function(){return i}});var r=n(61120);function i(){return i="undefined"!==typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,n){var i=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=(0,r.Z)(e)););return e}(e,t);if(i){var o=Object.getOwnPropertyDescriptor(i,t);return o.get?o.get.call(arguments.length<3?e:n):o.value}},i.apply(this,arguments)}},61120:function(e,t,n){"use strict";function r(e){return r=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},r(e)}n.d(t,{Z:function(){return r}})},60136:function(e,t,n){"use strict";n.d(t,{Z:function(){return i}});var r=n(89611);function i(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&(0,r.Z)(e,t)}},78814:function(e,t,n){"use strict";function r(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}n.d(t,{Z:function(){return r}})},59199:function(e,t,n){"use strict";function r(e){if("undefined"!==typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}n.d(t,{Z:function(){return r}})},25267:function(e,t,n){"use strict";function r(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}n.d(t,{Z:function(){return r}})},82963:function(e,t,n){"use strict";n.d(t,{Z:function(){return o}});var r=n(71002),i=n(97326);function o(e,t){if(t&&("object"===(0,r.Z)(t)||"function"===typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return(0,i.Z)(e)}},74165:function(e,t,n){"use strict";n.d(t,{Z:function(){return i}});var r=n(71002);function i(){i=function(){return t};var e,t={},n=Object.prototype,o=n.hasOwnProperty,a=Object.defineProperty||function(e,t,n){e[t]=n.value},s="function"==typeof Symbol?Symbol:{},u=s.iterator||"@@iterator",c=s.asyncIterator||"@@asyncIterator",l=s.toStringTag||"@@toStringTag";function d(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{d({},"")}catch(e){d=function(e,t,n){return e[t]=n}}function h(e,t,n,r){var i=t&&t.prototype instanceof b?t:b,o=Object.create(i.prototype),s=new N(r||[]);return a(o,"_invoke",{value:A(e,n,s)}),o}function f(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}t.wrap=h;var p="suspendedStart",v="suspendedYield",g="executing",m="completed",y={};function b(){}function w(){}function S(){}var k={};d(k,u,(function(){return this}));var C=Object.getPrototypeOf,x=C&&C(C(O([])));x&&x!==n&&o.call(x,u)&&(k=x);var E=S.prototype=b.prototype=Object.create(k);function T(e){["next","throw","return"].forEach((function(t){d(e,t,(function(e){return this._invoke(t,e)}))}))}function I(e,t){function n(i,a,s,u){var c=f(e[i],e,a);if("throw"!==c.type){var l=c.arg,d=l.value;return d&&"object"==(0,r.Z)(d)&&o.call(d,"__await")?t.resolve(d.__await).then((function(e){n("next",e,s,u)}),(function(e){n("throw",e,s,u)})):t.resolve(d).then((function(e){l.value=e,s(l)}),(function(e){return n("throw",e,s,u)}))}u(c.arg)}var i;a(this,"_invoke",{value:function(e,r){function o(){return new t((function(t,i){n(e,r,t,i)}))}return i=i?i.then(o,o):o()}})}function A(t,n,r){var i=p;return function(o,a){if(i===g)throw new Error("Generator is already running");if(i===m){if("throw"===o)throw a;return{value:e,done:!0}}for(r.method=o,r.arg=a;;){var s=r.delegate;if(s){var u=R(s,r);if(u){if(u===y)continue;return u}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if(i===p)throw i=m,r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);i=g;var c=f(t,n,r);if("normal"===c.type){if(i=r.done?m:v,c.arg===y)continue;return{value:c.arg,done:r.done}}"throw"===c.type&&(i=m,r.method="throw",r.arg=c.arg)}}}function R(t,n){var r=n.method,i=t.iterator[r];if(i===e)return n.delegate=null,"throw"===r&&t.iterator.return&&(n.method="return",n.arg=e,R(t,n),"throw"===n.method)||"return"!==r&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+r+"' method")),y;var o=f(i,t.iterator,n.arg);if("throw"===o.type)return n.method="throw",n.arg=o.arg,n.delegate=null,y;var a=o.arg;return a?a.done?(n[t.resultName]=a.value,n.next=t.nextLoc,"return"!==n.method&&(n.method="next",n.arg=e),n.delegate=null,y):a:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,y)}function _(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function P(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function N(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(_,this),this.reset(!0)}function O(t){if(t||""===t){var n=t[u];if(n)return n.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var i=-1,a=function n(){for(;++i<t.length;)if(o.call(t,i))return n.value=t[i],n.done=!1,n;return n.value=e,n.done=!0,n};return a.next=a}}throw new TypeError((0,r.Z)(t)+" is not iterable")}return w.prototype=S,a(E,"constructor",{value:S,configurable:!0}),a(S,"constructor",{value:w,configurable:!0}),w.displayName=d(S,l,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===w||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,S):(e.__proto__=S,d(e,l,"GeneratorFunction")),e.prototype=Object.create(E),e},t.awrap=function(e){return{__await:e}},T(I.prototype),d(I.prototype,c,(function(){return this})),t.AsyncIterator=I,t.async=function(e,n,r,i,o){void 0===o&&(o=Promise);var a=new I(h(e,n,r,i),o);return t.isGeneratorFunction(n)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},T(E),d(E,l,"Generator"),d(E,u,(function(){return this})),d(E,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),n=[];for(var r in t)n.push(r);return n.reverse(),function e(){for(;n.length;){var r=n.pop();if(r in t)return e.value=r,e.done=!1,e}return e.done=!0,e}},t.values=O,N.prototype={constructor:N,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(P),!t)for(var n in this)"t"===n.charAt(0)&&o.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var n=this;function r(r,i){return s.type="throw",s.arg=t,n.next=r,i&&(n.method="next",n.arg=e),!!i}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],s=a.completion;if("root"===a.tryLoc)return r("end");if(a.tryLoc<=this.prev){var u=o.call(a,"catchLoc"),c=o.call(a,"finallyLoc");if(u&&c){if(this.prev<a.catchLoc)return r(a.catchLoc,!0);if(this.prev<a.finallyLoc)return r(a.finallyLoc)}else if(u){if(this.prev<a.catchLoc)return r(a.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return r(a.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var r=this.tryEntries[n];if(r.tryLoc<=this.prev&&o.call(r,"finallyLoc")&&this.prev<r.finallyLoc){var i=r;break}}i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=e,a.arg=t,i?(this.method="next",this.next=i.finallyLoc,y):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),y},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),P(n),y}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var i=r.arg;P(n)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(t,n,r){return this.delegate={iterator:O(t),resultName:n,nextLoc:r},"next"===this.method&&(this.arg=e),y}},t}},89611:function(e,t,n){"use strict";function r(e,t){return r=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},r(e,t)}n.d(t,{Z:function(){return r}})},29439:function(e,t,n){"use strict";n.d(t,{Z:function(){return a}});var r=n(83878);var i=n(40181),o=n(25267);function a(e,t){return(0,r.Z)(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,i,o,a,s=[],u=!0,c=!1;try{if(o=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;u=!1}else for(;!(u=(r=o.call(n)).done)&&(s.push(r.value),s.length!==t);u=!0);}catch(e){c=!0,i=e}finally{try{if(!u&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(c)throw i}}return s}}(e,t)||(0,i.Z)(e,t)||(0,o.Z)()}},93433:function(e,t,n){"use strict";n.d(t,{Z:function(){return a}});var r=n(30907);var i=n(59199),o=n(40181);function a(e){return function(e){if(Array.isArray(e))return(0,r.Z)(e)}(e)||(0,i.Z)(e)||(0,o.Z)(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}},49142:function(e,t,n){"use strict";n.d(t,{Z:function(){return i}});var r=n(71002);function i(e){var t=function(e,t){if("object"!==(0,r.Z)(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var i=n.call(e,t||"default");if("object"!==(0,r.Z)(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"===(0,r.Z)(t)?t:String(t)}},71002:function(e,t,n){"use strict";function r(e){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r(e)}n.d(t,{Z:function(){return r}})},40181:function(e,t,n){"use strict";n.d(t,{Z:function(){return i}});var r=n(30907);function i(e,t){if(e){if("string"===typeof e)return(0,r.Z)(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?(0,r.Z)(e,t):void 0}}},28664:function(e,t,n){"use strict";n.d(t,{Z:function(){return a}});var r=n(61120),i=n(89611);var o=n(5647);function a(e){var t="function"===typeof Map?new Map:void 0;return a=function(e){if(null===e||(n=e,-1===Function.toString.call(n).indexOf("[native code]")))return e;var n;if("function"!==typeof e)throw new TypeError("Super expression must either be null or a function");if("undefined"!==typeof t){if(t.has(e))return t.get(e);t.set(e,a)}function a(){return(0,o.Z)(e,arguments,(0,r.Z)(this).constructor)}return a.prototype=Object.create(e.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),(0,i.Z)(a,e)},a(e)}},88593:function(e){"use strict";e.exports=JSON.parse('{"name":"axios","version":"0.21.4","description":"Promise based HTTP client for the browser and node.js","main":"index.js","scripts":{"test":"grunt test","start":"node ./sandbox/server.js","build":"NODE_ENV=production grunt build","preversion":"npm test","version":"npm run build && grunt version && git add -A dist && git add CHANGELOG.md bower.json package.json","postversion":"git push && git push --tags","examples":"node ./examples/server.js","coveralls":"cat coverage/lcov.info | ./node_modules/coveralls/bin/coveralls.js","fix":"eslint --fix lib/**/*.js"},"repository":{"type":"git","url":"https://github.com/axios/axios.git"},"keywords":["xhr","http","ajax","promise","node"],"author":"Matt Zabriskie","license":"MIT","bugs":{"url":"https://github.com/axios/axios/issues"},"homepage":"https://axios-http.com","devDependencies":{"coveralls":"^3.0.0","es6-promise":"^4.2.4","grunt":"^1.3.0","grunt-banner":"^0.6.0","grunt-cli":"^1.2.0","grunt-contrib-clean":"^1.1.0","grunt-contrib-watch":"^1.0.0","grunt-eslint":"^23.0.0","grunt-karma":"^4.0.0","grunt-mocha-test":"^0.13.3","grunt-ts":"^6.0.0-beta.19","grunt-webpack":"^4.0.2","istanbul-instrumenter-loader":"^1.0.0","jasmine-core":"^2.4.1","karma":"^6.3.2","karma-chrome-launcher":"^3.1.0","karma-firefox-launcher":"^2.1.0","karma-jasmine":"^1.1.1","karma-jasmine-ajax":"^0.1.13","karma-safari-launcher":"^1.0.0","karma-sauce-launcher":"^4.3.6","karma-sinon":"^1.0.5","karma-sourcemap-loader":"^0.3.8","karma-webpack":"^4.0.2","load-grunt-tasks":"^3.5.2","minimist":"^1.2.0","mocha":"^8.2.1","sinon":"^4.5.0","terser-webpack-plugin":"^4.2.3","typescript":"^4.0.5","url-search-params":"^0.10.0","webpack":"^4.44.2","webpack-dev-server":"^3.11.0"},"browser":{"./lib/adapters/http.js":"./lib/adapters/xhr.js"},"jsdelivr":"dist/axios.min.js","unpkg":"dist/axios.min.js","typings":"./index.d.ts","dependencies":{"follow-redirects":"^1.14.0"},"bundlesize":[{"path":"./dist/axios.min.js","threshold":"5kB"}]}')}},t={};function n(r){var i=t[r];if(void 0!==i)return i.exports;var o=t[r]={id:r,loaded:!1,exports:{}};return e[r].call(o.exports,o,o.exports,n),o.loaded=!0,o.exports}n.m=e,n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,{a:t}),t},function(){var e,t=Object.getPrototypeOf?function(e){return Object.getPrototypeOf(e)}:function(e){return e.__proto__};n.t=function(r,i){if(1&i&&(r=this(r)),8&i)return r;if("object"===typeof r&&r){if(4&i&&r.__esModule)return r;if(16&i&&"function"===typeof r.then)return r}var o=Object.create(null);n.r(o);var a={};e=e||[null,t({}),t([]),t(t)];for(var s=2&i&&r;"object"==typeof s&&!~e.indexOf(s);s=t(s))Object.getOwnPropertyNames(s).forEach((function(e){a[e]=function(){return r[e]}}));return a.default=function(){return r},n.d(o,a),o}}(),n.d=function(e,t){for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.f={},n.e=function(e){return Promise.all(Object.keys(n.f).reduce((function(t,r){return n.f[r](e,t),t}),[]))},n.u=function(e){return"static/js/FluidFramework-HashFallback.0e54f24d.chunk.js"},n.miniCssF=function(e){},n.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}(),n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},function(){var e={},t="unitywebgl:";n.l=function(r,i,o,a){if(e[r])e[r].push(i);else{var s,u;if(void 0!==o)for(var c=document.getElementsByTagName("script"),l=0;l<c.length;l++){var d=c[l];if(d.getAttribute("src")==r||d.getAttribute("data-webpack")==t+o){s=d;break}}s||(u=!0,(s=document.createElement("script")).charset="utf-8",s.timeout=120,n.nc&&s.setAttribute("nonce",n.nc),s.setAttribute("data-webpack",t+o),s.src=r),e[r]=[i];var h=function(t,n){s.onerror=s.onload=null,clearTimeout(f);var i=e[r];if(delete e[r],s.parentNode&&s.parentNode.removeChild(s),i&&i.forEach((function(e){return e(n)})),t)return t(n)},f=setTimeout(h.bind(null,void 0,{type:"timeout",target:s}),12e4);s.onerror=h.bind(null,s.onerror),s.onload=h.bind(null,s.onload),u&&document.head.appendChild(s)}}}(),n.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.nmd=function(e){return e.paths=[],e.children||(e.children=[]),e},n.p="./",function(){var e={179:0};n.f.j=function(t,r){var i=n.o(e,t)?e[t]:void 0;if(0!==i)if(i)r.push(i[2]);else{var o=new Promise((function(n,r){i=e[t]=[n,r]}));r.push(i[2]=o);var a=n.p+n.u(t),s=new Error;n.l(a,(function(r){if(n.o(e,t)&&(0!==(i=e[t])&&(e[t]=void 0),i)){var o=r&&("load"===r.type?"missing":r.type),a=r&&r.target&&r.target.src;s.message="Loading chunk "+t+" failed.\n("+o+": "+a+")",s.name="ChunkLoadError",s.type=o,s.request=a,i[1](s)}}),"chunk-"+t,t)}};var t=function(t,r){var i,o,a=r[0],s=r[1],u=r[2],c=0;if(a.some((function(t){return 0!==e[t]}))){for(i in s)n.o(s,i)&&(n.m[i]=s[i]);if(u)u(n)}for(t&&t(r);c<a.length;c++)o=a[c],n.o(e,o)&&e[o]&&e[o][0](),e[o]=0},r=self.webpackChunkunitywebgl=self.webpackChunkunitywebgl||[];r.forEach(t.bind(null,0)),r.push=t.bind(null,r.push.bind(r))}(),function(){"use strict";var e=n(72791),t=n.t(e,2),r=n(1250),i=n(4942);function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function a(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){(0,i.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var s=Symbol("fui.slotRenderFunction"),u=Symbol("fui.slotElementType");function c(e){return Boolean(null===e||void 0===e?void 0:e.hasOwnProperty(u))}var l=n(93433);function d(e,t){if(null==e)return{};var n,r,i=function(e,t){if(null==e)return{};var n,r,i={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}var h=n(49142);function f(n,r){var i=function(e){var t=e.as,n=e[u],r=e[s],i=d(e,["as",u,s].map(h.Z)),o="string"===typeof n&&null!==t&&void 0!==t?t:n;return"string"!==typeof o&&t&&(i.as=t),{elementType:o,props:i,renderFunction:r}}(n),o=i.elementType,a=i.renderFunction,c=i.props;return a?(r.length>0&&(c.children=e.createElement.apply(t,[e.Fragment,{}].concat((0,l.Z)(r)))),e.createElement(e.Fragment,{},a(o,c))):e.createElement.apply(t,[o,c].concat((0,l.Z)(r)))}function p(n,r){for(var o=arguments.length,s=new Array(o>2?o-2:0),l=2;l<o;l++)s[l-2]=arguments[l];return c(r)?f(function(e,t){return a(a({},t),{},(0,i.Z)({},u,e))}(n,r),s):c(n)?f(n,s):e.createElement.apply(t,[n,r].concat(s))}function v(){return"undefined"!==typeof window&&!(!window.document||!window.document.createElement)}var g=e.createContext("ltr"),m=function(t){var n=t.children,r=t.dir;return e.createElement(g.Provider,{value:r},n)};var y=e.createContext(void 0),b={targetDocument:"object"===typeof document?document:void 0,dir:"ltr"},w=y.Provider;function S(){var t;return null!==(t=e.useContext(y))&&void 0!==t?t:b}var k=e.createContext(void 0),C=k.Provider,x=e.createContext(void 0),E=x.Provider;var T=e.createContext(void 0),I=T.Provider,A=e.createContext(void 0),R=A.Provider;var _=e.createContext(void 0),P=_.Provider;var N=n(29439);var O="undefined"===typeof window?n.g:window,M="@griffel/";function F(e,t){return O[Symbol.for(M+e)]||(O[Symbol.for(M+e)]=t),O[Symbol.for(M+e)]}var Z=F("DEFINITION_LOOKUP_TABLE",{}),D="data-make-styles-bucket",L=7,B="___",q=B.length+L;function j(e,t,n){var r=[];if(n[D]=t,e)for(var i in n)e.setAttribute(i,n[i]);return{elementAttributes:n,insertRule:function(t){return(null===e||void 0===e?void 0:e.sheet)?e.sheet.insertRule(t,e.sheet.cssRules.length):r.push(t)},element:e,bucketName:t,cssRules:function(){return(null===e||void 0===e?void 0:e.sheet)?Array.from(e.sheet.cssRules).map((function(e){return e.cssText})):r}}}var U=["r","d","l","v","w","f","i","h","a","s","k","t","m","c"].reduce((function(e,t,n){return e[t]=n,e}),{});function H(e,t,n,r){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{},o="m"===e,s=o?e+i.m:e;if(!r.stylesheets[s]){var u=t&&t.createElement("style"),c=j(u,e,a(a({},r.styleElementAttributes),o&&{media:i.m}));r.stylesheets[s]=c,t&&u&&t.head.insertBefore(u,function(e,t,n,r,i){var o=U[n],a=function(e){return o-U[e.getAttribute(D)]},s=e.head.querySelectorAll("[".concat(D,"]"));if("m"===n&&i){var u=e.head.querySelectorAll("[".concat(D,'="').concat(n,'"]'));u.length&&(s=u,a=function(e){return r.compareMediaQueries(i.m,e.media)})}var c=s.length,l=c-1;for(;l>=0;){var d=s.item(l);if(a(d)>0)return d.nextSibling;l--}if(c>0)return s.item(0);return t?t.nextSibling:null}(t,n,e,r,i))}return r.stylesheets[s]}":(".concat(["-moz-placeholder","-moz-focus-inner","-moz-focusring","-ms-input-placeholder","-moz-read-write","-moz-read-only"].join("|"),")");function z(e,t){try{e.insertRule(t)}catch(Oi){0}}var V=0,G=function(e,t){return e<t?-1:e>t?1:0};function K(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"undefined"===typeof document?void 0:document,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.unstable_filterCSSRule,r=t.insertionPoint,i=t.styleElementAttributes,o=t.compareMediaQueries,a=void 0===o?G:o,s={insertionCache:{},stylesheets:{},styleElementAttributes:Object.freeze(i),compareMediaQueries:a,id:"d".concat(V++),insertCSSRules:function(t){for(var i in t)for(var o=t[i],a=0,u=o.length;a<u;a++){var c=(p=o[a],Array.isArray(p)?p:[p]),l=(0,N.Z)(c,2),d=l[0],h=l[1],f=H(i,e,r||null,s,h);s.insertionCache[d]||(s.insertionCache[d]=i,n?n(d)&&z(f,d):z(f,d))}var p}};return s}var W=e.createContext(K());function J(){return e.useContext(W)}function Q(e,t){var n,r,i=e;return Boolean((null===i||void 0===i||null===(n=i.ownerDocument)||void 0===n?void 0:n.defaultView)&&i instanceof i.ownerDocument.defaultView[null!==(r=null===t||void 0===t?void 0:t.constructorName)&&void 0!==r?r:"HTMLElement"])}var Y=n(15671),X=n(43144),$="undefined"!==typeof WeakRef,ee=function(){function e(t){(0,Y.Z)(this,e),$&&"object"===typeof t?this._weakRef=new WeakRef(t):this._instance=t}return(0,X.Z)(e,[{key:"deref",value:function(){var e,t,n,r;return this._weakRef?(r=null===(e=this._weakRef)||void 0===e?void 0:e.deref())||delete this._weakRef:(null===(n=null===(t=r=this._instance)||void 0===t?void 0:t.isDisposed)||void 0===n?void 0:n.call(t))&&delete this._instance,r}}]),e}(),te="keyborg:focusin";var ne=!1;var re=0,ie=function(){function e(){(0,Y.Z)(this,e),this.__keyborgCoreRefs={},this._isNavigatingWithKeyboard=!1}return(0,X.Z)(e,[{key:"add",value:function(e){var t=e.id;t in this.__keyborgCoreRefs||(this.__keyborgCoreRefs[t]=new ee(e))}},{key:"remove",value:function(e){delete this.__keyborgCoreRefs[e],0===Object.keys(this.__keyborgCoreRefs).length&&(this._isNavigatingWithKeyboard=!1)}},{key:"setVal",value:function(e){if(this._isNavigatingWithKeyboard!==e){this._isNavigatingWithKeyboard=e;for(var t=0,n=Object.keys(this.__keyborgCoreRefs);t<n.length;t++){var r=n[t],i=this.__keyborgCoreRefs[r].deref();i?i.update(e):this.remove(r)}}}},{key:"getVal",value:function(){return this._isNavigatingWithKeyboard}}]),e}(),oe=new ie,ae=function(){function e(t,n){var r=this;(0,Y.Z)(this,e),this._isMouseUsed=!1,this._onFocusIn=function(e){if(r._isMouseUsed)r._isMouseUsed=!1;else if(!oe.getVal()){var t=e.details;t.relatedTarget&&(t.isFocusedProgrammatically||void 0===t.isFocusedProgrammatically||oe.setVal(!0))}},this._onMouseDown=function(e){0===e.buttons||0===e.clientX&&0===e.clientY&&0===e.screenX&&0===e.screenY||(r._isMouseUsed=!0,oe.setVal(!1))},this._onKeyDown=function(e){var t,n=oe.getVal(),i=e.keyCode,o=r._triggerKeys;n||o&&!o.has(i)?n&&(null===(t=r._dismissKeys)||void 0===t?void 0:t.has(i))&&r._scheduleDismiss():oe.setVal(!0)},this.id="c"+ ++re,this._win=t;var i=t.document;if(n){var o=n.triggerKeys,a=n.dismissKeys;(null===o||void 0===o?void 0:o.length)&&(this._triggerKeys=new Set(o)),(null===a||void 0===a?void 0:a.length)&&(this._dismissKeys=new Set(a))}i.addEventListener(te,this._onFocusIn,!0),i.addEventListener("mousedown",this._onMouseDown,!0),t.addEventListener("keydown",this._onKeyDown,!0),function(e){var t=e;ne||(ne=function(e){var t=e.HTMLElement,n=t.prototype.focus,r=!1;return t.prototype.focus=function(){r=!0},e.document.createElement("button").focus(),t.prototype.focus=n,r}(t));var n=t.HTMLElement.prototype.focus;if(!n.__keyborgNativeFocus){t.HTMLElement.prototype.focus=i;var r=t.__keyborgData={focusInHandler:function(e){var t,n=e.target;if(n){var i=document.createEvent("HTMLEvents");i.initEvent(te,!0,!0);var o={relatedTarget:e.relatedTarget||void 0};(ne||r.lastFocusedProgrammatically)&&(o.isFocusedProgrammatically=n===(null===(t=r.lastFocusedProgrammatically)||void 0===t?void 0:t.deref()),r.lastFocusedProgrammatically=void 0),i.details=o,n.dispatchEvent(i)}}};t.document.addEventListener("focusin",t.__keyborgData.focusInHandler,!0),i.__keyborgNativeFocus=n}function i(){var e=t.__keyborgData;return e&&(e.lastFocusedProgrammatically=new ee(this)),n.apply(this,arguments)}}(t),oe.add(this)}return(0,X.Z)(e,[{key:"dispose",value:function(){var e=this._win;if(e){this._dismissTimer&&(e.clearTimeout(this._dismissTimer),this._dismissTimer=void 0),function(e){var t=e,n=t.HTMLElement.prototype,r=n.focus.__keyborgNativeFocus,i=t.__keyborgData;i&&(t.document.removeEventListener("focusin",i.focusInHandler,!0),delete t.__keyborgData),r&&(n.focus=r)}(e);var t=e.document;t.removeEventListener(te,this._onFocusIn,!0),t.removeEventListener("mousedown",this._onMouseDown,!0),e.removeEventListener("keydown",this._onKeyDown,!0),delete this._win,oe.remove(this.id)}}},{key:"isDisposed",value:function(){return!!this._win}},{key:"update",value:function(e){var t,n,r=null===(n=null===(t=this._win)||void 0===t?void 0:t.__keyborg)||void 0===n?void 0:n.refs;if(r)for(var i=0,o=Object.keys(r);i<o.length;i++){var a=o[i];se.update(r[a],e)}}},{key:"_scheduleDismiss",value:function(){var e=this,t=this._win;if(t){this._dismissTimer&&(t.clearTimeout(this._dismissTimer),this._dismissTimer=void 0);var n=t.document.activeElement;this._dismissTimer=t.setTimeout((function(){e._dismissTimer=void 0;var r=t.document.activeElement;n&&r&&n===r&&oe.setVal(!1)}),500)}}}]),e}(),se=function(){function e(t,n){(0,Y.Z)(this,e),this._cb=[],this._id="k"+ ++re,this._win=t;var r=t.__keyborg;r?(this._core=r.core,r.refs[this._id]=this):(this._core=new ae(t,n),t.__keyborg={core:this._core,refs:(0,i.Z)({},this._id,this)})}return(0,X.Z)(e,[{key:"dispose",value:function(){var e,t=null===(e=this._win)||void 0===e?void 0:e.__keyborg;(null===t||void 0===t?void 0:t.refs[this._id])&&(delete t.refs[this._id],0===Object.keys(t.refs).length&&(t.core.dispose(),delete this._win.__keyborg)),this._cb=[],delete this._core,delete this._win}},{key:"isNavigatingWithKeyboard",value:function(){return oe.getVal()}},{key:"subscribe",value:function(e){this._cb.push(e)}},{key:"unsubscribe",value:function(e){var t=this._cb.indexOf(e);t>=0&&this._cb.splice(t,1)}},{key:"setVal",value:function(e){oe.setVal(e)}}],[{key:"create",value:function(t,n){return new e(t,n)}},{key:"dispose",value:function(e){e.dispose()}},{key:"update",value:function(e,t){e._cb.forEach((function(e){return e(t)}))}}]),e}();":global([".concat("data-keyboard-nav","])");var ue="data-fui-focus-visible";function ce(e,t){if(de(e))return function(){};var n,r,i={current:void 0},o=(n=t,se.create(n,r));o.subscribe((function(e){!e&&i.current&&(le(i.current),i.current=void 0)}));var a=function(e){i.current&&(le(i.current),i.current=void 0),o.isNavigatingWithKeyboard()&&Q(e.target)&&e.target&&(i.current=e.target,i.current.setAttribute(ue,""))},s=function(t){(!t.relatedTarget||Q(t.relatedTarget)&&!e.contains(t.relatedTarget))&&i.current&&(le(i.current),i.current=void 0)};return e.addEventListener(te,a),e.addEventListener("focusout",s),e.focusVisible=!0,function(){var t;e.removeEventListener(te,a),e.removeEventListener("focusout",s),delete e.focusVisible,t=o,se.dispose(t)}}function le(e){e.removeAttribute(ue)}function de(e){return!!e&&(!!e.focusVisible||de(null===e||void 0===e?void 0:e.parentElement))}function he(){var t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=S(),i=e.useRef(null),o=null!==(t=n.targetDocument)&&void 0!==t?t:r.targetDocument;return e.useEffect((function(){if((null===o||void 0===o?void 0:o.defaultView)&&i.current)return ce(i.current,o.defaultView)}),[i,o]),i}function fe(t,n){var r=n.defaultProps,o=n.elementType,c=function(t){if("string"===typeof t||"number"===typeof t||Array.isArray(t)||e.isValidElement(t))return{children:t};0;return t}(t),l=a(a(a({},r),c),{},(0,i.Z)({},u,o));return c&&"function"===typeof c.children&&(l[s]=c.children,l.children=null===r||void 0===r?void 0:r.children),l}var pe=n(37762),ve=function(){for(var e={},t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];for(var i=0,o=n;i<o.length;i++){var a,s=o[i],u=Array.isArray(s)?s:Object.keys(s),c=(0,pe.Z)(u);try{for(c.s();!(a=c.n()).done;){e[a.value]=1}}catch(l){c.e(l)}finally{c.f()}}return e},ge=ve(["onAuxClick","onAnimationEnd","onAnimationStart","onCopy","onCut","onPaste","onCompositionEnd","onCompositionStart","onCompositionUpdate","onFocus","onFocusCapture","onBlur","onBlurCapture","onChange","onInput","onSubmit","onLoad","onError","onKeyDown","onKeyDownCapture","onKeyPress","onKeyUp","onAbort","onCanPlay","onCanPlayThrough","onDurationChange","onEmptied","onEncrypted","onEnded","onLoadedData","onLoadedMetadata","onLoadStart","onPause","onPlay","onPlaying","onProgress","onRateChange","onSeeked","onSeeking","onStalled","onSuspend","onTimeUpdate","onVolumeChange","onWaiting","onClick","onClickCapture","onContextMenu","onDoubleClick","onDrag","onDragEnd","onDragEnter","onDragExit","onDragLeave","onDragOver","onDragStart","onDrop","onMouseDown","onMouseDownCapture","onMouseEnter","onMouseLeave","onMouseMove","onMouseOut","onMouseOver","onMouseUp","onMouseUpCapture","onSelect","onTouchCancel","onTouchEnd","onTouchMove","onTouchStart","onScroll","onWheel","onPointerCancel","onPointerDown","onPointerEnter","onPointerLeave","onPointerMove","onPointerOut","onPointerOver","onPointerUp","onGotPointerCapture","onLostPointerCapture"]),me=ve(["accessKey","children","className","contentEditable","dir","draggable","hidden","htmlFor","id","lang","ref","role","style","tabIndex","title","translate","spellCheck","name"]),ye=ve(["itemID","itemProp","itemRef","itemScope","itemType"]),be=ve(me,ge,ye),we=ve(be,["form"]),Se=ve(be,["height","loop","muted","preload","src","width"]),ke=ve(Se,["poster"]),Ce=ve(be,["start"]),xe=ve(be,["value"]),Ee=ve(be,["download","href","hrefLang","media","rel","target","type"]),Te=ve(be,["dateTime"]),Ie=ve(be,["autoFocus","disabled","form","formAction","formEncType","formMethod","formNoValidate","formTarget","type","value"]);var Ae={label:we,audio:Se,video:ke,ol:Ce,li:xe,a:Ee,button:Ie,input:ve(Ie,["accept","alt","autoCapitalize","autoComplete","checked","dirname","form","height","inputMode","list","max","maxLength","min","multiple","pattern","placeholder","readOnly","required","src","step","size","type","value","width"]),textarea:ve(Ie,["autoCapitalize","cols","dirname","form","maxLength","placeholder","readOnly","required","rows","wrap"]),select:ve(Ie,["form","multiple","required"]),option:ve(be,["selected","value"]),table:ve(be,["cellPadding","cellSpacing"]),tr:be,th:ve(be,["colSpan","rowSpan","scope"]),td:ve(be,["colSpan","headers","rowSpan","scope"]),colGroup:ve(be,["span"]),col:ve(be,["span"]),fieldset:ve(be,["disabled","form"]),form:ve(be,["acceptCharset","action","encType","encType","method","noValidate","target"]),iframe:ve(be,["allow","allowFullScreen","allowPaymentRequest","allowTransparency","csp","height","importance","referrerPolicy","sandbox","src","srcDoc","width"]),img:ve(be,["alt","crossOrigin","height","src","srcSet","useMap","width"]),time:Te,dialog:ve(be,["open","onCancel","onClose"])};function Re(e,t,n){var r=e&&Ae[e]||be;return r.as=1,function(e,t,n){for(var r=Array.isArray(t),i={},o=0,a=Object.keys(e);o<a.length;o++){var s=a[o];!(!r&&t[s]||r&&t.indexOf(s)>=0||0===s.indexOf("data-")||0===s.indexOf("aria-"))||n&&-1!==(null===n||void 0===n?void 0:n.indexOf(s))||(i[s]=e[s])}return i}(t,r,n)}function _e(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];var i=e.useCallback((function(e){i.current=e;for(var t=0,r=n;t<r.length;t++){var o=r[t];"function"===typeof o?o(e):o&&(o.current=e)}}),[].concat(n));return i}var Pe=v()?e.useLayoutEffect:e.useEffect,Ne={current:0},Oe=e.createContext(void 0);function Me(){var t;return null!==(t=e.useContext(Oe))&&void 0!==t?t:Ne}var Fe=e.createContext(void 0);Fe.Provider;function Ze(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"fui-",r=arguments.length>1?arguments[1]:void 0,i=Me(),o=e.useContext(Fe)||"",a=t.useId;if(a){var s=a(),u=e.useMemo((function(){return s.replace(/:/g,"")}),[s]);return r||"".concat(o).concat(n).concat(u)}return e.useMemo((function(){return r||"".concat(o).concat(n).concat(++i.current)}),[o,n,r,i])}var De=function(){var e={};return function(t,n){void 0===e[t.id]&&(t.insertCSSRules(n),e[t.id]=!0)}};function Le(e){for(var t,n=0,r=0,i=e.length;i>=4;++r,i-=4)t=1540483477*(65535&(t=255&e.charCodeAt(r)|(255&e.charCodeAt(++r))<<8|(255&e.charCodeAt(++r))<<16|(255&e.charCodeAt(++r))<<24))+(59797*(t>>>16)<<16),n=1540483477*(65535&(t^=t>>>24))+(59797*(t>>>16)<<16)^1540483477*(65535&n)+(59797*(n>>>16)<<16);switch(i){case 3:n^=(255&e.charCodeAt(r+2))<<16;case 2:n^=(255&e.charCodeAt(r+1))<<8;case 1:n=1540483477*(65535&(n^=255&e.charCodeAt(r)))+(59797*(n>>>16)<<16)}return(((n=1540483477*(65535&(n^=n>>>13))+(59797*(n>>>16)<<16))^n>>>15)>>>0).toString(36)}function Be(e){var t=e.length;if(t===L)return e;for(var n=t;n<L;n++)e+="0";return e}function qe(e,t){return B+Be(Le(e+t))}function je(e,t){var n="";for(var r in e){var i=e[r];if(i){var o=Array.isArray(i);n+="rtl"===t?(o?i[1]:i)+" ":(o?i[0]:i)+" "}}return n.slice(0,-1)}function Ue(e,t){var n={};for(var r in e){var i=je(e[r],t);if(""!==i){var o=qe(i,t),a=o+" "+i;Z[o]=[e[r],t],n[r]=a}else n[r]=""}return n}function He(e,t){var n=(arguments.length>2&&void 0!==arguments[2]?arguments[2]:De)(),r=null,i=null;return function(o){var a=o.dir,s=o.renderer,u="ltr"===a;return u?null===r&&(r=Ue(e,a)):null===i&&(i=Ue(e,a)),n(s,t),u?r:i}}var ze={};var Ve="fui-FluentProvider",Ge=He({root:{sj55zd:"f19n0e5",De3pzq:"fxugw4r",fsow6f:["f1o700av","fes3tcz"],Bahqtrf:"fk6fouc",Be2twd7:"fkhj508",Bhrd7zp:"figsok6",Bg96gwp:"f1i3iumi"}},{d:[".f19n0e5{color:var(--colorNeutralForeground1);}",".fxugw4r{background-color:var(--colorNeutralBackground1);}",".f1o700av{text-align:left;}",".fes3tcz{text-align:right;}",".fk6fouc{font-family:var(--fontFamilyBase);}",".fkhj508{font-size:var(--fontSizeBase300);}",".figsok6{font-weight:var(--fontWeightRegular);}",".f1i3iumi{line-height:var(--lineHeightBase300);}"]}),Ke=function(e){var t=J(),n=Ge({dir:e.dir,renderer:t});return e.root.className=function(){for(var e=arguments,t=null,n="",r="",i=new Array(arguments.length),o=function(){var t=e[a];if("string"===typeof t&&""!==t){var o=t.indexOf(B);if(-1===o)n+=t+" ";else{var s=t.substr(o,q);o>0&&(n+=t.slice(0,o)),r+=s,i[a]=s}}},a=0;a<arguments.length;a++)o();if(""===r)return n.slice(0,-1);var s=ze[r];if(void 0!==s)return n+s;for(var u=[],c=0;c<arguments.length;c++){var l=i[c];if(l){var d=Z[l];d&&(u.push(d[0]),t=d[1])}}var h=Object.assign.apply(Object,[{}].concat(u)),f=je(h,t),p=qe(f,t,i);return f=p+" "+f,ze[r]=f,Z[p]=[h,t],n+f}(Ve,e.themeClassName,n.root,e.root.className),e},We=t.useInsertionEffect?t.useInsertionEffect:Pe,Je=function(t){var n=t.targetDocument,r=t.theme,i=t.rendererAttributes,o=e.useRef(),s=Ze(Ve),u=i,c=e.useMemo((function(){return r?Object.keys(r).reduce((function(e,t){return e+="--".concat(t,": ").concat(r[t],"; ")}),""):""}),[r]),l=".".concat(s," { ").concat(c," }");return function(t,n){e.useState((function(){if(t){var e=t.getElementById(n);e&&t.head.append(e)}}))}(n,s),We((function(){var e=null===n||void 0===n?void 0:n.getElementById(s);return e?o.current=e:(o.current=function(e,t){if(e){var n=e.createElement("style");return Object.keys(t).forEach((function(e){n.setAttribute(e,t[e])})),e.head.appendChild(n),n}}(n,a(a({},u),{},{id:s})),o.current&&function(e,t){var n=e.sheet;n&&(n.cssRules.length>0&&n.deleteRule(0),n.insertRule(t,0))}(o.current,l)),function(){var e;null===(e=o.current)||void 0===e||e.remove()}}),[s,n,l,u]),{styleTagId:s,rule:l}};var Qe=function(t,n){var r,i=S(),o=e.useContext(k),s=function(){var t;return null!==(t=e.useContext(_))&&void 0!==t?t:{}}(),u=e.useContext(T)||{},c=t.applyStylesToPortals,l=void 0===c||c,d=t.customStyleHooks_unstable,h=t.dir,f=void 0===h?i.dir:h,p=t.targetDocument,v=void 0===p?i.targetDocument:p,g=t.theme,m=t.overrides_unstable,y=void 0===m?{}:m,b=Ye(o,g),w=Ye(s,y),C=Ye(u,d),x=J(),E=Je({theme:b,targetDocument:v,rendererAttributes:null!==(r=x.styleElementAttributes)&&void 0!==r?r:{}}),I=E.styleTagId,A=E.rule;return{applyStylesToPortals:l,customStyleHooks_unstable:C,dir:f,targetDocument:v,theme:b,overrides_unstable:w,themeClassName:I,components:{root:"div"},root:fe(Re("div",a(a({},t),{},{dir:f,ref:_e(n,he({targetDocument:v}))})),{elementType:"div"}),serverStyleProps:{cssRule:A,attributes:a(a({},x.styleElementAttributes),{},{id:I})}}};function Ye(e,t){return e&&t?a(a({},e),t):e||t}var Xe=e.forwardRef((function(t,n){var r=Qe(t,n);Ke(r);var i=function(t){var n=t.applyStylesToPortals,r=t.customStyleHooks_unstable,i=t.dir,o=t.root,a=t.targetDocument,s=t.theme,u=t.themeClassName,c=t.overrides_unstable,l=e.useMemo((function(){return{dir:i,targetDocument:a}}),[i,a]),d=e.useState((function(){return{}})),h=(0,N.Z)(d,1)[0];return{customStyleHooks_unstable:r,overrides_unstable:c,provider:l,textDirection:i,tooltip:h,theme:s,themeClassName:n?o.className:u}}(r);return function(e,t){return p(w,{value:t.provider},p(C,{value:t.theme},p(E,{value:t.themeClassName},p(I,{value:t.customStyleHooks_unstable},p(R,{value:t.tooltip},p(m,{dir:t.textDirection},p(P,{value:t.overrides_unstable},p(e.root,null,v()?null:p("style",a({dangerouslySetInnerHTML:{__html:e.serverStyleProps.cssRule}},e.serverStyleProps.attributes)),e.root.children))))))))}(r,i)}));Xe.displayName="FluentProvider";var $e="#0a0a0a",et="#141414",tt="#1a1a1a",nt="#1f1f1f",rt="#242424",it="#292929",ot="#2e2e2e",at="#333333",st="#383838",ut="#3d3d3d",ct="#424242",lt="#4d4d4d",dt="#525252",ht="#575757",ft="#5c5c5c",pt="#616161",vt="#666666",gt="#6b6b6b",mt="#707070",yt="#757575",bt="#999999",wt="#adadad",St="#b3b3b3",kt="#bdbdbd",Ct="#c7c7c7",xt="#d1d1d1",Et="#d6d6d6",Tt="#dbdbdb",It="#e0e0e0",At="#e6e6e6",Rt="#ebebeb",_t="#f0f0f0",Pt="#f5f5f5",Nt="#fafafa",Ot="rgba(255, 255, 255, 0.05)",Mt="rgba(255, 255, 255, 0.1)",Ft="rgba(255, 255, 255, 0.2)",Zt="rgba(255, 255, 255, 0.4)",Dt="rgba(255, 255, 255, 0.5)",Lt="rgba(255, 255, 255, 0.6)",Bt="rgba(255, 255, 255, 0.7)",qt="rgba(255, 255, 255, 0.8)",jt="rgba(0, 0, 0, 0.05)",Ut="rgba(0, 0, 0, 0.1)",Ht="rgba(0, 0, 0, 0.2)",zt="rgba(0, 0, 0, 0.3)",Vt="rgba(0, 0, 0, 0.4)",Gt="rgba(0, 0, 0, 0.5)",Kt="rgba(26, 26, 26, 0.5)",Wt="rgba(31, 31, 31, 0.7)",Jt="rgba(36, 36, 36, 0.5)",Qt="rgba(36, 36, 36, 0.8)",Yt="#ffffff",Xt="#000000",$t="#ffff00",en="#1aebff",tn="#3ff23f",nn="#000000",rn="#ffffff",on="#000000",an="#000000",sn="#ffffff",un={shade50:"#200205",shade40:"#3b0509",shade30:"#6e0811",shade20:"#960b18",shade10:"#b10e1c",primary:"#c50f1f",tint10:"#cc2635",tint20:"#d33f4c",tint30:"#dc626d",tint40:"#eeacb2",tint50:"#f6d1d5",tint60:"#fdf3f4"},cn={shade50:"#031403",shade40:"#052505",shade30:"#094509",shade20:"#0c5e0c",shade10:"#0e700e",primary:"#107c10",tint10:"#218c21",tint20:"#359b35",tint30:"#54b054",tint40:"#9fd89f",tint50:"#c9eac9",tint60:"#f1faf1"},ln={red:{shade50:"#210809",shade40:"#3f1011",shade30:"#751d1f",shade20:"#9f282b",shade10:"#bc2f32",primary:"#d13438",tint10:"#d7494c",tint20:"#dc5e62",tint30:"#e37d80",tint40:"#f1bbbc",tint50:"#f8dadb",tint60:"#fdf6f6"},green:cn,darkOrange:{shade50:"#230900",shade40:"#411200",shade30:"#7a2101",shade20:"#a62d01",shade10:"#c43501",primary:"#da3b01",tint10:"#de501c",tint20:"#e36537",tint30:"#e9835e",tint40:"#f4bfab",tint50:"#f9dcd1",tint60:"#fdf6f3"},yellow:{primary:"#fde300",shade10:"#e4cc00",shade20:"#c0ad00",shade30:"#817400",shade40:"#4c4400",shade50:"#282400",tint10:"#fde61e",tint20:"#fdea3d",tint30:"#feee66",tint40:"#fef7b2",tint50:"#fffad6",tint60:"#fffef5"},berry:{shade50:"#1f091d",shade40:"#3a1136",shade30:"#6d2064",shade20:"#932b88",shade10:"#af33a1",primary:"#c239b3",tint10:"#c94cbc",tint20:"#d161c4",tint30:"#da7ed0",tint40:"#edbbe7",tint50:"#f5daf2",tint60:"#fdf5fc"},lightGreen:{shade50:"#031a02",shade40:"#063004",shade30:"#0b5a08",shade20:"#0e7a0b",shade10:"#11910d",primary:"#13a10e",tint10:"#27ac22",tint20:"#3db838",tint30:"#5ec75a",tint40:"#a7e3a5",tint50:"#cef0cd",tint60:"#f2fbf2"},marigold:{shade50:"#251a00",shade40:"#463100",shade30:"#835b00",shade20:"#b27c00",shade10:"#d39300",primary:"#eaa300",tint10:"#edad1c",tint20:"#efb839",tint30:"#f2c661",tint40:"#f9e2ae",tint50:"#fcefd3",tint60:"#fefbf4"}},dn={darkRed:{shade50:"#130204",shade40:"#230308",shade30:"#420610",shade20:"#590815",shade10:"#690a19",primary:"#750b1c",tint10:"#861b2c",tint20:"#962f3f",tint30:"#ac4f5e",tint40:"#d69ca5",tint50:"#e9c7cd",tint60:"#f9f0f2"},cranberry:un,pumpkin:{shade50:"#200d03",shade40:"#3d1805",shade30:"#712d09",shade20:"#9a3d0c",shade10:"#b6480e",primary:"#ca5010",tint10:"#d06228",tint20:"#d77440",tint30:"#df8e64",tint40:"#efc4ad",tint50:"#f7dfd2",tint60:"#fdf7f4"},peach:{shade50:"#291600",shade40:"#4d2a00",shade30:"#8f4e00",shade20:"#c26a00",shade10:"#e67e00",primary:"#ff8c00",tint10:"#ff9a1f",tint20:"#ffa83d",tint30:"#ffba66",tint40:"#ffddb3",tint50:"#ffedd6",tint60:"#fffaf5"},gold:{shade50:"#1f1900",shade40:"#3a2f00",shade30:"#6c5700",shade20:"#937700",shade10:"#ae8c00",primary:"#c19c00",tint10:"#c8a718",tint20:"#d0b232",tint30:"#dac157",tint40:"#ecdfa5",tint50:"#f5eece",tint60:"#fdfbf2"},brass:{shade50:"#181202",shade40:"#2e2103",shade30:"#553e06",shade20:"#745408",shade10:"#89640a",primary:"#986f0b",tint10:"#a47d1e",tint20:"#b18c34",tint30:"#c1a256",tint40:"#e0cea2",tint50:"#efe4cb",tint60:"#fbf8f2"},brown:{shade50:"#170e07",shade40:"#2b1a0e",shade30:"#50301a",shade20:"#6c4123",shade10:"#804d29",primary:"#8e562e",tint10:"#9c663f",tint20:"#a97652",tint30:"#bb8f6f",tint40:"#ddc3b0",tint50:"#edded3",tint60:"#faf7f4"},forest:{shade50:"#0c1501",shade40:"#162702",shade30:"#294903",shade20:"#376304",shade10:"#427505",primary:"#498205",tint10:"#599116",tint20:"#6ba02b",tint30:"#85b44c",tint40:"#bdd99b",tint50:"#dbebc7",tint60:"#f6faf0"},seafoam:{shade50:"#002111",shade40:"#003d20",shade30:"#00723b",shade20:"#009b51",shade10:"#00b85f",primary:"#00cc6a",tint10:"#19d279",tint20:"#34d889",tint30:"#5ae0a0",tint40:"#a8f0cd",tint50:"#cff7e4",tint60:"#f3fdf8"},darkGreen:{shade50:"#021102",shade40:"#032003",shade30:"#063b06",shade20:"#085108",shade10:"#0a5f0a",primary:"#0b6a0b",tint10:"#1a7c1a",tint20:"#2d8e2d",tint30:"#4da64d",tint40:"#9ad29a",tint50:"#c6e7c6",tint60:"#f0f9f0"},lightTeal:{shade50:"#001d1f",shade40:"#00373a",shade30:"#00666d",shade20:"#008b94",shade10:"#00a5af",primary:"#00b7c3",tint10:"#18bfca",tint20:"#32c8d1",tint30:"#58d3db",tint40:"#a6e9ed",tint50:"#cef3f5",tint60:"#f2fcfd"},teal:{shade50:"#001516",shade40:"#012728",shade30:"#02494c",shade20:"#026467",shade10:"#037679",primary:"#038387",tint10:"#159195",tint20:"#2aa0a4",tint30:"#4cb4b7",tint40:"#9bd9db",tint50:"#c7ebec",tint60:"#f0fafa"},steel:{shade50:"#000f12",shade40:"#001b22",shade30:"#00333f",shade20:"#004555",shade10:"#005265",primary:"#005b70",tint10:"#0f6c81",tint20:"#237d92",tint30:"#4496a9",tint40:"#94c8d4",tint50:"#c3e1e8",tint60:"#eff7f9"},blue:{shade50:"#001322",shade40:"#002440",shade30:"#004377",shade20:"#005ba1",shade10:"#006cbf",primary:"#0078d4",tint10:"#1a86d9",tint20:"#3595de",tint30:"#5caae5",tint40:"#a9d3f2",tint50:"#d0e7f8",tint60:"#f3f9fd"},royalBlue:{shade50:"#000c16",shade40:"#00172a",shade30:"#002c4e",shade20:"#003b6a",shade10:"#00467e",primary:"#004e8c",tint10:"#125e9a",tint20:"#286fa8",tint30:"#4a89ba",tint40:"#9abfdc",tint50:"#c7dced",tint60:"#f0f6fa"},cornflower:{shade50:"#0d1126",shade40:"#182047",shade30:"#2c3c85",shade20:"#3c51b4",shade10:"#4760d5",primary:"#4f6bed",tint10:"#637cef",tint20:"#778df1",tint30:"#93a4f4",tint40:"#c8d1fa",tint50:"#e1e6fc",tint60:"#f7f9fe"},navy:{shade50:"#00061d",shade40:"#000c36",shade30:"#001665",shade20:"#001e89",shade10:"#0023a2",primary:"#0027b4",tint10:"#173bbd",tint20:"#3050c6",tint30:"#546fd2",tint40:"#a3b2e8",tint50:"#ccd5f3",tint60:"#f2f4fc"},lavender:{shade50:"#120f25",shade40:"#221d46",shade30:"#3f3682",shade20:"#5649b0",shade10:"#6656d1",primary:"#7160e8",tint10:"#8172eb",tint20:"#9184ee",tint30:"#a79cf1",tint40:"#d2ccf8",tint50:"#e7e4fb",tint60:"#f9f8fe"},purple:{shade50:"#0f0717",shade40:"#1c0e2b",shade30:"#341a51",shade20:"#46236e",shade10:"#532982",primary:"#5c2e91",tint10:"#6b3f9e",tint20:"#7c52ab",tint30:"#9470bd",tint40:"#c6b1de",tint50:"#e0d3ed",tint60:"#f7f4fb"},grape:{shade50:"#160418",shade40:"#29072e",shade30:"#4c0d55",shade20:"#671174",shade10:"#7a1589",primary:"#881798",tint10:"#952aa4",tint20:"#a33fb1",tint30:"#b55fc1",tint40:"#d9a7e0",tint50:"#eaceef",tint60:"#faf2fb"},lilac:{shade50:"#1c0b1f",shade40:"#35153a",shade30:"#63276d",shade20:"#863593",shade10:"#9f3faf",primary:"#b146c2",tint10:"#ba58c9",tint20:"#c36bd1",tint30:"#cf87da",tint40:"#e6bfed",tint50:"#f2dcf5",tint60:"#fcf6fd"},pink:{shade50:"#24091b",shade40:"#441232",shade30:"#80215d",shade20:"#ad2d7e",shade10:"#cd3595",primary:"#e43ba6",tint10:"#e750b0",tint20:"#ea66ba",tint30:"#ef85c8",tint40:"#f7c0e3",tint50:"#fbddf0",tint60:"#fef6fb"},magenta:{shade50:"#1f0013",shade40:"#390024",shade30:"#6b0043",shade20:"#91005a",shade10:"#ac006b",primary:"#bf0077",tint10:"#c71885",tint20:"#ce3293",tint30:"#d957a8",tint40:"#eca5d1",tint50:"#f5cee6",tint60:"#fcf2f9"},plum:{shade50:"#13000c",shade40:"#240017",shade30:"#43002b",shade20:"#5a003b",shade10:"#6b0045",primary:"#77004d",tint10:"#87105d",tint20:"#98246f",tint30:"#ad4589",tint40:"#d696c0",tint50:"#e9c4dc",tint60:"#faf0f6"},beige:{shade50:"#141313",shade40:"#252323",shade30:"#444241",shade20:"#5d5958",shade10:"#6e6968",primary:"#7a7574",tint10:"#8a8584",tint20:"#9a9594",tint30:"#afabaa",tint40:"#d7d4d4",tint50:"#eae8e8",tint60:"#faf9f9"},mink:{shade50:"#0f0e0e",shade40:"#1c1b1a",shade30:"#343231",shade20:"#474443",shade10:"#54514f",primary:"#5d5a58",tint10:"#706d6b",tint20:"#84817e",tint30:"#9e9b99",tint40:"#cecccb",tint50:"#e5e4e3",tint60:"#f8f8f8"},platinum:{shade50:"#111314",shade40:"#1f2426",shade30:"#3b4447",shade20:"#505c60",shade10:"#5f6d71",primary:"#69797e",tint10:"#79898d",tint20:"#89989d",tint30:"#a0adb2",tint40:"#cdd6d8",tint50:"#e4e9ea",tint60:"#f8f9fa"},anchor:{shade50:"#090a0b",shade40:"#111315",shade30:"#202427",shade20:"#2b3135",shade10:"#333a3f",primary:"#394146",tint10:"#4d565c",tint20:"#626c72",tint30:"#808a90",tint40:"#bcc3c7",tint50:"#dbdfe1",tint60:"#f6f7f8"}},hn={cranberry:un,green:cn,orange:{shade50:"#271002",shade40:"#4a1e04",shade30:"#8a3707",shade20:"#bc4b09",shade10:"#de590b",primary:"#f7630c",tint10:"#f87528",tint20:"#f98845",tint30:"#faa06b",tint40:"#fdcfb4",tint50:"#fee5d7",tint60:"#fff9f5"}},fn=["red","green","darkOrange","yellow","berry","lightGreen","marigold"],pn=["darkRed","cranberry","pumpkin","peach","gold","brass","brown","forest","seafoam","darkGreen","lightTeal","teal","steel","blue","royalBlue","cornflower","navy","lavender","purple","grape","lilac","pink","magenta","plum","beige","mink","platinum","anchor"],vn={success:"green",warning:"orange",danger:"cranberry"},gn=fn.reduce((function(e,t){var n,r=t.slice(0,1).toUpperCase()+t.slice(1),o=(n={},(0,i.Z)(n,"colorPalette".concat(r,"Background1"),ln[t].shade40),(0,i.Z)(n,"colorPalette".concat(r,"Background2"),ln[t].shade30),(0,i.Z)(n,"colorPalette".concat(r,"Background3"),ln[t].primary),(0,i.Z)(n,"colorPalette".concat(r,"Foreground1"),ln[t].tint30),(0,i.Z)(n,"colorPalette".concat(r,"Foreground2"),ln[t].tint40),(0,i.Z)(n,"colorPalette".concat(r,"Foreground3"),ln[t].tint20),(0,i.Z)(n,"colorPalette".concat(r,"BorderActive"),ln[t].tint30),(0,i.Z)(n,"colorPalette".concat(r,"Border1"),ln[t].primary),(0,i.Z)(n,"colorPalette".concat(r,"Border2"),ln[t].tint20),n);return Object.assign(e,o)}),{});gn.colorPaletteRedForeground3=ln.red.tint30,gn.colorPaletteRedBorder2=ln.red.tint30,gn.colorPaletteGreenForeground3=ln.green.tint40,gn.colorPaletteGreenBorder2=ln.green.tint40,gn.colorPaletteDarkOrangeForeground3=ln.darkOrange.tint30,gn.colorPaletteDarkOrangeBorder2=ln.darkOrange.tint30,gn.colorPaletteRedForegroundInverted=ln.red.primary,gn.colorPaletteGreenForegroundInverted=ln.green.primary,gn.colorPaletteYellowForegroundInverted=ln.yellow.shade30;var mn=pn.reduce((function(e,t){var n,r=t.slice(0,1).toUpperCase()+t.slice(1),o=(n={},(0,i.Z)(n,"colorPalette".concat(r,"Background2"),dn[t].shade30),(0,i.Z)(n,"colorPalette".concat(r,"Foreground2"),dn[t].tint40),(0,i.Z)(n,"colorPalette".concat(r,"BorderActive"),dn[t].tint30),n);return Object.assign(e,o)}),{});mn.colorPaletteDarkRedBackground2=dn.darkRed.shade20,mn.colorPalettePlumBackground2=dn.plum.shade20;var yn=a(a({},gn),mn),bn=Object.entries(vn).reduce((function(e,t){var n,r=(0,N.Z)(t,2),o=r[0],a=r[1],s=o.slice(0,1).toUpperCase()+o.slice(1),u=(n={},(0,i.Z)(n,"colorStatus".concat(s,"Background1"),hn[a].shade40),(0,i.Z)(n,"colorStatus".concat(s,"Background2"),hn[a].shade30),(0,i.Z)(n,"colorStatus".concat(s,"Background3"),hn[a].primary),(0,i.Z)(n,"colorStatus".concat(s,"Foreground1"),hn[a].tint30),(0,i.Z)(n,"colorStatus".concat(s,"Foreground2"),hn[a].tint40),(0,i.Z)(n,"colorStatus".concat(s,"Foreground3"),hn[a].tint20),(0,i.Z)(n,"colorStatus".concat(s,"BorderActive"),hn[a].tint30),(0,i.Z)(n,"colorStatus".concat(s,"ForegroundInverted"),hn[a].shade10),(0,i.Z)(n,"colorStatus".concat(s,"Border1"),hn[a].primary),(0,i.Z)(n,"colorStatus".concat(s,"Border2"),hn[a].tint20),n);return Object.assign(e,u)}),{});bn.colorStatusDangerForeground3=hn[vn.danger].tint30,bn.colorStatusDangerBorder2=hn[vn.danger].tint30,bn.colorStatusSuccessForeground3=hn[vn.success].tint40,bn.colorStatusSuccessBorder2=hn[vn.success].tint40,bn.colorStatusWarningForegroundInverted=hn[vn.warning].shade20;var wn={borderRadiusNone:"0",borderRadiusSmall:"2px",borderRadiusMedium:"4px",borderRadiusLarge:"6px",borderRadiusXLarge:"8px",borderRadiusCircular:"10000px"},Sn={fontSizeBase100:"10px",fontSizeBase200:"12px",fontSizeBase300:"14px",fontSizeBase400:"16px",fontSizeBase500:"20px",fontSizeBase600:"24px",fontSizeHero700:"28px",fontSizeHero800:"32px",fontSizeHero900:"40px",fontSizeHero1000:"68px"},kn={lineHeightBase100:"14px",lineHeightBase200:"16px",lineHeightBase300:"20px",lineHeightBase400:"22px",lineHeightBase500:"28px",lineHeightBase600:"32px",lineHeightHero700:"36px",lineHeightHero800:"40px",lineHeightHero900:"52px",lineHeightHero1000:"92px"},Cn={fontWeightRegular:400,fontWeightMedium:500,fontWeightSemibold:600,fontWeightBold:700},xn={fontFamilyBase:"'Segoe UI', 'Segoe UI Web (West European)', -apple-system, BlinkMacSystemFont, Roboto, 'Helvetica Neue', sans-serif",fontFamilyMonospace:"Consolas, 'Courier New', Courier, monospace",fontFamilyNumeric:"Bahnschrift, 'Segoe UI', 'Segoe UI Web (West European)', -apple-system, BlinkMacSystemFont, Roboto, 'Helvetica Neue', sans-serif"},En={strokeWidthThin:"1px",strokeWidthThick:"2px",strokeWidthThicker:"3px",strokeWidthThickest:"4px"};function Tn(e,t){var n,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";return n={},(0,i.Z)(n,"shadow2".concat(r),"0 0 2px ".concat(e,", 0 1px 2px ").concat(t)),(0,i.Z)(n,"shadow4".concat(r),"0 0 2px ".concat(e,", 0 2px 4px ").concat(t)),(0,i.Z)(n,"shadow8".concat(r),"0 0 2px ".concat(e,", 0 4px 8px ").concat(t)),(0,i.Z)(n,"shadow16".concat(r),"0 0 2px ".concat(e,", 0 8px 16px ").concat(t)),(0,i.Z)(n,"shadow28".concat(r),"0 0 8px ".concat(e,", 0 14px 28px ").concat(t)),(0,i.Z)(n,"shadow64".concat(r),"0 0 8px ".concat(e,", 0 32px 64px ").concat(t)),n}var In={durationUltraFast:"50ms",durationFaster:"100ms",durationFast:"150ms",durationNormal:"200ms",durationGentle:"250ms",durationSlow:"300ms",durationSlower:"400ms",durationUltraSlow:"500ms"},An={curveAccelerateMax:"cubic-bezier(1,0,1,1)",curveAccelerateMid:"cubic-bezier(0.7,0,1,0.5)",curveAccelerateMin:"cubic-bezier(0.8,0,1,1)",curveDecelerateMax:"cubic-bezier(0,0,0,1)",curveDecelerateMid:"cubic-bezier(0.1,0.9,0.2,1)",curveDecelerateMin:"cubic-bezier(0.33,0,0.1,1)",curveEasyEaseMax:"cubic-bezier(0.8,0,0.1,1)",curveEasyEase:"cubic-bezier(0.33,0,0.67,1)",curveLinear:"cubic-bezier(0,0,1,1)"},Rn="0",_n="2px",Pn="4px",Nn="6px",On="8px",Mn="10px",Fn="12px",Zn="16px",Dn="20px",Ln="24px",Bn="32px",qn={spacingHorizontalNone:Rn,spacingHorizontalXXS:_n,spacingHorizontalXS:Pn,spacingHorizontalSNudge:Nn,spacingHorizontalS:On,spacingHorizontalMNudge:Mn,spacingHorizontalM:Fn,spacingHorizontalL:Zn,spacingHorizontalXL:Dn,spacingHorizontalXXL:Ln,spacingHorizontalXXXL:Bn},jn={spacingVerticalNone:Rn,spacingVerticalXXS:_n,spacingVerticalXS:Pn,spacingVerticalSNudge:Nn,spacingVerticalS:On,spacingVerticalMNudge:Mn,spacingVerticalM:Fn,spacingVerticalL:Zn,spacingVerticalXL:Dn,spacingVerticalXXL:Ln,spacingVerticalXXXL:Bn},Un={10:"#2b2b40",20:"#2f2f4a",30:"#333357",40:"#383966",50:"#3d3e78",60:"#444791",70:"#4f52b2",80:"#5b5fc7",90:"#7579eb",100:"#7f85f5",110:"#9299f7",120:"#aab1fa",130:"#b6bcfa",140:"#c5cbfa",150:"#dce0fa",160:"#e8ebfa"},Hn=function(e){var t=function(e){return{colorNeutralForeground1:Yt,colorNeutralForeground1Hover:Yt,colorNeutralForeground1Pressed:Yt,colorNeutralForeground1Selected:Yt,colorNeutralForeground2:Et,colorNeutralForeground2Hover:Yt,colorNeutralForeground2Pressed:Yt,colorNeutralForeground2Selected:Yt,colorNeutralForeground2BrandHover:e[100],colorNeutralForeground2BrandPressed:e[90],colorNeutralForeground2BrandSelected:e[100],colorNeutralForeground3:wt,colorNeutralForeground3Hover:Et,colorNeutralForeground3Pressed:Et,colorNeutralForeground3Selected:Et,colorNeutralForeground3BrandHover:e[100],colorNeutralForeground3BrandPressed:e[90],colorNeutralForeground3BrandSelected:e[100],colorNeutralForeground4:bt,colorNeutralForegroundDisabled:ft,colorNeutralForegroundInvertedDisabled:Zt,colorBrandForegroundLink:e[100],colorBrandForegroundLinkHover:e[110],colorBrandForegroundLinkPressed:e[90],colorBrandForegroundLinkSelected:e[100],colorNeutralForeground2Link:Et,colorNeutralForeground2LinkHover:Yt,colorNeutralForeground2LinkPressed:Yt,colorNeutralForeground2LinkSelected:Yt,colorCompoundBrandForeground1:e[100],colorCompoundBrandForeground1Hover:e[110],colorCompoundBrandForeground1Pressed:e[90],colorBrandForeground1:e[100],colorBrandForeground2:e[120],colorBrandForeground2Hover:e[130],colorBrandForeground2Pressed:e[160],colorNeutralForeground1Static:rt,colorNeutralForegroundStaticInverted:Yt,colorNeutralForegroundInverted:rt,colorNeutralForegroundInvertedHover:rt,colorNeutralForegroundInvertedPressed:rt,colorNeutralForegroundInvertedSelected:rt,colorNeutralForegroundInverted2:rt,colorNeutralForegroundOnBrand:Yt,colorNeutralForegroundInvertedLink:Yt,colorNeutralForegroundInvertedLinkHover:Yt,colorNeutralForegroundInvertedLinkPressed:Yt,colorNeutralForegroundInvertedLinkSelected:Yt,colorBrandForegroundInverted:e[80],colorBrandForegroundInvertedHover:e[70],colorBrandForegroundInvertedPressed:e[60],colorBrandForegroundOnLight:e[80],colorBrandForegroundOnLightHover:e[70],colorBrandForegroundOnLightPressed:e[50],colorBrandForegroundOnLightSelected:e[60],colorNeutralBackground1:it,colorNeutralBackground1Hover:ut,colorNeutralBackground1Pressed:nt,colorNeutralBackground1Selected:st,colorNeutralBackground2:rt,colorNeutralBackground2Hover:st,colorNeutralBackground2Pressed:tt,colorNeutralBackground2Selected:at,colorNeutralBackground3:nt,colorNeutralBackground3Hover:at,colorNeutralBackground3Pressed:et,colorNeutralBackground3Selected:ot,colorNeutralBackground4:et,colorNeutralBackground4Hover:it,colorNeutralBackground4Pressed:$e,colorNeutralBackground4Selected:rt,colorNeutralBackground5:$e,colorNeutralBackground5Hover:nt,colorNeutralBackground5Pressed:Xt,colorNeutralBackground5Selected:tt,colorNeutralBackground6:at,colorNeutralBackgroundInverted:Yt,colorNeutralBackgroundStatic:ut,colorNeutralBackgroundAlpha:Kt,colorNeutralBackgroundAlpha2:Wt,colorSubtleBackground:"transparent",colorSubtleBackgroundHover:st,colorSubtleBackgroundPressed:ot,colorSubtleBackgroundSelected:at,colorSubtleBackgroundLightAlphaHover:Qt,colorSubtleBackgroundLightAlphaPressed:Jt,colorSubtleBackgroundLightAlphaSelected:"transparent",colorSubtleBackgroundInverted:"transparent",colorSubtleBackgroundInvertedHover:Ut,colorSubtleBackgroundInvertedPressed:zt,colorSubtleBackgroundInvertedSelected:Ht,colorTransparentBackground:"transparent",colorTransparentBackgroundHover:"transparent",colorTransparentBackgroundPressed:"transparent",colorTransparentBackgroundSelected:"transparent",colorNeutralBackgroundDisabled:et,colorNeutralBackgroundInvertedDisabled:Mt,colorNeutralStencil1:ht,colorNeutralStencil2:at,colorNeutralStencil1Alpha:Mt,colorNeutralStencil2Alpha:Ot,colorBackgroundOverlay:Gt,colorScrollbarOverlay:Lt,colorBrandBackground:e[70],colorBrandBackgroundHover:e[80],colorBrandBackgroundPressed:e[40],colorBrandBackgroundSelected:e[60],colorCompoundBrandBackground:e[100],colorCompoundBrandBackgroundHover:e[110],colorCompoundBrandBackgroundPressed:e[90],colorBrandBackgroundStatic:e[80],colorBrandBackground2:e[20],colorBrandBackground2Hover:e[40],colorBrandBackground2Pressed:e[10],colorBrandBackgroundInverted:Yt,colorBrandBackgroundInvertedHover:e[160],colorBrandBackgroundInvertedPressed:e[140],colorBrandBackgroundInvertedSelected:e[150],colorNeutralStrokeAccessible:wt,colorNeutralStrokeAccessibleHover:kt,colorNeutralStrokeAccessiblePressed:St,colorNeutralStrokeAccessibleSelected:e[100],colorNeutralStroke1:vt,colorNeutralStroke1Hover:yt,colorNeutralStroke1Pressed:gt,colorNeutralStroke1Selected:mt,colorNeutralStroke2:dt,colorNeutralStroke3:ut,colorNeutralStrokeSubtle:$e,colorNeutralStrokeOnBrand:it,colorNeutralStrokeOnBrand2:Yt,colorNeutralStrokeOnBrand2Hover:Yt,colorNeutralStrokeOnBrand2Pressed:Yt,colorNeutralStrokeOnBrand2Selected:Yt,colorBrandStroke1:e[100],colorBrandStroke2:e[50],colorBrandStroke2Hover:e[50],colorBrandStroke2Pressed:e[30],colorBrandStroke2Contrast:e[50],colorCompoundBrandStroke:e[90],colorCompoundBrandStrokeHover:e[100],colorCompoundBrandStrokePressed:e[80],colorNeutralStrokeDisabled:ct,colorNeutralStrokeInvertedDisabled:Zt,colorTransparentStroke:"transparent",colorTransparentStrokeInteractive:"transparent",colorTransparentStrokeDisabled:"transparent",colorNeutralStrokeAlpha:Mt,colorNeutralStrokeAlpha2:Ft,colorStrokeFocus1:Xt,colorStrokeFocus2:Yt,colorNeutralShadowAmbient:"rgba(0,0,0,0.24)",colorNeutralShadowKey:"rgba(0,0,0,0.28)",colorNeutralShadowAmbientLighter:"rgba(0,0,0,0.12)",colorNeutralShadowKeyLighter:"rgba(0,0,0,0.14)",colorNeutralShadowAmbientDarker:"rgba(0,0,0,0.40)",colorNeutralShadowKeyDarker:"rgba(0,0,0,0.48)",colorBrandShadowAmbient:"rgba(0,0,0,0.30)",colorBrandShadowKey:"rgba(0,0,0,0.25)"}}(e);return a(a(a(a(a(a(a(a(a(a(a(a(a(a(a({},wn),Sn),kn),xn),Cn),En),qn),jn),In),An),t),yn),bn),Tn(t.colorNeutralShadowAmbient,t.colorNeutralShadowKey)),Tn(t.colorBrandShadowAmbient,t.colorBrandShadowKey,"Brand"))}(Un),zn=fn.reduce((function(e,t){var n,r=t.slice(0,1).toUpperCase()+t.slice(1),o=(n={},(0,i.Z)(n,"colorPalette".concat(r,"Background1"),nn),(0,i.Z)(n,"colorPalette".concat(r,"Background2"),nn),(0,i.Z)(n,"colorPalette".concat(r,"Background3"),rn),(0,i.Z)(n,"colorPalette".concat(r,"Foreground1"),rn),(0,i.Z)(n,"colorPalette".concat(r,"Foreground2"),rn),(0,i.Z)(n,"colorPalette".concat(r,"Foreground3"),rn),(0,i.Z)(n,"colorPalette".concat(r,"BorderActive"),en),(0,i.Z)(n,"colorPalette".concat(r,"Border1"),rn),(0,i.Z)(n,"colorPalette".concat(r,"Border2"),rn),n);return Object.assign(e,o)}),{});zn.colorPaletteRedForegroundInverted=rn,zn.colorPaletteGreenForegroundInverted=rn,zn.colorPaletteYellowForegroundInverted=rn;var Vn=pn.reduce((function(e,t){var n,r=t.slice(0,1).toUpperCase()+t.slice(1),o=(n={},(0,i.Z)(n,"colorPalette".concat(r,"Background2"),nn),(0,i.Z)(n,"colorPalette".concat(r,"Foreground2"),rn),(0,i.Z)(n,"colorPalette".concat(r,"BorderActive"),en),n);return Object.assign(e,o)}),{}),Gn=a(a({},zn),Vn),Kn=Object.entries(vn).reduce((function(e,t){var n,r=(0,N.Z)(t,2),o=r[0],a=(r[1],o.slice(0,1).toUpperCase()+o.slice(1)),s=(n={},(0,i.Z)(n,"colorStatus".concat(a,"Background1"),nn),(0,i.Z)(n,"colorStatus".concat(a,"Background2"),nn),(0,i.Z)(n,"colorStatus".concat(a,"Background3"),rn),(0,i.Z)(n,"colorStatus".concat(a,"Foreground1"),rn),(0,i.Z)(n,"colorStatus".concat(a,"Foreground2"),rn),(0,i.Z)(n,"colorStatus".concat(a,"Foreground3"),rn),(0,i.Z)(n,"colorStatus".concat(a,"BorderActive"),en),(0,i.Z)(n,"colorStatus".concat(a,"ForegroundInverted"),rn),(0,i.Z)(n,"colorStatus".concat(a,"Border1"),rn),(0,i.Z)(n,"colorStatus".concat(a,"Border2"),rn),n);return Object.assign(e,s)}),{}),Wn=function(){var e={colorNeutralForeground1:rn,colorNeutralForeground1Hover:on,colorNeutralForeground1Pressed:on,colorNeutralForeground1Selected:on,colorNeutralForeground2:rn,colorNeutralForeground2Hover:on,colorNeutralForeground2Pressed:on,colorNeutralForeground2Selected:on,colorNeutralForeground2BrandHover:on,colorNeutralForeground2BrandPressed:on,colorNeutralForeground2BrandSelected:on,colorNeutralForeground3:rn,colorNeutralForeground3Hover:on,colorNeutralForeground3Pressed:on,colorNeutralForeground3Selected:on,colorNeutralForeground3BrandHover:on,colorNeutralForeground3BrandPressed:on,colorNeutralForeground3BrandSelected:on,colorNeutralForeground4:rn,colorNeutralForegroundDisabled:tn,colorNeutralForegroundInvertedDisabled:tn,colorBrandForegroundLink:$t,colorBrandForegroundLinkHover:$t,colorBrandForegroundLinkPressed:$t,colorBrandForegroundLinkSelected:$t,colorNeutralForeground2Link:$t,colorNeutralForeground2LinkHover:$t,colorNeutralForeground2LinkPressed:$t,colorNeutralForeground2LinkSelected:$t,colorCompoundBrandForeground1:en,colorCompoundBrandForeground1Hover:en,colorCompoundBrandForeground1Pressed:en,colorBrandForeground1:rn,colorBrandForeground2:rn,colorBrandForeground2Hover:rn,colorBrandForeground2Pressed:rn,colorNeutralForeground1Static:nn,colorNeutralForegroundStaticInverted:rn,colorNeutralForegroundInverted:on,colorNeutralForegroundInvertedHover:on,colorNeutralForegroundInvertedPressed:on,colorNeutralForegroundInvertedSelected:on,colorNeutralForegroundInverted2:rn,colorNeutralForegroundOnBrand:an,colorNeutralForegroundInvertedLink:$t,colorNeutralForegroundInvertedLinkHover:$t,colorNeutralForegroundInvertedLinkPressed:$t,colorNeutralForegroundInvertedLinkSelected:$t,colorBrandForegroundInverted:rn,colorBrandForegroundInvertedHover:on,colorBrandForegroundInvertedPressed:on,colorBrandForegroundOnLight:an,colorBrandForegroundOnLightHover:on,colorBrandForegroundOnLightPressed:on,colorBrandForegroundOnLightSelected:on,colorNeutralBackground1:nn,colorNeutralBackground1Hover:en,colorNeutralBackground1Pressed:en,colorNeutralBackground1Selected:en,colorNeutralBackground2:nn,colorNeutralBackground2Hover:en,colorNeutralBackground2Pressed:en,colorNeutralBackground2Selected:en,colorNeutralBackground3:nn,colorNeutralBackground3Hover:en,colorNeutralBackground3Pressed:en,colorNeutralBackground3Selected:en,colorNeutralBackground4:nn,colorNeutralBackground4Hover:en,colorNeutralBackground4Pressed:en,colorNeutralBackground4Selected:en,colorNeutralBackground5:nn,colorNeutralBackground5Hover:en,colorNeutralBackground5Pressed:en,colorNeutralBackground5Selected:en,colorNeutralBackground6:nn,colorNeutralBackgroundInverted:nn,colorNeutralBackgroundStatic:nn,colorNeutralBackgroundAlpha:nn,colorNeutralBackgroundAlpha2:nn,colorSubtleBackground:"transparent",colorSubtleBackgroundHover:en,colorSubtleBackgroundPressed:en,colorSubtleBackgroundSelected:en,colorSubtleBackgroundLightAlphaHover:en,colorSubtleBackgroundLightAlphaPressed:en,colorSubtleBackgroundLightAlphaSelected:en,colorSubtleBackgroundInverted:"transparent",colorSubtleBackgroundInvertedHover:en,colorSubtleBackgroundInvertedPressed:en,colorSubtleBackgroundInvertedSelected:en,colorTransparentBackground:"transparent",colorTransparentBackgroundHover:en,colorTransparentBackgroundPressed:en,colorTransparentBackgroundSelected:en,colorNeutralBackgroundDisabled:nn,colorNeutralBackgroundInvertedDisabled:nn,colorNeutralStencil1:rn,colorNeutralStencil2:rn,colorNeutralStencil1Alpha:rn,colorNeutralStencil2Alpha:rn,colorBackgroundOverlay:Gt,colorScrollbarOverlay:sn,colorBrandBackground:sn,colorBrandBackgroundHover:en,colorBrandBackgroundPressed:en,colorBrandBackgroundSelected:en,colorCompoundBrandBackground:en,colorCompoundBrandBackgroundHover:en,colorCompoundBrandBackgroundPressed:en,colorBrandBackgroundStatic:nn,colorBrandBackground2:nn,colorBrandBackground2Hover:nn,colorBrandBackground2Pressed:nn,colorBrandBackgroundInverted:sn,colorBrandBackgroundInvertedHover:en,colorBrandBackgroundInvertedPressed:en,colorBrandBackgroundInvertedSelected:en,colorNeutralStrokeAccessible:rn,colorNeutralStrokeAccessibleHover:en,colorNeutralStrokeAccessiblePressed:en,colorNeutralStrokeAccessibleSelected:en,colorNeutralStroke1:rn,colorNeutralStroke1Hover:en,colorNeutralStroke1Pressed:en,colorNeutralStroke1Selected:en,colorNeutralStroke2:rn,colorNeutralStroke3:rn,colorNeutralStrokeSubtle:rn,colorNeutralStrokeOnBrand:nn,colorNeutralStrokeOnBrand2:rn,colorNeutralStrokeOnBrand2Hover:rn,colorNeutralStrokeOnBrand2Pressed:rn,colorNeutralStrokeOnBrand2Selected:rn,colorBrandStroke1:rn,colorBrandStroke2:rn,colorBrandStroke2Hover:en,colorBrandStroke2Pressed:en,colorBrandStroke2Contrast:nn,colorCompoundBrandStroke:en,colorCompoundBrandStrokeHover:en,colorCompoundBrandStrokePressed:en,colorNeutralStrokeDisabled:tn,colorNeutralStrokeInvertedDisabled:tn,colorTransparentStroke:rn,colorTransparentStrokeInteractive:en,colorTransparentStrokeDisabled:tn,colorNeutralStrokeAlpha:rn,colorNeutralStrokeAlpha2:nn,colorStrokeFocus1:nn,colorStrokeFocus2:en,colorNeutralShadowAmbient:"rgba(0,0,0,0.24)",colorNeutralShadowKey:"rgba(0,0,0,0.28)",colorNeutralShadowAmbientLighter:"rgba(0,0,0,0.12)",colorNeutralShadowKeyLighter:"rgba(0,0,0,0.14)",colorNeutralShadowAmbientDarker:"rgba(0,0,0,0.40)",colorNeutralShadowKeyDarker:"rgba(0,0,0,0.48)",colorBrandShadowAmbient:"rgba(0,0,0,0.30)",colorBrandShadowKey:"rgba(0,0,0,0.25)"};return a(a(a(a(a(a(a(a(a(a(a(a(a(a(a({},wn),Sn),kn),xn),Cn),En),qn),jn),In),An),e),Gn),Kn),Tn(e.colorNeutralShadowAmbient,e.colorNeutralShadowKey)),Tn(e.colorBrandShadowAmbient,e.colorBrandShadowKey,"Brand"))}(),Jn=fn.reduce((function(e,t){var n,r=t.slice(0,1).toUpperCase()+t.slice(1),o=(n={},(0,i.Z)(n,"colorPalette".concat(r,"Background1"),ln[t].tint60),(0,i.Z)(n,"colorPalette".concat(r,"Background2"),ln[t].tint40),(0,i.Z)(n,"colorPalette".concat(r,"Background3"),ln[t].primary),(0,i.Z)(n,"colorPalette".concat(r,"Foreground1"),ln[t].shade10),(0,i.Z)(n,"colorPalette".concat(r,"Foreground2"),ln[t].shade30),(0,i.Z)(n,"colorPalette".concat(r,"Foreground3"),ln[t].primary),(0,i.Z)(n,"colorPalette".concat(r,"BorderActive"),ln[t].primary),(0,i.Z)(n,"colorPalette".concat(r,"Border1"),ln[t].tint40),(0,i.Z)(n,"colorPalette".concat(r,"Border2"),ln[t].primary),n);return Object.assign(e,o)}),{});Jn.colorPaletteYellowForeground1=ln.yellow.shade30,Jn.colorPaletteRedForegroundInverted=ln.red.tint20,Jn.colorPaletteGreenForegroundInverted=ln.green.tint20,Jn.colorPaletteYellowForegroundInverted=ln.yellow.tint40;var Qn=pn.reduce((function(e,t){var n,r=t.slice(0,1).toUpperCase()+t.slice(1),o=(n={},(0,i.Z)(n,"colorPalette".concat(r,"Background2"),dn[t].tint40),(0,i.Z)(n,"colorPalette".concat(r,"Foreground2"),dn[t].shade30),(0,i.Z)(n,"colorPalette".concat(r,"BorderActive"),dn[t].primary),n);return Object.assign(e,o)}),{}),Yn=a(a({},Jn),Qn),Xn=Object.entries(vn).reduce((function(e,t){var n,r=(0,N.Z)(t,2),o=r[0],a=r[1],s=o.slice(0,1).toUpperCase()+o.slice(1),u=(n={},(0,i.Z)(n,"colorStatus".concat(s,"Background1"),hn[a].tint60),(0,i.Z)(n,"colorStatus".concat(s,"Background2"),hn[a].tint40),(0,i.Z)(n,"colorStatus".concat(s,"Background3"),hn[a].primary),(0,i.Z)(n,"colorStatus".concat(s,"Foreground1"),hn[a].shade10),(0,i.Z)(n,"colorStatus".concat(s,"Foreground2"),hn[a].shade30),(0,i.Z)(n,"colorStatus".concat(s,"Foreground3"),hn[a].primary),(0,i.Z)(n,"colorStatus".concat(s,"ForegroundInverted"),hn[a].tint30),(0,i.Z)(n,"colorStatus".concat(s,"BorderActive"),hn[a].primary),(0,i.Z)(n,"colorStatus".concat(s,"Border1"),hn[a].tint40),(0,i.Z)(n,"colorStatus".concat(s,"Border2"),hn[a].primary),n);return Object.assign(e,u)}),{});Xn.colorStatusWarningForeground1=hn[vn.warning].shade20,Xn.colorStatusWarningForeground3=hn[vn.warning].shade20,Xn.colorStatusWarningBorder2=hn[vn.warning].shade20;var $n,er=function(e){var t=function(e){return{colorNeutralForeground1:rt,colorNeutralForeground1Hover:rt,colorNeutralForeground1Pressed:rt,colorNeutralForeground1Selected:rt,colorNeutralForeground2:ct,colorNeutralForeground2Hover:rt,colorNeutralForeground2Pressed:rt,colorNeutralForeground2Selected:rt,colorNeutralForeground2BrandHover:e[80],colorNeutralForeground2BrandPressed:e[70],colorNeutralForeground2BrandSelected:e[80],colorNeutralForeground3:pt,colorNeutralForeground3Hover:ct,colorNeutralForeground3Pressed:ct,colorNeutralForeground3Selected:ct,colorNeutralForeground3BrandHover:e[80],colorNeutralForeground3BrandPressed:e[70],colorNeutralForeground3BrandSelected:e[80],colorNeutralForeground4:mt,colorNeutralForegroundDisabled:kt,colorNeutralForegroundInvertedDisabled:Zt,colorBrandForegroundLink:e[70],colorBrandForegroundLinkHover:e[60],colorBrandForegroundLinkPressed:e[40],colorBrandForegroundLinkSelected:e[70],colorNeutralForeground2Link:ct,colorNeutralForeground2LinkHover:rt,colorNeutralForeground2LinkPressed:rt,colorNeutralForeground2LinkSelected:rt,colorCompoundBrandForeground1:e[80],colorCompoundBrandForeground1Hover:e[70],colorCompoundBrandForeground1Pressed:e[60],colorBrandForeground1:e[80],colorBrandForeground2:e[70],colorBrandForeground2Hover:e[60],colorBrandForeground2Pressed:e[30],colorNeutralForeground1Static:rt,colorNeutralForegroundStaticInverted:Yt,colorNeutralForegroundInverted:Yt,colorNeutralForegroundInvertedHover:Yt,colorNeutralForegroundInvertedPressed:Yt,colorNeutralForegroundInvertedSelected:Yt,colorNeutralForegroundInverted2:Yt,colorNeutralForegroundOnBrand:Yt,colorNeutralForegroundInvertedLink:Yt,colorNeutralForegroundInvertedLinkHover:Yt,colorNeutralForegroundInvertedLinkPressed:Yt,colorNeutralForegroundInvertedLinkSelected:Yt,colorBrandForegroundInverted:e[100],colorBrandForegroundInvertedHover:e[110],colorBrandForegroundInvertedPressed:e[100],colorBrandForegroundOnLight:e[80],colorBrandForegroundOnLightHover:e[70],colorBrandForegroundOnLightPressed:e[50],colorBrandForegroundOnLightSelected:e[60],colorNeutralBackground1:Yt,colorNeutralBackground1Hover:Pt,colorNeutralBackground1Pressed:It,colorNeutralBackground1Selected:Rt,colorNeutralBackground2:Nt,colorNeutralBackground2Hover:_t,colorNeutralBackground2Pressed:Tt,colorNeutralBackground2Selected:At,colorNeutralBackground3:Pt,colorNeutralBackground3Hover:Rt,colorNeutralBackground3Pressed:Et,colorNeutralBackground3Selected:It,colorNeutralBackground4:_t,colorNeutralBackground4Hover:Nt,colorNeutralBackground4Pressed:Pt,colorNeutralBackground4Selected:Yt,colorNeutralBackground5:Rt,colorNeutralBackground5Hover:Pt,colorNeutralBackground5Pressed:_t,colorNeutralBackground5Selected:Nt,colorNeutralBackground6:At,colorNeutralBackgroundInverted:it,colorNeutralBackgroundStatic:at,colorNeutralBackgroundAlpha:Dt,colorNeutralBackgroundAlpha2:qt,colorSubtleBackground:"transparent",colorSubtleBackgroundHover:Pt,colorSubtleBackgroundPressed:It,colorSubtleBackgroundSelected:Rt,colorSubtleBackgroundLightAlphaHover:Bt,colorSubtleBackgroundLightAlphaPressed:Dt,colorSubtleBackgroundLightAlphaSelected:"transparent",colorSubtleBackgroundInverted:"transparent",colorSubtleBackgroundInvertedHover:Ut,colorSubtleBackgroundInvertedPressed:zt,colorSubtleBackgroundInvertedSelected:Ht,colorTransparentBackground:"transparent",colorTransparentBackgroundHover:"transparent",colorTransparentBackgroundPressed:"transparent",colorTransparentBackgroundSelected:"transparent",colorNeutralBackgroundDisabled:_t,colorNeutralBackgroundInvertedDisabled:Mt,colorNeutralStencil1:At,colorNeutralStencil2:Nt,colorNeutralStencil1Alpha:Ut,colorNeutralStencil2Alpha:jt,colorBackgroundOverlay:Vt,colorScrollbarOverlay:Gt,colorBrandBackground:e[80],colorBrandBackgroundHover:e[70],colorBrandBackgroundPressed:e[40],colorBrandBackgroundSelected:e[60],colorCompoundBrandBackground:e[80],colorCompoundBrandBackgroundHover:e[70],colorCompoundBrandBackgroundPressed:e[60],colorBrandBackgroundStatic:e[80],colorBrandBackground2:e[160],colorBrandBackground2Hover:e[150],colorBrandBackground2Pressed:e[130],colorBrandBackgroundInverted:Yt,colorBrandBackgroundInvertedHover:e[160],colorBrandBackgroundInvertedPressed:e[140],colorBrandBackgroundInvertedSelected:e[150],colorNeutralStrokeAccessible:pt,colorNeutralStrokeAccessibleHover:ht,colorNeutralStrokeAccessiblePressed:lt,colorNeutralStrokeAccessibleSelected:e[80],colorNeutralStroke1:xt,colorNeutralStroke1Hover:Ct,colorNeutralStroke1Pressed:St,colorNeutralStroke1Selected:kt,colorNeutralStroke2:It,colorNeutralStroke3:_t,colorNeutralStrokeSubtle:It,colorNeutralStrokeOnBrand:Yt,colorNeutralStrokeOnBrand2:Yt,colorNeutralStrokeOnBrand2Hover:Yt,colorNeutralStrokeOnBrand2Pressed:Yt,colorNeutralStrokeOnBrand2Selected:Yt,colorBrandStroke1:e[80],colorBrandStroke2:e[140],colorBrandStroke2Hover:e[120],colorBrandStroke2Pressed:e[80],colorBrandStroke2Contrast:e[140],colorCompoundBrandStroke:e[80],colorCompoundBrandStrokeHover:e[70],colorCompoundBrandStrokePressed:e[60],colorNeutralStrokeDisabled:It,colorNeutralStrokeInvertedDisabled:Zt,colorTransparentStroke:"transparent",colorTransparentStrokeInteractive:"transparent",colorTransparentStrokeDisabled:"transparent",colorNeutralStrokeAlpha:jt,colorNeutralStrokeAlpha2:Ft,colorStrokeFocus1:Yt,colorStrokeFocus2:Xt,colorNeutralShadowAmbient:"rgba(0,0,0,0.12)",colorNeutralShadowKey:"rgba(0,0,0,0.14)",colorNeutralShadowAmbientLighter:"rgba(0,0,0,0.06)",colorNeutralShadowKeyLighter:"rgba(0,0,0,0.07)",colorNeutralShadowAmbientDarker:"rgba(0,0,0,0.20)",colorNeutralShadowKeyDarker:"rgba(0,0,0,0.24)",colorBrandShadowAmbient:"rgba(0,0,0,0.30)",colorBrandShadowKey:"rgba(0,0,0,0.25)"}}(e);return a(a(a(a(a(a(a(a(a(a(a(a(a(a(a({},wn),Sn),kn),xn),Cn),En),qn),jn),In),An),t),Yn),Xn),Tn(t.colorNeutralShadowAmbient,t.colorNeutralShadowKey)),Tn(t.colorBrandShadowAmbient,t.colorBrandShadowKey,"Brand"))}(Un),tr="var(--colorNeutralBackground3)",nr=n(60136),rr=n(29388),ir=n(28664),or=n(83878),ar=n(59199),sr=n(40181),ur=n(25267);function cr(){return cr=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},cr.apply(this,arguments)}!function(e){e.Pop="POP",e.Push="PUSH",e.Replace="REPLACE"}($n||($n={}));var lr,dr="popstate";function hr(e,t){if(!1===e||null===e||"undefined"===typeof e)throw new Error(t)}function fr(e,t){if(!e){"undefined"!==typeof console&&console.warn(t);try{throw new Error(t)}catch(Oi){}}}function pr(e,t){return{usr:e.state,key:e.key,idx:t}}function vr(e,t,n,r){return void 0===n&&(n=null),cr({pathname:"string"===typeof e?e:e.pathname,search:"",hash:""},"string"===typeof t?mr(t):t,{state:n,key:t&&t.key||r||Math.random().toString(36).substr(2,8)})}function gr(e){var t=e.pathname,n=void 0===t?"/":t,r=e.search,i=void 0===r?"":r,o=e.hash,a=void 0===o?"":o;return i&&"?"!==i&&(n+="?"===i.charAt(0)?i:"?"+i),a&&"#"!==a&&(n+="#"===a.charAt(0)?a:"#"+a),n}function mr(e){var t={};if(e){var n=e.indexOf("#");n>=0&&(t.hash=e.substr(n),e=e.substr(0,n));var r=e.indexOf("?");r>=0&&(t.search=e.substr(r),e=e.substr(0,r)),e&&(t.pathname=e)}return t}function yr(e,t,n,r){void 0===r&&(r={});var i=r,o=i.window,a=void 0===o?document.defaultView:o,s=i.v5Compat,u=void 0!==s&&s,c=a.history,l=$n.Pop,d=null,h=f();function f(){return(c.state||{idx:null}).idx}function p(){l=$n.Pop;var e=f(),t=null==e?null:e-h;h=e,d&&d({action:l,location:g.location,delta:t})}function v(e){var t="null"!==a.location.origin?a.location.origin:a.location.href,n="string"===typeof e?e:gr(e);return hr(t,"No window.location.(origin|href) available to create URL for href: "+n),new URL(n,t)}null==h&&(h=0,c.replaceState(cr({},c.state,{idx:h}),""));var g={get action(){return l},get location(){return e(a,c)},listen:function(e){if(d)throw new Error("A history only accepts one active listener");return a.addEventListener(dr,p),d=e,function(){a.removeEventListener(dr,p),d=null}},createHref:function(e){return t(a,e)},createURL:v,encodeLocation:function(e){var t=v(e);return{pathname:t.pathname,search:t.search,hash:t.hash}},push:function(e,t){l=$n.Push;var r=vr(g.location,e,t);n&&n(r,e);var i=pr(r,h=f()+1),o=g.createHref(r);try{c.pushState(i,"",o)}catch(s){if(s instanceof DOMException&&"DataCloneError"===s.name)throw s;a.location.assign(o)}u&&d&&d({action:l,location:g.location,delta:1})},replace:function(e,t){l=$n.Replace;var r=vr(g.location,e,t);n&&n(r,e);var i=pr(r,h=f()),o=g.createHref(r);c.replaceState(i,"",o),u&&d&&d({action:l,location:g.location,delta:0})},go:function(e){return c.go(e)}};return g}!function(e){e.data="data",e.deferred="deferred",e.redirect="redirect",e.error="error"}(lr||(lr={}));new Set(["lazy","caseSensitive","path","id","index","children"]);function br(e,t,n){void 0===n&&(n="/");var r=Or(("string"===typeof t?mr(t):t).pathname||"/",n);if(null==r)return null;var i=wr(e);!function(e){e.sort((function(e,t){return e.score!==t.score?t.score-e.score:function(e,t){var n=e.length===t.length&&e.slice(0,-1).every((function(e,n){return e===t[n]}));return n?e[e.length-1]-t[t.length-1]:0}(e.routesMeta.map((function(e){return e.childrenIndex})),t.routesMeta.map((function(e){return e.childrenIndex})))}))}(i);for(var o=null,a=0;null==o&&a<i.length;++a)o=_r(i[a],Nr(r));return o}function wr(e,t,n,r){void 0===t&&(t=[]),void 0===n&&(n=[]),void 0===r&&(r="");var i=function(e,i,o){var a={relativePath:void 0===o?e.path||"":o,caseSensitive:!0===e.caseSensitive,childrenIndex:i,route:e};a.relativePath.startsWith("/")&&(hr(a.relativePath.startsWith(r),'Absolute route path "'+a.relativePath+'" nested under path "'+r+'" is not valid. An absolute child route path must start with the combined path of all its parent routes.'),a.relativePath=a.relativePath.slice(r.length));var s=Dr([r,a.relativePath]),u=n.concat(a);e.children&&e.children.length>0&&(hr(!0!==e.index,'Index routes must not have child routes. Please remove all child routes from route path "'+s+'".'),wr(e.children,t,u,s)),(null!=e.path||e.index)&&t.push({path:s,score:Rr(s,e.index),routesMeta:u})};return e.forEach((function(e,t){var n;if(""!==e.path&&null!=(n=e.path)&&n.includes("?")){var r,o=(0,pe.Z)(Sr(e.path));try{for(o.s();!(r=o.n()).done;){var a=r.value;i(e,t,a)}}catch(s){o.e(s)}finally{o.f()}}else i(e,t)})),t}function Sr(e){var t=e.split("/");if(0===t.length)return[];var n,r=(n=t,(0,or.Z)(n)||(0,ar.Z)(n)||(0,sr.Z)(n)||(0,ur.Z)()),i=r[0],o=r.slice(1),a=i.endsWith("?"),s=i.replace(/\?$/,"");if(0===o.length)return a?[s,""]:[s];var u=Sr(o.join("/")),c=[];return c.push.apply(c,(0,l.Z)(u.map((function(e){return""===e?s:[s,e].join("/")})))),a&&c.push.apply(c,(0,l.Z)(u)),c.map((function(t){return e.startsWith("/")&&""===t?"/":t}))}var kr=/^:\w+$/,Cr=3,xr=2,Er=1,Tr=10,Ir=-2,Ar=function(e){return"*"===e};function Rr(e,t){var n=e.split("/"),r=n.length;return n.some(Ar)&&(r+=Ir),t&&(r+=xr),n.filter((function(e){return!Ar(e)})).reduce((function(e,t){return e+(kr.test(t)?Cr:""===t?Er:Tr)}),r)}function _r(e,t){for(var n=e.routesMeta,r={},i="/",o=[],a=0;a<n.length;++a){var s=n[a],u=a===n.length-1,c="/"===i?t:t.slice(i.length)||"/",l=Pr({path:s.relativePath,caseSensitive:s.caseSensitive,end:u},c);if(!l)return null;Object.assign(r,l.params);var d=s.route;o.push({params:r,pathname:Dr([i,l.pathname]),pathnameBase:Lr(Dr([i,l.pathnameBase])),route:d}),"/"!==l.pathnameBase&&(i=Dr([i,l.pathnameBase]))}return o}function Pr(e,t){"string"===typeof e&&(e={path:e,caseSensitive:!1,end:!0});var n=function(e,t,n){void 0===t&&(t=!1);void 0===n&&(n=!0);fr("*"===e||!e.endsWith("*")||e.endsWith("/*"),'Route path "'+e+'" will be treated as if it were "'+e.replace(/\*$/,"/*")+'" because the `*` character must always follow a `/` in the pattern. To get rid of this warning, please change the route path to "'+e.replace(/\*$/,"/*")+'".');var r=[],i="^"+e.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^$?{}|()[\]]/g,"\\$&").replace(/\/:(\w+)/g,(function(e,t){return r.push(t),"/([^\\/]+)"}));e.endsWith("*")?(r.push("*"),i+="*"===e||"/*"===e?"(.*)$":"(?:\\/(.+)|\\/*)$"):n?i+="\\/*$":""!==e&&"/"!==e&&(i+="(?:(?=\\/|$))");var o=new RegExp(i,t?void 0:"i");return[o,r]}(e.path,e.caseSensitive,e.end),r=(0,N.Z)(n,2),i=r[0],o=r[1],a=t.match(i);if(!a)return null;var s=a[0],u=s.replace(/(.)\/+$/,"$1"),c=a.slice(1);return{params:o.reduce((function(e,t,n){if("*"===t){var r=c[n]||"";u=s.slice(0,s.length-r.length).replace(/(.)\/+$/,"$1")}return e[t]=function(e,t){try{return decodeURIComponent(e)}catch(n){return fr(!1,'The value for the URL param "'+t+'" will not be decoded because the string "'+e+'" is a malformed URL segment. This is probably due to a bad percent encoding ('+n+")."),e}}(c[n]||"",t),e}),{}),pathname:s,pathnameBase:u,pattern:e}}function Nr(e){try{return decodeURI(e)}catch(t){return fr(!1,'The URL path "'+e+'" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent encoding ('+t+")."),e}}function Or(e,t){if("/"===t)return e;if(!e.toLowerCase().startsWith(t.toLowerCase()))return null;var n=t.endsWith("/")?t.length-1:t.length,r=e.charAt(n);return r&&"/"!==r?null:e.slice(n)||"/"}function Mr(e,t,n,r){return"Cannot include a '"+e+"' character in a manually specified `to."+t+"` field ["+JSON.stringify(r)+"].  Please separate it out to the `to."+n+'` field. Alternatively you may provide the full path as a string in <Link to="..."> and the router will parse it for you.'}function Fr(e){return e.filter((function(e,t){return 0===t||e.route.path&&e.route.path.length>0}))}function Zr(e,t,n,r){var i;void 0===r&&(r=!1),"string"===typeof e?i=mr(e):(hr(!(i=cr({},e)).pathname||!i.pathname.includes("?"),Mr("?","pathname","search",i)),hr(!i.pathname||!i.pathname.includes("#"),Mr("#","pathname","hash",i)),hr(!i.search||!i.search.includes("#"),Mr("#","search","hash",i)));var o,a=""===e||""===i.pathname,s=a?"/":i.pathname;if(r||null==s)o=n;else{var u=t.length-1;if(s.startsWith("..")){for(var c=s.split("/");".."===c[0];)c.shift(),u-=1;i.pathname=c.join("/")}o=u>=0?t[u]:"/"}var l=function(e,t){void 0===t&&(t="/");var n="string"===typeof e?mr(e):e,r=n.pathname,i=n.search,o=void 0===i?"":i,a=n.hash,s=void 0===a?"":a,u=r?r.startsWith("/")?r:function(e,t){var n=t.replace(/\/+$/,"").split("/");return e.split("/").forEach((function(e){".."===e?n.length>1&&n.pop():"."!==e&&n.push(e)})),n.length>1?n.join("/"):"/"}(r,t):t;return{pathname:u,search:Br(o),hash:qr(s)}}(i,o),d=s&&"/"!==s&&s.endsWith("/"),h=(a||"."===s)&&n.endsWith("/");return l.pathname.endsWith("/")||!d&&!h||(l.pathname+="/"),l}var Dr=function(e){return e.join("/").replace(/\/\/+/g,"/")},Lr=function(e){return e.replace(/\/+$/,"").replace(/^\/*/,"/")},Br=function(e){return e&&"?"!==e?e.startsWith("?")?e:"?"+e:""},qr=function(e){return e&&"#"!==e?e.startsWith("#")?e:"#"+e:""},jr=function(e){(0,nr.Z)(n,e);var t=(0,rr.Z)(n);function n(){return(0,Y.Z)(this,n),t.apply(this,arguments)}return(0,X.Z)(n)}((0,ir.Z)(Error));function Ur(e){return null!=e&&"number"===typeof e.status&&"string"===typeof e.statusText&&"boolean"===typeof e.internal&&"data"in e}var Hr=["post","put","patch","delete"],zr=(new Set(Hr),["get"].concat(Hr));new Set(zr),new Set([301,302,303,307,308]),new Set([307,308]);Symbol("deferred");function Vr(){return Vr=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},Vr.apply(this,arguments)}var Gr=e.createContext(null);var Kr=e.createContext(null);var Wr=e.createContext(null);var Jr=e.createContext(null);var Qr=e.createContext(null);var Yr=e.createContext({outlet:null,matches:[],isDataRoute:!1});var Xr=e.createContext(null);function $r(){return null!=e.useContext(Qr)}function ei(){return $r()||hr(!1),e.useContext(Qr).location}function ti(t){e.useContext(Jr).static||e.useLayoutEffect(t)}function ni(){return e.useContext(Yr).isDataRoute?function(){var t=di(ci.UseNavigateStable).router,n=fi(li.UseNavigateStable),r=e.useRef(!1);ti((function(){r.current=!0}));var i=e.useCallback((function(e,i){void 0===i&&(i={}),r.current&&("number"===typeof e?t.navigate(e):t.navigate(e,Vr({fromRouteId:n},i)))}),[t,n]);return i}():function(){$r()||hr(!1);var t=e.useContext(Gr),n=e.useContext(Jr),r=n.basename,i=n.navigator,o=e.useContext(Yr).matches,a=ei().pathname,s=JSON.stringify(Fr(o).map((function(e){return e.pathnameBase}))),u=e.useRef(!1);return ti((function(){u.current=!0})),e.useCallback((function(e,n){if(void 0===n&&(n={}),u.current)if("number"!==typeof e){var o=Zr(e,JSON.parse(s),a,"path"===n.relative);null==t&&"/"!==r&&(o.pathname="/"===o.pathname?r:Dr([r,o.pathname])),(n.replace?i.replace:i.push)(o,n.state,n)}else i.go(e)}),[r,i,s,a,t])}()}function ri(t,n,r){$r()||hr(!1);var i,o=e.useContext(Jr).navigator,a=e.useContext(Yr).matches,s=a[a.length-1],u=s?s.params:{},c=(s&&s.pathname,s?s.pathnameBase:"/"),l=(s&&s.route,ei());if(n){var d,h="string"===typeof n?mr(n):n;"/"===c||(null==(d=h.pathname)?void 0:d.startsWith(c))||hr(!1),i=h}else i=l;var f=i.pathname||"/",p=br(t,{pathname:"/"===c?f:f.slice(c.length)||"/"});var v=ui(p&&p.map((function(e){return Object.assign({},e,{params:Object.assign({},u,e.params),pathname:Dr([c,o.encodeLocation?o.encodeLocation(e.pathname).pathname:e.pathname]),pathnameBase:"/"===e.pathnameBase?c:Dr([c,o.encodeLocation?o.encodeLocation(e.pathnameBase).pathname:e.pathnameBase])})})),a,r);return n&&v?e.createElement(Qr.Provider,{value:{location:Vr({pathname:"/",search:"",hash:"",state:null,key:"default"},i),navigationType:$n.Pop}},v):v}function ii(){var t=function(){var t,n=e.useContext(Xr),r=hi(li.UseRouteError),i=fi(li.UseRouteError);if(n)return n;return null==(t=r.errors)?void 0:t[i]}(),n=Ur(t)?t.status+" "+t.statusText:t instanceof Error?t.message:JSON.stringify(t),r=t instanceof Error?t.stack:null,i="rgba(200,200,200, 0.5)",o={padding:"0.5rem",backgroundColor:i};return e.createElement(e.Fragment,null,e.createElement("h2",null,"Unexpected Application Error!"),e.createElement("h3",{style:{fontStyle:"italic"}},n),r?e.createElement("pre",{style:o},r):null,null)}var oi=e.createElement(ii,null),ai=function(t){(0,nr.Z)(r,t);var n=(0,rr.Z)(r);function r(e){var t;return(0,Y.Z)(this,r),(t=n.call(this,e)).state={location:e.location,revalidation:e.revalidation,error:e.error},t}return(0,X.Z)(r,[{key:"componentDidCatch",value:function(e,t){console.error("React Router caught the following error during render",e,t)}},{key:"render",value:function(){return this.state.error?e.createElement(Yr.Provider,{value:this.props.routeContext},e.createElement(Xr.Provider,{value:this.state.error,children:this.props.component})):this.props.children}}],[{key:"getDerivedStateFromError",value:function(e){return{error:e}}},{key:"getDerivedStateFromProps",value:function(e,t){return t.location!==e.location||"idle"!==t.revalidation&&"idle"===e.revalidation?{error:e.error,location:e.location,revalidation:e.revalidation}:{error:e.error||t.error,location:t.location,revalidation:e.revalidation||t.revalidation}}}]),r}(e.Component);function si(t){var n=t.routeContext,r=t.match,i=t.children,o=e.useContext(Gr);return o&&o.static&&o.staticContext&&(r.route.errorElement||r.route.ErrorBoundary)&&(o.staticContext._deepestRenderedBoundaryId=r.route.id),e.createElement(Yr.Provider,{value:n},i)}function ui(t,n,r){var i;if(void 0===n&&(n=[]),void 0===r&&(r=null),null==t){var o;if(null==(o=r)||!o.errors)return null;t=r.matches}var a=t,s=null==(i=r)?void 0:i.errors;if(null!=s){var u=a.findIndex((function(e){return e.route.id&&(null==s?void 0:s[e.route.id])}));u>=0||hr(!1),a=a.slice(0,Math.min(a.length,u+1))}return a.reduceRight((function(t,i,o){var u=i.route.id?null==s?void 0:s[i.route.id]:null,c=null;r&&(c=i.route.errorElement||oi);var l=n.concat(a.slice(0,o+1)),d=function(){var n;return n=u?c:i.route.Component?e.createElement(i.route.Component,null):i.route.element?i.route.element:t,e.createElement(si,{match:i,routeContext:{outlet:t,matches:l,isDataRoute:null!=r},children:n})};return r&&(i.route.ErrorBoundary||i.route.errorElement||0===o)?e.createElement(ai,{location:r.location,revalidation:r.revalidation,component:c,error:u,children:d(),routeContext:{outlet:null,matches:l,isDataRoute:!0}}):d()}),null)}var ci=function(e){return e.UseBlocker="useBlocker",e.UseRevalidator="useRevalidator",e.UseNavigateStable="useNavigate",e}(ci||{}),li=function(e){return e.UseBlocker="useBlocker",e.UseLoaderData="useLoaderData",e.UseActionData="useActionData",e.UseRouteError="useRouteError",e.UseNavigation="useNavigation",e.UseRouteLoaderData="useRouteLoaderData",e.UseMatches="useMatches",e.UseRevalidator="useRevalidator",e.UseNavigateStable="useNavigate",e.UseRouteId="useRouteId",e}(li||{});function di(t){var n=e.useContext(Gr);return n||hr(!1),n}function hi(t){var n=e.useContext(Kr);return n||hr(!1),n}function fi(t){var n=function(t){var n=e.useContext(Yr);return n||hr(!1),n}(),r=n.matches[n.matches.length-1];return r.route.id||hr(!1),r.route.id}t.startTransition;function pi(t){var n=t.to,r=t.replace,i=t.state,o=t.relative;$r()||hr(!1);var a=e.useContext(Yr).matches,s=ei().pathname,u=ni(),c=Zr(n,Fr(a).map((function(e){return e.pathnameBase})),s,"path"===o),l=JSON.stringify(c);return e.useEffect((function(){return u(JSON.parse(l),{replace:r,state:i,relative:o})}),[u,l,o,r,i]),null}function vi(e){hr(!1)}function gi(t){var n=t.basename,r=void 0===n?"/":n,i=t.children,o=void 0===i?null:i,a=t.location,s=t.navigationType,u=void 0===s?$n.Pop:s,c=t.navigator,l=t.static,d=void 0!==l&&l;$r()&&hr(!1);var h=r.replace(/^\/*/,"/"),f=e.useMemo((function(){return{basename:h,navigator:c,static:d}}),[h,c,d]);"string"===typeof a&&(a=mr(a));var p=a,v=p.pathname,g=void 0===v?"/":v,m=p.search,y=void 0===m?"":m,b=p.hash,w=void 0===b?"":b,S=p.state,k=void 0===S?null:S,C=p.key,x=void 0===C?"default":C,E=e.useMemo((function(){var e=Or(g,h);return null==e?null:{location:{pathname:e,search:y,hash:w,state:k,key:x},navigationType:u}}),[h,g,y,w,k,x,u]);return null==E?null:e.createElement(Jr.Provider,{value:f},e.createElement(Qr.Provider,{children:o,value:E}))}function mi(e){var t=e.children,n=e.location;return ri(wi(t),n)}var yi=function(e){return e[e.pending=0]="pending",e[e.success=1]="success",e[e.error=2]="error",e}(yi||{}),bi=new Promise((function(){}));e.Component;function wi(t,n){void 0===n&&(n=[]);var r=[];return e.Children.forEach(t,(function(t,i){if(e.isValidElement(t)){var o=[].concat((0,l.Z)(n),[i]);if(t.type!==e.Fragment){t.type!==vi&&hr(!1),t.props.index&&t.props.children&&hr(!1);var a={id:t.props.id||o.join("-"),caseSensitive:t.props.caseSensitive,element:t.props.element,Component:t.props.Component,index:t.props.index,path:t.props.path,loader:t.props.loader,action:t.props.action,errorElement:t.props.errorElement,ErrorBoundary:t.props.ErrorBoundary,hasErrorBoundary:null!=t.props.ErrorBoundary||null!=t.props.errorElement,shouldRevalidate:t.props.shouldRevalidate,handle:t.props.handle,lazy:t.props.lazy};t.props.children&&(a.children=wi(t.props.children,o)),r.push(a)}else r.push.apply(r,wi(t.props.children,o))}})),r}new Set(["application/x-www-form-urlencoded","multipart/form-data","text/plain"]);var Si=t.startTransition;function ki(t){var n,r=t.basename,i=t.children,o=t.future,a=t.window,s=e.useRef();null==s.current&&(s.current=(void 0===(n={window:a,v5Compat:!0})&&(n={}),yr((function(e,t){var n=mr(e.location.hash.substr(1)),r=n.pathname,i=void 0===r?"/":r,o=n.search,a=void 0===o?"":o,s=n.hash,u=void 0===s?"":s;return i.startsWith("/")||i.startsWith(".")||(i="/"+i),vr("",{pathname:i,search:a,hash:u},t.state&&t.state.usr||null,t.state&&t.state.key||"default")}),(function(e,t){var n=e.document.querySelector("base"),r="";if(n&&n.getAttribute("href")){var i=e.location.href,o=i.indexOf("#");r=-1===o?i:i.slice(0,o)}return r+"#"+("string"===typeof t?t:gr(t))}),(function(e,t){fr("/"===e.pathname.charAt(0),"relative pathnames are not supported in hash history.push("+JSON.stringify(t)+")")}),n)));var u=s.current,c=e.useState({action:u.action,location:u.location}),l=(0,N.Z)(c,2),d=l[0],h=l[1],f=(o||{}).v7_startTransition,p=e.useCallback((function(e){f&&Si?Si((function(){return h(e)})):h(e)}),[h,f]);return e.useLayoutEffect((function(){return u.listen(p)}),[u,p]),e.createElement(gi,{basename:r,children:i,location:d.location,navigationType:d.action,navigator:u})}"undefined"!==typeof window&&"undefined"!==typeof window.document&&window.document.createElement;var Ci,xi;(function(e){e.UseScrollRestoration="useScrollRestoration",e.UseSubmit="useSubmit",e.UseSubmitFetcher="useSubmitFetcher",e.UseFetcher="useFetcher"})(Ci||(Ci={})),function(e){e.UseFetchers="useFetchers",e.UseScrollRestoration="useScrollRestoration"}(xi||(xi={}));var Ei=n(9069);var Ti=function(){return Ti=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},Ti.apply(this,arguments)};function Ii(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{u(r.next(e))}catch(Oi){o(Oi)}}function s(e){try{u(r.throw(e))}catch(Oi){o(Oi)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}u((r=r.apply(e,t||[])).next())}))}function Ai(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"===typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(s){return function(u){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;o&&(o=0,s[0]&&(a=0)),a;)try{if(n=1,r&&(i=2&s[0]?r.return:s[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,s[1])).done)return i;switch(r=0,i&&(s=[2&s[0],i.value]),s[0]){case 0:case 1:i=s;break;case 4:return a.label++,{value:s[1],done:!1};case 5:a.label++,r=s[1],s=[0];continue;case 7:s=a.ops.pop(),a.trys.pop();continue;default:if(!(i=(i=a.trys).length>0&&i[i.length-1])&&(6===s[0]||2===s[0])){a=0;continue}if(3===s[0]&&(!i||s[1]>i[0]&&s[1]<i[3])){a.label=s[1];break}if(6===s[0]&&a.label<i[1]){a.label=i[1],i=s;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(s);break}i[2]&&a.ops.pop(),a.trys.pop();continue}s=t.call(e,a)}catch(Oi){s=[6,Oi],r=0}finally{n=i=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,u])}}}Object.create;Object.create;"function"===typeof SuppressedError&&SuppressedError;var Ri=n(74165),_i=n(15861),Pi=n(82963),Ni=n(97326);function Oi(e){this.message=e}Oi.prototype=new Error,Oi.prototype.name="InvalidCharacterError";var Mi="undefined"!=typeof window&&window.atob&&window.atob.bind(window)||function(e){var t=String(e).replace(/=+$/,"");if(t.length%4==1)throw new Oi("'atob' failed: The string to be decoded is not correctly encoded.");for(var n,r,i=0,o=0,a="";r=t.charAt(o++);~r&&(n=i%4?64*n+r:r,i++%4)?a+=String.fromCharCode(255&n>>(-2*i&6)):0)r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(r);return a};function Fi(e){var t=e.replace(/-/g,"+").replace(/_/g,"/");switch(t.length%4){case 0:break;case 2:t+="==";break;case 3:t+="=";break;default:throw"Illegal base64url string!"}try{return function(e){return decodeURIComponent(Mi(e).replace(/(.)/g,(function(e,t){var n=t.charCodeAt(0).toString(16).toUpperCase();return n.length<2&&(n="0"+n),"%"+n})))}(t)}catch(e){return Mi(t)}}function Zi(e){this.message=e}Zi.prototype=new Error,Zi.prototype.name="InvalidTokenError";var Di=function(e,t){if("string"!=typeof e)throw new Zi("Invalid token specified");var n=!0===(t=t||{}).header?0:1;try{return JSON.parse(Fi(e.split(".")[n]))}catch(e){throw new Zi("Invalid token specified: "+e.message)}},Li=function(e,t){return Li=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},Li(e,t)};function Bi(e,t){function n(){this.constructor=e}Li(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}var qi,ji,Ui=function(){return Ui=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},Ui.apply(this,arguments)};function Hi(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"===typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n}function zi(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{u(r.next(e))}catch(Oi){o(Oi)}}function s(e){try{u(r.throw(e))}catch(Oi){o(Oi)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}u((r=r.apply(e,t||[])).next())}))}function Vi(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"===typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=(i=a.trys).length>0&&i[i.length-1])&&(6===o[0]||2===o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(Oi){o=[6,Oi],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}}function Gi(e,t){var n="function"===typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,i,o=n.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(r=o.next()).done;)a.push(r.value)}catch(s){i={error:s}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}return a}function Ki(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(Gi(arguments[t]));return e}!function(e){e.AcquireTokenByCode="acquireTokenByCode",e.AcquireTokenByRefreshToken="acquireTokenByRefreshToken",e.AcquireTokenSilent="acquireTokenSilent",e.AcquireTokenSilentAsync="acquireTokenSilentAsync",e.AcquireTokenPopup="acquireTokenPopup",e.CryptoOptsGetPublicKeyThumbprint="cryptoOptsGetPublicKeyThumbprint",e.CryptoOptsSignJwt="cryptoOptsSignJwt",e.SilentCacheClientAcquireToken="silentCacheClientAcquireToken",e.SilentIframeClientAcquireToken="silentIframeClientAcquireToken",e.SilentRefreshClientAcquireToken="silentRefreshClientAcquireToken",e.SsoSilent="ssoSilent",e.StandardInteractionClientGetDiscoveredAuthority="standardInteractionClientGetDiscoveredAuthority",e.FetchAccountIdWithNativeBroker="fetchAccountIdWithNativeBroker",e.NativeInteractionClientAcquireToken="nativeInteractionClientAcquireToken",e.BaseClientCreateTokenRequestHeaders="baseClientCreateTokenRequestHeaders",e.BrokerHandhshake="brokerHandshake",e.AcquireTokenByRefreshTokenInBroker="acquireTokenByRefreshTokenInBroker",e.AcquireTokenByBroker="acquireTokenByBroker",e.RefreshTokenClientExecuteTokenRequest="refreshTokenClientExecuteTokenRequest",e.RefreshTokenClientAcquireToken="refreshTokenClientAcquireToken",e.RefreshTokenClientAcquireTokenWithCachedRefreshToken="refreshTokenClientAcquireTokenWithCachedRefreshToken",e.RefreshTokenClientAcquireTokenByRefreshToken="refreshTokenClientAcquireTokenByRefreshToken",e.RefreshTokenClientCreateTokenRequestBody="refreshTokenClientCreateTokenRequestBody",e.AcquireTokenFromCache="acquireTokenFromCache",e.AcquireTokenBySilentIframe="acquireTokenBySilentIframe",e.InitializeBaseRequest="initializeBaseRequest",e.InitializeSilentRequest="initializeSilentRequest",e.InitializeClientApplication="initializeClientApplication",e.SilentIframeClientTokenHelper="silentIframeClientTokenHelper",e.SilentHandlerInitiateAuthRequest="silentHandlerInitiateAuthRequest",e.SilentHandlerMonitorIframeForHash="silentHandlerMonitorIframeForHash",e.SilentHandlerLoadFrame="silentHandlerLoadFrame",e.StandardInteractionClientCreateAuthCodeClient="standardInteractionClientCreateAuthCodeClient",e.StandardInteractionClientGetClientConfiguration="standardInteractionClientGetClientConfiguration",e.StandardInteractionClientInitializeAuthorizationRequest="standardInteractionClientInitializeAuthorizationRequest",e.StandardInteractionClientInitializeAuthorizationCodeRequest="standardInteractionClientInitializeAuthorizationCodeRequest",e.GetAuthCodeUrl="getAuthCodeUrl",e.HandleCodeResponseFromServer="handleCodeResponseFromServer",e.HandleCodeResponseFromHash="handleCodeResponseFromHash",e.UpdateTokenEndpointAuthority="updateTokenEndpointAuthority",e.AuthClientAcquireToken="authClientAcquireToken",e.AuthClientExecuteTokenRequest="authClientExecuteTokenRequest",e.AuthClientCreateTokenRequestBody="authClientCreateTokenRequestBody",e.AuthClientCreateQueryString="authClientCreateQueryString",e.PopTokenGenerateCnf="popTokenGenerateCnf",e.PopTokenGenerateKid="popTokenGenerateKid",e.HandleServerTokenResponse="handleServerTokenResponse",e.AuthorityFactoryCreateDiscoveredInstance="authorityFactoryCreateDiscoveredInstance",e.AuthorityResolveEndpointsAsync="authorityResolveEndpointsAsync",e.AuthorityGetCloudDiscoveryMetadataFromNetwork="authorityGetCloudDiscoveryMetadataFromNetwork",e.AuthorityUpdateCloudDiscoveryMetadata="authorityUpdateCloudDiscoveryMetadata",e.AuthorityGetEndpointMetadataFromNetwork="authorityGetEndpointMetadataFromNetwork",e.AuthorityUpdateEndpointMetadata="authorityUpdateEndpointMetadata",e.AuthorityUpdateMetadataWithRegionalInformation="authorityUpdateMetadataWithRegionalInformation",e.RegionDiscoveryDetectRegion="regionDiscoveryDetectRegion",e.RegionDiscoveryGetRegionFromIMDS="regionDiscoveryGetRegionFromIMDS",e.RegionDiscoveryGetCurrentVersion="regionDiscoveryGetCurrentVersion",e.AcquireTokenByCodeAsync="acquireTokenByCodeAsync",e.GetEndpointMetadataFromNetwork="getEndpointMetadataFromNetwork",e.GetCloudDiscoveryMetadataFromNetworkMeasurement="getCloudDiscoveryMetadataFromNetworkMeasurement",e.HandleRedirectPromiseMeasurement="handleRedirectPromiseMeasurement",e.UpdateCloudDiscoveryMetadataMeasurement="updateCloudDiscoveryMetadataMeasurement",e.UsernamePasswordClientAcquireToken="usernamePasswordClientAcquireToken",e.NativeMessageHandlerHandshake="nativeMessageHandlerHandshake"}(qi||(qi={})),function(e){e[e.NotStarted=0]="NotStarted",e[e.InProgress=1]="InProgress",e[e.Completed=2]="Completed"}(ji||(ji={}));var Wi=new Set(["accessTokenSize","durationMs","idTokenSize","matsSilentStatus","matsHttpStatus","refreshTokenSize","queuedTimeMs","startTimeMs","status"]),Ji=function(e,t){return Ji=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},Ji(e,t)};function Qi(e,t){function n(){this.constructor=e}Ji(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}var Yi=function(){return Yi=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},Yi.apply(this,arguments)};function Xi(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{u(r.next(e))}catch(Oi){o(Oi)}}function s(e){try{u(r.throw(e))}catch(Oi){o(Oi)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}u((r=r.apply(e,t||[])).next())}))}function $i(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"===typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=(i=a.trys).length>0&&i[i.length-1])&&(6===o[0]||2===o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(Oi){o=[6,Oi],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}}function eo(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;var r=Array(e),i=0;for(t=0;t<n;t++)for(var o=arguments[t],a=0,s=o.length;a<s;a++,i++)r[i]=o[a];return r}var to,no,ro,io,oo,ao={LIBRARY_NAME:"MSAL.JS",SKU:"msal.js.common",CACHE_PREFIX:"msal",DEFAULT_AUTHORITY:"https://login.microsoftonline.com/common/",DEFAULT_AUTHORITY_HOST:"login.microsoftonline.com",DEFAULT_COMMON_TENANT:"common",ADFS:"adfs",DSTS:"dstsv2",AAD_INSTANCE_DISCOVERY_ENDPT:"https://login.microsoftonline.com/common/discovery/instance?api-version=1.1&authorization_endpoint=",CIAM_AUTH_URL:".ciamlogin.com",AAD_TENANT_DOMAIN_SUFFIX:".onmicrosoft.com",RESOURCE_DELIM:"|",NO_ACCOUNT:"NO_ACCOUNT",CLAIMS:"claims",CONSUMER_UTID:"9188040d-6c67-4c5b-b112-36a304b66dad",OPENID_SCOPE:"openid",PROFILE_SCOPE:"profile",OFFLINE_ACCESS_SCOPE:"offline_access",EMAIL_SCOPE:"email",CODE_RESPONSE_TYPE:"code",CODE_GRANT_TYPE:"authorization_code",RT_GRANT_TYPE:"refresh_token",FRAGMENT_RESPONSE_MODE:"fragment",S256_CODE_CHALLENGE_METHOD:"S256",URL_FORM_CONTENT_TYPE:"application/x-www-form-urlencoded;charset=utf-8",AUTHORIZATION_PENDING:"authorization_pending",NOT_DEFINED:"not_defined",EMPTY_STRING:"",NOT_APPLICABLE:"N/A",FORWARD_SLASH:"/",IMDS_ENDPOINT:"http://169.254.169.254/metadata/instance/compute/location",IMDS_VERSION:"2020-06-01",IMDS_TIMEOUT:2e3,AZURE_REGION_AUTO_DISCOVER_FLAG:"TryAutoDetect",REGIONAL_AUTH_PUBLIC_CLOUD_SUFFIX:"login.microsoft.com",REGIONAL_AUTH_NON_MSI_QUERY_STRING:"allowestsrnonmsi=true",KNOWN_PUBLIC_CLOUDS:["login.microsoftonline.com","login.windows.net","login.microsoft.com","sts.windows.net"],TOKEN_RESPONSE_TYPE:"token",ID_TOKEN_RESPONSE_TYPE:"id_token",SHR_NONCE_VALIDITY:240,INVALID_INSTANCE:"invalid_instance"},so=[ao.OPENID_SCOPE,ao.PROFILE_SCOPE,ao.OFFLINE_ACCESS_SCOPE],uo=eo(so,[ao.EMAIL_SCOPE]);!function(e){e.CONTENT_TYPE="Content-Type",e.RETRY_AFTER="Retry-After",e.CCS_HEADER="X-AnchorMailbox",e.WWWAuthenticate="WWW-Authenticate",e.AuthenticationInfo="Authentication-Info",e.X_MS_REQUEST_ID="x-ms-request-id",e.X_MS_HTTP_VERSION="x-ms-httpver"}(to||(to={})),function(e){e.ID_TOKEN="idtoken",e.CLIENT_INFO="client.info",e.ADAL_ID_TOKEN="adal.idtoken",e.ERROR="error",e.ERROR_DESC="error.description",e.ACTIVE_ACCOUNT="active-account",e.ACTIVE_ACCOUNT_FILTERS="active-account-filters"}(no||(no={})),function(e){e.COMMON="common",e.ORGANIZATIONS="organizations",e.CONSUMERS="consumers"}(ro||(ro={})),function(e){e.CLIENT_ID="client_id",e.REDIRECT_URI="redirect_uri",e.RESPONSE_TYPE="response_type",e.RESPONSE_MODE="response_mode",e.GRANT_TYPE="grant_type",e.CLAIMS="claims",e.SCOPE="scope",e.ERROR="error",e.ERROR_DESCRIPTION="error_description",e.ACCESS_TOKEN="access_token",e.ID_TOKEN="id_token",e.REFRESH_TOKEN="refresh_token",e.EXPIRES_IN="expires_in",e.STATE="state",e.NONCE="nonce",e.PROMPT="prompt",e.SESSION_STATE="session_state",e.CLIENT_INFO="client_info",e.CODE="code",e.CODE_CHALLENGE="code_challenge",e.CODE_CHALLENGE_METHOD="code_challenge_method",e.CODE_VERIFIER="code_verifier",e.CLIENT_REQUEST_ID="client-request-id",e.X_CLIENT_SKU="x-client-SKU",e.X_CLIENT_VER="x-client-VER",e.X_CLIENT_OS="x-client-OS",e.X_CLIENT_CPU="x-client-CPU",e.X_CLIENT_CURR_TELEM="x-client-current-telemetry",e.X_CLIENT_LAST_TELEM="x-client-last-telemetry",e.X_MS_LIB_CAPABILITY="x-ms-lib-capability",e.X_APP_NAME="x-app-name",e.X_APP_VER="x-app-ver",e.POST_LOGOUT_URI="post_logout_redirect_uri",e.ID_TOKEN_HINT="id_token_hint",e.DEVICE_CODE="device_code",e.CLIENT_SECRET="client_secret",e.CLIENT_ASSERTION="client_assertion",e.CLIENT_ASSERTION_TYPE="client_assertion_type",e.TOKEN_TYPE="token_type",e.REQ_CNF="req_cnf",e.OBO_ASSERTION="assertion",e.REQUESTED_TOKEN_USE="requested_token_use",e.ON_BEHALF_OF="on_behalf_of",e.FOCI="foci",e.CCS_HEADER="X-AnchorMailbox",e.RETURN_SPA_CODE="return_spa_code",e.NATIVE_BROKER="nativebroker",e.LOGOUT_HINT="logout_hint"}(io||(io={})),function(e){e.ACCESS_TOKEN="access_token",e.XMS_CC="xms_cc"}(oo||(oo={}));var co,lo={LOGIN:"login",SELECT_ACCOUNT:"select_account",CONSENT:"consent",NONE:"none",CREATE:"create",NO_SESSION:"no_session"};!function(e){e.ACCOUNT="account",e.SID="sid",e.LOGIN_HINT="login_hint",e.ID_TOKEN="id_token",e.DOMAIN_HINT="domain_hint",e.ORGANIZATIONS="organizations",e.CONSUMERS="consumers",e.ACCOUNT_ID="accountIdentifier",e.HOMEACCOUNT_ID="homeAccountIdentifier"}(co||(co={}));var ho,fo,po,vo,go,mo,yo={PLAIN:"plain",S256:"S256"};!function(e){e.QUERY="query",e.FRAGMENT="fragment",e.FORM_POST="form_post"}(ho||(ho={})),function(e){e.IMPLICIT_GRANT="implicit",e.AUTHORIZATION_CODE_GRANT="authorization_code",e.CLIENT_CREDENTIALS_GRANT="client_credentials",e.RESOURCE_OWNER_PASSWORD_GRANT="password",e.REFRESH_TOKEN_GRANT="refresh_token",e.DEVICE_CODE_GRANT="device_code",e.JWT_BEARER="urn:ietf:params:oauth:grant-type:jwt-bearer"}(fo||(fo={})),function(e){e.MSSTS_ACCOUNT_TYPE="MSSTS",e.ADFS_ACCOUNT_TYPE="ADFS",e.MSAV1_ACCOUNT_TYPE="MSA",e.GENERIC_ACCOUNT_TYPE="Generic"}(po||(po={})),function(e){e.CACHE_KEY_SEPARATOR="-",e.CLIENT_INFO_SEPARATOR="."}(vo||(vo={})),function(e){e.ID_TOKEN="IdToken",e.ACCESS_TOKEN="AccessToken",e.ACCESS_TOKEN_WITH_AUTH_SCHEME="AccessToken_With_AuthScheme",e.REFRESH_TOKEN="RefreshToken"}(go||(go={})),function(e){e[e.ADFS=1001]="ADFS",e[e.MSA=1002]="MSA",e[e.MSSTS=1003]="MSSTS",e[e.GENERIC=1004]="GENERIC",e[e.ACCESS_TOKEN=2001]="ACCESS_TOKEN",e[e.REFRESH_TOKEN=2002]="REFRESH_TOKEN",e[e.ID_TOKEN=2003]="ID_TOKEN",e[e.APP_METADATA=3001]="APP_METADATA",e[e.UNDEFINED=9999]="UNDEFINED"}(mo||(mo={}));var bo,wo="appmetadata",So="1",ko="authority-metadata",Co=86400;!function(e){e.CONFIG="config",e.CACHE="cache",e.NETWORK="network",e.HARDCODED_VALUES="hardcoded_values"}(bo||(bo={}));var xo,Eo={SCHEMA_VERSION:5,MAX_CUR_HEADER_BYTES:80,MAX_LAST_HEADER_BYTES:330,MAX_CACHED_ERRORS:50,CACHE_KEY:"server-telemetry",CATEGORY_SEPARATOR:"|",VALUE_SEPARATOR:",",OVERFLOW_TRUE:"1",OVERFLOW_FALSE:"0",UNKNOWN_ERROR:"unknown_error"};!function(e){e.BEARER="Bearer",e.POP="pop",e.SSH="ssh-cert"}(xo||(xo={}));var To,Io,Ao,Ro,_o,Po,No=60,Oo=3600,Mo="throttling",Fo="retry-after, h429",Zo="invalid_grant",Do="client_mismatch";!function(e){e.username="username",e.password="password"}(To||(To={})),function(e){e[e.httpSuccess=200]="httpSuccess",e[e.httpBadRequest=400]="httpBadRequest"}(Io||(Io={})),function(e){e.FAILED_AUTO_DETECTION="1",e.INTERNAL_CACHE="2",e.ENVIRONMENT_VARIABLE="3",e.IMDS="4"}(Ao||(Ao={})),function(e){e.CONFIGURED_MATCHES_DETECTED="1",e.CONFIGURED_NO_AUTO_DETECTION="2",e.CONFIGURED_NOT_DETECTED="3",e.AUTO_DETECTION_REQUESTED_SUCCESSFUL="4",e.AUTO_DETECTION_REQUESTED_FAILED="5"}(Ro||(Ro={})),function(e){e.NO_CACHE_HIT="0",e.FORCE_REFRESH="1",e.NO_CACHED_ACCESS_TOKEN="2",e.CACHED_ACCESS_TOKEN_EXPIRED="3",e.REFRESH_CACHED_ACCESS_TOKEN="4",e.CLAIMS_REQUESTED_CACHE_SKIPPED="5"}(_o||(_o={})),function(e){e.Jwt="JWT",e.Jwk="JWK",e.Pop="pop"}(Po||(Po={}));var Lo,Bo,qo,jo,Uo,Ho,zo,Vo,Go,Ko={code:"unexpected_error",desc:"Unexpected error in authentication."},Wo={code:"post_request_failed",desc:"Post request failed from the network, could be a 4xx/5xx or a network unavailability. Please check the exact error code for details."},Jo=function(e){function t(n,r,i){var o=this,a=r?n+": "+r:n;return o=e.call(this,a)||this,Object.setPrototypeOf(o,t.prototype),o.errorCode=n||ao.EMPTY_STRING,o.errorMessage=r||ao.EMPTY_STRING,o.subError=i||ao.EMPTY_STRING,o.name="AuthError",o}return Qi(t,e),t.prototype.setCorrelationId=function(e){this.correlationId=e},t.createUnexpectedError=function(e){return new t(Ko.code,Ko.desc+": "+e)},t.createPostRequestFailed=function(e){return new t(Wo.code,Wo.desc+": "+e)},t}(Error),Qo=function(e){function t(n,r,i){var o=e.call(this,n,r,i)||this;return o.name="ServerError",Object.setPrototypeOf(o,t.prototype),o}return Qi(t,e),t}(Jo),Yo=["interaction_required","consent_required","login_required"],Xo=["message_only","additional_action","basic_action","user_password_expired","consent_required"],$o={code:"no_tokens_found",desc:"No refresh token found in the cache. Please sign-in."},ea={code:"native_account_unavailable",desc:"The requested account is not available in the native broker. It may have been deleted or logged out. Please sign-in again using an interactive API."},ta=function(e){function t(n,r,i,o,a,s,u){var c=e.call(this,n,r,i)||this;return Object.setPrototypeOf(c,t.prototype),c.timestamp=o||ao.EMPTY_STRING,c.traceId=a||ao.EMPTY_STRING,c.correlationId=s||ao.EMPTY_STRING,c.claims=u||ao.EMPTY_STRING,c.name="InteractionRequiredAuthError",c}return Qi(t,e),t.isInteractionRequiredError=function(e,t,n){var r=!!e&&Yo.indexOf(e)>-1,i=!!n&&Xo.indexOf(n)>-1,o=!!t&&Yo.some((function(e){return t.indexOf(e)>-1}));return r||o||i},t.createNoTokensFoundError=function(){return new t($o.code,$o.desc)},t.createNativeAccountUnavailableError=function(){return new t(ea.code,ea.desc)},t}(Jo),na="invalid_grant",ra=483,ia=600,oa="msal",aa=30,sa="msal.js.browser",ua="53ee284d-920a-4b59-9d30-a60315b26836",ca="ppnbnpeolgkicgegkbkbjmhlideopiji",la="MATS";!function(e){e.HandshakeRequest="Handshake",e.HandshakeResponse="HandshakeResponse",e.GetToken="GetToken",e.Response="Response"}(Lo||(Lo={})),function(e){e.LocalStorage="localStorage",e.SessionStorage="sessionStorage",e.MemoryStorage="memoryStorage"}(Bo||(Bo={})),function(e){e.GET="GET",e.POST="POST"}(qo||(qo={})),function(e){e.AUTHORITY="authority",e.ACQUIRE_TOKEN_ACCOUNT="acquireToken.account",e.SESSION_STATE="session.state",e.REQUEST_STATE="request.state",e.NONCE_IDTOKEN="nonce.id_token",e.ORIGIN_URI="request.origin",e.RENEW_STATUS="token.renew.status",e.URL_HASH="urlHash",e.REQUEST_PARAMS="request.params",e.SCOPES="scopes",e.INTERACTION_STATUS_KEY="interaction.status",e.CCS_CREDENTIAL="ccs.credential",e.CORRELATION_ID="request.correlationId",e.NATIVE_REQUEST="request.native",e.REDIRECT_CONTEXT="request.redirect.context"}(jo||(jo={})),function(e){e.ACCOUNT_KEYS="msal.account.keys",e.TOKEN_KEYS="msal.token.keys"}(Uo||(Uo={})),function(e){e.WRAPPER_SKU="wrapper.sku",e.WRAPPER_VER="wrapper.version"}(Ho||(Ho={})),function(e){e[e.acquireTokenRedirect=861]="acquireTokenRedirect",e[e.acquireTokenPopup=862]="acquireTokenPopup",e[e.ssoSilent=863]="ssoSilent",e[e.acquireTokenSilent_authCode=864]="acquireTokenSilent_authCode",e[e.handleRedirectPromise=865]="handleRedirectPromise",e[e.acquireTokenByCode=866]="acquireTokenByCode",e[e.acquireTokenSilent_silentFlow=61]="acquireTokenSilent_silentFlow",e[e.logout=961]="logout",e[e.logoutPopup=962]="logoutPopup"}(zo||(zo={})),function(e){e.Redirect="redirect",e.Popup="popup",e.Silent="silent",e.None="none"}(Vo||(Vo={})),function(e){e.Startup="startup",e.Login="login",e.Logout="logout",e.AcquireToken="acquireToken",e.SsoSilent="ssoSilent",e.HandleRedirect="handleRedirect",e.None="none"}(Go||(Go={}));var da,ha={scopes:so},fa="jwk";!function(e){e.React="@azure/msal-react",e.Angular="@azure/msal-angular"}(da||(da={}));var pa,va="msal.db",ga=va+".keys";!function(e){e[e.Default=0]="Default",e[e.AccessToken=1]="AccessToken",e[e.AccessTokenAndRefreshToken=2]="AccessTokenAndRefreshToken",e[e.RefreshToken=3]="RefreshToken",e[e.RefreshTokenAndNetwork=4]="RefreshTokenAndNetwork",e[e.Skip=5]="Skip"}(pa||(pa={}));var ma,ya={code:"missing_kid_error",desc:"The JOSE Header for the requested JWT, JWS or JWK object requires a keyId to be configured as the 'kid' header claim. No 'kid' value was provided."},ba={code:"missing_alg_error",desc:"The JOSE Header for the requested JWT, JWS or JWK object requires an algorithm to be specified as the 'alg' header claim. No 'alg' value was provided."},wa=function(e){function t(n,r){var i=e.call(this,n,r)||this;return i.name="JoseHeaderError",Object.setPrototypeOf(i,t.prototype),i}return Qi(t,e),t.createMissingKidError=function(){return new t(ya.code,ya.desc)},t.createMissingAlgError=function(){return new t(ba.code,ba.desc)},t}(Jo),Sa=function(){function e(e){this.typ=e.typ,this.alg=e.alg,this.kid=e.kid}return e.getShrHeaderString=function(t){if(!t.kid)throw wa.createMissingKidError();if(!t.alg)throw wa.createMissingAlgError();var n=new e({typ:t.typ||Po.Pop,kid:t.kid,alg:t.alg});return JSON.stringify(n)},e}(),ka=function(){function e(){}return e.decimalToHex=function(e){for(var t=e.toString(16);t.length<2;)t="0"+t;return t},e}(),Ca=function(){function e(e){this.cryptoObj=e}return e.prototype.generateGuid=function(){try{var e=new Uint8Array(16);return this.cryptoObj.getRandomValues(e),e[6]|=64,e[6]&=79,e[8]|=128,e[8]&=191,ka.decimalToHex(e[0])+ka.decimalToHex(e[1])+ka.decimalToHex(e[2])+ka.decimalToHex(e[3])+"-"+ka.decimalToHex(e[4])+ka.decimalToHex(e[5])+"-"+ka.decimalToHex(e[6])+ka.decimalToHex(e[7])+"-"+ka.decimalToHex(e[8])+ka.decimalToHex(e[9])+"-"+ka.decimalToHex(e[10])+ka.decimalToHex(e[11])+ka.decimalToHex(e[12])+ka.decimalToHex(e[13])+ka.decimalToHex(e[14])+ka.decimalToHex(e[15])}catch(a){for(var t="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx",n="0123456789abcdef",r=0,i=ao.EMPTY_STRING,o=0;o<36;o++)"-"!==t[o]&&"4"!==t[o]&&(r=16*Math.random()|0),"x"===t[o]?i+=n[r]:"y"===t[o]?(r&=3,i+=n[r|=8]):i+=t[o];return i}},e.prototype.isGuid=function(e){return/^[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(e)},e}(),xa=function(){function e(){}return e.stringToUtf8Arr=function(e){for(var t,n=0,r=e.length,i=0;i<r;i++)n+=(t=e.charCodeAt(i))<128?1:t<2048?2:t<65536?3:t<2097152?4:t<67108864?5:6;for(var o=new Uint8Array(n),a=0,s=0;a<n;s++)(t=e.charCodeAt(s))<128?o[a++]=t:t<2048?(o[a++]=192+(t>>>6),o[a++]=128+(63&t)):t<65536?(o[a++]=224+(t>>>12),o[a++]=128+(t>>>6&63),o[a++]=128+(63&t)):t<2097152?(o[a++]=240+(t>>>18),o[a++]=128+(t>>>12&63),o[a++]=128+(t>>>6&63),o[a++]=128+(63&t)):t<67108864?(o[a++]=248+(t>>>24),o[a++]=128+(t>>>18&63),o[a++]=128+(t>>>12&63),o[a++]=128+(t>>>6&63),o[a++]=128+(63&t)):(o[a++]=252+(t>>>30),o[a++]=128+(t>>>24&63),o[a++]=128+(t>>>18&63),o[a++]=128+(t>>>12&63),o[a++]=128+(t>>>6&63),o[a++]=128+(63&t));return o},e.stringToArrayBuffer=function(e){for(var t=new ArrayBuffer(e.length),n=new Uint8Array(t),r=0;r<e.length;r++)n[r]=e.charCodeAt(r);return t},e.utf8ArrToString=function(e){for(var t=ao.EMPTY_STRING,n=void 0,r=e.length,i=0;i<r;i++)n=e[i],t+=String.fromCharCode(n>251&&n<254&&i+5<r?1073741824*(n-252)+(e[++i]-128<<24)+(e[++i]-128<<18)+(e[++i]-128<<12)+(e[++i]-128<<6)+e[++i]-128:n>247&&n<252&&i+4<r?(n-248<<24)+(e[++i]-128<<18)+(e[++i]-128<<12)+(e[++i]-128<<6)+e[++i]-128:n>239&&n<248&&i+3<r?(n-240<<18)+(e[++i]-128<<12)+(e[++i]-128<<6)+e[++i]-128:n>223&&n<240&&i+2<r?(n-224<<12)+(e[++i]-128<<6)+e[++i]-128:n>191&&n<224&&i+1<r?(n-192<<6)+e[++i]-128:n);return t},e.getSortedObjectString=function(e){return JSON.stringify(e,Object.keys(e).sort())},e}(),Ea=function(){function e(){}return e.prototype.urlEncode=function(e){return encodeURIComponent(this.encode(e).replace(/=/g,ao.EMPTY_STRING).replace(/\+/g,"-").replace(/\//g,"_"))},e.prototype.urlEncodeArr=function(e){return this.base64EncArr(e).replace(/=/g,ao.EMPTY_STRING).replace(/\+/g,"-").replace(/\//g,"_")},e.prototype.encode=function(e){var t=xa.stringToUtf8Arr(e);return this.base64EncArr(t)},e.prototype.base64EncArr=function(e){for(var t=(3-e.length%3)%3,n=ao.EMPTY_STRING,r=void 0,i=e.length,o=0,a=0;a<i;a++)r=a%3,o|=e[a]<<(16>>>r&24),2!==r&&e.length-a!==1||(n+=String.fromCharCode(this.uint6ToB64(o>>>18&63),this.uint6ToB64(o>>>12&63),this.uint6ToB64(o>>>6&63),this.uint6ToB64(63&o)),o=0);return 0===t?n:n.substring(0,n.length-t)+(1===t?"=":"==")},e.prototype.uint6ToB64=function(e){return e<26?e+65:e<52?e+71:e<62?e-4:62===e?43:63===e?47:65},e}(),Ta=function(){function e(){}return e.prototype.decode=function(e){var t=e.replace(/-/g,"+").replace(/_/g,"/");switch(t.length%4){case 0:break;case 2:t+="==";break;case 3:t+="=";break;default:throw new Error("Invalid base64 string")}var n=this.base64DecToArr(t);return xa.utf8ArrToString(n)},e.prototype.base64DecToArr=function(e,t){for(var n=e.replace(/[^A-Za-z0-9\+\/]/g,ao.EMPTY_STRING),r=n.length,i=t?Math.ceil((3*r+1>>>2)/t)*t:3*r+1>>>2,o=new Uint8Array(i),a=void 0,s=void 0,u=0,c=0,l=0;l<r;l++)if(s=3&l,u|=this.b64ToUint6(n.charCodeAt(l))<<18-6*s,3===s||r-l===1){for(a=0;a<3&&c<i;a++,c++)o[c]=u>>>(16>>>a&24)&255;u=0}return o},e.prototype.b64ToUint6=function(e){return e>64&&e<91?e-65:e>96&&e<123?e-71:e>47&&e<58?e+4:43===e?62:47===e?63:0},e}(),Ia={code:"client_info_decoding_error",desc:"The client info could not be parsed/decoded correctly. Please review the trace to determine the root cause."},Aa={code:"client_info_empty_error",desc:"The client info was empty. Please review the trace to determine the root cause."},Ra={code:"token_parsing_error",desc:"Token cannot be parsed. Please review stack trace to determine root cause."},_a={code:"null_or_empty_token",desc:"The token is null or empty. Please review the trace to determine the root cause."},Pa={code:"endpoints_resolution_error",desc:"Error: could not resolve endpoints. Please check network and try again."},Na={code:"network_error",desc:"Network request failed. Please check network trace to determine root cause."},Oa={code:"openid_config_error",desc:"Could not retrieve endpoints. Check your authority and verify the .well-known/openid-configuration endpoint returns the required endpoints."},Ma={code:"hash_not_deserialized",desc:"The hash parameters could not be deserialized. Please review the trace to determine the root cause."},Fa={code:"invalid_state",desc:"State was not the expected format. Please check the logs to determine whether the request was sent using ProtocolUtils.setRequestState()."},Za={code:"state_mismatch",desc:"State mismatch error. Please check your network. Continued requests may cause cache overflow."},Da={code:"state_not_found",desc:"State not found"},La={code:"nonce_mismatch",desc:"Nonce mismatch error. This may be caused by a race condition in concurrent requests."},Ba={code:"nonce_not_found",desc:"nonce not found"},qa={code:"auth_time_not_found",desc:"Max Age was requested and the ID token is missing the auth_time variable. auth_time is an optional claim and is not enabled by default - it must be enabled. See https://aka.ms/msaljs/optional-claims for more information."},ja={code:"max_age_transpired",desc:"Max Age is set to 0, or too much time has elapsed since the last end-user authentication."},Ua={code:"multiple_matching_tokens",desc:"The cache contains multiple tokens satisfying the requirements. Call AcquireToken again providing more requirements such as authority or account."},Ha={code:"multiple_matching_accounts",desc:"The cache contains multiple accounts satisfying the given parameters. Please pass more info to obtain the correct account"},za={code:"multiple_matching_appMetadata",desc:"The cache contains multiple appMetadata satisfying the given parameters. Please pass more info to obtain the correct appMetadata"},Va={code:"request_cannot_be_made",desc:"Token request cannot be made without authorization code or refresh token."},Ga={code:"cannot_append_empty_scope",desc:"Cannot append null or empty scope to ScopeSet. Please check the stack trace for more info."},Ka={code:"cannot_remove_empty_scope",desc:"Cannot remove null or empty scope from ScopeSet. Please check the stack trace for more info."},Wa={code:"cannot_append_scopeset",desc:"Cannot append ScopeSet due to error."},Ja={code:"empty_input_scopeset",desc:"Empty input ScopeSet cannot be processed."},Qa={code:"device_code_polling_cancelled",desc:"Caller has cancelled token endpoint polling during device code flow by setting DeviceCodeRequest.cancel = true."},Ya={code:"device_code_expired",desc:"Device code is expired."},Xa={code:"device_code_unknown_error",desc:"Device code stopped polling for unknown reasons."},$a={code:"no_account_in_silent_request",desc:"Please pass an account object, silent flow is not supported without account information"},es={code:"invalid_cache_record",desc:"Cache record object was null or undefined."},ts={code:"invalid_cache_environment",desc:"Invalid environment when attempting to create cache entry"},ns={code:"no_account_found",desc:"No account found in cache for given key."},rs={code:"no cache plugin set on CacheManager",desc:"ICachePlugin needs to be set before using readFromStorage or writeFromStorage"},is={code:"no_crypto_object",desc:"No crypto object detected. This is required for the following operation: "},os={code:"invalid_cache_type",desc:"Invalid cache type"},as={code:"unexpected_account_type",desc:"Unexpected account type."},ss={code:"unexpected_credential_type",desc:"Unexpected credential type."},us={code:"invalid_assertion",desc:"Client assertion must meet requirements described in https://tools.ietf.org/html/rfc7515"},cs={code:"invalid_client_credential",desc:"Client credential (secret, certificate, or assertion) must not be empty when creating a confidential client. An application should at most have one credential"},ls={code:"token_refresh_required",desc:"Cannot return token from cache because it must be refreshed. This may be due to one of the following reasons: forceRefresh parameter is set to true, claims have been requested, there is no cached access token or it is expired."},ds={code:"user_timeout_reached",desc:"User defined timeout for device code polling reached"},hs={code:"token_claims_cnf_required_for_signedjwt",desc:"Cannot generate a POP jwt if the token_claims are not populated"},fs={code:"authorization_code_missing_from_server_response",desc:"Server response does not contain an authorization code to proceed"},ps={code:"binding_key_not_removed",desc:"Could not remove the credential's binding key from storage."},vs={code:"end_session_endpoint_not_supported",desc:"Provided authority does not support logout."},gs={code:"key_id_missing",desc:"A keyId value is missing from the requested bound token's cache record and is required to match the token to it's stored binding key."},ms={code:"no_network_connectivity",desc:"No network connectivity. Check your internet connection."},ys={code:"user_canceled",desc:"User canceled the flow."},bs=function(e){function t(n,r){var i=e.call(this,n,r)||this;return i.name="ClientAuthError",Object.setPrototypeOf(i,t.prototype),i}return Qi(t,e),t.createClientInfoDecodingError=function(e){return new t(Ia.code,Ia.desc+" Failed with error: "+e)},t.createClientInfoEmptyError=function(){return new t(Aa.code,""+Aa.desc)},t.createTokenParsingError=function(e){return new t(Ra.code,Ra.desc+" Failed with error: "+e)},t.createTokenNullOrEmptyError=function(e){return new t(_a.code,_a.desc+" Raw Token Value: "+e)},t.createEndpointDiscoveryIncompleteError=function(e){return new t(Pa.code,Pa.desc+" Detail: "+e)},t.createNetworkError=function(e,n){return new t(Na.code,Na.desc+" | Fetch client threw: "+n+" | Attempted to reach: "+e.split("?")[0])},t.createUnableToGetOpenidConfigError=function(e){return new t(Oa.code,Oa.desc+" Attempted to retrieve endpoints from: "+e)},t.createHashNotDeserializedError=function(e){return new t(Ma.code,Ma.desc+" Given Object: "+e)},t.createInvalidStateError=function(e,n){return new t(Fa.code,Fa.desc+" Invalid State: "+e+", Root Err: "+n)},t.createStateMismatchError=function(){return new t(Za.code,Za.desc)},t.createStateNotFoundError=function(e){return new t(Da.code,Da.desc+":  "+e)},t.createNonceMismatchError=function(){return new t(La.code,La.desc)},t.createAuthTimeNotFoundError=function(){return new t(qa.code,qa.desc)},t.createMaxAgeTranspiredError=function(){return new t(ja.code,ja.desc)},t.createNonceNotFoundError=function(e){return new t(Ba.code,Ba.desc+":  "+e)},t.createMultipleMatchingTokensInCacheError=function(){return new t(Ua.code,Ua.desc+".")},t.createMultipleMatchingAccountsInCacheError=function(){return new t(Ha.code,Ha.desc)},t.createMultipleMatchingAppMetadataInCacheError=function(){return new t(za.code,za.desc)},t.createTokenRequestCannotBeMadeError=function(){return new t(Va.code,Va.desc)},t.createAppendEmptyScopeToSetError=function(e){return new t(Ga.code,Ga.desc+" Given Scope: "+e)},t.createRemoveEmptyScopeFromSetError=function(e){return new t(Ka.code,Ka.desc+" Given Scope: "+e)},t.createAppendScopeSetError=function(e){return new t(Wa.code,Wa.desc+" Detail Error: "+e)},t.createEmptyInputScopeSetError=function(){return new t(Ja.code,""+Ja.desc)},t.createDeviceCodeCancelledError=function(){return new t(Qa.code,""+Qa.desc)},t.createDeviceCodeExpiredError=function(){return new t(Ya.code,""+Ya.desc)},t.createDeviceCodeUnknownError=function(){return new t(Xa.code,""+Xa.desc)},t.createNoAccountInSilentRequestError=function(){return new t($a.code,""+$a.desc)},t.createNullOrUndefinedCacheRecord=function(){return new t(es.code,es.desc)},t.createInvalidCacheEnvironmentError=function(){return new t(ts.code,ts.desc)},t.createNoAccountFoundError=function(){return new t(ns.code,ns.desc)},t.createCachePluginError=function(){return new t(rs.code,""+rs.desc)},t.createNoCryptoObjectError=function(e){return new t(is.code,""+is.desc+e)},t.createInvalidCacheTypeError=function(){return new t(os.code,""+os.desc)},t.createUnexpectedAccountTypeError=function(){return new t(as.code,""+as.desc)},t.createUnexpectedCredentialTypeError=function(){return new t(ss.code,""+ss.desc)},t.createInvalidAssertionError=function(){return new t(us.code,""+us.desc)},t.createInvalidCredentialError=function(){return new t(cs.code,""+cs.desc)},t.createRefreshRequiredError=function(){return new t(ls.code,ls.desc)},t.createUserTimeoutReachedError=function(){return new t(ds.code,ds.desc)},t.createTokenClaimsRequiredError=function(){return new t(hs.code,hs.desc)},t.createNoAuthCodeInServerResponseError=function(){return new t(fs.code,fs.desc)},t.createBindingKeyNotRemovedError=function(){return new t(ps.code,ps.desc)},t.createLogoutNotSupportedError=function(){return new t(vs.code,vs.desc)},t.createKeyIdMissingError=function(){return new t(gs.code,gs.desc)},t.createNoNetworkConnectivityError=function(){return new t(ms.code,ms.desc)},t.createUserCanceledError=function(){return new t(ys.code,ys.desc)},t}(Jo),ws=function(){function e(){}return e.decodeAuthToken=function(t){if(e.isEmpty(t))throw bs.createTokenNullOrEmptyError(t);var n=/^([^\.\s]*)\.([^\.\s]+)\.([^\.\s]*)$/.exec(t);if(!n||n.length<4)throw bs.createTokenParsingError("Given token is malformed: "+JSON.stringify(t));return{header:n[1],JWSPayload:n[2],JWSSig:n[3]}},e.isEmpty=function(e){return"undefined"===typeof e||!e||0===e.length},e.isEmptyObj=function(t){if(t&&!e.isEmpty(t))try{var n=JSON.parse(t);return 0===Object.keys(n).length}catch(Oi){}return!0},e.startsWith=function(e,t){return 0===e.indexOf(t)},e.endsWith=function(e,t){return e.length>=t.length&&e.lastIndexOf(t)===e.length-t.length},e.queryStringToObject=function(e){var t={},n=e.split("&"),r=function(e){return decodeURIComponent(e.replace(/\+/g," "))};return n.forEach((function(e){if(e.trim()){var n=e.split(/=(.+)/g,2),i=n[0],o=n[1];i&&o&&(t[r(i)]=r(o))}})),t},e.trimArrayEntries=function(e){return e.map((function(e){return e.trim()}))},e.removeEmptyStringsFromArray=function(t){return t.filter((function(t){return!e.isEmpty(t)}))},e.jsonParseHelper=function(e){try{return JSON.parse(e)}catch(Oi){return null}},e.matchPattern=function(e,t){return new RegExp(e.replace(/\\/g,"\\\\").replace(/\*/g,"[^ ]*").replace(/\?/g,"\\?")).test(t)},e}(),Ss={code:"pkce_not_created",desc:"The PKCE code challenge and verifier could not be generated."},ks={code:"crypto_nonexistent",desc:"The crypto object or function is not available."},Cs={code:"http_method_not_implemented",desc:"The HTTP method given has not been implemented in this library."},xs={code:"empty_navigate_uri",desc:"Navigation URI is empty. Please check stack trace for more info."},Es={code:"hash_empty_error",desc:"Hash value cannot be processed because it is empty. Please verify that your redirectUri is not clearing the hash. For more visit: aka.ms/msaljs/browser-errors."},Ts={code:"no_state_in_hash",desc:"Hash does not contain state. Please verify that the request originated from msal."},Is={code:"hash_does_not_contain_known_properties",desc:"Hash does not contain known properites. Please verify that your redirectUri is not changing the hash. For more visit: aka.ms/msaljs/browser-errors."},As={code:"unable_to_parse_state",desc:"Unable to parse state. Please verify that the request originated from msal."},Rs={code:"state_interaction_type_mismatch",desc:"Hash contains state but the interaction type does not match the caller."},_s={code:"interaction_in_progress",desc:"Interaction is currently in progress. Please ensure that this interaction has been completed before calling an interactive API.  For more visit: aka.ms/msaljs/browser-errors."},Ps={code:"popup_window_error",desc:"Error opening popup window. This can happen if you are using IE or if popups are blocked in the browser."},Ns={code:"empty_window_error",desc:"window.open returned null or undefined window object."},Os={code:"user_cancelled",desc:"User cancelled the flow."},Ms={code:"monitor_window_timeout",desc:"Token acquisition in popup failed due to timeout. For more visit: aka.ms/msaljs/browser-errors."},Fs={code:"monitor_window_timeout",desc:"Token acquisition in iframe failed due to timeout. For more visit: aka.ms/msaljs/browser-errors."},Zs={code:"redirect_in_iframe",desc:"Redirects are not supported for iframed or brokered applications. Please ensure you are using MSAL.js in a top frame of the window if using the redirect APIs, or use the popup APIs."},Ds={code:"block_iframe_reload",desc:"Request was blocked inside an iframe because MSAL detected an authentication response. For more visit: aka.ms/msaljs/browser-errors"},Ls={code:"block_nested_popups",desc:"Request was blocked inside a popup because MSAL detected it was running in a popup."},Bs={code:"iframe_closed_prematurely",desc:"The iframe being monitored was closed prematurely."},qs={code:"silent_logout_unsupported",desc:"Silent logout not supported. Please call logoutRedirect or logoutPopup instead."},js={code:"no_account_error",desc:"No account object provided to acquireTokenSilent and no active account has been set. Please call setActiveAccount or provide an account on the request."},Us={code:"silent_prompt_value_error",desc:"The value given for the prompt value is not valid for silent requests - must be set to 'none' or 'no_session'."},Hs={code:"no_token_request_cache_error",desc:"No token request found in cache."},zs={code:"unable_to_parse_token_request_cache_error",desc:"The cached token request could not be parsed."},Vs={code:"no_cached_authority_error",desc:"No cached authority found."},Gs={code:"auth_request_not_set_error",desc:"Auth Request not set. Please ensure initiateAuthRequest was called from the InteractionHandler"},Ks={code:"invalid_cache_type",desc:"Invalid cache type"},Ws={code:"non_browser_environment",desc:"Login and token requests are not supported in non-browser environments."},Js={code:"database_not_open",desc:"Database is not open!"},Qs={code:"no_network_connectivity",desc:"No network connectivity. Check your internet connection."},Ys={code:"post_request_failed",desc:"Network request failed: If the browser threw a CORS error, check that the redirectUri is registered in the Azure App Portal as type 'SPA'"},Xs={code:"get_request_failed",desc:"Network request failed. Please check the network trace to determine root cause."},$s={code:"failed_to_parse_response",desc:"Failed to parse network response. Check network trace."},eu={code:"unable_to_load_token",desc:"Error loading token to cache."},tu={code:"crypto_key_not_found",desc:"Cryptographic Key or Keypair not found in browser storage."},nu={code:"auth_code_required",desc:"An authorization code must be provided (as the `code` property on the request) to this flow."},ru={code:"auth_code_or_nativeAccountId_required",desc:"An authorization code or nativeAccountId must be provided to this flow."},iu={code:"spa_code_and_nativeAccountId_present",desc:"Request cannot contain both spa code and native account id."},ou={code:"database_unavailable",desc:"IndexedDB, which is required for persistent cryptographic key storage, is unavailable. This may be caused by browser privacy features which block persistent storage in third-party contexts."},au={code:"unable_to_acquire_token_from_native_platform",desc:"Unable to acquire token from native platform. For a list of possible reasons visit aka.ms/msaljs/browser-errors."},su={code:"native_handshake_timeout",desc:"Timed out while attempting to establish connection to browser extension"},uu={code:"native_extension_not_installed",desc:"Native extension is not installed. If you think this is a mistake call the initialize function."},cu={code:"native_connection_not_established",desc:"Connection to native platform has not been established. Please install a compatible browser extension and run initialize(). For more please visit aka.ms/msaljs/browser-errors."},lu={code:"native_broker_called_before_initialize",desc:"You must call and await the initialize function before attempting to call any other MSAL API when native brokering is enabled. For more please visit aka.ms/msaljs/browser-errors."},du={code:"native_prompt_not_supported",desc:"The provided prompt is not supported by the native platform. This request should be routed to the web based flow."},hu=function(e){function t(n,r){var i=e.call(this,n,r)||this;return Object.setPrototypeOf(i,t.prototype),i.name="BrowserAuthError",i}return Bi(t,e),t.createPkceNotGeneratedError=function(e){return new t(Ss.code,Ss.desc+" Detail:"+e)},t.createCryptoNotAvailableError=function(e){return new t(ks.code,ks.desc+" Detail:"+e)},t.createHttpMethodNotImplementedError=function(e){return new t(Cs.code,Cs.desc+" Given Method: "+e)},t.createEmptyNavigationUriError=function(){return new t(xs.code,xs.desc)},t.createEmptyHashError=function(e){return new t(Es.code,Es.desc+" Given Url: "+e)},t.createHashDoesNotContainStateError=function(){return new t(Ts.code,Ts.desc)},t.createHashDoesNotContainKnownPropertiesError=function(){return new t(Is.code,Is.desc)},t.createUnableToParseStateError=function(){return new t(As.code,As.desc)},t.createStateInteractionTypeMismatchError=function(){return new t(Rs.code,Rs.desc)},t.createInteractionInProgressError=function(){return new t(_s.code,_s.desc)},t.createPopupWindowError=function(e){var n=Ps.desc;return n=ws.isEmpty(e)?n:n+" Details: "+e,new t(Ps.code,n)},t.createEmptyWindowCreatedError=function(){return new t(Ns.code,Ns.desc)},t.createUserCancelledError=function(){return new t(Os.code,Os.desc)},t.createMonitorPopupTimeoutError=function(){return new t(Ms.code,Ms.desc)},t.createMonitorIframeTimeoutError=function(){return new t(Fs.code,Fs.desc)},t.createRedirectInIframeError=function(e){return new t(Zs.code,Zs.desc+" (window.parent !== window) => "+e)},t.createBlockReloadInHiddenIframeError=function(){return new t(Ds.code,Ds.desc)},t.createBlockAcquireTokenInPopupsError=function(){return new t(Ls.code,Ls.desc)},t.createIframeClosedPrematurelyError=function(){return new t(Bs.code,Bs.desc)},t.createSilentLogoutUnsupportedError=function(){return new t(qs.code,qs.desc)},t.createNoAccountError=function(){return new t(js.code,js.desc)},t.createSilentPromptValueError=function(e){return new t(Us.code,Us.desc+" Given value: "+e)},t.createUnableToParseTokenRequestCacheError=function(){return new t(zs.code,zs.desc)},t.createNoTokenRequestCacheError=function(){return new t(Hs.code,Hs.desc)},t.createAuthRequestNotSetError=function(){return new t(Gs.code,Gs.desc)},t.createNoCachedAuthorityError=function(){return new t(Vs.code,Vs.desc)},t.createInvalidCacheTypeError=function(){return new t(Ks.code,""+Ks.desc)},t.createNonBrowserEnvironmentError=function(){return new t(Ws.code,Ws.desc)},t.createDatabaseNotOpenError=function(){return new t(Js.code,Js.desc)},t.createNoNetworkConnectivityError=function(){return new t(Qs.code,Qs.desc)},t.createPostRequestFailedError=function(e,n){return new t(Ys.code,Ys.desc+" | Network client threw: "+e+" | Attempted to reach: "+n.split("?")[0])},t.createGetRequestFailedError=function(e,n){return new t(Xs.code,Xs.desc+" | Network client threw: "+e+" | Attempted to reach: "+n.split("?")[0])},t.createFailedToParseNetworkResponseError=function(e){return new t($s.code,$s.desc+" | Attempted to reach: "+e.split("?")[0])},t.createUnableToLoadTokenError=function(e){return new t(eu.code,eu.desc+" | "+e)},t.createSigningKeyNotFoundInStorageError=function(e){return new t(tu.code,tu.desc+" | No match found for KeyId: "+e)},t.createAuthCodeRequiredError=function(){return new t(nu.code,nu.desc)},t.createAuthCodeOrNativeAccountIdRequiredError=function(){return new t(ru.code,ru.desc)},t.createSpaCodeAndNativeAccountIdPresentError=function(){return new t(iu.code,iu.desc)},t.createDatabaseUnavailableError=function(){return new t(ou.code,ou.desc)},t.createUnableToAcquireTokenFromNativePlatformError=function(){return new t(au.code,au.desc)},t.createNativeHandshakeTimeoutError=function(){return new t(su.code,su.desc)},t.createNativeExtensionNotInstalledError=function(){return new t(uu.code,uu.desc)},t.createNativeConnectionNotEstablishedError=function(){return new t(cu.code,cu.desc)},t.createNativeBrokerCalledBeforeInitialize=function(){return new t(lu.code,lu.desc)},t.createNativePromptParameterNotSupportedError=function(){return new t(du.code,du.desc)},t}(Jo),fu=function(){function e(e){this.base64Encode=new Ea,this.cryptoObj=e}return e.prototype.generateCodes=function(){return zi(this,void 0,void 0,(function(){var e,t;return Vi(this,(function(n){switch(n.label){case 0:return e=this.generateCodeVerifier(),[4,this.generateCodeChallengeFromVerifier(e)];case 1:return t=n.sent(),[2,{verifier:e,challenge:t}]}}))}))},e.prototype.generateCodeVerifier=function(){try{var e=new Uint8Array(32);return this.cryptoObj.getRandomValues(e),this.base64Encode.urlEncodeArr(e)}catch(Oi){throw hu.createPkceNotGeneratedError(Oi)}},e.prototype.generateCodeChallengeFromVerifier=function(e){return zi(this,void 0,void 0,(function(){var t,n;return Vi(this,(function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),[4,this.cryptoObj.sha256Digest(e)];case 1:return t=r.sent(),[2,this.base64Encode.urlEncodeArr(new Uint8Array(t))];case 2:throw n=r.sent(),hu.createPkceNotGeneratedError(n);case 3:return[2]}}))}))},e}(),pu=function(){function e(){}return e.prototype.getRandomValues=function(e){return window.crypto.getRandomValues(e)},e.prototype.generateKey=function(e,t,n){return zi(this,void 0,void 0,(function(){return Vi(this,(function(r){return[2,window.crypto.subtle.generateKey(e,t,n)]}))}))},e.prototype.exportKey=function(e){return zi(this,void 0,void 0,(function(){return Vi(this,(function(t){return[2,window.crypto.subtle.exportKey(fa,e)]}))}))},e.prototype.importKey=function(e,t,n,r){return zi(this,void 0,void 0,(function(){return Vi(this,(function(i){return[2,window.crypto.subtle.importKey(fa,e,t,n,r)]}))}))},e.prototype.sign=function(e,t,n){return zi(this,void 0,void 0,(function(){return Vi(this,(function(r){return[2,window.crypto.subtle.sign(e,t,n)]}))}))},e.prototype.digest=function(e,t){return zi(this,void 0,void 0,(function(){return Vi(this,(function(n){return[2,window.crypto.subtle.digest(e,t)]}))}))},e}(),vu=function(){function e(){}return e.prototype.initPrng=function(e){return window.msrCrypto.initPrng(Ki(e))},e.prototype.getRandomValues=function(e){return window.msrCrypto.getRandomValues(e)},e.prototype.generateKey=function(e,t,n){return zi(this,void 0,void 0,(function(){return Vi(this,(function(r){return[2,window.msrCrypto.subtle.generateKey(e,t,n)]}))}))},e.prototype.exportKey=function(e){return zi(this,void 0,void 0,(function(){return Vi(this,(function(t){return[2,window.msrCrypto.subtle.exportKey(fa,e)]}))}))},e.prototype.importKey=function(e,t,n,r){return zi(this,void 0,void 0,(function(){return Vi(this,(function(i){return[2,window.msrCrypto.subtle.importKey(fa,e,t,n,r)]}))}))},e.prototype.sign=function(e,t,n){return zi(this,void 0,void 0,(function(){return Vi(this,(function(r){return[2,window.msrCrypto.subtle.sign(e,t,n)]}))}))},e.prototype.digest=function(e,t){return zi(this,void 0,void 0,(function(){return Vi(this,(function(n){return[2,window.msrCrypto.subtle.digest(e,t)]}))}))},e}(),gu=function(){function e(){}return e.prototype.getRandomValues=function(e){return window.msCrypto.getRandomValues(e)},e.prototype.generateKey=function(e,t,n){return zi(this,void 0,void 0,(function(){return Vi(this,(function(r){return[2,new Promise((function(r,i){var o=window.msCrypto.subtle.generateKey(e,t,n);o.addEventListener("complete",(function(e){r(e.target.result)})),o.addEventListener("error",(function(e){i(e)}))}))]}))}))},e.prototype.exportKey=function(e){return zi(this,void 0,void 0,(function(){return Vi(this,(function(t){return[2,new Promise((function(t,n){var r=window.msCrypto.subtle.exportKey(fa,e);r.addEventListener("complete",(function(e){var r=e.target.result,i=xa.utf8ArrToString(new Uint8Array(r)).replace(/\r/g,ao.EMPTY_STRING).replace(/\n/g,ao.EMPTY_STRING).replace(/\t/g,ao.EMPTY_STRING).split(" ").join(ao.EMPTY_STRING).replace("\0",ao.EMPTY_STRING);try{t(JSON.parse(i))}catch(e){n(e)}})),r.addEventListener("error",(function(e){n(e)}))}))]}))}))},e.prototype.importKey=function(e,t,n,r){return zi(this,void 0,void 0,(function(){var i,o;return Vi(this,(function(a){return i=xa.getSortedObjectString(e),o=xa.stringToArrayBuffer(i),[2,new Promise((function(e,i){var a=window.msCrypto.subtle.importKey(fa,o,t,n,r);a.addEventListener("complete",(function(t){e(t.target.result)})),a.addEventListener("error",(function(e){i(e)}))}))]}))}))},e.prototype.sign=function(e,t,n){return zi(this,void 0,void 0,(function(){return Vi(this,(function(r){return[2,new Promise((function(r,i){var o=window.msCrypto.subtle.sign(e,t,n);o.addEventListener("complete",(function(e){r(e.target.result)})),o.addEventListener("error",(function(e){i(e)}))}))]}))}))},e.prototype.digest=function(e,t){return zi(this,void 0,void 0,(function(){return Vi(this,(function(n){return[2,new Promise((function(n,r){var i=window.msCrypto.subtle.digest(e,t.buffer);i.addEventListener("complete",(function(e){n(e.target.result)})),i.addEventListener("error",(function(e){r(e)}))}))]}))}))},e}(),mu={code:"redirect_uri_empty",desc:"A redirect URI is required for all calls, and none has been set."},yu={code:"post_logout_uri_empty",desc:"A post logout redirect has not been set."},bu={code:"storage_not_supported",desc:"Given storage configuration option was not supported."},wu={code:"no_redirect_callbacks",desc:"No redirect callbacks have been set. Please call setRedirectCallbacks() with the appropriate function arguments before continuing. More information is available here: https://github.com/AzureAD/microsoft-authentication-library-for-js/wiki/MSAL-basics."},Su={code:"stubbed_public_client_application_called",desc:"Stub instance of Public Client Application was called. If using msal-react, please ensure context is not used without a provider. For more visit: aka.ms/msaljs/browser-errors"},ku={code:"in_mem_redirect_unavailable",desc:"Redirect cannot be supported. In-memory storage was selected and storeAuthStateInCookie=false, which would cause the library to be unable to handle the incoming hash. If you would like to use the redirect API, please use session/localStorage or set storeAuthStateInCookie=true."},Cu={code:"entropy_not_provided",desc:"The available browser crypto interface requires entropy set via system.cryptoOptions.entropy configuration option."},xu=function(e){function t(n,r){var i=e.call(this,n,r)||this;return i.name="BrowserConfigurationAuthError",Object.setPrototypeOf(i,t.prototype),i}return Bi(t,e),t.createRedirectUriEmptyError=function(){return new t(mu.code,mu.desc)},t.createPostLogoutRedirectUriEmptyError=function(){return new t(yu.code,yu.desc)},t.createStorageNotSupportedError=function(e){return new t(bu.code,bu.desc+" Given Location: "+e)},t.createRedirectCallbacksNotSetError=function(){return new t(wu.code,wu.desc)},t.createStubPcaInstanceCalledError=function(){return new t(Su.code,Su.desc)},t.createInMemoryRedirectUnavailableError=function(){return new t(ku.code,ku.desc)},t.createEntropyNotProvided=function(){return new t(Cu.code,Cu.desc)},t}(Jo),Eu="SHA-256",Tu=new Uint8Array([1,0,1]),Iu=function(){function e(e,t){var n,r;if(this.logger=e,this.cryptoOptions=t,this.hasBrowserCrypto())this.logger.verbose("BrowserCrypto: modern crypto interface available"),this.subtleCrypto=new pu;else if(this.hasIECrypto())this.logger.verbose("BrowserCrypto: MS crypto interface available"),this.subtleCrypto=new gu;else{if(!this.hasMsrCrypto()||!(null===(n=this.cryptoOptions)||void 0===n?void 0:n.useMsrCrypto))throw this.hasMsrCrypto()&&this.logger.info("BrowserCrypto: MSR Crypto interface available but system.cryptoOptions.useMsrCrypto not enabled"),this.logger.error("BrowserCrypto: No crypto interfaces available."),hu.createCryptoNotAvailableError("Browser crypto, msCrypto, or msrCrypto interfaces not available.");this.logger.verbose("BrowserCrypto: MSR crypto interface available"),this.subtleCrypto=new vu}if(this.subtleCrypto.initPrng){if(this.logger.verbose("BrowserCrypto: Interface requires entropy"),!(null===(r=this.cryptoOptions)||void 0===r?void 0:r.entropy))throw this.logger.error("BrowserCrypto: Interface requires entropy but none provided."),xu.createEntropyNotProvided();this.logger.verbose("BrowserCrypto: Entropy provided"),this.subtleCrypto.initPrng(this.cryptoOptions.entropy)}this.keygenAlgorithmOptions={name:"RSASSA-PKCS1-v1_5",hash:Eu,modulusLength:2048,publicExponent:Tu}}return e.prototype.hasIECrypto=function(){return"msCrypto"in window},e.prototype.hasBrowserCrypto=function(){return"crypto"in window},e.prototype.hasMsrCrypto=function(){return"msrCrypto"in window},e.prototype.sha256Digest=function(e){return zi(this,void 0,void 0,(function(){var t;return Vi(this,(function(n){return t=xa.stringToUtf8Arr(e),[2,this.subtleCrypto.digest({name:Eu},t)]}))}))},e.prototype.getRandomValues=function(e){return this.subtleCrypto.getRandomValues(e)},e.prototype.generateKeyPair=function(e,t){return zi(this,void 0,void 0,(function(){return Vi(this,(function(n){return[2,this.subtleCrypto.generateKey(this.keygenAlgorithmOptions,e,t)]}))}))},e.prototype.exportJwk=function(e){return zi(this,void 0,void 0,(function(){return Vi(this,(function(t){return[2,this.subtleCrypto.exportKey(e)]}))}))},e.prototype.importJwk=function(e,t,n){return zi(this,void 0,void 0,(function(){return Vi(this,(function(r){return[2,this.subtleCrypto.importKey(e,this.keygenAlgorithmOptions,t,n)]}))}))},e.prototype.sign=function(e,t){return zi(this,void 0,void 0,(function(){return Vi(this,(function(n){return[2,this.subtleCrypto.sign(this.keygenAlgorithmOptions,e,t)]}))}))},e}(),Au=function(){function e(){this.dbName=va,this.version=1,this.tableName=ga,this.dbOpen=!1}return e.prototype.open=function(){return zi(this,void 0,void 0,(function(){var e=this;return Vi(this,(function(t){return[2,new Promise((function(t,n){var r=window.indexedDB.open(e.dbName,e.version);r.addEventListener("upgradeneeded",(function(t){t.target.result.createObjectStore(e.tableName)})),r.addEventListener("success",(function(n){var r=n;e.db=r.target.result,e.dbOpen=!0,t()})),r.addEventListener("error",(function(){return n(hu.createDatabaseUnavailableError())}))}))]}))}))},e.prototype.closeConnection=function(){var e=this.db;e&&this.dbOpen&&(e.close(),this.dbOpen=!1)},e.prototype.validateDbIsOpen=function(){return zi(this,void 0,void 0,(function(){return Vi(this,(function(e){switch(e.label){case 0:return this.dbOpen?[3,2]:[4,this.open()];case 1:return[2,e.sent()];case 2:return[2]}}))}))},e.prototype.getItem=function(e){return zi(this,void 0,void 0,(function(){var t=this;return Vi(this,(function(n){switch(n.label){case 0:return[4,this.validateDbIsOpen()];case 1:return n.sent(),[2,new Promise((function(n,r){if(!t.db)return r(hu.createDatabaseNotOpenError());var i=t.db.transaction([t.tableName],"readonly").objectStore(t.tableName).get(e);i.addEventListener("success",(function(e){var r=e;t.closeConnection(),n(r.target.result)})),i.addEventListener("error",(function(e){t.closeConnection(),r(e)}))}))]}}))}))},e.prototype.setItem=function(e,t){return zi(this,void 0,void 0,(function(){var n=this;return Vi(this,(function(r){switch(r.label){case 0:return[4,this.validateDbIsOpen()];case 1:return r.sent(),[2,new Promise((function(r,i){if(!n.db)return i(hu.createDatabaseNotOpenError());var o=n.db.transaction([n.tableName],"readwrite").objectStore(n.tableName).put(t,e);o.addEventListener("success",(function(){n.closeConnection(),r()})),o.addEventListener("error",(function(e){n.closeConnection(),i(e)}))}))]}}))}))},e.prototype.removeItem=function(e){return zi(this,void 0,void 0,(function(){var t=this;return Vi(this,(function(n){switch(n.label){case 0:return[4,this.validateDbIsOpen()];case 1:return n.sent(),[2,new Promise((function(n,r){if(!t.db)return r(hu.createDatabaseNotOpenError());var i=t.db.transaction([t.tableName],"readwrite").objectStore(t.tableName).delete(e);i.addEventListener("success",(function(){t.closeConnection(),n()})),i.addEventListener("error",(function(e){t.closeConnection(),r(e)}))}))]}}))}))},e.prototype.getKeys=function(){return zi(this,void 0,void 0,(function(){var e=this;return Vi(this,(function(t){switch(t.label){case 0:return[4,this.validateDbIsOpen()];case 1:return t.sent(),[2,new Promise((function(t,n){if(!e.db)return n(hu.createDatabaseNotOpenError());var r=e.db.transaction([e.tableName],"readonly").objectStore(e.tableName).getAllKeys();r.addEventListener("success",(function(n){var r=n;e.closeConnection(),t(r.target.result)})),r.addEventListener("error",(function(t){e.closeConnection(),n(t)}))}))]}}))}))},e.prototype.containsKey=function(e){return zi(this,void 0,void 0,(function(){var t=this;return Vi(this,(function(n){switch(n.label){case 0:return[4,this.validateDbIsOpen()];case 1:return n.sent(),[2,new Promise((function(n,r){if(!t.db)return r(hu.createDatabaseNotOpenError());var i=t.db.transaction([t.tableName],"readonly").objectStore(t.tableName).count(e);i.addEventListener("success",(function(e){var r=e;t.closeConnection(),n(1===r.target.result)})),i.addEventListener("error",(function(e){t.closeConnection(),r(e)}))}))]}}))}))},e.prototype.deleteDatabase=function(){return zi(this,void 0,void 0,(function(){return Vi(this,(function(e){return this.db&&this.dbOpen&&this.closeConnection(),[2,new Promise((function(e,t){var n=window.indexedDB.deleteDatabase(va);n.addEventListener("success",(function(){return e(!0)})),n.addEventListener("blocked",(function(){return e(!0)})),n.addEventListener("error",(function(){return t(!1)}))}))]}))}))},e}(),Ru=function(){function e(){this.cache=new Map}return e.prototype.getItem=function(e){return this.cache.get(e)||null},e.prototype.setItem=function(e,t){this.cache.set(e,t)},e.prototype.removeItem=function(e){this.cache.delete(e)},e.prototype.getKeys=function(){var e=[];return this.cache.forEach((function(t,n){e.push(n)})),e},e.prototype.containsKey=function(e){return this.cache.has(e)},e.prototype.clear=function(){this.cache.clear()},e}(),_u=function(){function e(e,t){this.inMemoryCache=new Ru,this.indexedDBCache=new Au,this.logger=e,this.storeName=t}return e.prototype.handleDatabaseAccessError=function(e){if(!(e instanceof hu&&e.errorCode===ou.code))throw e;this.logger.error("Could not access persistent storage. This may be caused by browser privacy features which block persistent storage in third-party contexts.")},e.prototype.getItem=function(e){return zi(this,void 0,void 0,(function(){var t,n;return Vi(this,(function(r){switch(r.label){case 0:if(t=this.inMemoryCache.getItem(e))return[3,4];r.label=1;case 1:return r.trys.push([1,3,,4]),this.logger.verbose("Queried item not found in in-memory cache, now querying persistent storage."),[4,this.indexedDBCache.getItem(e)];case 2:return[2,r.sent()];case 3:return n=r.sent(),this.handleDatabaseAccessError(n),[3,4];case 4:return[2,t]}}))}))},e.prototype.setItem=function(e,t){return zi(this,void 0,void 0,(function(){var n;return Vi(this,(function(r){switch(r.label){case 0:this.inMemoryCache.setItem(e,t),r.label=1;case 1:return r.trys.push([1,3,,4]),[4,this.indexedDBCache.setItem(e,t)];case 2:return r.sent(),[3,4];case 3:return n=r.sent(),this.handleDatabaseAccessError(n),[3,4];case 4:return[2]}}))}))},e.prototype.removeItem=function(e){return zi(this,void 0,void 0,(function(){var t;return Vi(this,(function(n){switch(n.label){case 0:this.inMemoryCache.removeItem(e),n.label=1;case 1:return n.trys.push([1,3,,4]),[4,this.indexedDBCache.removeItem(e)];case 2:return n.sent(),[3,4];case 3:return t=n.sent(),this.handleDatabaseAccessError(t),[3,4];case 4:return[2]}}))}))},e.prototype.getKeys=function(){return zi(this,void 0,void 0,(function(){var e,t;return Vi(this,(function(n){switch(n.label){case 0:if(0!==(e=this.inMemoryCache.getKeys()).length)return[3,4];n.label=1;case 1:return n.trys.push([1,3,,4]),this.logger.verbose("In-memory cache is empty, now querying persistent storage."),[4,this.indexedDBCache.getKeys()];case 2:return[2,n.sent()];case 3:return t=n.sent(),this.handleDatabaseAccessError(t),[3,4];case 4:return[2,e]}}))}))},e.prototype.containsKey=function(e){return zi(this,void 0,void 0,(function(){var t,n;return Vi(this,(function(r){switch(r.label){case 0:if(t=this.inMemoryCache.containsKey(e))return[3,4];r.label=1;case 1:return r.trys.push([1,3,,4]),this.logger.verbose("Key not found in in-memory cache, now querying persistent storage."),[4,this.indexedDBCache.containsKey(e)];case 2:return[2,r.sent()];case 3:return n=r.sent(),this.handleDatabaseAccessError(n),[3,4];case 4:return[2,t]}}))}))},e.prototype.clearInMemory=function(){this.logger.verbose("Deleting in-memory keystore "+this.storeName),this.inMemoryCache.clear(),this.logger.verbose("In-memory keystore "+this.storeName+" deleted")},e.prototype.clearPersistent=function(){return zi(this,void 0,void 0,(function(){var e,t;return Vi(this,(function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),this.logger.verbose("Deleting persistent keystore"),[4,this.indexedDBCache.deleteDatabase()];case 1:return(e=n.sent())&&this.logger.verbose("Persistent keystore deleted"),[2,e];case 2:return t=n.sent(),this.handleDatabaseAccessError(t),[2,!1];case 3:return[2]}}))}))},e}();!function(e){e.asymmetricKeys="asymmetricKeys",e.symmetricKeys="symmetricKeys"}(ma||(ma={}));var Pu,Nu=function(){function e(e){this.logger=e,this.asymmetricKeys=new _u(this.logger,ma.asymmetricKeys),this.symmetricKeys=new _u(this.logger,ma.symmetricKeys)}return e.prototype.clear=function(){return zi(this,void 0,void 0,(function(){var e;return Vi(this,(function(t){switch(t.label){case 0:this.asymmetricKeys.clearInMemory(),this.symmetricKeys.clearInMemory(),t.label=1;case 1:return t.trys.push([1,3,,4]),[4,this.asymmetricKeys.clearPersistent()];case 2:return t.sent(),[2,!0];case 3:return(e=t.sent())instanceof Error?this.logger.error("Clearing keystore failed with error: "+e.message):this.logger.error("Clearing keystore failed with unknown error"),[2,!1];case 4:return[2]}}))}))},e}(),Ou=function(){function e(e,t,n){this.logger=e,this.browserCrypto=new Iu(this.logger,n),this.b64Encode=new Ea,this.b64Decode=new Ta,this.guidGenerator=new Ca(this.browserCrypto),this.pkceGenerator=new fu(this.browserCrypto),this.cache=new Nu(this.logger),this.performanceClient=t}return e.prototype.createNewGuid=function(){return this.guidGenerator.generateGuid()},e.prototype.base64Encode=function(e){return this.b64Encode.encode(e)},e.prototype.base64Decode=function(e){return this.b64Decode.decode(e)},e.prototype.generatePkceCodes=function(){return zi(this,void 0,void 0,(function(){return Vi(this,(function(e){return[2,this.pkceGenerator.generateCodes()]}))}))},e.prototype.getPublicKeyThumbprint=function(t){var n;return zi(this,void 0,void 0,(function(){var r,i,o,a,s,u,c,l;return Vi(this,(function(d){switch(d.label){case 0:return r=null===(n=this.performanceClient)||void 0===n?void 0:n.startMeasurement(qi.CryptoOptsGetPublicKeyThumbprint,t.correlationId),[4,this.browserCrypto.generateKeyPair(e.EXTRACTABLE,e.POP_KEY_USAGES)];case 1:return i=d.sent(),[4,this.browserCrypto.exportJwk(i.publicKey)];case 2:return o=d.sent(),a={e:o.e,kty:o.kty,n:o.n},s=xa.getSortedObjectString(a),[4,this.hashString(s)];case 3:return u=d.sent(),[4,this.browserCrypto.exportJwk(i.privateKey)];case 4:return c=d.sent(),[4,this.browserCrypto.importJwk(c,!1,["sign"])];case 5:return l=d.sent(),[4,this.cache.asymmetricKeys.setItem(u,{privateKey:l,publicKey:i.publicKey,requestMethod:t.resourceRequestMethod,requestUri:t.resourceRequestUri})];case 6:return d.sent(),r&&r.endMeasurement({success:!0}),[2,u]}}))}))},e.prototype.removeTokenBindingKey=function(e){return zi(this,void 0,void 0,(function(){return Vi(this,(function(t){switch(t.label){case 0:return[4,this.cache.asymmetricKeys.removeItem(e)];case 1:return t.sent(),[4,this.cache.asymmetricKeys.containsKey(e)];case 2:return[2,!t.sent()]}}))}))},e.prototype.clearKeystore=function(){return zi(this,void 0,void 0,(function(){return Vi(this,(function(e){switch(e.label){case 0:return[4,this.cache.clear()];case 1:return[2,e.sent()]}}))}))},e.prototype.signJwt=function(e,t,n){var r;return zi(this,void 0,void 0,(function(){var i,o,a,s,u,c,l,d,h,f,p,v,g;return Vi(this,(function(m){switch(m.label){case 0:return i=null===(r=this.performanceClient)||void 0===r?void 0:r.startMeasurement(qi.CryptoOptsSignJwt,n),[4,this.cache.asymmetricKeys.getItem(t)];case 1:if(!(o=m.sent()))throw hu.createSigningKeyNotFoundInStorageError(t);return[4,this.browserCrypto.exportJwk(o.publicKey)];case 2:return a=m.sent(),s=xa.getSortedObjectString(a),u=this.b64Encode.urlEncode(JSON.stringify({kid:t})),c=Sa.getShrHeaderString({kid:u,alg:a.alg}),l=this.b64Encode.urlEncode(c),e.cnf={jwk:JSON.parse(s)},d=this.b64Encode.urlEncode(JSON.stringify(e)),h=l+"."+d,f=xa.stringToArrayBuffer(h),[4,this.browserCrypto.sign(o.privateKey,f)];case 3:return p=m.sent(),v=this.b64Encode.urlEncodeArr(new Uint8Array(p)),g=h+"."+v,i&&i.endMeasurement({success:!0}),[2,g]}}))}))},e.prototype.hashString=function(e){return zi(this,void 0,void 0,(function(){var t,n;return Vi(this,(function(r){switch(r.label){case 0:return[4,this.browserCrypto.sha256Digest(e)];case 1:return t=r.sent(),n=new Uint8Array(t),[2,this.b64Encode.urlEncodeArr(n)]}}))}))},e.POP_KEY_USAGES=["sign","verify"],e.EXTRACTABLE=!0,e}();!function(e){e[e.Error=0]="Error",e[e.Warning=1]="Warning",e[e.Info=2]="Info",e[e.Verbose=3]="Verbose",e[e.Trace=4]="Trace"}(Pu||(Pu={}));var Mu,Fu=function(){function e(t,n,r){this.level=Pu.Info;var i=t||e.createDefaultLoggerOptions();this.localCallback=i.loggerCallback||function(){},this.piiLoggingEnabled=i.piiLoggingEnabled||!1,this.level="number"===typeof i.logLevel?i.logLevel:Pu.Info,this.correlationId=i.correlationId||ao.EMPTY_STRING,this.packageName=n||ao.EMPTY_STRING,this.packageVersion=r||ao.EMPTY_STRING}return e.createDefaultLoggerOptions=function(){return{loggerCallback:function(){},piiLoggingEnabled:!1,logLevel:Pu.Info}},e.prototype.clone=function(t,n,r){return new e({loggerCallback:this.localCallback,piiLoggingEnabled:this.piiLoggingEnabled,logLevel:this.level,correlationId:r||this.correlationId},t,n)},e.prototype.logMessage=function(e,t){if(!(t.logLevel>this.level||!this.piiLoggingEnabled&&t.containsPii)){var n=(new Date).toUTCString(),r=(ws.isEmpty(t.correlationId)?ws.isEmpty(this.correlationId)?"["+n+"]":"["+n+"] : ["+this.correlationId+"]":"["+n+"] : ["+t.correlationId+"]")+" : "+this.packageName+"@"+this.packageVersion+" : "+Pu[t.logLevel]+" - "+e;this.executeCallback(t.logLevel,r,t.containsPii||!1)}},e.prototype.executeCallback=function(e,t,n){this.localCallback&&this.localCallback(e,t,n)},e.prototype.error=function(e,t){this.logMessage(e,{logLevel:Pu.Error,containsPii:!1,correlationId:t||ao.EMPTY_STRING})},e.prototype.errorPii=function(e,t){this.logMessage(e,{logLevel:Pu.Error,containsPii:!0,correlationId:t||ao.EMPTY_STRING})},e.prototype.warning=function(e,t){this.logMessage(e,{logLevel:Pu.Warning,containsPii:!1,correlationId:t||ao.EMPTY_STRING})},e.prototype.warningPii=function(e,t){this.logMessage(e,{logLevel:Pu.Warning,containsPii:!0,correlationId:t||ao.EMPTY_STRING})},e.prototype.info=function(e,t){this.logMessage(e,{logLevel:Pu.Info,containsPii:!1,correlationId:t||ao.EMPTY_STRING})},e.prototype.infoPii=function(e,t){this.logMessage(e,{logLevel:Pu.Info,containsPii:!0,correlationId:t||ao.EMPTY_STRING})},e.prototype.verbose=function(e,t){this.logMessage(e,{logLevel:Pu.Verbose,containsPii:!1,correlationId:t||ao.EMPTY_STRING})},e.prototype.verbosePii=function(e,t){this.logMessage(e,{logLevel:Pu.Verbose,containsPii:!0,correlationId:t||ao.EMPTY_STRING})},e.prototype.trace=function(e,t){this.logMessage(e,{logLevel:Pu.Trace,containsPii:!1,correlationId:t||ao.EMPTY_STRING})},e.prototype.tracePii=function(e,t){this.logMessage(e,{logLevel:Pu.Trace,containsPii:!0,correlationId:t||ao.EMPTY_STRING})},e.prototype.isPiiLoggingEnabled=function(){return this.piiLoggingEnabled||!1},e}(),Zu=function(){function e(e,t,n,r,i,o){this.authority=t,this.libraryName=r,this.libraryVersion=i,this.applicationTelemetry=o,this.clientId=e,this.logger=n,this.callbacks=new Map,this.eventsByCorrelationId=new Map,this.queueMeasurements=new Map,this.preQueueTimeByCorrelationId=new Map}return e.prototype.startPerformanceMeasurement=function(e,t){return{}},e.prototype.startPerformanceMeasuremeant=function(e,t){return{}},e.prototype.getIntFields=function(){return Wi},e.prototype.getPreQueueTime=function(e,t){var n=this.preQueueTimeByCorrelationId.get(t);if(n){if(n.name===e)return n.time;this.logger.trace("PerformanceClient.getPreQueueTime: no pre-queue time found for "+e+", unable to add queue measurement")}else this.logger.trace("PerformanceClient.getPreQueueTime: no pre-queue times found for correlationId: "+t+", unable to add queue measurement")},e.prototype.calculateQueuedTime=function(e,t){return e<1?(this.logger.trace("PerformanceClient: preQueueTime should be a positive integer and not "+e),0):t<1?(this.logger.trace("PerformanceClient: currentTime should be a positive integer and not "+t),0):t<e?(this.logger.trace("PerformanceClient: currentTime is less than preQueueTime, check how time is being retrieved"),0):t-e},e.prototype.addQueueMeasurement=function(e,t,n,r){if(t){if(0===n)this.logger.trace("PerformanceClient.addQueueMeasurement: queue time provided for "+e+" is "+n);else if(!n)return void this.logger.trace("PerformanceClient.addQueueMeasurement: no queue time provided for "+e);var i={eventName:e,queueTime:n,manuallyCompleted:r},o=this.queueMeasurements.get(t);if(o)o.push(i),this.queueMeasurements.set(t,o);else{this.logger.trace("PerformanceClient.addQueueMeasurement: adding correlationId "+t+" to queue measurements");var a=[i];this.queueMeasurements.set(t,a)}this.preQueueTimeByCorrelationId.delete(t)}else this.logger.trace("PerformanceClient.addQueueMeasurement: correlationId not provided for "+e+", cannot add queue measurement")},e.prototype.startMeasurement=function(e,t){var n,r,i=this,o=t||this.generateId();t||this.logger.info("PerformanceClient: No correlation id provided for "+e+", generating",o),this.logger.trace("PerformanceClient: Performance measurement started for "+e,o);var a=this.startPerformanceMeasuremeant(e,o);a.startMeasurement();var s={eventId:this.generateId(),status:ji.InProgress,authority:this.authority,libraryName:this.libraryName,libraryVersion:this.libraryVersion,clientId:this.clientId,name:e,startTimeMs:Date.now(),correlationId:o,appName:null===(n=this.applicationTelemetry)||void 0===n?void 0:n.appName,appVersion:null===(r=this.applicationTelemetry)||void 0===r?void 0:r.appVersion};return this.cacheEventByCorrelationId(s),{endMeasurement:function(e){return i.endMeasurement(Yi(Yi({},s),e),a)},discardMeasurement:function(){return i.discardMeasurements(s.correlationId)},addStaticFields:function(e){return i.addStaticFields(e,s.correlationId)},increment:function(e){return i.increment(e,s.correlationId)},measurement:a,event:s}},e.prototype.endMeasurement=function(e,t){var n,r,i=this,o=this.eventsByCorrelationId.get(e.correlationId);if(!o)return this.logger.trace("PerformanceClient: Measurement not found for "+e.eventId,e.correlationId),null;var a=e.eventId===o.eventId,s={totalQueueTime:0,totalQueueCount:0,manuallyCompletedCount:0};a?(s=this.getQueueInfo(e.correlationId),this.discardCache(o.correlationId)):null===(n=o.incompleteSubMeasurements)||void 0===n||n.delete(e.eventId),null===t||void 0===t||t.endMeasurement();var u=null===t||void 0===t?void 0:t.flushMeasurement();if(!u)return this.logger.trace("PerformanceClient: Performance measurement not taken",o.correlationId),null;if(this.logger.trace("PerformanceClient: Performance measurement ended for "+e.name+": "+u+" ms",e.correlationId),!a)return o[e.name+"DurationMs"]=Math.floor(u),Yi({},o);var c=Yi(Yi({},o),e),l=0;return null===(r=c.incompleteSubMeasurements)||void 0===r||r.forEach((function(t){i.logger.trace("PerformanceClient: Incomplete submeasurement "+t.name+" found for "+e.name,c.correlationId),l++})),c.incompleteSubMeasurements=void 0,c=Yi(Yi({},c),{durationMs:Math.round(u),queuedTimeMs:s.totalQueueTime,queuedCount:s.totalQueueCount,queuedManuallyCompletedCount:s.manuallyCompletedCount,status:ji.Completed,incompleteSubsCount:l}),this.truncateIntegralFields(c,this.getIntFields()),this.emitEvents([c],e.correlationId),c},e.prototype.addStaticFields=function(e,t){this.logger.trace("PerformanceClient: Updating static fields");var n=this.eventsByCorrelationId.get(t);n?this.eventsByCorrelationId.set(t,Yi(Yi({},n),e)):this.logger.trace("PerformanceClient: Event not found for",t)},e.prototype.increment=function(e,t){this.logger.trace("PerformanceClient: Updating counters");var n=this.eventsByCorrelationId.get(t);if(n)for(var r in e)n.hasOwnProperty(r)||(n[r]=0),n[r]+=e[r];else this.logger.trace("PerformanceClient: Event not found for",t)},e.prototype.cacheEventByCorrelationId=function(e){var t=this.eventsByCorrelationId.get(e.correlationId);t?(this.logger.trace("PerformanceClient: Performance measurement for "+e.name+" added/updated",e.correlationId),t.incompleteSubMeasurements=t.incompleteSubMeasurements||new Map,t.incompleteSubMeasurements.set(e.eventId,{name:e.name,startTimeMs:e.startTimeMs})):(this.logger.trace("PerformanceClient: Performance measurement for "+e.name+" started",e.correlationId),this.eventsByCorrelationId.set(e.correlationId,Yi({},e)))},e.prototype.getQueueInfo=function(e){var t=this.queueMeasurements.get(e);t||this.logger.trace("PerformanceClient: no queue measurements found for for correlationId: "+e);var n=0,r=0,i=0;return null===t||void 0===t||t.forEach((function(e){n+=e.queueTime,r++,i+=e.manuallyCompleted?1:0})),{totalQueueTime:n,totalQueueCount:r,manuallyCompletedCount:i}},e.prototype.discardMeasurements=function(e){this.logger.trace("PerformanceClient: Performance measurements discarded",e),this.eventsByCorrelationId.delete(e)},e.prototype.discardCache=function(e){this.discardMeasurements(e),this.logger.trace("PerformanceClient: QueueMeasurements discarded",e),this.queueMeasurements.delete(e),this.logger.trace("PerformanceClient: Pre-queue times discarded",e),this.preQueueTimeByCorrelationId.delete(e)},e.prototype.addPerformanceCallback=function(e){var t=this.generateId();return this.callbacks.set(t,e),this.logger.verbose("PerformanceClient: Performance callback registered with id: "+t),t},e.prototype.removePerformanceCallback=function(e){var t=this.callbacks.delete(e);return t?this.logger.verbose("PerformanceClient: Performance callback "+e+" removed."):this.logger.verbose("PerformanceClient: Performance callback "+e+" not removed."),t},e.prototype.emitEvents=function(e,t){var n=this;this.logger.verbose("PerformanceClient: Emitting performance events",t),this.callbacks.forEach((function(r,i){n.logger.trace("PerformanceClient: Emitting event to callback "+i,t),r.apply(null,[e])}))},e.prototype.truncateIntegralFields=function(e,t){t.forEach((function(t){t in e&&"number"===typeof e[t]&&(e[t]=Math.floor(e[t]))}))},e}(),Du=function(){function e(){}return e.prototype.startMeasurement=function(){},e.prototype.endMeasurement=function(){},e.prototype.flushMeasurement=function(){return null},e}(),Lu=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Qi(t,e),t.prototype.generateId=function(){return"callback-id"},t.prototype.startPerformanceMeasuremeant=function(){return new Du},t.prototype.startPerformanceMeasurement=function(){return new Du},t.prototype.calculateQueuedTime=function(e,t){return 0},t.prototype.addQueueMeasurement=function(e,t,n){},t.prototype.setPreQueueTime=function(e,t){},t}(Zu),Bu={createNewGuid:function(){throw Jo.createUnexpectedError("Crypto interface - createNewGuid() has not been implemented")},base64Decode:function(){throw Jo.createUnexpectedError("Crypto interface - base64Decode() has not been implemented")},base64Encode:function(){throw Jo.createUnexpectedError("Crypto interface - base64Encode() has not been implemented")},generatePkceCodes:function(){return Xi(this,void 0,void 0,(function(){return $i(this,(function(e){throw"Crypto interface - generatePkceCodes() has not been implemented",Jo.createUnexpectedError("Crypto interface - generatePkceCodes() has not been implemented")}))}))},getPublicKeyThumbprint:function(){return Xi(this,void 0,void 0,(function(){return $i(this,(function(e){throw"Crypto interface - getPublicKeyThumbprint() has not been implemented",Jo.createUnexpectedError("Crypto interface - getPublicKeyThumbprint() has not been implemented")}))}))},removeTokenBindingKey:function(){return Xi(this,void 0,void 0,(function(){return $i(this,(function(e){throw"Crypto interface - removeTokenBindingKey() has not been implemented",Jo.createUnexpectedError("Crypto interface - removeTokenBindingKey() has not been implemented")}))}))},clearKeystore:function(){return Xi(this,void 0,void 0,(function(){return $i(this,(function(e){throw"Crypto interface - clearKeystore() has not been implemented",Jo.createUnexpectedError("Crypto interface - clearKeystore() has not been implemented")}))}))},signJwt:function(){return Xi(this,void 0,void 0,(function(){return $i(this,(function(e){throw"Crypto interface - signJwt() has not been implemented",Jo.createUnexpectedError("Crypto interface - signJwt() has not been implemented")}))}))},hashString:function(){return Xi(this,void 0,void 0,(function(){return $i(this,(function(e){throw"Crypto interface - hashString() has not been implemented",Jo.createUnexpectedError("Crypto interface - hashString() has not been implemented")}))}))}},qu=function(){function e(){}return e.prototype.generateAccountId=function(){return e.generateAccountIdForCacheKey(this.homeAccountId,this.environment)},e.prototype.generateCredentialId=function(){return e.generateCredentialIdForCacheKey(this.credentialType,this.clientId,this.realm,this.familyId)},e.prototype.generateTarget=function(){return e.generateTargetForCacheKey(this.target)},e.prototype.generateCredentialKey=function(){return e.generateCredentialCacheKey(this.homeAccountId,this.environment,this.credentialType,this.clientId,this.realm,this.target,this.familyId,this.tokenType,this.requestedClaimsHash)},e.prototype.generateType=function(){switch(this.credentialType){case go.ID_TOKEN:return mo.ID_TOKEN;case go.ACCESS_TOKEN:case go.ACCESS_TOKEN_WITH_AUTH_SCHEME:return mo.ACCESS_TOKEN;case go.REFRESH_TOKEN:return mo.REFRESH_TOKEN;default:throw bs.createUnexpectedCredentialTypeError()}},e.generateCredentialCacheKey=function(e,t,n,r,i,o,a,s,u){return[this.generateAccountIdForCacheKey(e,t),this.generateCredentialIdForCacheKey(n,r,i,a),this.generateTargetForCacheKey(o),this.generateClaimsHashForCacheKey(u),this.generateSchemeForCacheKey(s)].join(vo.CACHE_KEY_SEPARATOR).toLowerCase()},e.generateAccountIdForCacheKey=function(e,t){return[e,t].join(vo.CACHE_KEY_SEPARATOR).toLowerCase()},e.generateCredentialIdForCacheKey=function(e,t,n,r){return[e,e===go.REFRESH_TOKEN&&r||t,n||ao.EMPTY_STRING].join(vo.CACHE_KEY_SEPARATOR).toLowerCase()},e.generateTargetForCacheKey=function(e){return(e||ao.EMPTY_STRING).toLowerCase()},e.generateClaimsHashForCacheKey=function(e){return(e||ao.EMPTY_STRING).toLowerCase()},e.generateSchemeForCacheKey=function(e){return e&&e.toLowerCase()!==xo.BEARER.toLowerCase()?e.toLowerCase():ao.EMPTY_STRING},e}(),ju=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Qi(t,e),t.createIdTokenEntity=function(e,n,r,i,o){var a=new t;return a.credentialType=go.ID_TOKEN,a.homeAccountId=e,a.environment=n,a.clientId=i,a.secret=r,a.realm=o,a},t.isIdTokenEntity=function(e){return!!e&&(e.hasOwnProperty("homeAccountId")&&e.hasOwnProperty("environment")&&e.hasOwnProperty("credentialType")&&e.hasOwnProperty("realm")&&e.hasOwnProperty("clientId")&&e.hasOwnProperty("secret")&&e.credentialType===go.ID_TOKEN)},t}(qu),Uu={code:"redirect_uri_empty",desc:"A redirect URI is required for all calls, and none has been set."},Hu={code:"post_logout_uri_empty",desc:"A post logout redirect has not been set."},zu={code:"claims_request_parsing_error",desc:"Could not parse the given claims request object."},Vu={code:"authority_uri_insecure",desc:"Authority URIs must use https.  Please see here for valid authority configuration options: https://docs.microsoft.com/en-us/azure/active-directory/develop/msal-js-initializing-client-applications#configuration-options"},Gu={code:"url_parse_error",desc:"URL could not be parsed into appropriate segments."},Ku={code:"empty_url_error",desc:"URL was empty or null."},Wu={code:"empty_input_scopes_error",desc:"Scopes cannot be passed as null, undefined or empty array because they are required to obtain an access token."},Ju={code:"clientid_input_scopes_error",desc:"Client ID can only be provided as a single scope."},Qu={code:"invalid_prompt_value",desc:"Supported prompt values are 'login', 'select_account', 'consent', 'create', 'none' and 'no_session'.  Please see here for valid configuration options: https://azuread.github.io/microsoft-authentication-library-for-js/ref/modules/_azure_msal_common.html#commonauthorizationurlrequest"},Yu={code:"invalid_claims",desc:"Given claims parameter must be a stringified JSON object."},Xu={code:"token_request_empty",desc:"Token request was empty and not found in cache."},$u={code:"logout_request_empty",desc:"The logout request was null or undefined."},ec={code:"invalid_code_challenge_method",desc:'code_challenge_method passed is invalid. Valid values are "plain" and "S256".'},tc={code:"pkce_params_missing",desc:"Both params: code_challenge and code_challenge_method are to be passed if to be sent in the request"},nc={code:"invalid_cloud_discovery_metadata",desc:"Invalid cloudDiscoveryMetadata provided. Must be a stringified JSON object containing tenant_discovery_endpoint and metadata fields"},rc={code:"invalid_authority_metadata",desc:"Invalid authorityMetadata provided. Must by a stringified JSON object containing authorization_endpoint, token_endpoint, issuer fields."},ic={code:"untrusted_authority",desc:"The provided authority is not a trusted authority. Please include this authority in the knownAuthorities config parameter."},oc={code:"invalid_azure_cloud_instance",desc:"Invalid AzureCloudInstance provided. Please refer MSAL JS docs: aks.ms/msaljs/azure_cloud_instance for valid values"},ac={code:"missing_ssh_jwk",desc:"Missing sshJwk in SSH certificate request. A stringified JSON Web Key is required when using the SSH authentication scheme."},sc={code:"missing_ssh_kid",desc:"Missing sshKid in SSH certificate request. A string that uniquely identifies the public SSH key is required when using the SSH authentication scheme."},uc={code:"missing_nonce_authentication_header",desc:"Unable to find an authentication header containing server nonce. Either the Authentication-Info or WWW-Authenticate headers must be present in order to obtain a server nonce."},cc={code:"invalid_authentication_header",desc:"Invalid authentication header provided"},lc={code:"authority_mismatch",desc:"Authority mismatch error. Authority provided in login request or PublicClientApplication config does not match the environment of the provided account. Please use a matching account or make an interactive request to login to this authority."},dc=function(e){function t(n,r){var i=e.call(this,n,r)||this;return i.name="ClientConfigurationError",Object.setPrototypeOf(i,t.prototype),i}return Qi(t,e),t.createRedirectUriEmptyError=function(){return new t(Uu.code,Uu.desc)},t.createPostLogoutRedirectUriEmptyError=function(){return new t(Hu.code,Hu.desc)},t.createClaimsRequestParsingError=function(e){return new t(zu.code,zu.desc+" Given value: "+e)},t.createInsecureAuthorityUriError=function(e){return new t(Vu.code,Vu.desc+" Given URI: "+e)},t.createUrlParseError=function(e){return new t(Gu.code,Gu.desc+" Given Error: "+e)},t.createUrlEmptyError=function(){return new t(Ku.code,Ku.desc)},t.createEmptyScopesArrayError=function(){return new t(Wu.code,""+Wu.desc)},t.createClientIdSingleScopeError=function(e){return new t(Ju.code,Ju.desc+" Given Scopes: "+e)},t.createInvalidPromptError=function(e){return new t(Qu.code,Qu.desc+" Given value: "+e)},t.createInvalidClaimsRequestError=function(){return new t(Yu.code,Yu.desc)},t.createEmptyLogoutRequestError=function(){return new t($u.code,$u.desc)},t.createEmptyTokenRequestError=function(){return new t(Xu.code,Xu.desc)},t.createInvalidCodeChallengeMethodError=function(){return new t(ec.code,ec.desc)},t.createInvalidCodeChallengeParamsError=function(){return new t(tc.code,tc.desc)},t.createInvalidCloudDiscoveryMetadataError=function(){return new t(nc.code,nc.desc)},t.createInvalidAuthorityMetadataError=function(){return new t(rc.code,rc.desc)},t.createUntrustedAuthorityError=function(){return new t(ic.code,ic.desc)},t.createInvalidAzureCloudInstanceError=function(){return new t(oc.code,oc.desc)},t.createMissingSshJwkError=function(){return new t(ac.code,ac.desc)},t.createMissingSshKidError=function(){return new t(sc.code,sc.desc)},t.createMissingNonceAuthenticationHeadersError=function(){return new t(uc.code,uc.desc)},t.createInvalidAuthenticationHeaderError=function(e,n){return new t(cc.code,cc.desc+". Invalid header: "+e+". Details: "+n)},t.createAuthorityMismatchError=function(){return new t(lc.code,lc.desc)},t}(bs),hc=function(){function e(e){var t=this,n=e?ws.trimArrayEntries(eo(e)):[],r=n?ws.removeEmptyStringsFromArray(n):[];this.validateInputScopes(r),this.scopes=new Set,r.forEach((function(e){return t.scopes.add(e)}))}return e.fromString=function(t){return new e((t||ao.EMPTY_STRING).split(" "))},e.createSearchScopes=function(t){var n=new e(t);return n.containsOnlyOIDCScopes()?n.removeScope(ao.OFFLINE_ACCESS_SCOPE):n.removeOIDCScopes(),n},e.prototype.validateInputScopes=function(e){if(!e||e.length<1)throw dc.createEmptyScopesArrayError()},e.prototype.containsScope=function(t){var n=new e(this.printScopesLowerCase().split(" "));return!ws.isEmpty(t)&&n.scopes.has(t.toLowerCase())},e.prototype.containsScopeSet=function(e){var t=this;return!(!e||e.scopes.size<=0)&&(this.scopes.size>=e.scopes.size&&e.asArray().every((function(e){return t.containsScope(e)})))},e.prototype.containsOnlyOIDCScopes=function(){var e=this,t=0;return uo.forEach((function(n){e.containsScope(n)&&(t+=1)})),this.scopes.size===t},e.prototype.appendScope=function(e){ws.isEmpty(e)||this.scopes.add(e.trim())},e.prototype.appendScopes=function(e){var t=this;try{e.forEach((function(e){return t.appendScope(e)}))}catch(Oi){throw bs.createAppendScopeSetError(Oi)}},e.prototype.removeScope=function(e){if(ws.isEmpty(e))throw bs.createRemoveEmptyScopeFromSetError(e);this.scopes.delete(e.trim())},e.prototype.removeOIDCScopes=function(){var e=this;uo.forEach((function(t){e.scopes.delete(t)}))},e.prototype.unionScopeSets=function(e){if(!e)throw bs.createEmptyInputScopeSetError();var t=new Set;return e.scopes.forEach((function(e){return t.add(e.toLowerCase())})),this.scopes.forEach((function(e){return t.add(e.toLowerCase())})),t},e.prototype.intersectingScopeSets=function(e){if(!e)throw bs.createEmptyInputScopeSetError();e.containsOnlyOIDCScopes()||e.removeOIDCScopes();var t=this.unionScopeSets(e),n=e.getScopeCount(),r=this.getScopeCount();return t.size<r+n},e.prototype.getScopeCount=function(){return this.scopes.size},e.prototype.asArray=function(){var e=[];return this.scopes.forEach((function(t){return e.push(t)})),e},e.prototype.printScopes=function(){return this.scopes?this.asArray().join(" "):ao.EMPTY_STRING},e.prototype.printScopesLowerCase=function(){return this.printScopes().toLowerCase()},e}();function fc(e,t){if(ws.isEmpty(e))throw bs.createClientInfoEmptyError();try{var n=t.base64Decode(e);return JSON.parse(n)}catch(Oi){throw bs.createClientInfoDecodingError(Oi.message)}}function pc(e){if(ws.isEmpty(e))throw bs.createClientInfoDecodingError("Home account ID was empty.");var t=e.split(vo.CLIENT_INFO_SEPARATOR,2);return{uid:t[0],utid:t.length<2?ao.EMPTY_STRING:t[1]}}!function(e){e[e.Default=0]="Default",e[e.Adfs=1]="Adfs",e[e.Dsts=2]="Dsts",e[e.Ciam=3]="Ciam"}(Mu||(Mu={}));var vc,gc=function(){function e(){}return e.prototype.generateAccountId=function(){return[this.homeAccountId,this.environment].join(vo.CACHE_KEY_SEPARATOR).toLowerCase()},e.prototype.generateAccountKey=function(){return e.generateAccountCacheKey({homeAccountId:this.homeAccountId,environment:this.environment,tenantId:this.realm,username:this.username,localAccountId:this.localAccountId})},e.prototype.generateType=function(){switch(this.authorityType){case po.ADFS_ACCOUNT_TYPE:return mo.ADFS;case po.MSAV1_ACCOUNT_TYPE:return mo.MSA;case po.MSSTS_ACCOUNT_TYPE:return mo.MSSTS;case po.GENERIC_ACCOUNT_TYPE:return mo.GENERIC;default:throw bs.createUnexpectedAccountTypeError()}},e.prototype.getAccountInfo=function(){return{homeAccountId:this.homeAccountId,environment:this.environment,tenantId:this.realm,username:this.username,localAccountId:this.localAccountId,name:this.name,idTokenClaims:this.idTokenClaims,nativeAccountId:this.nativeAccountId}},e.generateAccountCacheKey=function(e){return[e.homeAccountId,e.environment||ao.EMPTY_STRING,e.tenantId||ao.EMPTY_STRING].join(vo.CACHE_KEY_SEPARATOR).toLowerCase()},e.createAccount=function(t,n,r,i,o,a,s,u){var c,l,d,h,f,p,v=new e;v.authorityType=po.MSSTS_ACCOUNT_TYPE,v.clientInfo=t,v.homeAccountId=n,v.nativeAccountId=u;var g=s||i&&i.getPreferredCache();if(!g)throw bs.createInvalidCacheEnvironmentError();if(v.environment=g,v.realm=(null===(c=null===r||void 0===r?void 0:r.claims)||void 0===c?void 0:c.tid)||ao.EMPTY_STRING,r){v.idTokenClaims=r.claims,v.localAccountId=(null===(l=null===r||void 0===r?void 0:r.claims)||void 0===l?void 0:l.oid)||(null===(d=null===r||void 0===r?void 0:r.claims)||void 0===d?void 0:d.sub)||ao.EMPTY_STRING;var m=null===(h=null===r||void 0===r?void 0:r.claims)||void 0===h?void 0:h.preferred_username,y=(null===(f=null===r||void 0===r?void 0:r.claims)||void 0===f?void 0:f.emails)?r.claims.emails[0]:null;v.username=m||y||ao.EMPTY_STRING,v.name=null===(p=null===r||void 0===r?void 0:r.claims)||void 0===p?void 0:p.name}return v.cloudGraphHostName=o,v.msGraphHost=a,v},e.createGenericAccount=function(t,n,r,i,o,a){var s,u,c,l,d=new e;d.authorityType=r&&r.authorityType===Mu.Adfs?po.ADFS_ACCOUNT_TYPE:po.GENERIC_ACCOUNT_TYPE,d.homeAccountId=t,d.realm=ao.EMPTY_STRING;var h=a||r&&r.getPreferredCache();if(!h)throw bs.createInvalidCacheEnvironmentError();return n&&(d.localAccountId=(null===(s=null===n||void 0===n?void 0:n.claims)||void 0===s?void 0:s.oid)||(null===(u=null===n||void 0===n?void 0:n.claims)||void 0===u?void 0:u.sub)||ao.EMPTY_STRING,d.username=(null===(c=null===n||void 0===n?void 0:n.claims)||void 0===c?void 0:c.upn)||ao.EMPTY_STRING,d.name=(null===(l=null===n||void 0===n?void 0:n.claims)||void 0===l?void 0:l.name)||ao.EMPTY_STRING,d.idTokenClaims=null===n||void 0===n?void 0:n.claims),d.environment=h,d.cloudGraphHostName=i,d.msGraphHost=o,d},e.generateHomeAccountId=function(e,t,n,r,i){var o,a=(null===(o=null===i||void 0===i?void 0:i.claims)||void 0===o?void 0:o.sub)?i.claims.sub:ao.EMPTY_STRING;if(t===Mu.Adfs||t===Mu.Dsts)return a;if(e)try{var s=fc(e,r);if(!ws.isEmpty(s.uid)&&!ws.isEmpty(s.utid))return""+s.uid+vo.CLIENT_INFO_SEPARATOR+s.utid}catch(Oi){}return n.verbose("No client info in response"),a},e.isAccountEntity=function(e){return!!e&&(e.hasOwnProperty("homeAccountId")&&e.hasOwnProperty("environment")&&e.hasOwnProperty("realm")&&e.hasOwnProperty("localAccountId")&&e.hasOwnProperty("username")&&e.hasOwnProperty("authorityType"))},e.accountInfoIsEqual=function(e,t,n){if(!e||!t)return!1;var r=!0;if(n){var i=e.idTokenClaims||{},o=t.idTokenClaims||{};r=i.iat===o.iat&&i.nonce===o.nonce}return e.homeAccountId===t.homeAccountId&&e.localAccountId===t.localAccountId&&e.username===t.username&&e.tenantId===t.tenantId&&e.environment===t.environment&&e.nativeAccountId===t.nativeAccountId&&r},e}(),mc=function(){function e(t,n){if(ws.isEmpty(t))throw bs.createTokenNullOrEmptyError(t);this.rawToken=t,this.claims=e.extractTokenClaims(t,n)}return e.extractTokenClaims=function(e,t){var n=ws.decodeAuthToken(e);try{var r=n.JWSPayload,i=t.base64Decode(r);return JSON.parse(i)}catch(o){throw bs.createTokenParsingError(o)}},e.checkMaxAge=function(e,t){if(0===t||Date.now()-3e5>e+t)throw bs.createMaxAgeTranspiredError()},e}(),yc="@azure/msal-common",bc="13.2.1",wc=function(){function e(e,t,n){this.clientId=e,this.cryptoImpl=t,this.commonLogger=n.clone(yc,bc)}return e.prototype.getAllAccounts=function(){var e=this,t=this.getAccountKeys();if(t.length<1)return[];var n=t.reduce((function(t,n){var r=e.getAccount(n);return r?(t.push(r),t):t}),[]);return n.length<1?[]:n.map((function(t){return e.getAccountInfoFromEntity(t)}))},e.prototype.getAccountInfoFilteredBy=function(e){var t=this.getAccountsFilteredBy(e);return t.length>0?this.getAccountInfoFromEntity(t[0]):null},e.prototype.getAccountInfoFromEntity=function(e){var t=e.getAccountInfo(),n=this.getIdToken(t);return n&&(t.idToken=n.secret,t.idTokenClaims=new mc(n.secret,this.cryptoImpl).claims),t},e.prototype.saveCacheRecord=function(e){return Xi(this,void 0,void 0,(function(){return $i(this,(function(t){switch(t.label){case 0:if(!e)throw bs.createNullOrUndefinedCacheRecord();return e.account&&this.setAccount(e.account),e.idToken&&this.setIdTokenCredential(e.idToken),e.accessToken?[4,this.saveAccessToken(e.accessToken)]:[3,2];case 1:t.sent(),t.label=2;case 2:return e.refreshToken&&this.setRefreshTokenCredential(e.refreshToken),e.appMetadata&&this.setAppMetadata(e.appMetadata),[2]}}))}))},e.prototype.saveAccessToken=function(e){return Xi(this,void 0,void 0,(function(){var t,n,r,i,o=this;return $i(this,(function(a){switch(a.label){case 0:return t={clientId:e.clientId,credentialType:e.credentialType,environment:e.environment,homeAccountId:e.homeAccountId,realm:e.realm,tokenType:e.tokenType,requestedClaimsHash:e.requestedClaimsHash},n=this.getTokenKeys(),r=hc.fromString(e.target),i=[],n.accessToken.forEach((function(e){if(o.accessTokenKeyMatchesFilter(e,t,!1)){var n=o.getAccessTokenCredential(e);if(n&&o.credentialMatchesFilter(n,t))hc.fromString(n.target).intersectingScopeSets(r)&&i.push(o.removeAccessToken(e))}})),[4,Promise.all(i)];case 1:return a.sent(),this.setAccessTokenCredential(e),[2]}}))}))},e.prototype.getAccountsFilteredBy=function(e){var t=this,n=this.getAccountKeys(),r=[];return n.forEach((function(n){if(t.isAccountKey(n,e.homeAccountId,e.realm)){var i=t.getAccount(n);i&&(e.homeAccountId&&!t.matchHomeAccountId(i,e.homeAccountId)||e.localAccountId&&!t.matchLocalAccountId(i,e.localAccountId)||e.username&&!t.matchUsername(i,e.username)||e.environment&&!t.matchEnvironment(i,e.environment)||e.realm&&!t.matchRealm(i,e.realm)||e.nativeAccountId&&!t.matchNativeAccountId(i,e.nativeAccountId)||r.push(i))}})),r},e.prototype.isAccountKey=function(e,t,n){return!(e.split(vo.CACHE_KEY_SEPARATOR).length<3)&&(!(t&&!e.toLowerCase().includes(t.toLowerCase()))&&!(n&&!e.toLowerCase().includes(n.toLowerCase())))},e.prototype.isCredentialKey=function(e){if(e.split(vo.CACHE_KEY_SEPARATOR).length<6)return!1;var t=e.toLowerCase();if(-1===t.indexOf(go.ID_TOKEN.toLowerCase())&&-1===t.indexOf(go.ACCESS_TOKEN.toLowerCase())&&-1===t.indexOf(go.ACCESS_TOKEN_WITH_AUTH_SCHEME.toLowerCase())&&-1===t.indexOf(go.REFRESH_TOKEN.toLowerCase()))return!1;if(t.indexOf(go.REFRESH_TOKEN.toLowerCase())>-1){var n=""+go.REFRESH_TOKEN+vo.CACHE_KEY_SEPARATOR+this.clientId+vo.CACHE_KEY_SEPARATOR,r=""+go.REFRESH_TOKEN+vo.CACHE_KEY_SEPARATOR+So+vo.CACHE_KEY_SEPARATOR;if(-1===t.indexOf(n.toLowerCase())&&-1===t.indexOf(r.toLowerCase()))return!1}else if(-1===t.indexOf(this.clientId.toLowerCase()))return!1;return!0},e.prototype.credentialMatchesFilter=function(e,t){if(t.clientId&&!this.matchClientId(e,t.clientId))return!1;if(t.userAssertionHash&&!this.matchUserAssertionHash(e,t.userAssertionHash))return!1;if("string"===typeof t.homeAccountId&&!this.matchHomeAccountId(e,t.homeAccountId))return!1;if(t.environment&&!this.matchEnvironment(e,t.environment))return!1;if(t.realm&&!this.matchRealm(e,t.realm))return!1;if(t.credentialType&&!this.matchCredentialType(e,t.credentialType))return!1;if(t.familyId&&!this.matchFamilyId(e,t.familyId))return!1;if(t.target&&!this.matchTarget(e,t.target))return!1;if((t.requestedClaimsHash||e.requestedClaimsHash)&&e.requestedClaimsHash!==t.requestedClaimsHash)return!1;if(e.credentialType===go.ACCESS_TOKEN_WITH_AUTH_SCHEME){if(t.tokenType&&!this.matchTokenType(e,t.tokenType))return!1;if(t.tokenType===xo.SSH&&t.keyId&&!this.matchKeyId(e,t.keyId))return!1}return!0},e.prototype.getAppMetadataFilteredBy=function(e){return this.getAppMetadataFilteredByInternal(e.environment,e.clientId)},e.prototype.getAppMetadataFilteredByInternal=function(e,t){var n=this,r=this.getKeys(),i={};return r.forEach((function(r){if(n.isAppMetadata(r)){var o=n.getAppMetadata(r);o&&(e&&!n.matchEnvironment(o,e)||t&&!n.matchClientId(o,t)||(i[r]=o))}})),i},e.prototype.getAuthorityMetadataByAlias=function(e){var t=this,n=this.getAuthorityMetadataKeys(),r=null;return n.forEach((function(n){if(t.isAuthorityMetadata(n)&&-1!==n.indexOf(t.clientId)){var i=t.getAuthorityMetadata(n);i&&-1!==i.aliases.indexOf(e)&&(r=i)}})),r},e.prototype.removeAllAccounts=function(){return Xi(this,void 0,void 0,(function(){var e,t,n=this;return $i(this,(function(r){switch(r.label){case 0:return e=this.getAccountKeys(),t=[],e.forEach((function(e){t.push(n.removeAccount(e))})),[4,Promise.all(t)];case 1:return r.sent(),[2]}}))}))},e.prototype.removeAccount=function(e){return Xi(this,void 0,void 0,(function(){var t;return $i(this,(function(n){switch(n.label){case 0:if(!(t=this.getAccount(e)))throw bs.createNoAccountFoundError();return[4,this.removeAccountContext(t)];case 1:return n.sent(),this.removeItem(e),[2]}}))}))},e.prototype.removeAccountContext=function(e){return Xi(this,void 0,void 0,(function(){var t,n,r,i=this;return $i(this,(function(o){switch(o.label){case 0:return t=this.getTokenKeys(),n=e.generateAccountId(),r=[],t.idToken.forEach((function(e){0===e.indexOf(n)&&i.removeIdToken(e)})),t.accessToken.forEach((function(e){0===e.indexOf(n)&&r.push(i.removeAccessToken(e))})),t.refreshToken.forEach((function(e){0===e.indexOf(n)&&i.removeRefreshToken(e)})),[4,Promise.all(r)];case 1:return o.sent(),[2]}}))}))},e.prototype.removeAccessToken=function(e){return Xi(this,void 0,void 0,(function(){var t,n;return $i(this,(function(r){switch(r.label){case 0:if(!(t=this.getAccessTokenCredential(e)))return[2];if(t.credentialType.toLowerCase()!==go.ACCESS_TOKEN_WITH_AUTH_SCHEME.toLowerCase())return[3,4];if(t.tokenType!==xo.POP)return[3,4];if(!(n=t.keyId))return[3,4];r.label=1;case 1:return r.trys.push([1,3,,4]),[4,this.cryptoImpl.removeTokenBindingKey(n)];case 2:return r.sent(),[3,4];case 3:throw r.sent(),bs.createBindingKeyNotRemovedError();case 4:return[2,this.removeItem(e)]}}))}))},e.prototype.removeAppMetadata=function(){var e=this;return this.getKeys().forEach((function(t){e.isAppMetadata(t)&&e.removeItem(t)})),!0},e.prototype.readCacheRecord=function(e,t,n){var r=this.getTokenKeys(),i=this.readAccountFromCache(e),o=this.getIdToken(e,r),a=this.getAccessToken(e,t,r),s=this.getRefreshToken(e,!1,r),u=this.readAppMetadataFromCache(n);return i&&o&&(i.idTokenClaims=new mc(o.secret,this.cryptoImpl).claims),{account:i,idToken:o,accessToken:a,refreshToken:s,appMetadata:u}},e.prototype.readAccountFromCache=function(e){var t=gc.generateAccountCacheKey(e);return this.getAccount(t)},e.prototype.getIdToken=function(e,t){this.commonLogger.trace("CacheManager - getIdToken called");var n={homeAccountId:e.homeAccountId,environment:e.environment,credentialType:go.ID_TOKEN,clientId:this.clientId,realm:e.tenantId},r=this.getIdTokensByFilter(n,t),i=r.length;if(i<1)return this.commonLogger.info("CacheManager:getIdToken - No token found"),null;if(i>1)throw bs.createMultipleMatchingTokensInCacheError();return this.commonLogger.info("CacheManager:getIdToken - Returning id token"),r[0]},e.prototype.getIdTokensByFilter=function(e,t){var n=this,r=t&&t.idToken||this.getTokenKeys().idToken,i=[];return r.forEach((function(t){if(n.idTokenKeyMatchesFilter(t,Yi({clientId:n.clientId},e))){var r=n.getIdTokenCredential(t);r&&n.credentialMatchesFilter(r,e)&&i.push(r)}})),i},e.prototype.idTokenKeyMatchesFilter=function(e,t){var n=e.toLowerCase();return(!t.clientId||-1!==n.indexOf(t.clientId.toLowerCase()))&&(!t.homeAccountId||-1!==n.indexOf(t.homeAccountId.toLowerCase()))},e.prototype.removeIdToken=function(e){this.removeItem(e)},e.prototype.removeRefreshToken=function(e){this.removeItem(e)},e.prototype.getAccessToken=function(e,t,n){var r=this;this.commonLogger.trace("CacheManager - getAccessToken called");var i=hc.createSearchScopes(t.scopes),o=t.authenticationScheme||xo.BEARER,a=o&&o.toLowerCase()!==xo.BEARER.toLowerCase()?go.ACCESS_TOKEN_WITH_AUTH_SCHEME:go.ACCESS_TOKEN,s={homeAccountId:e.homeAccountId,environment:e.environment,credentialType:a,clientId:this.clientId,realm:e.tenantId,target:i,tokenType:o,keyId:t.sshKid,requestedClaimsHash:t.requestedClaimsHash},u=n&&n.accessToken||this.getTokenKeys().accessToken,c=[];u.forEach((function(e){if(r.accessTokenKeyMatchesFilter(e,s,!0)){var t=r.getAccessTokenCredential(e);t&&r.credentialMatchesFilter(t,s)&&c.push(t)}}));var l=c.length;if(l<1)return this.commonLogger.info("CacheManager:getAccessToken - No token found"),null;if(l>1)throw bs.createMultipleMatchingTokensInCacheError();return this.commonLogger.info("CacheManager:getAccessToken - Returning access token"),c[0]},e.prototype.accessTokenKeyMatchesFilter=function(e,t,n){var r=e.toLowerCase();if(t.clientId&&-1===r.indexOf(t.clientId.toLowerCase()))return!1;if(t.homeAccountId&&-1===r.indexOf(t.homeAccountId.toLowerCase()))return!1;if(t.realm&&-1===r.indexOf(t.realm.toLowerCase()))return!1;if(t.requestedClaimsHash&&-1===r.indexOf(t.requestedClaimsHash.toLowerCase()))return!1;if(t.target)for(var i=t.target.asArray(),o=0;o<i.length;o++){if(n&&!r.includes(i[o].toLowerCase()))return!1;if(!n&&r.includes(i[o].toLowerCase()))return!0}return!0},e.prototype.getAccessTokensByFilter=function(e){var t=this,n=this.getTokenKeys(),r=[];return n.accessToken.forEach((function(n){if(t.accessTokenKeyMatchesFilter(n,e,!0)){var i=t.getAccessTokenCredential(n);i&&t.credentialMatchesFilter(i,e)&&r.push(i)}})),r},e.prototype.getRefreshToken=function(e,t,n){var r=this;this.commonLogger.trace("CacheManager - getRefreshToken called");var i=t?So:void 0,o={homeAccountId:e.homeAccountId,environment:e.environment,credentialType:go.REFRESH_TOKEN,clientId:this.clientId,familyId:i},a=n&&n.refreshToken||this.getTokenKeys().refreshToken,s=[];return a.forEach((function(e){if(r.refreshTokenKeyMatchesFilter(e,o)){var t=r.getRefreshTokenCredential(e);t&&r.credentialMatchesFilter(t,o)&&s.push(t)}})),s.length<1?(this.commonLogger.info("CacheManager:getRefreshToken - No refresh token found."),null):(this.commonLogger.info("CacheManager:getRefreshToken - returning refresh token"),s[0])},e.prototype.refreshTokenKeyMatchesFilter=function(e,t){var n=e.toLowerCase();return(!t.familyId||-1!==n.indexOf(t.familyId.toLowerCase()))&&(!(!t.familyId&&t.clientId&&-1===n.indexOf(t.clientId.toLowerCase()))&&(!t.homeAccountId||-1!==n.indexOf(t.homeAccountId.toLowerCase())))},e.prototype.readAppMetadataFromCache=function(e){var t={environment:e,clientId:this.clientId},n=this.getAppMetadataFilteredBy(t),r=Object.keys(n).map((function(e){return n[e]})),i=r.length;if(i<1)return null;if(i>1)throw bs.createMultipleMatchingAppMetadataInCacheError();return r[0]},e.prototype.isAppMetadataFOCI=function(e){var t=this.readAppMetadataFromCache(e);return!(!t||t.familyId!==So)},e.prototype.matchHomeAccountId=function(e,t){return!("string"!==typeof e.homeAccountId||t!==e.homeAccountId)},e.prototype.matchLocalAccountId=function(e,t){return!("string"!==typeof e.localAccountId||t!==e.localAccountId)},e.prototype.matchUsername=function(e,t){return!("string"!==typeof e.username||t.toLowerCase()!==e.username.toLowerCase())},e.prototype.matchUserAssertionHash=function(e,t){return!(!e.userAssertionHash||t!==e.userAssertionHash)},e.prototype.matchEnvironment=function(e,t){var n=this.getAuthorityMetadataByAlias(t);return!!(n&&n.aliases.indexOf(e.environment)>-1)},e.prototype.matchCredentialType=function(e,t){return e.credentialType&&t.toLowerCase()===e.credentialType.toLowerCase()},e.prototype.matchClientId=function(e,t){return!(!e.clientId||t!==e.clientId)},e.prototype.matchFamilyId=function(e,t){return!(!e.familyId||t!==e.familyId)},e.prototype.matchRealm=function(e,t){return!(!e.realm||t!==e.realm)},e.prototype.matchNativeAccountId=function(e,t){return!(!e.nativeAccountId||t!==e.nativeAccountId)},e.prototype.matchTarget=function(e,t){return!(e.credentialType!==go.ACCESS_TOKEN&&e.credentialType!==go.ACCESS_TOKEN_WITH_AUTH_SCHEME||!e.target)&&hc.fromString(e.target).containsScopeSet(t)},e.prototype.matchTokenType=function(e,t){return!(!e.tokenType||e.tokenType!==t)},e.prototype.matchKeyId=function(e,t){return!(!e.keyId||e.keyId!==t)},e.prototype.isAppMetadata=function(e){return-1!==e.indexOf(wo)},e.prototype.isAuthorityMetadata=function(e){return-1!==e.indexOf(ko)},e.prototype.generateAuthorityMetadataCacheKey=function(e){return ko+"-"+this.clientId+"-"+e},e.toObject=function(e,t){for(var n in t)e[n]=t[n];return e},e}(),Sc=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Qi(t,e),t.prototype.setAccount=function(){throw Jo.createUnexpectedError("Storage interface - setAccount() has not been implemented for the cacheStorage interface.")},t.prototype.getAccount=function(){throw Jo.createUnexpectedError("Storage interface - getAccount() has not been implemented for the cacheStorage interface.")},t.prototype.setIdTokenCredential=function(){throw Jo.createUnexpectedError("Storage interface - setIdTokenCredential() has not been implemented for the cacheStorage interface.")},t.prototype.getIdTokenCredential=function(){throw Jo.createUnexpectedError("Storage interface - getIdTokenCredential() has not been implemented for the cacheStorage interface.")},t.prototype.setAccessTokenCredential=function(){throw Jo.createUnexpectedError("Storage interface - setAccessTokenCredential() has not been implemented for the cacheStorage interface.")},t.prototype.getAccessTokenCredential=function(){throw Jo.createUnexpectedError("Storage interface - getAccessTokenCredential() has not been implemented for the cacheStorage interface.")},t.prototype.setRefreshTokenCredential=function(){throw Jo.createUnexpectedError("Storage interface - setRefreshTokenCredential() has not been implemented for the cacheStorage interface.")},t.prototype.getRefreshTokenCredential=function(){throw Jo.createUnexpectedError("Storage interface - getRefreshTokenCredential() has not been implemented for the cacheStorage interface.")},t.prototype.setAppMetadata=function(){throw Jo.createUnexpectedError("Storage interface - setAppMetadata() has not been implemented for the cacheStorage interface.")},t.prototype.getAppMetadata=function(){throw Jo.createUnexpectedError("Storage interface - getAppMetadata() has not been implemented for the cacheStorage interface.")},t.prototype.setServerTelemetry=function(){throw Jo.createUnexpectedError("Storage interface - setServerTelemetry() has not been implemented for the cacheStorage interface.")},t.prototype.getServerTelemetry=function(){throw Jo.createUnexpectedError("Storage interface - getServerTelemetry() has not been implemented for the cacheStorage interface.")},t.prototype.setAuthorityMetadata=function(){throw Jo.createUnexpectedError("Storage interface - setAuthorityMetadata() has not been implemented for the cacheStorage interface.")},t.prototype.getAuthorityMetadata=function(){throw Jo.createUnexpectedError("Storage interface - getAuthorityMetadata() has not been implemented for the cacheStorage interface.")},t.prototype.getAuthorityMetadataKeys=function(){throw Jo.createUnexpectedError("Storage interface - getAuthorityMetadataKeys() has not been implemented for the cacheStorage interface.")},t.prototype.setThrottlingCache=function(){throw Jo.createUnexpectedError("Storage interface - setThrottlingCache() has not been implemented for the cacheStorage interface.")},t.prototype.getThrottlingCache=function(){throw Jo.createUnexpectedError("Storage interface - getThrottlingCache() has not been implemented for the cacheStorage interface.")},t.prototype.removeItem=function(){throw Jo.createUnexpectedError("Storage interface - removeItem() has not been implemented for the cacheStorage interface.")},t.prototype.containsKey=function(){throw Jo.createUnexpectedError("Storage interface - containsKey() has not been implemented for the cacheStorage interface.")},t.prototype.getKeys=function(){throw Jo.createUnexpectedError("Storage interface - getKeys() has not been implemented for the cacheStorage interface.")},t.prototype.getAccountKeys=function(){throw Jo.createUnexpectedError("Storage interface - getAccountKeys() has not been implemented for the cacheStorage interface.")},t.prototype.getTokenKeys=function(){throw Jo.createUnexpectedError("Storage interface - getTokenKeys() has not been implemented for the cacheStorage interface.")},t.prototype.clear=function(){return Xi(this,void 0,void 0,(function(){return $i(this,(function(e){throw"Storage interface - clear() has not been implemented for the cacheStorage interface.",Jo.createUnexpectedError("Storage interface - clear() has not been implemented for the cacheStorage interface.")}))}))},t.prototype.updateCredentialCacheKey=function(){throw Jo.createUnexpectedError("Storage interface - updateCredentialCacheKey() has not been implemented for the cacheStorage interface.")},t}(wc),kc=function(){function e(){}return e.nowSeconds=function(){return Math.round((new Date).getTime()/1e3)},e.isTokenExpired=function(t,n){var r=Number(t)||0;return e.nowSeconds()+n>r},e.wasClockTurnedBack=function(t){return Number(t)>e.nowSeconds()},e.delay=function(e,t){return new Promise((function(n){return setTimeout((function(){return n(t)}),e)}))},e}(),Cc=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Qi(t,e),t.createAccessTokenEntity=function(e,n,r,i,o,a,s,u,c,l,d,h,f,p,v){var g,m,y=new t;y.homeAccountId=e,y.credentialType=go.ACCESS_TOKEN,y.secret=r;var b=kc.nowSeconds();if(y.cachedAt=b.toString(),y.expiresOn=s.toString(),y.extendedExpiresOn=u.toString(),l&&(y.refreshOn=l.toString()),y.environment=n,y.clientId=i,y.realm=o,y.target=a,y.userAssertionHash=h,y.tokenType=ws.isEmpty(d)?xo.BEARER:d,p&&(y.requestedClaims=p,y.requestedClaimsHash=v),(null===(g=y.tokenType)||void 0===g?void 0:g.toLowerCase())!==xo.BEARER.toLowerCase())switch(y.credentialType=go.ACCESS_TOKEN_WITH_AUTH_SCHEME,y.tokenType){case xo.POP:var w=mc.extractTokenClaims(r,c);if(!(null===(m=null===w||void 0===w?void 0:w.cnf)||void 0===m?void 0:m.kid))throw bs.createTokenClaimsRequiredError();y.keyId=w.cnf.kid;break;case xo.SSH:y.keyId=f}return y},t.isAccessTokenEntity=function(e){return!!e&&(e.hasOwnProperty("homeAccountId")&&e.hasOwnProperty("environment")&&e.hasOwnProperty("credentialType")&&e.hasOwnProperty("realm")&&e.hasOwnProperty("clientId")&&e.hasOwnProperty("secret")&&e.hasOwnProperty("target")&&(e.credentialType===go.ACCESS_TOKEN||e.credentialType===go.ACCESS_TOKEN_WITH_AUTH_SCHEME))},t}(qu),xc=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Qi(t,e),t.createRefreshTokenEntity=function(e,n,r,i,o,a){var s=new t;return s.clientId=i,s.credentialType=go.REFRESH_TOKEN,s.environment=n,s.homeAccountId=e,s.secret=r,s.userAssertionHash=a,o&&(s.familyId=o),s},t.isRefreshTokenEntity=function(e){return!!e&&(e.hasOwnProperty("homeAccountId")&&e.hasOwnProperty("environment")&&e.hasOwnProperty("credentialType")&&e.hasOwnProperty("clientId")&&e.hasOwnProperty("secret")&&e.credentialType===go.REFRESH_TOKEN)},t}(qu),Ec=function(){function e(){}return e.prototype.generateAppMetadataKey=function(){return e.generateAppMetadataCacheKey(this.environment,this.clientId)},e.generateAppMetadataCacheKey=function(e,t){return[wo,e,t].join(vo.CACHE_KEY_SEPARATOR).toLowerCase()},e.createAppMetadataEntity=function(t,n,r){var i=new e;return i.clientId=t,i.environment=n,r&&(i.familyId=r),i},e.isAppMetadataEntity=function(e,t){return!!t&&(0===e.indexOf(wo)&&t.hasOwnProperty("clientId")&&t.hasOwnProperty("environment"))},e}(),Tc=function(){function e(){this.failedRequests=[],this.errors=[],this.cacheHits=0}return e.isServerTelemetryEntity=function(e,t){var n=0===e.indexOf(Eo.CACHE_KEY),r=!0;return t&&(r=t.hasOwnProperty("failedRequests")&&t.hasOwnProperty("errors")&&t.hasOwnProperty("cacheHits")),n&&r},e}(),Ic=function(){function e(){this.expiresAt=kc.nowSeconds()+Co}return e.prototype.updateCloudDiscoveryMetadata=function(e,t){this.aliases=e.aliases,this.preferred_cache=e.preferred_cache,this.preferred_network=e.preferred_network,this.aliasesFromNetwork=t},e.prototype.updateEndpointMetadata=function(e,t){this.authorization_endpoint=e.authorization_endpoint,this.token_endpoint=e.token_endpoint,this.end_session_endpoint=e.end_session_endpoint,this.issuer=e.issuer,this.endpointsFromNetwork=t,this.jwks_uri=e.jwks_uri},e.prototype.updateCanonicalAuthority=function(e){this.canonical_authority=e},e.prototype.resetExpiresAt=function(){this.expiresAt=kc.nowSeconds()+Co},e.prototype.isExpired=function(){return this.expiresAt<=kc.nowSeconds()},e.isAuthorityMetadataEntity=function(e,t){return!!t&&(0===e.indexOf(ko)&&t.hasOwnProperty("aliases")&&t.hasOwnProperty("preferred_cache")&&t.hasOwnProperty("preferred_network")&&t.hasOwnProperty("canonical_authority")&&t.hasOwnProperty("authorization_endpoint")&&t.hasOwnProperty("token_endpoint")&&t.hasOwnProperty("issuer")&&t.hasOwnProperty("aliasesFromNetwork")&&t.hasOwnProperty("endpointsFromNetwork")&&t.hasOwnProperty("expiresAt")&&t.hasOwnProperty("jwks_uri"))},e}(),Ac=function(){function e(){}return e.isThrottlingEntity=function(e,t){var n=!1;e&&(n=0===e.indexOf(Mo));var r=!0;return t&&(r=t.hasOwnProperty("throttleTime")),n&&r},e}(),Rc=function(){function e(){}return e.setRequestState=function(t,n,r){var i=e.generateLibraryState(t,r);return ws.isEmpty(n)?i:""+i+ao.RESOURCE_DELIM+n},e.generateLibraryState=function(e,t){if(!e)throw bs.createNoCryptoObjectError("generateLibraryState");var n={id:e.createNewGuid()};t&&(n.meta=t);var r=JSON.stringify(n);return e.base64Encode(r)},e.parseRequestState=function(e,t){if(!e)throw bs.createNoCryptoObjectError("parseRequestState");if(ws.isEmpty(t))throw bs.createInvalidStateError(t,"Null, undefined or empty state");try{var n=t.split(ao.RESOURCE_DELIM),r=n[0],i=n.length>1?n.slice(1).join(ao.RESOURCE_DELIM):ao.EMPTY_STRING,o=e.base64Decode(r),a=JSON.parse(o);return{userRequestState:ws.isEmpty(i)?ao.EMPTY_STRING:i,libraryState:a}}catch(Oi){throw bs.createInvalidStateError(t,Oi)}},e}();!function(e){e.HOME_ACCOUNT_ID="home_account_id",e.UPN="UPN"}(vc||(vc={}));var _c,Pc,Nc=function(){function e(e){this.validateWindowStorage(e),this.windowStorage=window[e]}return e.prototype.validateWindowStorage=function(e){if(e!==Bo.LocalStorage&&e!==Bo.SessionStorage)throw xu.createStorageNotSupportedError(e);if(!!!window[e])throw xu.createStorageNotSupportedError(e)},e.prototype.getItem=function(e){return this.windowStorage.getItem(e)},e.prototype.setItem=function(e,t){this.windowStorage.setItem(e,t)},e.prototype.removeItem=function(e){this.windowStorage.removeItem(e)},e.prototype.getKeys=function(){return Object.keys(this.windowStorage)},e.prototype.containsKey=function(e){return this.windowStorage.hasOwnProperty(e)},e}(),Oc=function(){function e(t){if(this._urlString=t,ws.isEmpty(this._urlString))throw dc.createUrlEmptyError();ws.isEmpty(this.getHash())&&(this._urlString=e.canonicalizeUri(t))}return Object.defineProperty(e.prototype,"urlString",{get:function(){return this._urlString},enumerable:!1,configurable:!0}),e.canonicalizeUri=function(e){if(e){var t=e.toLowerCase();return ws.endsWith(t,"?")?t=t.slice(0,-1):ws.endsWith(t,"?/")&&(t=t.slice(0,-2)),ws.endsWith(t,"/")||(t+="/"),t}return e},e.prototype.validateAsUri=function(){var e;try{e=this.getUrlComponents()}catch(Oi){throw dc.createUrlParseError(Oi)}if(!e.HostNameAndPort||!e.PathSegments)throw dc.createUrlParseError("Given url string: "+this.urlString);if(!e.Protocol||"https:"!==e.Protocol.toLowerCase())throw dc.createInsecureAuthorityUriError(this.urlString)},e.appendQueryString=function(e,t){return ws.isEmpty(t)?e:e.indexOf("?")<0?e+"?"+t:e+"&"+t},e.removeHashFromUrl=function(t){return e.canonicalizeUri(t.split("#")[0])},e.prototype.replaceTenantPath=function(t){var n=this.getUrlComponents(),r=n.PathSegments;return!t||0===r.length||r[0]!==ro.COMMON&&r[0]!==ro.ORGANIZATIONS||(r[0]=t),e.constructAuthorityUriFromObject(n)},e.prototype.getHash=function(){return e.parseHash(this.urlString)},e.prototype.getUrlComponents=function(){var e=RegExp("^(([^:/?#]+):)?(//([^/?#]*))?([^?#]*)(\\?([^#]*))?(#(.*))?"),t=this.urlString.match(e);if(!t)throw dc.createUrlParseError("Given url string: "+this.urlString);var n={Protocol:t[1],HostNameAndPort:t[4],AbsolutePath:t[5],QueryString:t[7]},r=n.AbsolutePath.split("/");return r=r.filter((function(e){return e&&e.length>0})),n.PathSegments=r,!ws.isEmpty(n.QueryString)&&n.QueryString.endsWith("/")&&(n.QueryString=n.QueryString.substring(0,n.QueryString.length-1)),n},e.getDomainFromUrl=function(e){var t=RegExp("^([^:/?#]+://)?([^/?#]*)"),n=e.match(t);if(!n)throw dc.createUrlParseError("Given url string: "+e);return n[2]},e.getAbsoluteUrl=function(t,n){if(t[0]===ao.FORWARD_SLASH){var r=new e(n).getUrlComponents();return r.Protocol+"//"+r.HostNameAndPort+t}return t},e.parseHash=function(e){var t=e.indexOf("#"),n=e.indexOf("#/");return n>-1?e.substring(n+2):t>-1?e.substring(t+1):ao.EMPTY_STRING},e.parseQueryString=function(e){var t=e.indexOf("?"),n=e.indexOf("/?");return n>-1?e.substring(n+2):t>-1?e.substring(t+1):ao.EMPTY_STRING},e.constructAuthorityUriFromObject=function(t){return new e(t.Protocol+"//"+t.HostNameAndPort+"/"+t.PathSegments.join("/"))},e.getDeserializedHash=function(t){if(ws.isEmpty(t))return{};var n=e.parseHash(t),r=ws.queryStringToObject(ws.isEmpty(n)?t:n);if(!r)throw bs.createHashNotDeserializedError(JSON.stringify(r));return r},e.getDeserializedQueryString=function(t){if(ws.isEmpty(t))return{};var n=e.parseQueryString(t),r=ws.queryStringToObject(ws.isEmpty(n)?t:n);if(!r)throw bs.createHashNotDeserializedError(JSON.stringify(r));return r},e.hashContainsKnownProperties=function(t){if(ws.isEmpty(t)||t.indexOf("=")<0)return!1;var n=e.getDeserializedHash(t);return!!(n.code||n.error_description||n.error||n.state)},e}(),Mc=function(){function e(){}return e.extractBrowserRequestState=function(e,t){if(ws.isEmpty(t))return null;try{return Rc.parseRequestState(e,t).libraryState.meta}catch(Oi){throw bs.createInvalidStateError(t,Oi)}},e.parseServerResponseFromHash=function(e){if(!e)return{};var t=new Oc(e);return Oc.getDeserializedHash(t.getHash())},e}(),Fc=function(e){function t(t,n,r,i){var o=e.call(this,t,r,i)||this;return o.COOKIE_LIFE_MULTIPLIER=864e5,o.cacheConfig=n,o.logger=i,o.internalStorage=new Ru,o.browserStorage=o.setupBrowserStorage(o.cacheConfig.cacheLocation),o.temporaryCacheStorage=o.setupTemporaryCacheStorage(o.cacheConfig.temporaryCacheLocation,o.cacheConfig.cacheLocation),n.cacheMigrationEnabled&&(o.migrateCacheEntries(),o.createKeyMaps()),o}return Bi(t,e),t.prototype.setupBrowserStorage=function(e){switch(e){case Bo.LocalStorage:case Bo.SessionStorage:try{return new Nc(e)}catch(Oi){this.logger.verbose(Oi);break}}return this.cacheConfig.cacheLocation=Bo.MemoryStorage,new Ru},t.prototype.setupTemporaryCacheStorage=function(e,t){switch(t){case Bo.LocalStorage:case Bo.SessionStorage:try{return new Nc(e||Bo.SessionStorage)}catch(Oi){return this.logger.verbose(Oi),this.internalStorage}case Bo.MemoryStorage:default:return this.internalStorage}},t.prototype.migrateCacheEntries=function(){var e=this,t=ao.CACHE_PREFIX+"."+no.ID_TOKEN,n=ao.CACHE_PREFIX+"."+no.CLIENT_INFO,r=ao.CACHE_PREFIX+"."+no.ERROR,i=ao.CACHE_PREFIX+"."+no.ERROR_DESC,o=[this.browserStorage.getItem(t),this.browserStorage.getItem(n),this.browserStorage.getItem(r),this.browserStorage.getItem(i)];[no.ID_TOKEN,no.CLIENT_INFO,no.ERROR,no.ERROR_DESC].forEach((function(t,n){return e.migrateCacheEntry(t,o[n])}))},t.prototype.migrateCacheEntry=function(e,t){t&&this.setTemporaryCache(e,t,!0)},t.prototype.createKeyMaps=function(){var e=this;this.logger.trace("BrowserCacheManager - createKeyMaps called.");var t=this.getItem(Uo.ACCOUNT_KEYS),n=this.getItem(Uo.TOKEN_KEYS+"."+this.clientId);t&&n?this.logger.verbose("BrowserCacheManager:createKeyMaps - account and token key maps already exist, skipping migration."):this.browserStorage.getKeys().forEach((function(t){var n;if(e.isCredentialKey(t)&&(n=e.getItem(t))){var r=e.validateAndParseJson(n);if(r&&r.hasOwnProperty("credentialType"))switch(r.credentialType){case go.ID_TOKEN:if(ju.isIdTokenEntity(r)){e.logger.trace("BrowserCacheManager:createKeyMaps - idToken found, saving key to token key map"),e.logger.tracePii("BrowserCacheManager:createKeyMaps - idToken with key: "+t+" found, saving key to token key map");var i=wc.toObject(new ju,r),o=e.updateCredentialCacheKey(t,i);return void e.addTokenKey(o,go.ID_TOKEN)}e.logger.trace("BrowserCacheManager:createKeyMaps - key found matching idToken schema with value containing idToken credentialType field but value failed IdTokenEntity validation, skipping."),e.logger.tracePii("BrowserCacheManager:createKeyMaps - failed idToken validation on key: "+t);break;case go.ACCESS_TOKEN:case go.ACCESS_TOKEN_WITH_AUTH_SCHEME:if(Cc.isAccessTokenEntity(r)){e.logger.trace("BrowserCacheManager:createKeyMaps - accessToken found, saving key to token key map"),e.logger.tracePii("BrowserCacheManager:createKeyMaps - accessToken with key: "+t+" found, saving key to token key map");var a=wc.toObject(new Cc,r);o=e.updateCredentialCacheKey(t,a);return void e.addTokenKey(o,go.ACCESS_TOKEN)}e.logger.trace("BrowserCacheManager:createKeyMaps - key found matching accessToken schema with value containing accessToken credentialType field but value failed AccessTokenEntity validation, skipping."),e.logger.tracePii("BrowserCacheManager:createKeyMaps - failed accessToken validation on key: "+t);break;case go.REFRESH_TOKEN:if(xc.isRefreshTokenEntity(r)){e.logger.trace("BrowserCacheManager:createKeyMaps - refreshToken found, saving key to token key map"),e.logger.tracePii("BrowserCacheManager:createKeyMaps - refreshToken with key: "+t+" found, saving key to token key map");var s=wc.toObject(new xc,r);o=e.updateCredentialCacheKey(t,s);return void e.addTokenKey(o,go.REFRESH_TOKEN)}e.logger.trace("BrowserCacheManager:createKeyMaps - key found matching refreshToken schema with value containing refreshToken credentialType field but value failed RefreshTokenEntity validation, skipping."),e.logger.tracePii("BrowserCacheManager:createKeyMaps - failed refreshToken validation on key: "+t)}}if(e.isAccountKey(t)&&(n=e.getItem(t))){var u=e.validateAndParseJson(n);u&&gc.isAccountEntity(u)&&(e.logger.trace("BrowserCacheManager:createKeyMaps - account found, saving key to account key map"),e.logger.tracePii("BrowserCacheManager:createKeyMaps - account with key: "+t+" found, saving key to account key map"),e.addAccountKeyToMap(t))}}))},t.prototype.validateAndParseJson=function(e){try{var t=JSON.parse(e);return t&&"object"===typeof t?t:null}catch(n){return null}},t.prototype.getItem=function(e){return this.browserStorage.getItem(e)},t.prototype.setItem=function(e,t){this.browserStorage.setItem(e,t)},t.prototype.getAccount=function(e){this.logger.trace("BrowserCacheManager.getAccount called");var t=this.getItem(e);if(!t)return this.removeAccountKeyFromMap(e),null;var n=this.validateAndParseJson(t);return n&&gc.isAccountEntity(n)?wc.toObject(new gc,n):(this.removeAccountKeyFromMap(e),null)},t.prototype.setAccount=function(e){this.logger.trace("BrowserCacheManager.setAccount called");var t=e.generateAccountKey();this.setItem(t,JSON.stringify(e)),this.addAccountKeyToMap(t)},t.prototype.getAccountKeys=function(){this.logger.trace("BrowserCacheManager.getAccountKeys called");var e=this.getItem(Uo.ACCOUNT_KEYS);return e?JSON.parse(e):(this.logger.verbose("BrowserCacheManager.getAccountKeys - No account keys found"),[])},t.prototype.addAccountKeyToMap=function(e){this.logger.trace("BrowserCacheManager.addAccountKeyToMap called"),this.logger.tracePii("BrowserCacheManager.addAccountKeyToMap called with key: "+e);var t=this.getAccountKeys();-1===t.indexOf(e)?(t.push(e),this.setItem(Uo.ACCOUNT_KEYS,JSON.stringify(t)),this.logger.verbose("BrowserCacheManager.addAccountKeyToMap account key added")):this.logger.verbose("BrowserCacheManager.addAccountKeyToMap account key already exists in map")},t.prototype.removeAccountKeyFromMap=function(e){this.logger.trace("BrowserCacheManager.removeAccountKeyFromMap called"),this.logger.tracePii("BrowserCacheManager.removeAccountKeyFromMap called with key: "+e);var t=this.getAccountKeys(),n=t.indexOf(e);n>-1?(t.splice(n,1),this.setItem(Uo.ACCOUNT_KEYS,JSON.stringify(t)),this.logger.trace("BrowserCacheManager.removeAccountKeyFromMap account key removed")):this.logger.trace("BrowserCacheManager.removeAccountKeyFromMap key not found in existing map")},t.prototype.removeAccount=function(t){return zi(this,void 0,void 0,(function(){return Vi(this,(function(n){return e.prototype.removeAccount.call(this,t),this.removeAccountKeyFromMap(t),[2]}))}))},t.prototype.removeIdToken=function(t){e.prototype.removeIdToken.call(this,t),this.removeTokenKey(t,go.ID_TOKEN)},t.prototype.removeAccessToken=function(t){return zi(this,void 0,void 0,(function(){return Vi(this,(function(n){return e.prototype.removeAccessToken.call(this,t),this.removeTokenKey(t,go.ACCESS_TOKEN),[2]}))}))},t.prototype.removeRefreshToken=function(t){e.prototype.removeRefreshToken.call(this,t),this.removeTokenKey(t,go.REFRESH_TOKEN)},t.prototype.getTokenKeys=function(){this.logger.trace("BrowserCacheManager.getTokenKeys called");var e=this.getItem(Uo.TOKEN_KEYS+"."+this.clientId);if(e){var t=this.validateAndParseJson(e);if(t&&t.hasOwnProperty("idToken")&&t.hasOwnProperty("accessToken")&&t.hasOwnProperty("refreshToken"))return t;this.logger.error("BrowserCacheManager.getTokenKeys - Token keys found but in an unknown format. Returning empty key map.")}else this.logger.verbose("BrowserCacheManager.getTokenKeys - No token keys found");return{idToken:[],accessToken:[],refreshToken:[]}},t.prototype.addTokenKey=function(e,t){this.logger.trace("BrowserCacheManager addTokenKey called");var n=this.getTokenKeys();switch(t){case go.ID_TOKEN:-1===n.idToken.indexOf(e)&&(this.logger.info("BrowserCacheManager: addTokenKey - idToken added to map"),n.idToken.push(e));break;case go.ACCESS_TOKEN:-1===n.accessToken.indexOf(e)&&(this.logger.info("BrowserCacheManager: addTokenKey - accessToken added to map"),n.accessToken.push(e));break;case go.REFRESH_TOKEN:-1===n.refreshToken.indexOf(e)&&(this.logger.info("BrowserCacheManager: addTokenKey - refreshToken added to map"),n.refreshToken.push(e));break;default:this.logger.error("BrowserCacheManager:addTokenKey - CredentialType provided invalid. CredentialType: "+t),bs.createUnexpectedCredentialTypeError()}this.setItem(Uo.TOKEN_KEYS+"."+this.clientId,JSON.stringify(n))},t.prototype.removeTokenKey=function(e,t){this.logger.trace("BrowserCacheManager removeTokenKey called");var n=this.getTokenKeys();switch(t){case go.ID_TOKEN:this.logger.infoPii("BrowserCacheManager: removeTokenKey - attempting to remove idToken with key: "+e+" from map");var r=n.idToken.indexOf(e);r>-1?(this.logger.info("BrowserCacheManager: removeTokenKey - idToken removed from map"),n.idToken.splice(r,1)):this.logger.info("BrowserCacheManager: removeTokenKey - idToken does not exist in map. Either it was previously removed or it was never added.");break;case go.ACCESS_TOKEN:this.logger.infoPii("BrowserCacheManager: removeTokenKey - attempting to remove accessToken with key: "+e+" from map");var i=n.accessToken.indexOf(e);i>-1?(this.logger.info("BrowserCacheManager: removeTokenKey - accessToken removed from map"),n.accessToken.splice(i,1)):this.logger.info("BrowserCacheManager: removeTokenKey - accessToken does not exist in map. Either it was previously removed or it was never added.");break;case go.REFRESH_TOKEN:this.logger.infoPii("BrowserCacheManager: removeTokenKey - attempting to remove refreshToken with key: "+e+" from map");var o=n.refreshToken.indexOf(e);o>-1?(this.logger.info("BrowserCacheManager: removeTokenKey - refreshToken removed from map"),n.refreshToken.splice(o,1)):this.logger.info("BrowserCacheManager: removeTokenKey - refreshToken does not exist in map. Either it was previously removed or it was never added.");break;default:this.logger.error("BrowserCacheManager:removeTokenKey - CredentialType provided invalid. CredentialType: "+t),bs.createUnexpectedCredentialTypeError()}this.setItem(Uo.TOKEN_KEYS+"."+this.clientId,JSON.stringify(n))},t.prototype.getIdTokenCredential=function(e){var t=this.getItem(e);if(!t)return this.logger.trace("BrowserCacheManager.getIdTokenCredential: called, no cache hit"),this.removeTokenKey(e,go.ID_TOKEN),null;var n=this.validateAndParseJson(t);return n&&ju.isIdTokenEntity(n)?(this.logger.trace("BrowserCacheManager.getIdTokenCredential: cache hit"),wc.toObject(new ju,n)):(this.logger.trace("BrowserCacheManager.getIdTokenCredential: called, no cache hit"),this.removeTokenKey(e,go.ID_TOKEN),null)},t.prototype.setIdTokenCredential=function(e){this.logger.trace("BrowserCacheManager.setIdTokenCredential called");var t=e.generateCredentialKey();this.setItem(t,JSON.stringify(e)),this.addTokenKey(t,go.ID_TOKEN)},t.prototype.getAccessTokenCredential=function(e){var t=this.getItem(e);if(!t)return this.logger.trace("BrowserCacheManager.getAccessTokenCredential: called, no cache hit"),this.removeTokenKey(e,go.ACCESS_TOKEN),null;var n=this.validateAndParseJson(t);return n&&Cc.isAccessTokenEntity(n)?(this.logger.trace("BrowserCacheManager.getAccessTokenCredential: cache hit"),wc.toObject(new Cc,n)):(this.logger.trace("BrowserCacheManager.getAccessTokenCredential: called, no cache hit"),this.removeTokenKey(e,go.ACCESS_TOKEN),null)},t.prototype.setAccessTokenCredential=function(e){this.logger.trace("BrowserCacheManager.setAccessTokenCredential called");var t=e.generateCredentialKey();this.setItem(t,JSON.stringify(e)),this.addTokenKey(t,go.ACCESS_TOKEN)},t.prototype.getRefreshTokenCredential=function(e){var t=this.getItem(e);if(!t)return this.logger.trace("BrowserCacheManager.getRefreshTokenCredential: called, no cache hit"),this.removeTokenKey(e,go.REFRESH_TOKEN),null;var n=this.validateAndParseJson(t);return n&&xc.isRefreshTokenEntity(n)?(this.logger.trace("BrowserCacheManager.getRefreshTokenCredential: cache hit"),wc.toObject(new xc,n)):(this.logger.trace("BrowserCacheManager.getRefreshTokenCredential: called, no cache hit"),this.removeTokenKey(e,go.REFRESH_TOKEN),null)},t.prototype.setRefreshTokenCredential=function(e){this.logger.trace("BrowserCacheManager.setRefreshTokenCredential called");var t=e.generateCredentialKey();this.setItem(t,JSON.stringify(e)),this.addTokenKey(t,go.REFRESH_TOKEN)},t.prototype.getAppMetadata=function(e){var t=this.getItem(e);if(!t)return this.logger.trace("BrowserCacheManager.getAppMetadata: called, no cache hit"),null;var n=this.validateAndParseJson(t);return n&&Ec.isAppMetadataEntity(e,n)?(this.logger.trace("BrowserCacheManager.getAppMetadata: cache hit"),wc.toObject(new Ec,n)):(this.logger.trace("BrowserCacheManager.getAppMetadata: called, no cache hit"),null)},t.prototype.setAppMetadata=function(e){this.logger.trace("BrowserCacheManager.setAppMetadata called");var t=e.generateAppMetadataKey();this.setItem(t,JSON.stringify(e))},t.prototype.getServerTelemetry=function(e){var t=this.getItem(e);if(!t)return this.logger.trace("BrowserCacheManager.getServerTelemetry: called, no cache hit"),null;var n=this.validateAndParseJson(t);return n&&Tc.isServerTelemetryEntity(e,n)?(this.logger.trace("BrowserCacheManager.getServerTelemetry: cache hit"),wc.toObject(new Tc,n)):(this.logger.trace("BrowserCacheManager.getServerTelemetry: called, no cache hit"),null)},t.prototype.setServerTelemetry=function(e,t){this.logger.trace("BrowserCacheManager.setServerTelemetry called"),this.setItem(e,JSON.stringify(t))},t.prototype.getAuthorityMetadata=function(e){var t=this.internalStorage.getItem(e);if(!t)return this.logger.trace("BrowserCacheManager.getAuthorityMetadata: called, no cache hit"),null;var n=this.validateAndParseJson(t);return n&&Ic.isAuthorityMetadataEntity(e,n)?(this.logger.trace("BrowserCacheManager.getAuthorityMetadata: cache hit"),wc.toObject(new Ic,n)):null},t.prototype.getAuthorityMetadataKeys=function(){var e=this;return this.internalStorage.getKeys().filter((function(t){return e.isAuthorityMetadata(t)}))},t.prototype.setWrapperMetadata=function(e,t){this.internalStorage.setItem(Ho.WRAPPER_SKU,e),this.internalStorage.setItem(Ho.WRAPPER_VER,t)},t.prototype.getWrapperMetadata=function(){return[this.internalStorage.getItem(Ho.WRAPPER_SKU)||ao.EMPTY_STRING,this.internalStorage.getItem(Ho.WRAPPER_VER)||ao.EMPTY_STRING]},t.prototype.setAuthorityMetadata=function(e,t){this.logger.trace("BrowserCacheManager.setAuthorityMetadata called"),this.internalStorage.setItem(e,JSON.stringify(t))},t.prototype.getActiveAccount=function(){var e=this.generateCacheKey(no.ACTIVE_ACCOUNT_FILTERS),t=this.getItem(e);if(!t){this.logger.trace("BrowserCacheManager.getActiveAccount: No active account filters cache schema found, looking for legacy schema");var n=this.generateCacheKey(no.ACTIVE_ACCOUNT),r=this.getItem(n);if(!r)return this.logger.trace("BrowserCacheManager.getActiveAccount: No active account found"),null;var i=this.getAccountInfoByFilter({localAccountId:r})[0]||null;return i?(this.logger.trace("BrowserCacheManager.getActiveAccount: Legacy active account cache schema found"),this.logger.trace("BrowserCacheManager.getActiveAccount: Adding active account filters cache schema"),this.setActiveAccount(i),i):null}var o=this.validateAndParseJson(t);return o?(this.logger.trace("BrowserCacheManager.getActiveAccount: Active account filters schema found"),this.getAccountInfoByFilter({homeAccountId:o.homeAccountId,localAccountId:o.localAccountId})[0]||null):(this.logger.trace("BrowserCacheManager.getActiveAccount: No active account found"),null)},t.prototype.setActiveAccount=function(e){var t=this.generateCacheKey(no.ACTIVE_ACCOUNT_FILTERS),n=this.generateCacheKey(no.ACTIVE_ACCOUNT);if(e){this.logger.verbose("setActiveAccount: Active account set");var r={homeAccountId:e.homeAccountId,localAccountId:e.localAccountId};this.browserStorage.setItem(t,JSON.stringify(r)),this.browserStorage.setItem(n,e.localAccountId)}else this.logger.verbose("setActiveAccount: No account passed, active account not set"),this.browserStorage.removeItem(t),this.browserStorage.removeItem(n)},t.prototype.getAccountInfoByFilter=function(e){var t=this.getAllAccounts();return this.logger.trace("BrowserCacheManager.getAccountInfoByFilter: total "+t.length+" accounts found"),t.filter((function(t){return(!e.username||e.username.toLowerCase()===t.username.toLowerCase())&&((!e.homeAccountId||e.homeAccountId===t.homeAccountId)&&((!e.localAccountId||e.localAccountId===t.localAccountId)&&((!e.tenantId||e.tenantId===t.tenantId)&&(!e.environment||e.environment===t.environment))))}))},t.prototype.getAccountInfoByHints=function(e,t){var n=this.getAllAccounts().filter((function(n){if(t){var r=n.idTokenClaims&&n.idTokenClaims.sid;return t===r}return!!e&&e===n.username}));if(1===n.length)return n[0];if(n.length>1)throw bs.createMultipleMatchingAccountsInCacheError();return null},t.prototype.getThrottlingCache=function(e){var t=this.getItem(e);if(!t)return this.logger.trace("BrowserCacheManager.getThrottlingCache: called, no cache hit"),null;var n=this.validateAndParseJson(t);return n&&Ac.isThrottlingEntity(e,n)?(this.logger.trace("BrowserCacheManager.getThrottlingCache: cache hit"),wc.toObject(new Ac,n)):(this.logger.trace("BrowserCacheManager.getThrottlingCache: called, no cache hit"),null)},t.prototype.setThrottlingCache=function(e,t){this.logger.trace("BrowserCacheManager.setThrottlingCache called"),this.setItem(e,JSON.stringify(t))},t.prototype.getTemporaryCache=function(e,t){var n=t?this.generateCacheKey(e):e;if(this.cacheConfig.storeAuthStateInCookie){var r=this.getItemCookie(n);if(r)return this.logger.trace("BrowserCacheManager.getTemporaryCache: storeAuthStateInCookies set to true, retrieving from cookies"),r}var i=this.temporaryCacheStorage.getItem(n);if(!i){if(this.cacheConfig.cacheLocation===Bo.LocalStorage){var o=this.browserStorage.getItem(n);if(o)return this.logger.trace("BrowserCacheManager.getTemporaryCache: Temporary cache item found in local storage"),o}return this.logger.trace("BrowserCacheManager.getTemporaryCache: No cache item found in local storage"),null}return this.logger.trace("BrowserCacheManager.getTemporaryCache: Temporary cache item returned"),i},t.prototype.setTemporaryCache=function(e,t,n){var r=n?this.generateCacheKey(e):e;this.temporaryCacheStorage.setItem(r,t),this.cacheConfig.storeAuthStateInCookie&&(this.logger.trace("BrowserCacheManager.setTemporaryCache: storeAuthStateInCookie set to true, setting item cookie"),this.setItemCookie(r,t))},t.prototype.removeItem=function(e){this.browserStorage.removeItem(e),this.temporaryCacheStorage.removeItem(e),this.cacheConfig.storeAuthStateInCookie&&(this.logger.trace("BrowserCacheManager.removeItem: storeAuthStateInCookie is true, clearing item cookie"),this.clearItemCookie(e))},t.prototype.containsKey=function(e){return this.browserStorage.containsKey(e)||this.temporaryCacheStorage.containsKey(e)},t.prototype.getKeys=function(){return Ki(this.browserStorage.getKeys(),this.temporaryCacheStorage.getKeys())},t.prototype.clear=function(){return zi(this,void 0,void 0,(function(){var e=this;return Vi(this,(function(t){switch(t.label){case 0:return[4,this.removeAllAccounts()];case 1:return t.sent(),this.removeAppMetadata(),this.getKeys().forEach((function(t){!e.browserStorage.containsKey(t)&&!e.temporaryCacheStorage.containsKey(t)||-1===t.indexOf(ao.CACHE_PREFIX)&&-1===t.indexOf(e.clientId)||e.removeItem(t)})),this.internalStorage.clear(),[2]}}))}))},t.prototype.setItemCookie=function(e,t,n){var r=encodeURIComponent(e)+"="+encodeURIComponent(t)+";path=/;SameSite=Lax;";n&&(r+="expires="+this.getCookieExpirationTime(n)+";");this.cacheConfig.secureCookies&&(r+="Secure;"),document.cookie=r},t.prototype.getItemCookie=function(e){for(var t=encodeURIComponent(e)+"=",n=document.cookie.split(";"),r=0;r<n.length;r++){for(var i=n[r];" "===i.charAt(0);)i=i.substring(1);if(0===i.indexOf(t))return decodeURIComponent(i.substring(t.length,i.length))}return ao.EMPTY_STRING},t.prototype.clearMsalCookies=function(){var e=this,t=ao.CACHE_PREFIX+"."+this.clientId;document.cookie.split(";").forEach((function(n){for(;" "===n.charAt(0);)n=n.substring(1);if(0===n.indexOf(t)){var r=n.split("=")[0];e.clearItemCookie(r)}}))},t.prototype.clearItemCookie=function(e){this.setItemCookie(e,ao.EMPTY_STRING,-1)},t.prototype.getCookieExpirationTime=function(e){var t=new Date;return new Date(t.getTime()+e*this.COOKIE_LIFE_MULTIPLIER).toUTCString()},t.prototype.getCache=function(){return this.browserStorage},t.prototype.setCache=function(){},t.prototype.generateCacheKey=function(e){return this.validateAndParseJson(e)?JSON.stringify(e):ws.startsWith(e,ao.CACHE_PREFIX)||ws.startsWith(e,no.ADAL_ID_TOKEN)?e:ao.CACHE_PREFIX+"."+this.clientId+"."+e},t.prototype.generateAuthorityKey=function(e){var t=Rc.parseRequestState(this.cryptoImpl,e).libraryState.id;return this.generateCacheKey(jo.AUTHORITY+"."+t)},t.prototype.generateNonceKey=function(e){var t=Rc.parseRequestState(this.cryptoImpl,e).libraryState.id;return this.generateCacheKey(jo.NONCE_IDTOKEN+"."+t)},t.prototype.generateStateKey=function(e){var t=Rc.parseRequestState(this.cryptoImpl,e).libraryState.id;return this.generateCacheKey(jo.REQUEST_STATE+"."+t)},t.prototype.getCachedAuthority=function(e){var t=this.generateStateKey(e),n=this.getTemporaryCache(t);if(!n)return null;var r=this.generateAuthorityKey(n);return this.getTemporaryCache(r)},t.prototype.updateCacheEntries=function(e,t,n,r,i){this.logger.trace("BrowserCacheManager.updateCacheEntries called");var o=this.generateStateKey(e);this.setTemporaryCache(o,e,!1);var a=this.generateNonceKey(e);this.setTemporaryCache(a,t,!1);var s=this.generateAuthorityKey(e);if(this.setTemporaryCache(s,n,!1),i){var u={credential:i.homeAccountId,type:vc.HOME_ACCOUNT_ID};this.setTemporaryCache(jo.CCS_CREDENTIAL,JSON.stringify(u),!0)}else if(!ws.isEmpty(r)){u={credential:r,type:vc.UPN};this.setTemporaryCache(jo.CCS_CREDENTIAL,JSON.stringify(u),!0)}},t.prototype.resetRequestCache=function(e){var t=this;this.logger.trace("BrowserCacheManager.resetRequestCache called"),ws.isEmpty(e)||this.getKeys().forEach((function(n){-1!==n.indexOf(e)&&t.removeItem(n)})),e&&(this.removeItem(this.generateStateKey(e)),this.removeItem(this.generateNonceKey(e)),this.removeItem(this.generateAuthorityKey(e))),this.removeItem(this.generateCacheKey(jo.REQUEST_PARAMS)),this.removeItem(this.generateCacheKey(jo.ORIGIN_URI)),this.removeItem(this.generateCacheKey(jo.URL_HASH)),this.removeItem(this.generateCacheKey(jo.CORRELATION_ID)),this.removeItem(this.generateCacheKey(jo.CCS_CREDENTIAL)),this.removeItem(this.generateCacheKey(jo.NATIVE_REQUEST)),this.setInteractionInProgress(!1)},t.prototype.cleanRequestByState=function(e){if(this.logger.trace("BrowserCacheManager.cleanRequestByState called"),e){var t=this.generateStateKey(e),n=this.temporaryCacheStorage.getItem(t);this.logger.infoPii("BrowserCacheManager.cleanRequestByState: Removing temporary cache items for state: "+n),this.resetRequestCache(n||ao.EMPTY_STRING)}this.clearMsalCookies()},t.prototype.cleanRequestByInteractionType=function(e){var t=this;this.logger.trace("BrowserCacheManager.cleanRequestByInteractionType called"),this.getKeys().forEach((function(n){if(-1!==n.indexOf(jo.REQUEST_STATE)){var r=t.temporaryCacheStorage.getItem(n);if(r){var i=Mc.extractBrowserRequestState(t.cryptoImpl,r);i&&i.interactionType===e&&(t.logger.infoPii("BrowserCacheManager.cleanRequestByInteractionType: Removing temporary cache items for state: "+r),t.resetRequestCache(r))}}})),this.clearMsalCookies(),this.setInteractionInProgress(!1)},t.prototype.cacheCodeRequest=function(e,t){this.logger.trace("BrowserCacheManager.cacheCodeRequest called");var n=t.base64Encode(JSON.stringify(e));this.setTemporaryCache(jo.REQUEST_PARAMS,n,!0)},t.prototype.getCachedRequest=function(e,t){this.logger.trace("BrowserCacheManager.getCachedRequest called");var n=this.getTemporaryCache(jo.REQUEST_PARAMS,!0);if(!n)throw hu.createNoTokenRequestCacheError();var r=this.validateAndParseJson(t.base64Decode(n));if(!r)throw hu.createUnableToParseTokenRequestCacheError();if(this.removeItem(this.generateCacheKey(jo.REQUEST_PARAMS)),ws.isEmpty(r.authority)){var i=this.generateAuthorityKey(e),o=this.getTemporaryCache(i);if(!o)throw hu.createNoCachedAuthorityError();r.authority=o}return r},t.prototype.getCachedNativeRequest=function(){this.logger.trace("BrowserCacheManager.getCachedNativeRequest called");var e=this.getTemporaryCache(jo.NATIVE_REQUEST,!0);if(!e)return this.logger.trace("BrowserCacheManager.getCachedNativeRequest: No cached native request found"),null;var t=this.validateAndParseJson(e);return t||(this.logger.error("BrowserCacheManager.getCachedNativeRequest: Unable to parse native request"),null)},t.prototype.isInteractionInProgress=function(e){var t=this.getInteractionInProgress();return e?t===this.clientId:!!t},t.prototype.getInteractionInProgress=function(){var e=ao.CACHE_PREFIX+"."+jo.INTERACTION_STATUS_KEY;return this.getTemporaryCache(e,!1)},t.prototype.setInteractionInProgress=function(e){var t=ao.CACHE_PREFIX+"."+jo.INTERACTION_STATUS_KEY;if(e){if(this.getInteractionInProgress())throw hu.createInteractionInProgressError();this.setTemporaryCache(t,this.clientId,!1)}else e||this.getInteractionInProgress()!==this.clientId||this.removeItem(t)},t.prototype.getLegacyLoginHint=function(){var e=this.getTemporaryCache(no.ADAL_ID_TOKEN);e&&(this.browserStorage.removeItem(no.ADAL_ID_TOKEN),this.logger.verbose("Cached ADAL id token retrieved."));var t=this.getTemporaryCache(no.ID_TOKEN,!0);t&&(this.removeItem(this.generateCacheKey(no.ID_TOKEN)),this.logger.verbose("Cached MSAL.js v1 id token retrieved"));var n=t||e;if(n){var r=new mc(n,this.cryptoImpl);if(r.claims&&r.claims.preferred_username)return this.logger.verbose("No SSO params used and ADAL/MSAL v1 token retrieved, setting ADAL/MSAL v1 preferred_username as loginHint"),r.claims.preferred_username;if(r.claims&&r.claims.upn)return this.logger.verbose("No SSO params used and ADAL/MSAL v1 token retrieved, setting ADAL/MSAL v1 upn as loginHint"),r.claims.upn;this.logger.verbose("No SSO params used and ADAL/MSAL v1 token retrieved, however, no account hint claim found. Enable preferred_username or upn id token claim to get SSO.")}return null},t.prototype.updateCredentialCacheKey=function(e,t){var n=t.generateCredentialKey();if(e!==n){var r=this.getItem(e);if(r)return this.removeItem(e),this.setItem(n,r),this.logger.verbose("Updated an outdated "+t.credentialType+" cache key"),n;this.logger.error("Attempted to update an outdated "+t.credentialType+" cache key but no item matching the outdated key was found in storage")}return e},t.prototype.getRedirectRequestContext=function(){return this.getTemporaryCache(jo.REDIRECT_CONTEXT,!0)},t.prototype.setRedirectRequestContext=function(e){this.setTemporaryCache(jo.REDIRECT_CONTEXT,e,!0)},t}(wc);!function(e){e.AAD="AAD",e.OIDC="OIDC"}(_c||(_c={})),function(e){e[e.None=0]="None",e.AzurePublic="https://login.microsoftonline.com",e.AzurePpe="https://login.windows-ppe.net",e.AzureChina="https://login.chinacloudapi.cn",e.AzureGermany="https://login.microsoftonline.de",e.AzureUsGovernment="https://login.microsoftonline.us"}(Pc||(Pc={}));var Zc={tokenRenewalOffsetSeconds:300,preventCorsPreflight:!1},Dc={loggerCallback:function(){},piiLoggingEnabled:!1,logLevel:Pu.Info,correlationId:ao.EMPTY_STRING},Lc={claimsBasedCachingEnabled:!0},Bc={sendGetRequestAsync:function(){return Xi(this,void 0,void 0,(function(){return $i(this,(function(e){throw"Network interface - sendGetRequestAsync() has not been implemented",Jo.createUnexpectedError("Network interface - sendGetRequestAsync() has not been implemented")}))}))},sendPostRequestAsync:function(){return Xi(this,void 0,void 0,(function(){return $i(this,(function(e){throw"Network interface - sendPostRequestAsync() has not been implemented",Jo.createUnexpectedError("Network interface - sendPostRequestAsync() has not been implemented")}))}))}},qc={sku:ao.SKU,version:bc,cpu:ao.EMPTY_STRING,os:ao.EMPTY_STRING},jc={clientSecret:ao.EMPTY_STRING,clientAssertion:void 0},Uc={azureCloudInstance:Pc.None,tenant:""+ao.DEFAULT_COMMON_TENANT},Hc={application:{appName:"",appVersion:""}};var zc={sendGetRequestAsync:function(){return Promise.reject(Jo.createUnexpectedError("Network interface - sendGetRequestAsync() has not been implemented for the Network interface."))},sendPostRequestAsync:function(){return Promise.reject(Jo.createUnexpectedError("Network interface - sendPostRequestAsync() has not been implemented for the Network interface."))}},Vc=function(){function e(){}return e.prototype.sendGetRequestAsync=function(e,t){return zi(this,void 0,void 0,(function(){var n,r,i;return Vi(this,(function(o){switch(o.label){case 0:return o.trys.push([0,2,,3]),[4,fetch(e,{method:qo.GET,headers:this.getFetchHeaders(t)})];case 1:return n=o.sent(),[3,3];case 2:throw r=o.sent(),window.navigator.onLine?hu.createGetRequestFailedError(r,e):hu.createNoNetworkConnectivityError();case 3:return o.trys.push([3,5,,6]),i={headers:this.getHeaderDict(n.headers)},[4,n.json()];case 4:return[2,(i.body=o.sent(),i.status=n.status,i)];case 5:throw o.sent(),hu.createFailedToParseNetworkResponseError(e);case 6:return[2]}}))}))},e.prototype.sendPostRequestAsync=function(e,t){return zi(this,void 0,void 0,(function(){var n,r,i,o;return Vi(this,(function(a){switch(a.label){case 0:n=t&&t.body||ao.EMPTY_STRING,a.label=1;case 1:return a.trys.push([1,3,,4]),[4,fetch(e,{method:qo.POST,headers:this.getFetchHeaders(t),body:n})];case 2:return r=a.sent(),[3,4];case 3:throw i=a.sent(),window.navigator.onLine?hu.createPostRequestFailedError(i,e):hu.createNoNetworkConnectivityError();case 4:return a.trys.push([4,6,,7]),o={headers:this.getHeaderDict(r.headers)},[4,r.json()];case 5:return[2,(o.body=a.sent(),o.status=r.status,o)];case 6:throw a.sent(),hu.createFailedToParseNetworkResponseError(e);case 7:return[2]}}))}))},e.prototype.getFetchHeaders=function(e){var t=new Headers;if(!e||!e.headers)return t;var n=e.headers;return Object.keys(n).forEach((function(e){t.append(e,n[e])})),t},e.prototype.getHeaderDict=function(e){var t={};return e.forEach((function(e,n){t[n]=e})),t},e}(),Gc=function(){function e(){}return e.prototype.sendGetRequestAsync=function(e,t){return zi(this,void 0,void 0,(function(){return Vi(this,(function(n){return[2,this.sendRequestAsync(e,qo.GET,t)]}))}))},e.prototype.sendPostRequestAsync=function(e,t){return zi(this,void 0,void 0,(function(){return Vi(this,(function(n){return[2,this.sendRequestAsync(e,qo.POST,t)]}))}))},e.prototype.sendRequestAsync=function(e,t,n){var r=this;return new Promise((function(i,o){var a=new XMLHttpRequest;if(a.open(t,e,!0),r.setXhrHeaders(a,n),a.onload=function(){(a.status<200||a.status>=300)&&(t===qo.POST?o(hu.createPostRequestFailedError("Failed with status "+a.status,e)):o(hu.createGetRequestFailedError("Failed with status "+a.status,e)));try{var n=JSON.parse(a.responseText),s={headers:r.getHeaderDict(a),body:n,status:a.status};i(s)}catch(Oi){o(hu.createFailedToParseNetworkResponseError(e))}},a.onerror=function(){window.navigator.onLine?t===qo.POST?o(hu.createPostRequestFailedError("Failed with status "+a.status,e)):o(hu.createGetRequestFailedError("Failed with status "+a.status,e)):o(hu.createNoNetworkConnectivityError())},t===qo.POST&&n&&n.body)a.send(n.body);else{if(t!==qo.GET)throw hu.createHttpMethodNotImplementedError(t);a.send()}}))},e.prototype.setXhrHeaders=function(e,t){if(t&&t.headers){var n=t.headers;Object.keys(n).forEach((function(t){e.setRequestHeader(t,n[t])}))}},e.prototype.getHeaderDict=function(e){var t=e.getAllResponseHeaders().trim().split(/[\r\n]+/),n={};return t.forEach((function(e){var t=e.split(": "),r=t.shift(),i=t.join(": ");r&&i&&(n[r]=i)})),n},e}(),Kc=function(){function e(){}return e.clearHash=function(e){e.location.hash=ao.EMPTY_STRING,"function"===typeof e.history.replaceState&&e.history.replaceState(null,ao.EMPTY_STRING,""+e.location.origin+e.location.pathname+e.location.search)},e.replaceHash=function(e){var t=e.split("#");t.shift(),window.location.hash=t.length>0?t.join("#"):ao.EMPTY_STRING},e.isInIframe=function(){return window.parent!==window},e.isInPopup=function(){return"undefined"!==typeof window&&!!window.opener&&window.opener!==window&&"string"===typeof window.name&&0===window.name.indexOf(oa+".")},e.getCurrentUri=function(){return window.location.href.split("?")[0].split("#")[0]},e.getHomepage=function(){var e=new Oc(window.location.href).getUrlComponents();return e.Protocol+"//"+e.HostNameAndPort+"/"},e.getBrowserNetworkClient=function(){return window.fetch&&window.Headers?new Vc:new Gc},e.blockReloadInHiddenIframes=function(){if(Oc.hashContainsKnownProperties(window.location.hash)&&e.isInIframe())throw hu.createBlockReloadInHiddenIframeError()},e.blockRedirectInIframe=function(t,n){var r=e.isInIframe();if(t===Vo.Redirect&&r&&!n)throw hu.createRedirectInIframeError(r)},e.blockAcquireTokenInPopups=function(){if(e.isInPopup())throw hu.createBlockAcquireTokenInPopupsError()},e.blockNonBrowserEnvironment=function(e){if(!e)throw hu.createNonBrowserEnvironmentError()},e.blockNativeBrokerCalledBeforeInitialized=function(e,t){if(e&&!t)throw hu.createNativeBrokerCalledBeforeInitialize()},e.detectIEOrEdge=function(){var e=window.navigator.userAgent,t=e.indexOf("MSIE "),n=e.indexOf("Trident/"),r=e.indexOf("Edge/");return t>0||n>0||r>0},e}(),Wc=function(){function e(){}return e.prototype.navigateInternal=function(t,n){return e.defaultNavigateWindow(t,n)},e.prototype.navigateExternal=function(t,n){return e.defaultNavigateWindow(t,n)},e.defaultNavigateWindow=function(e,t){return t.noHistory?window.location.replace(e):window.location.assign(e),new Promise((function(e){setTimeout((function(){e(!0)}),t.timeout)}))},e}(),Jc=6e3;var Qc,Yc="@azure/msal-browser",Xc="2.38.1";!function(e){e.INITIALIZE_START="msal:initializeStart",e.INITIALIZE_END="msal:initializeEnd",e.ACCOUNT_ADDED="msal:accountAdded",e.ACCOUNT_REMOVED="msal:accountRemoved",e.LOGIN_START="msal:loginStart",e.LOGIN_SUCCESS="msal:loginSuccess",e.LOGIN_FAILURE="msal:loginFailure",e.ACQUIRE_TOKEN_START="msal:acquireTokenStart",e.ACQUIRE_TOKEN_SUCCESS="msal:acquireTokenSuccess",e.ACQUIRE_TOKEN_FAILURE="msal:acquireTokenFailure",e.ACQUIRE_TOKEN_NETWORK_START="msal:acquireTokenFromNetworkStart",e.SSO_SILENT_START="msal:ssoSilentStart",e.SSO_SILENT_SUCCESS="msal:ssoSilentSuccess",e.SSO_SILENT_FAILURE="msal:ssoSilentFailure",e.ACQUIRE_TOKEN_BY_CODE_START="msal:acquireTokenByCodeStart",e.ACQUIRE_TOKEN_BY_CODE_SUCCESS="msal:acquireTokenByCodeSuccess",e.ACQUIRE_TOKEN_BY_CODE_FAILURE="msal:acquireTokenByCodeFailure",e.HANDLE_REDIRECT_START="msal:handleRedirectStart",e.HANDLE_REDIRECT_END="msal:handleRedirectEnd",e.POPUP_OPENED="msal:popupOpened",e.LOGOUT_START="msal:logoutStart",e.LOGOUT_SUCCESS="msal:logoutSuccess",e.LOGOUT_FAILURE="msal:logoutFailure",e.LOGOUT_END="msal:logoutEnd",e.RESTORE_FROM_BFCACHE="msal:restoreFromBFCache"}(Qc||(Qc={}));var $c,el=function(){function e(e,t){this.eventCallbacks=new Map,this.logger=e,this.browserCrypto=t,this.listeningToStorageEvents=!1,this.handleAccountCacheChange=this.handleAccountCacheChange.bind(this)}return e.prototype.addEventCallback=function(e){if("undefined"!==typeof window){var t=this.browserCrypto.createNewGuid();return this.eventCallbacks.set(t,e),this.logger.verbose("Event callback registered with id: "+t),t}return null},e.prototype.removeEventCallback=function(e){this.eventCallbacks.delete(e),this.logger.verbose("Event callback "+e+" removed.")},e.prototype.enableAccountStorageEvents=function(){"undefined"!==typeof window&&(this.listeningToStorageEvents?this.logger.verbose("Account storage listener already registered."):(this.logger.verbose("Adding account storage listener."),this.listeningToStorageEvents=!0,window.addEventListener("storage",this.handleAccountCacheChange)))},e.prototype.disableAccountStorageEvents=function(){"undefined"!==typeof window&&(this.listeningToStorageEvents?(this.logger.verbose("Removing account storage listener."),window.removeEventListener("storage",this.handleAccountCacheChange),this.listeningToStorageEvents=!1):this.logger.verbose("No account storage listener registered."))},e.prototype.emitEvent=function(e,t,n,r){var i=this;if("undefined"!==typeof window){var o={eventType:e,interactionType:t||null,payload:n||null,error:r||null,timestamp:Date.now()};this.logger.info("Emitting event: "+e),this.eventCallbacks.forEach((function(t,n){i.logger.verbose("Emitting event to callback "+n+": "+e),t.apply(null,[o])}))}},e.prototype.handleAccountCacheChange=function(e){try{var t=e.newValue||e.oldValue;if(!t)return;var n=JSON.parse(t);if("object"!==typeof n||!gc.isAccountEntity(n))return;var r=wc.toObject(new gc,n).getAccountInfo();!e.oldValue&&e.newValue?(this.logger.info("Account was added to cache in a different window"),this.emitEvent(Qc.ACCOUNT_ADDED,void 0,r)):!e.newValue&&e.oldValue&&(this.logger.info("Account was removed from cache in a different window"),this.emitEvent(Qc.ACCOUNT_REMOVED,void 0,r))}catch(e){return}},e}(),tl=function(){function e(){}return e.generateThrottlingStorageKey=function(e){return Mo+"."+JSON.stringify(e)},e.preProcess=function(t,n){var r,i=e.generateThrottlingStorageKey(n),o=t.getThrottlingCache(i);if(o){if(o.throttleTime<Date.now())return void t.removeItem(i);throw new Qo((null===(r=o.errorCodes)||void 0===r?void 0:r.join(" "))||ao.EMPTY_STRING,o.errorMessage,o.subError)}},e.postProcess=function(t,n,r){if(e.checkResponseStatus(r)||e.checkResponseForRetryAfter(r)){var i={throttleTime:e.calculateThrottleTime(parseInt(r.headers[to.RETRY_AFTER])),error:r.body.error,errorCodes:r.body.error_codes,errorMessage:r.body.error_description,subError:r.body.suberror};t.setThrottlingCache(e.generateThrottlingStorageKey(n),i)}},e.checkResponseStatus=function(e){return 429===e.status||e.status>=500&&e.status<600},e.checkResponseForRetryAfter=function(e){return!!e.headers&&(e.headers.hasOwnProperty(to.RETRY_AFTER)&&(e.status<200||e.status>=300))},e.calculateThrottleTime=function(e){var t=e<=0?0:e,n=Date.now()/1e3;return Math.floor(1e3*Math.min(n+(t||No),n+Oo))},e.removeThrottle=function(e,t,n,r){var i={clientId:t,authority:n.authority,scopes:n.scopes,homeAccountIdentifier:r,claims:n.claims,authenticationScheme:n.authenticationScheme,resourceRequestMethod:n.resourceRequestMethod,resourceRequestUri:n.resourceRequestUri,shrClaims:n.shrClaims,sshKid:n.sshKid},o=this.generateThrottlingStorageKey(i);e.removeItem(o)},e}(),nl=function(){function e(e,t){this.networkClient=e,this.cacheManager=t}return e.prototype.sendPostRequest=function(e,t,n){return Xi(this,void 0,void 0,(function(){var r,i;return $i(this,(function(o){switch(o.label){case 0:tl.preProcess(this.cacheManager,e),o.label=1;case 1:return o.trys.push([1,3,,4]),[4,this.networkClient.sendPostRequestAsync(t,n)];case 2:return r=o.sent(),[3,4];case 3:throw(i=o.sent())instanceof Jo?i:bs.createNetworkError(t,i);case 4:return tl.postProcess(this.cacheManager,e,r),[2,r]}}))}))},e}(),rl=function(){function e(){}return e.validateRedirectUri=function(e){if(ws.isEmpty(e))throw dc.createRedirectUriEmptyError()},e.validatePrompt=function(e){var t=[];for(var n in lo)t.push(lo[n]);if(t.indexOf(e)<0)throw dc.createInvalidPromptError(e)},e.validateClaims=function(e){try{JSON.parse(e)}catch(Oi){throw dc.createInvalidClaimsRequestError()}},e.validateCodeChallengeParams=function(e,t){if(ws.isEmpty(e)||ws.isEmpty(t))throw dc.createInvalidCodeChallengeParamsError();this.validateCodeChallengeMethod(t)},e.validateCodeChallengeMethod=function(e){if([yo.PLAIN,yo.S256].indexOf(e)<0)throw dc.createInvalidCodeChallengeMethodError()},e.sanitizeEQParams=function(e,t){return e?(t.forEach((function(t,n){e[n]&&delete e[n]})),Object.fromEntries(Object.entries(e).filter((function(e){return""!==e[1]})))):{}},e}(),il=function(){function e(){this.parameters=new Map}return e.prototype.addResponseTypeCode=function(){this.parameters.set(io.RESPONSE_TYPE,encodeURIComponent(ao.CODE_RESPONSE_TYPE))},e.prototype.addResponseTypeForTokenAndIdToken=function(){this.parameters.set(io.RESPONSE_TYPE,encodeURIComponent(ao.TOKEN_RESPONSE_TYPE+" "+ao.ID_TOKEN_RESPONSE_TYPE))},e.prototype.addResponseMode=function(e){this.parameters.set(io.RESPONSE_MODE,encodeURIComponent(e||ho.QUERY))},e.prototype.addNativeBroker=function(){this.parameters.set(io.NATIVE_BROKER,encodeURIComponent("1"))},e.prototype.addScopes=function(e,t){void 0===t&&(t=!0);var n=t?eo(e||[],so):e||[],r=new hc(n);this.parameters.set(io.SCOPE,encodeURIComponent(r.printScopes()))},e.prototype.addClientId=function(e){this.parameters.set(io.CLIENT_ID,encodeURIComponent(e))},e.prototype.addRedirectUri=function(e){rl.validateRedirectUri(e),this.parameters.set(io.REDIRECT_URI,encodeURIComponent(e))},e.prototype.addPostLogoutRedirectUri=function(e){rl.validateRedirectUri(e),this.parameters.set(io.POST_LOGOUT_URI,encodeURIComponent(e))},e.prototype.addIdTokenHint=function(e){this.parameters.set(io.ID_TOKEN_HINT,encodeURIComponent(e))},e.prototype.addDomainHint=function(e){this.parameters.set(co.DOMAIN_HINT,encodeURIComponent(e))},e.prototype.addLoginHint=function(e){this.parameters.set(co.LOGIN_HINT,encodeURIComponent(e))},e.prototype.addCcsUpn=function(e){this.parameters.set(to.CCS_HEADER,encodeURIComponent("UPN:"+e))},e.prototype.addCcsOid=function(e){this.parameters.set(to.CCS_HEADER,encodeURIComponent("Oid:"+e.uid+"@"+e.utid))},e.prototype.addSid=function(e){this.parameters.set(co.SID,encodeURIComponent(e))},e.prototype.addClaims=function(e,t){var n=this.addClientCapabilitiesToClaims(e,t);rl.validateClaims(n),this.parameters.set(io.CLAIMS,encodeURIComponent(n))},e.prototype.addCorrelationId=function(e){this.parameters.set(io.CLIENT_REQUEST_ID,encodeURIComponent(e))},e.prototype.addLibraryInfo=function(e){this.parameters.set(io.X_CLIENT_SKU,e.sku),this.parameters.set(io.X_CLIENT_VER,e.version),e.os&&this.parameters.set(io.X_CLIENT_OS,e.os),e.cpu&&this.parameters.set(io.X_CLIENT_CPU,e.cpu)},e.prototype.addApplicationTelemetry=function(e){(null===e||void 0===e?void 0:e.appName)&&this.parameters.set(io.X_APP_NAME,e.appName),(null===e||void 0===e?void 0:e.appVersion)&&this.parameters.set(io.X_APP_VER,e.appVersion)},e.prototype.addPrompt=function(e){rl.validatePrompt(e),this.parameters.set(""+io.PROMPT,encodeURIComponent(e))},e.prototype.addState=function(e){ws.isEmpty(e)||this.parameters.set(io.STATE,encodeURIComponent(e))},e.prototype.addNonce=function(e){this.parameters.set(io.NONCE,encodeURIComponent(e))},e.prototype.addCodeChallengeParams=function(e,t){if(rl.validateCodeChallengeParams(e,t),!e||!t)throw dc.createInvalidCodeChallengeParamsError();this.parameters.set(io.CODE_CHALLENGE,encodeURIComponent(e)),this.parameters.set(io.CODE_CHALLENGE_METHOD,encodeURIComponent(t))},e.prototype.addAuthorizationCode=function(e){this.parameters.set(io.CODE,encodeURIComponent(e))},e.prototype.addDeviceCode=function(e){this.parameters.set(io.DEVICE_CODE,encodeURIComponent(e))},e.prototype.addRefreshToken=function(e){this.parameters.set(io.REFRESH_TOKEN,encodeURIComponent(e))},e.prototype.addCodeVerifier=function(e){this.parameters.set(io.CODE_VERIFIER,encodeURIComponent(e))},e.prototype.addClientSecret=function(e){this.parameters.set(io.CLIENT_SECRET,encodeURIComponent(e))},e.prototype.addClientAssertion=function(e){ws.isEmpty(e)||this.parameters.set(io.CLIENT_ASSERTION,encodeURIComponent(e))},e.prototype.addClientAssertionType=function(e){ws.isEmpty(e)||this.parameters.set(io.CLIENT_ASSERTION_TYPE,encodeURIComponent(e))},e.prototype.addOboAssertion=function(e){this.parameters.set(io.OBO_ASSERTION,encodeURIComponent(e))},e.prototype.addRequestTokenUse=function(e){this.parameters.set(io.REQUESTED_TOKEN_USE,encodeURIComponent(e))},e.prototype.addGrantType=function(e){this.parameters.set(io.GRANT_TYPE,encodeURIComponent(e))},e.prototype.addClientInfo=function(){this.parameters.set("client_info","1")},e.prototype.addExtraQueryParameters=function(e){var t=this,n=rl.sanitizeEQParams(e,this.parameters);Object.keys(n).forEach((function(n){t.parameters.set(n,e[n])}))},e.prototype.addClientCapabilitiesToClaims=function(e,t){var n;if(e)try{n=JSON.parse(e)}catch(Oi){throw dc.createInvalidClaimsRequestError()}else n={};return t&&t.length>0&&(n.hasOwnProperty(oo.ACCESS_TOKEN)||(n[oo.ACCESS_TOKEN]={}),n[oo.ACCESS_TOKEN][oo.XMS_CC]={values:t}),JSON.stringify(n)},e.prototype.addUsername=function(e){this.parameters.set(To.username,encodeURIComponent(e))},e.prototype.addPassword=function(e){this.parameters.set(To.password,encodeURIComponent(e))},e.prototype.addPopToken=function(e){ws.isEmpty(e)||(this.parameters.set(io.TOKEN_TYPE,xo.POP),this.parameters.set(io.REQ_CNF,encodeURIComponent(e)))},e.prototype.addSshJwk=function(e){ws.isEmpty(e)||(this.parameters.set(io.TOKEN_TYPE,xo.SSH),this.parameters.set(io.REQ_CNF,encodeURIComponent(e)))},e.prototype.addServerTelemetry=function(e){this.parameters.set(io.X_CLIENT_CURR_TELEM,e.generateCurrentRequestHeaderValue()),this.parameters.set(io.X_CLIENT_LAST_TELEM,e.generateLastRequestHeaderValue())},e.prototype.addThrottling=function(){this.parameters.set(io.X_MS_LIB_CAPABILITY,Fo)},e.prototype.addLogoutHint=function(e){this.parameters.set(io.LOGOUT_HINT,encodeURIComponent(e))},e.prototype.createQueryString=function(){var e=new Array;return this.parameters.forEach((function(t,n){e.push(n+"="+t)})),e.join("&")},e}(),ol=function(){function e(e,t){this.config=function(e){var t,n=e.authOptions,r=e.systemOptions,i=e.loggerOptions,o=e.cacheOptions,a=e.storageInterface,s=e.networkInterface,u=e.cryptoInterface,c=e.clientCredentials,l=e.libraryInfo,d=e.telemetry,h=e.serverTelemetryManager,f=e.persistencePlugin,p=e.serializableCache,v=Yi(Yi({},Dc),i);return{authOptions:(t=n,Yi({clientCapabilities:[],azureCloudOptions:Uc,skipAuthorityMetadataCache:!1},t)),systemOptions:Yi(Yi({},Zc),r),loggerOptions:v,cacheOptions:Yi(Yi({},Lc),o),storageInterface:a||new Sc(n.clientId,Bu,new Fu(v)),networkInterface:s||Bc,cryptoInterface:u||Bu,clientCredentials:c||jc,libraryInfo:Yi(Yi({},qc),l),telemetry:Yi(Yi({},Hc),d),serverTelemetryManager:h||null,persistencePlugin:f||null,serializableCache:p||null}}(e),this.logger=new Fu(this.config.loggerOptions,yc,bc),this.cryptoUtils=this.config.cryptoInterface,this.cacheManager=this.config.storageInterface,this.networkClient=this.config.networkInterface,this.networkManager=new nl(this.networkClient,this.cacheManager),this.serverTelemetryManager=this.config.serverTelemetryManager,this.authority=this.config.authOptions.authority,this.performanceClient=t}return e.prototype.createTokenRequestHeaders=function(e){var t={};if(t[to.CONTENT_TYPE]=ao.URL_FORM_CONTENT_TYPE,!this.config.systemOptions.preventCorsPreflight&&e)switch(e.type){case vc.HOME_ACCOUNT_ID:try{var n=pc(e.credential);t[to.CCS_HEADER]="Oid:"+n.uid+"@"+n.utid}catch(Oi){this.logger.verbose("Could not parse home account ID for CCS Header: "+Oi)}break;case vc.UPN:t[to.CCS_HEADER]="UPN: "+e.credential}return t},e.prototype.executePostToTokenEndpoint=function(e,t,n,r){return Xi(this,void 0,void 0,(function(){var i;return $i(this,(function(o){switch(o.label){case 0:return[4,this.networkManager.sendPostRequest(r,e,{body:t,headers:n})];case 1:return i=o.sent(),this.config.serverTelemetryManager&&i.status<500&&429!==i.status&&this.config.serverTelemetryManager.clearTelemetryCache(),[2,i]}}))}))},e.prototype.updateAuthority=function(e){if(!e.discoveryComplete())throw bs.createEndpointDiscoveryIncompleteError("Updated authority has not completed endpoint discovery.");this.authority=e},e.prototype.createTokenQueryParameters=function(e){var t=new il;return e.tokenQueryParameters&&t.addExtraQueryParameters(e.tokenQueryParameters),t.createQueryString()},e}(),al=function(e,t,n,r,i){this.account=e||null,this.idToken=t||null,this.accessToken=n||null,this.refreshToken=r||null,this.appMetadata=i||null};!function(e){e.SW="sw",e.UHW="uhw"}($c||($c={}));var sl=function(){function e(e,t){this.cryptoUtils=e,this.performanceClient=t}return e.prototype.generateCnf=function(e){var t,n;return Xi(this,void 0,void 0,(function(){var r,i,o;return $i(this,(function(a){switch(a.label){case 0:return null===(t=this.performanceClient)||void 0===t||t.addQueueMeasurement(qi.PopTokenGenerateCnf,e.correlationId),null===(n=this.performanceClient)||void 0===n||n.setPreQueueTime(qi.PopTokenGenerateKid,e.correlationId),[4,this.generateKid(e)];case 1:return r=a.sent(),i=this.cryptoUtils.base64Encode(JSON.stringify(r)),o={kid:r.kid,reqCnfString:i},[4,this.cryptoUtils.hashString(i)];case 2:return[2,(o.reqCnfHash=a.sent(),o)]}}))}))},e.prototype.generateKid=function(e){var t;return Xi(this,void 0,void 0,(function(){return $i(this,(function(n){switch(n.label){case 0:return null===(t=this.performanceClient)||void 0===t||t.addQueueMeasurement(qi.PopTokenGenerateKid,e.correlationId),[4,this.cryptoUtils.getPublicKeyThumbprint(e)];case 1:return[2,{kid:n.sent(),xms_ksl:$c.SW}]}}))}))},e.prototype.signPopToken=function(e,t,n){return Xi(this,void 0,void 0,(function(){return $i(this,(function(r){return[2,this.signPayload(e,t,n)]}))}))},e.prototype.signPayload=function(e,t,n,r){return Xi(this,void 0,void 0,(function(){var i,o,a,s,u,c;return $i(this,(function(l){switch(l.label){case 0:return i=n.resourceRequestMethod,o=n.resourceRequestUri,a=n.shrClaims,s=n.shrNonce,u=o?new Oc(o):void 0,c=null===u||void 0===u?void 0:u.getUrlComponents(),[4,this.cryptoUtils.signJwt(Yi({at:e,ts:kc.nowSeconds(),m:null===i||void 0===i?void 0:i.toUpperCase(),u:null===c||void 0===c?void 0:c.HostNameAndPort,nonce:s||this.cryptoUtils.createNewGuid(),p:null===c||void 0===c?void 0:c.AbsolutePath,q:(null===c||void 0===c?void 0:c.QueryString)?[[],c.QueryString]:void 0,client_claims:a||void 0},r),t,n.correlationId)];case 1:return[2,l.sent()]}}))}))},e}(),ul=function(){function e(e,t){this.cache=e,this.hasChanged=t}return Object.defineProperty(e.prototype,"cacheHasChanged",{get:function(){return this.hasChanged},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"tokenCache",{get:function(){return this.cache},enumerable:!1,configurable:!0}),e}(),cl=function(){function e(e,t,n,r,i,o,a){this.clientId=e,this.cacheStorage=t,this.cryptoObj=n,this.logger=r,this.serializableCache=i,this.persistencePlugin=o,this.performanceClient=a}return e.prototype.validateServerAuthorizationCodeResponse=function(e,t,n){if(!e.state||!t)throw e.state?bs.createStateNotFoundError("Cached State"):bs.createStateNotFoundError("Server State");if(decodeURIComponent(e.state)!==decodeURIComponent(t))throw bs.createStateMismatchError();if(e.error||e.error_description||e.suberror){if(ta.isInteractionRequiredError(e.error,e.error_description,e.suberror))throw new ta(e.error||ao.EMPTY_STRING,e.error_description,e.suberror,e.timestamp||ao.EMPTY_STRING,e.trace_id||ao.EMPTY_STRING,e.correlation_id||ao.EMPTY_STRING,e.claims||ao.EMPTY_STRING);throw new Qo(e.error||ao.EMPTY_STRING,e.error_description,e.suberror)}e.client_info&&fc(e.client_info,n)},e.prototype.validateTokenResponse=function(e){if(e.error||e.error_description||e.suberror){if(ta.isInteractionRequiredError(e.error,e.error_description,e.suberror))throw new ta(e.error,e.error_description,e.suberror,e.timestamp||ao.EMPTY_STRING,e.trace_id||ao.EMPTY_STRING,e.correlation_id||ao.EMPTY_STRING,e.claims||ao.EMPTY_STRING);var t=e.error_codes+" - ["+e.timestamp+"]: "+e.error_description+" - Correlation ID: "+e.correlation_id+" - Trace ID: "+e.trace_id;throw new Qo(e.error,t,e.suberror)}},e.prototype.handleServerTokenResponse=function(t,n,r,i,o,a,s,u,c){var l;return Xi(this,void 0,void 0,(function(){var d,h,f,p,v,g;return $i(this,(function(m){switch(m.label){case 0:if(null===(l=this.performanceClient)||void 0===l||l.addQueueMeasurement(qi.HandleServerTokenResponse,t.correlation_id),t.id_token){if(d=new mc(t.id_token||ao.EMPTY_STRING,this.cryptoObj),o&&!ws.isEmpty(o.nonce)&&d.claims.nonce!==o.nonce)throw bs.createNonceMismatchError();if(i.maxAge||0===i.maxAge){if(!(h=d.claims.auth_time))throw bs.createAuthTimeNotFoundError();mc.checkMaxAge(h,i.maxAge)}}this.homeAccountIdentifier=gc.generateHomeAccountId(t.client_info||ao.EMPTY_STRING,n.authorityType,this.logger,this.cryptoObj,d),o&&o.state&&(f=Rc.parseRequestState(this.cryptoObj,o.state)),t.key_id=t.key_id||i.sshKid||void 0,p=this.generateCacheRecord(t,n,r,i,d,a,o),m.label=1;case 1:return m.trys.push([1,,5,8]),this.persistencePlugin&&this.serializableCache?(this.logger.verbose("Persistence enabled, calling beforeCacheAccess"),v=new ul(this.serializableCache,!0),[4,this.persistencePlugin.beforeCacheAccess(v)]):[3,3];case 2:m.sent(),m.label=3;case 3:return!s||u||!p.account||(g=p.account.generateAccountKey(),this.cacheStorage.getAccount(g))?[4,this.cacheStorage.saveCacheRecord(p)]:(this.logger.warning("Account used to refresh tokens not in persistence, refreshed tokens will not be stored in the cache"),[2,e.generateAuthenticationResult(this.cryptoObj,n,p,!1,i,d,f,void 0,c)]);case 4:return m.sent(),[3,8];case 5:return this.persistencePlugin&&this.serializableCache&&v?(this.logger.verbose("Persistence enabled, calling afterCacheAccess"),[4,this.persistencePlugin.afterCacheAccess(v)]):[3,7];case 6:m.sent(),m.label=7;case 7:return[7];case 8:return[2,e.generateAuthenticationResult(this.cryptoObj,n,p,!1,i,d,f,t,c)]}}))}))},e.prototype.generateCacheRecord=function(e,t,n,r,i,o,a){var s,u,c=t.getPreferredCache();if(ws.isEmpty(c))throw bs.createInvalidCacheEnvironmentError();!ws.isEmpty(e.id_token)&&i&&(s=ju.createIdTokenEntity(this.homeAccountIdentifier,c,e.id_token||ao.EMPTY_STRING,this.clientId,i.claims.tid||ao.EMPTY_STRING),u=this.generateAccountEntity(e,i,t,a));var l=null;if(!ws.isEmpty(e.access_token)){var d=e.scope?hc.fromString(e.scope):new hc(r.scopes||[]),h=("string"===typeof e.expires_in?parseInt(e.expires_in,10):e.expires_in)||0,f=("string"===typeof e.ext_expires_in?parseInt(e.ext_expires_in,10):e.ext_expires_in)||0,p=("string"===typeof e.refresh_in?parseInt(e.refresh_in,10):e.refresh_in)||void 0,v=n+h,g=v+f,m=p&&p>0?n+p:void 0;l=Cc.createAccessTokenEntity(this.homeAccountIdentifier,c,e.access_token||ao.EMPTY_STRING,this.clientId,i?i.claims.tid||ao.EMPTY_STRING:t.tenant,d.printScopes(),v,g,this.cryptoObj,m,e.token_type,o,e.key_id,r.claims,r.requestedClaimsHash)}var y=null;ws.isEmpty(e.refresh_token)||(y=xc.createRefreshTokenEntity(this.homeAccountIdentifier,c,e.refresh_token||ao.EMPTY_STRING,this.clientId,e.foci,o));var b=null;return ws.isEmpty(e.foci)||(b=Ec.createAppMetadataEntity(this.clientId,c,e.foci)),new al(u,s,l,y,b)},e.prototype.generateAccountEntity=function(e,t,n,r){var i=n.authorityType,o=r?r.cloud_graph_host_name:ao.EMPTY_STRING,a=r?r.msgraph_host:ao.EMPTY_STRING;if(i===Mu.Adfs)return this.logger.verbose("Authority type is ADFS, creating ADFS account"),gc.createGenericAccount(this.homeAccountIdentifier,t,n,o,a);if(ws.isEmpty(e.client_info)&&"AAD"===n.protocolMode)throw bs.createClientInfoEmptyError();return e.client_info?gc.createAccount(e.client_info,this.homeAccountIdentifier,t,n,o,a):gc.createGenericAccount(this.homeAccountIdentifier,t,n,o,a)},e.generateAuthenticationResult=function(e,t,n,r,i,o,a,s,u){var c,l,d;return Xi(this,void 0,void 0,(function(){var h,f,p,v,g,m,y,b,w,S,k;return $i(this,(function(C){switch(C.label){case 0:if(h=ao.EMPTY_STRING,f=[],p=null,g=ao.EMPTY_STRING,!n.accessToken)return[3,4];if(n.accessToken.tokenType!==xo.POP)return[3,2];if(m=new sl(e),y=n.accessToken,b=y.secret,!(w=y.keyId))throw bs.createKeyIdMissingError();return[4,m.signPopToken(b,w,i)];case 1:return h=C.sent(),[3,3];case 2:h=n.accessToken.secret,C.label=3;case 3:f=hc.fromString(n.accessToken.target).asArray(),p=new Date(1e3*Number(n.accessToken.expiresOn)),v=new Date(1e3*Number(n.accessToken.extendedExpiresOn)),C.label=4;case 4:return n.appMetadata&&(g=n.appMetadata.familyId===So?So:ao.EMPTY_STRING),S=(null===o||void 0===o?void 0:o.claims.oid)||(null===o||void 0===o?void 0:o.claims.sub)||ao.EMPTY_STRING,k=(null===o||void 0===o?void 0:o.claims.tid)||ao.EMPTY_STRING,(null===s||void 0===s?void 0:s.spa_accountid)&&n.account&&(n.account.nativeAccountId=null===s||void 0===s?void 0:s.spa_accountid),[2,{authority:t.canonicalAuthority,uniqueId:S,tenantId:k,scopes:f,account:n.account?n.account.getAccountInfo():null,idToken:o?o.rawToken:ao.EMPTY_STRING,idTokenClaims:o?o.claims:{},accessToken:h,fromCache:r,expiresOn:p,correlationId:i.correlationId,requestId:u||ao.EMPTY_STRING,extExpiresOn:v,familyId:g,tokenType:(null===(c=n.accessToken)||void 0===c?void 0:c.tokenType)||ao.EMPTY_STRING,state:a?a.userRequestState:ao.EMPTY_STRING,cloudGraphHostName:(null===(l=n.account)||void 0===l?void 0:l.cloudGraphHostName)||ao.EMPTY_STRING,msGraphHost:(null===(d=n.account)||void 0===d?void 0:d.msGraphHost)||ao.EMPTY_STRING,code:null===s||void 0===s?void 0:s.spa_code,fromNativeBroker:!1}]}}))}))},e}(),ll=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.includeRedirectUri=!0,r}return Qi(t,e),t.prototype.getAuthCodeUrl=function(e){var t,n;return Xi(this,void 0,void 0,(function(){var r;return $i(this,(function(i){switch(i.label){case 0:return null===(t=this.performanceClient)||void 0===t||t.addQueueMeasurement(qi.GetAuthCodeUrl,e.correlationId),null===(n=this.performanceClient)||void 0===n||n.setPreQueueTime(qi.AuthClientCreateQueryString,e.correlationId),[4,this.createAuthCodeUrlQueryString(e)];case 1:return r=i.sent(),[2,Oc.appendQueryString(this.authority.authorizationEndpoint,r)]}}))}))},t.prototype.acquireToken=function(e,t){var n,r,i,o,a,s;return Xi(this,void 0,void 0,(function(){var u,c,l,d,h,f,p=this;return $i(this,(function(v){switch(v.label){case 0:if(!e||!e.code)throw bs.createTokenRequestCannotBeMadeError();return null===(n=this.performanceClient)||void 0===n||n.addQueueMeasurement(qi.AuthClientAcquireToken,e.correlationId),u=null===(r=this.performanceClient)||void 0===r?void 0:r.startMeasurement("AuthCodeClientAcquireToken",e.correlationId),this.logger.info("in acquireToken call in auth-code client"),c=kc.nowSeconds(),null===(i=this.performanceClient)||void 0===i||i.setPreQueueTime(qi.AuthClientExecuteTokenRequest,e.correlationId),[4,this.executeTokenRequest(this.authority,e)];case 1:return l=v.sent(),d=null===(o=l.headers)||void 0===o?void 0:o[to.X_MS_REQUEST_ID],(h=null===(a=l.headers)||void 0===a?void 0:a[to.X_MS_HTTP_VERSION])&&(null===u||void 0===u||u.addStaticFields({httpVerAuthority:h})),(f=new cl(this.config.authOptions.clientId,this.cacheManager,this.cryptoUtils,this.logger,this.config.serializableCache,this.config.persistencePlugin,this.performanceClient)).validateTokenResponse(l.body),null===(s=this.performanceClient)||void 0===s||s.setPreQueueTime(qi.HandleServerTokenResponse,e.correlationId),[2,f.handleServerTokenResponse(l.body,this.authority,c,e,t,void 0,void 0,void 0,d).then((function(e){return null===u||void 0===u||u.endMeasurement({success:!0}),e})).catch((function(t){throw p.logger.verbose("Error in fetching token in ACC",e.correlationId),null===u||void 0===u||u.endMeasurement({errorCode:t.errorCode,subErrorCode:t.subError,success:!1}),t}))]}}))}))},t.prototype.handleFragmentResponse=function(e,t){var n=new cl(this.config.authOptions.clientId,this.cacheManager,this.cryptoUtils,this.logger,null,null),r=new Oc(e),i=Oc.getDeserializedHash(r.getHash());if(n.validateServerAuthorizationCodeResponse(i,t,this.cryptoUtils),!i.code)throw bs.createNoAuthCodeInServerResponseError();return Yi(Yi({},i),{code:i.code})},t.prototype.getLogoutUri=function(e){if(!e)throw dc.createEmptyLogoutRequestError();var t=this.createLogoutUrlQueryString(e);return Oc.appendQueryString(this.authority.endSessionEndpoint,t)},t.prototype.executeTokenRequest=function(e,t){var n,r;return Xi(this,void 0,void 0,(function(){var i,o,a,s,u,c,l;return $i(this,(function(d){switch(d.label){case 0:return null===(n=this.performanceClient)||void 0===n||n.addQueueMeasurement(qi.AuthClientExecuteTokenRequest,t.correlationId),null===(r=this.performanceClient)||void 0===r||r.setPreQueueTime(qi.AuthClientCreateTokenRequestBody,t.correlationId),i=this.createTokenQueryParameters(t),o=Oc.appendQueryString(e.tokenEndpoint,i),[4,this.createTokenRequestBody(t)];case 1:if(a=d.sent(),s=void 0,t.clientInfo)try{u=fc(t.clientInfo,this.cryptoUtils),s={credential:""+u.uid+vo.CLIENT_INFO_SEPARATOR+u.utid,type:vc.HOME_ACCOUNT_ID}}catch(Oi){this.logger.verbose("Could not parse client info for CCS Header: "+Oi)}return c=this.createTokenRequestHeaders(s||t.ccsCredential),l={clientId:this.config.authOptions.clientId,authority:e.canonicalAuthority,scopes:t.scopes,claims:t.claims,authenticationScheme:t.authenticationScheme,resourceRequestMethod:t.resourceRequestMethod,resourceRequestUri:t.resourceRequestUri,shrClaims:t.shrClaims,sshKid:t.sshKid},[2,this.executePostToTokenEndpoint(o,a,c,l)]}}))}))},t.prototype.createTokenRequestBody=function(e){var t,n;return Xi(this,void 0,void 0,(function(){var r,i,o,a,s,u,c,l;return $i(this,(function(d){switch(d.label){case 0:return null===(t=this.performanceClient)||void 0===t||t.addQueueMeasurement(qi.AuthClientCreateTokenRequestBody,e.correlationId),(r=new il).addClientId(this.config.authOptions.clientId),this.includeRedirectUri?r.addRedirectUri(e.redirectUri):rl.validateRedirectUri(e.redirectUri),r.addScopes(e.scopes),r.addAuthorizationCode(e.code),r.addLibraryInfo(this.config.libraryInfo),r.addApplicationTelemetry(this.config.telemetry.application),r.addThrottling(),this.serverTelemetryManager&&r.addServerTelemetry(this.serverTelemetryManager),e.codeVerifier&&r.addCodeVerifier(e.codeVerifier),this.config.clientCredentials.clientSecret&&r.addClientSecret(this.config.clientCredentials.clientSecret),this.config.clientCredentials.clientAssertion&&(i=this.config.clientCredentials.clientAssertion,r.addClientAssertion(i.assertion),r.addClientAssertionType(i.assertionType)),r.addGrantType(fo.AUTHORIZATION_CODE_GRANT),r.addClientInfo(),e.authenticationScheme!==xo.POP?[3,2]:(o=new sl(this.cryptoUtils,this.performanceClient),null===(n=this.performanceClient)||void 0===n||n.setPreQueueTime(qi.PopTokenGenerateCnf,e.correlationId),[4,o.generateCnf(e)]);case 1:return a=d.sent(),r.addPopToken(a.reqCnfString),[3,3];case 2:if(e.authenticationScheme===xo.SSH){if(!e.sshJwk)throw dc.createMissingSshJwkError();r.addSshJwk(e.sshJwk)}d.label=3;case 3:if(s=e.correlationId||this.config.cryptoInterface.createNewGuid(),r.addCorrelationId(s),(!ws.isEmptyObj(e.claims)||this.config.authOptions.clientCapabilities&&this.config.authOptions.clientCapabilities.length>0)&&r.addClaims(e.claims,this.config.authOptions.clientCapabilities),u=void 0,e.clientInfo)try{c=fc(e.clientInfo,this.cryptoUtils),u={credential:""+c.uid+vo.CLIENT_INFO_SEPARATOR+c.utid,type:vc.HOME_ACCOUNT_ID}}catch(Oi){this.logger.verbose("Could not parse client info for CCS Header: "+Oi)}else u=e.ccsCredential;if(this.config.systemOptions.preventCorsPreflight&&u)switch(u.type){case vc.HOME_ACCOUNT_ID:try{c=pc(u.credential),r.addCcsOid(c)}catch(Oi){this.logger.verbose("Could not parse home account ID for CCS Header: "+Oi)}break;case vc.UPN:r.addCcsUpn(u.credential)}return e.tokenBodyParameters&&r.addExtraQueryParameters(e.tokenBodyParameters),!e.enableSpaAuthorizationCode||e.tokenBodyParameters&&e.tokenBodyParameters[io.RETURN_SPA_CODE]||r.addExtraQueryParameters(((l={})[io.RETURN_SPA_CODE]="1",l)),[2,r.createQueryString()]}}))}))},t.prototype.createAuthCodeUrlQueryString=function(e){var t;return Xi(this,void 0,void 0,(function(){var n,r,i,o,a,s,u;return $i(this,(function(c){switch(c.label){case 0:if(null===(t=this.performanceClient)||void 0===t||t.addQueueMeasurement(qi.AuthClientCreateQueryString,e.correlationId),(n=new il).addClientId(this.config.authOptions.clientId),r=eo(e.scopes||[],e.extraScopesToConsent||[]),n.addScopes(r),n.addRedirectUri(e.redirectUri),i=e.correlationId||this.config.cryptoInterface.createNewGuid(),n.addCorrelationId(i),n.addResponseMode(e.responseMode),n.addResponseTypeCode(),n.addLibraryInfo(this.config.libraryInfo),n.addApplicationTelemetry(this.config.telemetry.application),n.addClientInfo(),e.codeChallenge&&e.codeChallengeMethod&&n.addCodeChallengeParams(e.codeChallenge,e.codeChallengeMethod),e.prompt&&n.addPrompt(e.prompt),e.domainHint&&n.addDomainHint(e.domainHint),e.prompt!==lo.SELECT_ACCOUNT)if(e.sid&&e.prompt===lo.NONE)this.logger.verbose("createAuthCodeUrlQueryString: Prompt is none, adding sid from request"),n.addSid(e.sid);else if(e.account){if(o=this.extractAccountSid(e.account),a=this.extractLoginHint(e.account)){this.logger.verbose("createAuthCodeUrlQueryString: login_hint claim present on account"),n.addLoginHint(a);try{s=pc(e.account.homeAccountId),n.addCcsOid(s)}catch(Oi){this.logger.verbose("createAuthCodeUrlQueryString: Could not parse home account ID for CCS Header")}}else if(o&&e.prompt===lo.NONE){this.logger.verbose("createAuthCodeUrlQueryString: Prompt is none, adding sid from account"),n.addSid(o);try{s=pc(e.account.homeAccountId),n.addCcsOid(s)}catch(Oi){this.logger.verbose("createAuthCodeUrlQueryString: Could not parse home account ID for CCS Header")}}else if(e.loginHint)this.logger.verbose("createAuthCodeUrlQueryString: Adding login_hint from request"),n.addLoginHint(e.loginHint),n.addCcsUpn(e.loginHint);else if(e.account.username){this.logger.verbose("createAuthCodeUrlQueryString: Adding login_hint from account"),n.addLoginHint(e.account.username);try{s=pc(e.account.homeAccountId),n.addCcsOid(s)}catch(Oi){this.logger.verbose("createAuthCodeUrlQueryString: Could not parse home account ID for CCS Header")}}}else e.loginHint&&(this.logger.verbose("createAuthCodeUrlQueryString: No account, adding login_hint from request"),n.addLoginHint(e.loginHint),n.addCcsUpn(e.loginHint));else this.logger.verbose("createAuthCodeUrlQueryString: Prompt is select_account, ignoring account hints");return e.nonce&&n.addNonce(e.nonce),e.state&&n.addState(e.state),(!ws.isEmpty(e.claims)||this.config.authOptions.clientCapabilities&&this.config.authOptions.clientCapabilities.length>0)&&n.addClaims(e.claims,this.config.authOptions.clientCapabilities),e.extraQueryParameters&&n.addExtraQueryParameters(e.extraQueryParameters),e.nativeBroker?(n.addNativeBroker(),e.authenticationScheme!==xo.POP?[3,2]:[4,new sl(this.cryptoUtils).generateCnf(e)]):[3,2];case 1:u=c.sent(),n.addPopToken(u.reqCnfString),c.label=2;case 2:return[2,n.createQueryString()]}}))}))},t.prototype.createLogoutUrlQueryString=function(e){var t=new il;return e.postLogoutRedirectUri&&t.addPostLogoutRedirectUri(e.postLogoutRedirectUri),e.correlationId&&t.addCorrelationId(e.correlationId),e.idTokenHint&&t.addIdTokenHint(e.idTokenHint),e.state&&t.addState(e.state),e.logoutHint&&t.addLogoutHint(e.logoutHint),e.extraQueryParameters&&t.addExtraQueryParameters(e.extraQueryParameters),t.createQueryString()},t.prototype.extractAccountSid=function(e){var t;return(null===(t=e.idTokenClaims)||void 0===t?void 0:t.sid)||null},t.prototype.extractLoginHint=function(e){var t;return(null===(t=e.idTokenClaims)||void 0===t?void 0:t.login_hint)||null},t}(ol);function dl(e){return e.hasOwnProperty("authorization_endpoint")&&e.hasOwnProperty("token_endpoint")&&e.hasOwnProperty("issuer")&&e.hasOwnProperty("jwks_uri")}var hl={"https://login.microsoftonline.com/common/":{token_endpoint:"https://login.microsoftonline.com/common/oauth2/v2.0/token",token_endpoint_auth_methods_supported:["client_secret_post","private_key_jwt","client_secret_basic"],jwks_uri:"https://login.microsoftonline.com/common/discovery/v2.0/keys",response_modes_supported:["query","fragment","form_post"],subject_types_supported:["pairwise"],id_token_signing_alg_values_supported:["RS256"],response_types_supported:["code","id_token","code id_token","id_token token"],scopes_supported:["openid","profile","email","offline_access"],issuer:"https://login.microsoftonline.com/{tenantid}/v2.0",request_uri_parameter_supported:!1,userinfo_endpoint:"https://graph.microsoft.com/oidc/userinfo",authorization_endpoint:"https://login.microsoftonline.com/common/oauth2/v2.0/authorize",device_authorization_endpoint:"https://login.microsoftonline.com/common/oauth2/v2.0/devicecode",http_logout_supported:!0,frontchannel_logout_supported:!0,end_session_endpoint:"https://login.microsoftonline.com/common/oauth2/v2.0/logout",claims_supported:["sub","iss","cloud_instance_name","cloud_instance_host_name","cloud_graph_host_name","msgraph_host","aud","exp","iat","auth_time","acr","nonce","preferred_username","name","tid","ver","at_hash","c_hash","email"],kerberos_endpoint:"https://login.microsoftonline.com/common/kerberos",tenant_region_scope:null,cloud_instance_name:"microsoftonline.com",cloud_graph_host_name:"graph.windows.net",msgraph_host:"graph.microsoft.com",rbac_url:"https://pas.windows.net"},"https://login.chinacloudapi.cn/common/":{token_endpoint:"https://login.chinacloudapi.cn/common/oauth2/v2.0/token",token_endpoint_auth_methods_supported:["client_secret_post","private_key_jwt","client_secret_basic"],jwks_uri:"https://login.chinacloudapi.cn/common/discovery/v2.0/keys",response_modes_supported:["query","fragment","form_post"],subject_types_supported:["pairwise"],id_token_signing_alg_values_supported:["RS256"],response_types_supported:["code","id_token","code id_token","id_token token"],scopes_supported:["openid","profile","email","offline_access"],issuer:"https://login.partner.microsoftonline.cn/{tenantid}/v2.0",request_uri_parameter_supported:!1,userinfo_endpoint:"https://microsoftgraph.chinacloudapi.cn/oidc/userinfo",authorization_endpoint:"https://login.chinacloudapi.cn/common/oauth2/v2.0/authorize",device_authorization_endpoint:"https://login.chinacloudapi.cn/common/oauth2/v2.0/devicecode",http_logout_supported:!0,frontchannel_logout_supported:!0,end_session_endpoint:"https://login.chinacloudapi.cn/common/oauth2/v2.0/logout",claims_supported:["sub","iss","cloud_instance_name","cloud_instance_host_name","cloud_graph_host_name","msgraph_host","aud","exp","iat","auth_time","acr","nonce","preferred_username","name","tid","ver","at_hash","c_hash","email"],kerberos_endpoint:"https://login.chinacloudapi.cn/common/kerberos",tenant_region_scope:null,cloud_instance_name:"partner.microsoftonline.cn",cloud_graph_host_name:"graph.chinacloudapi.cn",msgraph_host:"microsoftgraph.chinacloudapi.cn",rbac_url:"https://pas.chinacloudapi.cn"},"https://login.microsoftonline.us/common/":{token_endpoint:"https://login.microsoftonline.us/common/oauth2/v2.0/token",token_endpoint_auth_methods_supported:["client_secret_post","private_key_jwt","client_secret_basic"],jwks_uri:"https://login.microsoftonline.us/common/discovery/v2.0/keys",response_modes_supported:["query","fragment","form_post"],subject_types_supported:["pairwise"],id_token_signing_alg_values_supported:["RS256"],response_types_supported:["code","id_token","code id_token","id_token token"],scopes_supported:["openid","profile","email","offline_access"],issuer:"https://login.microsoftonline.us/{tenantid}/v2.0",request_uri_parameter_supported:!1,userinfo_endpoint:"https://graph.microsoft.com/oidc/userinfo",authorization_endpoint:"https://login.microsoftonline.us/common/oauth2/v2.0/authorize",device_authorization_endpoint:"https://login.microsoftonline.us/common/oauth2/v2.0/devicecode",http_logout_supported:!0,frontchannel_logout_supported:!0,end_session_endpoint:"https://login.microsoftonline.us/common/oauth2/v2.0/logout",claims_supported:["sub","iss","cloud_instance_name","cloud_instance_host_name","cloud_graph_host_name","msgraph_host","aud","exp","iat","auth_time","acr","nonce","preferred_username","name","tid","ver","at_hash","c_hash","email"],kerberos_endpoint:"https://login.microsoftonline.us/common/kerberos",tenant_region_scope:null,cloud_instance_name:"microsoftonline.us",cloud_graph_host_name:"graph.windows.net",msgraph_host:"graph.microsoft.com",rbac_url:"https://pasff.usgovcloudapi.net"},"https://login.microsoftonline.com/consumers/":{token_endpoint:"https://login.microsoftonline.com/consumers/oauth2/v2.0/token",token_endpoint_auth_methods_supported:["client_secret_post","private_key_jwt","client_secret_basic"],jwks_uri:"https://login.microsoftonline.com/consumers/discovery/v2.0/keys",response_modes_supported:["query","fragment","form_post"],subject_types_supported:["pairwise"],id_token_signing_alg_values_supported:["RS256"],response_types_supported:["code","id_token","code id_token","id_token token"],scopes_supported:["openid","profile","email","offline_access"],issuer:"https://login.microsoftonline.com/9188040d-6c67-4c5b-b112-36a304b66dad/v2.0",request_uri_parameter_supported:!1,userinfo_endpoint:"https://graph.microsoft.com/oidc/userinfo",authorization_endpoint:"https://login.microsoftonline.com/consumers/oauth2/v2.0/authorize",device_authorization_endpoint:"https://login.microsoftonline.com/consumers/oauth2/v2.0/devicecode",http_logout_supported:!0,frontchannel_logout_supported:!0,end_session_endpoint:"https://login.microsoftonline.com/consumers/oauth2/v2.0/logout",claims_supported:["sub","iss","cloud_instance_name","cloud_instance_host_name","cloud_graph_host_name","msgraph_host","aud","exp","iat","auth_time","acr","nonce","preferred_username","name","tid","ver","at_hash","c_hash","email"],kerberos_endpoint:"https://login.microsoftonline.com/consumers/kerberos",tenant_region_scope:null,cloud_instance_name:"microsoftonline.com",cloud_graph_host_name:"graph.windows.net",msgraph_host:"graph.microsoft.com",rbac_url:"https://pas.windows.net"},"https://login.chinacloudapi.cn/consumers/":{token_endpoint:"https://login.chinacloudapi.cn/consumers/oauth2/v2.0/token",token_endpoint_auth_methods_supported:["client_secret_post","private_key_jwt","client_secret_basic"],jwks_uri:"https://login.chinacloudapi.cn/consumers/discovery/v2.0/keys",response_modes_supported:["query","fragment","form_post"],subject_types_supported:["pairwise"],id_token_signing_alg_values_supported:["RS256"],response_types_supported:["code","id_token","code id_token","id_token token"],scopes_supported:["openid","profile","email","offline_access"],issuer:"https://login.partner.microsoftonline.cn/9188040d-6c67-4c5b-b112-36a304b66dad/v2.0",request_uri_parameter_supported:!1,userinfo_endpoint:"https://microsoftgraph.chinacloudapi.cn/oidc/userinfo",authorization_endpoint:"https://login.chinacloudapi.cn/consumers/oauth2/v2.0/authorize",device_authorization_endpoint:"https://login.chinacloudapi.cn/consumers/oauth2/v2.0/devicecode",http_logout_supported:!0,frontchannel_logout_supported:!0,end_session_endpoint:"https://login.chinacloudapi.cn/consumers/oauth2/v2.0/logout",claims_supported:["sub","iss","cloud_instance_name","cloud_instance_host_name","cloud_graph_host_name","msgraph_host","aud","exp","iat","auth_time","acr","nonce","preferred_username","name","tid","ver","at_hash","c_hash","email"],kerberos_endpoint:"https://login.chinacloudapi.cn/consumers/kerberos",tenant_region_scope:null,cloud_instance_name:"partner.microsoftonline.cn",cloud_graph_host_name:"graph.chinacloudapi.cn",msgraph_host:"microsoftgraph.chinacloudapi.cn",rbac_url:"https://pas.chinacloudapi.cn"},"https://login.microsoftonline.us/consumers/":{token_endpoint:"https://login.microsoftonline.us/consumers/oauth2/v2.0/token",token_endpoint_auth_methods_supported:["client_secret_post","private_key_jwt","client_secret_basic"],jwks_uri:"https://login.microsoftonline.us/consumers/discovery/v2.0/keys",response_modes_supported:["query","fragment","form_post"],subject_types_supported:["pairwise"],id_token_signing_alg_values_supported:["RS256"],response_types_supported:["code","id_token","code id_token","id_token token"],scopes_supported:["openid","profile","email","offline_access"],issuer:"https://login.microsoftonline.us/9188040d-6c67-4c5b-b112-36a304b66dad/v2.0",request_uri_parameter_supported:!1,userinfo_endpoint:"https://graph.microsoft.com/oidc/userinfo",authorization_endpoint:"https://login.microsoftonline.us/consumers/oauth2/v2.0/authorize",device_authorization_endpoint:"https://login.microsoftonline.us/consumers/oauth2/v2.0/devicecode",http_logout_supported:!0,frontchannel_logout_supported:!0,end_session_endpoint:"https://login.microsoftonline.us/consumers/oauth2/v2.0/logout",claims_supported:["sub","iss","cloud_instance_name","cloud_instance_host_name","cloud_graph_host_name","msgraph_host","aud","exp","iat","auth_time","acr","nonce","preferred_username","name","tid","ver","at_hash","c_hash","email"],kerberos_endpoint:"https://login.microsoftonline.us/consumers/kerberos",tenant_region_scope:null,cloud_instance_name:"microsoftonline.us",cloud_graph_host_name:"graph.windows.net",msgraph_host:"graph.microsoft.com",rbac_url:"https://pasff.usgovcloudapi.net"},"https://login.microsoftonline.com/organizations/":{token_endpoint:"https://login.microsoftonline.com/organizations/oauth2/v2.0/token",token_endpoint_auth_methods_supported:["client_secret_post","private_key_jwt","client_secret_basic"],jwks_uri:"https://login.microsoftonline.com/organizations/discovery/v2.0/keys",response_modes_supported:["query","fragment","form_post"],subject_types_supported:["pairwise"],id_token_signing_alg_values_supported:["RS256"],response_types_supported:["code","id_token","code id_token","id_token token"],scopes_supported:["openid","profile","email","offline_access"],issuer:"https://login.microsoftonline.com/{tenantid}/v2.0",request_uri_parameter_supported:!1,userinfo_endpoint:"https://graph.microsoft.com/oidc/userinfo",authorization_endpoint:"https://login.microsoftonline.com/organizations/oauth2/v2.0/authorize",device_authorization_endpoint:"https://login.microsoftonline.com/organizations/oauth2/v2.0/devicecode",http_logout_supported:!0,frontchannel_logout_supported:!0,end_session_endpoint:"https://login.microsoftonline.com/organizations/oauth2/v2.0/logout",claims_supported:["sub","iss","cloud_instance_name","cloud_instance_host_name","cloud_graph_host_name","msgraph_host","aud","exp","iat","auth_time","acr","nonce","preferred_username","name","tid","ver","at_hash","c_hash","email"],kerberos_endpoint:"https://login.microsoftonline.com/organizations/kerberos",tenant_region_scope:null,cloud_instance_name:"microsoftonline.com",cloud_graph_host_name:"graph.windows.net",msgraph_host:"graph.microsoft.com",rbac_url:"https://pas.windows.net"},"https://login.chinacloudapi.cn/organizations/":{token_endpoint:"https://login.chinacloudapi.cn/organizations/oauth2/v2.0/token",token_endpoint_auth_methods_supported:["client_secret_post","private_key_jwt","client_secret_basic"],jwks_uri:"https://login.chinacloudapi.cn/organizations/discovery/v2.0/keys",response_modes_supported:["query","fragment","form_post"],subject_types_supported:["pairwise"],id_token_signing_alg_values_supported:["RS256"],response_types_supported:["code","id_token","code id_token","id_token token"],scopes_supported:["openid","profile","email","offline_access"],issuer:"https://login.partner.microsoftonline.cn/{tenantid}/v2.0",request_uri_parameter_supported:!1,userinfo_endpoint:"https://microsoftgraph.chinacloudapi.cn/oidc/userinfo",authorization_endpoint:"https://login.chinacloudapi.cn/organizations/oauth2/v2.0/authorize",device_authorization_endpoint:"https://login.chinacloudapi.cn/organizations/oauth2/v2.0/devicecode",http_logout_supported:!0,frontchannel_logout_supported:!0,end_session_endpoint:"https://login.chinacloudapi.cn/organizations/oauth2/v2.0/logout",claims_supported:["sub","iss","cloud_instance_name","cloud_instance_host_name","cloud_graph_host_name","msgraph_host","aud","exp","iat","auth_time","acr","nonce","preferred_username","name","tid","ver","at_hash","c_hash","email"],kerberos_endpoint:"https://login.chinacloudapi.cn/organizations/kerberos",tenant_region_scope:null,cloud_instance_name:"partner.microsoftonline.cn",cloud_graph_host_name:"graph.chinacloudapi.cn",msgraph_host:"microsoftgraph.chinacloudapi.cn",rbac_url:"https://pas.chinacloudapi.cn"},"https://login.microsoftonline.us/organizations/":{token_endpoint:"https://login.microsoftonline.us/organizations/oauth2/v2.0/token",token_endpoint_auth_methods_supported:["client_secret_post","private_key_jwt","client_secret_basic"],jwks_uri:"https://login.microsoftonline.us/organizations/discovery/v2.0/keys",response_modes_supported:["query","fragment","form_post"],subject_types_supported:["pairwise"],id_token_signing_alg_values_supported:["RS256"],response_types_supported:["code","id_token","code id_token","id_token token"],scopes_supported:["openid","profile","email","offline_access"],issuer:"https://login.microsoftonline.us/{tenantid}/v2.0",request_uri_parameter_supported:!1,userinfo_endpoint:"https://graph.microsoft.com/oidc/userinfo",authorization_endpoint:"https://login.microsoftonline.us/organizations/oauth2/v2.0/authorize",device_authorization_endpoint:"https://login.microsoftonline.us/organizations/oauth2/v2.0/devicecode",http_logout_supported:!0,frontchannel_logout_supported:!0,end_session_endpoint:"https://login.microsoftonline.us/organizations/oauth2/v2.0/logout",claims_supported:["sub","iss","cloud_instance_name","cloud_instance_host_name","cloud_graph_host_name","msgraph_host","aud","exp","iat","auth_time","acr","nonce","preferred_username","name","tid","ver","at_hash","c_hash","email"],kerberos_endpoint:"https://login.microsoftonline.us/organizations/kerberos",tenant_region_scope:null,cloud_instance_name:"microsoftonline.us",cloud_graph_host_name:"graph.windows.net",msgraph_host:"graph.microsoft.com",rbac_url:"https://pasff.usgovcloudapi.net"}},fl={"https://login.microsoftonline.com/common/":{tenant_discovery_endpoint:"https://login.microsoftonline.com/common/v2.0/.well-known/openid-configuration","api-version":"1.1",metadata:[{preferred_network:"login.microsoftonline.com",preferred_cache:"login.windows.net",aliases:["login.microsoftonline.com","login.windows.net","login.microsoft.com","sts.windows.net"]},{preferred_network:"login.partner.microsoftonline.cn",preferred_cache:"login.partner.microsoftonline.cn",aliases:["login.partner.microsoftonline.cn","login.chinacloudapi.cn"]},{preferred_network:"login.microsoftonline.de",preferred_cache:"login.microsoftonline.de",aliases:["login.microsoftonline.de"]},{preferred_network:"login.microsoftonline.us",preferred_cache:"login.microsoftonline.us",aliases:["login.microsoftonline.us","login.usgovcloudapi.net"]},{preferred_network:"login-us.microsoftonline.com",preferred_cache:"login-us.microsoftonline.com",aliases:["login-us.microsoftonline.com"]}]},"https://login.chinacloudapi.cn/common/":{tenant_discovery_endpoint:"https://login.chinacloudapi.cn/common/v2.0/.well-known/openid-configuration","api-version":"1.1",metadata:[{preferred_network:"login.microsoftonline.com",preferred_cache:"login.windows.net",aliases:["login.microsoftonline.com","login.windows.net","login.microsoft.com","sts.windows.net"]},{preferred_network:"login.partner.microsoftonline.cn",preferred_cache:"login.partner.microsoftonline.cn",aliases:["login.partner.microsoftonline.cn","login.chinacloudapi.cn"]},{preferred_network:"login.microsoftonline.de",preferred_cache:"login.microsoftonline.de",aliases:["login.microsoftonline.de"]},{preferred_network:"login.microsoftonline.us",preferred_cache:"login.microsoftonline.us",aliases:["login.microsoftonline.us","login.usgovcloudapi.net"]},{preferred_network:"login-us.microsoftonline.com",preferred_cache:"login-us.microsoftonline.com",aliases:["login-us.microsoftonline.com"]}]},"https://login.microsoftonline.us/common/":{tenant_discovery_endpoint:"https://login.microsoftonline.us/common/v2.0/.well-known/openid-configuration","api-version":"1.1",metadata:[{preferred_network:"login.microsoftonline.com",preferred_cache:"login.windows.net",aliases:["login.microsoftonline.com","login.windows.net","login.microsoft.com","sts.windows.net"]},{preferred_network:"login.partner.microsoftonline.cn",preferred_cache:"login.partner.microsoftonline.cn",aliases:["login.partner.microsoftonline.cn","login.chinacloudapi.cn"]},{preferred_network:"login.microsoftonline.de",preferred_cache:"login.microsoftonline.de",aliases:["login.microsoftonline.de"]},{preferred_network:"login.microsoftonline.us",preferred_cache:"login.microsoftonline.us",aliases:["login.microsoftonline.us","login.usgovcloudapi.net"]},{preferred_network:"login-us.microsoftonline.com",preferred_cache:"login-us.microsoftonline.com",aliases:["login-us.microsoftonline.com"]}]},"https://login.microsoftonline.com/consumers/":{tenant_discovery_endpoint:"https://login.microsoftonline.com/consumers/v2.0/.well-known/openid-configuration","api-version":"1.1",metadata:[{preferred_network:"login.microsoftonline.com",preferred_cache:"login.windows.net",aliases:["login.microsoftonline.com","login.windows.net","login.microsoft.com","sts.windows.net"]},{preferred_network:"login.partner.microsoftonline.cn",preferred_cache:"login.partner.microsoftonline.cn",aliases:["login.partner.microsoftonline.cn","login.chinacloudapi.cn"]},{preferred_network:"login.microsoftonline.de",preferred_cache:"login.microsoftonline.de",aliases:["login.microsoftonline.de"]},{preferred_network:"login.microsoftonline.us",preferred_cache:"login.microsoftonline.us",aliases:["login.microsoftonline.us","login.usgovcloudapi.net"]},{preferred_network:"login-us.microsoftonline.com",preferred_cache:"login-us.microsoftonline.com",aliases:["login-us.microsoftonline.com"]}]},"https://login.chinacloudapi.cn/consumers/":{tenant_discovery_endpoint:"https://login.chinacloudapi.cn/consumers/v2.0/.well-known/openid-configuration","api-version":"1.1",metadata:[{preferred_network:"login.microsoftonline.com",preferred_cache:"login.windows.net",aliases:["login.microsoftonline.com","login.windows.net","login.microsoft.com","sts.windows.net"]},{preferred_network:"login.partner.microsoftonline.cn",preferred_cache:"login.partner.microsoftonline.cn",aliases:["login.partner.microsoftonline.cn","login.chinacloudapi.cn"]},{preferred_network:"login.microsoftonline.de",preferred_cache:"login.microsoftonline.de",aliases:["login.microsoftonline.de"]},{preferred_network:"login.microsoftonline.us",preferred_cache:"login.microsoftonline.us",aliases:["login.microsoftonline.us","login.usgovcloudapi.net"]},{preferred_network:"login-us.microsoftonline.com",preferred_cache:"login-us.microsoftonline.com",aliases:["login-us.microsoftonline.com"]}]},"https://login.microsoftonline.us/consumers/":{tenant_discovery_endpoint:"https://login.microsoftonline.us/consumers/v2.0/.well-known/openid-configuration","api-version":"1.1",metadata:[{preferred_network:"login.microsoftonline.com",preferred_cache:"login.windows.net",aliases:["login.microsoftonline.com","login.windows.net","login.microsoft.com","sts.windows.net"]},{preferred_network:"login.partner.microsoftonline.cn",preferred_cache:"login.partner.microsoftonline.cn",aliases:["login.partner.microsoftonline.cn","login.chinacloudapi.cn"]},{preferred_network:"login.microsoftonline.de",preferred_cache:"login.microsoftonline.de",aliases:["login.microsoftonline.de"]},{preferred_network:"login.microsoftonline.us",preferred_cache:"login.microsoftonline.us",aliases:["login.microsoftonline.us","login.usgovcloudapi.net"]},{preferred_network:"login-us.microsoftonline.com",preferred_cache:"login-us.microsoftonline.com",aliases:["login-us.microsoftonline.com"]}]},"https://login.microsoftonline.com/organizations/":{tenant_discovery_endpoint:"https://login.microsoftonline.com/organizations/v2.0/.well-known/openid-configuration","api-version":"1.1",metadata:[{preferred_network:"login.microsoftonline.com",preferred_cache:"login.windows.net",aliases:["login.microsoftonline.com","login.windows.net","login.microsoft.com","sts.windows.net"]},{preferred_network:"login.partner.microsoftonline.cn",preferred_cache:"login.partner.microsoftonline.cn",aliases:["login.partner.microsoftonline.cn","login.chinacloudapi.cn"]},{preferred_network:"login.microsoftonline.de",preferred_cache:"login.microsoftonline.de",aliases:["login.microsoftonline.de"]},{preferred_network:"login.microsoftonline.us",preferred_cache:"login.microsoftonline.us",aliases:["login.microsoftonline.us","login.usgovcloudapi.net"]},{preferred_network:"login-us.microsoftonline.com",preferred_cache:"login-us.microsoftonline.com",aliases:["login-us.microsoftonline.com"]}]},"https://login.chinacloudapi.cn/organizations/":{tenant_discovery_endpoint:"https://login.chinacloudapi.cn/organizations/v2.0/.well-known/openid-configuration","api-version":"1.1",metadata:[{preferred_network:"login.microsoftonline.com",preferred_cache:"login.windows.net",aliases:["login.microsoftonline.com","login.windows.net","login.microsoft.com","sts.windows.net"]},{preferred_network:"login.partner.microsoftonline.cn",preferred_cache:"login.partner.microsoftonline.cn",aliases:["login.partner.microsoftonline.cn","login.chinacloudapi.cn"]},{preferred_network:"login.microsoftonline.de",preferred_cache:"login.microsoftonline.de",aliases:["login.microsoftonline.de"]},{preferred_network:"login.microsoftonline.us",preferred_cache:"login.microsoftonline.us",aliases:["login.microsoftonline.us","login.usgovcloudapi.net"]},{preferred_network:"login-us.microsoftonline.com",preferred_cache:"login-us.microsoftonline.com",aliases:["login-us.microsoftonline.com"]}]},"https://login.microsoftonline.us/organizations/":{tenant_discovery_endpoint:"https://login.microsoftonline.us/organizations/v2.0/.well-known/openid-configuration","api-version":"1.1",metadata:[{preferred_network:"login.microsoftonline.com",preferred_cache:"login.windows.net",aliases:["login.microsoftonline.com","login.windows.net","login.microsoft.com","sts.windows.net"]},{preferred_network:"login.partner.microsoftonline.cn",preferred_cache:"login.partner.microsoftonline.cn",aliases:["login.partner.microsoftonline.cn","login.chinacloudapi.cn"]},{preferred_network:"login.microsoftonline.de",preferred_cache:"login.microsoftonline.de",aliases:["login.microsoftonline.de"]},{preferred_network:"login.microsoftonline.us",preferred_cache:"login.microsoftonline.us",aliases:["login.microsoftonline.us","login.usgovcloudapi.net"]},{preferred_network:"login-us.microsoftonline.com",preferred_cache:"login-us.microsoftonline.com",aliases:["login-us.microsoftonline.com"]}]}};var pl,vl=function(){function e(e,t,n){this.networkInterface=e,this.performanceClient=t,this.correlationId=n}return e.prototype.detectRegion=function(t,n){var r,i,o,a;return Xi(this,void 0,void 0,(function(){var s,u,c,l,d;return $i(this,(function(h){switch(h.label){case 0:if(null===(r=this.performanceClient)||void 0===r||r.addQueueMeasurement(qi.RegionDiscoveryDetectRegion,this.correlationId),s=t)return[3,8];u=e.IMDS_OPTIONS,h.label=1;case 1:return h.trys.push([1,6,,7]),null===(i=this.performanceClient)||void 0===i||i.setPreQueueTime(qi.RegionDiscoveryGetRegionFromIMDS,this.correlationId),[4,this.getRegionFromIMDS(ao.IMDS_VERSION,u)];case 2:return(c=h.sent()).status===Io.httpSuccess&&(s=c.body,n.region_source=Ao.IMDS),c.status!==Io.httpBadRequest?[3,5]:(null===(o=this.performanceClient)||void 0===o||o.setPreQueueTime(qi.RegionDiscoveryGetCurrentVersion,this.correlationId),[4,this.getCurrentVersion(u)]);case 3:return(l=h.sent())?(null===(a=this.performanceClient)||void 0===a||a.setPreQueueTime(qi.RegionDiscoveryGetRegionFromIMDS,this.correlationId),[4,this.getRegionFromIMDS(l,u)]):(n.region_source=Ao.FAILED_AUTO_DETECTION,[2,null]);case 4:(d=h.sent()).status===Io.httpSuccess&&(s=d.body,n.region_source=Ao.IMDS),h.label=5;case 5:return[3,7];case 6:return h.sent(),n.region_source=Ao.FAILED_AUTO_DETECTION,[2,null];case 7:return[3,9];case 8:n.region_source=Ao.ENVIRONMENT_VARIABLE,h.label=9;case 9:return s||(n.region_source=Ao.FAILED_AUTO_DETECTION),[2,s||null]}}))}))},e.prototype.getRegionFromIMDS=function(e,t){var n;return Xi(this,void 0,void 0,(function(){return $i(this,(function(r){return null===(n=this.performanceClient)||void 0===n||n.addQueueMeasurement(qi.RegionDiscoveryGetRegionFromIMDS,this.correlationId),[2,this.networkInterface.sendGetRequestAsync(ao.IMDS_ENDPOINT+"?api-version="+e+"&format=text",t,ao.IMDS_TIMEOUT)]}))}))},e.prototype.getCurrentVersion=function(e){var t;return Xi(this,void 0,void 0,(function(){var n;return $i(this,(function(r){switch(r.label){case 0:null===(t=this.performanceClient)||void 0===t||t.addQueueMeasurement(qi.RegionDiscoveryGetCurrentVersion,this.correlationId),r.label=1;case 1:return r.trys.push([1,3,,4]),[4,this.networkInterface.sendGetRequestAsync(ao.IMDS_ENDPOINT+"?format=json",e)];case 2:return(n=r.sent()).status===Io.httpBadRequest&&n.body&&n.body["newest-versions"]&&n.body["newest-versions"].length>0?[2,n.body["newest-versions"][0]]:[2,null];case 3:return r.sent(),[2,null];case 4:return[2]}}))}))},e.IMDS_OPTIONS={headers:{Metadata:"true"}},e}(),gl=function(){function e(e,t,n,r,i,o,a){this.canonicalAuthority=e,this._canonicalAuthority.validateAsUri(),this.networkInterface=t,this.cacheManager=n,this.authorityOptions=r,this.regionDiscoveryMetadata={region_used:void 0,region_source:void 0,region_outcome:void 0},this.logger=i,this.performanceClient=o,this.correlationId=a,this.regionDiscovery=new vl(t,this.performanceClient,this.correlationId)}return e.prototype.getAuthorityType=function(e){if(e.HostNameAndPort.endsWith(ao.CIAM_AUTH_URL))return Mu.Ciam;var t=e.PathSegments;if(t.length)switch(t[0].toLowerCase()){case ao.ADFS:return Mu.Adfs;case ao.DSTS:return Mu.Dsts}return Mu.Default},Object.defineProperty(e.prototype,"authorityType",{get:function(){return this.getAuthorityType(this.canonicalAuthorityUrlComponents)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"protocolMode",{get:function(){return this.authorityOptions.protocolMode},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"options",{get:function(){return this.authorityOptions},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"canonicalAuthority",{get:function(){return this._canonicalAuthority.urlString},set:function(e){this._canonicalAuthority=new Oc(e),this._canonicalAuthority.validateAsUri(),this._canonicalAuthorityUrlComponents=null},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"canonicalAuthorityUrlComponents",{get:function(){return this._canonicalAuthorityUrlComponents||(this._canonicalAuthorityUrlComponents=this._canonicalAuthority.getUrlComponents()),this._canonicalAuthorityUrlComponents},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"hostnameAndPort",{get:function(){return this.canonicalAuthorityUrlComponents.HostNameAndPort.toLowerCase()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"tenant",{get:function(){return this.canonicalAuthorityUrlComponents.PathSegments[0]},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"authorizationEndpoint",{get:function(){if(this.discoveryComplete())return this.replacePath(this.metadata.authorization_endpoint);throw bs.createEndpointDiscoveryIncompleteError("Discovery incomplete.")},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"tokenEndpoint",{get:function(){if(this.discoveryComplete())return this.replacePath(this.metadata.token_endpoint);throw bs.createEndpointDiscoveryIncompleteError("Discovery incomplete.")},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"deviceCodeEndpoint",{get:function(){if(this.discoveryComplete())return this.replacePath(this.metadata.token_endpoint.replace("/token","/devicecode"));throw bs.createEndpointDiscoveryIncompleteError("Discovery incomplete.")},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"endSessionEndpoint",{get:function(){if(this.discoveryComplete()){if(!this.metadata.end_session_endpoint)throw bs.createLogoutNotSupportedError();return this.replacePath(this.metadata.end_session_endpoint)}throw bs.createEndpointDiscoveryIncompleteError("Discovery incomplete.")},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"selfSignedJwtAudience",{get:function(){if(this.discoveryComplete())return this.replacePath(this.metadata.issuer);throw bs.createEndpointDiscoveryIncompleteError("Discovery incomplete.")},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"jwksUri",{get:function(){if(this.discoveryComplete())return this.replacePath(this.metadata.jwks_uri);throw bs.createEndpointDiscoveryIncompleteError("Discovery incomplete.")},enumerable:!1,configurable:!0}),e.prototype.canReplaceTenant=function(t){return 1===t.PathSegments.length&&!e.reservedTenantDomains.has(t.PathSegments[0])&&this.getAuthorityType(t)===Mu.Default&&this.protocolMode===_c.AAD},e.prototype.replaceTenant=function(e){return e.replace(/{tenant}|{tenantid}/g,this.tenant)},e.prototype.replacePath=function(e){var t=this,n=e,r=new Oc(this.metadata.canonical_authority).getUrlComponents(),i=r.PathSegments;return this.canonicalAuthorityUrlComponents.PathSegments.forEach((function(e,o){var a=i[o];if(0===o&&t.canReplaceTenant(r)){var s=new Oc(t.metadata.authorization_endpoint).getUrlComponents().PathSegments[0];a!==s&&(t.logger.verbose("Replacing tenant domain name "+a+" with id "+s),a=s)}e!==a&&(n=n.replace("/"+a+"/","/"+e+"/"))})),this.replaceTenant(n)},Object.defineProperty(e.prototype,"defaultOpenIdConfigurationEndpoint",{get:function(){return this.authorityType===Mu.Adfs||this.authorityType===Mu.Dsts||this.protocolMode===_c.OIDC?this.canonicalAuthority+".well-known/openid-configuration":this.canonicalAuthority+"v2.0/.well-known/openid-configuration"},enumerable:!1,configurable:!0}),e.prototype.discoveryComplete=function(){return!!this.metadata},e.prototype.resolveEndpointsAsync=function(){var e,t,n;return Xi(this,void 0,void 0,(function(){var r,i,o,a;return $i(this,(function(s){switch(s.label){case 0:return null===(e=this.performanceClient)||void 0===e||e.addQueueMeasurement(qi.AuthorityResolveEndpointsAsync,this.correlationId),(r=this.cacheManager.getAuthorityMetadataByAlias(this.hostnameAndPort))||(r=new Ic).updateCanonicalAuthority(this.canonicalAuthority),null===(t=this.performanceClient)||void 0===t||t.setPreQueueTime(qi.AuthorityUpdateCloudDiscoveryMetadata,this.correlationId),[4,this.updateCloudDiscoveryMetadata(r)];case 1:return i=s.sent(),this.canonicalAuthority=this.canonicalAuthority.replace(this.hostnameAndPort,r.preferred_network),null===(n=this.performanceClient)||void 0===n||n.setPreQueueTime(qi.AuthorityUpdateEndpointMetadata,this.correlationId),[4,this.updateEndpointMetadata(r)];case 2:return o=s.sent(),i!==bo.CACHE&&o!==bo.CACHE&&(r.resetExpiresAt(),r.updateCanonicalAuthority(this.canonicalAuthority)),a=this.cacheManager.generateAuthorityMetadataCacheKey(r.preferred_cache),this.cacheManager.setAuthorityMetadata(a,r),this.metadata=r,[2]}}))}))},e.prototype.updateEndpointMetadata=function(e){var t,n,r,i,o,a;return Xi(this,void 0,void 0,(function(){var s,u;return $i(this,(function(c){switch(c.label){case 0:return null===(t=this.performanceClient)||void 0===t||t.addQueueMeasurement(qi.AuthorityUpdateEndpointMetadata,this.correlationId),(s=this.getEndpointMetadataFromConfig())?(e.updateEndpointMetadata(s,!1),[2,bo.CONFIG]):this.isAuthoritySameType(e)&&e.endpointsFromNetwork&&!e.isExpired()?[2,bo.CACHE]:(null===(n=this.performanceClient)||void 0===n||n.setPreQueueTime(qi.AuthorityGetEndpointMetadataFromNetwork,this.correlationId),[4,this.getEndpointMetadataFromNetwork()]);case 1:return(s=c.sent())?(null===(r=this.authorityOptions.azureRegionConfiguration)||void 0===r?void 0:r.azureRegion)?(null===(i=this.performanceClient)||void 0===i||i.setPreQueueTime(qi.AuthorityUpdateMetadataWithRegionalInformation,this.correlationId),[4,this.updateMetadataWithRegionalInformation(s)]):[3,3]:[3,4];case 2:s=c.sent(),c.label=3;case 3:return e.updateEndpointMetadata(s,!0),[2,bo.NETWORK];case 4:return!(u=this.getEndpointMetadataFromHardcodedValues())||this.authorityOptions.skipAuthorityMetadataCache?[3,7]:(null===(o=this.authorityOptions.azureRegionConfiguration)||void 0===o?void 0:o.azureRegion)?(null===(a=this.performanceClient)||void 0===a||a.setPreQueueTime(qi.AuthorityUpdateMetadataWithRegionalInformation,this.correlationId),[4,this.updateMetadataWithRegionalInformation(u)]):[3,6];case 5:u=c.sent(),c.label=6;case 6:return e.updateEndpointMetadata(u,!1),[2,bo.HARDCODED_VALUES];case 7:throw bs.createUnableToGetOpenidConfigError(this.defaultOpenIdConfigurationEndpoint)}}))}))},e.prototype.isAuthoritySameType=function(e){return new Oc(e.canonical_authority).getUrlComponents().PathSegments.length===this.canonicalAuthorityUrlComponents.PathSegments.length},e.prototype.getEndpointMetadataFromConfig=function(){if(this.authorityOptions.authorityMetadata)try{return JSON.parse(this.authorityOptions.authorityMetadata)}catch(Oi){throw dc.createInvalidAuthorityMetadataError()}return null},e.prototype.getEndpointMetadataFromNetwork=function(){var e;return Xi(this,void 0,void 0,(function(){var t,n;return $i(this,(function(r){switch(r.label){case 0:null===(e=this.performanceClient)||void 0===e||e.addQueueMeasurement(qi.AuthorityGetEndpointMetadataFromNetwork,this.correlationId),t={},r.label=1;case 1:return r.trys.push([1,3,,4]),[4,this.networkInterface.sendGetRequestAsync(this.defaultOpenIdConfigurationEndpoint,t)];case 2:return[2,dl((n=r.sent()).body)?n.body:null];case 3:return r.sent(),[2,null];case 4:return[2]}}))}))},e.prototype.getEndpointMetadataFromHardcodedValues=function(){return this.canonicalAuthority in hl?hl[this.canonicalAuthority]:null},e.prototype.updateMetadataWithRegionalInformation=function(t){var n,r,i,o;return Xi(this,void 0,void 0,(function(){var a,s;return $i(this,(function(u){switch(u.label){case 0:return null===(n=this.performanceClient)||void 0===n||n.addQueueMeasurement(qi.AuthorityUpdateMetadataWithRegionalInformation,this.correlationId),(a=null===(r=this.authorityOptions.azureRegionConfiguration)||void 0===r?void 0:r.azureRegion)?a!==ao.AZURE_REGION_AUTO_DISCOVER_FLAG?(this.regionDiscoveryMetadata.region_outcome=Ro.CONFIGURED_NO_AUTO_DETECTION,this.regionDiscoveryMetadata.region_used=a,[2,e.replaceWithRegionalInformation(t,a)]):(null===(i=this.performanceClient)||void 0===i||i.setPreQueueTime(qi.RegionDiscoveryDetectRegion,this.correlationId),[4,this.regionDiscovery.detectRegion(null===(o=this.authorityOptions.azureRegionConfiguration)||void 0===o?void 0:o.environmentRegion,this.regionDiscoveryMetadata)]):[3,2];case 1:if(s=u.sent())return this.regionDiscoveryMetadata.region_outcome=Ro.AUTO_DETECTION_REQUESTED_SUCCESSFUL,this.regionDiscoveryMetadata.region_used=s,[2,e.replaceWithRegionalInformation(t,s)];this.regionDiscoveryMetadata.region_outcome=Ro.AUTO_DETECTION_REQUESTED_FAILED,u.label=2;case 2:return[2,t]}}))}))},e.prototype.updateCloudDiscoveryMetadata=function(e){var t,n;return Xi(this,void 0,void 0,(function(){var r,i,o;return $i(this,(function(a){switch(a.label){case 0:return null===(t=this.performanceClient)||void 0===t||t.addQueueMeasurement(qi.AuthorityUpdateCloudDiscoveryMetadata,this.correlationId),this.logger.verbose("Attempting to get cloud discovery metadata in the config"),this.logger.verbosePii("Known Authorities: "+(this.authorityOptions.knownAuthorities||ao.NOT_APPLICABLE)),this.logger.verbosePii("Authority Metadata: "+(this.authorityOptions.authorityMetadata||ao.NOT_APPLICABLE)),this.logger.verbosePii("Canonical Authority: "+(e.canonical_authority||ao.NOT_APPLICABLE)),(r=this.getCloudDiscoveryMetadataFromConfig())?(this.logger.verbose("Found cloud discovery metadata in the config."),e.updateCloudDiscoveryMetadata(r,!1),[2,bo.CONFIG]):(this.logger.verbose("Did not find cloud discovery metadata in the config... Attempting to get cloud discovery metadata from the cache."),i=e.isExpired(),this.isAuthoritySameType(e)&&e.aliasesFromNetwork&&!i?(this.logger.verbose("Found metadata in the cache."),[2,bo.CACHE]):(i&&this.logger.verbose("The metadata entity is expired."),this.logger.verbose("Did not find cloud discovery metadata in the cache... Attempting to get cloud discovery metadata from the network."),null===(n=this.performanceClient)||void 0===n||n.setPreQueueTime(qi.AuthorityGetCloudDiscoveryMetadataFromNetwork,this.correlationId),[4,this.getCloudDiscoveryMetadataFromNetwork()]));case 1:if(r=a.sent())return this.logger.verbose("cloud discovery metadata was successfully returned from getCloudDiscoveryMetadataFromNetwork()"),e.updateCloudDiscoveryMetadata(r,!0),[2,bo.NETWORK];if(this.logger.verbose("Did not find cloud discovery metadata from the network... Attempting to get cloud discovery metadata from hardcoded values."),(o=this.getCloudDiscoveryMetadataFromHarcodedValues())&&!this.options.skipAuthorityMetadataCache)return this.logger.verbose("Found cloud discovery metadata from hardcoded values."),e.updateCloudDiscoveryMetadata(o,!1),[2,bo.HARDCODED_VALUES];throw this.logger.error("Did not find cloud discovery metadata from hardcoded values... Metadata could not be obtained from config, cache, network or hardcoded values. Throwing Untrusted Authority Error."),dc.createUntrustedAuthorityError()}}))}))},e.prototype.getCloudDiscoveryMetadataFromConfig=function(){if(this.authorityType===Mu.Ciam)return this.logger.verbose("CIAM authorities do not support cloud discovery metadata, generate the aliases from authority host."),e.createCloudDiscoveryMetadataFromHost(this.hostnameAndPort);if(this.authorityOptions.cloudDiscoveryMetadata){this.logger.verbose("The cloud discovery metadata has been provided as a network response, in the config.");try{this.logger.verbose("Attempting to parse the cloud discovery metadata.");var t=JSON.parse(this.authorityOptions.cloudDiscoveryMetadata),n=e.getCloudDiscoveryMetadataFromNetworkResponse(t.metadata,this.hostnameAndPort);if(this.logger.verbose("Parsed the cloud discovery metadata."),n)return this.logger.verbose("There is returnable metadata attached to the parsed cloud discovery metadata."),n;this.logger.verbose("There is no metadata attached to the parsed cloud discovery metadata.")}catch(Oi){throw this.logger.verbose("Unable to parse the cloud discovery metadata. Throwing Invalid Cloud Discovery Metadata Error."),dc.createInvalidCloudDiscoveryMetadataError()}}return this.isInKnownAuthorities()?(this.logger.verbose("The host is included in knownAuthorities. Creating new cloud discovery metadata from the host."),e.createCloudDiscoveryMetadataFromHost(this.hostnameAndPort)):null},e.prototype.getCloudDiscoveryMetadataFromNetwork=function(){var t;return Xi(this,void 0,void 0,(function(){var n,r,i,o,a,s,u,c;return $i(this,(function(l){switch(l.label){case 0:null===(t=this.performanceClient)||void 0===t||t.addQueueMeasurement(qi.AuthorityGetCloudDiscoveryMetadataFromNetwork,this.correlationId),n=""+ao.AAD_INSTANCE_DISCOVERY_ENDPT+this.canonicalAuthority+"oauth2/v2.0/authorize",r={},i=null,l.label=1;case 1:return l.trys.push([1,3,,4]),[4,this.networkInterface.sendGetRequestAsync(n,r)];case 2:if(o=l.sent(),a=void 0,s=void 0,function(e){return e.hasOwnProperty("tenant_discovery_endpoint")&&e.hasOwnProperty("metadata")}(o.body))a=o.body,s=a.metadata,this.logger.verbosePii("tenant_discovery_endpoint is: "+a.tenant_discovery_endpoint);else{if(!function(e){return e.hasOwnProperty("error")&&e.hasOwnProperty("error_description")}(o.body))return this.logger.error("AAD did not return a CloudInstanceDiscoveryResponse or CloudInstanceDiscoveryErrorResponse"),[2,null];if(this.logger.warning("A CloudInstanceDiscoveryErrorResponse was returned. The cloud instance discovery network request's status code is: "+o.status),(a=o.body).error===ao.INVALID_INSTANCE)return this.logger.error("The CloudInstanceDiscoveryErrorResponse error is invalid_instance."),[2,null];this.logger.warning("The CloudInstanceDiscoveryErrorResponse error is "+a.error),this.logger.warning("The CloudInstanceDiscoveryErrorResponse error description is "+a.error_description),this.logger.warning("Setting the value of the CloudInstanceDiscoveryMetadata (returned from the network) to []"),s=[]}return this.logger.verbose("Attempting to find a match between the developer's authority and the CloudInstanceDiscoveryMetadata returned from the network request."),i=e.getCloudDiscoveryMetadataFromNetworkResponse(s,this.hostnameAndPort),[3,4];case 3:return(u=l.sent())instanceof Jo?this.logger.error("There was a network error while attempting to get the cloud discovery instance metadata.\nError: "+u.errorCode+"\nError Description: "+u.errorMessage):(c=u,this.logger.error("A non-MSALJS error was thrown while attempting to get the cloud instance discovery metadata.\nError: "+c.name+"\nError Description: "+c.message)),[2,null];case 4:return i||(this.logger.warning("The developer's authority was not found within the CloudInstanceDiscoveryMetadata returned from the network request."),this.logger.verbose("Creating custom Authority for custom domain scenario."),i=e.createCloudDiscoveryMetadataFromHost(this.hostnameAndPort)),[2,i]}}))}))},e.prototype.getCloudDiscoveryMetadataFromHarcodedValues=function(){return this.canonicalAuthority in fl?fl[this.canonicalAuthority]:null},e.prototype.isInKnownAuthorities=function(){var e=this;return this.authorityOptions.knownAuthorities.filter((function(t){return Oc.getDomainFromUrl(t).toLowerCase()===e.hostnameAndPort})).length>0},e.generateAuthority=function(e,t){var n;if(t&&t.azureCloudInstance!==Pc.None){var r=t.tenant?t.tenant:ao.DEFAULT_COMMON_TENANT;n=t.azureCloudInstance+"/"+r+"/"}return n||e},e.createCloudDiscoveryMetadataFromHost=function(e){return{preferred_network:e,preferred_cache:e,aliases:[e]}},e.getCloudDiscoveryMetadataFromNetworkResponse=function(e,t){for(var n=0;n<e.length;n++){var r=e[n];if(r.aliases.indexOf(t)>-1)return r}return null},e.prototype.getPreferredCache=function(){if(this.discoveryComplete())return this.metadata.preferred_cache;throw bs.createEndpointDiscoveryIncompleteError("Discovery incomplete.")},e.prototype.isAlias=function(e){return this.metadata.aliases.indexOf(e)>-1},e.isPublicCloudAuthority=function(e){return ao.KNOWN_PUBLIC_CLOUDS.indexOf(e)>=0},e.buildRegionalAuthorityString=function(e,t,n){var r=new Oc(e);r.validateAsUri();var i=r.getUrlComponents(),o=t+"."+i.HostNameAndPort;this.isPublicCloudAuthority(i.HostNameAndPort)&&(o=t+"."+ao.REGIONAL_AUTH_PUBLIC_CLOUD_SUFFIX);var a=Oc.constructAuthorityUriFromObject(Yi(Yi({},r.getUrlComponents()),{HostNameAndPort:o})).urlString;return n?a+"?"+n:a},e.replaceWithRegionalInformation=function(t,n){return t.authorization_endpoint=e.buildRegionalAuthorityString(t.authorization_endpoint,n),t.token_endpoint=e.buildRegionalAuthorityString(t.token_endpoint,n,ao.REGIONAL_AUTH_NON_MSI_QUERY_STRING),t.end_session_endpoint&&(t.end_session_endpoint=e.buildRegionalAuthorityString(t.end_session_endpoint,n)),t},e.transformCIAMAuthority=function(e){var t=e.endsWith(ao.FORWARD_SLASH)?e:""+e+ao.FORWARD_SLASH,n=new Oc(e).getUrlComponents();0===n.PathSegments.length&&n.HostNameAndPort.endsWith(ao.CIAM_AUTH_URL)&&(t=""+t+n.HostNameAndPort.split(".")[0]+ao.AAD_TENANT_DOMAIN_SUFFIX);return t},e.reservedTenantDomains=new Set(["{tenant}","{tenantid}",ro.COMMON,ro.CONSUMERS,ro.ORGANIZATIONS]),e}(),ml=function(){function e(){}return e.createDiscoveredInstance=function(t,n,r,i,o,a,s){return Xi(this,void 0,void 0,(function(){var u,c,l;return $i(this,(function(d){switch(d.label){case 0:null===a||void 0===a||a.addQueueMeasurement(qi.AuthorityFactoryCreateDiscoveredInstance,s),u=gl.transformCIAMAuthority(t),c=e.createInstance(u,n,r,i,o,a,s),d.label=1;case 1:return d.trys.push([1,3,,4]),null===a||void 0===a||a.setPreQueueTime(qi.AuthorityResolveEndpointsAsync,s),[4,c.resolveEndpointsAsync()];case 2:return d.sent(),[2,c];case 3:throw l=d.sent(),bs.createEndpointDiscoveryIncompleteError(l);case 4:return[2]}}))}))},e.createInstance=function(e,t,n,r,i,o,a){if(ws.isEmpty(e))throw dc.createUrlEmptyError();return new gl(e,t,n,r,i,o,a)},e}(),yl=function(){function e(e,t){this.cacheOutcome=_o.NO_CACHE_HIT,this.cacheManager=t,this.apiId=e.apiId,this.correlationId=e.correlationId,this.wrapperSKU=e.wrapperSKU||ao.EMPTY_STRING,this.wrapperVer=e.wrapperVer||ao.EMPTY_STRING,this.telemetryCacheKey=Eo.CACHE_KEY+vo.CACHE_KEY_SEPARATOR+e.clientId}return e.prototype.generateCurrentRequestHeaderValue=function(){var e=""+this.apiId+Eo.VALUE_SEPARATOR+this.cacheOutcome,t=[this.wrapperSKU,this.wrapperVer].join(Eo.VALUE_SEPARATOR),n=[e,this.getRegionDiscoveryFields()].join(Eo.VALUE_SEPARATOR);return[Eo.SCHEMA_VERSION,n,t].join(Eo.CATEGORY_SEPARATOR)},e.prototype.generateLastRequestHeaderValue=function(){var t=this.getLastRequests(),n=e.maxErrorsToSend(t),r=t.failedRequests.slice(0,2*n).join(Eo.VALUE_SEPARATOR),i=t.errors.slice(0,n).join(Eo.VALUE_SEPARATOR),o=t.errors.length,a=[o,n<o?Eo.OVERFLOW_TRUE:Eo.OVERFLOW_FALSE].join(Eo.VALUE_SEPARATOR);return[Eo.SCHEMA_VERSION,t.cacheHits,r,i,a].join(Eo.CATEGORY_SEPARATOR)},e.prototype.cacheFailedRequest=function(e){var t=this.getLastRequests();t.errors.length>=Eo.MAX_CACHED_ERRORS&&(t.failedRequests.shift(),t.failedRequests.shift(),t.errors.shift()),t.failedRequests.push(this.apiId,this.correlationId),ws.isEmpty(e.subError)?ws.isEmpty(e.errorCode)?e&&e.toString()?t.errors.push(e.toString()):t.errors.push(Eo.UNKNOWN_ERROR):t.errors.push(e.errorCode):t.errors.push(e.subError),this.cacheManager.setServerTelemetry(this.telemetryCacheKey,t)},e.prototype.incrementCacheHits=function(){var e=this.getLastRequests();return e.cacheHits+=1,this.cacheManager.setServerTelemetry(this.telemetryCacheKey,e),e.cacheHits},e.prototype.getLastRequests=function(){var e=new Tc;return this.cacheManager.getServerTelemetry(this.telemetryCacheKey)||e},e.prototype.clearTelemetryCache=function(){var t=this.getLastRequests(),n=e.maxErrorsToSend(t);if(n===t.errors.length)this.cacheManager.removeItem(this.telemetryCacheKey);else{var r=new Tc;r.failedRequests=t.failedRequests.slice(2*n),r.errors=t.errors.slice(n),this.cacheManager.setServerTelemetry(this.telemetryCacheKey,r)}},e.maxErrorsToSend=function(e){var t,n=0,r=0,i=e.errors.length;for(t=0;t<i;t++){var o=e.failedRequests[2*t]||ao.EMPTY_STRING,a=e.failedRequests[2*t+1]||ao.EMPTY_STRING,s=e.errors[t]||ao.EMPTY_STRING;if(!((r+=o.toString().length+a.toString().length+s.length+3)<Eo.MAX_LAST_HEADER_BYTES))break;n+=1}return n},e.prototype.getRegionDiscoveryFields=function(){var e=[];return e.push(this.regionUsed||ao.EMPTY_STRING),e.push(this.regionSource||ao.EMPTY_STRING),e.push(this.regionOutcome||ao.EMPTY_STRING),e.join(",")},e.prototype.updateRegionDiscoveryMetadata=function(e){this.regionUsed=e.region_used,this.regionSource=e.region_source,this.regionOutcome=e.region_outcome},e.prototype.setCacheOutcome=function(e){this.cacheOutcome=e},e}(),bl=function(){function e(e,t,n,r,i,o,a,s,u){this.config=e,this.browserStorage=t,this.browserCrypto=n,this.networkClient=this.config.system.networkClient,this.eventHandler=i,this.navigationClient=o,this.nativeMessageHandler=s,this.correlationId=u||this.browserCrypto.createNewGuid(),this.logger=r.clone(sa,Xc,this.correlationId),this.performanceClient=a}return e.prototype.clearCacheOnLogout=function(e){return zi(this,void 0,void 0,(function(){return Vi(this,(function(t){switch(t.label){case 0:if(!e)return[3,5];gc.accountInfoIsEqual(e,this.browserStorage.getActiveAccount(),!1)&&(this.logger.verbose("Setting active account to null"),this.browserStorage.setActiveAccount(null)),t.label=1;case 1:return t.trys.push([1,3,,4]),[4,this.browserStorage.removeAccount(gc.generateAccountCacheKey(e))];case 2:return t.sent(),this.logger.verbose("Cleared cache items belonging to the account provided in the logout request."),[3,4];case 3:return t.sent(),this.logger.error("Account provided in logout request was not found. Local cache unchanged."),[3,4];case 4:return[3,9];case 5:return t.trys.push([5,8,,9]),this.logger.verbose("No account provided in logout request, clearing all cache items.",this.correlationId),[4,this.browserStorage.clear()];case 6:return t.sent(),[4,this.browserCrypto.clearKeystore()];case 7:return t.sent(),[3,9];case 8:return t.sent(),this.logger.error("Attempted to clear all MSAL cache items and failed. Local cache unchanged."),[3,9];case 9:return[2]}}))}))},e.prototype.initializeBaseRequest=function(e,t){return zi(this,void 0,void 0,(function(){var n,r,i,o;return Vi(this,(function(a){switch(a.label){case 0:return this.performanceClient.addQueueMeasurement(qi.InitializeBaseRequest,e.correlationId),this.logger.verbose("Initializing BaseAuthRequest"),n=e.authority||this.config.auth.authority,t?[4,this.validateRequestAuthority(n,t)]:[3,2];case 1:a.sent(),a.label=2;case 2:if(r=Ki(e&&e.scopes||[]),(i=Ui(Ui({},e),{correlationId:this.correlationId,authority:n,scopes:r})).authenticationScheme){if(i.authenticationScheme===xo.SSH){if(!e.sshJwk)throw dc.createMissingSshJwkError();if(!e.sshKid)throw dc.createMissingSshKidError()}this.logger.verbose('Authentication Scheme set to "'+i.authenticationScheme+'" as configured in Auth request')}else i.authenticationScheme=xo.BEARER,this.logger.verbose('Authentication Scheme wasn\'t explicitly set in request, defaulting to "Bearer" request');return this.config.cache.claimsBasedCachingEnabled&&e.claims&&!ws.isEmptyObj(e.claims)?(o=i,[4,this.browserCrypto.hashString(e.claims)]):[3,4];case 3:o.requestedClaimsHash=a.sent(),a.label=4;case 4:return[2,i]}}))}))},e.prototype.getRedirectUri=function(e){this.logger.verbose("getRedirectUri called");var t=e||this.config.auth.redirectUri||Kc.getCurrentUri();return Oc.getAbsoluteUrl(t,Kc.getCurrentUri())},e.prototype.validateRequestAuthority=function(e,t){return zi(this,void 0,void 0,(function(){return Vi(this,(function(n){switch(n.label){case 0:return[4,this.getDiscoveredAuthority(e)];case 1:if(!n.sent().isAlias(t.environment))throw dc.createAuthorityMismatchError();return[2]}}))}))},e.prototype.initializeServerTelemetryManager=function(e,t){this.logger.verbose("initializeServerTelemetryManager called");var n={clientId:this.config.auth.clientId,correlationId:this.correlationId,apiId:e,forceRefresh:t||!1,wrapperSKU:this.browserStorage.getWrapperMetadata()[0],wrapperVer:this.browserStorage.getWrapperMetadata()[1]};return new yl(n,this.browserStorage)},e.prototype.getDiscoveredAuthority=function(e){return zi(this,void 0,void 0,(function(){var t;return Vi(this,(function(n){switch(n.label){case 0:return this.logger.verbose("getDiscoveredAuthority called"),t={protocolMode:this.config.auth.protocolMode,knownAuthorities:this.config.auth.knownAuthorities,cloudDiscoveryMetadata:this.config.auth.cloudDiscoveryMetadata,authorityMetadata:this.config.auth.authorityMetadata},e?(this.logger.verbose("Creating discovered authority with request authority"),[4,ml.createDiscoveredInstance(e,this.config.system.networkClient,this.browserStorage,t,this.logger)]):[3,2];case 1:case 3:return[2,n.sent()];case 2:return this.logger.verbose("Creating discovered authority with configured authority"),[4,ml.createDiscoveredInstance(this.config.auth.authority,this.config.system.networkClient,this.browserStorage,t,this.logger)]}}))}))},e}(),wl=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Bi(t,e),t.prototype.initializeAuthorizationCodeRequest=function(e){return zi(this,void 0,void 0,(function(){var t,n;return Vi(this,(function(r){switch(r.label){case 0:return this.performanceClient.addQueueMeasurement(qi.StandardInteractionClientInitializeAuthorizationCodeRequest,e.correlationId),this.logger.verbose("initializeAuthorizationRequest called",e.correlationId),[4,this.browserCrypto.generatePkceCodes()];case 1:return t=r.sent(),n=Ui(Ui({},e),{redirectUri:e.redirectUri,code:ao.EMPTY_STRING,codeVerifier:t.verifier}),e.codeChallenge=t.challenge,e.codeChallengeMethod=ao.S256_CODE_CHALLENGE_METHOD,[2,n]}}))}))},t.prototype.initializeLogoutRequest=function(e){this.logger.verbose("initializeLogoutRequest called",null===e||void 0===e?void 0:e.correlationId);var t=Ui({correlationId:this.correlationId||this.browserCrypto.createNewGuid()},e);if(e)if(e.logoutHint)this.logger.verbose("logoutHint has already been set in logoutRequest");else if(e.account){var n=this.getLogoutHintFromIdTokenClaims(e.account);n&&(this.logger.verbose("Setting logoutHint to login_hint ID Token Claim value for the account provided"),t.logoutHint=n)}else this.logger.verbose("logoutHint was not set and account was not passed into logout request, logoutHint will not be set");else this.logger.verbose("logoutHint will not be set since no logout request was configured");return e&&null===e.postLogoutRedirectUri?this.logger.verbose("postLogoutRedirectUri passed as null, not setting post logout redirect uri",t.correlationId):e&&e.postLogoutRedirectUri?(this.logger.verbose("Setting postLogoutRedirectUri to uri set on logout request",t.correlationId),t.postLogoutRedirectUri=Oc.getAbsoluteUrl(e.postLogoutRedirectUri,Kc.getCurrentUri())):null===this.config.auth.postLogoutRedirectUri?this.logger.verbose("postLogoutRedirectUri configured as null and no uri set on request, not passing post logout redirect",t.correlationId):this.config.auth.postLogoutRedirectUri?(this.logger.verbose("Setting postLogoutRedirectUri to configured uri",t.correlationId),t.postLogoutRedirectUri=Oc.getAbsoluteUrl(this.config.auth.postLogoutRedirectUri,Kc.getCurrentUri())):(this.logger.verbose("Setting postLogoutRedirectUri to current page",t.correlationId),t.postLogoutRedirectUri=Oc.getAbsoluteUrl(Kc.getCurrentUri(),Kc.getCurrentUri())),t},t.prototype.getLogoutHintFromIdTokenClaims=function(e){var t=e.idTokenClaims;if(t){if(t.login_hint)return t.login_hint;this.logger.verbose("The ID Token Claims tied to the provided account do not contain a login_hint claim, logoutHint will not be added to logout request")}else this.logger.verbose("The provided account does not contain ID Token Claims, logoutHint will not be added to logout request");return null},t.prototype.createAuthCodeClient=function(e,t,n){return zi(this,void 0,void 0,(function(){var r;return Vi(this,(function(i){switch(i.label){case 0:return this.performanceClient.addQueueMeasurement(qi.StandardInteractionClientCreateAuthCodeClient,this.correlationId),this.performanceClient.setPreQueueTime(qi.StandardInteractionClientGetClientConfiguration,this.correlationId),[4,this.getClientConfiguration(e,t,n)];case 1:return r=i.sent(),[2,new ll(r,this.performanceClient)]}}))}))},t.prototype.getClientConfiguration=function(e,t,n){return zi(this,void 0,void 0,(function(){var r,i;return Vi(this,(function(o){switch(o.label){case 0:return this.performanceClient.addQueueMeasurement(qi.StandardInteractionClientGetClientConfiguration,this.correlationId),this.logger.verbose("getClientConfiguration called",this.correlationId),this.performanceClient.setPreQueueTime(qi.StandardInteractionClientGetDiscoveredAuthority,this.correlationId),[4,this.getDiscoveredAuthority(t,n)];case 1:return r=o.sent(),i=this.config.system.loggerOptions,[2,{authOptions:{clientId:this.config.auth.clientId,authority:r,clientCapabilities:this.config.auth.clientCapabilities},systemOptions:{tokenRenewalOffsetSeconds:this.config.system.tokenRenewalOffsetSeconds,preventCorsPreflight:!0},loggerOptions:{loggerCallback:i.loggerCallback,piiLoggingEnabled:i.piiLoggingEnabled,logLevel:i.logLevel,correlationId:this.correlationId},cacheOptions:{claimsBasedCachingEnabled:this.config.cache.claimsBasedCachingEnabled},cryptoInterface:this.browserCrypto,networkInterface:this.networkClient,storageInterface:this.browserStorage,serverTelemetryManager:e,libraryInfo:{sku:sa,version:Xc,cpu:ao.EMPTY_STRING,os:ao.EMPTY_STRING},telemetry:this.config.telemetry}]}}))}))},t.prototype.validateAndExtractStateFromHash=function(e,t,n){if(this.logger.verbose("validateAndExtractStateFromHash called",n),!e.state)throw hu.createHashDoesNotContainStateError();var r=Mc.extractBrowserRequestState(this.browserCrypto,e.state);if(!r)throw hu.createUnableToParseStateError();if(r.interactionType!==t)throw hu.createStateInteractionTypeMismatchError();return this.logger.verbose("Returning state from hash",n),e.state},t.prototype.getDiscoveredAuthority=function(e,t){var n;return zi(this,void 0,void 0,(function(){var r,i,o,a;return Vi(this,(function(s){switch(s.label){case 0:return this.performanceClient.addQueueMeasurement(qi.StandardInteractionClientGetDiscoveredAuthority,this.correlationId),this.logger.verbose("getDiscoveredAuthority called",this.correlationId),r=null===(n=this.performanceClient)||void 0===n?void 0:n.startMeasurement(qi.StandardInteractionClientGetDiscoveredAuthority,this.correlationId),i={protocolMode:this.config.auth.protocolMode,knownAuthorities:this.config.auth.knownAuthorities,cloudDiscoveryMetadata:this.config.auth.cloudDiscoveryMetadata,authorityMetadata:this.config.auth.authorityMetadata,skipAuthorityMetadataCache:this.config.auth.skipAuthorityMetadataCache},o=e||this.config.auth.authority,a=gl.generateAuthority(o,t||this.config.auth.azureCloudOptions),this.logger.verbose("Creating discovered authority with configured authority",this.correlationId),this.performanceClient.setPreQueueTime(qi.AuthorityFactoryCreateDiscoveredInstance,this.correlationId),[4,ml.createDiscoveredInstance(a,this.config.system.networkClient,this.browserStorage,i,this.logger,this.performanceClient,this.correlationId).then((function(e){return r.endMeasurement({success:!0}),e})).catch((function(e){throw r.endMeasurement({errorCode:e.errorCode,subErrorCode:e.subError,success:!1}),e}))];case 1:return[2,s.sent()]}}))}))},t.prototype.initializeAuthorizationRequest=function(e,t){return zi(this,void 0,void 0,(function(){var n,r,i,o,a,s,u;return Vi(this,(function(c){switch(c.label){case 0:return this.performanceClient.addQueueMeasurement(qi.StandardInteractionClientInitializeAuthorizationRequest,this.correlationId),this.logger.verbose("initializeAuthorizationRequest called",this.correlationId),n=this.getRedirectUri(e.redirectUri),r={interactionType:t},i=Rc.setRequestState(this.browserCrypto,e&&e.state||ao.EMPTY_STRING,r),this.performanceClient.setPreQueueTime(qi.InitializeBaseRequest,this.correlationId),a=[{}],[4,this.initializeBaseRequest(e)];case 1:return o=Ui.apply(void 0,[Ui.apply(void 0,a.concat([c.sent()])),{redirectUri:n,state:i,nonce:e.nonce||this.browserCrypto.createNewGuid(),responseMode:ho.FRAGMENT}]),(s=e.account||this.browserStorage.getActiveAccount())&&(this.logger.verbose("Setting validated request account",this.correlationId),this.logger.verbosePii("Setting validated request account: "+s.homeAccountId,this.correlationId),o.account=s),ws.isEmpty(o.loginHint)&&!s&&(u=this.browserStorage.getLegacyLoginHint())&&(o.loginHint=u),[2,o]}}))}))},t}(bl);!function(e){e.USER_INTERACTION_REQUIRED="USER_INTERACTION_REQUIRED",e.USER_CANCEL="USER_CANCEL",e.NO_NETWORK="NO_NETWORK",e.TRANSIENT_ERROR="TRANSIENT_ERROR",e.PERSISTENT_ERROR="PERSISTENT_ERROR",e.DISABLED="DISABLED",e.ACCOUNT_UNAVAILABLE="ACCOUNT_UNAVAILABLE"}(pl||(pl={}));var Sl,kl={code:"ContentError"},Cl={code:"user_switch",desc:"User attempted to switch accounts in the native broker, which is not allowed. All new accounts must sign-in through the standard web flow first, please try again."},xl={code:"tokens_not_found_in_internal_memory_cache",desc:"Tokens not cached in MSAL JS internal memory, please make the WAM request"},El=function(e){function t(n,r,i){var o=e.call(this,n,r)||this;return Object.setPrototypeOf(o,t.prototype),o.name="NativeAuthError",o.ext=i,o}return Bi(t,e),t.prototype.isFatal=function(){return!(!this.ext||!this.ext.status||this.ext.status!==pl.PERSISTENT_ERROR&&this.ext.status!==pl.DISABLED)||this.errorCode===kl.code},t.createError=function(e,n,r){if(r&&r.status)switch(r.status){case pl.ACCOUNT_UNAVAILABLE:return ta.createNativeAccountUnavailableError();case pl.USER_INTERACTION_REQUIRED:return new ta(e,n);case pl.USER_CANCEL:return hu.createUserCancelledError();case pl.NO_NETWORK:return hu.createNoNetworkConnectivityError()}return new t(e,n,r)},t.createUserSwitchError=function(){return new t(Cl.code,Cl.desc)},t.createTokensNotFoundInCacheError=function(){return new t(xl.code,xl.desc)},t}(Jo),Tl=function(e){function t(t,n){return e.call(this,t,n)||this}return Qi(t,e),t.prototype.acquireToken=function(e){var t,n,r,i,o,a,s;return Xi(this,void 0,void 0,(function(){var u,c,l,d,h,f,p=this;return $i(this,(function(v){switch(v.label){case 0:return null===(t=this.performanceClient)||void 0===t||t.addQueueMeasurement(qi.RefreshTokenClientAcquireToken,e.correlationId),u=null===(n=this.performanceClient)||void 0===n?void 0:n.startMeasurement(qi.RefreshTokenClientAcquireToken,e.correlationId),this.logger.verbose("RefreshTokenClientAcquireToken called",e.correlationId),c=kc.nowSeconds(),null===(r=this.performanceClient)||void 0===r||r.setPreQueueTime(qi.RefreshTokenClientExecuteTokenRequest,e.correlationId),[4,this.executeTokenRequest(e,this.authority)];case 1:return l=v.sent(),d=null===(i=l.headers)||void 0===i?void 0:i[to.X_MS_HTTP_VERSION],null===u||void 0===u||u.addStaticFields({refreshTokenSize:(null===(o=l.body.refresh_token)||void 0===o?void 0:o.length)||0}),d&&(null===u||void 0===u||u.addStaticFields({httpVerToken:d})),h=null===(a=l.headers)||void 0===a?void 0:a[to.X_MS_REQUEST_ID],(f=new cl(this.config.authOptions.clientId,this.cacheManager,this.cryptoUtils,this.logger,this.config.serializableCache,this.config.persistencePlugin)).validateTokenResponse(l.body),null===(s=this.performanceClient)||void 0===s||s.setPreQueueTime(qi.HandleServerTokenResponse,e.correlationId),[2,f.handleServerTokenResponse(l.body,this.authority,c,e,void 0,void 0,!0,e.forceCache,h).then((function(e){return null===u||void 0===u||u.endMeasurement({success:!0}),e})).catch((function(t){throw p.logger.verbose("Error in fetching refresh token",e.correlationId),null===u||void 0===u||u.endMeasurement({errorCode:t.errorCode,subErrorCode:t.subError,success:!1}),t}))]}}))}))},t.prototype.acquireTokenByRefreshToken=function(e){var t,n,r,i;return Xi(this,void 0,void 0,(function(){var o,a;return $i(this,(function(s){if(!e)throw dc.createEmptyTokenRequestError();if(null===(t=this.performanceClient)||void 0===t||t.addQueueMeasurement(qi.RefreshTokenClientAcquireTokenByRefreshToken,e.correlationId),!e.account)throw bs.createNoAccountInSilentRequestError();if(this.cacheManager.isAppMetadataFOCI(e.account.environment))try{return null===(n=this.performanceClient)||void 0===n||n.setPreQueueTime(qi.RefreshTokenClientAcquireTokenWithCachedRefreshToken,e.correlationId),[2,this.acquireTokenWithCachedRefreshToken(e,!0)]}catch(Oi){if(o=Oi instanceof ta&&Oi.errorCode===$o.code,a=Oi instanceof Qo&&Oi.errorCode===Zo&&Oi.subError===Do,o||a)return null===(r=this.performanceClient)||void 0===r||r.setPreQueueTime(qi.RefreshTokenClientAcquireTokenWithCachedRefreshToken,e.correlationId),[2,this.acquireTokenWithCachedRefreshToken(e,!1)];throw Oi}return null===(i=this.performanceClient)||void 0===i||i.setPreQueueTime(qi.RefreshTokenClientAcquireTokenWithCachedRefreshToken,e.correlationId),[2,this.acquireTokenWithCachedRefreshToken(e,!1)]}))}))},t.prototype.acquireTokenWithCachedRefreshToken=function(e,t){var n,r,i;return Xi(this,void 0,void 0,(function(){var o,a,s;return $i(this,(function(u){if(null===(n=this.performanceClient)||void 0===n||n.addQueueMeasurement(qi.RefreshTokenClientAcquireTokenWithCachedRefreshToken,e.correlationId),o=null===(r=this.performanceClient)||void 0===r?void 0:r.startMeasurement(qi.RefreshTokenClientAcquireTokenWithCachedRefreshToken,e.correlationId),this.logger.verbose("RefreshTokenClientAcquireTokenWithCachedRefreshToken called",e.correlationId),!(a=this.cacheManager.getRefreshToken(e.account,t)))throw null===o||void 0===o||o.discardMeasurement(),ta.createNoTokensFoundError();return null===o||void 0===o||o.endMeasurement({success:!0}),s=Yi(Yi({},e),{refreshToken:a.secret,authenticationScheme:e.authenticationScheme||xo.BEARER,ccsCredential:{credential:e.account.homeAccountId,type:vc.HOME_ACCOUNT_ID}}),null===(i=this.performanceClient)||void 0===i||i.setPreQueueTime(qi.RefreshTokenClientAcquireToken,e.correlationId),[2,this.acquireToken(s)]}))}))},t.prototype.executeTokenRequest=function(e,t){var n,r,i;return Xi(this,void 0,void 0,(function(){var o,a,s,u,c,l;return $i(this,(function(d){switch(d.label){case 0:return null===(n=this.performanceClient)||void 0===n||n.addQueueMeasurement(qi.RefreshTokenClientExecuteTokenRequest,e.correlationId),o=null===(r=this.performanceClient)||void 0===r?void 0:r.startMeasurement(qi.RefreshTokenClientExecuteTokenRequest,e.correlationId),null===(i=this.performanceClient)||void 0===i||i.setPreQueueTime(qi.RefreshTokenClientCreateTokenRequestBody,e.correlationId),a=this.createTokenQueryParameters(e),s=Oc.appendQueryString(t.tokenEndpoint,a),[4,this.createTokenRequestBody(e)];case 1:return u=d.sent(),c=this.createTokenRequestHeaders(e.ccsCredential),l={clientId:this.config.authOptions.clientId,authority:t.canonicalAuthority,scopes:e.scopes,claims:e.claims,authenticationScheme:e.authenticationScheme,resourceRequestMethod:e.resourceRequestMethod,resourceRequestUri:e.resourceRequestUri,shrClaims:e.shrClaims,sshKid:e.sshKid},[2,this.executePostToTokenEndpoint(s,u,c,l).then((function(e){return null===o||void 0===o||o.endMeasurement({success:!0}),e})).catch((function(e){throw null===o||void 0===o||o.endMeasurement({success:!1}),e}))]}}))}))},t.prototype.createTokenRequestBody=function(e){var t,n,r;return Xi(this,void 0,void 0,(function(){var i,o,a,s,u,c,l;return $i(this,(function(d){switch(d.label){case 0:return null===(t=this.performanceClient)||void 0===t||t.addQueueMeasurement(qi.RefreshTokenClientCreateTokenRequestBody,e.correlationId),i=e.correlationId,o=null===(n=this.performanceClient)||void 0===n?void 0:n.startMeasurement(qi.BaseClientCreateTokenRequestHeaders,i),(a=new il).addClientId(this.config.authOptions.clientId),a.addScopes(e.scopes),a.addGrantType(fo.REFRESH_TOKEN_GRANT),a.addClientInfo(),a.addLibraryInfo(this.config.libraryInfo),a.addApplicationTelemetry(this.config.telemetry.application),a.addThrottling(),this.serverTelemetryManager&&a.addServerTelemetry(this.serverTelemetryManager),a.addCorrelationId(i),a.addRefreshToken(e.refreshToken),this.config.clientCredentials.clientSecret&&a.addClientSecret(this.config.clientCredentials.clientSecret),this.config.clientCredentials.clientAssertion&&(s=this.config.clientCredentials.clientAssertion,a.addClientAssertion(s.assertion),a.addClientAssertionType(s.assertionType)),e.authenticationScheme!==xo.POP?[3,2]:(u=new sl(this.cryptoUtils,this.performanceClient),null===(r=this.performanceClient)||void 0===r||r.setPreQueueTime(qi.PopTokenGenerateCnf,e.correlationId),[4,u.generateCnf(e)]);case 1:return c=d.sent(),a.addPopToken(c.reqCnfString),[3,3];case 2:if(e.authenticationScheme===xo.SSH){if(!e.sshJwk)throw null===o||void 0===o||o.endMeasurement({success:!1}),dc.createMissingSshJwkError();a.addSshJwk(e.sshJwk)}d.label=3;case 3:if((!ws.isEmptyObj(e.claims)||this.config.authOptions.clientCapabilities&&this.config.authOptions.clientCapabilities.length>0)&&a.addClaims(e.claims,this.config.authOptions.clientCapabilities),this.config.systemOptions.preventCorsPreflight&&e.ccsCredential)switch(e.ccsCredential.type){case vc.HOME_ACCOUNT_ID:try{l=pc(e.ccsCredential.credential),a.addCcsOid(l)}catch(Oi){this.logger.verbose("Could not parse home account ID for CCS Header: "+Oi)}break;case vc.UPN:a.addCcsUpn(e.ccsCredential.credential)}return null===o||void 0===o||o.endMeasurement({success:!0}),[2,a.createQueryString()]}}))}))},t}(ol),Il=function(e){function t(t,n){return e.call(this,t,n)||this}return Qi(t,e),t.prototype.acquireToken=function(e){return Xi(this,void 0,void 0,(function(){var t;return $i(this,(function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),[4,this.acquireCachedToken(e)];case 1:return[2,n.sent()];case 2:if((t=n.sent())instanceof bs&&t.errorCode===ls.code)return[2,new Tl(this.config,this.performanceClient).acquireTokenByRefreshToken(e)];throw t;case 3:return[2]}}))}))},t.prototype.acquireCachedToken=function(e){var t,n,r,i,o;return Xi(this,void 0,void 0,(function(){var a,s;return $i(this,(function(u){switch(u.label){case 0:if(!e)throw dc.createEmptyTokenRequestError();if(e.forceRefresh)throw null===(t=this.serverTelemetryManager)||void 0===t||t.setCacheOutcome(_o.FORCE_REFRESH),this.logger.info("SilentFlowClient:acquireCachedToken - Skipping cache because forceRefresh is true."),bs.createRefreshRequiredError();if(!this.config.cacheOptions.claimsBasedCachingEnabled&&!ws.isEmptyObj(e.claims))throw null===(n=this.serverTelemetryManager)||void 0===n||n.setCacheOutcome(_o.CLAIMS_REQUESTED_CACHE_SKIPPED),this.logger.info("SilentFlowClient:acquireCachedToken - Skipping cache because claims-based caching is disabled and claims were requested."),bs.createRefreshRequiredError();if(!e.account)throw bs.createNoAccountInSilentRequestError();if(a=e.authority||this.authority.getPreferredCache(),!(s=this.cacheManager.readCacheRecord(e.account,e,a)).accessToken)throw null===(r=this.serverTelemetryManager)||void 0===r||r.setCacheOutcome(_o.NO_CACHED_ACCESS_TOKEN),this.logger.info("SilentFlowClient:acquireCachedToken - No access token found in cache for the given properties."),bs.createRefreshRequiredError();if(kc.wasClockTurnedBack(s.accessToken.cachedAt)||kc.isTokenExpired(s.accessToken.expiresOn,this.config.systemOptions.tokenRenewalOffsetSeconds))throw null===(i=this.serverTelemetryManager)||void 0===i||i.setCacheOutcome(_o.CACHED_ACCESS_TOKEN_EXPIRED),this.logger.info("SilentFlowClient:acquireCachedToken - Cached access token is expired or will expire within "+this.config.systemOptions.tokenRenewalOffsetSeconds+" seconds."),bs.createRefreshRequiredError();if(s.accessToken.refreshOn&&kc.isTokenExpired(s.accessToken.refreshOn,0))throw null===(o=this.serverTelemetryManager)||void 0===o||o.setCacheOutcome(_o.REFRESH_CACHED_ACCESS_TOKEN),this.logger.info("SilentFlowClient:acquireCachedToken - Cached access token's refreshOn property has been exceeded'."),bs.createRefreshRequiredError();return this.config.serverTelemetryManager&&this.config.serverTelemetryManager.incrementCacheHits(),[4,this.generateResultFromCacheRecord(s,e)];case 1:return[2,u.sent()]}}))}))},t.prototype.generateResultFromCacheRecord=function(e,t){return Xi(this,void 0,void 0,(function(){var n,r;return $i(this,(function(i){switch(i.label){case 0:if(e.idToken&&(n=new mc(e.idToken.secret,this.config.cryptoInterface)),t.maxAge||0===t.maxAge){if(!(r=null===n||void 0===n?void 0:n.claims.auth_time))throw bs.createAuthTimeNotFoundError();mc.checkMaxAge(r,t.maxAge)}return[4,cl.generateAuthenticationResult(this.cryptoUtils,this.authority,e,!0,t,n)];case 1:return[2,i.sent()]}}))}))},t}(ol),Al=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Bi(t,e),t.prototype.acquireToken=function(e){return zi(this,void 0,void 0,(function(){var t,n,r,i,o;return Vi(this,(function(a){switch(a.label){case 0:return t=this.performanceClient.startMeasurement(qi.SilentCacheClientAcquireToken,e.correlationId),n=this.initializeServerTelemetryManager(zo.acquireTokenSilent_silentFlow),[4,this.createSilentFlowClient(n,e.authority,e.azureCloudOptions)];case 1:r=a.sent(),this.logger.verbose("Silent auth client created"),a.label=2;case 2:return a.trys.push([2,4,,5]),[4,r.acquireCachedToken(e)];case 3:return i=a.sent(),t.endMeasurement({success:!0,fromCache:!0}),[2,i];case 4:throw(o=a.sent())instanceof hu&&o.errorCode===tu.code&&this.logger.verbose("Signing keypair for bound access token not found. Refreshing bound access token and generating a new crypto keypair."),t.endMeasurement({errorCode:o instanceof Jo&&o.errorCode||void 0,subErrorCode:o instanceof Jo&&o.subError||void 0,success:!1}),o;case 5:return[2]}}))}))},t.prototype.logout=function(){return Promise.reject(hu.createSilentLogoutUnsupportedError())},t.prototype.createSilentFlowClient=function(e,t,n){return zi(this,void 0,void 0,(function(){var r;return Vi(this,(function(i){switch(i.label){case 0:return this.performanceClient.setPreQueueTime(qi.StandardInteractionClientGetClientConfiguration,this.correlationId),[4,this.getClientConfiguration(e,t,n)];case 1:return r=i.sent(),[2,new Il(r,this.performanceClient)]}}))}))},t.prototype.initializeSilentRequest=function(e,t){return zi(this,void 0,void 0,(function(){var n;return Vi(this,(function(r){switch(r.label){case 0:return this.performanceClient.addQueueMeasurement(qi.InitializeSilentRequest,this.correlationId),this.performanceClient.setPreQueueTime(qi.InitializeBaseRequest,this.correlationId),n=[Ui({},e)],[4,this.initializeBaseRequest(e,t)];case 1:return[2,Ui.apply(void 0,[Ui.apply(void 0,n.concat([r.sent()])),{account:t,forceRefresh:e.forceRefresh||!1}])]}}))}))},t}(wl),Rl=function(e){function t(t,n,r,i,o,a,s,u,c,l,d,h){var f=e.call(this,t,n,r,i,o,a,u,c,h)||this;return f.apiId=s,f.accountId=l,f.nativeMessageHandler=c,f.nativeStorageManager=d,f.silentCacheClient=new Al(t,f.nativeStorageManager,r,i,o,a,u,c,h),f}return Bi(t,e),t.prototype.acquireToken=function(e){return zi(this,void 0,void 0,(function(){var t,n,r,i,o,a,s;return Vi(this,(function(u){switch(u.label){case 0:return this.logger.trace("NativeInteractionClient - acquireToken called."),t=this.performanceClient.startMeasurement(qi.NativeInteractionClientAcquireToken,e.correlationId),n=kc.nowSeconds(),[4,this.initializeNativeRequest(e)];case 1:r=u.sent(),u.label=2;case 2:return u.trys.push([2,4,,5]),[4,this.acquireTokensFromCache(this.accountId,r)];case 3:return i=u.sent(),t.endMeasurement({success:!0,isNativeBroker:!1,fromCache:!0}),[2,i];case 4:return u.sent(),this.logger.info("MSAL internal Cache does not contain tokens, proceed to make a native call"),[3,5];case 5:return o={method:Lo.GetToken,request:r},[4,this.nativeMessageHandler.sendMessage(o)];case 6:return a=u.sent(),s=this.validateNativeResponse(a),[2,this.handleNativeResponse(s,r,n).then((function(e){return t.endMeasurement({success:!0,isNativeBroker:!0,requestId:e.requestId}),e})).catch((function(e){throw t.endMeasurement({success:!1,errorCode:e.errorCode,subErrorCode:e.subError,isNativeBroker:!0}),e}))]}}))}))},t.prototype.createSilentCacheRequest=function(e,t){return{authority:e.authority,correlationId:this.correlationId,scopes:hc.fromString(e.scope).asArray(),account:t,forceRefresh:!1}},t.prototype.acquireTokensFromCache=function(e,t){return zi(this,void 0,void 0,(function(){var n,r;return Vi(this,(function(i){switch(i.label){case 0:if(!e)throw this.logger.warning("NativeInteractionClient:acquireTokensFromCache - No nativeAccountId provided"),bs.createNoAccountFoundError();if(!(n=this.browserStorage.getAccountInfoFilteredBy({nativeAccountId:e})))throw bs.createNoAccountFoundError();i.label=1;case 1:return i.trys.push([1,3,,4]),r=this.createSilentCacheRequest(t,n),[4,this.silentCacheClient.acquireToken(r)];case 2:return[2,i.sent()];case 3:throw i.sent();case 4:return[2]}}))}))},t.prototype.acquireTokenRedirect=function(e){return zi(this,void 0,void 0,(function(){var t,n,r,i,o,a;return Vi(this,(function(s){switch(s.label){case 0:return this.logger.trace("NativeInteractionClient - acquireTokenRedirect called."),[4,this.initializeNativeRequest(e)];case 1:t=s.sent(),n={method:Lo.GetToken,request:t},s.label=2;case 2:return s.trys.push([2,4,,5]),[4,this.nativeMessageHandler.sendMessage(n)];case 3:return r=s.sent(),this.validateNativeResponse(r),[3,5];case 4:if((i=s.sent())instanceof El&&i.isFatal())throw i;return[3,5];case 5:return this.browserStorage.setTemporaryCache(jo.NATIVE_REQUEST,JSON.stringify(t),!0),o={apiId:zo.acquireTokenRedirect,timeout:this.config.system.redirectNavigationTimeout,noHistory:!1},a=this.config.auth.navigateToLoginRequestUrl?window.location.href:this.getRedirectUri(e.redirectUri),[4,this.navigationClient.navigateExternal(a,o)];case 6:return s.sent(),[2]}}))}))},t.prototype.handleRedirectPromise=function(){return zi(this,void 0,void 0,(function(){var e,t,n,r,i,o,a,s;return Vi(this,(function(u){switch(u.label){case 0:if(this.logger.trace("NativeInteractionClient - handleRedirectPromise called."),!this.browserStorage.isInteractionInProgress(!0))return this.logger.info("handleRedirectPromise called but there is no interaction in progress, returning null."),[2,null];if(!(e=this.browserStorage.getCachedNativeRequest()))return this.logger.verbose("NativeInteractionClient - handleRedirectPromise called but there is no cached request, returning null."),[2,null];t=e.prompt,n=Hi(e,["prompt"]),t&&this.logger.verbose("NativeInteractionClient - handleRedirectPromise called and prompt was included in the original request, removing prompt from cached request to prevent second interaction with native broker window."),this.browserStorage.removeItem(this.browserStorage.generateCacheKey(jo.NATIVE_REQUEST)),r={method:Lo.GetToken,request:n},i=kc.nowSeconds(),u.label=1;case 1:return u.trys.push([1,3,,4]),this.logger.verbose("NativeInteractionClient - handleRedirectPromise sending message to native broker."),[4,this.nativeMessageHandler.sendMessage(r)];case 2:return o=u.sent(),this.validateNativeResponse(o),a=this.handleNativeResponse(o,n,i),this.browserStorage.setInteractionInProgress(!1),[2,a];case 3:throw s=u.sent(),this.browserStorage.setInteractionInProgress(!1),s;case 4:return[2]}}))}))},t.prototype.logout=function(){return this.logger.trace("NativeInteractionClient - logout called."),Promise.reject("Logout not implemented yet")},t.prototype.handleNativeResponse=function(e,t,n){return zi(this,void 0,void 0,(function(){var r,i,o,a,s,u;return Vi(this,(function(c){switch(c.label){case 0:if(this.logger.trace("NativeInteractionClient - handleNativeResponse called."),e.account.id!==t.accountId)throw El.createUserSwitchError();return[4,this.getDiscoveredAuthority(t.authority)];case 1:return r=c.sent(),i=r.getPreferredCache(),o=this.createIdTokenObj(e),a=this.createHomeAccountIdentifier(e,o),s=this.createAccountEntity(e,a,o,i),[4,this.generateAuthenticationResult(e,t,o,s,r.canonicalAuthority,n)];case 2:return u=c.sent(),this.cacheAccount(s),this.cacheNativeTokens(e,t,a,s,o,u.accessToken,u.tenantId,n),[2,u]}}))}))},t.prototype.createIdTokenObj=function(e){return new mc(e.id_token||ao.EMPTY_STRING,this.browserCrypto)},t.prototype.createHomeAccountIdentifier=function(e,t){return gc.generateHomeAccountId(e.client_info||ao.EMPTY_STRING,Mu.Default,this.logger,this.browserCrypto,t)},t.prototype.createAccountEntity=function(e,t,n,r){return gc.createAccount(e.client_info,t,n,void 0,void 0,void 0,r,e.account.id)},t.prototype.generateScopes=function(e,t){return e.scope?hc.fromString(e.scope):hc.fromString(t.scope)},t.prototype.generatePopAccessToken=function(e,t){return zi(this,void 0,void 0,(function(){var n,r;return Vi(this,(function(i){switch(i.label){case 0:if(t.tokenType!==xo.POP)return[3,2];if(e.shr)return this.logger.trace("handleNativeServerResponse: SHR is enabled in native layer"),[2,e.shr];if(n=new sl(this.browserCrypto),r={resourceRequestMethod:t.resourceRequestMethod,resourceRequestUri:t.resourceRequestUri,shrClaims:t.shrClaims,shrNonce:t.shrNonce},!t.keyId)throw bs.createKeyIdMissingError();return[4,n.signPopToken(e.access_token,t.keyId,r)];case 1:return[2,i.sent()];case 2:return[2,e.access_token]}}))}))},t.prototype.generateAuthenticationResult=function(e,t,n,r,i,o){return zi(this,void 0,void 0,(function(){var a,s,u,c,l,d,h;return Vi(this,(function(f){switch(f.label){case 0:return a=this.addTelemetryFromNativeResponse(e),s=e.scope?hc.fromString(e.scope):hc.fromString(t.scope),u=e.account.properties||{},c=u.UID||n.claims.oid||n.claims.sub||ao.EMPTY_STRING,l=u.TenantId||n.claims.tid||ao.EMPTY_STRING,[4,this.generatePopAccessToken(e,t)];case 1:return d=f.sent(),h=t.tokenType===xo.POP?xo.POP:xo.BEARER,[2,{authority:i,uniqueId:c,tenantId:l,scopes:s.asArray(),account:r.getAccountInfo(),idToken:e.id_token,idTokenClaims:n.claims,accessToken:d,fromCache:!!a&&this.isResponseFromCache(a),expiresOn:new Date(1e3*Number(o+e.expires_in)),tokenType:h,correlationId:this.correlationId,state:e.state,fromNativeBroker:!0}]}}))}))},t.prototype.cacheAccount=function(e){var t=this;this.browserStorage.setAccount(e),this.browserStorage.removeAccountContext(e).catch((function(e){t.logger.error("Error occurred while removing account context from browser storage. "+e)}))},t.prototype.cacheNativeTokens=function(e,t,n,r,i,o,a,s){var u=ju.createIdTokenEntity(n,t.authority,e.id_token||ao.EMPTY_STRING,t.clientId,i.claims.tid||ao.EMPTY_STRING),c=s+(t.tokenType===xo.POP?ao.SHR_NONCE_VALIDITY:("string"===typeof e.expires_in?parseInt(e.expires_in,10):e.expires_in)||0),l=this.generateScopes(e,t),d=Cc.createAccessTokenEntity(n,t.authority,o,t.clientId,i?i.claims.tid||ao.EMPTY_STRING:a,l.printScopes(),c,0,this.browserCrypto),h=new al(r,u,d);this.nativeStorageManager.saveCacheRecord(h)},t.prototype.addTelemetryFromNativeResponse=function(e){var t=this.getMATSFromResponse(e);return t?(this.performanceClient.addStaticFields({extensionId:this.nativeMessageHandler.getExtensionId(),extensionVersion:this.nativeMessageHandler.getExtensionVersion(),matsBrokerVersion:t.broker_version,matsAccountJoinOnStart:t.account_join_on_start,matsAccountJoinOnEnd:t.account_join_on_end,matsDeviceJoin:t.device_join,matsPromptBehavior:t.prompt_behavior,matsApiErrorCode:t.api_error_code,matsUiVisible:t.ui_visible,matsSilentCode:t.silent_code,matsSilentBiSubCode:t.silent_bi_sub_code,matsSilentMessage:t.silent_message,matsSilentStatus:t.silent_status,matsHttpStatus:t.http_status,matsHttpEventCount:t.http_event_count},this.correlationId),t):null},t.prototype.validateNativeResponse=function(e){if(e.hasOwnProperty("access_token")&&e.hasOwnProperty("id_token")&&e.hasOwnProperty("client_info")&&e.hasOwnProperty("account")&&e.hasOwnProperty("scope")&&e.hasOwnProperty("expires_in"))return e;throw El.createUnexpectedError("Response missing expected properties.")},t.prototype.getMATSFromResponse=function(e){if(e.properties.MATS)try{return JSON.parse(e.properties.MATS)}catch(Oi){this.logger.error("NativeInteractionClient - Error parsing MATS telemetry, returning null instead")}return null},t.prototype.isResponseFromCache=function(e){return"undefined"===typeof e.is_cached?(this.logger.verbose("NativeInteractionClient - MATS telemetry does not contain field indicating if response was served from cache. Returning false."),!1):!!e.is_cached},t.prototype.initializeNativeRequest=function(e){return zi(this,void 0,void 0,(function(){var t,n,r,i,o,a,s,u,c,l=this;return Vi(this,(function(d){switch(d.label){case 0:return this.logger.trace("NativeInteractionClient - initializeNativeRequest called"),t=e.authority||this.config.auth.authority,e.account?[4,this.validateRequestAuthority(t,e.account)]:[3,2];case 1:d.sent(),d.label=2;case 2:return(n=new Oc(t)).validateAsUri(),r=e.scopes,i=Hi(e,["scopes"]),(o=new hc(r||[])).appendScopes(so),a=function(){switch(l.apiId){case zo.ssoSilent:case zo.acquireTokenSilent_silentFlow:return l.logger.trace("initializeNativeRequest: silent request sets prompt to none"),lo.NONE}if(e.prompt)switch(e.prompt){case lo.NONE:case lo.CONSENT:case lo.LOGIN:return l.logger.trace("initializeNativeRequest: prompt is compatible with native flow"),e.prompt;default:throw l.logger.trace("initializeNativeRequest: prompt = "+e.prompt+" is not compatible with native flow"),hu.createNativePromptParameterNotSupportedError()}else l.logger.trace("initializeNativeRequest: prompt was not provided")},s=Ui(Ui({},i),{accountId:this.accountId,clientId:this.config.auth.clientId,authority:n.urlString,scope:o.printScopes(),redirectUri:this.getRedirectUri(e.redirectUri),prompt:a(),correlationId:this.correlationId,tokenType:e.authenticationScheme,windowTitleSubstring:document.title,extraParameters:Ui(Ui(Ui({},e.extraQueryParameters),e.tokenQueryParameters),{telemetry:la}),extendedExpiryToken:!1}),e.authenticationScheme!==xo.POP?[3,4]:(u={resourceRequestUri:e.resourceRequestUri,resourceRequestMethod:e.resourceRequestMethod,shrClaims:e.shrClaims,shrNonce:e.shrNonce},[4,new sl(this.browserCrypto).generateCnf(u)]);case 3:c=d.sent(),s.reqCnf=c.reqCnfString,s.keyId=c.kid,d.label=4;case 4:return[2,s]}}))}))},t}(bl),_l=function(){function e(e,t,n,r){this.logger=e,this.handshakeTimeoutMs=t,this.extensionId=r,this.resolvers=new Map,this.handshakeResolvers=new Map,this.responseId=0,this.messageChannel=new MessageChannel,this.windowListener=this.onWindowMessage.bind(this),this.performanceClient=n,this.handshakeEvent=n.startMeasurement(qi.NativeMessageHandlerHandshake)}return e.prototype.sendMessage=function(e){return zi(this,void 0,void 0,(function(){var t,n=this;return Vi(this,(function(r){return this.logger.trace("NativeMessageHandler - sendMessage called."),t={channel:ua,extensionId:this.extensionId,responseId:this.responseId++,body:e},this.logger.trace("NativeMessageHandler - Sending request to browser extension"),this.logger.tracePii("NativeMessageHandler - Sending request to browser extension: "+JSON.stringify(t)),this.messageChannel.port1.postMessage(t),[2,new Promise((function(e,r){n.resolvers.set(t.responseId,{resolve:e,reject:r})}))]}))}))},e.createProvider=function(t,n,r){return zi(this,void 0,void 0,(function(){var i,o;return Vi(this,(function(a){switch(a.label){case 0:t.trace("NativeMessageHandler - createProvider called."),a.label=1;case 1:return a.trys.push([1,3,,5]),[4,(i=new e(t,n,r,ca)).sendHandshakeRequest()];case 2:return a.sent(),[2,i];case 3:return a.sent(),[4,(o=new e(t,n,r)).sendHandshakeRequest()];case 4:return a.sent(),[2,o];case 5:return[2]}}))}))},e.prototype.sendHandshakeRequest=function(){return zi(this,void 0,void 0,(function(){var e,t=this;return Vi(this,(function(n){return this.logger.trace("NativeMessageHandler - sendHandshakeRequest called."),window.addEventListener("message",this.windowListener,!1),e={channel:ua,extensionId:this.extensionId,responseId:this.responseId++,body:{method:Lo.HandshakeRequest}},this.handshakeEvent.addStaticFields({extensionId:this.extensionId,extensionHandshakeTimeoutMs:this.handshakeTimeoutMs}),this.messageChannel.port1.onmessage=function(e){t.onChannelMessage(e)},window.postMessage(e,window.origin,[this.messageChannel.port2]),[2,new Promise((function(n,r){t.handshakeResolvers.set(e.responseId,{resolve:n,reject:r}),t.timeoutId=window.setTimeout((function(){window.removeEventListener("message",t.windowListener,!1),t.messageChannel.port1.close(),t.messageChannel.port2.close(),t.handshakeEvent.endMeasurement({extensionHandshakeTimedOut:!0,success:!1}),r(hu.createNativeHandshakeTimeoutError()),t.handshakeResolvers.delete(e.responseId)}),t.handshakeTimeoutMs)}))]}))}))},e.prototype.onWindowMessage=function(e){if(this.logger.trace("NativeMessageHandler - onWindowMessage called"),e.source===window){var t=e.data;if(t.channel&&t.channel===ua&&(!t.extensionId||t.extensionId===this.extensionId)&&t.body.method===Lo.HandshakeRequest){this.logger.verbose(t.extensionId?"Extension with id: "+t.extensionId+" not installed":"No extension installed"),clearTimeout(this.timeoutId),this.messageChannel.port1.close(),this.messageChannel.port2.close(),window.removeEventListener("message",this.windowListener,!1);var n=this.handshakeResolvers.get(t.responseId);n&&(this.handshakeEvent.endMeasurement({success:!1,extensionInstalled:!1}),n.reject(hu.createNativeExtensionNotInstalledError()))}}},e.prototype.onChannelMessage=function(e){this.logger.trace("NativeMessageHandler - onChannelMessage called.");var t=e.data,n=this.resolvers.get(t.responseId),r=this.handshakeResolvers.get(t.responseId);try{var i=t.body.method;if(i===Lo.Response){if(!n)return;var o=t.body.response;if(this.logger.trace("NativeMessageHandler - Received response from browser extension"),this.logger.tracePii("NativeMessageHandler - Received response from browser extension: "+JSON.stringify(o)),"Success"!==o.status)n.reject(El.createError(o.code,o.description,o.ext));else{if(!o.result)throw Jo.createUnexpectedError("Event does not contain result.");o.result.code&&o.result.description?n.reject(El.createError(o.result.code,o.result.description,o.result.ext)):n.resolve(o.result)}this.resolvers.delete(t.responseId)}else if(i===Lo.HandshakeResponse){if(!r)return;clearTimeout(this.timeoutId),window.removeEventListener("message",this.windowListener,!1),this.extensionId=t.extensionId,this.extensionVersion=t.body.version,this.logger.verbose("NativeMessageHandler - Received HandshakeResponse from extension: "+this.extensionId),this.handshakeEvent.endMeasurement({extensionInstalled:!0,success:!0}),r.resolve(),this.handshakeResolvers.delete(t.responseId)}}catch(a){this.logger.error("Error parsing response from WAM Extension"),this.logger.errorPii("Error parsing response from WAM Extension: "+a.toString()),this.logger.errorPii("Unable to parse "+e),n?n.reject(a):r&&r.reject(a)}},e.prototype.getExtensionId=function(){return this.extensionId},e.prototype.getExtensionVersion=function(){return this.extensionVersion},e.isNativeAvailable=function(e,t,n,r){if(t.trace("isNativeAvailable called"),!e.system.allowNativeBroker)return t.trace("isNativeAvailable: allowNativeBroker is not enabled, returning false"),!1;if(!n)return t.trace("isNativeAvailable: WAM extension provider is not initialized, returning false"),!1;if(r)switch(r){case xo.BEARER:case xo.POP:return t.trace("isNativeAvailable: authenticationScheme is supported, returning true"),!0;default:return t.trace("isNativeAvailable: authenticationScheme is not supported, returning false"),!1}return!0},e}(),Pl=function(){function e(e,t,n,r,i){this.authModule=e,this.browserStorage=t,this.authCodeRequest=n,this.logger=r,this.performanceClient=i}return e.prototype.handleCodeResponseFromHash=function(e,t,n,r){return zi(this,void 0,void 0,(function(){var i,o,a;return Vi(this,(function(s){if(this.performanceClient.addQueueMeasurement(qi.HandleCodeResponseFromHash,this.authCodeRequest.correlationId),this.logger.verbose("InteractionHandler.handleCodeResponse called"),ws.isEmpty(e))throw hu.createEmptyHashError(e);if(i=this.browserStorage.generateStateKey(t),!(o=this.browserStorage.getTemporaryCache(i)))throw bs.createStateNotFoundError("Cached State");try{a=this.authModule.handleFragmentResponse(e,o)}catch(Oi){throw Oi instanceof Qo&&Oi.subError===Os.code?hu.createUserCancelledError():Oi}return this.performanceClient.setPreQueueTime(qi.HandleCodeResponseFromServer,this.authCodeRequest.correlationId),[2,this.handleCodeResponseFromServer(a,t,n,r)]}))}))},e.prototype.handleCodeResponseFromServer=function(e,t,n,r,i){return void 0===i&&(i=!0),zi(this,void 0,void 0,(function(){var o,a,s,u,c,l;return Vi(this,(function(d){switch(d.label){case 0:if(this.performanceClient.addQueueMeasurement(qi.HandleCodeResponseFromServer,this.authCodeRequest.correlationId),this.logger.trace("InteractionHandler.handleCodeResponseFromServer called"),o=this.browserStorage.generateStateKey(t),!(a=this.browserStorage.getTemporaryCache(o)))throw bs.createStateNotFoundError("Cached State");return s=this.browserStorage.generateNonceKey(a),u=this.browserStorage.getTemporaryCache(s),this.authCodeRequest.code=e.code,e.cloud_instance_host_name?(this.performanceClient.setPreQueueTime(qi.UpdateTokenEndpointAuthority,this.authCodeRequest.correlationId),[4,this.updateTokenEndpointAuthority(e.cloud_instance_host_name,n,r)]):[3,2];case 1:d.sent(),d.label=2;case 2:return i&&(e.nonce=u||void 0),e.state=a,e.client_info?this.authCodeRequest.clientInfo=e.client_info:(c=this.checkCcsCredentials())&&(this.authCodeRequest.ccsCredential=c),this.performanceClient.setPreQueueTime(qi.AuthClientAcquireToken,this.authCodeRequest.correlationId),[4,this.authModule.acquireToken(this.authCodeRequest,e)];case 3:return l=d.sent(),this.browserStorage.cleanRequestByState(t),[2,l]}}))}))},e.prototype.updateTokenEndpointAuthority=function(e,t,n){return zi(this,void 0,void 0,(function(){var r,i;return Vi(this,(function(o){switch(o.label){case 0:return this.performanceClient.addQueueMeasurement(qi.UpdateTokenEndpointAuthority,this.authCodeRequest.correlationId),r="https://"+e+"/"+t.tenant+"/",[4,ml.createDiscoveredInstance(r,n,this.browserStorage,t.options,this.logger,this.performanceClient,this.authCodeRequest.correlationId)];case 1:return i=o.sent(),this.authModule.updateAuthority(i),[2]}}))}))},e.prototype.checkCcsCredentials=function(){var e=this.browserStorage.getTemporaryCache(jo.CCS_CREDENTIAL,!0);if(e)try{return JSON.parse(e)}catch(Oi){this.authModule.logger.error("Cache credential could not be parsed"),this.authModule.logger.errorPii("Cache credential could not be parsed: "+e)}return null},e}(),Nl=function(e){function t(t,n,r,i,o,a,s,u,c,l){var d=e.call(this,t,n,r,i,o,a,s,c,l)||this;return d.unloadWindow=d.unloadWindow.bind(d),d.nativeStorage=u,d}return Bi(t,e),t.prototype.acquireToken=function(e){try{var t=this.generatePopupName(e.scopes||so,e.authority||this.config.auth.authority),n=e.popupWindowAttributes||{};if(this.config.system.asyncPopups)return this.logger.verbose("asyncPopups set to true, acquiring token"),this.acquireTokenPopupAsync(e,t,n);this.logger.verbose("asyncPopup set to false, opening popup before acquiring token");var r=this.openSizedPopup("about:blank",t,n);return this.acquireTokenPopupAsync(e,t,n,r)}catch(Oi){return Promise.reject(Oi)}},t.prototype.logout=function(e){try{this.logger.verbose("logoutPopup called");var t=this.initializeLogoutRequest(e),n=this.generateLogoutPopupName(t),r=e&&e.authority,i=e&&e.mainWindowRedirectUri,o=(null===e||void 0===e?void 0:e.popupWindowAttributes)||{};if(this.config.system.asyncPopups)return this.logger.verbose("asyncPopups set to true"),this.logoutPopupAsync(t,n,o,r,void 0,i);this.logger.verbose("asyncPopup set to false, opening popup");var a=this.openSizedPopup("about:blank",n,o);return this.logoutPopupAsync(t,n,o,r,a,i)}catch(Oi){return Promise.reject(Oi)}},t.prototype.acquireTokenPopupAsync=function(e,t,n,r){return zi(this,void 0,void 0,(function(){var i,o,a,s,u,c,l,d,h,f,p,v,g,m,y,b,w=this;return Vi(this,(function(S){switch(S.label){case 0:return this.logger.verbose("acquireTokenPopupAsync called"),i=this.initializeServerTelemetryManager(zo.acquireTokenPopup),this.performanceClient.setPreQueueTime(qi.StandardInteractionClientInitializeAuthorizationRequest,e.correlationId),[4,this.initializeAuthorizationRequest(e,Vo.Popup)];case 1:o=S.sent(),this.browserStorage.updateCacheEntries(o.state,o.nonce,o.authority,o.loginHint||ao.EMPTY_STRING,o.account||null),S.label=2;case 2:return S.trys.push([2,8,,9]),this.performanceClient.setPreQueueTime(qi.StandardInteractionClientInitializeAuthorizationCodeRequest,e.correlationId),[4,this.initializeAuthorizationCodeRequest(o)];case 3:return a=S.sent(),this.performanceClient.setPreQueueTime(qi.StandardInteractionClientCreateAuthCodeClient,e.correlationId),[4,this.createAuthCodeClient(i,o.authority,o.azureCloudOptions)];case 4:return s=S.sent(),this.logger.verbose("Auth code client created"),u=_l.isNativeAvailable(this.config,this.logger,this.nativeMessageHandler,e.authenticationScheme),c=void 0,u&&(c=this.performanceClient.startMeasurement(qi.FetchAccountIdWithNativeBroker,e.correlationId)),[4,s.getAuthCodeUrl(Ui(Ui({},o),{nativeBroker:u}))];case 5:return l=S.sent(),d=new Pl(s,this.browserStorage,a,this.logger,this.performanceClient),h={popup:r,popupName:t,popupWindowAttributes:n},f=this.initiateAuthRequest(l,h),this.eventHandler.emitEvent(Qc.POPUP_OPENED,Vo.Popup,{popupWindow:f},null),[4,this.monitorPopupForHash(f)];case 6:if(p=S.sent(),v=Oc.getDeserializedHash(p),g=this.validateAndExtractStateFromHash(v,Vo.Popup,o.correlationId),tl.removeThrottle(this.browserStorage,this.config.auth.clientId,a),v.accountId){if(this.logger.verbose("Account id found in hash, calling WAM for token"),c&&c.endMeasurement({success:!0,isNativeBroker:!0}),!this.nativeMessageHandler)throw hu.createNativeConnectionNotEstablishedError();return m=new Rl(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,zo.acquireTokenPopup,this.performanceClient,this.nativeMessageHandler,v.accountId,this.nativeStorage,o.correlationId),y=Rc.parseRequestState(this.browserCrypto,g).userRequestState,[2,m.acquireToken(Ui(Ui({},o),{state:y,prompt:void 0})).finally((function(){w.browserStorage.cleanRequestByState(g)}))]}return[4,d.handleCodeResponseFromHash(p,g,s.authority,this.networkClient)];case 7:return[2,S.sent()];case 8:throw b=S.sent(),r&&r.close(),b instanceof Jo&&b.setCorrelationId(this.correlationId),i.cacheFailedRequest(b),this.browserStorage.cleanRequestByState(o.state),b;case 9:return[2]}}))}))},t.prototype.logoutPopupAsync=function(e,t,n,r,i,o){return zi(this,void 0,void 0,(function(){var a,s,u,c,l,d,h;return Vi(this,(function(f){switch(f.label){case 0:this.logger.verbose("logoutPopupAsync called"),this.eventHandler.emitEvent(Qc.LOGOUT_START,Vo.Popup,e),a=this.initializeServerTelemetryManager(zo.logoutPopup),f.label=1;case 1:return f.trys.push([1,5,,6]),[4,this.clearCacheOnLogout(e.account)];case 2:return f.sent(),this.performanceClient.setPreQueueTime(qi.StandardInteractionClientCreateAuthCodeClient,e.correlationId),[4,this.createAuthCodeClient(a,r)];case 3:return s=f.sent(),this.logger.verbose("Auth code client created"),u=s.getLogoutUri(e),this.eventHandler.emitEvent(Qc.LOGOUT_SUCCESS,Vo.Popup,e),c=this.openPopup(u,{popupName:t,popupWindowAttributes:n,popup:i}),this.eventHandler.emitEvent(Qc.POPUP_OPENED,Vo.Popup,{popupWindow:c},null),[4,this.waitForLogoutPopup(c)];case 4:return f.sent(),o?(l={apiId:zo.logoutPopup,timeout:this.config.system.redirectNavigationTimeout,noHistory:!1},d=Oc.getAbsoluteUrl(o,Kc.getCurrentUri()),this.logger.verbose("Redirecting main window to url specified in the request"),this.logger.verbosePii("Redirecting main window to: "+d),this.navigationClient.navigateInternal(d,l)):this.logger.verbose("No main window navigation requested"),[3,6];case 5:throw h=f.sent(),i&&i.close(),h instanceof Jo&&h.setCorrelationId(this.correlationId),this.browserStorage.setInteractionInProgress(!1),this.eventHandler.emitEvent(Qc.LOGOUT_FAILURE,Vo.Popup,null,h),this.eventHandler.emitEvent(Qc.LOGOUT_END,Vo.Popup),a.cacheFailedRequest(h),h;case 6:return this.eventHandler.emitEvent(Qc.LOGOUT_END,Vo.Popup),[2]}}))}))},t.prototype.initiateAuthRequest=function(e,t){if(ws.isEmpty(e))throw this.logger.error("Navigate url is empty"),hu.createEmptyNavigationUriError();return this.logger.infoPii("Navigate to: "+e),this.openPopup(e,t)},t.prototype.monitorPopupForHash=function(e){var t=this;return new Promise((function(n,r){var i=t.config.system.windowHashTimeout/t.config.system.pollIntervalMilliseconds,o=0;t.logger.verbose("PopupHandler.monitorPopupForHash - polling started");var a=setInterval((function(){if(e.closed)return t.logger.error("PopupHandler.monitorPopupForHash - window closed"),t.cleanPopup(),clearInterval(a),void r(hu.createUserCancelledError());var s=ao.EMPTY_STRING,u=ao.EMPTY_STRING;try{s=e.location.href,u=e.location.hash}catch(Oi){}ws.isEmpty(s)||"about:blank"===s||(t.logger.verbose("PopupHandler.monitorPopupForHash - popup window is on same origin as caller"),o++,u?(t.logger.verbose("PopupHandler.monitorPopupForHash - found hash in url"),clearInterval(a),t.cleanPopup(e),Oc.hashContainsKnownProperties(u)?(t.logger.verbose("PopupHandler.monitorPopupForHash - hash contains known properties, returning."),n(u)):(t.logger.error("PopupHandler.monitorPopupForHash - found hash in url but it does not contain known properties. Check that your router is not changing the hash prematurely."),t.logger.errorPii("PopupHandler.monitorPopupForHash - hash found: "+u),r(hu.createHashDoesNotContainKnownPropertiesError()))):o>i&&(t.logger.error("PopupHandler.monitorPopupForHash - unable to find hash in url, timing out"),clearInterval(a),r(hu.createMonitorPopupTimeoutError())))}),t.config.system.pollIntervalMilliseconds)}))},t.prototype.waitForLogoutPopup=function(e){var t=this;return new Promise((function(n){t.logger.verbose("PopupHandler.waitForLogoutPopup - polling started");var r=setInterval((function(){e.closed&&(t.logger.error("PopupHandler.waitForLogoutPopup - window closed"),t.cleanPopup(),clearInterval(r),n());var i=ao.EMPTY_STRING;try{i=e.location.href}catch(Oi){}ws.isEmpty(i)||"about:blank"===i||(t.logger.verbose("PopupHandler.waitForLogoutPopup - popup window is on same origin as caller, closing."),clearInterval(r),t.cleanPopup(e),n())}),t.config.system.pollIntervalMilliseconds)}))},t.prototype.openPopup=function(e,t){try{var n=void 0;if(t.popup?(n=t.popup,this.logger.verbosePii("Navigating popup window to: "+e),n.location.assign(e)):"undefined"===typeof t.popup&&(this.logger.verbosePii("Opening popup window to: "+e),n=this.openSizedPopup(e,t.popupName,t.popupWindowAttributes)),!n)throw hu.createEmptyWindowCreatedError();return n.focus&&n.focus(),this.currentWindow=n,window.addEventListener("beforeunload",this.unloadWindow),n}catch(Oi){throw this.logger.error("error opening popup "+Oi.message),this.browserStorage.setInteractionInProgress(!1),hu.createPopupWindowError(Oi.toString())}},t.prototype.openSizedPopup=function(e,t,n){var r,i,o,a,s=window.screenLeft?window.screenLeft:window.screenX,u=window.screenTop?window.screenTop:window.screenY,c=window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth,l=window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight,d=null===(r=n.popupSize)||void 0===r?void 0:r.width,h=null===(i=n.popupSize)||void 0===i?void 0:i.height,f=null===(o=n.popupPosition)||void 0===o?void 0:o.top,p=null===(a=n.popupPosition)||void 0===a?void 0:a.left;return(!d||d<0||d>c)&&(this.logger.verbose("Default popup window width used. Window width not configured or invalid."),d=ra),(!h||h<0||h>l)&&(this.logger.verbose("Default popup window height used. Window height not configured or invalid."),h=ia),(!f||f<0||f>l)&&(this.logger.verbose("Default popup window top position used. Window top not configured or invalid."),f=Math.max(0,l/2-ia/2+u)),(!p||p<0||p>c)&&(this.logger.verbose("Default popup window left position used. Window left not configured or invalid."),p=Math.max(0,c/2-ra/2+s)),window.open(e,t,"width="+d+", height="+h+", top="+f+", left="+p+", scrollbars=yes")},t.prototype.unloadWindow=function(e){this.browserStorage.cleanRequestByInteractionType(Vo.Popup),this.currentWindow&&this.currentWindow.close(),e.preventDefault()},t.prototype.cleanPopup=function(e){e&&e.close(),window.removeEventListener("beforeunload",this.unloadWindow),this.browserStorage.setInteractionInProgress(!1)},t.prototype.generatePopupName=function(e,t){return oa+"."+this.config.auth.clientId+"."+e.join("-")+"."+t+"."+this.correlationId},t.prototype.generateLogoutPopupName=function(e){var t=e.account&&e.account.homeAccountId;return oa+"."+this.config.auth.clientId+"."+t+"."+this.correlationId},t}(wl),Ol=function(e){function t(t,n,r,i,o,a){var s=e.call(this,t,n,r,i,a)||this;return s.browserCrypto=o,s}return Bi(t,e),t.prototype.initiateAuthRequest=function(e,t){return zi(this,void 0,void 0,(function(){var n;return Vi(this,(function(r){switch(r.label){case 0:return this.logger.verbose("RedirectHandler.initiateAuthRequest called"),ws.isEmpty(e)?[3,7]:(t.redirectStartPage&&(this.logger.verbose("RedirectHandler.initiateAuthRequest: redirectStartPage set, caching start page"),this.browserStorage.setTemporaryCache(jo.ORIGIN_URI,t.redirectStartPage,!0)),this.browserStorage.setTemporaryCache(jo.CORRELATION_ID,this.authCodeRequest.correlationId,!0),this.browserStorage.cacheCodeRequest(this.authCodeRequest,this.browserCrypto),this.logger.infoPii("RedirectHandler.initiateAuthRequest: Navigate to: "+e),n={apiId:zo.acquireTokenRedirect,timeout:t.redirectTimeout,noHistory:!1},"function"!==typeof t.onRedirectNavigate?[3,4]:(this.logger.verbose("RedirectHandler.initiateAuthRequest: Invoking onRedirectNavigate callback"),!1===t.onRedirectNavigate(e)?[3,2]:(this.logger.verbose("RedirectHandler.initiateAuthRequest: onRedirectNavigate did not return false, navigating"),[4,t.navigationClient.navigateExternal(e,n)])));case 1:case 5:return r.sent(),[2];case 2:return this.logger.verbose("RedirectHandler.initiateAuthRequest: onRedirectNavigate returned false, stopping navigation"),[2];case 3:return[3,6];case 4:return this.logger.verbose("RedirectHandler.initiateAuthRequest: Navigating window to navigate url"),[4,t.navigationClient.navigateExternal(e,n)];case 6:return[3,8];case 7:throw this.logger.info("RedirectHandler.initiateAuthRequest: Navigate url is empty"),hu.createEmptyNavigationUriError();case 8:return[2]}}))}))},t.prototype.handleCodeResponseFromHash=function(e,t,n,r){return zi(this,void 0,void 0,(function(){var i,o,a,s,u,c,l;return Vi(this,(function(d){switch(d.label){case 0:if(this.logger.verbose("RedirectHandler.handleCodeResponse called"),ws.isEmpty(e))throw hu.createEmptyHashError(e);if(this.browserStorage.setInteractionInProgress(!1),i=this.browserStorage.generateStateKey(t),!(o=this.browserStorage.getTemporaryCache(i)))throw bs.createStateNotFoundError("Cached State");try{a=this.authModule.handleFragmentResponse(e,o)}catch(Oi){throw Oi instanceof Qo&&Oi.subError===Os.code?hu.createUserCancelledError():Oi}return s=this.browserStorage.generateNonceKey(o),u=this.browserStorage.getTemporaryCache(s),this.authCodeRequest.code=a.code,a.cloud_instance_host_name?[4,this.updateTokenEndpointAuthority(a.cloud_instance_host_name,n,r)]:[3,2];case 1:d.sent(),d.label=2;case 2:return a.nonce=u||void 0,a.state=o,a.client_info?this.authCodeRequest.clientInfo=a.client_info:(c=this.checkCcsCredentials())&&(this.authCodeRequest.ccsCredential=c),[4,this.authModule.acquireToken(this.authCodeRequest,a)];case 3:return l=d.sent(),this.browserStorage.cleanRequestByState(t),[2,l]}}))}))},t}(Pl),Ml=function(e){function t(t,n,r,i,o,a,s,u,c,l){var d=e.call(this,t,n,r,i,o,a,s,c,l)||this;return d.nativeStorage=u,d}return Bi(t,e),t.prototype.acquireToken=function(e){return zi(this,void 0,void 0,(function(){var t,n,r,i,o,a,s,u,c,l=this;return Vi(this,(function(d){switch(d.label){case 0:return this.performanceClient.setPreQueueTime(qi.StandardInteractionClientInitializeAuthorizationRequest,e.correlationId),[4,this.initializeAuthorizationRequest(e,Vo.Redirect)];case 1:t=d.sent(),this.browserStorage.updateCacheEntries(t.state,t.nonce,t.authority,t.loginHint||ao.EMPTY_STRING,t.account||null),n=this.initializeServerTelemetryManager(zo.acquireTokenRedirect),r=function(e){e.persisted&&(l.logger.verbose("Page was restored from back/forward cache. Clearing temporary cache."),l.browserStorage.cleanRequestByState(t.state),l.eventHandler.emitEvent(Qc.RESTORE_FROM_BFCACHE,Vo.Redirect))},d.label=2;case 2:return d.trys.push([2,7,,8]),this.performanceClient.setPreQueueTime(qi.StandardInteractionClientInitializeAuthorizationCodeRequest,e.correlationId),[4,this.initializeAuthorizationCodeRequest(t)];case 3:return i=d.sent(),this.performanceClient.setPreQueueTime(qi.StandardInteractionClientCreateAuthCodeClient,e.correlationId),[4,this.createAuthCodeClient(n,t.authority,t.azureCloudOptions)];case 4:return o=d.sent(),this.logger.verbose("Auth code client created"),a=new Ol(o,this.browserStorage,i,this.logger,this.browserCrypto,this.performanceClient),[4,o.getAuthCodeUrl(Ui(Ui({},t),{nativeBroker:_l.isNativeAvailable(this.config,this.logger,this.nativeMessageHandler,e.authenticationScheme)}))];case 5:return s=d.sent(),u=this.getRedirectStartPage(e.redirectStartPage),this.logger.verbosePii("Redirect start page: "+u),window.addEventListener("pageshow",r),[4,a.initiateAuthRequest(s,{navigationClient:this.navigationClient,redirectTimeout:this.config.system.redirectNavigationTimeout,redirectStartPage:u,onRedirectNavigate:e.onRedirectNavigate})];case 6:return[2,d.sent()];case 7:throw(c=d.sent())instanceof Jo&&c.setCorrelationId(this.correlationId),window.removeEventListener("pageshow",r),n.cacheFailedRequest(c),this.browserStorage.cleanRequestByState(t.state),c;case 8:return[2]}}))}))},t.prototype.handleRedirectPromise=function(e){return zi(this,void 0,void 0,(function(){var t,n,r,i,o,a,s,u,c,l,d,h;return Vi(this,(function(f){switch(f.label){case 0:t=this.initializeServerTelemetryManager(zo.handleRedirectPromise),f.label=1;case 1:if(f.trys.push([1,10,,11]),!this.browserStorage.isInteractionInProgress(!0))return this.logger.info("handleRedirectPromise called but there is no interaction in progress, returning null."),[2,null];if(!(n=this.getRedirectResponseHash(e||window.location.hash)))return this.logger.info("handleRedirectPromise did not detect a response hash as a result of a redirect. Cleaning temporary cache."),this.browserStorage.cleanRequestByInteractionType(Vo.Redirect),[2,null];r=void 0;try{i=Oc.getDeserializedHash(n),r=this.validateAndExtractStateFromHash(i,Vo.Redirect),this.logger.verbose("State extracted from hash")}catch(Oi){return this.logger.info("handleRedirectPromise was unable to extract state due to: "+Oi),this.browserStorage.cleanRequestByInteractionType(Vo.Redirect),[2,null]}return o=this.browserStorage.getTemporaryCache(jo.ORIGIN_URI,!0)||ao.EMPTY_STRING,a=Oc.removeHashFromUrl(o),s=Oc.removeHashFromUrl(window.location.href),a===s&&this.config.auth.navigateToLoginRequestUrl?(this.logger.verbose("Current page is loginRequestUrl, handling hash"),[4,this.handleHash(n,r,t)]):[3,3];case 2:return u=f.sent(),o.indexOf("#")>-1&&Kc.replaceHash(o),[2,u];case 3:return this.config.auth.navigateToLoginRequestUrl?[3,4]:(this.logger.verbose("NavigateToLoginRequestUrl set to false, handling hash"),[2,this.handleHash(n,r,t)]);case 4:return Kc.isInIframe()&&!this.config.system.allowRedirectInIframe?[3,9]:(this.browserStorage.setTemporaryCache(jo.URL_HASH,n,!0),c={apiId:zo.handleRedirectPromise,timeout:this.config.system.redirectNavigationTimeout,noHistory:!0},l=!0,o&&"null"!==o?[3,6]:(d=Kc.getHomepage(),this.browserStorage.setTemporaryCache(jo.ORIGIN_URI,d,!0),this.logger.warning("Unable to get valid login request url from cache, redirecting to home page"),[4,this.navigationClient.navigateInternal(d,c)]));case 5:return l=f.sent(),[3,8];case 6:return this.logger.verbose("Navigating to loginRequestUrl: "+o),[4,this.navigationClient.navigateInternal(o,c)];case 7:l=f.sent(),f.label=8;case 8:if(!l)return[2,this.handleHash(n,r,t)];f.label=9;case 9:return[2,null];case 10:throw(h=f.sent())instanceof Jo&&h.setCorrelationId(this.correlationId),t.cacheFailedRequest(h),this.browserStorage.cleanRequestByInteractionType(Vo.Redirect),h;case 11:return[2]}}))}))},t.prototype.getRedirectResponseHash=function(e){if(this.logger.verbose("getRedirectResponseHash called"),Oc.hashContainsKnownProperties(e))return Kc.clearHash(window),this.logger.verbose("Hash contains known properties, returning response hash"),e;var t=this.browserStorage.getTemporaryCache(jo.URL_HASH,!0);return this.browserStorage.removeItem(this.browserStorage.generateCacheKey(jo.URL_HASH)),this.logger.verbose("Hash does not contain known properties, returning cached hash"),t},t.prototype.handleHash=function(e,t,n){return zi(this,void 0,void 0,(function(){var r,i,o,a,s,u,c=this;return Vi(this,(function(l){switch(l.label){case 0:if(r=this.browserStorage.getCachedRequest(t,this.browserCrypto),this.logger.verbose("handleHash called, retrieved cached request"),(i=Oc.getDeserializedHash(e)).accountId){if(this.logger.verbose("Account id found in hash, calling WAM for token"),!this.nativeMessageHandler)throw hu.createNativeConnectionNotEstablishedError();return o=new Rl(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,zo.acquireTokenPopup,this.performanceClient,this.nativeMessageHandler,i.accountId,this.nativeStorage,r.correlationId),a=Rc.parseRequestState(this.browserCrypto,t).userRequestState,[2,o.acquireToken(Ui(Ui({},r),{state:a,prompt:void 0})).finally((function(){c.browserStorage.cleanRequestByState(t)}))]}if(!(s=this.browserStorage.getCachedAuthority(t)))throw hu.createNoCachedAuthorityError();return this.performanceClient.setPreQueueTime(qi.StandardInteractionClientCreateAuthCodeClient,r.correlationId),[4,this.createAuthCodeClient(n,s)];case 1:return u=l.sent(),this.logger.verbose("Auth code client created"),tl.removeThrottle(this.browserStorage,this.config.auth.clientId,r),[4,new Ol(u,this.browserStorage,r,this.logger,this.browserCrypto,this.performanceClient).handleCodeResponseFromHash(e,t,u.authority,this.networkClient)];case 2:return[2,l.sent()]}}))}))},t.prototype.logout=function(e){return zi(this,void 0,void 0,(function(){var t,n,r,i,o,a;return Vi(this,(function(s){switch(s.label){case 0:this.logger.verbose("logoutRedirect called"),t=this.initializeLogoutRequest(e),n=this.initializeServerTelemetryManager(zo.logout),s.label=1;case 1:return s.trys.push([1,10,,11]),this.eventHandler.emitEvent(Qc.LOGOUT_START,Vo.Redirect,e),[4,this.clearCacheOnLogout(t.account)];case 2:return s.sent(),r={apiId:zo.logout,timeout:this.config.system.redirectNavigationTimeout,noHistory:!1},this.performanceClient.setPreQueueTime(qi.StandardInteractionClientCreateAuthCodeClient,t.correlationId),[4,this.createAuthCodeClient(n,e&&e.authority)];case 3:return i=s.sent(),this.logger.verbose("Auth code client created"),o=i.getLogoutUri(t),this.eventHandler.emitEvent(Qc.LOGOUT_SUCCESS,Vo.Redirect,t),e&&"function"===typeof e.onRedirectNavigate?!1===e.onRedirectNavigate(o)?[3,5]:(this.logger.verbose("Logout onRedirectNavigate did not return false, navigating"),this.browserStorage.getInteractionInProgress()||this.browserStorage.setInteractionInProgress(!0),[4,this.navigationClient.navigateExternal(o,r)]):[3,7];case 4:return s.sent(),[2];case 5:this.browserStorage.setInteractionInProgress(!1),this.logger.verbose("Logout onRedirectNavigate returned false, stopping navigation"),s.label=6;case 6:return[3,9];case 7:return this.browserStorage.getInteractionInProgress()||this.browserStorage.setInteractionInProgress(!0),[4,this.navigationClient.navigateExternal(o,r)];case 8:return s.sent(),[2];case 9:return[3,11];case 10:throw(a=s.sent())instanceof Jo&&a.setCorrelationId(this.correlationId),n.cacheFailedRequest(a),this.eventHandler.emitEvent(Qc.LOGOUT_FAILURE,Vo.Redirect,null,a),this.eventHandler.emitEvent(Qc.LOGOUT_END,Vo.Redirect),a;case 11:return this.eventHandler.emitEvent(Qc.LOGOUT_END,Vo.Redirect),[2]}}))}))},t.prototype.getRedirectStartPage=function(e){var t=e||window.location.href;return Oc.getAbsoluteUrl(t,Kc.getCurrentUri())},t}(wl),Fl=function(e){function t(t,n,r,i,o,a){var s=e.call(this,t,n,r,i,a)||this;return s.navigateFrameWait=o.navigateFrameWait,s.pollIntervalMilliseconds=o.pollIntervalMilliseconds,s}return Bi(t,e),t.prototype.initiateAuthRequest=function(e){return zi(this,void 0,void 0,(function(){return Vi(this,(function(t){switch(t.label){case 0:if(this.performanceClient.addQueueMeasurement(qi.SilentHandlerInitiateAuthRequest,this.authCodeRequest.correlationId),ws.isEmpty(e))throw this.logger.info("Navigate url is empty"),hu.createEmptyNavigationUriError();return this.navigateFrameWait?(this.performanceClient.setPreQueueTime(qi.SilentHandlerLoadFrame,this.authCodeRequest.correlationId),[4,this.loadFrame(e)]):[3,2];case 1:return[2,t.sent()];case 2:return[2,this.loadFrameSync(e)]}}))}))},t.prototype.monitorIframeForHash=function(e,t){var n=this;return this.performanceClient.addQueueMeasurement(qi.SilentHandlerMonitorIframeForHash,this.authCodeRequest.correlationId),new Promise((function(r,i){t<Jc&&n.logger.warning("system.loadFrameTimeout or system.iframeHashTimeout set to lower ("+t+"ms) than the default ("+Jc+"ms). This may result in timeouts.");var o=window.performance.now()+t,a=setInterval((function(){if(window.performance.now()>o)return n.removeHiddenIframe(e),clearInterval(a),void i(hu.createMonitorIframeTimeoutError());var t=ao.EMPTY_STRING,s=e.contentWindow;try{t=s?s.location.href:ao.EMPTY_STRING}catch(Oi){}if(!ws.isEmpty(t)){var u=s?s.location.hash:ao.EMPTY_STRING;return Oc.hashContainsKnownProperties(u)?(n.removeHiddenIframe(e),clearInterval(a),void r(u)):void 0}}),n.pollIntervalMilliseconds)}))},t.prototype.loadFrame=function(e){var t=this;return this.performanceClient.addQueueMeasurement(qi.SilentHandlerLoadFrame,this.authCodeRequest.correlationId),new Promise((function(n,r){var i=t.createHiddenIframe();setTimeout((function(){i?(i.src=e,n(i)):r("Unable to load iframe")}),t.navigateFrameWait)}))},t.prototype.loadFrameSync=function(e){var t=this.createHiddenIframe();return t.src=e,t},t.prototype.createHiddenIframe=function(){var e=document.createElement("iframe");return e.style.visibility="hidden",e.style.position="absolute",e.style.width=e.style.height="0",e.style.border="0",e.setAttribute("sandbox","allow-scripts allow-same-origin allow-forms"),document.getElementsByTagName("body")[0].appendChild(e),e},t.prototype.removeHiddenIframe=function(e){document.body===e.parentNode&&document.body.removeChild(e)},t}(Pl),Zl=function(e){function t(t,n,r,i,o,a,s,u,c,l,d){var h=e.call(this,t,n,r,i,o,a,u,l,d)||this;return h.apiId=s,h.nativeStorage=c,h}return Bi(t,e),t.prototype.acquireToken=function(e){return zi(this,void 0,void 0,(function(){var t,n,r,i,o;return Vi(this,(function(a){switch(a.label){case 0:if(this.performanceClient.addQueueMeasurement(qi.SilentIframeClientAcquireToken,e.correlationId),this.logger.verbose("acquireTokenByIframe called"),t=this.performanceClient.startMeasurement(qi.SilentIframeClientAcquireToken,e.correlationId),ws.isEmpty(e.loginHint)&&ws.isEmpty(e.sid)&&(!e.account||ws.isEmpty(e.account.username))&&this.logger.warning("No user hint provided. The authorization server may need more information to complete this request."),e.prompt&&e.prompt!==lo.NONE&&e.prompt!==lo.NO_SESSION)throw t.endMeasurement({success:!1}),hu.createSilentPromptValueError(e.prompt);return this.performanceClient.setPreQueueTime(qi.StandardInteractionClientInitializeAuthorizationRequest,e.correlationId),[4,this.initializeAuthorizationRequest(Ui(Ui({},e),{prompt:e.prompt||lo.NONE}),Vo.Silent)];case 1:n=a.sent(),this.browserStorage.updateCacheEntries(n.state,n.nonce,n.authority,n.loginHint||ao.EMPTY_STRING,n.account||null),r=this.initializeServerTelemetryManager(this.apiId),a.label=2;case 2:return a.trys.push([2,5,,6]),this.performanceClient.setPreQueueTime(qi.StandardInteractionClientCreateAuthCodeClient,e.correlationId),[4,this.createAuthCodeClient(r,n.authority,n.azureCloudOptions)];case 3:return i=a.sent(),this.logger.verbose("Auth code client created"),this.performanceClient.setPreQueueTime(qi.SilentIframeClientTokenHelper,e.correlationId),[4,this.silentTokenHelper(i,n).then((function(e){return t.endMeasurement({success:!0,fromCache:!1,requestId:e.requestId}),e}))];case 4:return[2,a.sent()];case 5:throw(o=a.sent())instanceof Jo&&o.setCorrelationId(this.correlationId),r.cacheFailedRequest(o),this.browserStorage.cleanRequestByState(n.state),t.endMeasurement({errorCode:o instanceof Jo&&o.errorCode||void 0,subErrorCode:o instanceof Jo&&o.subError||void 0,success:!1}),o;case 6:return[2]}}))}))},t.prototype.logout=function(){return Promise.reject(hu.createSilentLogoutUnsupportedError())},t.prototype.silentTokenHelper=function(e,t){return zi(this,void 0,void 0,(function(){var n,r,i,o,a,s,u,c,l,d=this;return Vi(this,(function(h){switch(h.label){case 0:return this.performanceClient.addQueueMeasurement(qi.SilentIframeClientTokenHelper,t.correlationId),this.performanceClient.setPreQueueTime(qi.StandardInteractionClientInitializeAuthorizationCodeRequest,t.correlationId),[4,this.initializeAuthorizationCodeRequest(t)];case 1:return n=h.sent(),this.performanceClient.setPreQueueTime(qi.GetAuthCodeUrl,t.correlationId),[4,e.getAuthCodeUrl(Ui(Ui({},t),{nativeBroker:_l.isNativeAvailable(this.config,this.logger,this.nativeMessageHandler,t.authenticationScheme)}))];case 2:return r=h.sent(),i=new Fl(e,this.browserStorage,n,this.logger,this.config.system,this.performanceClient),this.performanceClient.setPreQueueTime(qi.SilentHandlerInitiateAuthRequest,t.correlationId),[4,i.initiateAuthRequest(r)];case 3:return o=h.sent(),this.performanceClient.setPreQueueTime(qi.SilentHandlerMonitorIframeForHash,t.correlationId),[4,i.monitorIframeForHash(o,this.config.system.iframeHashTimeout)];case 4:if(a=h.sent(),s=Oc.getDeserializedHash(a),u=this.validateAndExtractStateFromHash(s,Vo.Silent,n.correlationId),s.accountId){if(this.logger.verbose("Account id found in hash, calling WAM for token"),!this.nativeMessageHandler)throw hu.createNativeConnectionNotEstablishedError();return c=new Rl(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,this.apiId,this.performanceClient,this.nativeMessageHandler,s.accountId,this.browserStorage,this.correlationId),l=Rc.parseRequestState(this.browserCrypto,u).userRequestState,[2,c.acquireToken(Ui(Ui({},t),{state:l,prompt:t.prompt||lo.NONE})).finally((function(){d.browserStorage.cleanRequestByState(u)}))]}return this.performanceClient.setPreQueueTime(qi.HandleCodeResponseFromHash,t.correlationId),[2,i.handleCodeResponseFromHash(a,u,e.authority,this.networkClient)]}}))}))},t}(wl),Dl=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Bi(t,e),t.prototype.acquireToken=function(e){return zi(this,void 0,void 0,(function(){var t,n,r,i,o,a=this;return Vi(this,(function(s){switch(s.label){case 0:return this.performanceClient.addQueueMeasurement(qi.SilentRefreshClientAcquireToken,e.correlationId),this.performanceClient.setPreQueueTime(qi.InitializeBaseRequest,e.correlationId),n=[Ui({},e)],[4,this.initializeBaseRequest(e,e.account)];case 1:return t=Ui.apply(void 0,n.concat([s.sent()])),r=this.performanceClient.startMeasurement(qi.SilentRefreshClientAcquireToken,t.correlationId),i=this.initializeServerTelemetryManager(zo.acquireTokenSilent_silentFlow),[4,this.createRefreshTokenClient(i,t.authority,t.azureCloudOptions)];case 2:return o=s.sent(),this.logger.verbose("Refresh token client created"),this.performanceClient.setPreQueueTime(qi.RefreshTokenClientAcquireTokenByRefreshToken,e.correlationId),[2,o.acquireTokenByRefreshToken(t).then((function(e){return r.endMeasurement({success:!0,fromCache:e.fromCache,requestId:e.requestId}),e})).catch((function(e){throw e instanceof Jo&&e.setCorrelationId(a.correlationId),i.cacheFailedRequest(e),r.endMeasurement({errorCode:e.errorCode,subErrorCode:e.subError,success:!1}),e}))]}}))}))},t.prototype.logout=function(){return Promise.reject(hu.createSilentLogoutUnsupportedError())},t.prototype.createRefreshTokenClient=function(e,t,n){return zi(this,void 0,void 0,(function(){var r;return Vi(this,(function(i){switch(i.label){case 0:return this.performanceClient.setPreQueueTime(qi.StandardInteractionClientGetClientConfiguration,this.correlationId),[4,this.getClientConfiguration(e,t,n)];case 1:return r=i.sent(),[2,new Tl(r,this.performanceClient)]}}))}))},t}(wl),Ll=function(){function e(e,t,n,r){this.isBrowserEnvironment="undefined"!==typeof window,this.config=e,this.storage=t,this.logger=n,this.cryptoObj=r}return e.prototype.loadExternalTokens=function(e,t,n){if(this.logger.info("TokenCache - loadExternalTokens called"),!t.id_token)throw hu.createUnableToLoadTokenError("Please ensure server response includes id token.");var r,i,o=new mc(t.id_token,this.cryptoObj);if(e.account){var a=this.loadAccount(o,e.account.environment,void 0,void 0,e.account.homeAccountId);r=new al(a,this.loadIdToken(o,a.homeAccountId,e.account.environment,e.account.tenantId),this.loadAccessToken(e,t,a.homeAccountId,e.account.environment,e.account.tenantId,n),this.loadRefreshToken(e,t,a.homeAccountId,e.account.environment))}else{if(!e.authority)throw hu.createUnableToLoadTokenError("Please provide a request with an account or a request with authority.");var s=gl.generateAuthority(e.authority,e.azureCloudOptions),u={protocolMode:this.config.auth.protocolMode,knownAuthorities:this.config.auth.knownAuthorities,cloudDiscoveryMetadata:this.config.auth.cloudDiscoveryMetadata,authorityMetadata:this.config.auth.authorityMetadata,skipAuthorityMetadataCache:this.config.auth.skipAuthorityMetadataCache};if(i=new gl(s,this.config.system.networkClient,this.storage,u,this.logger),n.clientInfo){this.logger.trace("TokenCache - homeAccountId from options");a=this.loadAccount(o,i.hostnameAndPort,n.clientInfo,i.authorityType);r=new al(a,this.loadIdToken(o,a.homeAccountId,i.hostnameAndPort,i.tenant),this.loadAccessToken(e,t,a.homeAccountId,i.hostnameAndPort,i.tenant,n),this.loadRefreshToken(e,t,a.homeAccountId,i.hostnameAndPort))}else{if(!t.client_info)throw hu.createUnableToLoadTokenError("Please provide clientInfo in the response or options.");this.logger.trace("TokenCache - homeAccountId from response");a=this.loadAccount(o,i.hostnameAndPort,t.client_info,i.authorityType);r=new al(a,this.loadIdToken(o,a.homeAccountId,i.hostnameAndPort,i.tenant),this.loadAccessToken(e,t,a.homeAccountId,i.hostnameAndPort,i.tenant,n),this.loadRefreshToken(e,t,a.homeAccountId,i.hostnameAndPort))}}return this.generateAuthenticationResult(e,o,r,i)},e.prototype.loadAccount=function(e,t,n,r,i){var o;if(i?o=i:void 0!==r&&n&&(o=gc.generateHomeAccountId(n,r,this.logger,this.cryptoObj,e)),!o)throw hu.createUnableToLoadTokenError("Unexpected missing homeAccountId");var a=n?gc.createAccount(n,o,e,void 0,void 0,void 0,t):gc.createGenericAccount(o,e,void 0,void 0,void 0,t);if(this.isBrowserEnvironment)return this.logger.verbose("TokenCache - loading account"),this.storage.setAccount(a),a;throw hu.createUnableToLoadTokenError("loadExternalTokens is designed to work in browser environments only.")},e.prototype.loadIdToken=function(e,t,n,r){var i=ju.createIdTokenEntity(t,n,e.rawToken,this.config.auth.clientId,r);if(this.isBrowserEnvironment)return this.logger.verbose("TokenCache - loading id token"),this.storage.setIdTokenCredential(i),i;throw hu.createUnableToLoadTokenError("loadExternalTokens is designed to work in browser environments only.")},e.prototype.loadAccessToken=function(e,t,n,r,i,o){if(!t.access_token)return this.logger.verbose("TokenCache - No access token provided for caching"),null;if(!t.expires_in)throw hu.createUnableToLoadTokenError("Please ensure server response includes expires_in value.");if(!o.extendedExpiresOn)throw hu.createUnableToLoadTokenError("Please provide an extendedExpiresOn value in the options.");var a=new hc(e.scopes).printScopes(),s=o.expiresOn||t.expires_in+(new Date).getTime()/1e3,u=o.extendedExpiresOn,c=Cc.createAccessTokenEntity(n,r,t.access_token,this.config.auth.clientId,i,a,s,u,this.cryptoObj);if(this.isBrowserEnvironment)return this.logger.verbose("TokenCache - loading access token"),this.storage.setAccessTokenCredential(c),c;throw hu.createUnableToLoadTokenError("loadExternalTokens is designed to work in browser environments only.")},e.prototype.loadRefreshToken=function(e,t,n,r){if(!t.refresh_token)return this.logger.verbose("TokenCache - No refresh token provided for caching"),null;var i=xc.createRefreshTokenEntity(n,r,t.refresh_token,this.config.auth.clientId);if(this.isBrowserEnvironment)return this.logger.verbose("TokenCache - loading refresh token"),this.storage.setRefreshTokenCredential(i),i;throw hu.createUnableToLoadTokenError("loadExternalTokens is designed to work in browser environments only.")},e.prototype.generateAuthenticationResult=function(e,t,n,r){var i,o,a,s,u=ao.EMPTY_STRING,c=[],l=null;(null===n||void 0===n?void 0:n.accessToken)&&(u=n.accessToken.secret,c=hc.fromString(n.accessToken.target).asArray(),l=new Date(1e3*Number(n.accessToken.expiresOn)),s=new Date(1e3*Number(n.accessToken.extendedExpiresOn)));var d=(null===t||void 0===t?void 0:t.claims.oid)||(null===t||void 0===t?void 0:t.claims.sub)||ao.EMPTY_STRING,h=(null===t||void 0===t?void 0:t.claims.tid)||ao.EMPTY_STRING;return{authority:r?r.canonicalAuthority:ao.EMPTY_STRING,uniqueId:d,tenantId:h,scopes:c,account:(null===n||void 0===n?void 0:n.account)?n.account.getAccountInfo():null,idToken:t?t.rawToken:ao.EMPTY_STRING,idTokenClaims:t?t.claims:{},accessToken:u,fromCache:!0,expiresOn:l,correlationId:e.correlationId||ao.EMPTY_STRING,requestId:ao.EMPTY_STRING,extExpiresOn:s,familyId:ao.EMPTY_STRING,tokenType:(null===(i=null===n||void 0===n?void 0:n.accessToken)||void 0===i?void 0:i.tokenType)||ao.EMPTY_STRING,state:ao.EMPTY_STRING,cloudGraphHostName:(null===(o=null===n||void 0===n?void 0:n.account)||void 0===o?void 0:o.cloudGraphHostName)||ao.EMPTY_STRING,msGraphHost:(null===(a=null===n||void 0===n?void 0:n.account)||void 0===a?void 0:a.msGraphHost)||ao.EMPTY_STRING,code:void 0,fromNativeBroker:!1}},e}(),Bl=function(e){function t(t){var n=e.call(this,t)||this;return n.includeRedirectUri=!1,n}return Bi(t,e),t}(ll),ql=function(e){function t(t,n,r,i,o,a,s,u,c,l){var d=e.call(this,t,n,r,i,o,a,u,c,l)||this;return d.apiId=s,d}return Bi(t,e),t.prototype.acquireToken=function(e){return zi(this,void 0,void 0,(function(){var t,n,r,i,o,a;return Vi(this,(function(s){switch(s.label){case 0:if(this.logger.trace("SilentAuthCodeClient.acquireToken called"),!e.code)throw hu.createAuthCodeRequiredError();return this.performanceClient.setPreQueueTime(qi.StandardInteractionClientInitializeAuthorizationRequest,e.correlationId),[4,this.initializeAuthorizationRequest(e,Vo.Silent)];case 1:t=s.sent(),this.browserStorage.updateCacheEntries(t.state,t.nonce,t.authority,t.loginHint||ao.EMPTY_STRING,t.account||null),n=this.initializeServerTelemetryManager(this.apiId),s.label=2;case 2:return s.trys.push([2,4,,5]),r=Ui(Ui({},t),{code:e.code}),this.performanceClient.setPreQueueTime(qi.StandardInteractionClientGetClientConfiguration,e.correlationId),[4,this.getClientConfiguration(n,t.authority)];case 3:return i=s.sent(),o=new Bl(i),this.logger.verbose("Auth code client created"),[2,new Fl(o,this.browserStorage,r,this.logger,this.config.system,this.performanceClient).handleCodeResponseFromServer({code:e.code,msgraph_host:e.msGraphHost,cloud_graph_host_name:e.cloudGraphHostName,cloud_instance_host_name:e.cloudInstanceHostName},t.state,o.authority,this.networkClient,!1)];case 4:throw(a=s.sent())instanceof Jo&&a.setCorrelationId(this.correlationId),n.cacheFailedRequest(a),this.browserStorage.cleanRequestByState(t.state),a;case 5:return[2]}}))}))},t.prototype.logout=function(){return Promise.reject(hu.createSilentLogoutUnsupportedError())},t}(wl),jl=function(){function e(t,n){this.correlationId=n,this.measureName=e.makeMeasureName(t,n),this.startMark=e.makeStartMark(t,n),this.endMark=e.makeEndMark(t,n)}return e.makeMeasureName=function(e,t){return"msal.measure."+e+"."+t},e.makeStartMark=function(e,t){return"msal.start."+e+"."+t},e.makeEndMark=function(e,t){return"msal.end."+e+"."+t},e.supportsBrowserPerformance=function(){return"undefined"!==typeof window&&"undefined"!==typeof window.performance&&"function"===typeof window.performance.mark&&"function"===typeof window.performance.measure&&"function"===typeof window.performance.clearMarks&&"function"===typeof window.performance.clearMeasures&&"function"===typeof window.performance.getEntriesByName},e.flushMeasurements=function(t,n){if(e.supportsBrowserPerformance())try{n.forEach((function(n){var r=e.makeMeasureName(n.name,t);window.performance.getEntriesByName(r,"measure").length>0&&(window.performance.clearMeasures(r),window.performance.clearMarks(e.makeStartMark(r,t)),window.performance.clearMarks(e.makeEndMark(r,t)))}))}catch(Oi){}},e.prototype.startMeasurement=function(){if(e.supportsBrowserPerformance())try{window.performance.mark(this.startMark)}catch(Oi){}},e.prototype.endMeasurement=function(){if(e.supportsBrowserPerformance())try{window.performance.mark(this.endMark),window.performance.measure(this.measureName,this.startMark,this.endMark)}catch(Oi){}},e.prototype.flushMeasurement=function(){if(e.supportsBrowserPerformance())try{var t=window.performance.getEntriesByName(this.measureName,"measure");if(t.length>0){var n=t[0].duration;return window.performance.clearMeasures(this.measureName),window.performance.clearMarks(this.startMark),window.performance.clearMarks(this.endMark),n}}catch(Oi){}return null},e}(),Ul=function(e){function t(t,n,r,i,o,a,s){var u=e.call(this,t,n,r,i,o,a)||this;return u.browserCrypto=new Iu(u.logger,s),u.guidGenerator=new Ca(u.browserCrypto),u}return Bi(t,e),t.prototype.startPerformanceMeasuremeant=function(e,t){return new jl(e,t)},t.prototype.generateId=function(){return this.guidGenerator.generateGuid()},t.prototype.getPageVisibility=function(){var e;return(null===(e=document.visibilityState)||void 0===e?void 0:e.toString())||null},t.prototype.deleteIncompleteSubMeasurements=function(e){var t=this.eventsByCorrelationId.get(e.event.correlationId),n=t&&t.eventId===e.event.eventId,r=[];n&&(null===t||void 0===t?void 0:t.incompleteSubMeasurements)&&t.incompleteSubMeasurements.forEach((function(e){r.push(Ui({},e))})),r.length>0&&jl.flushMeasurements(e.event.correlationId,r)},t.prototype.supportsBrowserPerformanceNow=function(){return"undefined"!==typeof window&&"undefined"!==typeof window.performance&&"function"===typeof window.performance.now},t.prototype.startMeasurement=function(t,n){var r=this,i=this.getPageVisibility(),o=e.prototype.startMeasurement.call(this,t,n);return Ui(Ui({},o),{endMeasurement:function(e){var t=o.endMeasurement(Ui({startPageVisibility:i,endPageVisibility:r.getPageVisibility()},e));return r.deleteIncompleteSubMeasurements(o),t},discardMeasurement:function(){o.discardMeasurement(),r.deleteIncompleteSubMeasurements(o),o.measurement.flushMeasurement()}})},t.prototype.setPreQueueTime=function(e,t){if(this.supportsBrowserPerformanceNow())if(t){var n=this.preQueueTimeByCorrelationId.get(t);n&&(this.logger.trace("BrowserPerformanceClient: Incomplete pre-queue "+n.name+" found",t),this.addQueueMeasurement(n.name,t,void 0,!0)),this.preQueueTimeByCorrelationId.set(t,{name:e,time:window.performance.now()})}else this.logger.trace("BrowserPerformanceClient: correlationId for "+e+" not provided, unable to set telemetry queue time");else this.logger.trace("BrowserPerformanceClient: window performance API not available, unable to set telemetry queue time for "+e)},t.prototype.addQueueMeasurement=function(t,n,r,i){if(this.supportsBrowserPerformanceNow())if(n){var o=e.prototype.getPreQueueTime.call(this,t,n);if(o){var a=window.performance.now(),s=r||e.prototype.calculateQueuedTime.call(this,o,a);return e.prototype.addQueueMeasurement.call(this,t,n,s,i)}}else this.logger.trace("BrowserPerformanceClient: correlationId for "+t+" not provided, unable to add queue measurement");else this.logger.trace("BrowserPerformanceClient: window performance API not available, unable to add queue measurement for "+t)},t}(Zu),Hl=function(){function e(e){this.isBrowserEnvironment="undefined"!==typeof window,this.config=function(e,t){var n=e.auth,r=e.cache,i=e.system,o=e.telemetry,a={clientId:ao.EMPTY_STRING,authority:""+ao.DEFAULT_AUTHORITY,knownAuthorities:[],cloudDiscoveryMetadata:ao.EMPTY_STRING,authorityMetadata:ao.EMPTY_STRING,redirectUri:ao.EMPTY_STRING,postLogoutRedirectUri:ao.EMPTY_STRING,navigateToLoginRequestUrl:!0,clientCapabilities:[],protocolMode:_c.AAD,azureCloudOptions:{azureCloudInstance:Pc.None,tenant:ao.EMPTY_STRING},skipAuthorityMetadataCache:!1},s={cacheLocation:Bo.SessionStorage,temporaryCacheLocation:Bo.SessionStorage,storeAuthStateInCookie:!1,secureCookies:!1,cacheMigrationEnabled:!(!r||r.cacheLocation!==Bo.LocalStorage),claimsBasedCachingEnabled:!0},u={loggerCallback:function(){},logLevel:Pu.Info,piiLoggingEnabled:!1},c=Ui(Ui({},Zc),{loggerOptions:u,networkClient:t?Kc.getBrowserNetworkClient():zc,navigationClient:new Wc,loadFrameTimeout:0,windowHashTimeout:(null===i||void 0===i?void 0:i.loadFrameTimeout)||6e4,iframeHashTimeout:(null===i||void 0===i?void 0:i.loadFrameTimeout)||Jc,navigateFrameWait:t&&Kc.detectIEOrEdge()?500:0,redirectNavigationTimeout:3e4,asyncPopups:!1,allowRedirectInIframe:!1,allowNativeBroker:!1,nativeBrokerHandshakeTimeout:(null===i||void 0===i?void 0:i.nativeBrokerHandshakeTimeout)||2e3,pollIntervalMilliseconds:aa,cryptoOptions:{useMsrCrypto:!1,entropy:void 0}}),l=Ui(Ui({},i),{loggerOptions:(null===i||void 0===i?void 0:i.loggerOptions)||u}),d={application:{appName:ao.EMPTY_STRING,appVersion:ao.EMPTY_STRING}};return{auth:Ui(Ui({},a),n),cache:Ui(Ui({},s),r),system:Ui(Ui({},c),l),telemetry:Ui(Ui({},d),o)}}(e,this.isBrowserEnvironment),this.initialized=!1,this.logger=new Fu(this.config.system.loggerOptions,Yc,Xc),this.networkClient=this.config.system.networkClient,this.navigationClient=this.config.system.navigationClient,this.redirectResponse=new Map,this.hybridAuthCodeResponses=new Map,this.performanceClient=this.isBrowserEnvironment?new Ul(this.config.auth.clientId,this.config.auth.authority,this.logger,Yc,Xc,this.config.telemetry.application,this.config.system.cryptoOptions):new Lu(this.config.auth.clientId,this.config.auth.authority,this.logger,Yc,Xc,this.config.telemetry.application),this.browserCrypto=this.isBrowserEnvironment?new Ou(this.logger,this.performanceClient,this.config.system.cryptoOptions):Bu,this.eventHandler=new el(this.logger,this.browserCrypto),this.browserStorage=this.isBrowserEnvironment?new Fc(this.config.auth.clientId,this.config.cache,this.browserCrypto,this.logger):function(e,t){var n={cacheLocation:Bo.MemoryStorage,temporaryCacheLocation:Bo.MemoryStorage,storeAuthStateInCookie:!1,secureCookies:!1,cacheMigrationEnabled:!1,claimsBasedCachingEnabled:!0};return new Fc(e,n,Bu,t)}(this.config.auth.clientId,this.logger);var t={cacheLocation:Bo.MemoryStorage,temporaryCacheLocation:Bo.MemoryStorage,storeAuthStateInCookie:!1,secureCookies:!1,cacheMigrationEnabled:!1,claimsBasedCachingEnabled:!0};this.nativeInternalStorage=new Fc(this.config.auth.clientId,t,this.browserCrypto,this.logger),this.tokenCache=new Ll(this.config,this.browserStorage,this.logger,this.browserCrypto),this.trackPageVisibilityWithMeasurement=this.trackPageVisibilityWithMeasurement.bind(this)}return e.prototype.initialize=function(){return zi(this,void 0,void 0,(function(){var e,t,n,r;return Vi(this,(function(i){switch(i.label){case 0:if(this.logger.trace("initialize called"),this.initialized)return this.logger.info("initialize has already been called, exiting early."),[2];if(e=this.config.system.allowNativeBroker,t=this.performanceClient.startMeasurement(qi.InitializeClientApplication),this.eventHandler.emitEvent(Qc.INITIALIZE_START),!e)return[3,4];i.label=1;case 1:return i.trys.push([1,3,,4]),n=this,[4,_l.createProvider(this.logger,this.config.system.nativeBrokerHandshakeTimeout,this.performanceClient)];case 2:return n.nativeExtensionProvider=i.sent(),[3,4];case 3:return r=i.sent(),this.logger.verbose(r),[3,4];case 4:return this.initialized=!0,this.eventHandler.emitEvent(Qc.INITIALIZE_END),t.endMeasurement({allowNativeBroker:e,success:!0}),[2]}}))}))},e.prototype.handleRedirectPromise=function(e){return zi(this,void 0,void 0,(function(){var t,n,r,i,o,a,s,u,c=this;return Vi(this,(function(l){return this.logger.verbose("handleRedirectPromise called"),Kc.blockNativeBrokerCalledBeforeInitialized(this.config.system.allowNativeBroker,this.initialized),t=this.getAllAccounts(),this.isBrowserEnvironment?(n=e||ao.EMPTY_STRING,"undefined"===typeof(r=this.redirectResponse.get(n))?(this.eventHandler.emitEvent(Qc.HANDLE_REDIRECT_START,Vo.Redirect),this.logger.verbose("handleRedirectPromise has been called for the first time, storing the promise"),i=this.browserStorage.getCachedNativeRequest(),o=void 0,i&&_l.isNativeAvailable(this.config,this.logger,this.nativeExtensionProvider)&&this.nativeExtensionProvider&&!e?(this.logger.trace("handleRedirectPromise - acquiring token from native platform"),a=new Rl(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,zo.handleRedirectPromise,this.performanceClient,this.nativeExtensionProvider,i.accountId,this.nativeInternalStorage,i.correlationId),o=a.handleRedirectPromise()):(this.logger.trace("handleRedirectPromise - acquiring token from web flow"),s=this.browserStorage.getTemporaryCache(jo.CORRELATION_ID,!0)||ao.EMPTY_STRING,u=this.createRedirectClient(s),o=u.handleRedirectPromise(e)),r=o.then((function(e){e&&(t.length<c.getAllAccounts().length?(c.eventHandler.emitEvent(Qc.LOGIN_SUCCESS,Vo.Redirect,e),c.logger.verbose("handleRedirectResponse returned result, login success")):(c.eventHandler.emitEvent(Qc.ACQUIRE_TOKEN_SUCCESS,Vo.Redirect,e),c.logger.verbose("handleRedirectResponse returned result, acquire token success")));return c.eventHandler.emitEvent(Qc.HANDLE_REDIRECT_END,Vo.Redirect),e})).catch((function(e){throw t.length>0?c.eventHandler.emitEvent(Qc.ACQUIRE_TOKEN_FAILURE,Vo.Redirect,null,e):c.eventHandler.emitEvent(Qc.LOGIN_FAILURE,Vo.Redirect,null,e),c.eventHandler.emitEvent(Qc.HANDLE_REDIRECT_END,Vo.Redirect),e})),this.redirectResponse.set(n,r)):this.logger.verbose("handleRedirectPromise has been called previously, returning the result from the first call"),[2,r]):(this.logger.verbose("handleRedirectPromise returns null, not browser environment"),[2,null])}))}))},e.prototype.acquireTokenRedirect=function(e){return zi(this,void 0,void 0,(function(){var t,n,r,i,o,a=this;return Vi(this,(function(s){return t=this.getRequestCorrelationId(e),this.logger.verbose("acquireTokenRedirect called",t),this.preflightBrowserEnvironmentCheck(Vo.Redirect),(n=this.getAllAccounts().length>0)?this.eventHandler.emitEvent(Qc.ACQUIRE_TOKEN_START,Vo.Redirect,e):this.eventHandler.emitEvent(Qc.LOGIN_START,Vo.Redirect,e),this.nativeExtensionProvider&&this.canUseNative(e)?(i=new Rl(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,zo.acquireTokenRedirect,this.performanceClient,this.nativeExtensionProvider,this.getNativeAccountId(e),this.nativeInternalStorage,e.correlationId),r=i.acquireTokenRedirect(e).catch((function(t){if(t instanceof El&&t.isFatal())return a.nativeExtensionProvider=void 0,a.createRedirectClient(e.correlationId).acquireToken(e);if(t instanceof ta)return a.logger.verbose("acquireTokenRedirect - Resolving interaction required error thrown by native broker by falling back to web flow"),a.createRedirectClient(e.correlationId).acquireToken(e);throw a.browserStorage.setInteractionInProgress(!1),t}))):(o=this.createRedirectClient(e.correlationId),r=o.acquireToken(e)),[2,r.catch((function(e){throw n?a.eventHandler.emitEvent(Qc.ACQUIRE_TOKEN_FAILURE,Vo.Redirect,null,e):a.eventHandler.emitEvent(Qc.LOGIN_FAILURE,Vo.Redirect,null,e),e}))]}))}))},e.prototype.acquireTokenPopup=function(e){var t=this,n=this.getRequestCorrelationId(e),r=this.performanceClient.startMeasurement(qi.AcquireTokenPopup,n);try{this.logger.verbose("acquireTokenPopup called",n),this.preflightBrowserEnvironmentCheck(Vo.Popup)}catch(Oi){return Promise.reject(Oi)}var i,o=this.getAllAccounts();(o.length>0?this.eventHandler.emitEvent(Qc.ACQUIRE_TOKEN_START,Vo.Popup,e):this.eventHandler.emitEvent(Qc.LOGIN_START,Vo.Popup,e),this.canUseNative(e))?i=this.acquireTokenNative(e,zo.acquireTokenPopup).then((function(e){return t.browserStorage.setInteractionInProgress(!1),r.endMeasurement({success:!0,isNativeBroker:!0,requestId:e.requestId}),e})).catch((function(n){if(n instanceof El&&n.isFatal())return t.nativeExtensionProvider=void 0,t.createPopupClient(e.correlationId).acquireToken(e);if(n instanceof ta)return t.logger.verbose("acquireTokenPopup - Resolving interaction required error thrown by native broker by falling back to web flow"),t.createPopupClient(e.correlationId).acquireToken(e);throw t.browserStorage.setInteractionInProgress(!1),n})):i=this.createPopupClient(e.correlationId).acquireToken(e);return i.then((function(e){return o.length<t.getAllAccounts().length?t.eventHandler.emitEvent(Qc.LOGIN_SUCCESS,Vo.Popup,e):t.eventHandler.emitEvent(Qc.ACQUIRE_TOKEN_SUCCESS,Vo.Popup,e),r.addStaticFields({accessTokenSize:e.accessToken.length,idTokenSize:e.idToken.length}),r.endMeasurement({success:!0,requestId:e.requestId}),e})).catch((function(e){return o.length>0?t.eventHandler.emitEvent(Qc.ACQUIRE_TOKEN_FAILURE,Vo.Popup,null,e):t.eventHandler.emitEvent(Qc.LOGIN_FAILURE,Vo.Popup,null,e),r.endMeasurement({errorCode:e.errorCode,subErrorCode:e.subError,success:!1}),Promise.reject(e)}))},e.prototype.trackPageVisibilityWithMeasurement=function(){var e=this.ssoSilentMeasurement||this.acquireTokenByCodeAsyncMeasurement;e&&(this.logger.info("Perf: Visibility change detected in ",e.event.name),e.increment({visibilityChangeCount:1}))},e.prototype.ssoSilent=function(e){var t;return zi(this,void 0,void 0,(function(){var n,r,i,o,a=this;return Vi(this,(function(s){return n=this.getRequestCorrelationId(e),r=Ui(Ui({},e),{prompt:e.prompt,correlationId:n}),this.preflightBrowserEnvironmentCheck(Vo.Silent),this.ssoSilentMeasurement=this.performanceClient.startMeasurement(qi.SsoSilent,n),null===(t=this.ssoSilentMeasurement)||void 0===t||t.increment({visibilityChangeCount:0}),document.addEventListener("visibilitychange",this.trackPageVisibilityWithMeasurement),this.logger.verbose("ssoSilent called",n),this.eventHandler.emitEvent(Qc.SSO_SILENT_START,Vo.Silent,r),this.canUseNative(r)?i=this.acquireTokenNative(r,zo.ssoSilent).catch((function(e){if(e instanceof El&&e.isFatal())return a.nativeExtensionProvider=void 0,a.createSilentIframeClient(r.correlationId).acquireToken(r);throw e})):(o=this.createSilentIframeClient(r.correlationId),i=o.acquireToken(r)),[2,i.then((function(e){var t,n;return a.eventHandler.emitEvent(Qc.SSO_SILENT_SUCCESS,Vo.Silent,e),null===(t=a.ssoSilentMeasurement)||void 0===t||t.addStaticFields({accessTokenSize:e.accessToken.length,idTokenSize:e.idToken.length}),null===(n=a.ssoSilentMeasurement)||void 0===n||n.endMeasurement({success:!0,isNativeBroker:e.fromNativeBroker,requestId:e.requestId}),e})).catch((function(e){var t;throw a.eventHandler.emitEvent(Qc.SSO_SILENT_FAILURE,Vo.Silent,null,e),null===(t=a.ssoSilentMeasurement)||void 0===t||t.endMeasurement({errorCode:e.errorCode,subErrorCode:e.subError,success:!1}),e})).finally((function(){document.removeEventListener("visibilitychange",a.trackPageVisibilityWithMeasurement)}))]}))}))},e.prototype.acquireTokenByCode=function(e){return zi(this,void 0,void 0,(function(){var t,n,r,i,o=this;return Vi(this,(function(a){t=this.getRequestCorrelationId(e),this.preflightBrowserEnvironmentCheck(Vo.Silent),this.logger.trace("acquireTokenByCode called",t),this.eventHandler.emitEvent(Qc.ACQUIRE_TOKEN_BY_CODE_START,Vo.Silent,e),n=this.performanceClient.startMeasurement(qi.AcquireTokenByCode,e.correlationId);try{if(e.code&&e.nativeAccountId)throw hu.createSpaCodeAndNativeAccountIdPresentError();if(e.code)return r=e.code,(i=this.hybridAuthCodeResponses.get(r))?(this.logger.verbose("Existing acquireTokenByCode request found",e.correlationId),n.discardMeasurement()):(this.logger.verbose("Initiating new acquireTokenByCode request",t),i=this.acquireTokenByCodeAsync(Ui(Ui({},e),{correlationId:t})).then((function(e){return o.eventHandler.emitEvent(Qc.ACQUIRE_TOKEN_BY_CODE_SUCCESS,Vo.Silent,e),o.hybridAuthCodeResponses.delete(r),n.addStaticFields({accessTokenSize:e.accessToken.length,idTokenSize:e.idToken.length}),n.endMeasurement({success:!0,isNativeBroker:e.fromNativeBroker,requestId:e.requestId}),e})).catch((function(e){throw o.hybridAuthCodeResponses.delete(r),o.eventHandler.emitEvent(Qc.ACQUIRE_TOKEN_BY_CODE_FAILURE,Vo.Silent,null,e),n.endMeasurement({errorCode:e.errorCode,subErrorCode:e.subError,success:!1}),e})),this.hybridAuthCodeResponses.set(r,i)),[2,i];if(e.nativeAccountId){if(this.canUseNative(e,e.nativeAccountId))return[2,this.acquireTokenNative(e,zo.acquireTokenByCode,e.nativeAccountId).catch((function(e){throw e instanceof El&&e.isFatal()&&(o.nativeExtensionProvider=void 0),e}))];throw hu.createUnableToAcquireTokenFromNativePlatformError()}throw hu.createAuthCodeOrNativeAccountIdRequiredError()}catch(Oi){throw this.eventHandler.emitEvent(Qc.ACQUIRE_TOKEN_BY_CODE_FAILURE,Vo.Silent,null,Oi),n.endMeasurement({errorCode:Oi instanceof Jo&&Oi.errorCode||void 0,subErrorCode:Oi instanceof Jo&&Oi.subError||void 0,success:!1}),Oi}return[2]}))}))},e.prototype.acquireTokenByCodeAsync=function(e){var t;return zi(this,void 0,void 0,(function(){var n=this;return Vi(this,(function(r){switch(r.label){case 0:return this.logger.trace("acquireTokenByCodeAsync called",e.correlationId),this.acquireTokenByCodeAsyncMeasurement=this.performanceClient.startMeasurement(qi.AcquireTokenByCodeAsync,e.correlationId),null===(t=this.acquireTokenByCodeAsyncMeasurement)||void 0===t||t.increment({visibilityChangeCount:0}),document.addEventListener("visibilitychange",this.trackPageVisibilityWithMeasurement),[4,this.createSilentAuthCodeClient(e.correlationId).acquireToken(e).then((function(e){var t;return null===(t=n.acquireTokenByCodeAsyncMeasurement)||void 0===t||t.endMeasurement({success:!0,fromCache:e.fromCache,isNativeBroker:e.fromNativeBroker,requestId:e.requestId}),e})).catch((function(e){var t;throw null===(t=n.acquireTokenByCodeAsyncMeasurement)||void 0===t||t.endMeasurement({errorCode:e.errorCode,subErrorCode:e.subError,success:!1}),e})).finally((function(){document.removeEventListener("visibilitychange",n.trackPageVisibilityWithMeasurement)}))];case 1:return[2,r.sent()]}}))}))},e.prototype.acquireTokenFromCache=function(e,t,n){return zi(this,void 0,void 0,(function(){return Vi(this,(function(r){switch(this.performanceClient.addQueueMeasurement(qi.AcquireTokenFromCache,t.correlationId),n.cacheLookupPolicy){case pa.Default:case pa.AccessToken:case pa.AccessTokenAndRefreshToken:return[2,e.acquireToken(t)];default:throw bs.createRefreshRequiredError()}return[2]}))}))},e.prototype.acquireTokenByRefreshToken=function(e,t){return zi(this,void 0,void 0,(function(){var n;return Vi(this,(function(r){switch(this.performanceClient.addQueueMeasurement(qi.AcquireTokenByRefreshToken,e.correlationId),t.cacheLookupPolicy){case pa.Default:case pa.AccessTokenAndRefreshToken:case pa.RefreshToken:case pa.RefreshTokenAndNetwork:return n=this.createSilentRefreshClient(e.correlationId),this.performanceClient.setPreQueueTime(qi.SilentRefreshClientAcquireToken,e.correlationId),[2,n.acquireToken(e)];default:throw bs.createRefreshRequiredError()}return[2]}))}))},e.prototype.acquireTokenBySilentIframe=function(e){return zi(this,void 0,void 0,(function(){var t;return Vi(this,(function(n){return this.performanceClient.addQueueMeasurement(qi.AcquireTokenBySilentIframe,e.correlationId),t=this.createSilentIframeClient(e.correlationId),this.performanceClient.setPreQueueTime(qi.SilentIframeClientAcquireToken,e.correlationId),[2,t.acquireToken(e)]}))}))},e.prototype.logout=function(e){return zi(this,void 0,void 0,(function(){var t;return Vi(this,(function(n){return t=this.getRequestCorrelationId(e),this.logger.warning("logout API is deprecated and will be removed in msal-browser v3.0.0. Use logoutRedirect instead.",t),[2,this.logoutRedirect(Ui({correlationId:t},e))]}))}))},e.prototype.logoutRedirect=function(e){return zi(this,void 0,void 0,(function(){var t;return Vi(this,(function(n){return t=this.getRequestCorrelationId(e),this.preflightBrowserEnvironmentCheck(Vo.Redirect),[2,this.createRedirectClient(t).logout(e)]}))}))},e.prototype.logoutPopup=function(e){try{var t=this.getRequestCorrelationId(e);return this.preflightBrowserEnvironmentCheck(Vo.Popup),this.createPopupClient(t).logout(e)}catch(Oi){return Promise.reject(Oi)}},e.prototype.getAllAccounts=function(){return this.logger.verbose("getAllAccounts called"),this.isBrowserEnvironment?this.browserStorage.getAllAccounts():[]},e.prototype.getAccountByUsername=function(e){if(this.logger.trace("getAccountByUsername called"),!e)return this.logger.warning("getAccountByUsername: No username provided"),null;var t=this.browserStorage.getAccountInfoFilteredBy({username:e});return t?(this.logger.verbose("getAccountByUsername: Account matching username found, returning"),this.logger.verbosePii("getAccountByUsername: Returning signed-in accounts matching username: "+e),t):(this.logger.verbose("getAccountByUsername: No matching account found, returning null"),null)},e.prototype.getAccountByHomeId=function(e){if(this.logger.trace("getAccountByHomeId called"),!e)return this.logger.warning("getAccountByHomeId: No homeAccountId provided"),null;var t=this.browserStorage.getAccountInfoFilteredBy({homeAccountId:e});return t?(this.logger.verbose("getAccountByHomeId: Account matching homeAccountId found, returning"),this.logger.verbosePii("getAccountByHomeId: Returning signed-in accounts matching homeAccountId: "+e),t):(this.logger.verbose("getAccountByHomeId: No matching account found, returning null"),null)},e.prototype.getAccountByLocalId=function(e){if(this.logger.trace("getAccountByLocalId called"),!e)return this.logger.warning("getAccountByLocalId: No localAccountId provided"),null;var t=this.browserStorage.getAccountInfoFilteredBy({localAccountId:e});return t?(this.logger.verbose("getAccountByLocalId: Account matching localAccountId found, returning"),this.logger.verbosePii("getAccountByLocalId: Returning signed-in accounts matching localAccountId: "+e),t):(this.logger.verbose("getAccountByLocalId: No matching account found, returning null"),null)},e.prototype.setActiveAccount=function(e){this.browserStorage.setActiveAccount(e)},e.prototype.getActiveAccount=function(){return this.browserStorage.getActiveAccount()},e.prototype.preflightBrowserEnvironmentCheck=function(e,t){if(void 0===t&&(t=!0),this.logger.verbose("preflightBrowserEnvironmentCheck started"),Kc.blockNonBrowserEnvironment(this.isBrowserEnvironment),Kc.blockRedirectInIframe(e,this.config.system.allowRedirectInIframe),Kc.blockReloadInHiddenIframes(),Kc.blockAcquireTokenInPopups(),Kc.blockNativeBrokerCalledBeforeInitialized(this.config.system.allowNativeBroker,this.initialized),e===Vo.Redirect&&this.config.cache.cacheLocation===Bo.MemoryStorage&&!this.config.cache.storeAuthStateInCookie)throw xu.createInMemoryRedirectUnavailableError();e!==Vo.Redirect&&e!==Vo.Popup||this.preflightInteractiveRequest(t)},e.prototype.preflightInteractiveRequest=function(e){this.logger.verbose("preflightInteractiveRequest called, validating app environment"),Kc.blockReloadInHiddenIframes(),e&&this.browserStorage.setInteractionInProgress(!0)},e.prototype.acquireTokenNative=function(e,t,n){return zi(this,void 0,void 0,(function(){return Vi(this,(function(r){if(this.logger.trace("acquireTokenNative called"),!this.nativeExtensionProvider)throw hu.createNativeConnectionNotEstablishedError();return[2,new Rl(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,t,this.performanceClient,this.nativeExtensionProvider,n||this.getNativeAccountId(e),this.nativeInternalStorage,e.correlationId).acquireToken(e)]}))}))},e.prototype.canUseNative=function(e,t){if(this.logger.trace("canUseNative called"),!_l.isNativeAvailable(this.config,this.logger,this.nativeExtensionProvider,e.authenticationScheme))return this.logger.trace("canUseNative: isNativeAvailable returned false, returning false"),!1;if(e.prompt)switch(e.prompt){case lo.NONE:case lo.CONSENT:case lo.LOGIN:this.logger.trace("canUseNative: prompt is compatible with native flow");break;default:return this.logger.trace("canUseNative: prompt = "+e.prompt+" is not compatible with native flow, returning false"),!1}return!(!t&&!this.getNativeAccountId(e))||(this.logger.trace("canUseNative: nativeAccountId is not available, returning false"),!1)},e.prototype.getNativeAccountId=function(e){var t=e.account||this.browserStorage.getAccountInfoByHints(e.loginHint,e.sid)||this.getActiveAccount();return t&&t.nativeAccountId||""},e.prototype.createPopupClient=function(e){return new Nl(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,this.performanceClient,this.nativeInternalStorage,this.nativeExtensionProvider,e)},e.prototype.createRedirectClient=function(e){return new Ml(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,this.performanceClient,this.nativeInternalStorage,this.nativeExtensionProvider,e)},e.prototype.createSilentIframeClient=function(e){return new Zl(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,zo.ssoSilent,this.performanceClient,this.nativeInternalStorage,this.nativeExtensionProvider,e)},e.prototype.createSilentCacheClient=function(e){return new Al(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,this.performanceClient,this.nativeExtensionProvider,e)},e.prototype.createSilentRefreshClient=function(e){return new Dl(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,this.performanceClient,this.nativeExtensionProvider,e)},e.prototype.createSilentAuthCodeClient=function(e){return new ql(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,zo.acquireTokenByCode,this.performanceClient,this.nativeExtensionProvider,e)},e.prototype.addEventCallback=function(e){return this.eventHandler.addEventCallback(e)},e.prototype.removeEventCallback=function(e){this.eventHandler.removeEventCallback(e)},e.prototype.addPerformanceCallback=function(e){return this.performanceClient.addPerformanceCallback(e)},e.prototype.removePerformanceCallback=function(e){return this.performanceClient.removePerformanceCallback(e)},e.prototype.enableAccountStorageEvents=function(){this.eventHandler.enableAccountStorageEvents()},e.prototype.disableAccountStorageEvents=function(){this.eventHandler.disableAccountStorageEvents()},e.prototype.getTokenCache=function(){return this.tokenCache},e.prototype.getLogger=function(){return this.logger},e.prototype.setLogger=function(e){this.logger=e},e.prototype.initializeWrapperLibrary=function(e,t){this.browserStorage.setWrapperMetadata(e,t)},e.prototype.setNavigationClient=function(e){this.navigationClient=e},e.prototype.getConfiguration=function(){return this.config},e.prototype.getRequestCorrelationId=function(e){return(null===e||void 0===e?void 0:e.correlationId)?e.correlationId:this.isBrowserEnvironment?this.browserCrypto.createNewGuid():ao.EMPTY_STRING},e}(),zl=function(e){function t(t){var n=e.call(this,t)||this;return n.astsAsyncMeasurement=void 0,n.activeSilentTokenRequests=new Map,n.trackPageVisibility=n.trackPageVisibility.bind(n),n}return Bi(t,e),t.prototype.loginRedirect=function(e){return zi(this,void 0,void 0,(function(){var t;return Vi(this,(function(n){return t=this.getRequestCorrelationId(e),this.logger.verbose("loginRedirect called",t),[2,this.acquireTokenRedirect(Ui({correlationId:t},e||ha))]}))}))},t.prototype.loginPopup=function(e){var t=this.getRequestCorrelationId(e);return this.logger.verbose("loginPopup called",t),this.acquireTokenPopup(Ui({correlationId:t},e||ha))},t.prototype.acquireTokenSilent=function(e){return zi(this,void 0,void 0,(function(){var t,n,r,i,o,a,s,u=this;return Vi(this,(function(c){if(t=this.getRequestCorrelationId(e),(n=this.performanceClient.startMeasurement(qi.AcquireTokenSilent,t)).addStaticFields({cacheLookupPolicy:e.cacheLookupPolicy}),this.preflightBrowserEnvironmentCheck(Vo.Silent),this.logger.verbose("acquireTokenSilent called",t),!(r=e.account||this.getActiveAccount()))throw hu.createNoAccountError();return i={clientId:this.config.auth.clientId,authority:e.authority||ao.EMPTY_STRING,scopes:e.scopes,homeAccountIdentifier:r.homeAccountId,claims:e.claims,authenticationScheme:e.authenticationScheme,resourceRequestMethod:e.resourceRequestMethod,resourceRequestUri:e.resourceRequestUri,shrClaims:e.shrClaims,sshKid:e.sshKid},o=JSON.stringify(i),"undefined"===typeof(a=this.activeSilentTokenRequests.get(o))?(this.logger.verbose("acquireTokenSilent called for the first time, storing active request",t),this.performanceClient.setPreQueueTime(qi.AcquireTokenSilentAsync,t),s=this.acquireTokenSilentAsync(Ui(Ui({},e),{correlationId:t}),r).then((function(t){return u.activeSilentTokenRequests.delete(o),n.addStaticFields({accessTokenSize:t.accessToken.length,idTokenSize:t.idToken.length}),n.endMeasurement({success:!0,fromCache:t.fromCache,isNativeBroker:t.fromNativeBroker,cacheLookupPolicy:e.cacheLookupPolicy,requestId:t.requestId}),t})).catch((function(e){throw u.activeSilentTokenRequests.delete(o),n.endMeasurement({errorCode:e.errorCode,subErrorCode:e.subError,success:!1}),e})),this.activeSilentTokenRequests.set(o,s),[2,s]):(this.logger.verbose("acquireTokenSilent has been called previously, returning the result from the first call",t),n.discardMeasurement(),[2,a])}))}))},t.prototype.trackPageVisibility=function(){this.astsAsyncMeasurement&&(this.logger.info("Perf: Visibility change detected"),this.astsAsyncMeasurement.increment({visibilityChangeCount:1}))},t.prototype.acquireTokenSilentAsync=function(e,t){var n;return zi(this,void 0,void 0,(function(){var r,i,o,a,s,u=this;return Vi(this,(function(c){switch(c.label){case 0:return this.performanceClient.addQueueMeasurement(qi.AcquireTokenSilentAsync,e.correlationId),this.eventHandler.emitEvent(Qc.ACQUIRE_TOKEN_START,Vo.Silent,e),this.astsAsyncMeasurement=this.performanceClient.startMeasurement(qi.AcquireTokenSilentAsync,e.correlationId),null===(n=this.astsAsyncMeasurement)||void 0===n||n.increment({visibilityChangeCount:0}),document.addEventListener("visibilitychange",this.trackPageVisibility),_l.isNativeAvailable(this.config,this.logger,this.nativeExtensionProvider,e.authenticationScheme)&&t.nativeAccountId?(this.logger.verbose("acquireTokenSilent - attempting to acquire token from native platform"),i=Ui(Ui({},e),{account:t}),r=this.acquireTokenNative(i,zo.acquireTokenSilent_silentFlow).catch((function(t){return zi(u,void 0,void 0,(function(){return Vi(this,(function(n){if(t instanceof El&&t.isFatal())return this.logger.verbose("acquireTokenSilent - native platform unavailable, falling back to web flow"),this.nativeExtensionProvider=void 0,[2,this.createSilentIframeClient(e.correlationId).acquireToken(e)];throw t}))}))})),[3,3]):[3,1];case 1:return this.logger.verbose("acquireTokenSilent - attempting to acquire token from web flow"),o=this.createSilentCacheClient(e.correlationId),this.performanceClient.setPreQueueTime(qi.InitializeSilentRequest,e.correlationId),[4,o.initializeSilentRequest(e,t)];case 2:a=c.sent(),s=Ui(Ui({},e),{cacheLookupPolicy:e.cacheLookupPolicy||pa.Default}),this.performanceClient.setPreQueueTime(qi.AcquireTokenFromCache,a.correlationId),r=this.acquireTokenFromCache(o,a,s).catch((function(t){if(s.cacheLookupPolicy===pa.AccessToken)throw t;return Kc.blockReloadInHiddenIframes(),u.eventHandler.emitEvent(Qc.ACQUIRE_TOKEN_NETWORK_START,Vo.Silent,a),u.performanceClient.setPreQueueTime(qi.AcquireTokenByRefreshToken,a.correlationId),u.acquireTokenByRefreshToken(a,s).catch((function(t){var n=t instanceof Qo,r=t instanceof ta,i=t.errorCode===$o.code,o=t.errorCode===na;if((!n||!o||r||s.cacheLookupPolicy===pa.AccessTokenAndRefreshToken||s.cacheLookupPolicy===pa.RefreshToken)&&s.cacheLookupPolicy!==pa.Skip&&!i)throw t;return u.logger.verbose("Refresh token expired/invalid or CacheLookupPolicy is set to Skip, attempting acquire token by iframe.",e.correlationId),u.performanceClient.setPreQueueTime(qi.AcquireTokenBySilentIframe,a.correlationId),u.acquireTokenBySilentIframe(a)}))})),c.label=3;case 3:return[2,r.then((function(e){var t;return u.eventHandler.emitEvent(Qc.ACQUIRE_TOKEN_SUCCESS,Vo.Silent,e),null===(t=u.astsAsyncMeasurement)||void 0===t||t.endMeasurement({success:!0,fromCache:e.fromCache,isNativeBroker:e.fromNativeBroker,requestId:e.requestId}),e})).catch((function(e){var t;throw u.eventHandler.emitEvent(Qc.ACQUIRE_TOKEN_FAILURE,Vo.Silent,null,e),null===(t=u.astsAsyncMeasurement)||void 0===t||t.endMeasurement({errorCode:e.errorCode,subErrorCode:e.subError,success:!1}),e})).finally((function(){document.removeEventListener("visibilitychange",u.trackPageVisibility)}))]}}))}))},t}(Hl);!function(e){e.GET="GET",e.PATCH="PATCH",e.POST="POST",e.PUT="PUT",e.DELETE="DELETE"}(Sl||(Sl={})),(function(){function e(t){if((0,Y.Z)(this,e),this.requests=new Map,"undefined"!==typeof t){var n=e.requestLimit;if(t.length>n){var r=new Error("Maximum requests limit exceeded, Max allowed number of requests are ".concat(n));throw r.name="Limit Exceeded Error",r}var i,o=(0,pe.Z)(t);try{for(o.s();!(i=o.n()).done;){var a=i.value;this.addRequest(a)}}catch(s){o.e(s)}finally{o.f()}}}return(0,X.Z)(e,[{key:"addRequest",value:function(t){var n=e.requestLimit;if(""===t.id){var r=new Error("Id for a request is empty, Please provide an unique id");throw r.name="Empty Id For Request",r}if(this.requests.size===n){var i=new Error("Maximum requests limit exceeded, Max allowed number of requests are ".concat(n));throw i.name="Limit Exceeded Error",i}if(this.requests.has(t.id)){var o=new Error("Adding request with duplicate id ".concat(t.id,", Make the id of the requests unique"));throw o.name="Duplicate RequestId Error",o}return this.requests.set(t.id,t),t.id}},{key:"removeRequest",value:function(e){for(var t=this.requests.delete(e),n=this.requests.entries(),r=n.next();!r.done;){var i=r.value[1].dependsOn;if("undefined"!==typeof i){var o=i.indexOf(e);-1!==o&&i.splice(o,1),0===i.length&&delete r.value[1].dependsOn}r=n.next()}return t}},{key:"getContent",value:function(){return Ii(this,void 0,void 0,(0,Ri.Z)().mark((function t(){var n,r,i,o,a,s,u,c,l;return(0,Ri.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r={requests:n=[]},i=this.requests.entries(),!(o=i.next()).done){t.next=8;break}throw(a=new Error("No requests added yet, Please add at least one request.")).name="Empty Payload",a;case 8:if(e.validateDependencies(this.requests)){t.next=12;break}throw(s=new Error("Invalid dependency found, Dependency should be:\n1. Parallel - no individual request states a dependency in the dependsOn property.\n2. Serial - all individual requests depend on the previous individual request.\n3. Same - all individual requests that state a dependency in the dependsOn property, state the same dependency.")).name="Invalid Dependency",s;case 12:if(o.done){t.next=27;break}return u=o.value[1],t.next=16,e.getRequestData(u.request);case 16:if(void 0===(c=t.sent).body||void 0!==c.headers&&void 0!==c.headers["content-type"]){t.next=21;break}throw(l=new Error("Content-type header is not mentioned for request #".concat(u.id,", For request having body, Content-type header should be mentioned"))).name="Invalid Content-type header",l;case 21:c.id=u.id,void 0!==u.dependsOn&&u.dependsOn.length>0&&(c.dependsOn=u.dependsOn),n.push(c),o=i.next(),t.next=12;break;case 27:return r.requests=n,t.abrupt("return",r);case 29:case"end":return t.stop()}}),t,this)})))}},{key:"addDependency",value:function(e,t){if(!this.requests.has(e)){var n=new Error("Dependent ".concat(e," does not exists, Please check the id"));throw n.name="Invalid Dependent",n}if("undefined"!==typeof t&&!this.requests.has(t)){var r=new Error("Dependency ".concat(t," does not exists, Please check the id"));throw r.name="Invalid Dependency",r}if("undefined"!==typeof t){var i=this.requests.get(e);if(void 0===i.dependsOn&&(i.dependsOn=[]),-1!==i.dependsOn.indexOf(t)){var o=new Error("Dependency ".concat(t," is already added for the request ").concat(e));throw o.name="Duplicate Dependency",o}i.dependsOn.push(t)}else{for(var a,s=this.requests.entries(),u=s.next();!u.done&&u.value[1].id!==e;)a=u,u=s.next();if("undefined"===typeof a){var c=new Error("Can't add dependency ".concat(t,", There is only a dependent request in the batch"));throw c.name="Invalid Dependency Addition",c}var l=a.value[0];if(void 0===u.value[1].dependsOn&&(u.value[1].dependsOn=[]),-1!==u.value[1].dependsOn.indexOf(l)){var d=new Error("Dependency ".concat(l," is already added for the request ").concat(e));throw d.name="Duplicate Dependency",d}u.value[1].dependsOn.push(l)}}},{key:"removeDependency",value:function(e,t){var n=this.requests.get(e);if("undefined"===typeof n||void 0===n.dependsOn||0===n.dependsOn.length)return!1;if("undefined"!==typeof t){var r=n.dependsOn.indexOf(t);return-1!==r&&(n.dependsOn.splice(r,1),!0)}return delete n.dependsOn,!0}}],[{key:"validateDependencies",value:function(e){if(0===e.size){var t=new Error("Empty requests map, Please provide at least one request.");throw t.name="Empty Requests Error",t}return function(e){for(var t=e.entries(),n=t.next();!n.done;){var r=n.value[1];if(void 0!==r.dependsOn&&r.dependsOn.length>0)return!1;n=t.next()}return!0}(e)||function(e){var t=e.entries(),n=t.next(),r=n.value[1];if(void 0!==r.dependsOn&&r.dependsOn.length>0)return!1;var i=n;for(n=t.next();!n.done;){var o=n.value[1];if(void 0===o.dependsOn||1!==o.dependsOn.length||o.dependsOn[0]!==i.value[1].id)return!1;i=n,n=t.next()}return!0}(e)||function(e){var t,n=e.entries(),r=n.next(),i=r.value[1];if(void 0===i.dependsOn||0===i.dependsOn.length)t=i.id;else{if(1!==i.dependsOn.length)return!1;var o=i.dependsOn[0];if(o===i.id||!e.has(o))return!1;t=o}for(r=n.next();!r.done;){var a=r.value[1];if((void 0===a.dependsOn||0===a.dependsOn.length)&&t!==a.id)return!1;if(void 0!==a.dependsOn&&0!==a.dependsOn.length){if(1===a.dependsOn.length&&(a.id===t||a.dependsOn[0]!==t))return!1;if(a.dependsOn.length>1)return!1}r=n.next()}return!0}(e)}},{key:"getRequestData",value:function(t){return Ii(this,void 0,void 0,(0,Ri.Z)().mark((function n(){var r,i,o;return(0,Ri.Z)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(r={url:""},i=new RegExp("^https?://"),r.url=i.test(t.url)?"/"+t.url.split(/.*?\/\/.*?\//)[1]:t.url,r.method=t.method,o={},t.headers.forEach((function(e,t){o[t]=e})),Object.keys(o).length&&(r.headers=o),t.method!==Sl.PATCH&&t.method!==Sl.POST&&t.method!==Sl.PUT){n.next=11;break}return n.next=10,e.getRequestBody(t);case 10:r.body=n.sent;case 11:return n.abrupt("return",r);case 12:case"end":return n.stop()}}),n)})))}},{key:"getRequestBody",value:function(e){return Ii(this,void 0,void 0,(0,Ri.Z)().mark((function t(){var n,r,i,o,a,s;return(0,Ri.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=!1,t.prev=1,i=e.clone(),t.next=5,i.json();case 5:r=t.sent,n=!0,t.next=11;break;case 9:t.prev=9,t.t0=t.catch(1);case 11:if(n){t.next=33;break}if(t.prev=12,"undefined"===typeof Blob){t.next=23;break}return t.next=16,e.blob();case 16:return o=t.sent,a=new FileReader,t.next=20,new Promise((function(e){a.addEventListener("load",(function(){var t=a.result,n=new RegExp("^s*data:(.+?/.+?(;.+?=.+?)*)?(;base64)?,(.*)s*$").exec(t);e(n[4])}),!1),a.readAsDataURL(o)}));case 20:r=t.sent,t.next=28;break;case 23:if("undefined"===typeof Buffer){t.next=28;break}return t.next=26,e.buffer();case 26:s=t.sent,r=s.toString("base64");case 28:n=!0,t.next=33;break;case 31:t.prev=31,t.t1=t.catch(12);case 33:return t.abrupt("return",r);case 34:case"end":return t.stop()}}),t,null,[[1,9],[12,31]])})))}}]),e}()).requestLimit=20;var Vl,Gl=new Set(["graph.microsoft.com","graph.microsoft.us","dod-graph.microsoft.us","graph.microsoft.de","microsoftgraph.chinacloudapi.cn","canary.graph.microsoft.com"]),Kl=function(e){(0,nr.Z)(n,e);var t=(0,rr.Z)(n);function n(e){var r;return(0,Y.Z)(this,n),r=t.call(this,e),Object.setPrototypeOf((0,Ni.Z)(r),n.prototype),r}return(0,X.Z)(n,null,[{key:"setGraphClientError",value:function(e){var t;return e instanceof Error?t=e:(t=new n).customError=e,t}}]),n}((0,ir.Z)(Error)),Wl=function(e){return Ql(e)},Jl=function(e,t){return t.forEach((function(e){return Yl(e)})),Ql(e,t)},Ql=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Gl;if(-1!==(e=e.toLowerCase()).indexOf("https://")){var n=(e=e.replace("https://","")).indexOf(":"),r=e.indexOf("/"),i="";if(-1!==r)return-1!==n&&n<r?(i=e.substring(0,n),t.has(i)):(i=e.substring(0,r),t.has(i))}return!1},Yl=function(e){if(-1!==e.indexOf("/"))throw new Kl("Please add only hosts or hostnames to the CustomHosts config. If the url is `http://example.com:3000/`, host is `example:3000`")},Xl=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];(0,Y.Z)(this,e),this.middlewareOptions=new Map;var n,r=(0,pe.Z)(t);try{for(r.s();!(n=r.n()).done;){var i=n.value,o=i.constructor;this.middlewareOptions.set(o,i)}}catch(a){r.e(a)}finally{r.f()}}return(0,X.Z)(e,[{key:"getMiddlewareOptions",value:function(e){return this.middlewareOptions.get(e)}},{key:"setMiddlewareOptions",value:function(e,t){this.middlewareOptions.set(e,t)}}]),e}(),$l=function(){for(var e="",t=0;t<32;t++)8!==t&&12!==t&&16!==t&&20!==t||(e+="-"),e+=Math.floor(16*Math.random()).toString(16);return e},ed=function(e,t,n){var r=null;if("undefined"!==typeof Request&&e instanceof Request)r=e.headers.get(n);else if("undefined"!==typeof t&&void 0!==t.headers)if("undefined"!==typeof Headers&&t.headers instanceof Headers)r=t.headers.get(n);else if(t.headers instanceof Array){for(var i=t.headers,o=0,a=i.length;o<a;o++)if(i[o][0]===n){r=i[o][1];break}}else void 0!==t.headers[n]&&(r=t.headers[n]);return r},td=function(e,t,n,r){if("undefined"!==typeof Request&&e instanceof Request)e.headers.set(n,r);else if("undefined"!==typeof t)if(void 0===t.headers)t.headers=new Headers((0,i.Z)({},n,r));else if("undefined"!==typeof Headers&&t.headers instanceof Headers)t.headers.set(n,r);else if(t.headers instanceof Array){for(var o=0,a=t.headers.length;o<a;o++){var s=t.headers[o];if(s[0]===n){s[1]=r;break}}o===a&&t.headers.push([n,r])}else Object.assign(t.headers,(0,i.Z)({},n,r))},nd=function(e,t,n,r){"undefined"!==typeof Request&&e instanceof Request?e.headers.append(n,r):"undefined"!==typeof t&&(void 0===t.headers?t.headers=new Headers((0,i.Z)({},n,r)):"undefined"!==typeof Headers&&t.headers instanceof Headers?t.headers.append(n,r):t.headers instanceof Array?t.headers.push([n,r]):void 0===t.headers?t.headers=(0,i.Z)({},n,r):void 0===t.headers[n]?t.headers[n]=r:t.headers[n]+=", ".concat(r))},rd=function(e,t){return Ii(void 0,void 0,void 0,(0,Ri.Z)().mark((function n(){var r,i,o,a,s,u,c,l,d,h,f,p;return(0,Ri.Z)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(!t.headers.get("Content-Type")){n.next=6;break}return n.next=3,t.blob();case 3:n.t0=n.sent,n.next=9;break;case 6:return n.next=8,Promise.resolve(void 0);case 8:n.t0=n.sent;case 9:return r=n.t0,i=t.method,o=t.headers,a=t.referrer,s=t.referrerPolicy,u=t.mode,c=t.credentials,l=t.cache,d=t.redirect,h=t.integrity,f=t.keepalive,p=t.signal,n.abrupt("return",new Request(e,{method:i,headers:o,body:r,referrer:a,referrerPolicy:s,mode:u,credentials:c,cache:l,redirect:d,integrity:h,keepalive:f,signal:p}));case 12:case"end":return n.stop()}}),n)})))},id=(0,X.Z)((function e(t,n){(0,Y.Z)(this,e),this.authenticationProvider=t,this.authenticationProviderOptions=n}));!function(e){e[e.NONE=0]="NONE",e[e.REDIRECT_HANDLER_ENABLED=1]="REDIRECT_HANDLER_ENABLED",e[e.RETRY_HANDLER_ENABLED=2]="RETRY_HANDLER_ENABLED",e[e.AUTHENTICATION_HANDLER_ENABLED=4]="AUTHENTICATION_HANDLER_ENABLED"}(Vl||(Vl={}));var od=function(){function e(){(0,Y.Z)(this,e),this.featureUsage=Vl.NONE}return(0,X.Z)(e,[{key:"setFeatureUsage",value:function(e){this.featureUsage=this.featureUsage|e}},{key:"getFeatureUsage",value:function(){return this.featureUsage.toString(16)}}],[{key:"updateFeatureUsageFlag",value:function(t,n){var r;t.middlewareControl instanceof Xl?r=t.middlewareControl.getMiddlewareOptions(e):t.middlewareControl=new Xl,"undefined"===typeof r&&(r=new e,t.middlewareControl.setMiddlewareOptions(e,r)),r.setFeatureUsage(n)}}]),e}();(function(){function e(t){(0,Y.Z)(this,e),this.authenticationProvider=t}return(0,X.Z)(e,[{key:"execute",value:function(t){return Ii(this,void 0,void 0,(0,Ri.Z)().mark((function n(){var r,i,o,a,s,u;return(0,Ri.Z)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(r="string"===typeof t.request?t.request:t.request.url,!(Wl(r)||t.customHosts&&Jl(r,t.customHosts))){n.next=13;break}return t.middlewareControl instanceof Xl&&(i=t.middlewareControl.getMiddlewareOptions(id)),i&&(o=i.authenticationProvider,a=i.authenticationProviderOptions),o||(o=this.authenticationProvider),n.next=7,o.getAccessToken(a);case 7:s=n.sent,u="Bearer ".concat(s),nd(t.request,t.options,e.AUTHORIZATION_HEADER,u),od.updateFeatureUsageFlag(t,Vl.AUTHENTICATION_HANDLER_ENABLED),n.next=14;break;case 13:t.options.headers&&delete t.options.headers[e.AUTHORIZATION_HEADER];case 14:return n.next=16,this.nextMiddleware.execute(t);case 16:return n.abrupt("return",n.sent);case 17:case"end":return n.stop()}}),n,this)})))}},{key:"setNext",value:function(e){this.nextMiddleware=e}}]),e}()).AUTHORIZATION_HEADER="Authorization";var ad=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:e.DEFAULT_DELAY,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.DEFAULT_MAX_RETRIES,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:e.defaultShouldRetry;if((0,Y.Z)(this,e),t>e.MAX_DELAY&&n>e.MAX_MAX_RETRIES){var i=new Error("Delay and MaxRetries should not be more than ".concat(e.MAX_DELAY," and ").concat(e.MAX_MAX_RETRIES));throw i.name="MaxLimitExceeded",i}if(t>e.MAX_DELAY){var o=new Error("Delay should not be more than ".concat(e.MAX_DELAY));throw o.name="MaxLimitExceeded",o}if(n>e.MAX_MAX_RETRIES){var a=new Error("MaxRetries should not be more than ".concat(e.MAX_MAX_RETRIES));throw a.name="MaxLimitExceeded",a}if(t<0&&n<0){var s=new Error("Delay and MaxRetries should not be negative");throw s.name="MinExpectationNotMet",s}if(t<0){var u=new Error("Delay should not be negative");throw u.name="MinExpectationNotMet",u}if(n<0){var c=new Error("MaxRetries should not be negative");throw c.name="MinExpectationNotMet",c}this.delay=Math.min(t,e.MAX_DELAY),this.maxRetries=Math.min(n,e.MAX_MAX_RETRIES),this.shouldRetry=r}return(0,X.Z)(e,[{key:"getMaxDelay",value:function(){return e.MAX_DELAY}}]),e}();ad.DEFAULT_DELAY=3,ad.DEFAULT_MAX_RETRIES=3,ad.MAX_DELAY=180,ad.MAX_MAX_RETRIES=10,ad.defaultShouldRetry=function(){return!0};var sd=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new ad;(0,Y.Z)(this,e),this.options=t}return(0,X.Z)(e,[{key:"isRetry",value:function(t){return-1!==e.RETRY_STATUS_CODES.indexOf(t.status)}},{key:"isBuffered",value:function(e,t){var n="string"===typeof e?t.method:e.method;if((n===Sl.PUT||n===Sl.PATCH||n===Sl.POST)&&"application/octet-stream"===ed(e,t,"Content-Type"))return!1;return!0}},{key:"getDelay",value:function(t,n,r){var i,o=function(){return Number(Math.random().toFixed(3))},a=void 0!==t.headers?t.headers.get(e.RETRY_AFTER_HEADER):null;return i=null!==a?Number.isNaN(Number(a))?Math.round((new Date(a).getTime()-Date.now())/1e3):Number(a):n>=2?this.getExponentialBackOffTime(n)+r+o():r+o(),Math.min(i,this.options.getMaxDelay()+o())}},{key:"getExponentialBackOffTime",value:function(e){return Math.round(.5*(Math.pow(2,e)-1))}},{key:"sleep",value:function(e){return Ii(this,void 0,void 0,(0,Ri.Z)().mark((function t(){var n;return(0,Ri.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=1e3*e,t.abrupt("return",new Promise((function(e){return setTimeout(e,n)})));case 2:case"end":return t.stop()}}),t)})))}},{key:"getOptions",value:function(e){var t;return e.middlewareControl instanceof Xl&&(t=e.middlewareControl.getMiddlewareOptions(this.options.constructor)),"undefined"===typeof t&&(t=Object.assign(new ad,this.options)),t}},{key:"executeWithRetry",value:function(t,n,r){return Ii(this,void 0,void 0,(0,Ri.Z)().mark((function i(){var o;return(0,Ri.Z)().wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return i.next=2,this.nextMiddleware.execute(t);case 2:if(!(n<r.maxRetries&&this.isRetry(t.response)&&this.isBuffered(t.request,t.options)&&r.shouldRetry(r.delay,n,t.request,t.options,t.response))){i.next=13;break}return++n,td(t.request,t.options,e.RETRY_ATTEMPT_HEADER,n.toString()),o=this.getDelay(t.response,n,r.delay),i.next=8,this.sleep(o);case 8:return i.next=10,this.executeWithRetry(t,n,r);case 10:return i.abrupt("return",i.sent);case 13:return i.abrupt("return");case 14:case"end":return i.stop()}}),i,this)})))}},{key:"execute",value:function(e){return Ii(this,void 0,void 0,(0,Ri.Z)().mark((function t(){var n;return(0,Ri.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return 0,n=this.getOptions(e),od.updateFeatureUsageFlag(e,Vl.RETRY_HANDLER_ENABLED),t.next=5,this.executeWithRetry(e,0,n);case 5:return t.abrupt("return",t.sent);case 6:case"end":return t.stop()}}),t,this)})))}},{key:"setNext",value:function(e){this.nextMiddleware=e}}]),e}();sd.RETRY_STATUS_CODES=[429,503,504],sd.RETRY_ATTEMPT_HEADER="Retry-Attempt",sd.RETRY_AFTER_HEADER="Retry-After";var ud=(0,X.Z)((function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:e.DEFAULT_MAX_REDIRECTS,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.defaultShouldRedirect;if((0,Y.Z)(this,e),t>e.MAX_MAX_REDIRECTS){var r=new Error("MaxRedirects should not be more than ".concat(e.MAX_MAX_REDIRECTS));throw r.name="MaxLimitExceeded",r}if(t<0){var i=new Error("MaxRedirects should not be negative");throw i.name="MinExpectationNotMet",i}this.maxRedirects=t,this.shouldRedirect=n}));ud.DEFAULT_MAX_REDIRECTS=5,ud.MAX_MAX_REDIRECTS=20,ud.defaultShouldRedirect=function(){return!0};var cd=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new ud;(0,Y.Z)(this,e),this.options=t}return(0,X.Z)(e,[{key:"isRedirect",value:function(t){return-1!==e.REDIRECT_STATUS_CODES.indexOf(t.status)}},{key:"hasLocationHeader",value:function(t){return t.headers.has(e.LOCATION_HEADER)}},{key:"getLocationHeader",value:function(t){return t.headers.get(e.LOCATION_HEADER)}},{key:"isRelativeURL",value:function(e){return-1===e.indexOf("://")}},{key:"shouldDropAuthorizationHeader",value:function(e,t){var n,r,i=/^[A-Za-z].+?:\/\/.+?(?=\/|$)/,o=i.exec(e);null!==o&&(n=o[0]);var a=i.exec(t);return null!==a&&(r=a[0]),"undefined"!==typeof n&&"undefined"!==typeof r&&n!==r}},{key:"updateRequestUrl",value:function(e,t){return Ii(this,void 0,void 0,(0,Ri.Z)().mark((function n(){return(0,Ri.Z)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if("string"!==typeof t.request){n.next=4;break}n.t0=e,n.next=7;break;case 4:return n.next=6,rd(e,t.request);case 6:n.t0=n.sent;case 7:t.request=n.t0;case 8:case"end":return n.stop()}}),n)})))}},{key:"getOptions",value:function(e){var t;return e.middlewareControl instanceof Xl&&(t=e.middlewareControl.getMiddlewareOptions(ud)),"undefined"===typeof t&&(t=Object.assign(new ud,this.options)),t}},{key:"executeWithRedirect",value:function(t,n,r){return Ii(this,void 0,void 0,(0,Ri.Z)().mark((function i(){var o,a;return(0,Ri.Z)().wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return i.next=2,this.nextMiddleware.execute(t);case 2:if(o=t.response,!(n<r.maxRedirects&&this.isRedirect(o)&&this.hasLocationHeader(o)&&r.shouldRedirect(o))){i.next=18;break}if(++n,o.status!==e.STATUS_CODE_SEE_OTHER){i.next=10;break}t.options.method=Sl.GET,delete t.options.body,i.next=14;break;case 10:return a=this.getLocationHeader(o),!this.isRelativeURL(a)&&this.shouldDropAuthorizationHeader(o.url,a)&&delete t.options.headers[e.AUTHORIZATION_HEADER],i.next=14,this.updateRequestUrl(a,t);case 14:return i.next=16,this.executeWithRedirect(t,n,r);case 16:i.next=19;break;case 18:return i.abrupt("return");case 19:case"end":return i.stop()}}),i,this)})))}},{key:"execute",value:function(t){return Ii(this,void 0,void 0,(0,Ri.Z)().mark((function n(){var r;return(0,Ri.Z)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return 0,r=this.getOptions(t),t.options.redirect=e.MANUAL_REDIRECT,od.updateFeatureUsageFlag(t,Vl.REDIRECT_HANDLER_ENABLED),n.next=6,this.executeWithRedirect(t,0,r);case 6:return n.abrupt("return",n.sent);case 7:case"end":return n.stop()}}),n,this)})))}},{key:"setNext",value:function(e){this.nextMiddleware=e}}]),e}();cd.REDIRECT_STATUS_CODES=[301,302,303,307,308],cd.STATUS_CODE_SEE_OTHER=303,cd.LOCATION_HEADER="Location",cd.AUTHORIZATION_HEADER="Authorization",cd.MANUAL_REDIRECT="manual";var ld=function(){function e(){(0,Y.Z)(this,e)}return(0,X.Z)(e,[{key:"execute",value:function(t){return Ii(this,void 0,void 0,(0,Ri.Z)().mark((function n(){var r,i,o,a,s;return(0,Ri.Z)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return r="string"===typeof t.request?t.request:t.request.url,Wl(r)||t.customHosts&&Jl(r,t.customHosts)?((i=ed(t.request,t.options,e.CLIENT_REQUEST_ID_HEADER))||(i=$l(),td(t.request,t.options,e.CLIENT_REQUEST_ID_HEADER,i)),o="".concat(e.PRODUCT_NAME,"/").concat("3.0.5"),t.middlewareControl instanceof Xl&&(a=t.middlewareControl.getMiddlewareOptions(od)),a&&(s=a.getFeatureUsage(),o+=" (".concat(e.FEATURE_USAGE_STRING,"=").concat(s,")")),nd(t.request,t.options,e.SDK_VERSION_HEADER,o)):(delete t.options.headers[e.CLIENT_REQUEST_ID_HEADER],delete t.options.headers[e.SDK_VERSION_HEADER]),n.next=4,this.nextMiddleware.execute(t);case 4:return n.abrupt("return",n.sent);case 5:case"end":return n.stop()}}),n,this)})))}},{key:"setNext",value:function(e){this.nextMiddleware=e}}]),e}();ld.CLIENT_REQUEST_ID_HEADER="client-request-id",ld.SDK_VERSION_HEADER="SdkVersion",ld.PRODUCT_NAME="graph-js",ld.FEATURE_USAGE_STRING="featureUsage";var dd;!function(e){e[e.MANUAL=0]="MANUAL",e[e.RANDOM=1]="RANDOM"}(dd||(dd={}));var hd,fd,pd,vd;!function(e){e.ARRAYBUFFER="arraybuffer",e.BLOB="blob",e.DOCUMENT="document",e.JSON="json",e.RAW="raw",e.STREAM="stream",e.TEXT="text"}(hd||(hd={})),function(e){e.TEXT_HTML="text/html",e.TEXT_XML="text/xml",e.APPLICATION_XML="application/xml",e.APPLICATION_XHTML="application/xhtml+xml"}(fd||(fd={})),function(e){e.TEXT_PLAIN="text/plain",e.APPLICATION_JSON="application/json"}(pd||(pd={})),function(e){e.DOCUMENT="^(text\\/(html|xml))|(application\\/(xml|xhtml\\+xml))$",e.IMAGE="^image\\/.+"}(vd||(vd={}));var gd=function(){function e(){(0,Y.Z)(this,e)}return(0,X.Z)(e,null,[{key:"parseDocumentResponse",value:function(e,t){return"undefined"!==typeof DOMParser?new Promise((function(n,r){e.text().then((function(e){try{var i=(new DOMParser).parseFromString(e,t);n(i)}catch(o){r(o)}}))})):Promise.resolve(e.body)}},{key:"convertResponse",value:function(t,n){return Ii(this,void 0,void 0,(0,Ri.Z)().mark((function r(){var i,o,a;return(0,Ri.Z)().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(204!==t.status){r.next=2;break}return r.abrupt("return",Promise.resolve());case 2:o=t.headers.get("Content-type"),r.t0=n,r.next=r.t0===hd.ARRAYBUFFER?6:r.t0===hd.BLOB?10:r.t0===hd.DOCUMENT?14:r.t0===hd.JSON?18:r.t0===hd.STREAM?22:r.t0===hd.TEXT?26:30;break;case 6:return r.next=8,t.arrayBuffer();case 8:return i=r.sent,r.abrupt("break",59);case 10:return r.next=12,t.blob();case 12:return i=r.sent,r.abrupt("break",59);case 14:return r.next=16,e.parseDocumentResponse(t,fd.TEXT_XML);case 16:return i=r.sent,r.abrupt("break",59);case 18:return r.next=20,t.json();case 20:return i=r.sent,r.abrupt("break",59);case 22:return r.next=24,Promise.resolve(t.body);case 24:return i=r.sent,r.abrupt("break",59);case 26:return r.next=28,t.text();case 28:return i=r.sent,r.abrupt("break",59);case 30:if(null===o){r.next=57;break}if(a=o.split(";")[0],!new RegExp(vd.DOCUMENT).test(a)){r.next=38;break}return r.next=35,e.parseDocumentResponse(t,a);case 35:i=r.sent,r.next=55;break;case 38:if(!new RegExp(vd.IMAGE).test(a)){r.next=42;break}i=t.blob(),r.next=55;break;case 42:if(a!==pd.TEXT_PLAIN){r.next=48;break}return r.next=45,t.text();case 45:i=r.sent,r.next=55;break;case 48:if(a!==pd.APPLICATION_JSON){r.next=54;break}return r.next=51,t.json();case 51:i=r.sent,r.next=55;break;case 54:i=Promise.resolve(t.body);case 55:r.next=58;break;case 57:i=Promise.resolve(t.body);case 58:return r.abrupt("break",59);case 59:return r.abrupt("return",i);case 60:case"end":return r.stop()}}),r)})))}},{key:"getResponse",value:function(t,n,r){return Ii(this,void 0,void 0,(0,Ri.Z)().mark((function i(){var o;return(0,Ri.Z)().wrap((function(i){for(;;)switch(i.prev=i.next){case 0:if(n!==hd.RAW){i.next=4;break}return i.abrupt("return",Promise.resolve(t));case 4:return i.next=6,e.convertResponse(t,n);case 6:if(o=i.sent,!t.ok){i.next=15;break}if("function"!==typeof r){i.next=12;break}r(null,o),i.next=13;break;case 12:return i.abrupt("return",o);case 13:i.next=16;break;case 15:throw o;case 16:case"end":return i.stop()}}),i)})))}}]),e}(),md=(0,X.Z)((function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1;(0,Y.Z)(this,e),this.minValue=t,this.maxValue=n})),yd=function(){function e(t,n){(0,Y.Z)(this,e),this._location=n,this._responseBody=t}return(0,X.Z)(e,[{key:"location",get:function(){return this._location},set:function(e){this._location=e}},{key:"responseBody",get:function(){return this._responseBody},set:function(e){this._responseBody=e}}],[{key:"CreateUploadResult",value:function(t,n){return new e(t,n.get("location"))}}]),e}(),bd=function(){function e(t,n,r){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};if((0,Y.Z)(this,e),this.DEFAULT_FILE_SIZE=5242880,this.client=t,!n.sliceFile)throw new Kl("Please pass the FileUpload object, StreamUpload object or any custom implementation of the FileObject interface");this.file=n,this.file=n,i.rangeSize||(i.rangeSize=this.DEFAULT_FILE_SIZE),this.options=i,this.uploadSession=r,this.nextRange=new md(0,this.options.rangeSize-1)}return(0,X.Z)(e,[{key:"parseRange",value:function(e){var t=e[0];if("undefined"===typeof t||""===t)return new md;var n=t.split("-"),r=parseInt(n[0],10),i=parseInt(n[1],10);return Number.isNaN(i)&&(i=this.file.size-1),new md(r,i)}},{key:"updateTaskStatus",value:function(e){this.uploadSession.expiry=new Date(e.expirationDateTime),this.nextRange=this.parseRange(e.nextExpectedRanges)}},{key:"getNextRange",value:function(){if(-1===this.nextRange.minValue)return this.nextRange;var e=this.nextRange.minValue,t=e+this.options.rangeSize-1;return t>=this.file.size&&(t=this.file.size-1),new md(e,t)}},{key:"sliceFile",value:function(e){if(console.warn("The LargeFileUploadTask.sliceFile() function has been deprecated and moved into the FileObject interface."),this.file.content instanceof ArrayBuffer||this.file.content instanceof Blob||this.file.content instanceof Uint8Array)return this.file.content.slice(e.minValue,e.maxValue+1);throw new Kl("The LargeFileUploadTask.sliceFile() function expects only Blob, ArrayBuffer or Uint8Array file content. Please note that the sliceFile() function is deprecated.")}},{key:"upload",value:function(){return Ii(this,void 0,void 0,(0,Ri.Z)().mark((function e(){var t,n,r,i,o,a,s;return(0,Ri.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=this.options&&this.options.uploadEventHandlers;case 1:if(this.uploadSession.isCancelled){e.next=26;break}if(-1!==(n=this.getNextRange()).maxValue){e.next=7;break}throw(r=new Error("Task with which you are trying to upload is already completed, Please check for your uploaded file")).name="Invalid Session",r;case 7:return e.next=9,this.file.sliceFile(n);case 9:return i=e.sent,e.next=12,this.uploadSliceGetRawResponse(i,n,this.file.size);case 12:if(o=e.sent){e.next=15;break}throw new Kl("Something went wrong! Large file upload slice response is null.");case 15:return e.next=17,gd.getResponse(o);case 17:if(a=e.sent,!(201===o.status||200===o.status&&a.id)){e.next=21;break}return this.reportProgress(t,n),e.abrupt("return",yd.CreateUploadResult(a,o.headers));case 21:s={expirationDateTime:a.expirationDateTime||a.ExpirationDateTime,nextExpectedRanges:a.NextExpectedRanges||a.nextExpectedRanges},this.updateTaskStatus(s),this.reportProgress(t,n),e.next=1;break;case 26:case"end":return e.stop()}}),e,this)})))}},{key:"reportProgress",value:function(e,t){e&&e.progress&&e.progress(t,e.extraCallbackParam)}},{key:"uploadSlice",value:function(e,t,n){return Ii(this,void 0,void 0,(0,Ri.Z)().mark((function r(){return(0,Ri.Z)().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,this.client.api(this.uploadSession.url).headers({"Content-Length":"".concat(t.maxValue-t.minValue+1),"Content-Range":"bytes ".concat(t.minValue,"-").concat(t.maxValue,"/").concat(n),"Content-Type":"application/octet-stream"}).put(e);case 2:return r.abrupt("return",r.sent);case 3:case"end":return r.stop()}}),r,this)})))}},{key:"uploadSliceGetRawResponse",value:function(e,t,n){return Ii(this,void 0,void 0,(0,Ri.Z)().mark((function r(){return(0,Ri.Z)().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,this.client.api(this.uploadSession.url).headers({"Content-Length":"".concat(t.maxValue-t.minValue+1),"Content-Range":"bytes ".concat(t.minValue,"-").concat(t.maxValue,"/").concat(n),"Content-Type":"application/octet-stream"}).responseType(hd.RAW).put(e);case 2:return r.abrupt("return",r.sent);case 3:case"end":return r.stop()}}),r,this)})))}},{key:"cancel",value:function(){return Ii(this,void 0,void 0,(0,Ri.Z)().mark((function e(){var t;return(0,Ri.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.client.api(this.uploadSession.url).responseType(hd.RAW).delete();case 2:return 204===(t=e.sent).status&&(this.uploadSession.isCancelled=!0),e.abrupt("return",t);case 5:case"end":return e.stop()}}),e,this)})))}},{key:"getStatus",value:function(){return Ii(this,void 0,void 0,(0,Ri.Z)().mark((function e(){var t;return(0,Ri.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.client.api(this.uploadSession.url).get();case 2:return t=e.sent,this.updateTaskStatus(t),e.abrupt("return",t);case 5:case"end":return e.stop()}}),e,this)})))}},{key:"resume",value:function(){return Ii(this,void 0,void 0,(0,Ri.Z)().mark((function e(){return(0,Ri.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getStatus();case 2:return e.next=4,this.upload();case 4:return e.abrupt("return",e.sent);case 5:case"end":return e.stop()}}),e,this)})))}},{key:"getUploadSession",value:function(){return this.uploadSession}}],[{key:"createUploadSession",value:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return Ii(this,void 0,void 0,(0,Ri.Z)().mark((function i(){var o,a;return(0,Ri.Z)().wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return i.next=2,e.api(t).headers(r).post(n);case 2:return o=i.sent,a={url:o.uploadUrl,expiry:new Date(o.expirationDateTime),isCancelled:!1},i.abrupt("return",a);case 5:case"end":return i.stop()}}),i)})))}}]),e}(),wd=n(11752),Sd=n(61120),kd=function(){function e(t,n,r){if((0,Y.Z)(this,e),this.content=t,this.name=n,this.size=r,!t||!n||!r)throw new Kl("Please provide the upload content, name of the file and size of the file")}return(0,X.Z)(e,[{key:"sliceFile",value:function(e){return this.content.slice(e.minValue,e.maxValue+1)}}]),e}(),Cd=function(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:5242880,n=62914560;return t>n&&(t=n),(e=t)>327680&&(e=320*Math.floor(e/327680)*1024),e},xd=function(e){(0,nr.Z)(n,e);var t=(0,rr.Z)(n);function n(e,r,i,o){return(0,Y.Z)(this,n),t.call(this,e,r,i,o)}return(0,X.Z)(n,[{key:"commit",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"rename";return Ii(this,void 0,void 0,(0,Ri.Z)().mark((function n(){var r;return(0,Ri.Z)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return r={name:this.file.name,"@microsoft.graph.conflictBehavior":t,"@microsoft.graph.sourceUrl":this.uploadSession.url},n.next=3,this.client.api(e).put(r);case 3:return n.abrupt("return",n.sent);case 4:case"end":return n.stop()}}),n,this)})))}}],[{key:"constructCreateSessionUrl",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:n.DEFAULT_UPLOAD_PATH;return e=e.trim(),""===(t=t.trim())&&(t="/"),"/"!==t[0]&&(t="/".concat(t)),"/"!==t[t.length-1]&&(t="".concat(t,"/")),"/me/drive/root:".concat(t.split("/").map((function(e){return encodeURIComponent(e)})).join("/")).concat(encodeURIComponent(e),":/createUploadSession")}},{key:"getFileInfo",value:function(e,t){var n,r;if("undefined"!==typeof Blob&&e instanceof Blob)r=(n=new File([e],t)).size;else if("undefined"!==typeof File&&e instanceof File)r=(n=e).size;else if("undefined"!==typeof Uint8Array&&e instanceof Uint8Array){var i=e;r=i.byteLength,n=i.buffer.slice(i.byteOffset,i.byteOffset+i.byteLength)}return{content:n,size:r}}},{key:"create",value:function(e,t,r){return Ii(this,void 0,void 0,(0,Ri.Z)().mark((function i(){var o,a,s;return(0,Ri.Z)().wrap((function(i){for(;;)switch(i.prev=i.next){case 0:if(e&&t&&r){i.next=2;break}throw new Kl("Please provide the Graph client instance, file object and OneDriveLargeFileUploadOptions value");case 2:return o=r.fileName,a=n.getFileInfo(t,o),s=new kd(a.content,o,a.size),i.abrupt("return",this.createTaskWithFileObject(e,s,r));case 6:case"end":return i.stop()}}),i,this)})))}},{key:"createTaskWithFileObject",value:function(e,t,r){return Ii(this,void 0,void 0,(0,Ri.Z)().mark((function i(){var o,a,s,u;return(0,Ri.Z)().wrap((function(i){for(;;)switch(i.prev=i.next){case 0:if(e&&t&&r){i.next=2;break}throw new Kl("Please provide the Graph client instance, FileObject interface implementation and OneDriveLargeFileUploadOptions value");case 2:return o=r.uploadSessionURL?r.uploadSessionURL:n.constructCreateSessionUrl(r.fileName,r.path),a={fileName:r.fileName,fileDescription:r.fileDescription,conflictBehavior:r.conflictBehavior},i.next=6,n.createUploadSession(e,o,a);case 6:return s=i.sent,u=Cd(r.rangeSize),i.abrupt("return",new n(e,t,s,{rangeSize:u,uploadEventHandlers:r.uploadEventHandlers}));case 9:case"end":return i.stop()}}),i)})))}},{key:"createUploadSession",value:function(e,t,r){var i=this,o=Object.create(null,{createUploadSession:{get:function(){return(0,wd.Z)((0,Sd.Z)(n),"createUploadSession",i)}}});return Ii(this,void 0,void 0,(0,Ri.Z)().mark((function n(){var i;return(0,Ri.Z)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return i={item:{"@microsoft.graph.conflictBehavior":(null===r||void 0===r?void 0:r.conflictBehavior)||"rename",name:null===r||void 0===r?void 0:r.fileName,description:null===r||void 0===r?void 0:r.fileDescription}},n.abrupt("return",o.createUploadSession.call(this,e,t,i));case 2:case"end":return n.stop()}}),n,this)})))}}]),n}(bd);xd.DEFAULT_UPLOAD_PATH="/";var Ed;n(67097);!function(e){e.InvalidParameter="InvalidParameter",e.InvalidConfiguration="InvalidConfiguration",e.InvalidCertificate="InvalidCertificate",e.InternalError="InternalError",e.ChannelNotSupported="ChannelNotSupported",e.FailedToRetrieveSsoToken="FailedToRetrieveSsoToken",e.FailedToProcessSsoHandler="FailedToProcessSsoHandler",e.CannotFindCommand="CannotFindCommand",e.FailedToRunSsoStep="FailedToRunSsoStep",e.FailedToRunDedupStep="FailedToRunDedupStep",e.SsoActivityHandlerIsUndefined="SsoActivityHandlerIsUndefined",e.RuntimeNotSupported="RuntimeNotSupported",e.ConsentFailed="ConsentFailed",e.UiRequiredError="UiRequiredError",e.TokenExpiredError="TokenExpiredError",e.ServiceError="ServiceError",e.FailedOperation="FailedOperation",e.InvalidResponse="InvalidResponse",e.IdentityTypeNotSupported="IdentityTypeNotSupported",e.AuthorizationInfoAlreadyExists="AuthorizationInfoAlreadyExists"}(Ed||(Ed={}));var Td=(0,X.Z)((function e(){(0,Y.Z)(this,e)}));Td.InvalidConfiguration="{0} in configuration is invalid: {1}.",Td.ConfigurationNotExists="Configuration does not exist. {0}",Td.ResourceConfigurationNotExists="{0} resource configuration does not exist.",Td.MissingResourceConfiguration="Missing resource configuration with type: {0}, name: {1}.",Td.AuthenticationConfigurationNotExists="Authentication configuration does not exist.",Td.BrowserRuntimeNotSupported="{0} is not supported in browser.",Td.NodejsRuntimeNotSupported="{0} is not supported in Node.",Td.FailToAcquireTokenOnBehalfOfUser="Failed to acquire access token on behalf of user: {0}",Td.OnlyMSTeamsChannelSupported="{0} is only supported in MS Teams Channel",Td.FailedToProcessSsoHandler="Failed to process sso handler: {0}",Td.FailedToRetrieveSsoToken="Failed to retrieve sso token, user failed to finish the AAD consent flow.",Td.CannotFindCommand="Cannot find command: {0}",Td.FailedToRunSsoStep="Failed to run dialog to retrieve sso token: {0}",Td.FailedToRunDedupStep="Failed to run dialog to remove duplicated messages: {0}",Td.SsoActivityHandlerIsNull="Sso command can only be used or added when sso activity handler is not undefined",Td.IdentityTypeNotSupported="{0} identity is not supported in {1}",Td.AuthorizationHeaderAlreadyExists="Authorization header already exists!",Td.BasicCredentialAlreadyExists="Basic credential already exists!",Td.EmptyParameter="Parameter {0} is empty",Td.DuplicateHttpsOptionProperty="Axios HTTPS agent already defined value for property {0}",Td.DuplicateApiKeyInHeader="The request already defined api key in request header with name {0}.",Td.DuplicateApiKeyInQueryParam="The request already defined api key in query parameter with name {0}.",Td.OnlySupportInQueryActivity="The handleMessageExtensionQueryWithToken only support in handleTeamsMessagingExtensionQuery with composeExtension/query type.";var Id,Ad=function(e){(0,nr.Z)(n,e);var t=(0,rr.Z)(n);function n(e,r){var i;return(0,Y.Z)(this,n),r?(i=t.call(this,e),Object.setPrototypeOf((0,Ni.Z)(i),n.prototype),i.name="".concat((this instanceof n?this.constructor:void 0).name,".").concat(r),i.code=r,(0,Pi.Z)(i)):(i=t.call(this,e),(0,Pi.Z)(i,(0,Ni.Z)(i)))}return(0,X.Z)(n)}((0,ir.Z)(Error));!function(e){e[e.Verbose=0]="Verbose",e[e.Info=1]="Info",e[e.Warn=2]="Warn",e[e.Error=3]="Error"}(Id||(Id={}));var Rd=new(function(){function e(t,n){(0,Y.Z)(this,e),this.level=void 0,this.defaultLogger={verbose:console.debug,info:console.info,warn:console.warn,error:console.error},this.name=t,this.level=n}return(0,X.Z)(e,[{key:"error",value:function(e){this.log(Id.Error,(function(e){return e.error}),e)}},{key:"warn",value:function(e){this.log(Id.Warn,(function(e){return e.warn}),e)}},{key:"info",value:function(e){this.log(Id.Info,(function(e){return e.info}),e)}},{key:"verbose",value:function(e){this.log(Id.Verbose,(function(e){return e.verbose}),e)}},{key:"log",value:function(e,t,n){if(""!==n.trim()){var r,i=(new Date).toUTCString();r=this.name?"[".concat(i,"] : @microsoft/teamsfx - ").concat(this.name," : ").concat(Id[e]," - "):"[".concat(i,"] : @microsoft/teamsfx : ").concat(Id[e]," - ");var o="".concat(r).concat(n);void 0!==this.level&&this.level<=e&&(this.customLogger?t(this.customLogger)(o):this.customLogFunction?this.customLogFunction(e,o):t(this.defaultLogger)(o))}}}]),e}());function _d(e){try{var t=Di(e);if(!t||!t.exp)throw new Ad("Decoded token is null or exp claim does not exists.",Ed.InternalError);return t}catch(r){var n="Parse jwt token failed in node env with error: "+r.message;throw Rd.error(n),new Ad(n,Ed.InternalError)}}function Pd(e){if(!e){var t="SSO token is undefined.";throw Rd.error(t),new Ad(t,Ed.InvalidParameter)}var n=_d(e),r={displayName:n.name,objectId:n.oid,tenantId:n.tid,preferredUserName:""};return"2.0"===n.ver?r.preferredUserName=n.preferred_username:"1.0"===n.ver&&(r.preferredUserName=n.upn),r}function Nd(e){if(!e){var t="SSO token is undefined.";throw Rd.error(t),new Ad(t,Ed.InvalidParameter)}var n=_d(e);return{tid:n.tid,loginHint:"2.0"===n.ver?n.preferred_username:n.upn}}function Od(e){try{var t="string"==typeof e?JSON.parse(e):e;if(!t||!t.accessToken){var n="Get empty access token from Auth Code token response.";throw Rd.error(n),new Error(n)}var r=t.accessToken,i=_d(r);if("1.0"!==i.ver&&"2.0"!==i.ver){var o="SSO token is not valid with an unknown version: "+i.ver;throw Rd.error(o),new Error(o)}return{token:r,expiresOnTimestamp:1e3*i.exp}}catch(s){var a="Parse access token failed from Auth Code token response in node env with error: "+s.message;throw Rd.error(a),new Ad(a,Ed.InternalError)}}function Md(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];var i=n;return e.replace(/{(\d+)}/g,(function(e,t){return"undefined"!=typeof i[t]?i[t]:e}))}function Fd(e){if(!("string"===typeof e||e instanceof String)&&(!Array.isArray(e)||0!==e.length)&&!(Array.isArray(e)&&e.length>0&&e.every((function(e){return"string"===typeof e})))){var t="The type of scopes is not valid, it must be string or string array";throw Rd.error(t),new Ad(t,Ed.InvalidParameter)}}var Zd=function(){function e(t){(0,Y.Z)(this,e),Rd.info("Create teams user credential"),this.config=this.loadAndValidateConfig(t),this.ssoToken=null,this.initialized=!1}return(0,X.Z)(e,[{key:"login",value:function(){var e=(0,_i.Z)((0,Ri.Z)().mark((function e(t,n){var r,i,o,a,s,u,c,l;return(0,Ri.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(Fd(t),r="string"===typeof t?t:t.join(" "),Rd.info("Popup login page to get user's access token with scopes: ".concat(r)),this.initialized){e.next=6;break}return e.next=6,this.init(n);case 6:return e.next=8,Ei.app.initialize();case 8:return e.prev=8,o={url:"".concat(this.config.initiateLoginEndpoint,"?clientId=").concat(this.config.clientId,"&scope=").concat(encodeURI(r),"&loginHint=").concat(this.loginHint),width:600,height:535},e.next=12,Ei.authentication.authenticate(o);case 12:if(i=e.sent){e.next=17;break}throw a="Get empty authentication result from MSAL",Rd.error(a),new Ad(a,Ed.InternalError);case 17:e.next=24;break;case 19:throw e.prev=19,e.t0=e.catch(8),s="Consent failed for the scope ".concat(r," with error: ").concat(e.t0.message),Rd.error(s),new Ad(s,Ed.ConsentFailed);case 24:u={},e.prev=25,u="string"==typeof i?JSON.parse(i):i,e.next=34;break;case 29:throw e.prev=29,e.t1=e.catch(25),c="Failed to parse response to Json.",Rd.error(c),new Ad(c,Ed.InvalidResponse);case 34:if(!u.code){e.next=39;break}throw"https://aka.ms/teamsfx-auth-code-flow",l="Found auth code in response. Auth code is not support for current version of SDK. "+"Please refer to the help link for how to fix the issue: ".concat("https://aka.ms/teamsfx-auth-code-flow","."),Rd.error(l),new Ad(l,Ed.InvalidResponse);case 39:u.sessionStorage&&this.setSessionStorage(u.sessionStorage);case 40:case"end":return e.stop()}}),e,this,[[8,19],[25,29]])})));return function(t,n){return e.apply(this,arguments)}}()},{key:"getToken",value:function(){var e=(0,_i.Z)((0,Ri.Z)().mark((function e(t,n){var r,i,o,a,s,u,c,l,d,h,f,p,v,g;return(0,Ri.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return Fd(t),i=null===(r=n)||void 0===r?void 0:r.resources,e.next=4,this.getSSOToken(i);case 4:if(o=e.sent,""!==(a="string"===typeof t?t:t.join(" "))){e.next=11;break}return Rd.info("Get SSO token"),e.abrupt("return",o);case 11:if(Rd.info("Get access token with scopes: "+a),this.initialized){e.next=15;break}return e.next=15,this.init(i);case 15:return u="string"===typeof t?t.split(" "):t,c=window.location.origin,e.prev=17,l=this.msalInstance.getAccountByUsername(this.loginHint),d={scopes:u,account:null!==l&&void 0!==l?l:void 0,redirectUri:"".concat(c,"/blank-auth-end.html")},e.next=22,this.msalInstance.acquireTokenSilent(d);case 22:s=e.sent,e.next=29;break;case 25:e.prev=25,e.t0=e.catch(17),h="Failed to call acquireTokenSilent. Reason: ".concat(null===e.t0||void 0===e.t0?void 0:e.t0.message,". "),Rd.verbose(h);case 29:if(s){e.next=41;break}return e.prev=30,f={scopes:u,loginHint:this.loginHint,redirectUri:"".concat(c,"/blank-auth-end.html")},e.next=34,this.msalInstance.ssoSilent(f);case 34:s=e.sent,e.next=41;break;case 37:e.prev=37,e.t1=e.catch(30),p="Failed to call ssoSilent. Reason: ".concat(null===e.t1||void 0===e.t1?void 0:e.t1.message,". "),Rd.verbose(p);case 41:if(s){e.next=45;break}throw v="Failed to get access token cache silently, please login first: you need login first before get access token.",Rd.error(v),new Ad(v,Ed.UiRequiredError);case 45:return g=Od(s),e.abrupt("return",g);case 47:case"end":return e.stop()}}),e,this,[[17,25],[30,37]])})));return function(t,n){return e.apply(this,arguments)}}()},{key:"getUserInfo",value:function(){var e=(0,_i.Z)((0,Ri.Z)().mark((function e(t){var n;return(0,Ri.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return Rd.info("Get basic user info from SSO token"),e.next=3,this.getSSOToken(t);case 3:return n=e.sent,e.abrupt("return",Pd(n.token));case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"init",value:function(){var e=(0,_i.Z)((0,Ri.Z)().mark((function e(t){var n,r,i;return(0,Ri.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getSSOToken(t);case 2:n=e.sent,r=Nd(n.token),this.loginHint=r.loginHint,this.tid=r.tid,i={auth:{clientId:this.config.clientId,authority:"https://login.microsoftonline.com/".concat(this.tid)},cache:{cacheLocation:"sessionStorage"}},this.msalInstance=new zl(i),this.initialized=!0;case 9:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getSSOToken",value:function(){var e=(0,_i.Z)((0,Ri.Z)().mark((function e(t){var n,r,i,o,a,s,u,c;return(0,Ri.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.ssoToken){e.next=4;break}if(!(this.ssoToken.expiresOnTimestamp-Date.now()>3e5)){e.next=4;break}return Rd.verbose("Get SSO token from memory cache"),e.abrupt("return",this.ssoToken);case 4:return n={resources:null!==t&&void 0!==t?t:[]},e.prev=5,e.next=8,Ei.app.initialize();case 8:e.next=15;break;case 10:throw e.prev=10,e.t0=e.catch(5),i="Initialize teams sdk failed due to not running inside Teams environment",Rd.error(i),new Ad(i,Ed.InternalError);case 15:return e.prev=15,e.next=18,Ei.authentication.getAuthToken(n);case 18:r=e.sent,e.next=26;break;case 21:throw e.prev=21,e.t1=e.catch(15),o="Get SSO token failed with error: "+e.t1.message,Rd.error(o),new Ad(o,Ed.InternalError);case 26:if(r){e.next=30;break}throw a="Get empty SSO token from Teams",Rd.error(a),new Ad(a,Ed.InternalError);case 30:if("1.0"===(s=_d(r)).ver||"2.0"===s.ver){e.next=35;break}throw u="SSO token is not valid with an unknown version: "+s.ver,Rd.error(u),new Ad(u,Ed.InternalError);case 35:return c={token:r,expiresOnTimestamp:1e3*s.exp},this.ssoToken=c,e.abrupt("return",c);case 38:case"end":return e.stop()}}),e,this,[[5,10],[15,21]])})));return function(t){return e.apply(this,arguments)}}()},{key:"loadAndValidateConfig",value:function(e){if(Rd.verbose("Validate authentication configuration"),e.initiateLoginEndpoint&&e.clientId)return e;var t=[];e.initiateLoginEndpoint||t.push("initiateLoginEndpoint"),e.clientId||t.push("clientId");var n=Md(Td.InvalidConfiguration,t.join(", "),"undefined");throw Rd.error(n),new Ad(n,Ed.InvalidConfiguration)}},{key:"setSessionStorage",value:function(e){try{Object.keys(e).forEach((function(t){sessionStorage.setItem(t,e[t])}))}catch(n){var t="Failed to set values in session storage. Error: ".concat(n.message);throw Rd.error(t),new Ad(t,Ed.InternalError)}}}]),e}();var Dd;!function(e){e[e.Header=0]="Header",e[e.QueryParams=1]="QueryParams"}(Dd||(Dd={}));var Ld;!function(e){e.User="User",e.App="Application"}(Ld||(Ld={}));var Bd,qd,jd;!function(e){e.Channel="Channel",e.Group="Group",e.Person="Person"}(Bd||(Bd={})),function(e){e[e.ReplaceForInteractor=0]="ReplaceForInteractor",e[e.ReplaceForAll=1]="ReplaceForAll",e[e.NewForAll=2]="NewForAll"}(qd||(qd={})),function(e){e[e.BadRequest=400]="BadRequest",e[e.InternalServerError=500]="InternalServerError"}(jd||(jd={}));var Ud;!function(e){e[e.Person=1]="Person",e[e.Group=2]="Group",e[e.Channel=4]="Channel",e[e.All=7]="All"}(Ud||(Ud={}));var Hd;!function(e){e[e.Person=1]="Person",e[e.Group=2]="Group",e[e.Channel=4]="Channel",e[e.All=7]="All"}(Hd||(Hd={}));var zd=n(54164),Vd=function(){var e=new URLSearchParams(window.location.search).get("theme");return null==e?void 0:e};var Gd=function(){return function(e,t){switch(t.type){case"loading":return{data:e.data,loading:!0};case"result":return{data:t.result,loading:!1};case"error":return{loading:!1,error:t.error}}}};function Kd(t){var n=this,r=function(t){var n=(0,e.useState)(void 0),r=n[0],i=n[1],o=(0,e.useState)(void 0),a=o[0],s=o[1],u=(0,e.useState)(er),c=u[0],l=u[1],d=(0,e.useState)("default"),h=d[0],f=d[1],p=(0,e.useState)(t&&t.initialTheme?t.initialTheme:Vd())[0],v=(0,e.useState)(void 0),g=v[0],m=v[1],y=(null===t||void 0===t?void 0:t.setThemeHandler)?t.setThemeHandler:function(e){switch(f(e||"default"),e){case"dark":l(Hn);break;case"contrast":l(Wn);break;default:l(er)}};return(0,e.useEffect)((function(){y(p),Ei.app.initialize().then((function(){Ei.app.getContext().then((function(e){(0,zd.unstable_batchedUpdates)((function(){i(!0),m(e),s(e.page.isFullScreen)})),y(e.app.theme),Ei.app.registerOnThemeChangeHandler(y),Ei.pages.registerFullScreenHandler((function(e){s(e)}))})).catch((function(){i(!1)}))})).catch((function(){i(!1)}))}),[]),[{inTeams:r,fullScreen:a,theme:c,context:g,themeString:h},{setTheme:y}]}({})[0],i=function(t,n){var r,i=null===(r=null===n||void 0===n?void 0:n.autoLoad)||void 0===r||r,o=(0,e.useReducer)(Gd(),{loading:i}),a=o[0],s=a.data,u=a.loading,c=a.error,l=o[1];function d(){u||l({type:"loading"}),t().then((function(e){return l({type:"result",result:e})})).catch((function(e){return l({type:"error",error:e})}))}return(0,e.useEffect)((function(){i&&d()}),[]),{data:s,loading:u,error:c,reload:d}}((function(){return Ii(n,void 0,void 0,(function(){return Ai(this,(function(e){return[2,new Zd(t)]}))}))})),o=i.data,a=i.error,s=i.loading;return Ti({teamsUserCredential:o,error:a,loading:s},r)}var Wd=n(80184),Jd=function(e){(0,nr.Z)(n,e);var t=(0,rr.Z)(n);function n(){return(0,Y.Z)(this,n),t.apply(this,arguments)}return(0,X.Z)(n,[{key:"render",value:function(){return(0,Wd.jsx)("div",{children:(0,Wd.jsx)("h1",{children:"Privacy Statement"})})}}]),n}(e.Component),Qd=Jd,Yd=function(e){(0,nr.Z)(n,e);var t=(0,rr.Z)(n);function n(){return(0,Y.Z)(this,n),t.apply(this,arguments)}return(0,X.Z)(n,[{key:"render",value:function(){return(0,Wd.jsx)("div",{children:(0,Wd.jsx)("h1",{children:"Terms of Use"})})}}]),n}(e.Component),Xd=Yd,$d=(0,e.createContext)({theme:void 0,themeString:"",teamsUserCredential:void 0}),eh={initiateLoginEndpoint:"https://m365tab111aef.z33.web.core.windows.net/auth-start.html",clientId:"69d2d73f-7402-4632-9876-6dd3a1891bde",apiEndpoint:{NODE_ENV:"production",PUBLIC_URL:".",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0,REACT_APP_CLIENT_ID:"69d2d73f-7402-4632-9876-6dd3a1891bde",REACT_APP_START_LOGIN_PAGE_URL:"https://m365tab111aef.z33.web.core.windows.net/auth-start.html"}.REACT_APP_FUNC_ENDPOINT,apiName:{NODE_ENV:"production",PUBLIC_URL:".",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0,REACT_APP_CLIENT_ID:"69d2d73f-7402-4632-9876-6dd3a1891bde",REACT_APP_START_LOGIN_PAGE_URL:"https://m365tab111aef.z33.web.core.windows.net/auth-start.html"}.REACT_APP_FUNC_NAME},th=n(25277),nh={loaderUrl:"build/build.loader.js",dataUrl:"build/build.data",frameworkUrl:"build/build.framework.js",codeUrl:"build/build.wasm"};function rh(e,t){if(!Object.prototype.hasOwnProperty.call(e,t))throw new TypeError("attempted to use private field on non-instance");return e}var ih=0;function oh(e){return"__private_"+ih+++"_"+e}var ah=n(75862),sh=n(2517),uh=oh("container"),ch=oh("registeredScoreUpdateEventHandlers"),lh=oh("registeredHealthUpdateEventHandlers"),dh=oh("connectPromise"),hh=oh("connect"),fh=(0,X.Z)((function e(){var t=this;(0,Y.Z)(this,e),Object.defineProperty(this,uh,{writable:!0,value:void 0}),Object.defineProperty(this,ch,{writable:!0,value:[]}),Object.defineProperty(this,lh,{writable:!0,value:[]}),Object.defineProperty(this,dh,{writable:!0,value:void 0}),this.connect=function(){return rh(t,dh)[dh]||(rh(t,dh)[dh]=rh(t,hh)[hh]()),rh(t,dh)[dh]},Object.defineProperty(this,hh,{writable:!0,value:function(){var e=(0,_i.Z)((0,Ri.Z)().mark((function e(){var n,r,i,o,a,s,u,c,l,d,h,f,p,v,g,m;return(0,Ri.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,n=Ei.LiveShareHost.create(),r=new ah.LiveShareClient(n),e.next=5,r.joinContainer({initialObjects:{scoreMap:sh.G,healthDataMap:sh.G}});case 5:i=e.sent,o=i.container,rh(t,uh)[uh]=o,console.log("Assigned container:",rh(t,uh)[uh]),console.log("Container initial objects:",rh(t,uh)[uh].initialObjects),a={},s=(0,pe.Z)(rh(t,uh)[uh].initialObjects.scoreMap.entries());try{for(s.s();!(u=s.n()).done;)c=(0,N.Z)(u.value,2),l=c[0],d=c[1],a[l]=d}catch(y){s.e(y)}finally{s.f()}console.log("scoreMap contents: ",a),h={},f=(0,pe.Z)(rh(t,uh)[uh].initialObjects.healthDataMap.entries());try{for(f.s();!(p=f.n()).done;)v=(0,N.Z)(p.value,2),g=v[0],m=v[1],h[g]=m}catch(y){f.e(y)}finally{f.f()}return console.log("healthDataMap contents: ",h),rh(t,uh)[uh]&&rh(t,uh)[uh].initialObjects.scoreMap?rh(t,uh)[uh].initialObjects.scoreMap.on("valueChanged",function(){var e=(0,_i.Z)((0,Ri.Z)().mark((function e(n){var r,i,o,a,s;return(0,Ri.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=n.key,i=rh(t,uh)[uh].initialObjects.scoreMap.get(r),console.log("container.playernames: ",r),o=(0,pe.Z)(rh(t,ch)[ch]),e.prev=4,o.s();case 6:if((a=o.n()).done){e.next=12;break}return s=a.value,e.next=10,s(r,i);case 10:e.next=6;break;case 12:e.next=17;break;case 14:e.prev=14,e.t0=e.catch(4),o.e(e.t0);case 17:return e.prev=17,o.f(),e.finish(17);case 20:case"end":return e.stop()}}),e,null,[[4,14,17,20]])})));return function(t){return e.apply(this,arguments)}}()):console.error("Score map is not initialized!"),rh(t,uh)[uh]&&rh(t,uh)[uh].initialObjects.healthDataMap?rh(t,uh)[uh].initialObjects.healthDataMap.on("valueChanged",function(){var e=(0,_i.Z)((0,Ri.Z)().mark((function e(n){return(0,Ri.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:rh(t,uh)[uh].initialObjects.healthDataMap.on("valueChanged",function(){var e=(0,_i.Z)((0,Ri.Z)().mark((function e(n){var r,i,o,a,s;return(0,Ri.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=n.key,i=rh(t,uh)[uh].initialObjects.healthDataMap.get(r),console.log("Player's health data updated:",r,i),o=(0,pe.Z)(rh(t,lh)[lh]),e.prev=4,o.s();case 6:if((a=o.n()).done){e.next=12;break}return s=a.value,e.next=10,s(r,i);case 10:e.next=6;break;case 12:e.next=17;break;case 14:e.prev=14,e.t0=e.catch(4),o.e(e.t0);case 17:return e.prev=17,o.f(),e.finish(17);case 20:case"end":return e.stop()}}),e,null,[[4,14,17,20]])})));return function(t){return e.apply(this,arguments)}}());case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()):console.error("Health data map is not initialized!"),e.abrupt("return",rh(t,uh)[uh]);case 23:throw e.prev=23,e.t0=e.catch(0),console.log("Error in pacman service: ".concat(e.t0.message)),e.t0;case 27:case"end":return e.stop()}}),e,null,[[0,23]])})));return function(){return e.apply(this,arguments)}}()}),this.getScores=function(){return new Promise((function(e,n){if(rh(t,uh)[uh]&&rh(t,uh)[uh].initialObjects.scoreMap){var r,i=[],o=(0,pe.Z)(rh(t,uh)[uh].initialObjects.scoreMap.entries());try{for(o.s();!(r=o.n()).done;){var a=(0,N.Z)(r.value,2),s=a[0],u=a[1];i.push({name:s,score:u})}}catch(c){o.e(c)}finally{o.f()}e(i)}else n(new Error("Container or scoreMap is undefined!"))}))},this.hasContent=function(){return new Promise((function(e,n){rh(t,uh)[uh]&&rh(t,uh)[uh].initialObjects.scoreMap?e(rh(t,uh)[uh].initialObjects.scoreMap.size>0):n(new Error("Container or scoreMap is undefined!"))}))},this.updateScoresFromUnity=function(e){return new Promise((function(n,r){if(rh(t,uh)[uh]&&rh(t,uh)[uh].initialObjects.scoreMap){for(var i=0,o=Object.entries(e);i<o.length;i++){var a=(0,N.Z)(o[i],2),s=a[0],u=a[1];rh(t,uh)[uh].initialObjects.scoreMap.set(s,u)}n(!0),console.log("score  map updated at:",(new Date).toISOString()),console.log("update is:",e)}else r(new Error("Container or scoreMap is undefined!"))}))},this.getHealthData=function(){return new Promise((function(e,n){if(rh(t,uh)[uh]&&rh(t,uh)[uh].initialObjects.healthDataMap){var r,i=[],o=(0,pe.Z)(rh(t,uh)[uh].initialObjects.healthDataMap.entries());try{for(o.s();!(r=o.n()).done;){var a=(0,N.Z)(r.value,2),s=a[0],u=a[1];i.push({name:s,data:u})}}catch(c){o.e(c)}finally{o.f()}e(i)}else n(new Error("Container or healthDataMap is undefined!"))}))},this.updateHealthDataFromUnity=function(e){return new Promise((function(n,r){if(rh(t,uh)[uh]&&rh(t,uh)[uh].initialObjects.healthDataMap){console.log("Attempting to update health data map with:",e);var o="".concat(e.username,"_").concat(Date.now()),a=(0,i.Z)({},o,e);rh(t,uh)[uh].initialObjects.healthDataMap.set(o,a);var s,u={},c=(0,pe.Z)(rh(t,uh)[uh].initialObjects.healthDataMap.entries());try{for(c.s();!(s=c.n()).done;){var l=(0,N.Z)(s.value,2),d=l[0],h=l[1];u[d]=h}}catch(f){c.e(f)}finally{c.f()}console.log("Current healthDataMap contents:",u),console.log("Health data map updated at:",(new Date).toISOString()),console.log("Update is:",e),n(!0)}else r(new Error("Container or healthDataMap is undefined!"))}))},this.onScoreUpdate=function(e){rh(t,ch)[ch].push(e)},this.onHealthUpdate=function(e){rh(t,lh)[lh].push(e)}})),ph=new fh;function vh(){var e=(window.location.href.includes("#/")?new URL("".concat(window.location.href.replace("#/","/"))):new URL(window.location)).searchParams;return console.log(e.get("inTeams")),!!e.get("inTeams")}var gh=function(){var t=(0,e.useState)(!1),n=(0,N.Z)(t,2),r=(n[0],n[1],(0,e.useState)(!1)),o=(0,N.Z)(r,2),s=(o[0],o[1],(0,e.useState)(!1)),u=(0,N.Z)(s,2),c=(u[0],u[1],(0,e.useState)(!1)),l=(0,N.Z)(c,2),d=(l[0],l[1]),h=(0,e.useState)(""),f=(0,N.Z)(h,2),p=(f[0],f[1]),v=(0,e.useState)([]),g=(0,N.Z)(v,2),m=(g[0],g[1]),y=(0,e.useRef)(),b=(0,e.useState)("Player"),w=(0,N.Z)(b,2),S=w[0],k=w[1],C=(0,e.useState)(400),x=(0,N.Z)(C,2),E=x[0],T=x[1],I=(0,e.useState)(450),A=(0,N.Z)(I,2),R=A[0],_=A[1],P=(0,e.useState)({}),O=(0,N.Z)(P,2),M=(O[0],O[1]),F=function(){var e=(0,th.JM)(nh);return{unityContext:e.unityContext,unityProvider:e.unityProvider,isLoaded:e.isLoaded,unityInstance:e.unityInstance,loadingProgression:e.loadingProgression,unload:e.unload,sendMessage:e.sendMessage,addEventListener:e.addEventListener,removeEventListener:e.removeEventListener}}(),Z=F.unityProvider,D=F.isLoaded,L=F.sendMessage,B=F.addEventListener,q=F.removeEventListener,j=(0,e.useCallback)((0,_i.Z)((0,Ri.Z)().mark((function e(){var t,n,r;return(0,Ri.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Ei.app.getContext();case 2:t=e.sent,n=t.user.userPrincipalName||"Player",console.log("USER EMAIL: ",n),r=n.split("@")[0],k(r),y.current=r,console.log("Username22:",S),D&&(L("ScoreManager","SetPlayerName",r),console.log("being sent to unity!:",r));case 10:case"end":return e.stop()}}),e)}))),[D,L]);(0,e.useEffect)((function(){return ph.onHealthUpdate((function(e,t){console.log("Received health update for ".concat(e,": "),t),M((function(n){return a(a({},n),{},(0,i.Z)({},e,t))}))})),function(){}}),[]),(0,e.useEffect)((function(){ph.onHealthUpdate((function(e,t){M((function(n){return a(a({},n),{},(0,i.Z)({},e,t))})),L("Dataexporter","ReceiveHealthData",JSON.stringify(t))}))}),[]),(0,e.useEffect)((function(){var e=function(e){U(e)};return B("ReportScore",e),function(){q("ReportScore",e)}}),[B,q]);var U=(0,e.useCallback)(function(){var e=(0,_i.Z)((0,Ri.Z)().mark((function e(t){var n,r,o,a;return(0,Ri.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.split(":"),r=(0,N.Z)(n,2),o=r[0],a=r[1],e.next=3,ph.updateScoresFromUnity((0,i.Z)({},o,parseInt(a)));case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),[]);(0,e.useEffect)((function(){var e=function(){var e=(0,_i.Z)((0,Ri.Z)().mark((function e(){var t,n;return(0,Ri.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Ei.app.getContext();case 2:t=e.sent,n=t.page.frameContext,console.log("Teams frame context:",n),vh()&&("meetingStage"===n?(T(900),_(450)):(T(280),_(400)));case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();e()}),[]),(0,e.useEffect)((function(){var e=function(){var e=(0,_i.Z)((0,Ri.Z)().mark((function e(t){var n;return(0,Ri.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("Received health data from Unity: ",t),n=JSON.parse(t),e.next=4,ph.updateHealthDataFromUnity(n);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return B("UpdateHealthData",e),function(){q("UpdateHealthData",e)}}),[B,q]),(0,e.useEffect)((function(){var e=function(){var e=(0,_i.Z)((0,Ri.Z)().mark((function e(){var t,n;return(0,Ri.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,ph.connect();case 3:return e.next=5,ph.getHealthData();case 5:t=e.sent,n=JSON.stringify(t),console.log("Received DOWNLOAD data from Unity: ",n),H(n),e.next=14;break;case 11:e.prev=11,e.t0=e.catch(0),console.error("Error fetching health data:",e.t0);case 14:case"end":return e.stop()}}),e,null,[[0,11]])})));return function(){return e.apply(this,arguments)}}();return B("DownloadHealthData",e),function(){q("DownloadHealthData",e)}}),[B,q]);var H=function(e){var t=new Blob([e],{type:"application/json"}),n=URL.createObjectURL(t),r=document.createElement("a");r.style.display="none",r.href=n,r.download="healthData.json",document.body.appendChild(r),r.click(),window.URL.revokeObjectURL(n),document.body.removeChild(r)};return(0,e.useEffect)((function(){ph.onScoreUpdate((function(e,t){L("ScoreManager","NewDataReceivedFromReact",JSON.stringify({type:"ScoreUpdate",playerName:e,newScore:t})),console.log("being sent to unity scoredate2!")}));var e=function(){var e=(0,_i.Z)((0,Ri.Z)().mark((function e(){var t,n,r,i,o,a;return(0,Ri.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Ei.app.initialize();case 3:return e.next=5,j();case 5:return e.next=7,ph.connect();case 7:return e.next=9,ph.hasContent();case 9:if(!e.sent){e.next=24;break}return d(!0),e.next=13,ph.getScores();case 13:return n=e.sent,m(n),D&&(r={type:"ScoreContainer",scores:n},console.log("being sent to unity from fluid!:",JSON.stringify(n)),L("ScoreManager","NewDataReceivedFromReact",JSON.stringify(r))),e.next=18,ph.getHealthData();case 18:i=e.sent,M(i),(o=null===(t=i[0])||void 0===t?void 0:t.data)&&D&&(a=JSON.stringify(o),console.log("being sent to unity from fluid!:",a),L("Dataexporter","ReceiveHealthData",a)),e.next=25;break;case 24:console.log("Fluid has no content");case 25:e.next=31;break;case 27:e.prev=27,e.t0=e.catch(0),console.error("ERROR: ",e.t0),p("ERROR: ".concat(e.t0.message));case 31:case"end":return e.stop()}}),e,null,[[0,27]])})));return function(){return e.apply(this,arguments)}}();e()}),[j,D,L]),(0,Wd.jsx)(e.Fragment,{children:(0,Wd.jsx)("div",{style:{display:"flex",alignItems:"flex-start",height:"100vh",overflow:"hidden",width:E},children:(0,Wd.jsx)(th.Y4,{unityProvider:Z,style:{width:E+40,height:R,marginLeft:"-20px"}})})})};Boolean(eh.apiName);function mh(){var t=(0,e.useContext)($d).themeString;return(0,Wd.jsx)("div",{className:"default"===t?"light":"dark"===t?"dark":"contrast",children:(0,Wd.jsx)(gh,{})})}var yh=function(e){(0,nr.Z)(n,e);var t=(0,rr.Z)(n);function n(){return(0,Y.Z)(this,n),t.apply(this,arguments)}return(0,X.Z)(n,[{key:"componentDidMount",value:function(){Ei.app.initialize().then((0,_i.Z)((0,Ri.Z)().mark((function e(){return(0,Ri.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:Ei.pages.config.registerOnSaveHandler(function(){var e=(0,_i.Z)((0,Ri.Z)().mark((function e(t){var n;return(0,Ri.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n="https://".concat(window.location.hostname,":").concat(window.location.port),e.next=3,Ei.pages.config.setConfig({suggestedDisplayName:"Pacman Game",entityId:"Pacman",contentUrl:n+"/index.html#/tab?inTeams=true",websiteUrl:n+"/index.html#/tab?inTeams=true"});case 3:t.notifySuccess();case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),Ei.pages.config.setValidityState(!0);case 2:case"end":return e.stop()}}),e)}))))}},{key:"render",value:function(){return(0,Wd.jsxs)("div",{children:[(0,Wd.jsx)("h1",{children:"Tab Configuration"}),(0,Wd.jsxs)("div",{children:[(0,Wd.jsx)("br",{}),'There are no configuration options for the Pacman tab. Please click "Save" to set up your tab.',(0,Wd.jsx)("br",{}),(0,Wd.jsx)("br",{}),"Nothing to see here folks!"]})]})}}]),n}(e.Component),bh=yh;function wh(){var t=Kd({initiateLoginEndpoint:eh.initiateLoginEndpoint,clientId:eh.clientId}),n=t.loading,r=t.theme,i=t.themeString,o=t.teamsUserCredential;return(0,e.useEffect)((function(){n&&Ei.app.initialize().then((function(){Ei.app.notifySuccess()}))}),[n]),(0,Wd.jsx)($d.Provider,{value:{theme:r,themeString:i,teamsUserCredential:o},children:(0,Wd.jsx)(Xe,{theme:"dark"===i?Hn:"contrast"===i?Wn:a(a({},er),{},{colorNeutralBackground3:"#eeeeee"}),style:{background:tr},children:(0,Wd.jsx)(ki,{children:!n&&(0,Wd.jsxs)(mi,{children:[(0,Wd.jsx)(vi,{path:"/privacy",element:(0,Wd.jsx)(Qd,{})}),(0,Wd.jsx)(vi,{path:"/termsofuse",element:(0,Wd.jsx)(Xd,{})}),(0,Wd.jsx)(vi,{path:"/tab",element:(0,Wd.jsx)(mh,{})}),(0,Wd.jsx)(vi,{path:"/config",element:(0,Wd.jsx)(bh,{})}),(0,Wd.jsx)(vi,{path:"*",element:(0,Wd.jsx)(pi,{to:"/tab"})})]})})})})}var Sh=document.getElementById("root");(0,r.s)(Sh).render((0,Wd.jsx)(wh,{}))}()}();
//# sourceMappingURL=main.b647972f.js.map